/**
 * @module log
 * @desc Logging facilities
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Copyright 2013, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3alpha.804
 * Build date: 8 December 2013
 */

/**
 * Selection save and restore module for Rangy.
 * Saves and restores user selections using marker invisible elements in the DOM.
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Depends on Rangy core.
 *
 * Copyright 2013, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3alpha.804
 * Build date: 8 December 2013
 */

/**
* @author Louis-Dominique Dubeau
* @license MPL 2.0
* @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
*/

/**
 * @module util
 * @desc Various utilities for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module domutil
 * @desc Utilities that manipulate or query the DOM tree.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module oop
 * @desc Object-oriented programming utilities.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module undo
 * @desc Basic undo/redo framework.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module wundo
 * @desc Wed-specific undo functionality.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module lib/simple_event_emitter
 * @desc A mixin class for objects that can emit events.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module lib/conditioned
 * @desc A mixin class for objects that have conditions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module exceptions
 * @desc Exceptions for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module onerror
 * @desc The onerror handler for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module browsers
 * @desc Browser detection. Extremely ad hoc and meant for wed's
 * internal purposes only.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module key
 * @desc Module implementing an class that describes keyboard keys.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013-2015 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module dloc
 * @desc Model for DOM locations.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module object_check
 * @desc Checks whether an object conforms to a template.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module preferences
 * @desc A model for wed's preferences.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module guiroot
 * @desc Model for a GUI root.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module serializer
 * @desc An XML serializer for platforms that produce erratic results.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module saver
 * @desc Data saving functionality.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module savers/ajax
 * @desc Data saving functionality, using Ajax.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module savers/localforage
 * @desc Data saving functionality, using localforage.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module tree_updater
 * @desc Facility for updating a DOM tree and issue synchronous events
 * on changes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module convert
 * @desc Convertion from XML to HTML.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui_updater
 * @desc Listens to changes on a tree and updates the GUI tree in
 * response to changes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module undo_recorder
 * @desc Listens to changes on a tree and records undo operations
 * corresponding to these changes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module domlistener
 * @desc Abstract base class for classes that raise events when a DOM
 * tree is modified.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module updater_domlistener
 * @desc Facility to listen to changes to a DOM tree.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module name_resolver
 * @desc Implements a name resolver for handling namespace changes in XML.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module util
 * @desc A mock implementation of Node's util package. This module
 * implements only what is actually used in salve.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module oop
 * @desc OOP utilities
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module hashstructs
 * @desc {@link module:hashstructs~HashSet HashSet} and {@link
 * module:hashstructs~HashMap HashMap} implementations.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module set
 * @desc Naive set implementation.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module datatypes/errors.js
 * @desc Errors that can be raised during parsing of types.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module datatypes/builtin
 * @desc Implementation of the builtin Relax NG datatype library.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module datatypes/xmlschema
 * @desc Collection of constants that model the way XML refers to
 * various characters and groups of characters.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/*!
 * XRegExp v2.0.0
 * (c) 2007-2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 */

/*!
 * XRegExp Unicode Base v1.0.0
 * (c) 2008-2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 * Uses Unicode 6.1 <http://unicode.org/>
 */

/*!
 * XRegExp Unicode Categories v1.2.0
 * (c) 2010-2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 * Uses Unicode 6.1 <http://unicode.org/>
 */

/*!
 * XRegExp Unicode Scripts v1.2.0
 * (c) 2010-2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 * Uses Unicode 6.1 <http://unicode.org/>
 */

/*!
 * XRegExp Unicode Blocks v1.2.0
 * (c) 2010-2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 * Uses Unicode 6.1 <http://unicode.org/>
 */

/*!
 * XRegExp Unicode Properties v1.0.0
 * (c) 2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 * Uses Unicode 6.1 <http://unicode.org/>
 */

/*!
 * XRegExp.matchRecursive v0.2.0
 * (c) 2009-2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 */

/*!
 * XRegExp.build v0.1.0
 * (c) 2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 * Inspired by RegExp.create by Lea Verou <http://lea.verou.me/>
 */

/*!
 * XRegExp Prototype Methods v1.0.0
 * (c) 2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 */

/**
 * @module datatypes/xmlschema
 * @desc Implementation of the XMLSchema datatypes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module datatypes
 * @desc Classes that model datatypes used in RNG schemas.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module errors
 * @desc Validation errors.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module patterns
 * @desc Classes that model RNG patterns.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module formats
 * @desc This module contains data and utilities to work with the
 * schema format that salve uses natively.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module validate
 * @desc RNG-based validator.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module validator
 * @desc This module is responsible for validating the document being
 * edited in wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/modal
 * @desc Modal dialog boxes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module action
 * @desc Editing actions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/icon
 * @desc The icons used by the user interface.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module transformation
 * @desc Transformation framework.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module lib/pubsub
 * @desc Wed's pubsub wrapper. Hides implementation details.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module onbeforeunload
 * @desc The onbeforeunload handler for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module key_constants
 * @desc Keys that wed uses, as constants.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/context_menu
 * @desc Context menus.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/action_context_menu
 * @desc Context menus meant to hold actions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/completion_menu
 * @desc Menu for completions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/typeahead_popup
 * @desc Support for a typeahead field that pop up in the editing pane.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2015 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/tooltip
 * @desc Tooltips for elements that appear in the editor pane.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module wed
 * @desc The main module for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013-2015 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module mode
 * @desc The base class for modes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
  * @module decorator
  * @desc Basic decoration facilities.
  * @author Louis-Dominique Dubeau
  * @license MPL 2.0
  * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
  */

/**
 * @module modes/generic/generic_decorator
 * @desc Decorator for the generic mode.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module modes/generic/generic_tr
 * @desc Transformation registry for the generic mode.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module modes/generic/generic_meta
 * @desc Meta-information regarding the schema.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module modes/generic/generic
 * @desc The main module for the generic mode.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module modes/generic/metas/tei_meta
 * @desc The main module for the generic mode.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

define("wed/log",["require","exports","module","log4javascript"],function(e,t,n){function a(){u.show()}function f(e){this.original=e}function l(e){return e instanceof f?e:(o.fatal("Unhandled exception",e),typeof console!="undefined"&&(console.log(e),console.log(e.stack)),new f(e))}function c(e){throw l(e)}function h(e){return function(){try{return e.apply(this,arguments)}catch(t){c(t)}return undefined}}function d(e,t){var n=new i.AjaxAppender(e);n.setThreshold(i.Level.ALL);var r=new i.XmlLayout;n.setLayout(r),t&&Object.keys(t).forEach(function(e){n.addHeader(e,t[e])}),s.addAppender(n),o.info("Ajax appender initialized"),p.push(n)}function v(){for(var e=0,t;(t=p[e])!==undefined;++e)t.sendAll()}var r=n.config(),i=e("log4javascript");i.setShowStackTraces(!0);var s=i.getLogger("wed");s.setLevel(i.Level.ALL);var o=i.getLogger("wed.common");o.setLevel(i.Level.ALL);var u=new i.PopUpAppender(!0);u.setThreshold(i.Level.ERROR),u.setFocusPopUp(r&&r.focus_popup),u.setInitiallyMinimized(!0),u.setNewestMessageAtTop(!0),o.addAppender(u),t.trace=o.trace.bind(o),t.debug=o.debug.bind(o),t.info=o.info.bind(o),t.warn=o.warn.bind(o),t.error=o.error.bind(o),t.fatal=o.fatal.bind(o),t.showPopup=a,t.unhandled=l,t.handle=c,t.wrap=h;var p=[];t.addURL=d,t.flush=v}),function(){var e=define;define=undefined,function(e){function f(e,t){var i=typeof e[t];return i==r||i==n&&!!e[t]||i=="unknown"}function l(e,t){return typeof e[t]==n&&!!e[t]}function c(e,t){return typeof e[t]!=i}function h(e){return function(t,n){var r=n.length;while(r--)if(!e(t,n[r]))return!1;return!0}}function m(e){return e&&p(e,a)&&v(e,u)}function g(e){return l(e,"body")?e.body:e.getElementsByTagName("body")[0]}function w(e){l(window,"console")&&f(window.console,"log")&&window.console.log(e)}function E(e,t){t?window.alert(e):w(e)}function S(e){b.initialized=!0,b.supported=!1,E("Rangy is not supported on this page in your browser. Reason: "+e,b.config.alertOnFail)}function x(e){E("Rangy warning: "+e,b.config.alertOnWarn)}function C(e){return e.message||e.description||String(e)}function k(){if(b.initialized)return;var e,t=!1,n=!1;f(document,"createRange")&&(e=document.createRange(),p(e,o)&&v(e,s)&&(t=!0),e.detach());var r=g(document);if(!r||r.nodeName.toLowerCase()!="body"){S("No body element found");return}r&&f(r,"createTextRange")&&(e=r.createTextRange(),m(e)&&(n=!0));if(!t&&!n){S("Neither Range nor TextRange are available");return}b.initialized=!0,b.features={implementsDomRange:t,implementsTextRange:n};var i,u;for(var a in y)(i=y[a])instanceof O&&i.init(i,b);for(var l=0,c=N.length;l<c;++l)try{N[l](b)}catch(h){u="Rangy init listener threw an exception. Continuing. Detail: "+C(h),w(u)}}function A(e){e=e||window,k();for(var t=0,n=L.length;t<n;++t)L[t](e)}function O(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function M(e,t,n,r){var i=new O(t,n,function(e){if(!e.initialized){e.initialized=!0;try{r(b,e),e.supported=!0}catch(n){var i="Module '"+t+"' failed to load: "+C(n);w(i)}}});y[t]=i}function _(){}function D(){}var t=typeof e.define=="function"&&e.define.amd,n="object",r="function",i="undefined",s=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],o=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],u=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],a=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],p=h(f),d=h(l),v=h(c),y={},b={version:"1.3alpha.804",initialized:!1,supported:!0,util:{isHostMethod:f,isHostObject:l,isHostProperty:c,areHostMethods:p,areHostObjects:d,areHostProperties:v,isTextRange:m,getBody:g},features:{},modules:y,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};b.fail=S,b.warn=x,{}.hasOwnProperty?b.util.extend=function(e,t,n){var r,i;for(var s in t)t.hasOwnProperty(s)&&(r=e[s],i=t[s],n&&r!==null&&typeof r=="object"&&i!==null&&typeof i=="object"&&b.util.extend(r,i,!0),e[s]=i);return e}:S("hasOwnProperty not supported"),function(){var e=document.createElement("div");e.appendChild(document.createElement("span"));var t=[].slice,n;try{t.call(e.childNodes,0)[0].nodeType==1&&(n=function(e){return t.call(e,0)})}catch(r){}n||(n=function(e){var t=[];for(var n=0,r=e.length;n<r;++n)t[n]=e[n];return t}),b.util.toArray=n}();var T;f(document,"addEventListener")?T=function(e,t,n){e.addEventListener(t,n,!1)}:f(document,"attachEvent")?T=function(e,t,n){e.attachEvent("on"+t,n)}:S("Document does not have required addEventListener or attachEvent method"),b.util.addListener=T;var N=[];b.init=k,b.addInitListener=function(e){b.initialized?e(b):N.push(e)};var L=[];b.addCreateMissingNativeApiListener=function(e){L.push(e)},b.createMissingNativeApi=A,O.prototype={init:function(e){var t=this.dependencies||[];for(var n=0,r=t.length,i,s;n<r;++n){s=t[n],i=y[s];if(!i||!(i instanceof O))throw new Error("required module '"+s+"' not found");i.init();if(!i.supported)throw new Error("required module '"+s+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){b.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){b.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},b.createModule=function(e){var t,n;arguments.length==2?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]),M(!1,e,n,t)},b.createCoreModule=function(e,t,n){M(!0,e,t,n)},b.RangePrototype=_,b.rangePrototype=new _,b.selectionPrototype=new D;var P=!1,H=function(e){P||(P=!0,b.initialized||k())};if(typeof window==i){S("No window found");return}if(typeof document==i){S("No document found");return}f(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",H,!1),T(window,"load",H),t&&e.define(function(){return b.amd=!0,b}),e.rangy=b}(this),rangy.createCoreModule("DomUtil",[],function(e,t){function u(e){var t;return typeof e.namespaceURI==n||(t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function a(e){var t=e.parentNode;return t.nodeType==1?t:null}function f(e){var t=0;while(e=e.previousSibling)++t;return t}function l(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function c(e,t){var n=[],r;for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(o(n,r))return r;return null}function h(e,t,n){var r=n?t:t.parentNode;while(r){if(r===e)return!0;r=r.parentNode}return!1}function p(e,t){return h(e,t,!0)}function d(e,t,n){var r,i=n?e:e.parentNode;while(i){r=i.parentNode;if(r===t)return i;i=r}return null}function v(e){var t=e.nodeType;return t==3||t==4||t==8}function m(e){if(!e)return!1;var t=e.nodeType;return t==3||t==8}function g(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function y(e,t,n){var r=e.cloneNode(!1);r.deleteData(0,t),e.deleteData(t,e.length-t),g(r,e);if(n)for(var i=0,s;s=n[i++];)s.node==e&&s.offset>t?(s.node=r,s.offset-=t):s.node==e.parentNode&&s.offset>f(e)&&++s.offset;return r}function b(e){if(e.nodeType==9)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return b(e.parentNode);throw t.createError("getDocument: no document found for node")}function w(e){var r=b(e);if(typeof r.defaultView!=n)return r.defaultView;if(typeof r.parentWindow!=n)return r.parentWindow;throw t.createError("Cannot get a window object for node")}function E(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function S(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function x(e){return e&&r.isHostMethod(e,"setTimeout")&&r.isHostObject(e,"document")}function T(e,t,n){var i;e?r.isHostProperty(e,"nodeType")?i=e.nodeType==1&&e.tagName.toLowerCase()=="iframe"?E(e):b(e):x(e)&&(i=e.document):i=document;if(!i)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return i}function N(e){var t;while(t=e.parentNode)e=t;return e}function C(e,n,r,i){var s,o,u,a,l;if(e==r)return n===i?0:n<i?-1:1;if(s=d(r,e,!0))return n<=f(s)?-1:1;if(s=d(e,r,!0))return f(s)<i?-1:1;o=c(e,r);if(!o)throw new Error("comparePoints error: nodes have no common ancestor");u=e===o?o:d(e,o,!0),a=r===o?o:d(r,o,!0);if(u===a)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");l=o.firstChild;while(l){if(l===u)return-1;if(l===a)return 1;l=l.nextSibling}}function L(e){try{return e.parentNode,!1}catch(t){return!0}}function A(e){if(!e)return"[No node]";if(k&&L(e))return"[Broken node]";if(v(e))return'"'+e.data+'"';if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+f(e)+"]["+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function O(e){var t=b(e).createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t}function _(e){this.root=e,this._next=e}function D(e){return new _(e)}function P(e,t){this.node=e,this.offset=t}function H(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var n="undefined",r=e.util;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var i=document.createElement("div");r.areHostMethods(i,["insertBefore","appendChild","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),r.isHostProperty(i,"innerHTML")||t.fail("Element is missing innerHTML property");var s=document.createTextNode("test");r.areHostMethods(s,["splitText","deleteData","insertData","appendData","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"])||!r.areHostProperties(s,["data"]))||t.fail("Incomplete Text Node implementation");var o=function(e,t){var n=e.length;while(n--)if(e[n]===t)return!0;return!1},k=!1;(function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br>",k=L(n),e.features.crashyTextNodes=k})();var M;typeof window.getComputedStyle!=n?M=function(e,t){return w(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=n?M=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),_.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next,t,n;if(this._current){t=e.firstChild;if(t)this._next=t;else{n=null;while(e!==this.root&&!(n=e.nextSibling))e=e.parentNode;this._next=n}}return this._current},detach:function(){this._current=this._next=this.root=null}},P.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+A(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},H.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},H.prototype.toString=function(){return this.message},e.dom={arrayContains:o,isHtmlNamespace:u,parentElement:a,getNodeIndex:f,getNodeLength:l,getCommonAncestor:c,isAncestorOf:h,isOrIsAncestorOf:p,getClosestAncestorIn:d,isCharacterDataNode:v,isTextOrCommentNode:m,insertAfter:g,splitDataNode:y,getDocument:b,getWindow:w,getIframeWindow:S,getIframeDocument:E,getBody:r.getBody,isWindow:x,getContentDocument:T,getRootContainer:N,comparePoints:C,isBrokenNode:L,inspectNode:A,getComputedStyleProperty:M,fragmentFromNodeChildren:O,createIterator:D,DomPosition:P},e.DOMException=H}),rangy.createCoreModule("DomRange",["DomUtil"],function(e,t){function g(e,t){return e.nodeType!=3&&(a(e,t.startContainer)||a(e,t.endContainer))}function y(e){return e.document||f(e.startContainer)}function b(e){return new i(e.parentNode,u(e))}function w(e){return new i(e.parentNode,u(e)+1)}function E(e,t,r){var i=e.nodeType==11?e.firstChild:e;return o(t)?r==t.length?n.insertAfter(e,t):t.parentNode.insertBefore(e,r==0?t:c(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),i}function S(e,t,n){Q(e),Q(t);if(y(t)!=y(e))throw new s("WRONG_DOCUMENT_ERR");var r=l(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=l(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?r<=0&&i>=0:r<0&&i>0}function x(e){var t;for(var n,r=y(e.range).createDocumentFragment(),i;n=e.next();){t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(i=e.getSubtreeIterator(),n.appendChild(x(i)),i.detach(!0));if(n.nodeType==10)throw new s("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function T(e,t,r){var i,s;r=r||{stop:!1};for(var o,u;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1){r.stop=!0;return}u=e.getSubtreeIterator(),T(u,t,r),u.detach(!0);if(r.stop)return}else{i=n.createIterator(o);while(s=i.next())if(t(s)===!1){r.stop=!0;return}}}function N(e){var t;while(e.next())e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),N(t),t.detach(!0)):e.remove()}function C(e){for(var t,n=y(e.range).createDocumentFragment(),r;t=e.next();){e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(C(r)),r.detach(!0)):e.remove();if(t.nodeType==10)throw new s("HIERARCHY_REQUEST_ERR");n.appendChild(t)}return n}function k(e,t,n){var r=!!t&&!!t.length,i,s=!!n;r&&(i=new RegExp("^("+t.join("|")+")$"));var u=[];return T(new A(e,!1),function(t){if(r&&!i.test(t.nodeType))return;if(s&&!n(t))return;var a=e.startContainer;if(t==a&&o(a)&&e.startOffset==a.length)return;var f=e.endContainer;if(t==f&&o(f)&&e.endOffset==0)return;u.push(t)}),u}function L(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function A(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&o(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===n&&!o(this.sc)?this.sc.childNodes[this.so]:h(this.sc,n,!0),this._last=this.ec===n&&!o(this.ec)?this.ec.childNodes[this.eo-1]:h(this.ec,n,!0))}}function O(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function B(e){return function(t,n){var r,i=n?t:t.parentNode;while(i){r=i.nodeType;if(d(e,r))return i;i=i.parentNode}return null}}function q(e,t){if(I(e,t))throw new O("INVALID_NODE_TYPE_ERR")}function R(e){if(!e.startContainer)throw new s("INVALID_STATE_ERR")}function U(e,t){if(!d(t,e.nodeType))throw new O("INVALID_NODE_TYPE_ERR")}function z(e,t){if(t<0||t>(o(e)?e.length:e.childNodes.length))throw new s("INDEX_SIZE_ERR")}function W(e,t){if(j(e,!0)!==j(t,!0))throw new s("WRONG_DOCUMENT_ERR")}function X(e){if(F(e,!0))throw new s("NO_MODIFICATION_ALLOWED_ERR")}function V(e,t){if(!e)throw new s(t)}function $(e){return m&&n.isBrokenNode(e)||!d(_,e.nodeType)&&!j(e,!0)}function J(e,t){return t<=(o(e)?e.length:e.childNodes.length)}function K(e){return!!e.startContainer&&!!e.endContainer&&!$(e.startContainer)&&!$(e.endContainer)&&J(e.startContainer,e.startOffset)&&J(e.endContainer,e.endOffset)}function Q(e){R(e);if(!K(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function tt(e,t){Q(e);var n=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,a=n===i;o(i)&&s>0&&s<i.length&&c(i,s,t),o(n)&&r>0&&r<n.length&&(n=c(n,r,t),a?(s-=r,i=n):i==n.parentNode&&s>=u(n)&&s++,r=0),e.setStartAndEnd(n,r,i,s)}function ct(e){e.START_TO_START=rt,e.START_TO_END=it,e.END_TO_END=st,e.END_TO_START=ot,e.NODE_BEFORE=ut,e.NODE_AFTER=at,e.NODE_BEFORE_AND_AFTER=ft,e.NODE_INSIDE=lt}function ht(e){ct(e),ct(e.prototype)}function pt(e,t){return function(){Q(this);var n=this.startContainer,r=this.startOffset,i=this.commonAncestorContainer,s=new A(this,!0),o,u;n!==i&&(o=h(n,i,!0),u=w(o),n=u.node,r=u.offset),T(s,X),s.reset();var a=e(s);return s.detach(),t(this,n,r,n,r),a}}function dt(t,n,i){function s(e,t){return function(n){R(this),U(n,M),U(v(n),_);var r=(e?b:w)(n);(t?a:f)(this,r.node,r.offset)}}function a(e,t,r){var i=e.endContainer,s=e.endOffset;if(t!==e.startContainer||r!==e.startOffset){if(v(t)!=v(i)||l(t,r,i,s)==1)i=t,s=r;n(e,t,r,i,s)}}function f(e,t,r){var i=e.startContainer,s=e.startOffset;if(t!==e.endContainer||r!==e.endOffset){if(v(t)!=v(i)||l(t,r,i,s)==-1)i=t,s=r;n(e,i,s,t,r)}}var c=function(){};c.prototype=e.rangePrototype,t.prototype=new c,r.extend(t.prototype,{setStart:function(e,t){R(this),q(e,!0),z(e,t),a(this,e,t)},setEnd:function(e,t){R(this),q(e,!0),z(e,t),f(this,e,t)},setStartAndEnd:function(){R(this);var e=arguments,t=e[0],r=e[1],i=t,s=r;switch(e.length){case 3:s=e[2];break;case 4:i=e[2],s=e[3]}n(this,t,r,i,s)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(e){Q(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){R(this),q(e,!0),n(this,e,0,e,p(e))},selectNode:function(e){R(this),q(e,!1),U(e,M);var t=b(e),r=w(e);n(this,t.node,t.offset,r.node,r.offset)},extractContents:pt(C,n),deleteContents:pt(N,n),canSurroundContents:function(){Q(this),X(this.startContainer),X(this.endContainer);var e=new A(this,!0),t=e._first&&g(e._first,this)||e._last&&g(e._last,this);return e.detach(),!t},detach:function(){i(this)},splitBoundaries:function(){tt(this)},splitBoundariesPreservingPositions:function(e){tt(this,e)},normalizeBoundaries:function(){Q(this);var e=this.startContainer,t=this.startOffset,r=this.endContainer,i=this.endOffset,s=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(r=e,i=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},a=function(n){var s=n.previousSibling;if(s&&s.nodeType==n.nodeType){e=n;var o=n.length;t=s.length,n.insertData(0,s.data),s.parentNode.removeChild(s);if(e==r)i+=t,r=e;else if(r==n.parentNode){var a=u(n);i==a?(r=n,i=o):i>a&&i--}}},f=!0;if(o(r))r.length==i&&s(r);else{if(i>0){var l=r.childNodes[i-1];l&&o(l)&&s(l)}f=!this.collapsed}if(f){if(o(e))t==0&&a(e);else if(t<e.childNodes.length){var c=e.childNodes[t];c&&o(c)&&a(c)}}else e=r,t=i;n(this,e,t,r,i)},collapseToPoint:function(e,t){R(this),q(e,!0),z(e,t),this.setStartAndEnd(e,t)}}),ht(t)}function vt(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function mt(e,t,r,i,s){e.startContainer=t,e.startOffset=r,e.endContainer=i,e.endOffset=s,e.document=n.getDocument(t),vt(e)}function gt(e){R(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=e.document=null,e.collapsed=e.commonAncestorContainer=null}function yt(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,vt(this)}var n=e.dom,r=e.util,i=n.DomPosition,s=e.DOMException,o=n.isCharacterDataNode,u=n.getNodeIndex,a=n.isOrIsAncestorOf,f=n.getDocument,l=n.comparePoints,c=n.splitDataNode,h=n.getClosestAncestorIn,p=n.getNodeLength,d=n.arrayContains,v=n.getRootContainer,m=e.features.crashyTextNodes;A.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,o(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e=this._current,t,n;!o(e)||e!==this.sc&&e!==this.ec?e.parentNode&&e.parentNode.removeChild(e):(t=e===this.sc?this.so:0,n=e===this.ec?this.eo:e.length,t!=n&&e.deleteData(t,n-t))},isPartiallySelectedSubtree:function(){var e=this._current;return g(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new yt(y(this.range));var t=this._current,n=t,r=0,i=t,s=p(t);a(t,this.sc)&&(n=this.sc,r=this.so),a(t,this.ec)&&(i=this.ec,s=this.eo),mt(e,n,r,i,s)}return new A(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},O.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},O.prototype.toString=function(){return this.message};var M=[1,3,4,5,7,8,10],_=[2,9,11],D=[5,6,10,12],P=[1,3,4,5,7,8,10,11],H=[1,3,4,5,7,8],j=B([9,11]),F=B(D),I=B([6,10,12]),G=document.createElement("style"),Y=!1;try{G.innerHTML="<b>x</b>",Y=G.firstChild.nodeType==3}catch(Z){}e.features.htmlParsingConforms=Y;var et=Y?function(e){var t=this.startContainer,r=f(t);if(!t)throw new s("INVALID_STATE_ERR");var i=null;return t.nodeType==1?i=t:o(t)&&(i=n.parentElement(t)),i===null||i.nodeName=="HTML"&&n.isHtmlNamespace(f(i).documentElement)&&n.isHtmlNamespace(i)?i=r.createElement("body"):i=i.cloneNode(!1),i.innerHTML=e,n.fragmentFromNodeChildren(i)}:function(e){R(this);var t=y(this),r=t.createElement("body");return r.innerHTML=e,n.fragmentFromNodeChildren(r)},nt=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],rt=0,it=1,st=2,ot=3,ut=0,at=1,ft=2,lt=3;r.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){Q(this),W(this.startContainer,t.startContainer);var n,r,i,s,o=e==ot||e==rt?"start":"end",u=e==it||e==rt?"start":"end";return n=this[o+"Container"],r=this[o+"Offset"],i=t[u+"Container"],s=t[u+"Offset"],l(n,r,i,s)},insertNode:function(e){Q(this),U(e,P),X(this.startContainer);if(a(e,this.startContainer))throw new s("HIERARCHY_REQUEST_ERR");var t=E(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){Q(this);var e,t;if(this.collapsed)return y(this).createDocumentFragment();if(this.startContainer===this.endContainer&&o(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=y(this).createDocumentFragment(),t.appendChild(e),t;var n=new A(this,!0);return e=x(n),n.detach(),e},canSurroundContents:function(){Q(this),X(this.startContainer),X(this.endContainer);var e=new A(this,!0),t=e._first&&g(e._first,this)||e._last&&g(e._last,this);return e.detach(),!t},surroundContents:function(e){U(e,H);if(!this.canSurroundContents())throw new O("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())while(e.lastChild)e.removeChild(e.lastChild);E(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){Q(this);var e=new yt(y(this)),t=nt.length,n;while(t--)n=nt[t],e[n]=this[n];return e},toString:function(){Q(this);var e=this.startContainer;if(e===this.endContainer&&o(e))return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new A(this,!0);return T(n,function(e){(e.nodeType==3||e.nodeType==4)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){Q(this);var t=e.parentNode,n=u(e);if(!t)throw new s("NOT_FOUND_ERR");var r=this.comparePoint(t,n),i=this.comparePoint(t,n+1);return r<0?i>0?ft:ut:i>0?at:lt},comparePoint:function(e,t){return Q(this),V(e,"HIERARCHY_REQUEST_ERR"),W(e,this.startContainer),l(e,t,this.startContainer,this.startOffset)<0?-1:l(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:et,toHtml:function(){Q(this);var e=this.commonAncestorContainer.parentNode.cloneNode(!1);return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){Q(this),V(e,"NOT_FOUND_ERR");if(f(e)!==y(this))return!1;var n=e.parentNode,r=u(e);V(n,"NOT_FOUND_ERR");var i=l(n,r,this.endContainer,this.endOffset),s=l(n,r+1,this.startContainer,this.startOffset);return t?i<=0&&s>=0:i<0&&s>0},isPointInRange:function(e,t){return Q(this),V(e,"HIERARCHY_REQUEST_ERR"),W(e,this.startContainer),l(e,t,this.startContainer,this.startOffset)>=0&&l(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return S(this,e,!1)},intersectsOrTouchesRange:function(e){return S(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=l(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=l(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return t==-1&&r.setStart(e.startContainer,e.startOffset),n==1&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return l(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(e.startContainer,e.startOffset),l(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1&&t.setEnd(e.endContainer,e.endOffset),t}throw new O("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==lt},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,p(e))<=0},containsRange:function(e){var t=this.intersection(e);return t!==null&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);var i=this.containsRange(t);return t.detach(),i}return this.containsNodeContents(e)},getNodes:function(e,t){return Q(this),k(this,e,t)},getDocument:function(){return y(this)},collapseBefore:function(e){R(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){R(this),this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var r=y(this),i=e.createRange(r);t=t||n.getBody(r),i.selectNodeContents(t);var s=this.intersection(i),o=0,u=0;return s&&(i.setEnd(s.startContainer,s.startOffset),o=i.toString().length,u=o+s.toString().length,i.detach()),{start:o,end:u,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);var r=[t],i,s=!1,o=!1,u,a,f;while(!o&&(i=r.pop()))if(i.nodeType==3)u=n+i.length,!s&&e.start>=n&&e.start<=u&&(this.setStart(i,e.start-n),s=!0),s&&e.end>=n&&e.end<=u&&(this.setEnd(i,e.end-n),o=!0),n=u;else{f=i.childNodes,a=f.length;while(a--)r.push(f[a])}},getName:function(){return"DomRange"},equals:function(e){return yt.rangesEqual(this,e)},isValid:function(){return K(this)},inspect:function(){return L(this)}}),dt(yt,mt,gt),r.extend(yt,{rangeProperties:nt,RangeIterator:A,copyComparisonConstants:ht,createPrototypeRange:dt,inspect:L,getRangeDocument:y,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=yt,e.RangeException=O}),rangy.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,r,i=e.dom,s=e.util,o=i.DomPosition,u=e.DomRange,a=i.getBody,f=i.getContentDocument,l=i.isCharacterDataNode;e.features.implementsDomRange&&function(){function l(e){var t=o.length,n;while(t--)n=o[t],e[n]=e.nativeRange[n];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function c(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!=n,o=e.endContainer!==r||e.endOffset!=i,u=!e.equals(e.nativeRange);if(s||o||u)e.setEnd(r,i),e.setStart(t,n)}function h(e){e.nativeRange.detach(),e.detached=!0;var t=o.length;while(t--)e[o[t]]=null}var r,o=u.rangeProperties,p;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,l(this)},u.createPrototypeRange(n,c,h),r=n.prototype,r.selectNode=function(e){this.nativeRange.selectNode(e),l(this)},r.cloneContents=function(){return this.nativeRange.cloneContents()},r.surroundContents=function(e){this.nativeRange.surroundContents(e),l(this)},r.collapse=function(e){this.nativeRange.collapse(e),l(this)},r.cloneRange=function(){return new n(this.nativeRange.cloneRange())},r.refresh=function(){l(this)},r.toString=function(){return this.nativeRange.toString()};var d=document.createTextNode("test");a(document).appendChild(d);var v=document.createRange();v.setStart(d,0),v.setEnd(d,0);try{v.setStart(d,1),r.setStart=function(e,t){this.nativeRange.setStart(e,t),l(this)},r.setEnd=function(e,t){this.nativeRange.setEnd(e,t),l(this)},p=function(e){return function(t){this.nativeRange[e](t),l(this)}}}catch(m){r.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}l(this)},r.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}l(this)},p=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}l(this)}}}r.setStartBefore=p("setStartBefore","setEndBefore"),r.setStartAfter=p("setStartAfter","setEndAfter"),r.setEndBefore=p("setEndBefore","setStartBefore"),r.setEndAfter=p("setEndAfter","setStartAfter"),r.selectNodeContents=function(e){this.setStartAndEnd(e,0,i.getNodeLength(e))},v.selectNodeContents(d),v.setEnd(d,3);var g=document.createRange();g.selectNodeContents(d),g.setEnd(d,4),g.setStart(d,2),v.compareBoundaryPoints(v.START_TO_END,g)==-1&&v.compareBoundaryPoints(v.END_TO_START,g)==1?r.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:r.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var y=document.createElement("div");y.innerHTML="123";var b=y.firstChild,w=a(document);w.appendChild(y),v.setStart(b,1),v.setEnd(b,2),v.deleteContents(),b.data=="13"&&(r.deleteContents=function(){this.nativeRange.deleteContents(),l(this)},r.extractContents=function(){var e=this.nativeRange.extractContents();return l(this),e}),w.removeChild(y),w=null,s.isHostMethod(v,"createContextualFragment")&&(r.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),a(document).removeChild(d),v.detach(),g.detach(),r.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=f(e,t,"createNativeRange"),e.createRange()}}();if(e.features.implementsTextRange){var c=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();n=e.duplicate(),n.collapse(!1);var s=n.parentElement(),o=r==s?r:i.getCommonAncestor(r,s);return o==t?o:i.getCommonAncestor(t,o)},h=function(e){return e.compareEndPoints("StartToEnd",e)==0},p=function(e,t,n,r,s){var u=e.duplicate();u.collapse(n);var a=u.parentElement();i.isOrIsAncestorOf(t,a)||(a=t);if(!a.canHaveHTML){var f=new o(a.parentNode,i.getNodeIndex(a));return{boundaryPosition:f,nodeInfo:{nodeIndex:f.offset,containerElement:f.node}}}var c=i.getDocument(a).createElement("span");c.parentNode&&c.parentNode.removeChild(c);var h,p=n?"StartToStart":"StartToEnd",d,v,m,g,y=s&&s.containerElement==a?s.nodeIndex:0,b=a.childNodes.length,w=b,E=w;for(;;){E==b?a.appendChild(c):a.insertBefore(c,a.childNodes[E]),u.moveToElementText(c),h=u.compareEndPoints(p,e);if(h==0||y==w)break;if(h==-1){if(w==y+1)break;y=E}else w=w==y+1?y:E;E=Math.floor((y+w)/2),a.removeChild(c)}g=c.nextSibling;if(h==-1&&g&&l(g)){u.setEndPoint(n?"EndToStart":"EndToEnd",e);var S;if(/[\r\n]/.test(g.data)){var x=u.duplicate(),T=x.text.replace(/\r\n/g,"\r").length;S=x.moveStart("character",T);while((h=x.compareEndPoints("StartToEnd",x))==-1)S++,x.moveStart("character",1)}else S=u.text.length;m=new o(g,S)}else d=(r||!n)&&c.previousSibling,v=(r||n)&&c.nextSibling,v&&l(v)?m=new o(v,0):d&&l(d)?m=new o(d,d.data.length):m=new o(a,i.getNodeIndex(c));return c.parentNode.removeChild(c),{boundaryPosition:m,nodeInfo:{nodeIndex:E,containerElement:a}}},d=function(e,t){var n,r,s=e.offset,o=i.getDocument(e.node),u,f,c=a(o).createTextRange(),h=l(e.node);return h?(n=e.node,r=n.parentNode):(f=e.node.childNodes,n=s<f.length?f[s]:null,r=e.node),u=o.createElement("span"),u.innerHTML="&#feff;",n?r.insertBefore(u,n):r.appendChild(u),c.moveToElementText(u),c.collapse(!t),r.removeChild(u),h&&c[t?"moveStart":"moveEnd"]("character",s),c};r=function(e){this.textRange=e,this.refresh()},r.prototype=new u(document),r.prototype.refresh=function(){var e,t,n,r=c(this.textRange);h(this.textRange)?t=e=p(this.textRange,r,!0,!0).boundaryPosition:(n=p(this.textRange,r,!0,!1),e=n.boundaryPosition,t=p(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},u.copyComparisonConstants(r),r.rangeToTextRange=function(e){if(e.collapsed)return d(new o(e.startContainer,e.startOffset),!0);var t=d(new o(e.startContainer,e.startOffset),!0),n=d(new o(e.endContainer,e.endOffset),!1),r=a(u.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r},e.WrappedTextRange=r;if(!e.features.implementsDomRange||e.config.preferTextRange){var v=function(){return this}();typeof v.Range=="undefined"&&(v.Range=r),e.createNativeRange=function(e){return e=f(e,t,"createNativeRange"),a(e).createTextRange()},e.WrappedRange=r}}e.createRange=function(n){return n=f(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=f(e,t,"createRangyRange"),new u(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addCreateMissingNativeApiListener(function(t){var n=t.document;typeof n.createRange=="undefined"&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),rangy.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function y(e){return typeof e=="string"?/^backward(s)?$/i.test(e):!!e}function b(e,n){if(!e)return window;if(i.isWindow(e))return e;if(e instanceof J)return e.win;var r=i.getContentDocument(e,t,n);return i.getWindow(r)}function w(e){return b(e,"getWinSelection").getSelection()}function E(e){return b(e,"getDocSelection").document.selection}function S(e){var t=!1;return e.anchorNode&&(t=i.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1),t}function j(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function F(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function I(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function q(t){var n;return t instanceof u?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof a?n=t.nativeRange:p.implementsDomRange&&t instanceof i.getWindow(t.startContainer).Range&&(n=t),n}function R(e){if(!e.length||e[0].nodeType!=1)return!1;for(var t=1,n=e.length;t<n;++t)if(!i.isAncestorOf(e[0],e[t]))return!1;return!0}function U(e){var n=e.getNodes();if(!R(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function z(e){return!!e&&typeof e.text!="undefined"}function W(e,t){var n=new a(t);e._ranges=[n],j(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function X(t){t._ranges.length=0;if(t.docSelection.type=="None")I(t);else{var n=t.docSelection.createRange();if(z(n))W(t,n);else{t.rangeCount=n.length;var r,i=v(n.item(0));for(var s=0;s<t.rangeCount;++s)r=e.createRange(i),r.selectNode(n.item(s)),t._ranges.push(r);t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed,j(t,t._ranges[t.rangeCount-1],!1)}}}function V(e,n){var r=e.docSelection.createRange(),i=U(n),s=v(r.item(0)),o=m(s).createControlRange();for(var u=0,a=r.length;u<a;++u)o.add(r.item(u));try{o.add(i)}catch(f){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select(),X(e)}function J(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function K(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function G(e,t){var n=Q.length,r,i;while(n--){r=Q[n],i=r.selection;if(t=="deleteAll")K(i);else if(r.win==e)return t=="delete"?(Q.splice(n,1),!0):i}return t=="deleteAll"&&(Q.length=0),null}function et(e,n){var r=v(n[0].startContainer),i=m(r).createControlRange();for(var s=0,o,u=n.length;s<u;++s){o=U(n[s]);try{i.add(o)}catch(a){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),X(e)}function st(e,t){if(e.win.document!=v(t))throw new f("WRONG_DOCUMENT_ERR")}function ot(t){return function(n,r){var i;this.rangeCount?(i=this.getRangeAt(0),i["set"+(t?"Start":"End")](n,r)):(i=e.createRange(this.win.document),i.setStartAndEnd(n,r)),this.setSingleRange(i,this.isBackward())}}function ut(e){var t=[],n=new l(e.anchorNode,e.anchorOffset),r=new l(e.focusNode,e.focusOffset),i=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined")for(var s=0,o=e.rangeCount;s<o;++s)t[s]=u.inspect(e.getRangeAt(s));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.config.checkSelectionRanges=!0;var n="boolean",r="number",i=e.dom,s=e.util,o=s.isHostMethod,u=e.DomRange,a=e.WrappedRange,f=e.DOMException,l=i.DomPosition,c,h,p=e.features,d="Control",v=i.getDocument,m=i.getBody,g=u.rangesEqual,x=o(window,"getSelection"),T=s.isHostObject(document,"selection");p.implementsWinGetSelection=x,p.implementsDocSelection=T;var N=T&&(!x||e.config.preferTextRange);N?(c=E,e.isSelectionValid=function(e){var t=b(e,"isSelectionValid").document,n=t.selection;return n.type!="None"||v(n.createRange().parentElement())==t}):x?(c=w,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=c;var C=c(),k=e.createNativeRange(document),L=m(document),A=s.areHostProperties(C,["anchorNode","focusNode","anchorOffset","focusOffset"]);p.selectionHasAnchorAndFocus=A;var O=o(C,"extend");p.selectionHasExtend=O;var M=typeof C.rangeCount==r;p.selectionHasRangeCount=M;var _=!1,D=!0,P=O?function(t,n){var r=u.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.addRange(q(i)),t.extend(n.startContainer,n.startOffset)}:null;s.areHostMethods(C,["addRange","getRangeAt","removeAllRanges"])&&typeof C.rangeCount==r&&p.implementsDomRange&&function(){var t=window.getSelection();if(t){var n=t.rangeCount,r=n>1,i=[],s=S(t);for(var o=0;o<n;++o)i[o]=t.getRangeAt(o);var u=m(document),a=u.appendChild(document.createElement("div"));a.contentEditable="false";var f=a.appendChild(document.createTextNode("")),l=document.createRange();l.setStart(f,1),l.collapse(!0),t.addRange(l),D=t.rangeCount==1,t.removeAllRanges();if(!r){var c=l.cloneRange();l.setStart(f,0),c.setEnd(f,3),c.setStart(f,2),t.addRange(l),t.addRange(c),_=t.rangeCount==2,c.detach()}u.removeChild(a),t.removeAllRanges(),l.detach();for(o=0;o<n;++o)o==0&&s?P?P(t,i[o]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because browser does not support Selection.extend"),t.addRange(i[o])):t.addRange(i[o])}}(),p.selectionSupportsMultipleRanges=_,p.collapsedNonEditableSelectionsSupported=D;var H=!1,B;L&&o(L,"createControlRange")&&(B=L.createControlRange(),s.areHostProperties(B,["item","add"])&&(H=!0)),p.implementsControlRange=H,A?h=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:h=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var $;o(C,"getRangeAt")?$=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:A&&($=function(t){var n=v(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),J.prototype=e.selectionPrototype;var Q=[],Y=function(e){if(e&&e instanceof J)return e.refresh(),e;e=b(e,"getNativeSelection");var t=G(e),n=c(e),r=T?E(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh()):(t=new J(n,r,e),Q.push({win:e,selection:t})),t};e.getSelection=Y,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(i.getIframeWindow(n))};var Z=J.prototype;if(!N&&A&&s.areHostMethods(C,["removeAllRanges","addRange"])){Z.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),I(this)};var tt=function(e,t){P(e.nativeSelection,t),e.refresh()};M?Z.addRange=function(t,n){if(H&&T&&this.docSelection.type==d)V(this,t);else if(y(n)&&O)tt(this,t);else{var r;_?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(q(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==r+1){if(e.config.checkSelectionRanges){var i=$(this.nativeSelection,this.rangeCount-1);i&&!g(i,t)&&(t=new a(i))}this._ranges[this.rangeCount-1]=t,j(this,t,it(this.nativeSelection)),this.isCollapsed=h(this)}else this.refresh()}}:Z.addRange=function(e,t){y(t)&&O?tt(this,e):(this.nativeSelection.addRange(q(e)),this.refresh())},Z.setRanges=function(e){if(H&&e.length>1)et(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(o(C,"empty")&&o(k,"select")&&H&&N))return t.fail("No means of selecting a Range or TextRange was found"),!1;Z.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode)e=v(this.anchorNode);else if(this.docSelection.type==d){var t=this.docSelection.createRange();t.length&&(e=v(t.item(0)))}if(e){var n=m(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(r){}I(this)},Z.addRange=function(t){this.docSelection.type==d?V(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,j(this,t,!1))},Z.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?et(this,e):t&&this.addRange(e[0])}}Z.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new f("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var nt;if(N)nt=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=m(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==d?X(t):z(n)?W(t,n):I(t)};else if(o(C,"getRangeAt")&&typeof C.rangeCount==r)nt=function(t){if(H&&T&&t.docSelection.type==d)X(t);else{t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));j(t,t._ranges[t.rangeCount-1],it(t.nativeSelection)),t.isCollapsed=h(t)}else I(t)}};else{if(!A||typeof C.isCollapsed!=n||typeof k.collapsed!=n||!p.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;nt=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=$(n,0),e._ranges=[t],e.rangeCount=1,F(e),e.isCollapsed=h(e)):I(e)}}Z.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;nt(this);if(e){var i=t.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;while(i--)if(!g(t[i],this._ranges[i]))return!0;return!1}};var rt=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,i=n.length;r<i;++r)g(t,n[r])||e.addRange(n[r]);e.rangeCount||I(e)};H?Z.removeRange=function(e){if(this.docSelection.type==d){var t=this.docSelection.createRange(),n=U(e),r=v(t.item(0)),i=m(r).createControlRange(),s,o=!1;for(var u=0,a=t.length;u<a;++u)s=t.item(u),s!==n||o?i.add(t.item(u)):o=!0;i.select(),X(this)}else rt(this,e)}:Z.removeRange=function(e){rt(this,e)};var it;!N&&A&&p.implementsDomRange?(it=S,Z.isBackward=function(){return it(this)}):it=Z.isBackward=function(){return!1},Z.isBackwards=Z.isBackward,Z.toString=function(){var e=[];for(var t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},Z.collapse=function(t,n){st(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},Z.collapseToStart=function(){if(!this.rangeCount)throw new f("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},Z.collapseToEnd=function(){if(!this.rangeCount)throw new f("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},Z.selectAllChildren=function(t){st(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},Z.deleteFromDocument=function(){if(H&&T&&this.docSelection.type==d){var e=this.docSelection.createRange(),t;while(e.length)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,i=n.length;r<i;++r)n[r].deleteContents();this.addRange(n[i-1])}}},Z.eachRange=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(e(this.getRangeAt(n)))return t},Z.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},Z.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},Z.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(r){n.push(r[e].apply(r,t))}),n},Z.setStart=ot(!0),Z.setEnd=ot(!1),e.rangePrototype.select=function(e){Y(this.getDocument()).setSingleRange(this,e)},Z.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&t.length==1?this.addRange(t[0],"backward"):this.setRanges(t)},Z.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)},Z.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},Z.moveToBookmark=function(t){var n=[];for(var r=0,i,s;i=t.rangeBookmarks[r++];)s=e.createRange(this.win),s.moveToBookmark(i),n.push(s);t.backward?this.setSingleRange(n[0],"backward"):this.setRanges(n)},Z.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},Z.getName=function(){return"WrappedSelection"},Z.inspect=function(){return ut(this)},Z.detach=function(){G(this.win,"delete"),K(this)},J.detachAll=function(){G(null,"deleteAll")},J.inspect=ut,J.isDirectionBackward=y,e.Selection=J,e.selectionPrototype=Z,e.addCreateMissingNativeApiListener(function(e){typeof e.getSelection=="undefined"&&(e.getSelection=function(){return Y(e)}),e=null})}),define=e}(),define("external/rangy/rangy-core",function(e){return function(){var t,n;return n=function(){return this.rangy},t=n.apply(e,arguments),t||e.rangy}}(this)),rangy.createModule("SaveRestore",["WrappedRange"],function(e,t){function i(e,t){return(t||document).getElementById(e)}function s(e,t){var i="selectionBoundary_"+ +(new Date)+"_"+(""+Math.random()).slice(2),s,o=n.getDocument(e.startContainer),u=e.cloneRange();return u.collapse(t),s=o.createElement("span"),s.id=i,s.style.lineHeight="0",s.style.display="none",s.className="rangySelectionBoundary",s.appendChild(o.createTextNode(r)),u.insertNode(s),u.detach(),s}function o(e,n,r,s){var o=i(r,e);o?(n[s?"setStartBefore":"setEndBefore"](o),o.parentNode.removeChild(o)):t.warn("Marker element has been removed. Cannot restore selection.")}function u(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function a(t,n){var r,i,o=e.DomRange.getRangeDocument(t),u=t.toString();return t.collapsed?(i=s(t,!1),{document:o,markerId:i.id,collapsed:!0}):(i=s(t,!1),r=s(t,!0),{document:o,startMarkerId:r.id,endMarkerId:i.id,collapsed:!1,backward:n,toString:function(){return"original text: '"+u+"', new text: '"+t.toString()+"'"}})}function f(n,r){var s=n.document;typeof r=="undefined"&&(r=!0);var u=e.createRange(s);if(n.collapsed){var a=i(n.markerId,s);if(a){a.style.display="inline";var f=a.previousSibling;f&&f.nodeType==3?(a.parentNode.removeChild(a),u.collapseToPoint(f,f.length)):(u.collapseBefore(a),a.parentNode.removeChild(a))}else t.warn("Marker element has been removed. Cannot restore selection.")}else o(s,u,n.startMarkerId,!0),o(s,u,n.endMarkerId,!1);return r&&u.normalizeBoundaries(),u}function l(t,n){var r=[],s,o;t=t.slice(0),t.sort(u);for(var f=0,l=t.length;f<l;++f)r[f]=a(t[f],n);for(f=l-1;f>=0;--f)s=t[f],o=e.DomRange.getRangeDocument(s),s.collapsed?s.collapseAfter(i(r[f].markerId,o)):(s.setEndBefore(i(r[f].endMarkerId,o)),s.setStartAfter(i(r[f].startMarkerId,o)));return r}function c(n){if(!e.isSelectionValid(n))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var r=e.getSelection(n),i=r.getAllRanges(),s=i.length==1&&r.isBackward(),o=l(i,s);return s?r.setSingleRange(i[0],"backward"):r.setRanges(i),{win:n,rangeInfos:o,restored:!1}}function h(e){var t=[],n=e.length;for(var r=n-1;r>=0;r--)t[r]=f(e[r],!0);return t}function p(t,n){if(!t.restored){var r=t.rangeInfos,i=e.getSelection(t.win),s=h(r),o=r.length;o==1&&n&&e.features.selectionHasExtend&&r[0].backward?(i.removeAllRanges(),i.addRange(s[0],!0)):i.setRanges(s),t.restored=!0}}function d(e,t){var n=i(t,e);n&&n.parentNode.removeChild(n)}function v(e){var t=e.rangeInfos;for(var n=0,r=t.length,i;n<r;++n)i=t[n],i.collapsed?d(e.doc,i.markerId):(d(e.doc,i.startMarkerId),d(e.doc,i.endMarkerId))}var n=e.dom,r="";e.util.extend(e,{saveRange:a,restoreRange:f,saveRanges:l,restoreRanges:h,saveSelection:c,restoreSelection:p,removeMarkerElement:d,removeMarkers:v})}),define("external/rangy/rangy-selectionsaverestore",["external/rangy/rangy-core"],function(e){return function(){var t,n;return t||e.rangy.modules.SaveRestore}}(this)),define("rangy",["external/rangy/rangy-core","external/rangy/rangy-selectionsaverestore"],function(e,t){return e.init(),e}),define("wed/util",["require","exports","module"],function(e,t,n){function r(e,t){return Math.sqrt(e*e+t*t)}function i(e,t,n,i,s,o){var u=t-i,a=e-n,f=t-o,l=e-s,c=u<0,h=f>0,p=a<0,d=l>0,v=p?a:d?l:0,m=c?u:h?f:0;return r(v,m)}function s(e,t,n,r,i,s){var o=t-r,u=e-n,a=t-s,f=e-i,l=o<0,c=a>0,h=u<0,p=f>0,d=h?u:p?f:0,v=l?o:c?a:0;return{x:Math.abs(d),y:Math.abs(v)}}function o(e){return e.replace(/:/g,"\\:")}function u(e){return e.classList[0]}function a(e){return e==="*"?"._real":"."+o(e)+"._real"}function f(e){return e.slice(9).replace(/---/,":").replace(/---(-+)/g,"--$1")}function l(e){return"data-wed-"+e.replace(/--(-+)/g,"---$1").replace(/:/,"---")}function c(e){var t=Object.create(null),n=e.attributes;for(var r=0;r<n.length;++r){var i=n[r];i.localName.lastIndexOf("data-wed-",0)===0&&(t[f(i.localName)]=i.value)}return t}function p(){return"WED-ID-"+ ++h}function d(e){return e.altKey||e.ctrlKey||e.metaKey}function v(){window.selenium_log||(window.selenium_log=[]),window.selenium_log.push.apply(window.selenium_log,arguments)}function m(){var e=new Error;return e.stack?e.stack:g(e)}function g(e){try{throw e}catch(t){return t.stack}}var h=0;t.escapeCSSClass=o,t.getOriginalName=u,t.classFromOriginalName=a,t.decodeAttrName=f,t.encodeAttrName=l,t.getOriginalAttributes=c,t.newGenericID=p,t.anySpecialKeyHeld=d,t.distFromDeltas=r,t.distFromRect=i,t.distsFromRect=s,t.seleniumLog=v,t.stackTrace=m}),define("wed/domutil",["require","exports","module","jquery","rangy","./util"],function(e,t,n){function u(e){var t=i.getSelection(e);return t===undefined||t.rangeCount<1?undefined:t.getRangeAt(0)}function a(e,t,n,r){var s=i.createRange(e.ownerDocument),o=!1;return i.dom.comparePoints(e,t,n,r)<=0?(s.setStart(e,t),s.setEnd(n,r)):(s.setStart(n,r),s.setEnd(e,t),o=!0),{range:s,reversed:o}}function f(e){var t=e&&e.nodeType;switch(t){case Node.TEXT_NODE:e.parentNode.focus();break;case Node.ELEMENT_NODE:e.focus();break;default:throw new Error("tried to focus something other than a text node or an element.")}}function l(e,t,n){var r=e[0],i=e[1];n===undefined&&(n=!0);var s=!1,u=r.ownerDocument.defaultView,a;e:while(!s){a=r.parentNode;switch(r.nodeType){case Node.TEXT_NODE:if(i>=r.length||a.lastChild===r&&u.getComputedStyle(a,null).whiteSpace==="normal"&&/^\s+$/.test(r.data.slice(i))){if(t!==undefined&&r===t)break e;i=o.call(a.childNodes,r)+1,r=a}else i++,s=!0;break;case Node.ELEMENT_NODE:if(i>=r.childNodes.length){if(a===null||a===r.ownerDocument||t!==undefined&&r===t)break e;i=o.call(a.childNodes,r)+1,r=a,s=!0}else r=r.childNodes[i],i=0,r.childNodes.length>0&&r.childNodes[i].nodeType===Node.TEXT_NODE||(s=!0)}}return s?(a=r.parentNode,n&&r.nodeType===Node.TEXT_NODE?[a,o.call(a.childNodes,r)]:[r,i]):null}function c(e,t,n){var r=e[0],i=e[1];n===undefined&&(n=!0);var s=!1,u;e:while(!s){i--,u=r.parentNode;switch(r.nodeType){case Node.TEXT_NODE:if(i<0||u.firstChild===r&&window.getComputedStyle(u,null).whiteSpace==="normal"&&/^\s+$/.test(r.data.slice(0,i))){if(t!==undefined&&r===t)break e;i=o.call(u.childNodes,r),r=u}else s=!0;break;case Node.ELEMENT_NODE:if(i<0||r.childNodes.length===0){if(u===null||u===r.ownerDocument||t!==undefined&&r===t)break e;i=o.call(u.childNodes,r),r=u,s=!0}else r=r.childNodes[i],r.nodeType===Node.ELEMENT_NODE?(i=r.childNodes.length,r.childNodes.length>0&&r.childNodes[i-1].nodeType===Node.TEXT_NODE||(s=!0)):i=r.length+1}}return s?(u=r.parentNode,n&&r.nodeType===Node.TEXT_NODE?[u,o.call(u.childNodes,r)]:[r,i]):null}function h(e,t,n){var r=[],i=n;while(i!==e){var s=i.parentNode;if(!s)throw new Error("node_in_a is not tree_a or a child of tree_a");r.unshift(o.call(s.childNodes,i)),i=s}var u=t;while(r.length)u=u.childNodes[r.shift()];return u}function p(e){var t=document.createElement("span");return t.className="_placeholder",t.setAttribute("contenteditable","true"),t.innerHTML=e||" ",t}function d(e,t){var n=y(e,t,undefined,!1);return[n[0][0],n[1][0]]}function v(e,t,n){if(!n)throw new Error("must pass an actual node to insert");return m.apply(this,arguments)}function m(e,t,n,r){if(e.nodeType!==Node.TEXT_NODE)throw new Error("insertIntoText called on non-text");var i,s;r===undefined&&(r=!0),t<0?t=0:t>e.length&&(t=e.length);var u,a,f,l=n&&n.nodeType===Node.DOCUMENT_FRAGMENT_NODE,c=e.parentNode,h=o.call(c.childNodes,e);if(r&&(!n||l&&n.childNodes.length===0))i=s=[e,t];else{var p=document.createDocumentFragment();a=document.createTextNode(e.data.slice(0,t)),p.appendChild(a),n&&p.appendChild(n),f=document.createTextNode(e.data.slice(t));var d=f.length;p.appendChild(f),r&&p.normalize(),r&&t===0?i=[c,h]:i=[p.firstChild,t],r&&t===e.length?s=[c,h+p.childNodes.length]:s=[p.lastChild,p.lastChild.length-d],this.deleteNode(e);if(this.insertFragAt)this.insertFragAt(c,h,p);else while(p.firstChild)this.insertNodeAt(c,h++,p.firstChild)}return[i,s]}function w(e,t,n){if(n==="")return[undefined,undefined];var r;e:for(;;)switch(e.nodeType){case Node.ELEMENT_NODE:var i=e.childNodes[t];if(i&&i.nodeType===Node.TEXT_NODE){e=i,t=0;continue e}var s=e.childNodes[t-1];if(s&&s.nodeType===Node.TEXT_NODE){e=s,t=e.length;continue e}r=document.createTextNode(n),this.insertNodeAt(e,t,r),e=undefined;break e;case Node.TEXT_NODE:var o=e.data.slice(0,t),u=e.data.slice(t);this.setTextNodeValue(e,o+n+u),r=e;break e;default:throw new Error("unexpected node type: "+e.nodeType)}return[e,r]}function S(e,t,n){if(e.nodeType!==Node.TEXT_NODE)throw new Error("deleteText called on non-text");e.deleteData(t,n),e.length||e.parentNode.removeChild(e)}function x(e,t){r.data(e,"wed_mirror_node",t),r.data(t,"wed_mirror_node",e);if(e.nodeType===Node.ELEMENT_NODE)for(var n=0;n<e.childNodes.length;++n){var i=e.childNodes[n],s=t.childNodes[n];x(i,s)}}function T(e){r.removeData(e,"wed_mirror_node");if(e.nodeType===Node.ELEMENT_NODE)for(var t=0;t<e.childNodes.length;++t)T(e.childNodes[t])}function N(e){while(e&&e.childNodes&&e.childNodes.length)e=e.firstChild;return e}function C(e){e.parentNode.removeChild(e)}function k(e,t,n){e.insertBefore(n,e.childNodes[t]||null)}function L(e){var t=e.nextSibling;if(e.nodeType===Node.TEXT_NODE&&t&&t.nodeType===Node.TEXT_NODE){var n=e.length;return e.appendData(t.data),t.parentNode.removeChild(t),[e,n]}var r=e.parentNode;return[r,o.call(r.childNodes,e)+1]}function A(e,t){if(!M({startContainer:e[0],startOffset:e[1],endContainer:t[0],endOffset:t[1]}))throw new Error("range is not well-formed");var n=e[0],r=e[1],i=t[0],s=t[1],u=n.parentNode,a,f;n.nodeType===Node.TEXT_NODE&&r===0&&(r=o.call(u.childNodes,n),n=u,u=n.parent);if(n.nodeType===Node.TEXT_NODE){var l=n===i,c=o.call(u.childNodes,n),h=l?s:n.length;f=u.ownerDocument.createTextNode(n.data.slice(r,h)),this.deleteText(n,r,f.length),a=n.parentNode?[n,r]:[u,c];if(l)return[a,[f]];r=n.parentNode?c+1:c,n=u}else a=[n,r];var p;if(i.nodeType===Node.TEXT_NODE){u=i.parentNode;var d=o.call(u.childNodes,i);p=u.ownerDocument.createTextNode(i.data.slice(0,s)),this.deleteText(i,0,s),s=d,i=u}if(n!==i)throw new Error("internal error in cut: containers unequal");if(n.nodeType!==Node.ELEMENT_NODE)throw new Error("internal error in cut: not an element");var v=[];s--;while(s>=r)v.unshift(i.childNodes[s]),this.deleteNode(i.childNodes[s]),s--;return f&&v.unshift(f),p&&v.push(p),i.childNodes[s]&&this.mergeTextNodes(i.childNodes[s]),[a,v]}function O(e){var t;switch(e.startContainer.nodeType){case Node.TEXT_NODE:t=e.startContainer.parentNode;break;case Node.ELEMENT_NODE:t=e.startContainer;break;default:throw new Error("unexpected node type: "+e.startContainer.nodeType)}var n;switch(e.endContainer.nodeType){case Node.TEXT_NODE:n=e.endContainer.parentNode;break;case Node.ELEMENT_NODE:n=e.endContainer;break;default:throw new Error("unexpected node type: "+e.endContainer.nodeType)}return[t,n]}function M(e){var t=O(e);return t[0]===t[1]}function _(e,t){D(e,u(t))}function D(e,t){t?console.log(e,t.startContainer,t.startOffset,t.endContainer,t.endOffset):console.log(e,"no range")}function P(e,t){var n;return t?n=[e,t.startContainer.outerHTML,t.startOffset,t.endContainer.outerHTML,t.endOffset]:n=[e,"no range"],n.join(", ")}function H(e,t,n){var r=e.ownerDocument.body,i=e.getBoundingClientRect();return t-=i.left+r.scrollLeft,n-=i.top+r.scrollTop,t>=0&&n>=0&&t<e.clientWidth&&n<e.clientHeight}function B(e,t,n){if(e===undefined||e===null)return null;e.nodeType===Node.TEXT_NODE&&(e=e.parentNode);while(e){if(e.nodeType!==Node.ELEMENT_NODE)return null;if(e.matches(t))break;if(e===n){e=null;break}e=e.parentNode}return e}function j(e,t,n){if(e===undefined||e===null)return null;e.nodeType===Node.TEXT_NODE&&(e=e.parentNode);while(e){if(e.nodeType!==Node.ELEMENT_NODE)return null;if(e.classList.contains(t))break;if(e===n){e=null;break}e=e.parentNode}return e}function F(e,t){if(e===undefined||e===null||e.nodeType!==Node.ELEMENT_NODE)return null;var n=e.parentNode;if(!n)return null;var r=n.firstElementChild;while(r&&!r.classList.contains(t))r=r.nextElementSibling;return r}function I(e,t){if(e===undefined||e===null||e.nodeType!==Node.ELEMENT_NODE)return[];var n=[],r=e.firstElementChild;while(r)r.classList.contains(t)&&n.push(r),r=r.nextElementSibling;return n}function q(e,t){if(e===undefined||e===null||e.nodeType!==Node.ELEMENT_NODE)return null;var n=e.firstElementChild;while(n&&!n.classList.contains(t))n=n.nextElementSibling;return n}function U(e){return R||(R=document.createElement("span")),R.textContent=e,R.innerHTML}function X(e){if(/[\]['"()]/.test(e))throw new Error("selector is too complex");var t=e.split(W),n=[];for(var r=0;r<t.length;++r){var i=t[r];if(i.length)if(z.indexOf(i)>-1)n.push(i);else if(/[a-zA-Z]/.test(i[0])){i=i.trim();var o=i.split(/(.#)/);n.push(s.classFromOriginalName(o[0])),n=n.concat(o.slice(1))}else n.push(i)}return n.join("")}function V(e,t){var n=X(t),i=r.data(e,"wed_mirror_node"),s=i.querySelector(n);return r.data(s,"wed_mirror_node")}function $(e,t){var n=X(t),i=r.data(e,"wed_mirror_node"),s=i.querySelectorAll(n),o=[];for(var u=0,a;a=s[u];++u)o.push(r.data(a,"wed_mirror_node"));return o}function J(e,t){var n=t||window.document,r=n.createDocumentFragment(),i=n.createElement("div");return r.appendChild(i),i.innerHTML=e,Array.prototype.slice.call(i.childNodes)}function K(e){var t=e[0],n=e[1];switch(t.nodeType){case Node.TEXT_NODE:var r=t.data;return r[n-1];case Node.ELEMENT_NODE:var i=t[n-1];if(i&&i.nodeType===Node.TEXT_NODE)return i.value[i.value-1];break;default:throw new Error("unexpected node type: "+t.nodeType)}return undefined}function Q(e){var t=e[0],n=e[1];switch(t.nodeType){case Node.TEXT_NODE:var r=t.data;return r[n];case Node.ELEMENT_NODE:var i=t[n];if(i&&i.nodeType===Node.TEXT_NODE)return i.value[0];break;default:throw new Error("unexpected node type: "+t.nodeType)}return undefined}var r=e("jquery"),i=e("rangy"),s=e("./util"),o=Array.prototype.indexOf,g={insertNodeAt:k,insertFragAt:k,deleteNode:C},y=m.bind(g),b=v.bind(g),E=w.bind({insertNodeAt:k,setTextNodeValue:function(e,t){e.data=t}}),R,z=",>+~ ",W=new RegExp("(["+z+"]+)");t.getSelectionRange=u,t.nextCaretPosition=l,t.prevCaretPosition=c,t.makePlaceholder=p,t.splitTextNode=d,t.insertIntoText=b,t.insertText=E,t.deleteText=S,t.linkTrees=x,t.unlinkTree=T,t.firstDescendantOrSelf=N,t.isWellFormedRange=M,t.genericCutFunction=A,t.genericInsertIntoText=v,t.genericInsertText=w,t.deleteNode=C,t.mergeTextNodes=L,t.rangeFromPoints=a,t.focusNode=f,t.dumpCurrentSelection=_,t.dumpRange=D,t.dumpRangeToString=P,t.pointInContents=H,t.correspondingNode=h,t.closest=B,t.closestByClass=j,t.siblingByClass=F,t.childrenByClass=I,t.childByClass=q,t.textToHTML=U,t.toGUISelector=X,t.dataFind=V,t.dataFindAll=$,t.htmlToElements=J,t.getCharacterImmediatelyAt=Q,t.getCharacterImmediatelyBefore=K}),define("wed/oop",["require","exports","module"],function(e,t,n){function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e}function i(e,t){var n=t.prototype!==undefined?t.prototype:t;for(var r in n)e.prototype[r]=n[r]}t.inherit=r,t.implement=i}),define("wed/undo",["require","exports","module","./oop"],function(e,t,n){function i(){this._stack=[],this._list=[],this._index=-1,this._undoing_or_redoing=!1}function s(e){this._desc=e}function o(){s.apply(this,arguments),this._list=[]}var r=e("./oop");i.prototype.record=function(e){this._stack.length>0?this._stack[0].record(e):(this._list=this._list.splice(0,this._index+1),this._list.push(e),this._index++)},i.prototype.undo=function(){if(this._undoing_or_redoing)throw new Error("calling undo while undoing or redoing");this._undoing_or_redoing=!0;while(this._stack.length>0)this.endGroup();this._index>=0&&this._list[this._index--].undo(),this._undoing_or_redoing=!1},i.prototype.redo=function(){if(this._undoing_or_redoing)throw new Error("calling redo while undoing or redoing");this._undoing_or_redoing=!0,this._index<this._list.length-1&&this._list[++this._index].redo(),this._undoing_or_redoing=!1},i.prototype.undoingOrRedoing=function(){return this._undoing_or_redoing},i.prototype.canUndo=function(){return this._index>-1},i.prototype.canRedo=function(){return this._index<this._list.length-1},i.prototype.startGroup=function(e){this._stack.unshift(e)},i.prototype.endGroup=function(){if(this._stack.length===0)throw new Error("ending a non-existent group.");var e=this._stack.shift();e.end(),this.record(e)},i.prototype.endAllGroups=function(){while(this._stack.length>0)this.endGroup()},i.prototype.getGroup=function(){return this._stack[0]},i.prototype.toString=function(){var e=[];e.push("Start of list\n");for(var t=0,n;(n=this._list[t])!==undefined;++t)e.push(n.toString());e.push("End of list\n"),e.push("Unfinished groups:\n");for(t=this._stack.length-1;(n=this._stack[t])!==undefined;--t)e.push(n.toString());return e.push("End of unfinished groups\n"),e.join("")},t.UndoList=i,s.prototype.undo=function(){throw new Error("must override the undo method.")},s.prototype.redo=function(){throw new Error("must override the redo method.")},s.prototype.toString=function(){return this._desc+"\n"},t.Undo=s,r.inherit(o,s),o.prototype.undo=function(){for(var e=this._list.length-1;e>=0;--e)this._list[e].undo()},o.prototype.redo=function(){for(var e=0;e<this._list.length;++e)this._list[e].redo()},o.prototype.record=function(e){this._list.push(e)},o.prototype.end=function(){},o.prototype.toString=function(){var e=[];e.push("Start of ",this._desc,"\n");for(var t=0,n;(n=this._list[t])!==undefined;++t)e.push(n.toString().replace(/(^|\n)/g,"$1 ").slice(0,-1));return e.push("End of ",this._desc,"\n"),e.join("")},t.UndoGroup=o}),define("wed/wundo",["require","exports","module","./oop","./undo","./domutil"],function(e,t,n){function o(e,t){i.UndoGroup.call(this,e),this._editor=t,this._caret_as_path_before=this.getDataCaretAsPath()}function u(e,t,n,r){o.call(this,e,t),this._undo_list=n,this._limit=r}function a(e){i.Undo.call(this,"*** MARKER *** "+e)}var r=e("./oop"),i=e("./undo"),s=e("./domutil");r.inherit(o,i.UndoGroup),o.prototype.undo=function(){i.UndoGroup.prototype.undo.apply(this,arguments),this.setDataCaretAsPath(this._caret_as_path_before)},o.prototype.redo=function(){i.UndoGroup.prototype.redo.apply(this,arguments),this.setDataCaretAsPath(this._caret_as_path_after)},o.prototype.getDataCaretAsPath=function(){var e=this._editor.getDataCaret(!0);return e?[this._editor.data_updater.nodeToPath(e.node),e.offset]:[undefined,undefined]},o.prototype.setDataCaretAsPath=function(e){if(!e[0]&&!e[1])return;this._editor.setDataCaret(this._editor.data_updater.pathToNode(e[0]),e[1])},o.prototype.recordCaretAfter=function(){this._caret_as_path_after=this.getDataCaretAsPath()},o.prototype.end=function(){this._caret_as_path_after||this.recordCaretAfter()},t.UndoGroup=o,r.inherit(u,o),u.prototype.record=function(){if(this._list.length>=this._limit)throw new Error("TextUndoGroup.record called beyond the limit");i.UndoGroup.prototype.record.apply(this,arguments),this._list.length===this._limit&&this._undo_list.endGroup()},t.TextUndoGroup=u,r.inherit(a,i.Undo),a.prototype.undo=function(){},a.prototype.redo=function(){},t.MarkerUndo=a}),define("wed/lib/simple_event_emitter",["require","exports","module"],function(e,t,n){function r(){this._event_listeners={},this._simple_event_emitter_trace=!1}r.prototype.addEventListener=function(e,t){var n=this._event_listeners[e];n===undefined&&(n=this._event_listeners[e]=[]),n.push(t)},r.prototype.addOneTimeEventListener=function(e,t){var n=function(r){return this.removeEventListener(e,n),t(r)}.bind(this);return this.addEventListener(e,n),n},r.prototype.removeEventListener=function(e,t){var n=this._event_listeners[e];if(n===undefined)return;var r=n.lastIndexOf(t);r!==-1&&n.splice(r,1)},r.prototype.removeAllListeners=function(e){this._event_listeners[e]=[]},r.prototype._emit=function(e,t){this._simple_event_emitter_trace&&console.log("simple_event_emitter emitting:",e,"with:",t);var n,r,i=this._event_listeners["*"];if(i&&i.length>0){i=i.slice();for(n=0;n<i.length;++n){r=i[n](e,t);if(r===!1)return}}i=this._event_listeners[e];if(i&&i.length>0){i=i.slice();for(n=0;n<i.length;++n){r=i[n](t);if(r===!1)return}}},t.SimpleEventEmitter=r}),define("wed/lib/conditioned",["require","exports","module"],function(e,t,n){function r(){this._conditions={}}r.prototype._setCondition=function(e,t){this._conditions[e]===undefined&&(this._conditions[e]=!0,this._emit(e,t))},r.prototype.getCondition=function(e){return this._conditions[e]},r.prototype.whenCondition=function(e,t){this._conditions[e]?t():this.addOneTimeEventListener(e,t)},t.Conditioned=r}),define("wed/exceptions",["require","exports","module","./oop"],function(e,t,n){function i(){Error.apply(this,arguments)}var r=e("./oop");r.inherit(i,Error),t.AbortTransformationException=i}),define("wed/onerror",["require","exports","module","./log","jquery"],function(e,t,n){function f(){d=!1,v&&(m.clearTimeout(v),v=undefined),a.off(),a.remove()}function l(){return d}function c(e){g(e)}function g(e){function r(e,r,s){function g(){v&&t.clearTimeout(v);if(f===1)c.push(y(undefined,l[0]?l[0][1]:undefined));else for(var e=0,n;(n=l[e])!==undefined;++e)c.push(y(h[n[0]].name,n[1]));u(document.body).append(a),a.find(".modal-body").contents().replaceWith(c.join("")),a.on("hide.bs.modal.modal",function(){a.remove(),t.location.reload()}),a.modal()}function b(e){l.push([this,e]),l.length===f&&g()}if(d)return!1;d=!0;var f=h.length,l=[],c=[];v=t.setTimeout(g,p),m=t,o.error(e,r,s);try{n&&!i&&n.apply(undefined,arguments)}finally{for(var w=0,E;(E=h[w])!==undefined;++w){var S=E._saver;S&&S.recover(b.bind(w))}return!1}}var t=e;while(t!==t.parent)t=t.parent;t!==e&&g(t);if(e.wed_installed_onerror===e.onerror)return;var n=e.onerror;e.onerror=r,e.wed_installed_onerror=r}function y(e,t){var n=["<p>",e||"Your editor"];n.push(" experienced a severe error.");switch(t){case!0:n.push(" However, it successfully saved the latest state of your data to the server. Please reload.");break;case!1:case undefined:n.push(" It was not able to save your data to the server before terminating.")}return n.push("</p>"),n.join("")}var r=n.config(),i=r&&r.suppress_old_onerror,s=r&&r.test,o=e("./log"),u=e("jquery"),a=u('<div class="modal wed-fatal-modal" style="position: absolute" tabindex="1">  <div class="modal-dialog">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal"aria-hidden="true">&times;</button>        <h3>Fatal Error</h3>      </div>      <div class="modal-body">      </div>      <div class="modal-footer">        <a href="#" class="btn btn-primary" data-dismiss="modal">Reload</a>      </div>    </div>  </div></div>');t.is_terminating=l,s&&(t.__test={$modal:a,reset:f}),g(window),t.register=c;var h=[],p=5e3,d=!1,v,m;t.editors=h}),define("wed/browsers",["require","exports","module"],function(e,t,n){var r=navigator.userAgent.indexOf(" Chrome/31.")!==-1;t.CHROME_31=r;var i=navigator.userAgent.indexOf(" Chrome/37.")!==-1;t.CHROME_37=i;var s=navigator.userAgent.indexOf(" Chrome/")!==-1;t.CHROME=s;var o=navigator.userAgent.indexOf(" MSIE ")!==-1;t.MSIE_TO_10=o;var u=" like Gecko",a=navigator.userAgent.indexOf(u,navigator.userAgent.length-u.length)!==-1;t.MSIE_11_AND_UP=a;var f=a||o;t.MSIE=f;var l=navigator.userAgent.indexOf(" Firefox/")!==-1;t.FIREFOX=l;var c=navigator.userAgent.indexOf(" Firefox/24")!==-1;t.FIREFOX_24=c;var h=navigator.userAgent.indexOf(" Gecko/")!==-1;t.GECKO=h;var p=navigator.platform.lastIndexOf("Mac",0)===0;t.OSX=p;var d=navigator.platform==="Win32";t.WINDOWS=d}),define("wed/key",["require","exports","module","./browsers"],function(e,t,n){function s(e,t,n,r,o,u,a){t=!!t,o=!!o,u=!!u,a=!!a;var f=[e,n,r,o,u,a,t].join(","),l=s.__cache[f];return l!==undefined?l:(this.which=e,this.keyCode=n,this.charCode=r,this.ctrlKey=o,this.altKey=u,this.metaKey=a,this.keypress=t,this.hash_key=f,this._id=i++,s.__cache[f]=this,this)}function o(e){return f(e,!1,undefined,undefined,!0,!1,!1)}function u(e){return f(e,!1,undefined,undefined,!1,!1,!0)}function a(e){return r.OSX?u(e):o(e)}function f(e,t,n,i,o,u,a){if(typeof e=="string"){if(e.length!==1)throw new Error("when the first parameter is a string, a one-character string is required");e=e.charCodeAt(0)}else if(typeof e!="number")throw new Error("the first parameter must be a string or number");t===undefined?t=!0:t=!!t;if(n===undefined||n===null)n=t&&r.GECKO?0:e;if(i===undefined||i===null)i=t?e:0;return o=!!o,u=!!u,a=!!a,new s(e,t,n,i,o,u,a)}var r=e("./browsers"),i=0;s.__cache={},s.prototype.matchesEvent=function(e){return e.which===this.which&&e.keyCode===this.keyCode&&e.charCode===this.charCode&&e.ctrlKey===this.ctrlKey&&e.altKey===this.altKey&&e.metaKey===this.metaKey&&(this.keypress?e.type==="keypress":e.type==="keydown"||e.type==="keyup")},s.prototype.setEventToMatch=function(e){e.which=this.which,e.keyCode=this.keyCode,e.charCode=this.charCode,e.ctrlKey=this.ctrlKey,e.altKey=this.altKey,e.metaKey=this.metaKey,this.keypress?e.type="keypress":e.type="keydown"},s.prototype.hash=function(){return this._id},s.prototype.anyModifier=function(){return this.ctrlKey||this.altKey||this.metaKey},t.makeKey=f,t.makeCtrlKey=o,t.makeMetaKey=u,t.makeCtrlEqKey=a,t.Key=s}),define("wed/wed_core",["require","exports","module","jquery","./log","./domutil","./oop","./wundo","./lib/simple_event_emitter","./lib/conditioned","./exceptions","./onerror","./key","bootstrap","jquery.bootstrap-growl"],function(e,t,n){function g(){a.call(this),f.call(this),this._mode_data={},this._development_mode=!1,this._text_undo_max_length=10,c.editors.push(this)}var r=e("jquery"),i=e("./log"),s=e("./domutil"),o=e("./oop"),u=e("./wundo"),a=e("./lib/simple_event_emitter").SimpleEventEmitter,f=e("./lib/conditioned").Conditioned,l=e("./exceptions"),c=e("./onerror"),h=e("./key"),p=l.AbortTransformationException;e("bootstrap"),e("jquery.bootstrap-growl");var d=s.closestByClass,v=Array.prototype.indexOf;t.version="0.24.0";var m=t.version;o.implement(g,a),o.implement(g,f),g.prototype.fireTransformation=function(e,t){this._dismissDropdownMenu();var n=this._undo.getGroup();n instanceof u.TextUndoGroup&&this._undo.endGroup();var r=new u.UndoGroup("Undo "+e.getDescriptionFor(t),this);this._undo.startGroup(r),this._inhibitFakeCaret();try{try{this._fireTransformation(e,t)}catch(s){throw s instanceof p||i.handle(s),s}finally{do n=this._undo.getGroup(),this._undo.endGroup();while(n!==r)}}catch(s){this.undo();if(!(s instanceof p))throw s}finally{this._uninhibitFakeCaret(),this._refreshValidationErrors()}},g.prototype._fireTransformation=function(e,t){var n=t.node;if(n!==undefined)if(this.gui_root.contains(n)){var r=this.nodeToPath(n);t.node=this.data_updater.pathToNode(r)}else{var i=n.nodeType===Node.ATTRIBUTE_NODE?n.ownerElement:n;if(!this.data_root.contains(i))throw new Error("node is neither in the gui tree nor the data tree")}var s=t.move_caret_to;if(s)switch(s.root){case this.gui_root:this.setGUICaret(s);break;case this.data_root:this.setDataCaret(s);break;default:throw new Error("caret outside GUI and data trees")}if(this._sel_focus===undefined)throw new Error("transformation applied with undefined caret.");e.handler(this,t)},g.prototype.recordUndo=function(e){this._undo.record(e)},g.prototype.undo=function(){this._undo_recorder.suppressRecording(!0),this._undo.undo(),this._undo_recorder.suppressRecording(!1)},g.prototype.redo=function(){this._undo_recorder.suppressRecording(!0),this._undo.redo(),this._undo_recorder.suppressRecording(!1)},g.prototype.dumpUndo=function(){console.log(this._undo.toString())},g.prototype.undoMarker=function(e){this.recordUndo(new u.MarkerUndo(e))},g.prototype.undoingOrRedoing=function(){return this._undo.undoingOrRedoing()},g.prototype.isAttrProtected=function(e,t){var n;if(e instanceof this.my_window.Attr)n=e.name;else if(e instanceof this.my_window.Element)n=s.siblingByClass(e,"_attribute_name").textContent;else if(typeof e=="string"){n=e;if(!t)throw new Error("must specify a parent")}return n==="xmlns"||n.lastIndexOf("xmlns:",0)===0},g.prototype.save=function(e){this._saver.save(e)},g.prototype._initiateTextUndo=function(){var e=this._undo.getGroup();if(e===undefined||!(e instanceof u.TextUndoGroup))e=new u.TextUndoGroup("text",this,this._undo,this._text_undo_max_length),this._undo.startGroup(e);return e},g.prototype._terminateTextUndo=function(){var e=this._undo.getGroup();e instanceof u.TextUndoGroup&&this._undo.endGroup()},g.prototype._normalizeEnteredText=function(e){return this._normalize_entered_spaces?e.replace(this._stripped_spaces,"").replace(this._replaced_spaces," "):e},g.prototype._compensateForAdjacentSpaces=function(e,t){if(!this._normalize_entered_spaces)return e;var n=t.toArray();return e[0]===" "&&s.getCharacterImmediatelyBefore(n)===" "&&(e=e.slice(1)),e&&e[e.length-1]===" "&&s.getCharacterImmediatelyAt(n)===" "&&(e=e.slice(-1)),e},g.prototype._insertText=function(e){this._closeAllTooltips(),e=this._normalizeEnteredText(e);if(e==="")return;var t=this._sel_focus;if(t===undefined)return;var n=d(t.node,"_attribute_value",this.gui_root);if(!n){t=this.getDataCaret(),e=this._compensateForAdjacentSpaces(e,t);if(e==="")return;var r=this._initiateTextUndo(),i=this.data_updater.insertText(t,e),s=i[0];if(s===undefined)this.setDataCaret(i[1],e.length,!0);else{var o;s===t.node?o=t.offset+e.length:t.node.childNodes[t.offset]===s?o=e.length:o=s.nodeValue.length,this.setDataCaret(s,o,!0)}r.recordCaretAfter()}else this._spliceAttribute(n,t.offset,0,e);this._refreshValidationErrors()},g.prototype._spliceAttribute=function(e,t,n,i){if(t<0)return;if(this.isAttrProtected(e))return;var o=this.toDataNode(e).value;if(t>o.length)return;if(t===o.length&&n>0)return;this._normalize_entered_spaces&&(i[0]===" "&&o[t-1]===" "&&(i=i.slice(1)),i[i.length-1]===" "&&o[t+n]===" "&&(i=i.slice(-1)));var u=this._initiateTextUndo();o=o.slice(0,t)+i+o.slice(t+n),t+=i.length;var a=r.data(d(e,"_real"),"wed_mirror_node"),f=this.nodeToPath(e),l=s.siblingByClass(e,"_attribute_name").textContent;this.data_updater.setAttribute(a,l,o);var c=this.pathToNode(f);c.firstChild&&(c=c.firstChild),this._setGUICaret(c,t,"text_edit"),u.recordCaretAfter()},g.prototype.insertTransientPlaceholderAt=function(e){var t=r("<span class='_placeholder _transient' contenteditable='false'> </span>",e.node.ownerDocument)[0];return this._gui_updater.insertNodeAt(e,t),t},g.prototype.toDataNode=function(e){return this.data_updater.pathToNode(this.nodeToPath(e))},g.prototype._onSaverSaved=function(){r.bootstrapGrowl("Saved",{ele:"body",type:"success",align:"center"}),this._refreshSaveStatus(),this._emit("saved")},g.prototype._onSaverAutosaved=function(){r.bootstrapGrowl("Autosaved",{ele:"body",type:"success",align:"center"}),this._refreshSaveStatus(),this._emit("autosaved")},g.prototype._onSaverChanged=function(){this._refreshSaveStatus()},g.prototype._onSaverFailed=function(e){this._refreshSaveStatus();var t=this;e.type==="save_disconnected"?this._disconnect_modal.modal(function(){t.save()}):e.type==="save_edited"?this._edited_by_other_modal.modal(function(){t.my_window.location.reload()}):r.bootstrapGrowl("Failed to save!\n"+e.msg,{ele:"body",type:"danger",align:"center"})},g.prototype._onSaverTooOld=function(){this._too_old_modal.modal(this.my_window.location.reload.bind(this.my_window.location))},g.prototype.nodeToPath=function(e){return this.gui_dloc_root.nodeToPath(e)},g.prototype.pathToNode=function(e){return this.gui_dloc_root.pathToNode(e)},g.prototype.getModeData=function(e){return this._mode_data[e]},g.prototype.setModeData=function(e,t){this._mode_data[e]=t},g.prototype.destroy=function(){this._destroying=!0;if(this._destroyed)return;var e=c.editors.indexOf(this);e>=0&&c.editors.splice(e,1),this._saver&&this._saver.setAutosaveInterval(0),this._save_status_interval&&clearInterval(this._save_status_interval);try{this.validator&&this.validator.stop()}catch(t){i.unhandled(t)}try{this.domlistener!==undefined&&(this.domlistener.stopListening(),this.domlistener.clearPending())}catch(t){i.unhandled(t)}this._current_dropdown&&this._current_dropdown.dismiss();try{this.$widget.empty(),this.$frame.find("*").off(".wed"),r(this.my_window).off(".wed")}catch(t){i.unhandled(t)}var n=Object.keys(this);for(var s=0,o;(o=n[s])!==undefined;++s)delete this[o];this._destroyed=!0,this.destroy=function(){}},t.Editor=g}),define("wed/dloc",["require","exports","module","jquery","rangy","./domutil","./oop"],function(e,t,n){function u(){throw new Error("use makeDLoc to create DLoc objects")}function a(e){var t;switch(e.nodeType){case Node.ATTRIBUTE_NODE:t=e.value.length;break;case Node.TEXT_NODE:t=e.data.length;break;case Node.ELEMENT_NODE:t=e.childNodes.length;break;default:throw new Error("unexpected node type")}return t}function f(e,t,n){this.root=e,this.node=t,this.offset=n}function l(e,t,n,i){t instanceof Array&&(i=n,n=t[1],t=t[0]);if(!t)return undefined;if(n<0){if(!i)throw new Error("negative offsets are not allowed");n=0}if(e instanceof p)e=e.node;else if(!r.data(e,"wed-dloc-root"))throw new Error("root has not been marked as a root: "+e);if(t.nodeType===Node.ATTRIBUTE_NODE){if(!e.contains(t.ownerElement))throw new Error("node not in root")}else if(!e.contains(t))throw new Error("node not in root");var s=a(t);if(n>s){if(!i)throw new Error("offset greater than allowable value");n=s}return new f(e,t,n)}function c(e){while(e){var t=r.data(e,"wed-dloc-root");if(t)return t;e=e.parentNode}return undefined}function h(e){var t=c(e);if(!t)throw new Error("no root found");return t}function p(e){if(r.data(e,"wed-dloc-root"))throw new Error("node already marked as root");r.data(e,"wed-dloc-root",this),this.node=e}var r=e("jquery"),i=e("rangy"),s=e("./domutil"),o=e("./oop");u.prototype.clone=function(){return new f(this.root,this.node,this.offset)},u.prototype.make=function(e,t){return l(this.root,e,t)},u.prototype.toArray=function(){return[this.node,this.offset]},u.prototype.makeRange=function(e){if(this.node.nodeType===Node.ATTRIBUTE_NODE)throw new Error("cannot make range from attribute node");if(!e){var t=i.createRange(this.node.ownerDocument);return t.setStart(this.node,this.offset),t}if(e.node.nodeType===Node.ATTRIBUTE_NODE)throw new Error("cannot make range from attribute node");return s.rangeFromPoints(this.node,this.offset,e.node,e.offset)},u.prototype.isValid=function(){var e=this.node;return this.root.contains(e.nodeType===Node.ATTRIBUTE_NODE?e.ownerElement:e)&&this.offset<=a(e)},u.prototype.normalizeOffset=function(){var e=this.node,t=a(e);return this.offset>t?this.make(e,t):this},o.inherit(f,u),p.prototype.nodeToPath=function(e){if(e===null||e===undefined)throw new Error("invalid node parameter");var t=this.node;if(t===e)return"";var n=e;e.nodeType===Node.ATTRIBUTE_NODE&&(n=e.ownerElement);if(!t.contains(n))throw new Error("node is not a descendant of root");var r=[];while(e!==t){var i;if(e.nodeType===Node.ATTRIBUTE_NODE)i=e.ownerElement,r.unshift("@"+e.name);else{var s,o=0,u;i=e.parentNode;var a=e.previousSibling;while(a){var f=a.nodeType;(f===Node.TEXT_NODE||f===Node.ELEMENT_NODE)&&o++,a=a.previousSibling}r.unshift(""+o)}e=i}return r.join("/")},p.prototype.pathToNode=function(e){var t=this.node;if(e==="")return t;var n=e.split(/\//),r=t,i;n[n.length-1][0]==="@"&&(i=n.pop());for(var s=0,o;(o=n[s])!==undefined;++s){if(!/^(\d+)$/.test(o))throw new Error("malformed path expression");var u=o>>0,a=null,f=r.firstChild;while(f&&!a){var l=f.nodeType;(l===Node.TEXT_NODE||l===Node.ELEMENT_NODE)&&--u<0&&(a=f),f=f.nextSibling}if(!a)return null;r=a}return i&&(r=r.getAttributeNode(i.slice(1))),r},t.makeDLoc=l,t.DLoc=u,t.findRoot=c,t.getRoot=h,t.DLocRoot=p}),define("wed/wed_util",["require","exports","module","./dloc","./domutil"],function(e,t,n){function u(e){var t=e.node,n=e.offset,i=t.nodeType;if(i===Node.ELEMENT_NODE&&t.childNodes.length===0||i===Node.TEXT_NODE&&t.length===0){var s=t.parentNode;return u(r(e.root,s,o.call(s.childNodes,t)))}var a=t.ownerDocument.createRange(),f;return i===Node.ELEMENT_NODE&&n<t.childNodes.length||i===Node.TEXT_NODE&&n<t.length?(a.setStart(t,n),a.setEnd(t,n+1),f=a.getBoundingClientRect(),{left:f.left,top:f.top}):(a.setStart(t,n-1),a.setEnd(t,n),f=a.getBoundingClientRect(),{left:f.right,top:f.top})}function a(e){if(!e.classList||!e.classList.contains("_attribute_value"))throw new Error("getAttrValueNode operates only on attribute values");var t=e,n=e.firstChild;if(n){while(n&&n.nodeType!==Node.TEXT_NODE)n=n.nextSibling;n&&(t=n)}return t}function f(e,t){var n=e._getDOMSelectionRange();if(!i.isWellFormedRange(n))throw new Error("malformed range");var r=e.toDataLocation(n.startContainer,n.startOffset),o=e.toDataLocation(n.endContainer,n.endOffset);while(e._cut_buffer.firstChild)e._cut_buffer.removeChild(e._cut_buffer.firstChild);if(r.node instanceof e.my_window.Attr){var u=r.node;if(u!==o.node)throw new Error("attribute selection that does not start and end in the same attribute");var a=u.value.slice(r.offset,o.offset);e._spliceAttribute(s(e.fromDataLocation(r).node,"_attribute_value",n.startContainer),r.offset,o.offset-r.offset,""),e._cut_buffer.textContent=a}else{var f=e.data_updater.cut(r,o),l=f[1],c=new e.my_window.DOMParser,h=c.parseFromString("<div></div>","text/xml");for(var p=0,d=l.length;p<d;++p)h.firstChild.appendChild(l[p]);e._cut_buffer.textContent=h.firstChild.innerHTML,e.setDataCaret(f[0])}n=e.doc.createRange();var v=e._cut_buffer;n.setStart(v,0),n.setEnd(v,v.childNodes.length);var m=e.my_window.getSelection();m.removeAllRanges(),m.addRange(n),setTimeout(function(){e._focusInputField()},0)}function l(e,t){var n=t.to_paste,r=n.cloneNode(!0),i=e.getDataCaret(),u,a;if(n.childNodes.length===1&&n.firstChild.nodeType===Node.TEXT_NODE)if(i.node.nodeType===Node.ATTRIBUTE_NODE){var f=e.getGUICaret();e._spliceAttribute(s(f.node,"_attribute_value",f.node),f.offset,0,n.firstChild.data)}else a=e.data_updater.insertText(i,n.firstChild.data),u=a[0]===a[1]&&a[1]===i.node?i.make(i.node,i.offset+n.firstChild.length):i.make(a[1],a[1].length);else{var l=document.createDocumentFragment();while(n.firstChild)l.appendChild(n.firstChild);switch(i.node.nodeType){case Node.TEXT_NODE:var c=i.node.parentNode;a=e.data_updater.insertIntoText(i,l),u=a[1];break;case Node.ELEMENT_NODE:var h=i.node.childNodes[i.offset],p=h?h.nextSibling:null;e.data_updater.insertBefore(i.node,l,h),u=i.make(i.node,p?o.call(i.node.childNodes,p):i.node.childNodes.length);break;default:throw new Error("unexpected node type: "+i.node.nodeType)}}u&&(e.setDataCaret(u),i=u),e.$gui_root.trigger("wed-post-paste",[t.e,i,r])}var r=e("./dloc").makeDLoc,i=e("./domutil"),s=i.closestByClass,o=Array.prototype.indexOf;t.boundaryXY=u,t.getAttrValueNode=a,t.cut=f,t.paste=l}),define("wed/build-info",[],function(){return{desc:"v0.24.0-2-g25b0c28-unclean",date:"Thu Apr 23 2015 10:01:53 GMT-0400 (EDT)"}}),define("wed/object_check",["require","exports","module"],function(e,t,n){function r(e,t){var n=e[t];if(n instanceof Array||typeof n!="object")return n;for(var i in n)if(r(n,i))return!0;return!1}function i(e,t){var n={missing:[],extra:[]};s(e,t,undefined,n);for(var r in n)n[r].length||delete n[r];return n}function s(e,t,n,i){var o,u;for(o in e)if(r(e,o)){u=n?[n,o].join("."):o;if(o in t){var a=t[o],f=e[o];!(a instanceof Array)&&typeof a=="object"&&typeof f=="object"&&s(f,a,u,i)}else i.missing.push(u)}for(o in t)o in e||(u=n?[n,o].join("."):o,i.extra.push(u))}t.check=i}),define("wed/preferences",["require","exports","module","lodash","./object_check"],function(e,t,n){function o(e){if(!e){this._prefs=Object.create(null),this._validatePrefs(this._prefs);return}this._validatePrefs(e),this._prefs=r.extend(Object.create(null),e)}var r=e("lodash"),i=e("./object_check"),s={tooltips:!1};o.prototype._validatePrefs=function(e){var t=i.check(s,e);if(t.missing)throw new Error("missing option: "+t.missing[0]);if(t.extra)throw new Error("extra option: "+t.extra[0])},o.prototype.get=function(e){var t=e.split("."),n=0,r=this._prefs;while(n<t.length){var i=t[n];if(i==="")throw new Error("empty part in "+e);r=r[i];if(r===undefined)return undefined;++n}return r},o.prototype.set=function(e,t){var n=e.split("."),r=0,i=this._prefs;while(r<n.length-1){var s=n[r];if(s==="")throw new Error("empty part in "+e);i=i[s],i===undefined&&(i=i[s]=Object.create(null)),++r}i[n[r]]=t,this._validatePrefs(this._prefs)},t.Preferences=o}),define("wed/guiroot",["require","exports","module","./oop","./dloc","./util","./domutil"],function(e,t,n){function f(e){i.DLocRoot.call(this,e)}var r=e("./oop"),i=e("./dloc"),s=e("./util"),o=e("./domutil"),u=o.closestByClass,a=Array.prototype.indexOf;r.inherit(f,i.DLocRoot),f.prototype.nodeToPath=function(e){var t=this.node;if(e===null||e===undefined)throw new Error("invalid node parameter");if(u(e,"_placeholder",t))throw new Error("cannot provide path to node because it is a placeholder node");if(t===e)return"";if(!t.contains(e))throw new Error("node is not a descendant of root");var n=[];while(e!==t){var r,i,s,f=0,l;if(e.nodeType!==Node.TEXT_NODE&&!e.matches("._real, ._phantom_wrap, ._attribute_value"))throw new Error("only nodes of class ._real, ._phantom_wrap, and ._attribute_value are supported");var c=u(e,"_attribute_value",t);if(c){i=o.siblingByClass(c,"_attribute_name");if(!i)throw new Error("no attribute name found");n.unshift("@"+i.textContent),r=u(c,"_real",t)}else{r=e.parentNode,s=a.call(r.childNodes,e);for(l=0;l<s;++l)i=r.childNodes[l],(i.nodeType===Node.TEXT_NODE||i.nodeType===Node.ELEMENT_NODE&&i.matches("._real, ._phantom_wrap"))&&f++;n.unshift(""+f)}e=r}return n.join("/")},f.prototype.pathToNode=function(e){var t=this.node;if(e==="")return t;var n=e.split(/\//),r=t,i;n[n.length-1][0]==="@"&&(i=n.pop());for(var s=0,u;(u=n[s])!==undefined;++s){var a,f,l=/^(\d+)$/.exec(u);if(!l)throw new Error("malformed path expression");a=l[1]>>0;var c=null;for(var h=0;!c&&h<r.childNodes.length;h++)f=r.childNodes[h],(f.nodeType===Node.TEXT_NODE||f.nodeType===Node.ELEMENT_NODE&&f.matches("._real, ._phantom_wrap"))&&--a<0&&(c=f);if(!c)return null;r=c}if(i){var p=i.slice(1),d=r.getElementsByClassName("_attribute_name");for(var v=0,m;(m=d[v])!==undefined;++v)if(m.textContent===p)break;if(!m)throw new Error("could not find attribute with name: "+p);r=o.siblingByClass(m,"_attribute_value")}return r},t.GUIRoot=f}),define("wed/serializer",["require","exports","module"],function(e,t,n){function r(e){if(e.nodeType!==Node.ELEMENT_NODE&&e.nodeType!==Node.DOCUMENT_NODE&&e.nodeType!==Node.DOCUMENT_FRAGMENT_NODE)throw new Error("the root node must be an element, a document or a document fragment");var t=[];return f(t,e),t.join("")}function i(e,t){if(t.childNodes.length>1)throw new Error("cannot serialize a document with more than one child node");f(e,t.firstChild)}function s(e,t){var n=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return t&&(n=n.replace(/"/g,"&quot;")),n}function o(e,t){e.push("<",t.tagName);var n=t.attributes;for(var r=0,i;i=n[r];++r)e.push(" ",i.name,'="',s(i.value,!0),'"');if(!t.childNodes.length)e.push("/>");else{e.push(">");var o=t.firstChild;while(o)f(e,o),o=o.nextSibling;e.push("</",t.tagName,">")}}function u(e,t){e.push(s(t.textContent,!1))}function f(e,t){var n=a[t.nodeType];if(!n)throw new Error("can't handle node of type: "+t.nodeType);n(e,t)}var a={};a[Node.DOCUMENT_NODE]=i,a[Node.DOCUMENT_FRAGMENT_NODE]=i,a[Node.ELEMENT_NODE]=o,a[Node.TEXT_NODE]=u,t.serialize=r}),define("wed/saver",["require","exports","module","./oop","./lib/simple_event_emitter","./lib/conditioned","./browsers","./serializer"],function(e,t,n){function l(e,t,n){i.call(this),s.call(this),this._version=e,this._data_updater=t,this._data_tree=n,this._initialized=!1,this._failed=undefined,this._current_generation=0,this._saved_generation=0,this._last_modification=undefined,this._last_save=undefined,this._last_save_kind=undefined,this._autosave_interval=undefined,this._autosave_timeout=undefined,t.addEventListener("changed",function(){this._last_modification=Date.now(),this._saved_generation===this._current_generation&&(this._current_generation++,this._emit("changed"))}.bind(this)),this._bound_autosave=this._autosave.bind(this)}function c(e){e=Math.round(e/1e3);var t="moments ago";return e>0&&(t="  ",e>86400?t+=Math.round(e/8640)/10+"d":e>3600?t+=Math.round(e/360)/10+"h":e>60?t+=Math.round(e/6)/10+"m":t+=e+"s",t+=" ago"),t}var r=e("./oop"),i=e("./lib/simple_event_emitter").SimpleEventEmitter,s=e("./lib/conditioned").Conditioned,o=e("./browsers"),u=e("./serializer"),a=1,f=2;r.implement(l,i),r.implement(l,s),l.prototype.save=function(e){this._save(!1,e)},l.prototype._save=function(e,t){throw new Error("derived classes must implement this method")},l.prototype.getData=function(){return o.MSIE?u.serialize(this._data_tree.firstChild):this._data_tree.innerHTML},l.prototype._saveSuccess=function(e,t){this._saved_generation=t,this._last_save=Date.now(),this._last_save_kind=e?a:f,this._emit(e?"autosaved":"saved"),this.setAutosaveInterval(this._autosave_interval)},l.prototype._fail=function(e){this._failed=!0,e&&this._emit("failed",e)},l.prototype._autosave=function(){function t(){e.setAutosaveInterval(e._autosave_interval)}this._autosave_timeout=undefined;var e=this;this._current_generation!==this._saved_generation?this._save(!0,t):t()},l.prototype.setAutosaveInterval=function(e){this._autosave_interval=e;var t=this._autosave_timeout;t&&clearTimeout(t),this._autosave_timeout=e?setTimeout(this._bound_autosave,e):undefined},l.prototype.recover=function(e){if(!this._initialized||this._failed){e(undefined);return}this._recover(e)},l.prototype._recover=function(e){throw new Error("derived classes must implement this method")},l.prototype.getModifiedWhen=function(){return this._saved_generation===this._current_generation?!1:c(Date.now()-this._last_modification)},l.prototype.getSavedWhen=function(){return this._last_save_kind===undefined?undefined:c(Date.now()-this._last_save)},l.prototype.getLastSaveKind=function(){return this._last_save_kind},t.Saver=l,t.AUTO=a,t.MANUAL=f}),define("wed/savers/ajax",["require","exports","module","../saver","../oop","../log","jquery"],function(e,t,n){function u(e,t,n,i){r.Saver.call(this,e,t,n),this._url=i.url,this._headers=i.headers,this._etag='"'+i.initial_etag+'"',this._post({command:"check",version:e},function(e){this._initialized=!0,this._setCondition("initialized"),this._failed=!1}.bind(this),"json").fail(this._failure_wrapper(function(){throw new Error(url+" is not responding; saving is not possible.")}.bind(this))),this.setAutosaveInterval(3e5)}function a(e){var t=e.messages;if(!t||!t.length)return undefined;var n={};for(var r=0,i;(i=t[r])!==undefined;++r){var s=i.type;if(n[s]!==undefined)throw new Error("same type of message appearing more than once in one transaction");n[s]=i}return n}var r=e("../saver"),i=e("../oop"),s=e("../log"),o=e("jquery");i.inherit(u,r.Saver),u.prototype._failure_wrapper=function(e){return s.wrap(function(t,n,r){try{if(t.status===412){var i={msg:"The document was edited by someone else.",type:"save_edited"};return this._fail(i),undefined}return e.apply(undefined,arguments)}catch(s){throw this._fail(),s}}.bind(this))},u.prototype._success_wrapper=function(e){return s.wrap(function(){try{return e.apply(undefined,arguments)}catch(t){throw this._fail(),t}}.bind(this))},u.prototype._save=function(e,t){function r(r){var i=a(r);if(!i)throw new Error("The server accepted the save request but did not return any information regarding whether the save was successful or not.");if(i.save_fatal_error)throw new Error("The server was not able to save the data due to a fatal error. Please contact technical support before trying to edit again.");if(i.save_transient_error){this._emit("failed",i.save_transient_error),t&&t(i.save_transient_error);return}if(!i.save_successful)throw new Error("Unexpected response from the server while saving. Please contact technical support before trying to edit again.");i.version_too_old_error&&this._emit("too_old"),this._saveSuccess(e,n),t&&t(null)}if(!this._initialized)return;var n=this._current_generation;this._post({command:e?"autosave":"save",version:this._version,data:this.getData()},this._success_wrapper(r.bind(this)),"json").fail(this._failure_wrapper(function(){var e={msg:"Your browser cannot contact the server",type:"save_disconnected"};this._emit("failed",e),t&&t(e)}.bind(this)))},u.prototype._recover=function(e){function t(t){var n=a(t);if(!n){e(!1);return}if(n.save_fatal_error){e(!1);return}if(!n.save_successful){e(!1);return}e(!0)}this._post({command:"recover",version:this._version,data:this.getData()},t,"json").fail(e.bind(undefined,!1))},u.prototype._post=function(e,t,n){var r;this._etag?(r=o.extend({},this._headers),r["If-Match"]=this._etag):r=this._headers;var i=this;return o.ajax({type:"POST",url:this._url,data:e,dataType:n,headers:r}).done(function(e,n,r){var s=a(e);s&&s.save_successful&&(i._etag=r.getResponseHeader("ETag")),t(e,n,r)})},t.Saver=u}),define("wed/savers/localforage",["require","exports","module","../saver","../oop","localforage"],function(e,t,n){function o(){s.config({name:"wed",storeName:"files",version:1})}function u(e,t,n,i){r.Saver.call(this,e,t,n),this._initialized=!0,this._setCondition("initialized"),this._failed=!1,this._name=i.name,o(),this.setAutosaveInterval(3e5)}function a(e,t){var n=Object.create(null);return n.version=1,n.name=e,n.data=t,n.uploaded=new Date,n.saved="never",n.downloaded="never",n}var r=e("../saver"),i=e("../oop"),s=e("localforage");i.inherit(u,r.Saver),u.prototype._save=function(e,t){if(!this._initialized)return;var n=this._current_generation;this._update(this._name,this.getData(),e,n,t)},u.prototype._update=function(e,t,n,r,i){var o=this;s.getItem(e).then(function(i){if(i.version!==1)throw new Error("unexpected record version number: "+i.version);i.data=t,i.saved=new Date,s.setItem(e,i,function(e){if(e){o._fail({type:undefined,msg:"Failed to save!"});return}o._saveSuccess(n,r)})})},u.prototype._recover=function(e){this._save(!1,e)},t.Saver=u,t.config=o,t.makeFileRecord=a}),define("wed/tree_updater",["require","exports","module","./domutil","./oop","./lib/simple_event_emitter","./dloc"],function(e,t,n){function f(e){s.call(this),this._tree=e,this._dloc_root=o.findRoot(e)}var r=e("./domutil"),i=e("./oop"),s=e("./lib/simple_event_emitter").SimpleEventEmitter,o=e("./dloc"),u=o.DLoc,a=o.makeDLoc;i.implement(f,s);var l=f.prototype._emit;f.prototype._emit=function(){l.apply(this,arguments),l.call(this,"changed")},f.prototype.insertAt=function(e,t,n){var r,i;e instanceof u?(r=e.node,i=e.offset,n=t):(r=e,i=t);if(n instanceof Array||n instanceof NodeList)for(var s=0;s<n.length;++s,++i)this.insertAt(r,i,n[s]);else if(typeof n=="string")this.insertText(r,i,n);else if(n.nodeType===Node.TEXT_NODE)switch(r.nodeType){case Node.TEXT_NODE:this.insertText(r,i,n.data);break;case Node.ELEMENT_NODE:this.insertNodeAt(r,i,n);break;default:throw new Error("unexpected node type: "+r.nodeType)}else{if(n.nodeType!==Node.ELEMENT_NODE)throw new Error("unexpected value for what: "+n);switch(r.nodeType){case Node.TEXT_NODE:this.insertIntoText(r,i,n);break;case Node.ELEMENT_NODE:this.insertNodeAt(r,i,n);break;default:throw new Error("unexpected node type: "+r.nodeType)}}},f.prototype.splitAt=function(e,t,n){var i;t instanceof u?(i=t.node,n=t.offset):i=t;if(i===e&&i.nodeType===Node.TEXT_NODE)throw new Error("splitAt called in a way that would result in two adjacent text nodes");if(!e.contains(i))throw new Error("split location is not inside top");var s=e.cloneNode(!0),o=r.correspondingNode(e,s,i),a=this._splitAt(s,o,n),f=e.parentNode,l=Array.prototype.indexOf.call(f.childNodes,e);return this.deleteNode(e),this.insertNodeAt(f,l,a[0]),this.insertNodeAt(f,l+1,a[1]),a},f.prototype._splitAt=function(e,t,n){var r=t===e,i=t.parentNode,s;switch(t.nodeType){case Node.TEXT_NODE:if(n===0)s=[null,t];else if(n===t.length)s=[t,null];else{var o=t.data.slice(n);t.deleteData(n,t.length-n),i&&i.insertBefore(i.ownerDocument.createTextNode(o),t.nextSibling||null),s=[t,t.nextSibling]}break;case Node.ELEMENT_NODE:n<0?n=0:n>t.childNodes.length&&(n=t.childNodes.length);var u=t.cloneNode(!0);while(t.childNodes[n])t.removeChild(t.childNodes[n]);while(n--)u.removeChild(u.firstChild);i&&i.insertBefore(u,t.nextSibling||null),s=[t,u];break;default:throw new Error("unexpected node type: "+t.nodeType)}return r?s:this._splitAt(e,i,Array.prototype.indexOf.call(i.childNodes,t)+1)},f.prototype.insertBefore=function(e,t,n){var r=n?Array.prototype.indexOf.call(e.childNodes,n):e.childNodes.length;if(r===-1)throw new Error("insertBefore called with a before_this value which is not a child of parent");this.insertAt(e,r,t)},f.prototype.insertText=function(e,t,n){var i;return e instanceof u?(n=t,i=e.node,t=e.offset):i=e,r.genericInsertText.call(this,i,t,n)},f.prototype.deleteText=function(e,t,n){var r;e instanceof u?(n=t,r=e.node,t=e.offset):r=e;if(r.nodeType!==Node.TEXT_NODE)throw new Error("deleteText called on non-text");this.setTextNode(r,r.data.slice(0,t)+r.data.slice(t+n))},f.prototype.insertIntoText=function(e,t,n){var i;e instanceof u?(n=t,t=e.offset,i=e.node):i=e;var s=r.genericInsertIntoText.call(this,i,t,n);return[a(this._tree,s[0]),a(this._tree,s[1])]},f.prototype.insertNodeAt=function(e,t,n){var r;e instanceof u?(n=t,t=e.offset,r=e.node):r=e;if(n.nodeType===Node.DOCUMENT_FRAGMENT_NODE)throw new Error("document fragments cannot be passed to insertNodeAt");r.insertBefore(n,r.childNodes[t]||null),this._emit("insertNodeAt",{parent:r,index:t,node:n})},f.prototype.setTextNode=function(e,t){if(e.nodeType!==Node.TEXT_NODE)throw new Error("setTextNode called on non-text");t!==""?this.setTextNodeValue(e,t):this.deleteNode(e)},f.prototype.setTextNodeValue=function(e,t){if(e.nodeType!==Node.TEXT_NODE)throw new Error("setTextNodeValue called on non-text");var n=e.data;e.data=t,this._emit("setTextNodeValue",{node:e,value:t,old_value:n})},f.prototype.removeNode=function(e){var t=e.previousSibling,n=e.nextSibling,r=e.parentNode,i=Array.prototype.indexOf.call(r.childNodes,e);return this.deleteNode(e),t?this.mergeTextNodes(t):a(this._tree,r,i)},f.prototype.removeNodeNF=function(e){return e?this.removeNode(e):undefined},f.prototype.removeNodes=function(e){if(!e.length)return undefined;var t=e[0].previousSibling,n=e[e.length-1].nextSibling,r=e[0].parentNode,i=Array.prototype.indexOf.call(r.childNodes,e[0]);for(var s=0;s<e.length;++s){if(s<e.length-1&&e[s].nextSibling!==e[s+1])throw new Error("nodes are not immediately contiguous in document order");this.deleteNode(e[s])}return t?this.mergeTextNodes(t):a(this._tree,r,i)},f.prototype.cut=function(e,t){var n=r.genericCutFunction.call(this,e.toArray(),t.toArray());return n[0]=a(this._tree,n[0]),n},f.prototype.mergeTextNodes=function(e){var t=e.nextSibling;if(e.nodeType===Node.TEXT_NODE&&t&&t.nodeType===Node.TEXT_NODE){var n=e.length;return this.setTextNodeValue(e,e.data+t.data),this.deleteNode(t),a(this._tree,e,n)}var r=e.parentNode;return a(this._tree,r,Array.prototype.indexOf.call(r.childNodes,e)+1)},f.prototype.mergeTextNodesNF=function(e){return e?this.mergeTextNodes(e):undefined},f.prototype.deleteNode=function(e){this._emit("beforeDeleteNode",{node:e});var t=e.parentNode;t.removeChild(e),this._emit("deleteNode",{node:e,former_parent:t})},f.prototype.setAttribute=function(e,t,n){this.setAttributeNS(e,"",t,n)},f.prototype.setAttributeNS=function(e,t,n,r){r===undefined&&(r=null);var i=r===null;if(e.nodeType!==Node.ELEMENT_NODE)throw new Error("setAttribute called on non-element");var s=e.getAttributeNS(t,n);s===""&&!e.hasAttributeNS(t,n)&&(s=null),i?e.removeAttributeNS(t,n):e.setAttributeNS(t,n,r),this._emit("setAttributeNS",{node:e,ns:t,attribute:n,old_value:s,new_value:r})},f.prototype.nodeToPath=function(e){return this._dloc_root.nodeToPath(e)},f.prototype.pathToNode=function(e){return this._dloc_root.pathToNode(e)},t.TreeUpdater=f}),define("wed/convert",["require","exports","module"],function(e,t,n){function r(e,t){var n=e.parentNode;if(!n||n.nodeType===Node.DOCUMENT_NODE||n.nodeType===Node.DOCUMENT_FRAGMENT_NODE)return undefined;var i=n.getAttribute(t);return i!==null?i:r(n,t)}function i(e,t){var n;switch(t.nodeType){case Node.ELEMENT_NODE:n=e.createElement("div"),n.className=t.tagName+" _real";for(var s=0,o;o=t.attributes[s];++s){var u=o.name==="xmlns"||o.name.lastIndexOf("xmlns:",0)===0;if(u&&o.value===r(t,o.name))continue;var a="data-wed-"+o.name.replace(/--(-+)/,"---$1").replace(":","---");n.setAttribute(a,o.value)}var f=t.firstChild;while(f){var l=i(e,f);l&&n.appendChild(l),f=f.nextSibling}break;case Node.TEXT_NODE:n=document.createTextNode(t.data);break;default:throw new Error("unhandled node type: "+t.nodeType)}return n}t.toHTMLTree=i}),define("wed/gui_updater",["require","exports","module","./domutil","jquery","./oop","./tree_updater","./dloc","./convert","./util"],function(e,t,n){function h(e,t){o.call(this,e),this._gui_tree=e,this._tree_updater=t,this._tree_updater.addEventListener("insertNodeAt",this._insertNodeAtHandler.bind(this)),this._tree_updater.addEventListener("setTextNodeValue",this._setTextNodeValueHandler.bind(this)),this._tree_updater.addEventListener("beforeDeleteNode",this._beforeDeleteNodeHandler.bind(this)),this._tree_updater.addEventListener("setAttributeNS",this._setAttributeNSHandler.bind(this))}var r=e("./domutil"),i=e("jquery"),s=e("./oop"),o=e("./tree_updater").TreeUpdater,u=e("./dloc"),a=e("./convert"),f=e("./util"),l=u.makeDLoc,c=u.DLoc;s.inherit(h,o),h.prototype._insertNodeAtHandler=function(e){var t=this.fromDataLocation(e.parent,e.index),n=a.toHTMLTree(this._gui_tree.ownerDocument,e.node);r.linkTrees(e.node,n),this.insertNodeAt(t,n)},h.prototype._setTextNodeValueHandler=function(e){var t=this.fromDataLocation(e.node,0);this.setTextNodeValue(t.node,e.value)},h.prototype._beforeDeleteNodeHandler=function(e){var t=e.node,n;switch(t.nodeType){case Node.TEXT_NODE:var s=this.fromDataLocation(t,0);n=s.node;break;case Node.ELEMENT_NODE:n=i.data(t,"wed_mirror_node")}this.deleteNode(n),r.unlinkTree(t),r.unlinkTree(n)},h.prototype._setAttributeNSHandler=function(e){var t=this.fromDataLocation(e.node,0);this.setAttributeNS(t.node,"",f.encodeAttrName(e.attribute),e.new_value)},h.prototype.fromDataLocation=function(e,t){var n;e instanceof c?(n=e.node,t=e.offset):n=e;var r=this.pathToNode(this._tree_updater.nodeToPath(n));if(n.nodeType===Node.TEXT_NODE)return l(this._gui_tree,r,t);if(n.nodeType===Node.ATTRIBUTE_NODE)return r.firstChild&&r.firstChild.nodeType===Node.TEXT_NODE&&(r=r.firstChild),l(this._gui_tree,r,t);if(t===0)return l(this._gui_tree,r,0);if(t>=n.childNodes.length)return l(this._gui_tree,r,r.childNodes.length);var i=this.pathToNode(this._tree_updater.nodeToPath(n.childNodes[t]));return i===null?l(this._gui_tree,r,r.childNodes.length):l(this._gui_tree,i.parentNode,Array.prototype.indexOf.call(i.parentNode.childNodes,i))},t.GUIUpdater=h}),define("wed/undo_recorder",["require","exports","module","./domutil","./oop","./undo"],function(e,t,n){function o(e,t){this._editor=e,this._tree_updater=t,this._tree_updater.addEventListener("insertNodeAt",this._insertNodeAtHandler.bind(this)),this._tree_updater.addEventListener("setTextNodeValue",this._setTextNodeValueHandler.bind(this)),this._tree_updater.addEventListener("beforeDeleteNode",this._beforeDeleteNodeHandler.bind(this)),this._tree_updater.addEventListener("setAttributeNS",this._setAttributeNSHandler.bind(this)),this._suppress=!1}function u(e,t,n,r){s.Undo.call(this,"InsertNodeAtUndo"),this._tree_updater=e,this._parent_path=e.nodeToPath(t),this._index=n,this._node=undefined}function a(e,t,n,r){s.Undo.call(this,"SetTextNodeValueUndo"),this._tree_updater=e,this._node_path=e.nodeToPath(t),this._new_value=n,this._old_value=r}function f(e,t){s.Undo.call(this,"DeleteNodeUndo"),this._tree_updater=e;var n=t.parentNode;this._parent_path=e.nodeToPath(n),this._index=Array.prototype.indexOf.call(n.childNodes,t),this._node=t.cloneNode(!0)}function l(e,t,n,r,i,o){s.Undo.call(this,"SetAttributeNSUndo"),this._tree_updater=e,this._node_path=e.nodeToPath(t),this._ns=n,this._attribute=r,this._old_value=i,this._new_value=o}var r=e("./domutil"),i=e("./oop"),s=e("./undo");o.prototype.suppressRecording=function(e){if(e===this._suppress)throw new Error("spurious call to suppressRecording");this._suppress=e},o.prototype._insertNodeAtHandler=function(e){if(this._suppress)return;this._editor.recordUndo(new u(this._tree_updater,e.parent,e.index,e.node))},o.prototype._setTextNodeValueHandler=function(e){if(this._suppress)return;this._editor.recordUndo(new a(this._tree_updater,e.node,e.value,e.old_value))},o.prototype._beforeDeleteNodeHandler=function(e){if(this._suppress)return;this._editor.recordUndo(new f(this._tree_updater,e.node))},o.prototype._setAttributeNSHandler=function(e){if(this._suppress)return;this._editor.recordUndo(new l(this._tree_updater,e.node,e.ns,e.attribute,e.old_value,e.new_value))},i.inherit(u,s.Undo),u.prototype.undo=function(){if(this._node)throw new Error("undo called twice in a row");var e=this._tree_updater.pathToNode(this._parent_path);this._node=e.childNodes[this._index].cloneNode(!0),this._tree_updater.deleteNode(e.childNodes[this._index])},u.prototype.redo=function(){if(!this._node)throw new Error("redo called twice in a row");var e=this._tree_updater.pathToNode(this._parent_path);this._tree_updater.insertNodeAt(e,this._index,this._node),this._node=undefined},u.prototype.toString=function(){return[this._desc,"\n"," Parent path: ",this._parent_path,"\n"," Index: ",this._index,"\n"," Node: ",this._node?this._node.outerHTML:"undefined","\n"].join("")},i.inherit(a,s.Undo),a.prototype.undo=function(){var e=this._tree_updater.pathToNode(this._node_path);this._tree_updater.setTextNodeValue(e,this._old_value)},a.prototype.redo=function(){var e=this._tree_updater.pathToNode(this._node_path);this._tree_updater.setTextNodeValue(e,this._new_value)},a.prototype.toString=function(){return[this._desc,"\n"," Node path: ",this._node_path,"\n"," New value: ",this._new_value,"\n"," Old value: ",this._old_value,"\n"].join("")},i.inherit(f,s.Undo),f.prototype.undo=function(){if(!this._node)throw new Error("undo called twice in a row");var e=this._tree_updater.pathToNode(this._parent_path);this._tree_updater.insertNodeAt(e,this._index,this._node),this._node=undefined},f.prototype.redo=function(){if(this._node)throw new Error("redo called twice in a row");var e=this._tree_updater.pathToNode(this._parent_path);this._node=e.childNodes[this._index].cloneNode(!0),this._tree_updater.deleteNode(e.childNodes[this._index])},f.prototype.toString=function(){return[this._desc,"\n"," Parent path: ",this._parent_path,"\n"," Index: ",this._index,"\n"," Node: ",this._node?this._node.outerHTML:"undefined","\n"].join("")},i.inherit(l,s.Undo),l.prototype.undo=function(){var e=this._tree_updater.pathToNode(this._node_path);this._tree_updater.setAttributeNS(e,this._ns,this._attribute,this._old_value)},l.prototype.redo=function(){var e=this._tree_updater.pathToNode(this._node_path);this._tree_updater.setAttributeNS(e,this._ns,this._attribute,this._new_value)},l.prototype.toString=function(){return[this._desc,"\n"," Node path: ",this._node_path,"\n"," Namespace: ",this._ns,"\n"," Attribute Name: ",this._attribute,"\n"," New value: ",this._new_value,"\n"," Old value: ",this._old_value,"\n"].join("")},t.UndoRecorder=o}),define("wed/domlistener",["require","exports","module"],function(e,t,n){function r(e){this._root=e,this._event_handlers={"included-element":[],"added-element":[],"excluded-element":[],"excluding-element":[],"removed-element":[],"removing-element":[],"children-changed":[],"children-changing":[],"text-changed":[],"attribute-changed":[]},this._trigger_handlers={},this._triggers_to_fire={}}function i(){throw new Error("derived classes must override this method")}r.prototype.startListening=i,r.prototype.addHandler=function(e,t,n){e instanceof Array||(e=[e]);for(var r=0,i;(i=e[r])!==undefined;r++)if(i!=="trigger"){var s=this._event_handlers[i];if(s===undefined)throw new Error("invalid event_type: "+i);s.push([t,n])}else{var o=this._trigger_handlers[t];o===undefined&&(o=this._trigger_handlers[t]=[]),o.push(n)}},r.prototype.stopListening=i,r.prototype.processImmediately=i,r.prototype.clearPending=i,r.prototype.trigger=function(e){this._triggers_to_fire[e]=1},r.prototype._processTriggers=function(){var e=Object.keys(this._triggers_to_fire);while(e.length>0){this._triggers_to_fire={};var t=this._trigger_handlers;for(var n=0,r;(r=e[n])!==undefined;++n){var i=t[r];if(i!==undefined)for(var s=0,o;(o=i[s])!==undefined;++s)this._callHandler(o)}e=Object.keys(this._triggers_to_fire)}},r.prototype._callHandler=function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);t.unshift(this._root),e.apply(undefined,t)},r.prototype._dumpMutation=function(e){console.log(e.type+":",e.target,e.addedNodes,e.removedNodes,e.previousSibling,e.nextSibling,e.attributeName,e.attributeNamespace,e.oldValue)},t.Listener=r}),define("wed/updater_domlistener",["require","exports","module","./oop","./domlistener"],function(e,t,n){function s(e,t){i.Listener.call(this,e),this._updater=t,this._stopped=!0,this._scheduled_process_triggers=0,this._updater.addEventListener("insertNodeAt",this._insertNodeAtHandler.bind(this)),this._updater.addEventListener("setTextNodeValue",this._setTextNodeValueHandler.bind(this)),this._updater.addEventListener("beforeDeleteNode",this._beforeDeleteNodeHandler.bind(this)),this._updater.addEventListener("deleteNode",this._deleteNodeHandler.bind(this)),this._updater.addEventListener("setAttributeNS",this._setAttributeNSHandler.bind(this))}var r=e("./oop"),i=e("./domlistener");r.inherit(s,i.Listener),s.prototype.startListening=function(){this._stopped=!1},s.prototype.stopListening=function(){this._stopped=!0},s.prototype.processImmediately=function(){this._scheduled_process_triggers&&(this.clearPending(),this._processTriggers())},s.prototype.clearPending=function(){this._scheduled_process_triggers&&(window.clearTimeout(this._scheduled_process_triggers),this._scheduled_process_triggers=undefined)},s.prototype._insertNodeAtHandler=function(e){if(this._stopped)return;var t=e.parent,n=e.node,r=this._childrenCalls("children-changed",e.parent,[e.node],[],n.previousSibling,n.nextSibling),i=[],s=[];e.node.nodeType===Node.ELEMENT_NODE&&(i=this._addRemCalls("added-element",n,t),s=this._incExcCalls("included-element",n,t));var o=r.concat(i,s);for(var u=0,a;(a=o[u])!==undefined;++u)this._callHandler.apply(this,a);this._scheduleProcessTriggers()},s.prototype._beforeDeleteNodeHandler=function(e){if(this._stopped)return;var t=e.node,n=t.parentNode,r=this._childrenCalls("children-changing",n,[],[t],t.previousSibling,t.nextSibling),i=[],s=[];e.node.nodeType===Node.ELEMENT_NODE&&(i=this._addRemCalls("removing-element",t,n),s=this._incExcCalls("excluding-element",t,n));var o=r.concat(i,s);for(var u=0,a;(a=o[u])!==undefined;++u)this._callHandler.apply(this,a);this._scheduleProcessTriggers()},s.prototype._deleteNodeHandler=function(e){if(this._stopped)return;var t=e.node,n=e.former_parent,r=this._childrenCalls("children-changed",n,[],[t],null,null),i=[],s=[];e.node.nodeType===Node.ELEMENT_NODE&&(i=this._addRemCalls("removed-element",t,n),s=this._incExcCalls("excluded-element",t,n));var o=r.concat(i,s);for(var u=0,a;(a=o[u])!==undefined;++u)this._callHandler.apply(this,a);this._scheduleProcessTriggers()},s.prototype._childrenCalls=function(e,t,n,r,i,s){if(e!=="children-changing"&&e!=="children-changed")throw new Error("incorrect call value: "+e);if(n.length&&r.length)throw new Error("we do not support having nodes added and removed in the same event");var o=this._event_handlers[e],u=[];for(var a=0,f=o.length;a<f;++a){var l=o[a],c=l[0];t.matches(c)&&u.push([l[1],n,r,i,s,t])}return u},s.prototype._setTextNodeValueHandler=function(e){if(this._stopped)return;var t=this._event_handlers["text-changed"],n=e.node,r=n.parentNode;for(var i=0,s=t.length;i<s;++i){var o=t[i],u=o[0];r.matches(u)&&this._callHandler(o[1],n,e.old_value)}this._scheduleProcessTriggers()},s.prototype._setAttributeNSHandler=function(e){if(this._stopped)return;var t=e.node,n=this._event_handlers["attribute-changed"];for(var r=0,i=n.length;r<i;++r){var s=n[r],o=s[0];t.matches(o)&&this._callHandler(s[1],t,e.ns,e.attribute,e.old_value)}this._scheduleProcessTriggers()},s.prototype._scheduleProcessTriggers=function(){if(this._scheduled_process_triggers)return;this._scheduled_process_triggers=window.setTimeout(function(){this._scheduled_process_triggers=undefined,this._processTriggers()}.bind(this),0)},s.prototype._addRemCalls=function(e,t,n){var r=this._event_handlers[e],i=[],s=t.previousSibling,o=t.nextSibling;for(var u=0,a=r.length;u<a;++u){var f=r[u],l=f[0];t.matches(l)&&i.push([f[1],n,s,o,t])}return i},s.prototype._incExcCalls=function(e,t,n){var r=this._event_handlers[e],i=t.previousSibling,s=t.nextSibling,o=[];for(var u=0,a=r.length;u<a;++u){var f=r[u],l=f[0];t.matches(l)&&o.push([f[1],t,n,i,s,t]);var c=t.querySelectorAll(l);for(var h=0,p=c.length;h<p;++h)o.push([f[1],t,n,i,s,c[h]])}return o},t.Listener=s}),define("salve/name_resolver",["require","exports","module","./validate"],function(e,t,n){function o(){this.id="N"+this.__newID(),this._context_stack=[],this.enterContext(),this._context_stack[0].forward.xml=i,this._context_stack[0].backwards[i]=["xml"],this._context_stack[0].forward.xmlns=s,this._context_stack[0].backwards[s]=["xmlns"]}var r=e("./validate"),i="http://www.w3.org/XML/1998/namespace",s="http://www.w3.org/2000/xmlns/";o.__id=0,o.prototype.__newID=function(){return o.__id++},o.prototype.hash=function(){return this.id},o.prototype.clone=function(){var e=new o;return e._context_stack=this._context_stack.slice(),e},o.prototype.definePrefix=function(e,t){if(e==="xmlns")throw new Error("trying to define 'xmlns' but the XML Namespaces standard stipulates that 'xmlns' cannot be declared (= \"defined\")");if(e==="xml"&&t!==i)throw new Error("trying to define 'xml' to an incorrect URI");this._context_stack[0].forward[e]=t;var n=this._context_stack[0].backwards[t];n===undefined&&(n=this._context_stack[0].backwards[t]=[]),e===""?n.unshift(""):n.push(e)},o.prototype.enterContext=function(){this._context_stack.unshift(Object.create(null)),this._context_stack[0].forward=Object.create(null),this._context_stack[0].backwards=Object.create(null)},o.prototype.leaveContext=function(){if(!(this._context_stack.length>1))throw new Error("trying to leave the default context");this._context_stack.shift()},o.prototype.resolveName=function(e,t){t===undefined&&(t=!1);var n=e.split(":");if(n.length==1){if(t)return new r.EName("",e);n=["",e]}if(n.length>2)throw new Error("invalid name passed to resolveName");var i;for(var s=0,o;i===undefined&&(o=this._context_stack[s])!==undefined;++s)i=o.forward[n[0]];return i===undefined?n[0]===""?new r.EName("",n[1]):undefined:new r.EName(i,n[1])},o.prototype.unresolveName=function(e,t){if(e==="")return t;var n;for(var r=0,i;n===undefined&&(i=this._context_stack[r])!==undefined;++r)n=i.backwards[e];if(n===undefined)return undefined;var s=n[0];return s!==""?s+":"+t:t},o.prototype.prefixFromURI=function(e){var t;for(var n=0,r;t===undefined&&(r=this._context_stack[n])!==undefined;++n)t=r.backwards[e];if(t===undefined)return undefined;var i=t[0];return i},t.NameResolver=o,t.XML1_NAMESPACE=i}),define("salve/util",["require","exports","module"],function(e,t,n){return{inspect:function(e){return e}}}),define("salve/oop",["require","exports","module"],function(e,t,n){function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e}function i(e,t){for(var n in t.prototype)e.prototype[n]=t.prototype[n]}t.inherit=r,t.implement=i}),define("salve/hashstructs",["require","exports","module","./oop"],function(e,t,n){function i(e,t){this.hash_f=e,this.backing=Object.create(null),this._size=0;if(t!==undefined)if(t instanceof i){var n=this.backing,r=t.backing,s=Object.keys(r);for(var o=0,u;(u=s[o++])!==undefined;)n[u]=r[u];this._size=s.length}else if(t instanceof Array)for(var a=0;a<t.length;++a)this.add(t[a]);else this.add(t)}function s(){i.apply(this,arguments)}function o(e,t){if(t instanceof Array)throw new Error("cannot initialize a map with an array");i.apply(this,arguments)}var r=e("./oop").inherit;i.prototype.hash_f=undefined,i.prototype.backing=undefined,i.prototype._size=0,i.prototype._store=function(e,t){if(e===undefined||e===null)throw new Error("undefined or null hash");this.backing[e]===undefined&&(this.backing[e]=t,this._size++)},i.prototype.union=function(e){if(e===null||e===undefined)return;if(!(e instanceof this.constructor))throw new Error("union invalid class object; my class "+this.constructor.name+" other class "+e.constructor.name);var t=e.backing,n=Object.keys(t);for(var r=0,i;(i=n[r++])!==undefined;)this._store(i,t[i])},i.prototype.forEach=function(e){var t=this.backing,n=Object.keys(t);for(var r=0,i;(i=n[r++])!==undefined;)e(t[i])},i.prototype.size=function(){return this._size},i.prototype.filter=function(e){var t=new this.constructor;t.hash_f===undefined&&(t.hash_f=this.hash_f);var n=this.backing,r=Object.keys(n);for(var i=0,s;(s=r[i++])!==undefined;){var o=n[s],u=o instanceof Array?o:[o];e.apply(undefined,u)&&t._store(s,o)}return t},i.prototype.has=function(e){var t=this.hash_f(e);return this.backing[t]},i.prototype.toString=function(){return this.toArray().join(", ")},i.prototype.toArray=function(){var e=[],t=this.backing,n=Object.keys(t);for(var r=0,i;(i=n[r++])!==undefined;)e.push(t[i]);return e},r(s,i),s.prototype.add=function(e){this._store(this.hash_f(e),e)},r(o,i),o.prototype.add=function(e,t){this._store(this.hash_f(e),[e,t])},o.prototype.forEach=function(e){var t=this.backing,n=Object.keys(t);for(var r=0,i;(i=n[r++])!==undefined;)e(t[i][0],t[i][1])},o.prototype.has=function(e){var t=this.hash_f(e),n=this.backing[t];if(n!==undefined)return n[1]},o.prototype.keys=function(){return Object.keys(this.backing)},t.HashSet=s,t.HashMap=o}),define("salve/set",["require","exports","module"],function(e,t,n){function r(e){if(e!==undefined)if(e instanceof r)this.b=e.b.concat([]);else if(e instanceof Array){this.b=[];for(var t=0;t<e.length;++t)this.add(e[t])}else this.b=[e];else this.b=[]}r.prototype.b=undefined,r.prototype.add=function(e){var t=this.b.indexOf(e);t<0&&this.b.push(e)},r.prototype.union=function(e){if(e===null||e===undefined)return;if(!(e instanceof r))throw new Error("union with non-Set");var t=e.b.length;for(var n=0;n<t;++n)this.add(e.b[n])},r.prototype.filter=function(e){var t=new this.constructor;return t.b=this.b.filter(e),t},r.prototype.map=function(e){var t=new this.constructor;for(var n=0;n<this.b.length;++n){var r=e(this.b[n]);r!==undefined&&t.add(r)}return t},r.prototype.forEach=function(e){this.b.forEach(e)},r.prototype.toString=function(){return this.b.join(", ")},r.prototype.size=function(){return this.b.length},r.prototype.has=function(e){return this.b.indexOf(e)>=0},r.prototype.toArray=function(){return this.b.slice()},t.Set=r}),define("salve/datatypes/errors",["require","exports","module","../oop","lodash"],function(e,t,n){function s(e){this.message=e}function o(e){this.message=e}function u(e,t){var n=e+": "+i.map(t,function(e){return e.toString()}).join("\n"),r=new Error(n);this.errors=t,this.name="ParameterParsingError",this.stack=r.stack,this.message=r.message}function a(e){var t=i.map(e,function(e){return e.toString()}).join("\n"),n=new Error(t);this.errors=e,this.name="ValueValidationError",this.stack=n.stack,this.message=n.message}var r=e("../oop"),i=e("lodash");s.prototype.toString=function(){return this.message},o.prototype.toString=function(){return this.message},r.inherit(u,Error),r.inherit(a,Error),t.ParamError=s,t.ValueError=o,t.ParameterParsingError=u,t.ValueValidationError=a}),define("salve/datatypes/builtin",["require","exports","module","lodash","../oop","./errors"],function(e,t,n){function f(e){return e.trim().replace(/\s{2,}/g," ")}var r=e("lodash"),i=e("../oop"),s=e("./errors"),o=s.ParameterParsingError,u=s.ParamError,a=s.ValueValidationError,l={parseParams:function(e,t){if(t&&t.length>0)throw new o(e,new u("this type does not accept parameters"))},parseValue:function(e,t){var n=this.disallows(e,[],t);if(n.length)throw new a(n);return{value:e}}},c=r.extend({},l,{equal:function(e,t,n,r){if(t.value===undefined)throw Error("it looks like you are trying to use an unparsed value");return e===t.value},disallows:function(e,t,n){return!1},regexp:/.*/,needs_context:!1}),h=r.extend({},l,{equal:function(e,t,n){if(t.value===undefined)throw Error("it looks like you are trying to use an unparsed value");return f(e)===f(t.value)},disallows:function(e,t,n){return!1},regexp:/.*/,needs_context:!1}),p={uri:"",types:{string:c,token:h}};t.builtin=p}),define("salve/datatypes/xmlcharacters",["require","exports","module"],function(e,t,n){var r="A-Z_a-z----------------------------------------------------------------------------------------------------------------------------------------------------",i="--",s=r+i,o="0-9--------------",u="------------------------------------------------------------------",a="---",f="-"+s+o+"._:"+u+a,l="["+s+"_:](?:["+f+"])*",c=new RegExp("^"+l+"$"),h="["+s+"_](?:[-"+s+o+"._"+u+a+"])*",p=new RegExp("^"+h+"$");t.xml_Name_re=c,t.xml_NCName=h,t.xml_NCName_re=p,t.xml_Name_Char=f,t.xml_Letter=s});var XRegExp;XRegExp=XRegExp||function(e){function b(e,n,r){var i;for(i in t.prototype)t.prototype.hasOwnProperty(i)&&(e[i]=t.prototype[i]);return e.xregexp={captureNames:n,isNative:!!r},e}function w(e){return(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":"")}function E(e,n,r){if(!t.isRegExp(e))throw new TypeError("type RegExp expected");var i=s.replace.call(w(e)+(n||""),p,"");return r&&(i=s.replace.call(i,new RegExp("["+r+"]+","g"),"")),e.xregexp&&!e.xregexp.isNative?e=b(t(e.source,i),e.xregexp.captureNames?e.xregexp.captureNames.slice(0):null):e=b(new RegExp(e.source,i),null,!0),e}function S(e,t){var n=e.length;if(Array.prototype.lastIndexOf)return e.lastIndexOf(t);while(n--)if(e[n]===t)return n;return-1}function x(e,t){return Object.prototype.toString.call(e).toLowerCase()==="[object "+t+"]"}function T(e){return e=e||{},e==="all"||e.all?e={natives:!0,extensibility:!0}:x(e,"string")&&(e=t.forEach(e,/[^\s,]+/,function(e){this[e]=!0},{})),e}function N(e,t,n,r){var i=a.length,s=null,u,f;g=!0;try{while(i--){f=a[i];if((f.scope==="all"||f.scope===n)&&(!f.trigger||f.trigger.call(r))){f.pattern.lastIndex=t,u=o.exec.call(f.pattern,e);if(u&&u.index===t){s={output:f.handler.call(r,u,n),match:u};break}}}}catch(l){throw l}finally{g=!1}return s}function C(e){t.addToken=n[e?"on":"off"],i.extensibility=e}function k(e){RegExp.prototype.exec=(e?o:s).exec,RegExp.prototype.test=(e?o:s).test,String.prototype.match=(e?o:s).match,String.prototype.replace=(e?o:s).replace,String.prototype.split=(e?o:s).split,i.natives=e}var t,n,r,i={natives:!1,extensibility:!1},s={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},o={},u={},a=[],f="default",l="class",c={"default":/^(?:\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9]\d*|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S])|\(\?[:=!]|[?*+]\?|{\d+(?:,\d*)?}\??)/,"class":/^(?:\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S]))/},h=/\$(?:{([\w$]+)}|(\d\d?|[\s\S]))/g,p=/([\s\S])(?=[\s\S]*\1)/g,d=/^(?:[?*+]|{\d+(?:,\d*)?})\??/,v=s.exec.call(/()??/,"")[1]===e,m=RegExp.prototype.sticky!==e,g=!1,y="gim"+(m?"y":"");return t=function(n,r){if(t.isRegExp(n)){if(r!==e)throw new TypeError("can't supply flags when constructing one RegExp from another");return E(n)}if(g)throw new Error("can't call the XRegExp constructor within token definition functions");var i=[],o=f,u={hasNamedCapture:!1,captureNames:[],hasFlag:function(e){return r.indexOf(e)>-1}},a=0,h,d,v;n=n===e?"":String(n),r=r===e?"":String(r);if(s.match.call(r,p))throw new SyntaxError("invalid duplicate regular expression flag");n=s.replace.call(n,/^\(\?([\w$]+)\)/,function(e,t){if(s.test.call(/[gy]/,t))throw new SyntaxError("can't use flag g or y in mode modifier");return r=s.replace.call(r+t,p,""),""}),t.forEach(r,/[\s\S]/,function(e){if(y.indexOf(e[0])<0)throw new SyntaxError("invalid regular expression flag "+e[0])});while(a<n.length)h=N(n,a,o,u),h?(i.push(h.output),a+=h.match[0].length||1):(d=s.exec.call(c[o],n.slice(a)),d?(i.push(d[0]),a+=d[0].length):(v=n.charAt(a),v==="["?o=l:v==="]"&&(o=f),i.push(v),++a));return b(new RegExp(i.join(""),s.replace.call(r,/[^gimy]+/g,"")),u.hasNamedCapture?u.captureNames:null)},n={on:function(e,t,n){n=n||{},e&&a.push({pattern:E(e,"g"+(m?"y":"")),handler:t,scope:n.scope||f,trigger:n.trigger||null}),n.customFlags&&(y=s.replace.call(y+n.customFlags,p,""))},off:function(){throw new Error("extensibility must be installed before using addToken")}},t.addToken=n.off,t.cache=function(e,n){var r=e+"/"+(n||"");return u[r]||(u[r]=t(e,n))},t.escape=function(e){return s.replace.call(e,/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},t.exec=function(e,t,n,r){var i=E(t,"g"+(r&&m?"y":""),r===!1?"y":""),s;return i.lastIndex=n=n||0,s=o.exec.call(i,e),r&&s&&s.index!==n&&(s=null),t.global&&(t.lastIndex=s?i.lastIndex:0),s},t.forEach=function(e,n,r,i){var s=0,o=-1,u;while(u=t.exec(e,n,s))r.call(i,u,++o,e,n),s=u.index+(u[0].length||1);return i},t.globalize=function(e){return E(e,"g")},t.install=function(e){e=T(e),!i.natives&&e.natives&&k(!0),!i.extensibility&&e.extensibility&&C(!0)},t.isInstalled=function(e){return!!i[e]},t.isRegExp=function(e){return x(e,"regexp")},t.matchChain=function(e,n){return function r(e,i){var s=n[i].regex?n[i]:{regex:n[i]},o=[],u=function(e){o.push(s.backref?e[s.backref]||"":e[0])},a;for(a=0;a<e.length;++a)t.forEach(e[a],s.regex,u);return i===n.length-1||!o.length?o:r(o,i+1)}([e],0)},t.replace=function(n,r,i,s){var u=t.isRegExp(r),a=r,f;return u?(s===e&&r.global&&(s="all"),a=E(r,s==="all"?"g":"",s==="all"?"":"g")):s==="all"&&(a=new RegExp(t.escape(String(r)),"g")),f=o.replace.call(String(n),a,i),u&&r.global&&(r.lastIndex=0),f},t.split=function(e,t,n){return o.split.call(e,t,n)},t.test=function(e,n,r,i){return!!t.exec(e,n,r,i)},t.uninstall=function(e){e=T(e),i.natives&&e.natives&&k(!1),i.extensibility&&e.extensibility&&C(!1)},t.union=function(e,n){var r=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,i=0,s,o,u=function(e,t,n){var r=o[i-s];if(t){++i;if(r)return"(?<"+r+">"}else if(n)return"\\"+(+n+s);return e},a=[],f,l;if(!x(e,"array")||!e.length)throw new TypeError("patterns must be a nonempty array");for(l=0;l<e.length;++l)f=e[l],t.isRegExp(f)?(s=i,o=f.xregexp&&f.xregexp.captureNames||[],a.push(t(f.source).source.replace(r,u))):a.push(t.escape(f));return t(a.join("|"),n)},t.version="2.0.0",o.exec=function(t){var n,r,i,o,u;this.global||(o=this.lastIndex),n=s.exec.apply(this,arguments);if(n){!v&&n.length>1&&S(n,"")>-1&&(i=new RegExp(this.source,s.replace.call(w(this),"g","")),s.replace.call(String(t).slice(n.index),i,function(){var t;for(t=1;t<arguments.length-2;++t)arguments[t]===e&&(n[t]=e)}));if(this.xregexp&&this.xregexp.captureNames)for(u=1;u<n.length;++u)r=this.xregexp.captureNames[u-1],r&&(n[r]=n[u]);this.global&&!n[0].length&&this.lastIndex>n.index&&(this.lastIndex=n.index)}return this.global||(this.lastIndex=o),n},o.test=function(e){return!!o.exec.call(this,e)},o.match=function(e){if(!t.isRegExp(e))e=new RegExp(e);else if(e.global){var n=s.match.apply(this,arguments);return e.lastIndex=0,n}return o.exec.call(e,this)},o.replace=function(e,n){var r=t.isRegExp(e),i,o,u,a;return r?(e.xregexp&&(i=e.xregexp.captureNames),e.global||(a=e.lastIndex)):e+="",x(n,"function")?o=s.replace.call(String(this),e,function(){var t=arguments,s;if(i){t[0]=new String(t[0]);for(s=0;s<i.length;++s)i[s]&&(t[0][i[s]]=t[s+1])}return r&&e.global&&(e.lastIndex=t[t.length-2]+t[0].length),n.apply(null,t)}):(u=String(this),o=s.replace.call(u,e,function(){var e=arguments;return s.replace.call(String(n),h,function(t,n,r){var s;if(n){s=+n;if(s<=e.length-3)return e[s]||"";s=i?S(i,n):-1;if(s<0)throw new SyntaxError("backreference to undefined group "+t);return e[s+1]||""}if(r==="$")return"$";if(r==="&"||+r===0)return e[0];if(r==="`")return e[e.length-1].slice(0,e[e.length-2]);if(r==="'")return e[e.length-1].slice(e[e.length-2]+e[0].length);r=+r;if(!isNaN(r)){if(r>e.length-3)throw new SyntaxError("backreference to undefined group "+t);return e[r]||""}throw new SyntaxError("invalid token "+t)})})),r&&(e.global?e.lastIndex=0:e.lastIndex=a),o},o.split=function(n,r){if(!t.isRegExp(n))return s.split.apply(this,arguments);var i=String(this),o=n.lastIndex,u=[],a=0,f;return r=(r===e?-1:r)>>>0,t.forEach(i,n,function(e){e.index+e[0].length>a&&(u.push(i.slice(a,e.index)),e.length>1&&e.index<i.length&&Array.prototype.push.apply(u,e.slice(1)),f=e[0].length,a=e.index+f)}),a===i.length?(!s.test.call(n,"")||f)&&u.push(""):u.push(i.slice(a)),n.lastIndex=o,u.length>r?u.slice(0,r):u},r=n.on,r(/\\([ABCE-RTUVXYZaeg-mopqyz]|c(?![A-Za-z])|u(?![\dA-Fa-f]{4})|x(?![\dA-Fa-f]{2}))/,function(e,t){if(e[1]==="B"&&t===f)return e[0];throw new SyntaxError("invalid escape "+e[0])},{scope:"all"}),r(/\[(\^?)]/,function(e){return e[1]?"[\\s\\S]":"\\b\\B"}),r(/(?:\(\?#[^)]*\))+/,function(e){return s.test.call(d,e.input.slice(e.index+e[0].length))?"":"(?:)"}),r(/\\k<([\w$]+)>/,function(e){var t=isNaN(e[1])?S(this.captureNames,e[1])+1:+e[1],n=e.index+e[0].length;if(!t||t>this.captureNames.length)throw new SyntaxError("backreference to undefined group "+e[0]);return"\\"+t+(n===e.input.length||isNaN(e.input.charAt(n))?"":"(?:)")}),r(/(?:\s+|#.*)+/,function(e){return s.test.call(d,e.input.slice(e.index+e[0].length))?"":"(?:)"},{trigger:function(){return this.hasFlag("x")},customFlags:"x"}),r(/\./,function(){return"[\\s\\S]"},{trigger:function(){return this.hasFlag("s")},customFlags:"s"}),r(/\(\?P?<([\w$]+)>/,function(e){if(!isNaN(e[1]))throw new SyntaxError("can't use integer as capture name "+e[0]);return this.captureNames.push(e[1]),this.hasNamedCapture=!0,"("}),r(/\\(\d+)/,function(e,t){if(!(t===f&&/^[1-9]/.test(e[1])&&+e[1]<=this.captureNames.length)&&e[1]!=="0")throw new SyntaxError("can't use octal escape or backreference to undefined group "+e[0]);return e[0]},{scope:"all"}),r(/\((?!\?)/,function(){return this.hasFlag("n")?"(?:":(this.captureNames.push(null),"(")},{customFlags:"n"}),typeof exports!="undefined"&&(exports.XRegExp=t),t}(),function(e){function n(e){return e.replace(/[- _]+/g,"").toLowerCase()}function r(e){return e.replace(/\w{4}/g,"\\u$&")}function i(e){while(e.length<4)e="0"+e;return e}function s(e){return parseInt(e,16)}function o(e){return parseInt(e,10).toString(16)}function u(t){var n=[],r=-1,u;return e.forEach(t,/\\u(\w{4})(?:-\\u(\w{4}))?/,function(e){u=s(e[1]),u>r+1&&(n.push("\\u"+i(o(r+1))),u>r+2&&n.push("-\\u"+i(o(u-1)))),r=s(e[2]||e[1])}),r<65535&&(n.push("\\u"+i(o(r+1))),r<65534&&n.push("-\\uFFFF")),n.join("")}function a(e){return t["^"+e]||(t["^"+e]=u(t[e]))}var t={};e.install("extensibility"),e.addUnicodePackage=function(i,s){var o;if(!e.isInstalled("extensibility"))throw new Error("extensibility must be installed before adding Unicode packages");if(i)for(o in i)i.hasOwnProperty(o)&&(t[n(o)]=r(i[o]));if(s)for(o in s)s.hasOwnProperty(o)&&(t[n(s[o])]=t[n(o)])},e.addUnicodePackage({L:"0041-005A0061-007A00AA00B500BA00C0-00D600D8-00F600F8-02C102C6-02D102E0-02E402EC02EE0370-037403760377037A-037D03860388-038A038C038E-03A103A3-03F503F7-0481048A-05270531-055605590561-058705D0-05EA05F0-05F20620-064A066E066F0671-06D306D506E506E606EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA07F407F507FA0800-0815081A082408280840-085808A008A2-08AC0904-0939093D09500958-09610971-09770979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10CF10CF20D05-0D0C0D0E-0D100D12-0D3A0D3D0D4E0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E460E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EC60EDC-0EDF0F000F40-0F470F49-0F6C0F88-0F8C1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10A0-10C510C710CD10D0-10FA10FC-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317D717DC1820-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541AA71B05-1B331B45-1B4B1B83-1BA01BAE1BAF1BBA-1BE51C00-1C231C4D-1C4F1C5A-1C7D1CE9-1CEC1CEE-1CF11CF51CF61D00-1DBF1E00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FBC1FBE1FC2-1FC41FC6-1FCC1FD0-1FD31FD6-1FDB1FE0-1FEC1FF2-1FF41FF6-1FFC2071207F2090-209C21022107210A-211321152119-211D212421262128212A-212D212F-2139213C-213F2145-2149214E218321842C00-2C2E2C30-2C5E2C60-2CE42CEB-2CEE2CF22CF32D00-2D252D272D2D2D30-2D672D6F2D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2E2F300530063031-3035303B303C3041-3096309D-309F30A1-30FA30FC-30FF3105-312D3131-318E31A0-31BA31F0-31FF3400-4DB54E00-9FCCA000-A48CA4D0-A4FDA500-A60CA610-A61FA62AA62BA640-A66EA67F-A697A6A0-A6E5A717-A71FA722-A788A78B-A78EA790-A793A7A0-A7AAA7F8-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2A9CFAA00-AA28AA40-AA42AA44-AA4BAA60-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADB-AADDAAE0-AAEAAAF2-AAF4AB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2EABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF21-FF3AFF41-FF5AFF66-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC"},{L:"Letter"}),e.addToken(/\\([pP]){(\^?)([^}]*)}/,function(e,r){var i=e[1]==="P"||e[2]?"^":"",s=n(e[3]);if(e[1]==="P"&&e[2])throw new SyntaxError("invalid double negation \\P{^");if(!t.hasOwnProperty(s))throw new SyntaxError("invalid or unknown Unicode property "+e[0]);return r==="class"?i?a(s):t[s]:"["+i+t[s]+"]"},{scope:"all"})}(XRegExp),function(e){if(!e.addUnicodePackage)throw new ReferenceError("Unicode Base must be loaded before Unicode Categories");e.install("extensibility"),e.addUnicodePackage({Ll:"0061-007A00B500DF-00F600F8-00FF01010103010501070109010B010D010F01110113011501170119011B011D011F01210123012501270129012B012D012F01310133013501370138013A013C013E014001420144014601480149014B014D014F01510153015501570159015B015D015F01610163016501670169016B016D016F0171017301750177017A017C017E-0180018301850188018C018D019201950199-019B019E01A101A301A501A801AA01AB01AD01B001B401B601B901BA01BD-01BF01C601C901CC01CE01D001D201D401D601D801DA01DC01DD01DF01E101E301E501E701E901EB01ED01EF01F001F301F501F901FB01FD01FF02010203020502070209020B020D020F02110213021502170219021B021D021F02210223022502270229022B022D022F02310233-0239023C023F0240024202470249024B024D024F-02930295-02AF037103730377037B-037D039003AC-03CE03D003D103D5-03D703D903DB03DD03DF03E103E303E503E703E903EB03ED03EF-03F303F503F803FB03FC0430-045F04610463046504670469046B046D046F04710473047504770479047B047D047F0481048B048D048F04910493049504970499049B049D049F04A104A304A504A704A904AB04AD04AF04B104B304B504B704B904BB04BD04BF04C204C404C604C804CA04CC04CE04CF04D104D304D504D704D904DB04DD04DF04E104E304E504E704E904EB04ED04EF04F104F304F504F704F904FB04FD04FF05010503050505070509050B050D050F05110513051505170519051B051D051F05210523052505270561-05871D00-1D2B1D6B-1D771D79-1D9A1E011E031E051E071E091E0B1E0D1E0F1E111E131E151E171E191E1B1E1D1E1F1E211E231E251E271E291E2B1E2D1E2F1E311E331E351E371E391E3B1E3D1E3F1E411E431E451E471E491E4B1E4D1E4F1E511E531E551E571E591E5B1E5D1E5F1E611E631E651E671E691E6B1E6D1E6F1E711E731E751E771E791E7B1E7D1E7F1E811E831E851E871E891E8B1E8D1E8F1E911E931E95-1E9D1E9F1EA11EA31EA51EA71EA91EAB1EAD1EAF1EB11EB31EB51EB71EB91EBB1EBD1EBF1EC11EC31EC51EC71EC91ECB1ECD1ECF1ED11ED31ED51ED71ED91EDB1EDD1EDF1EE11EE31EE51EE71EE91EEB1EED1EEF1EF11EF31EF51EF71EF91EFB1EFD1EFF-1F071F10-1F151F20-1F271F30-1F371F40-1F451F50-1F571F60-1F671F70-1F7D1F80-1F871F90-1F971FA0-1FA71FB0-1FB41FB61FB71FBE1FC2-1FC41FC61FC71FD0-1FD31FD61FD71FE0-1FE71FF2-1FF41FF61FF7210A210E210F2113212F21342139213C213D2146-2149214E21842C30-2C5E2C612C652C662C682C6A2C6C2C712C732C742C76-2C7B2C812C832C852C872C892C8B2C8D2C8F2C912C932C952C972C992C9B2C9D2C9F2CA12CA32CA52CA72CA92CAB2CAD2CAF2CB12CB32CB52CB72CB92CBB2CBD2CBF2CC12CC32CC52CC72CC92CCB2CCD2CCF2CD12CD32CD52CD72CD92CDB2CDD2CDF2CE12CE32CE42CEC2CEE2CF32D00-2D252D272D2DA641A643A645A647A649A64BA64DA64FA651A653A655A657A659A65BA65DA65FA661A663A665A667A669A66BA66DA681A683A685A687A689A68BA68DA68FA691A693A695A697A723A725A727A729A72BA72DA72F-A731A733A735A737A739A73BA73DA73FA741A743A745A747A749A74BA74DA74FA751A753A755A757A759A75BA75DA75FA761A763A765A767A769A76BA76DA76FA771-A778A77AA77CA77FA781A783A785A787A78CA78EA791A793A7A1A7A3A7A5A7A7A7A9A7FAFB00-FB06FB13-FB17FF41-FF5A",Lu:"0041-005A00C0-00D600D8-00DE01000102010401060108010A010C010E01100112011401160118011A011C011E01200122012401260128012A012C012E01300132013401360139013B013D013F0141014301450147014A014C014E01500152015401560158015A015C015E01600162016401660168016A016C016E017001720174017601780179017B017D018101820184018601870189-018B018E-0191019301940196-0198019C019D019F01A001A201A401A601A701A901AC01AE01AF01B1-01B301B501B701B801BC01C401C701CA01CD01CF01D101D301D501D701D901DB01DE01E001E201E401E601E801EA01EC01EE01F101F401F6-01F801FA01FC01FE02000202020402060208020A020C020E02100212021402160218021A021C021E02200222022402260228022A022C022E02300232023A023B023D023E02410243-02460248024A024C024E03700372037603860388-038A038C038E038F0391-03A103A3-03AB03CF03D2-03D403D803DA03DC03DE03E003E203E403E603E803EA03EC03EE03F403F703F903FA03FD-042F04600462046404660468046A046C046E04700472047404760478047A047C047E0480048A048C048E04900492049404960498049A049C049E04A004A204A404A604A804AA04AC04AE04B004B204B404B604B804BA04BC04BE04C004C104C304C504C704C904CB04CD04D004D204D404D604D804DA04DC04DE04E004E204E404E604E804EA04EC04EE04F004F204F404F604F804FA04FC04FE05000502050405060508050A050C050E05100512051405160518051A051C051E05200522052405260531-055610A0-10C510C710CD1E001E021E041E061E081E0A1E0C1E0E1E101E121E141E161E181E1A1E1C1E1E1E201E221E241E261E281E2A1E2C1E2E1E301E321E341E361E381E3A1E3C1E3E1E401E421E441E461E481E4A1E4C1E4E1E501E521E541E561E581E5A1E5C1E5E1E601E621E641E661E681E6A1E6C1E6E1E701E721E741E761E781E7A1E7C1E7E1E801E821E841E861E881E8A1E8C1E8E1E901E921E941E9E1EA01EA21EA41EA61EA81EAA1EAC1EAE1EB01EB21EB41EB61EB81EBA1EBC1EBE1EC01EC21EC41EC61EC81ECA1ECC1ECE1ED01ED21ED41ED61ED81EDA1EDC1EDE1EE01EE21EE41EE61EE81EEA1EEC1EEE1EF01EF21EF41EF61EF81EFA1EFC1EFE1F08-1F0F1F18-1F1D1F28-1F2F1F38-1F3F1F48-1F4D1F591F5B1F5D1F5F1F68-1F6F1FB8-1FBB1FC8-1FCB1FD8-1FDB1FE8-1FEC1FF8-1FFB21022107210B-210D2110-211221152119-211D212421262128212A-212D2130-2133213E213F214521832C00-2C2E2C602C62-2C642C672C692C6B2C6D-2C702C722C752C7E-2C802C822C842C862C882C8A2C8C2C8E2C902C922C942C962C982C9A2C9C2C9E2CA02CA22CA42CA62CA82CAA2CAC2CAE2CB02CB22CB42CB62CB82CBA2CBC2CBE2CC02CC22CC42CC62CC82CCA2CCC2CCE2CD02CD22CD42CD62CD82CDA2CDC2CDE2CE02CE22CEB2CED2CF2A640A642A644A646A648A64AA64CA64EA650A652A654A656A658A65AA65CA65EA660A662A664A666A668A66AA66CA680A682A684A686A688A68AA68CA68EA690A692A694A696A722A724A726A728A72AA72CA72EA732A734A736A738A73AA73CA73EA740A742A744A746A748A74AA74CA74EA750A752A754A756A758A75AA75CA75EA760A762A764A766A768A76AA76CA76EA779A77BA77DA77EA780A782A784A786A78BA78DA790A792A7A0A7A2A7A4A7A6A7A8A7AAFF21-FF3A",Lt:"01C501C801CB01F21F88-1F8F1F98-1F9F1FA8-1FAF1FBC1FCC1FFC",Lm:"02B0-02C102C6-02D102E0-02E402EC02EE0374037A0559064006E506E607F407F507FA081A0824082809710E460EC610FC17D718431AA71C78-1C7D1D2C-1D6A1D781D9B-1DBF2071207F2090-209C2C7C2C7D2D6F2E2F30053031-3035303B309D309E30FC-30FEA015A4F8-A4FDA60CA67FA717-A71FA770A788A7F8A7F9A9CFAA70AADDAAF3AAF4FF70FF9EFF9F",Lo:"00AA00BA01BB01C0-01C3029405D0-05EA05F0-05F20620-063F0641-064A066E066F0671-06D306D506EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA0800-08150840-085808A008A2-08AC0904-0939093D09500958-09610972-09770979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10CF10CF20D05-0D0C0D0E-0D100D12-0D3A0D3D0D4E0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E450E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EDC-0EDF0F000F40-0F470F49-0F6C0F88-0F8C1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10D0-10FA10FD-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317DC1820-18421844-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541B05-1B331B45-1B4B1B83-1BA01BAE1BAF1BBA-1BE51C00-1C231C4D-1C4F1C5A-1C771CE9-1CEC1CEE-1CF11CF51CF62135-21382D30-2D672D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE3006303C3041-3096309F30A1-30FA30FF3105-312D3131-318E31A0-31BA31F0-31FF3400-4DB54E00-9FCCA000-A014A016-A48CA4D0-A4F7A500-A60BA610-A61FA62AA62BA66EA6A0-A6E5A7FB-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2AA00-AA28AA40-AA42AA44-AA4BAA60-AA6FAA71-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADBAADCAAE0-AAEAAAF2AB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2EABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA6DFA70-FAD9FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF66-FF6FFF71-FF9DFFA0-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",M:"0300-036F0483-04890591-05BD05BF05C105C205C405C505C70610-061A064B-065F067006D6-06DC06DF-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0859-085B08E4-08FE0900-0903093A-093C093E-094F0951-0957096209630981-098309BC09BE-09C409C709C809CB-09CD09D709E209E30A01-0A030A3C0A3E-0A420A470A480A4B-0A4D0A510A700A710A750A81-0A830ABC0ABE-0AC50AC7-0AC90ACB-0ACD0AE20AE30B01-0B030B3C0B3E-0B440B470B480B4B-0B4D0B560B570B620B630B820BBE-0BC20BC6-0BC80BCA-0BCD0BD70C01-0C030C3E-0C440C46-0C480C4A-0C4D0C550C560C620C630C820C830CBC0CBE-0CC40CC6-0CC80CCA-0CCD0CD50CD60CE20CE30D020D030D3E-0D440D46-0D480D4A-0D4D0D570D620D630D820D830DCA0DCF-0DD40DD60DD8-0DDF0DF20DF30E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F3E0F3F0F71-0F840F860F870F8D-0F970F99-0FBC0FC6102B-103E1056-1059105E-10601062-10641067-106D1071-10741082-108D108F109A-109D135D-135F1712-17141732-1734175217531772177317B4-17D317DD180B-180D18A91920-192B1930-193B19B0-19C019C819C91A17-1A1B1A55-1A5E1A60-1A7C1A7F1B00-1B041B34-1B441B6B-1B731B80-1B821BA1-1BAD1BE6-1BF31C24-1C371CD0-1CD21CD4-1CE81CED1CF2-1CF41DC0-1DE61DFC-1DFF20D0-20F02CEF-2CF12D7F2DE0-2DFF302A-302F3099309AA66F-A672A674-A67DA69FA6F0A6F1A802A806A80BA823-A827A880A881A8B4-A8C4A8E0-A8F1A926-A92DA947-A953A980-A983A9B3-A9C0AA29-AA36AA43AA4CAA4DAA7BAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1AAEB-AAEFAAF5AAF6ABE3-ABEAABECABEDFB1EFE00-FE0FFE20-FE26",Mn:"0300-036F0483-04870591-05BD05BF05C105C205C405C505C70610-061A064B-065F067006D6-06DC06DF-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0859-085B08E4-08FE0900-0902093A093C0941-0948094D0951-095709620963098109BC09C1-09C409CD09E209E30A010A020A3C0A410A420A470A480A4B-0A4D0A510A700A710A750A810A820ABC0AC1-0AC50AC70AC80ACD0AE20AE30B010B3C0B3F0B41-0B440B4D0B560B620B630B820BC00BCD0C3E-0C400C46-0C480C4A-0C4D0C550C560C620C630CBC0CBF0CC60CCC0CCD0CE20CE30D41-0D440D4D0D620D630DCA0DD2-0DD40DD60E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F71-0F7E0F80-0F840F860F870F8D-0F970F99-0FBC0FC6102D-10301032-10371039103A103D103E10581059105E-10601071-1074108210851086108D109D135D-135F1712-17141732-1734175217531772177317B417B517B7-17BD17C617C9-17D317DD180B-180D18A91920-19221927192819321939-193B1A171A181A561A58-1A5E1A601A621A65-1A6C1A73-1A7C1A7F1B00-1B031B341B36-1B3A1B3C1B421B6B-1B731B801B811BA2-1BA51BA81BA91BAB1BE61BE81BE91BED1BEF-1BF11C2C-1C331C361C371CD0-1CD21CD4-1CE01CE2-1CE81CED1CF41DC0-1DE61DFC-1DFF20D0-20DC20E120E5-20F02CEF-2CF12D7F2DE0-2DFF302A-302D3099309AA66FA674-A67DA69FA6F0A6F1A802A806A80BA825A826A8C4A8E0-A8F1A926-A92DA947-A951A980-A982A9B3A9B6-A9B9A9BCAA29-AA2EAA31AA32AA35AA36AA43AA4CAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1AAECAAEDAAF6ABE5ABE8ABEDFB1EFE00-FE0FFE20-FE26",Mc:"0903093B093E-09400949-094C094E094F0982098309BE-09C009C709C809CB09CC09D70A030A3E-0A400A830ABE-0AC00AC90ACB0ACC0B020B030B3E0B400B470B480B4B0B4C0B570BBE0BBF0BC10BC20BC6-0BC80BCA-0BCC0BD70C01-0C030C41-0C440C820C830CBE0CC0-0CC40CC70CC80CCA0CCB0CD50CD60D020D030D3E-0D400D46-0D480D4A-0D4C0D570D820D830DCF-0DD10DD8-0DDF0DF20DF30F3E0F3F0F7F102B102C10311038103B103C105610571062-10641067-106D108310841087-108C108F109A-109C17B617BE-17C517C717C81923-19261929-192B193019311933-193819B0-19C019C819C91A19-1A1B1A551A571A611A631A641A6D-1A721B041B351B3B1B3D-1B411B431B441B821BA11BA61BA71BAA1BAC1BAD1BE71BEA-1BEC1BEE1BF21BF31C24-1C2B1C341C351CE11CF21CF3302E302FA823A824A827A880A881A8B4-A8C3A952A953A983A9B4A9B5A9BAA9BBA9BD-A9C0AA2FAA30AA33AA34AA4DAA7BAAEBAAEEAAEFAAF5ABE3ABE4ABE6ABE7ABE9ABEAABEC",Me:"0488048920DD-20E020E2-20E4A670-A672",N:"0030-003900B200B300B900BC-00BE0660-066906F0-06F907C0-07C90966-096F09E6-09EF09F4-09F90A66-0A6F0AE6-0AEF0B66-0B6F0B72-0B770BE6-0BF20C66-0C6F0C78-0C7E0CE6-0CEF0D66-0D750E50-0E590ED0-0ED90F20-0F331040-10491090-10991369-137C16EE-16F017E0-17E917F0-17F91810-18191946-194F19D0-19DA1A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C5920702074-20792080-20892150-21822185-21892460-249B24EA-24FF2776-27932CFD30073021-30293038-303A3192-31953220-32293248-324F3251-325F3280-328932B1-32BFA620-A629A6E6-A6EFA830-A835A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",Nd:"0030-00390660-066906F0-06F907C0-07C90966-096F09E6-09EF0A66-0A6F0AE6-0AEF0B66-0B6F0BE6-0BEF0C66-0C6F0CE6-0CEF0D66-0D6F0E50-0E590ED0-0ED90F20-0F291040-10491090-109917E0-17E91810-18191946-194F19D0-19D91A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C59A620-A629A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",Nl:"16EE-16F02160-21822185-218830073021-30293038-303AA6E6-A6EF",No:"00B200B300B900BC-00BE09F4-09F90B72-0B770BF0-0BF20C78-0C7E0D70-0D750F2A-0F331369-137C17F0-17F919DA20702074-20792080-20892150-215F21892460-249B24EA-24FF2776-27932CFD3192-31953220-32293248-324F3251-325F3280-328932B1-32BFA830-A835",P:"0021-00230025-002A002C-002F003A003B003F0040005B-005D005F007B007D00A100A700AB00B600B700BB00BF037E0387055A-055F0589058A05BE05C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E085E0964096509700AF00DF40E4F0E5A0E5B0F04-0F120F140F3A-0F3D0F850FD0-0FD40FD90FDA104A-104F10FB1360-13681400166D166E169B169C16EB-16ED1735173617D4-17D617D8-17DA1800-180A194419451A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601BFC-1BFF1C3B-1C3F1C7E1C7F1CC0-1CC71CD32010-20272030-20432045-20512053-205E207D207E208D208E2329232A2768-277527C527C627E6-27EF2983-299829D8-29DB29FC29FD2CF9-2CFC2CFE2CFF2D702E00-2E2E2E30-2E3B3001-30033008-30113014-301F3030303D30A030FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFAAF0AAF1ABEBFD3EFD3FFE10-FE19FE30-FE52FE54-FE61FE63FE68FE6AFE6BFF01-FF03FF05-FF0AFF0C-FF0FFF1AFF1BFF1FFF20FF3B-FF3DFF3FFF5BFF5DFF5F-FF65",Pd:"002D058A05BE140018062010-20152E172E1A2E3A2E3B301C303030A0FE31FE32FE58FE63FF0D",Ps:"0028005B007B0F3A0F3C169B201A201E2045207D208D23292768276A276C276E27702772277427C527E627E827EA27EC27EE2983298529872989298B298D298F299129932995299729D829DA29FC2E222E242E262E283008300A300C300E3010301430163018301A301DFD3EFE17FE35FE37FE39FE3BFE3DFE3FFE41FE43FE47FE59FE5BFE5DFF08FF3BFF5BFF5FFF62",Pe:"0029005D007D0F3B0F3D169C2046207E208E232A2769276B276D276F27712773277527C627E727E927EB27ED27EF298429862988298A298C298E2990299229942996299829D929DB29FD2E232E252E272E293009300B300D300F3011301530173019301B301E301FFD3FFE18FE36FE38FE3AFE3CFE3EFE40FE42FE44FE48FE5AFE5CFE5EFF09FF3DFF5DFF60FF63",Pi:"00AB2018201B201C201F20392E022E042E092E0C2E1C2E20",Pf:"00BB2019201D203A2E032E052E0A2E0D2E1D2E21",Pc:"005F203F20402054FE33FE34FE4D-FE4FFF3F",Po:"0021-00230025-0027002A002C002E002F003A003B003F0040005C00A100A700B600B700BF037E0387055A-055F058905C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E085E0964096509700AF00DF40E4F0E5A0E5B0F04-0F120F140F850FD0-0FD40FD90FDA104A-104F10FB1360-1368166D166E16EB-16ED1735173617D4-17D617D8-17DA1800-18051807-180A194419451A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601BFC-1BFF1C3B-1C3F1C7E1C7F1CC0-1CC71CD3201620172020-20272030-2038203B-203E2041-20432047-205120532055-205E2CF9-2CFC2CFE2CFF2D702E002E012E06-2E082E0B2E0E-2E162E182E192E1B2E1E2E1F2E2A-2E2E2E30-2E393001-3003303D30FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFAAF0AAF1ABEBFE10-FE16FE19FE30FE45FE46FE49-FE4CFE50-FE52FE54-FE57FE5F-FE61FE68FE6AFE6BFF01-FF03FF05-FF07FF0AFF0CFF0EFF0FFF1AFF1BFF1FFF20FF3CFF61FF64FF65",S:"0024002B003C-003E005E0060007C007E00A2-00A600A800A900AC00AE-00B100B400B800D700F702C2-02C502D2-02DF02E5-02EB02ED02EF-02FF03750384038503F60482058F0606-0608060B060E060F06DE06E906FD06FE07F609F209F309FA09FB0AF10B700BF3-0BFA0C7F0D790E3F0F01-0F030F130F15-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F1390-139917DB194019DE-19FF1B61-1B6A1B74-1B7C1FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE20442052207A-207C208A-208C20A0-20B9210021012103-21062108210921142116-2118211E-2123212521272129212E213A213B2140-2144214A-214D214F2190-2328232B-23F32400-24262440-244A249C-24E92500-26FF2701-27672794-27C427C7-27E527F0-29822999-29D729DC-29FB29FE-2B4C2B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F309B309C319031913196-319F31C0-31E33200-321E322A-324732503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A700-A716A720A721A789A78AA828-A82BA836-A839AA77-AA79FB29FBB2-FBC1FDFCFDFDFE62FE64-FE66FE69FF04FF0BFF1C-FF1EFF3EFF40FF5CFF5EFFE0-FFE6FFE8-FFEEFFFCFFFD",Sm:"002B003C-003E007C007E00AC00B100D700F703F60606-060820442052207A-207C208A-208C21182140-2144214B2190-2194219A219B21A021A321A621AE21CE21CF21D221D421F4-22FF2308-230B23202321237C239B-23B323DC-23E125B725C125F8-25FF266F27C0-27C427C7-27E527F0-27FF2900-29822999-29D729DC-29FB29FE-2AFF2B30-2B442B47-2B4CFB29FE62FE64-FE66FF0BFF1C-FF1EFF5CFF5EFFE2FFE9-FFEC",Sc:"002400A2-00A5058F060B09F209F309FB0AF10BF90E3F17DB20A0-20B9A838FDFCFE69FF04FFE0FFE1FFE5FFE6",Sk:"005E006000A800AF00B400B802C2-02C502D2-02DF02E5-02EB02ED02EF-02FF0375038403851FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE309B309CA700-A716A720A721A789A78AFBB2-FBC1FF3EFF40FFE3",So:"00A600A900AE00B00482060E060F06DE06E906FD06FE07F609FA0B700BF3-0BF80BFA0C7F0D790F01-0F030F130F15-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F1390-1399194019DE-19FF1B61-1B6A1B74-1B7C210021012103-210621082109211421162117211E-2123212521272129212E213A213B214A214C214D214F2195-2199219C-219F21A121A221A421A521A7-21AD21AF-21CD21D021D121D321D5-21F32300-2307230C-231F2322-2328232B-237B237D-239A23B4-23DB23E2-23F32400-24262440-244A249C-24E92500-25B625B8-25C025C2-25F72600-266E2670-26FF2701-27672794-27BF2800-28FF2B00-2B2F2B452B462B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F319031913196-319F31C0-31E33200-321E322A-324732503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A828-A82BA836A837A839AA77-AA79FDFDFFE4FFE8FFEDFFEEFFFCFFFD",Z:"002000A01680180E2000-200A20282029202F205F3000",Zs:"002000A01680180E2000-200A202F205F3000",Zl:"2028",Zp:"2029",C:"0000-001F007F-009F00AD03780379037F-0383038B038D03A20528-05300557055805600588058B-058E059005C8-05CF05EB-05EF05F5-0605061C061D06DD070E070F074B074C07B2-07BF07FB-07FF082E082F083F085C085D085F-089F08A108AD-08E308FF097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B78-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D3B0D3C0D450D490D4F-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EE0-0EFF0F480F6D-0F700F980FBD0FCD0FDB-0FFF10C610C8-10CC10CE10CF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B135C137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BF4-1BFB1C38-1C3A1C4A-1C4C1C80-1CBF1CC8-1CCF1CF7-1CFF1DE7-1DFB1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF200B-200F202A-202E2060-206F20722073208F209D-209F20BA-20CF20F1-20FF218A-218F23F4-23FF2427-243F244B-245F27002B4D-2B4F2B5A-2BFF2C2F2C5F2CF4-2CF82D262D28-2D2C2D2E2D2F2D68-2D6E2D71-2D7E2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E3C-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31BB-31BF31E4-31EF321F32FF4DB6-4DBF9FCD-9FFFA48D-A48FA4C7-A4CFA62C-A63FA698-A69EA6F8-A6FFA78FA794-A79FA7AB-A7F7A82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAF7-AB00AB07AB08AB0FAB10AB17-AB1FAB27AB2F-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-F8FFFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBC2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFD-FF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFFBFFFEFFFF",Cc:"0000-001F007F-009F",Cf:"00AD0600-060406DD070F200B-200F202A-202E2060-2064206A-206FFEFFFFF9-FFFB",Co:"E000-F8FF",Cs:"D800-DFFF",Cn:"03780379037F-0383038B038D03A20528-05300557055805600588058B-058E059005C8-05CF05EB-05EF05F5-05FF0605061C061D070E074B074C07B2-07BF07FB-07FF082E082F083F085C085D085F-089F08A108AD-08E308FF097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B78-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D3B0D3C0D450D490D4F-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EE0-0EFF0F480F6D-0F700F980FBD0FCD0FDB-0FFF10C610C8-10CC10CE10CF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B135C137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BF4-1BFB1C38-1C3A1C4A-1C4C1C80-1CBF1CC8-1CCF1CF7-1CFF1DE7-1DFB1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF2065-206920722073208F209D-209F20BA-20CF20F1-20FF218A-218F23F4-23FF2427-243F244B-245F27002B4D-2B4F2B5A-2BFF2C2F2C5F2CF4-2CF82D262D28-2D2C2D2E2D2F2D68-2D6E2D71-2D7E2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E3C-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31BB-31BF31E4-31EF321F32FF4DB6-4DBF9FCD-9FFFA48D-A48FA4C7-A4CFA62C-A63FA698-A69EA6F8-A6FFA78FA794-A79FA7AB-A7F7A82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAF7-AB00AB07AB08AB0FAB10AB17-AB1FAB27AB2F-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-D7FFFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBC2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFDFEFEFF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFF8FFFEFFFF"},{Ll:"Lowercase_Letter",Lu:"Uppercase_Letter",Lt:"Titlecase_Letter",Lm:"Modifier_Letter",Lo:"Other_Letter",M:"Mark",Mn:"Nonspacing_Mark",Mc:"Spacing_Mark",Me:"Enclosing_Mark",N:"Number",Nd:"Decimal_Number",Nl:"Letter_Number",No:"Other_Number",P:"Punctuation",Pd:"Dash_Punctuation",Ps:"Open_Punctuation",Pe:"Close_Punctuation",Pi:"Initial_Punctuation",Pf:"Final_Punctuation",Pc:"Connector_Punctuation",Po:"Other_Punctuation",S:"Symbol",Sm:"Math_Symbol",Sc:"Currency_Symbol",Sk:"Modifier_Symbol",So:"Other_Symbol",Z:"Separator",Zs:"Space_Separator",Zl:"Line_Separator",Zp:"Paragraph_Separator",C:"Other",Cc:"Control",Cf:"Format",Co:"Private_Use",Cs:"Surrogate",Cn:"Unassigned"})}(XRegExp),function(e){if(!e.addUnicodePackage)throw new ReferenceError("Unicode Base must be loaded before Unicode Scripts");e.install("extensibility"),e.addUnicodePackage({Arabic:"0600-06040606-060B060D-061A061E0620-063F0641-064A0656-065E066A-066F0671-06DC06DE-06FF0750-077F08A008A2-08AC08E4-08FEFB50-FBC1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFCFE70-FE74FE76-FEFC",Armenian:"0531-05560559-055F0561-0587058A058FFB13-FB17",Balinese:"1B00-1B4B1B50-1B7C",Bamum:"A6A0-A6F7",Batak:"1BC0-1BF31BFC-1BFF",Bengali:"0981-09830985-098C098F09900993-09A809AA-09B009B209B6-09B909BC-09C409C709C809CB-09CE09D709DC09DD09DF-09E309E6-09FB",Bopomofo:"02EA02EB3105-312D31A0-31BA",Braille:"2800-28FF",Buginese:"1A00-1A1B1A1E1A1F",Buhid:"1740-1753",Canadian_Aboriginal:"1400-167F18B0-18F5",Cham:"AA00-AA36AA40-AA4DAA50-AA59AA5C-AA5F",Cherokee:"13A0-13F4",Common:"0000-0040005B-0060007B-00A900AB-00B900BB-00BF00D700F702B9-02DF02E5-02E902EC-02FF0374037E038503870589060C061B061F06400660-066906DD096409650E3F0FD5-0FD810FB16EB-16ED173517361802180318051CD31CE11CE9-1CEC1CEE-1CF31CF51CF62000-200B200E-2064206A-20702074-207E2080-208E20A0-20B92100-21252127-2129212C-21312133-214D214F-215F21892190-23F32400-24262440-244A2460-26FF2701-27FF2900-2B4C2B50-2B592E00-2E3B2FF0-2FFB3000-300430063008-30203030-3037303C-303F309B309C30A030FB30FC3190-319F31C0-31E33220-325F327F-32CF3358-33FF4DC0-4DFFA700-A721A788-A78AA830-A839FD3EFD3FFDFDFE10-FE19FE30-FE52FE54-FE66FE68-FE6BFEFFFF01-FF20FF3B-FF40FF5B-FF65FF70FF9EFF9FFFE0-FFE6FFE8-FFEEFFF9-FFFD",Coptic:"03E2-03EF2C80-2CF32CF9-2CFF",Cyrillic:"0400-04840487-05271D2B1D782DE0-2DFFA640-A697A69F",Devanagari:"0900-09500953-09630966-09770979-097FA8E0-A8FB",Ethiopic:"1200-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A135D-137C1380-13992D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDEAB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2E",Georgian:"10A0-10C510C710CD10D0-10FA10FC-10FF2D00-2D252D272D2D",Glagolitic:"2C00-2C2E2C30-2C5E",Greek:"0370-03730375-0377037A-037D038403860388-038A038C038E-03A103A3-03E103F0-03FF1D26-1D2A1D5D-1D611D66-1D6A1DBF1F00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FC41FC6-1FD31FD6-1FDB1FDD-1FEF1FF2-1FF41FF6-1FFE2126",Gujarati:"0A81-0A830A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABC-0AC50AC7-0AC90ACB-0ACD0AD00AE0-0AE30AE6-0AF1",Gurmukhi:"0A01-0A030A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A3C0A3E-0A420A470A480A4B-0A4D0A510A59-0A5C0A5E0A66-0A75",Han:"2E80-2E992E9B-2EF32F00-2FD5300530073021-30293038-303B3400-4DB54E00-9FCCF900-FA6DFA70-FAD9",Hangul:"1100-11FF302E302F3131-318E3200-321E3260-327EA960-A97CAC00-D7A3D7B0-D7C6D7CB-D7FBFFA0-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",Hanunoo:"1720-1734",Hebrew:"0591-05C705D0-05EA05F0-05F4FB1D-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FB4F",Hiragana:"3041-3096309D-309F",Inherited:"0300-036F04850486064B-0655065F0670095109521CD0-1CD21CD4-1CE01CE2-1CE81CED1CF41DC0-1DE61DFC-1DFF200C200D20D0-20F0302A-302D3099309AFE00-FE0FFE20-FE26",Javanese:"A980-A9CDA9CF-A9D9A9DEA9DF",Kannada:"0C820C830C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBC-0CC40CC6-0CC80CCA-0CCD0CD50CD60CDE0CE0-0CE30CE6-0CEF0CF10CF2",Katakana:"30A1-30FA30FD-30FF31F0-31FF32D0-32FE3300-3357FF66-FF6FFF71-FF9D",Kayah_Li:"A900-A92F",Khmer:"1780-17DD17E0-17E917F0-17F919E0-19FF",Lao:"0E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB90EBB-0EBD0EC0-0EC40EC60EC8-0ECD0ED0-0ED90EDC-0EDF",Latin:"0041-005A0061-007A00AA00BA00C0-00D600D8-00F600F8-02B802E0-02E41D00-1D251D2C-1D5C1D62-1D651D6B-1D771D79-1DBE1E00-1EFF2071207F2090-209C212A212B2132214E2160-21882C60-2C7FA722-A787A78B-A78EA790-A793A7A0-A7AAA7F8-A7FFFB00-FB06FF21-FF3AFF41-FF5A",Lepcha:"1C00-1C371C3B-1C491C4D-1C4F",Limbu:"1900-191C1920-192B1930-193B19401944-194F",Lisu:"A4D0-A4FF",Malayalam:"0D020D030D05-0D0C0D0E-0D100D12-0D3A0D3D-0D440D46-0D480D4A-0D4E0D570D60-0D630D66-0D750D79-0D7F",Mandaic:"0840-085B085E",Meetei_Mayek:"AAE0-AAF6ABC0-ABEDABF0-ABF9",Mongolian:"1800180118041806-180E1810-18191820-18771880-18AA",Myanmar:"1000-109FAA60-AA7B",New_Tai_Lue:"1980-19AB19B0-19C919D0-19DA19DE19DF",Nko:"07C0-07FA",Ogham:"1680-169C",Ol_Chiki:"1C50-1C7F",Oriya:"0B01-0B030B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3C-0B440B470B480B4B-0B4D0B560B570B5C0B5D0B5F-0B630B66-0B77",Phags_Pa:"A840-A877",Rejang:"A930-A953A95F",Runic:"16A0-16EA16EE-16F0",Samaritan:"0800-082D0830-083E",Saurashtra:"A880-A8C4A8CE-A8D9",Sinhala:"0D820D830D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60DCA0DCF-0DD40DD60DD8-0DDF0DF2-0DF4",Sundanese:"1B80-1BBF1CC0-1CC7",Syloti_Nagri:"A800-A82B",Syriac:"0700-070D070F-074A074D-074F",Tagalog:"1700-170C170E-1714",Tagbanwa:"1760-176C176E-177017721773",Tai_Le:"1950-196D1970-1974",Tai_Tham:"1A20-1A5E1A60-1A7C1A7F-1A891A90-1A991AA0-1AAD",Tai_Viet:"AA80-AAC2AADB-AADF",Tamil:"0B820B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BBE-0BC20BC6-0BC80BCA-0BCD0BD00BD70BE6-0BFA",Telugu:"0C01-0C030C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D-0C440C46-0C480C4A-0C4D0C550C560C580C590C60-0C630C66-0C6F0C78-0C7F",Thaana:"0780-07B1",Thai:"0E01-0E3A0E40-0E5B",Tibetan:"0F00-0F470F49-0F6C0F71-0F970F99-0FBC0FBE-0FCC0FCE-0FD40FD90FDA",Tifinagh:"2D30-2D672D6F2D702D7F",Vai:"A500-A62B",Yi:"A000-A48CA490-A4C6"})}(XRegExp),function(e){if(!e.addUnicodePackage)throw new ReferenceError("Unicode Base must be loaded before Unicode Blocks");e.install("extensibility"),e.addUnicodePackage({InBasic_Latin:"0000-007F",InLatin_1_Supplement:"0080-00FF",InLatin_Extended_A:"0100-017F",InLatin_Extended_B:"0180-024F",InIPA_Extensions:"0250-02AF",InSpacing_Modifier_Letters:"02B0-02FF",InCombining_Diacritical_Marks:"0300-036F",InGreek_and_Coptic:"0370-03FF",InCyrillic:"0400-04FF",InCyrillic_Supplement:"0500-052F",InArmenian:"0530-058F",InHebrew:"0590-05FF",InArabic:"0600-06FF",InSyriac:"0700-074F",InArabic_Supplement:"0750-077F",InThaana:"0780-07BF",InNKo:"07C0-07FF",InSamaritan:"0800-083F",InMandaic:"0840-085F",InArabic_Extended_A:"08A0-08FF",InDevanagari:"0900-097F",InBengali:"0980-09FF",InGurmukhi:"0A00-0A7F",InGujarati:"0A80-0AFF",InOriya:"0B00-0B7F",InTamil:"0B80-0BFF",InTelugu:"0C00-0C7F",InKannada:"0C80-0CFF",InMalayalam:"0D00-0D7F",InSinhala:"0D80-0DFF",InThai:"0E00-0E7F",InLao:"0E80-0EFF",InTibetan:"0F00-0FFF",InMyanmar:"1000-109F",InGeorgian:"10A0-10FF",InHangul_Jamo:"1100-11FF",InEthiopic:"1200-137F",InEthiopic_Supplement:"1380-139F",InCherokee:"13A0-13FF",InUnified_Canadian_Aboriginal_Syllabics:"1400-167F",InOgham:"1680-169F",InRunic:"16A0-16FF",InTagalog:"1700-171F",InHanunoo:"1720-173F",InBuhid:"1740-175F",InTagbanwa:"1760-177F",InKhmer:"1780-17FF",InMongolian:"1800-18AF",InUnified_Canadian_Aboriginal_Syllabics_Extended:"18B0-18FF",InLimbu:"1900-194F",InTai_Le:"1950-197F",InNew_Tai_Lue:"1980-19DF",InKhmer_Symbols:"19E0-19FF",InBuginese:"1A00-1A1F",InTai_Tham:"1A20-1AAF",InBalinese:"1B00-1B7F",InSundanese:"1B80-1BBF",InBatak:"1BC0-1BFF",InLepcha:"1C00-1C4F",InOl_Chiki:"1C50-1C7F",InSundanese_Supplement:"1CC0-1CCF",InVedic_Extensions:"1CD0-1CFF",InPhonetic_Extensions:"1D00-1D7F",InPhonetic_Extensions_Supplement:"1D80-1DBF",InCombining_Diacritical_Marks_Supplement:"1DC0-1DFF",InLatin_Extended_Additional:"1E00-1EFF",InGreek_Extended:"1F00-1FFF",InGeneral_Punctuation:"2000-206F",InSuperscripts_and_Subscripts:"2070-209F",InCurrency_Symbols:"20A0-20CF",InCombining_Diacritical_Marks_for_Symbols:"20D0-20FF",InLetterlike_Symbols:"2100-214F",InNumber_Forms:"2150-218F",InArrows:"2190-21FF",InMathematical_Operators:"2200-22FF",InMiscellaneous_Technical:"2300-23FF",InControl_Pictures:"2400-243F",InOptical_Character_Recognition:"2440-245F",InEnclosed_Alphanumerics:"2460-24FF",InBox_Drawing:"2500-257F",InBlock_Elements:"2580-259F",InGeometric_Shapes:"25A0-25FF",InMiscellaneous_Symbols:"2600-26FF",InDingbats:"2700-27BF",InMiscellaneous_Mathematical_Symbols_A:"27C0-27EF",InSupplemental_Arrows_A:"27F0-27FF",InBraille_Patterns:"2800-28FF",InSupplemental_Arrows_B:"2900-297F",InMiscellaneous_Mathematical_Symbols_B:"2980-29FF",InSupplemental_Mathematical_Operators:"2A00-2AFF",InMiscellaneous_Symbols_and_Arrows:"2B00-2BFF",InGlagolitic:"2C00-2C5F",InLatin_Extended_C:"2C60-2C7F",InCoptic:"2C80-2CFF",InGeorgian_Supplement:"2D00-2D2F",InTifinagh:"2D30-2D7F",InEthiopic_Extended:"2D80-2DDF",InCyrillic_Extended_A:"2DE0-2DFF",InSupplemental_Punctuation:"2E00-2E7F",InCJK_Radicals_Supplement:"2E80-2EFF",InKangxi_Radicals:"2F00-2FDF",InIdeographic_Description_Characters:"2FF0-2FFF",InCJK_Symbols_and_Punctuation:"3000-303F",InHiragana:"3040-309F",InKatakana:"30A0-30FF",InBopomofo:"3100-312F",InHangul_Compatibility_Jamo:"3130-318F",InKanbun:"3190-319F",InBopomofo_Extended:"31A0-31BF",InCJK_Strokes:"31C0-31EF",InKatakana_Phonetic_Extensions:"31F0-31FF",InEnclosed_CJK_Letters_and_Months:"3200-32FF",InCJK_Compatibility:"3300-33FF",InCJK_Unified_Ideographs_Extension_A:"3400-4DBF",InYijing_Hexagram_Symbols:"4DC0-4DFF",InCJK_Unified_Ideographs:"4E00-9FFF",InYi_Syllables:"A000-A48F",InYi_Radicals:"A490-A4CF",InLisu:"A4D0-A4FF",InVai:"A500-A63F",InCyrillic_Extended_B:"A640-A69F",InBamum:"A6A0-A6FF",InModifier_Tone_Letters:"A700-A71F",InLatin_Extended_D:"A720-A7FF",InSyloti_Nagri:"A800-A82F",InCommon_Indic_Number_Forms:"A830-A83F",InPhags_pa:"A840-A87F",InSaurashtra:"A880-A8DF",InDevanagari_Extended:"A8E0-A8FF",InKayah_Li:"A900-A92F",InRejang:"A930-A95F",InHangul_Jamo_Extended_A:"A960-A97F",InJavanese:"A980-A9DF",InCham:"AA00-AA5F",InMyanmar_Extended_A:"AA60-AA7F",InTai_Viet:"AA80-AADF",InMeetei_Mayek_Extensions:"AAE0-AAFF",InEthiopic_Extended_A:"AB00-AB2F",InMeetei_Mayek:"ABC0-ABFF",InHangul_Syllables:"AC00-D7AF",InHangul_Jamo_Extended_B:"D7B0-D7FF",InHigh_Surrogates:"D800-DB7F",InHigh_Private_Use_Surrogates:"DB80-DBFF",InLow_Surrogates:"DC00-DFFF",InPrivate_Use_Area:"E000-F8FF",InCJK_Compatibility_Ideographs:"F900-FAFF",InAlphabetic_Presentation_Forms:"FB00-FB4F",InArabic_Presentation_Forms_A:"FB50-FDFF",InVariation_Selectors:"FE00-FE0F",InVertical_Forms:"FE10-FE1F",InCombining_Half_Marks:"FE20-FE2F",InCJK_Compatibility_Forms:"FE30-FE4F",InSmall_Form_Variants:"FE50-FE6F",InArabic_Presentation_Forms_B:"FE70-FEFF",InHalfwidth_and_Fullwidth_Forms:"FF00-FFEF",InSpecials:"FFF0-FFFF"})}(XRegExp),function(e){if(!e.addUnicodePackage)throw new ReferenceError("Unicode Base must be loaded before Unicode Properties");e.install("extensibility"),e.addUnicodePackage({Alphabetic:"0041-005A0061-007A00AA00B500BA00C0-00D600D8-00F600F8-02C102C6-02D102E0-02E402EC02EE03450370-037403760377037A-037D03860388-038A038C038E-03A103A3-03F503F7-0481048A-05270531-055605590561-058705B0-05BD05BF05C105C205C405C505C705D0-05EA05F0-05F20610-061A0620-06570659-065F066E-06D306D5-06DC06E1-06E806ED-06EF06FA-06FC06FF0710-073F074D-07B107CA-07EA07F407F507FA0800-0817081A-082C0840-085808A008A2-08AC08E4-08E908F0-08FE0900-093B093D-094C094E-09500955-09630971-09770979-097F0981-09830985-098C098F09900993-09A809AA-09B009B209B6-09B909BD-09C409C709C809CB09CC09CE09D709DC09DD09DF-09E309F009F10A01-0A030A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A3E-0A420A470A480A4B0A4C0A510A59-0A5C0A5E0A70-0A750A81-0A830A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD-0AC50AC7-0AC90ACB0ACC0AD00AE0-0AE30B01-0B030B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D-0B440B470B480B4B0B4C0B560B570B5C0B5D0B5F-0B630B710B820B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BBE-0BC20BC6-0BC80BCA-0BCC0BD00BD70C01-0C030C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D-0C440C46-0C480C4A-0C4C0C550C560C580C590C60-0C630C820C830C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD-0CC40CC6-0CC80CCA-0CCC0CD50CD60CDE0CE0-0CE30CF10CF20D020D030D05-0D0C0D0E-0D100D12-0D3A0D3D-0D440D46-0D480D4A-0D4C0D4E0D570D60-0D630D7A-0D7F0D820D830D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60DCF-0DD40DD60DD8-0DDF0DF20DF30E01-0E3A0E40-0E460E4D0E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB90EBB-0EBD0EC0-0EC40EC60ECD0EDC-0EDF0F000F40-0F470F49-0F6C0F71-0F810F88-0F970F99-0FBC1000-10361038103B-103F1050-10621065-1068106E-1086108E109C109D10A0-10C510C710CD10D0-10FA10FC-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A135F1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA16EE-16F01700-170C170E-17131720-17331740-17531760-176C176E-1770177217731780-17B317B6-17C817D717DC1820-18771880-18AA18B0-18F51900-191C1920-192B1930-19381950-196D1970-19741980-19AB19B0-19C91A00-1A1B1A20-1A5E1A61-1A741AA71B00-1B331B35-1B431B45-1B4B1B80-1BA91BAC-1BAF1BBA-1BE51BE7-1BF11C00-1C351C4D-1C4F1C5A-1C7D1CE9-1CEC1CEE-1CF31CF51CF61D00-1DBF1E00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FBC1FBE1FC2-1FC41FC6-1FCC1FD0-1FD31FD6-1FDB1FE0-1FEC1FF2-1FF41FF6-1FFC2071207F2090-209C21022107210A-211321152119-211D212421262128212A-212D212F-2139213C-213F2145-2149214E2160-218824B6-24E92C00-2C2E2C30-2C5E2C60-2CE42CEB-2CEE2CF22CF32D00-2D252D272D2D2D30-2D672D6F2D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2DE0-2DFF2E2F3005-30073021-30293031-30353038-303C3041-3096309D-309F30A1-30FA30FC-30FF3105-312D3131-318E31A0-31BA31F0-31FF3400-4DB54E00-9FCCA000-A48CA4D0-A4FDA500-A60CA610-A61FA62AA62BA640-A66EA674-A67BA67F-A697A69F-A6EFA717-A71FA722-A788A78B-A78EA790-A793A7A0-A7AAA7F8-A801A803-A805A807-A80AA80C-A827A840-A873A880-A8C3A8F2-A8F7A8FBA90A-A92AA930-A952A960-A97CA980-A9B2A9B4-A9BFA9CFAA00-AA36AA40-AA4DAA60-AA76AA7AAA80-AABEAAC0AAC2AADB-AADDAAE0-AAEFAAF2-AAF5AB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2EABC0-ABEAAC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1D-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF21-FF3AFF41-FF5AFF66-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",Uppercase:"0041-005A00C0-00D600D8-00DE01000102010401060108010A010C010E01100112011401160118011A011C011E01200122012401260128012A012C012E01300132013401360139013B013D013F0141014301450147014A014C014E01500152015401560158015A015C015E01600162016401660168016A016C016E017001720174017601780179017B017D018101820184018601870189-018B018E-0191019301940196-0198019C019D019F01A001A201A401A601A701A901AC01AE01AF01B1-01B301B501B701B801BC01C401C701CA01CD01CF01D101D301D501D701D901DB01DE01E001E201E401E601E801EA01EC01EE01F101F401F6-01F801FA01FC01FE02000202020402060208020A020C020E02100212021402160218021A021C021E02200222022402260228022A022C022E02300232023A023B023D023E02410243-02460248024A024C024E03700372037603860388-038A038C038E038F0391-03A103A3-03AB03CF03D2-03D403D803DA03DC03DE03E003E203E403E603E803EA03EC03EE03F403F703F903FA03FD-042F04600462046404660468046A046C046E04700472047404760478047A047C047E0480048A048C048E04900492049404960498049A049C049E04A004A204A404A604A804AA04AC04AE04B004B204B404B604B804BA04BC04BE04C004C104C304C504C704C904CB04CD04D004D204D404D604D804DA04DC04DE04E004E204E404E604E804EA04EC04EE04F004F204F404F604F804FA04FC04FE05000502050405060508050A050C050E05100512051405160518051A051C051E05200522052405260531-055610A0-10C510C710CD1E001E021E041E061E081E0A1E0C1E0E1E101E121E141E161E181E1A1E1C1E1E1E201E221E241E261E281E2A1E2C1E2E1E301E321E341E361E381E3A1E3C1E3E1E401E421E441E461E481E4A1E4C1E4E1E501E521E541E561E581E5A1E5C1E5E1E601E621E641E661E681E6A1E6C1E6E1E701E721E741E761E781E7A1E7C1E7E1E801E821E841E861E881E8A1E8C1E8E1E901E921E941E9E1EA01EA21EA41EA61EA81EAA1EAC1EAE1EB01EB21EB41EB61EB81EBA1EBC1EBE1EC01EC21EC41EC61EC81ECA1ECC1ECE1ED01ED21ED41ED61ED81EDA1EDC1EDE1EE01EE21EE41EE61EE81EEA1EEC1EEE1EF01EF21EF41EF61EF81EFA1EFC1EFE1F08-1F0F1F18-1F1D1F28-1F2F1F38-1F3F1F48-1F4D1F591F5B1F5D1F5F1F68-1F6F1FB8-1FBB1FC8-1FCB1FD8-1FDB1FE8-1FEC1FF8-1FFB21022107210B-210D2110-211221152119-211D212421262128212A-212D2130-2133213E213F21452160-216F218324B6-24CF2C00-2C2E2C602C62-2C642C672C692C6B2C6D-2C702C722C752C7E-2C802C822C842C862C882C8A2C8C2C8E2C902C922C942C962C982C9A2C9C2C9E2CA02CA22CA42CA62CA82CAA2CAC2CAE2CB02CB22CB42CB62CB82CBA2CBC2CBE2CC02CC22CC42CC62CC82CCA2CCC2CCE2CD02CD22CD42CD62CD82CDA2CDC2CDE2CE02CE22CEB2CED2CF2A640A642A644A646A648A64AA64CA64EA650A652A654A656A658A65AA65CA65EA660A662A664A666A668A66AA66CA680A682A684A686A688A68AA68CA68EA690A692A694A696A722A724A726A728A72AA72CA72EA732A734A736A738A73AA73CA73EA740A742A744A746A748A74AA74CA74EA750A752A754A756A758A75AA75CA75EA760A762A764A766A768A76AA76CA76EA779A77BA77DA77EA780A782A784A786A78BA78DA790A792A7A0A7A2A7A4A7A6A7A8A7AAFF21-FF3A",Lowercase:"0061-007A00AA00B500BA00DF-00F600F8-00FF01010103010501070109010B010D010F01110113011501170119011B011D011F01210123012501270129012B012D012F01310133013501370138013A013C013E014001420144014601480149014B014D014F01510153015501570159015B015D015F01610163016501670169016B016D016F0171017301750177017A017C017E-0180018301850188018C018D019201950199-019B019E01A101A301A501A801AA01AB01AD01B001B401B601B901BA01BD-01BF01C601C901CC01CE01D001D201D401D601D801DA01DC01DD01DF01E101E301E501E701E901EB01ED01EF01F001F301F501F901FB01FD01FF02010203020502070209020B020D020F02110213021502170219021B021D021F02210223022502270229022B022D022F02310233-0239023C023F0240024202470249024B024D024F-02930295-02B802C002C102E0-02E40345037103730377037A-037D039003AC-03CE03D003D103D5-03D703D903DB03DD03DF03E103E303E503E703E903EB03ED03EF-03F303F503F803FB03FC0430-045F04610463046504670469046B046D046F04710473047504770479047B047D047F0481048B048D048F04910493049504970499049B049D049F04A104A304A504A704A904AB04AD04AF04B104B304B504B704B904BB04BD04BF04C204C404C604C804CA04CC04CE04CF04D104D304D504D704D904DB04DD04DF04E104E304E504E704E904EB04ED04EF04F104F304F504F704F904FB04FD04FF05010503050505070509050B050D050F05110513051505170519051B051D051F05210523052505270561-05871D00-1DBF1E011E031E051E071E091E0B1E0D1E0F1E111E131E151E171E191E1B1E1D1E1F1E211E231E251E271E291E2B1E2D1E2F1E311E331E351E371E391E3B1E3D1E3F1E411E431E451E471E491E4B1E4D1E4F1E511E531E551E571E591E5B1E5D1E5F1E611E631E651E671E691E6B1E6D1E6F1E711E731E751E771E791E7B1E7D1E7F1E811E831E851E871E891E8B1E8D1E8F1E911E931E95-1E9D1E9F1EA11EA31EA51EA71EA91EAB1EAD1EAF1EB11EB31EB51EB71EB91EBB1EBD1EBF1EC11EC31EC51EC71EC91ECB1ECD1ECF1ED11ED31ED51ED71ED91EDB1EDD1EDF1EE11EE31EE51EE71EE91EEB1EED1EEF1EF11EF31EF51EF71EF91EFB1EFD1EFF-1F071F10-1F151F20-1F271F30-1F371F40-1F451F50-1F571F60-1F671F70-1F7D1F80-1F871F90-1F971FA0-1FA71FB0-1FB41FB61FB71FBE1FC2-1FC41FC61FC71FD0-1FD31FD61FD71FE0-1FE71FF2-1FF41FF61FF72071207F2090-209C210A210E210F2113212F21342139213C213D2146-2149214E2170-217F218424D0-24E92C30-2C5E2C612C652C662C682C6A2C6C2C712C732C742C76-2C7D2C812C832C852C872C892C8B2C8D2C8F2C912C932C952C972C992C9B2C9D2C9F2CA12CA32CA52CA72CA92CAB2CAD2CAF2CB12CB32CB52CB72CB92CBB2CBD2CBF2CC12CC32CC52CC72CC92CCB2CCD2CCF2CD12CD32CD52CD72CD92CDB2CDD2CDF2CE12CE32CE42CEC2CEE2CF32D00-2D252D272D2DA641A643A645A647A649A64BA64DA64FA651A653A655A657A659A65BA65DA65FA661A663A665A667A669A66BA66DA681A683A685A687A689A68BA68DA68FA691A693A695A697A723A725A727A729A72BA72DA72F-A731A733A735A737A739A73BA73DA73FA741A743A745A747A749A74BA74DA74FA751A753A755A757A759A75BA75DA75FA761A763A765A767A769A76BA76DA76F-A778A77AA77CA77FA781A783A785A787A78CA78EA791A793A7A1A7A3A7A5A7A7A7A9A7F8-A7FAFB00-FB06FB13-FB17FF41-FF5A",White_Space:"0009-000D0020008500A01680180E2000-200A20282029202F205F3000",Noncharacter_Code_Point:"FDD0-FDEFFFFEFFFF",Default_Ignorable_Code_Point:"00AD034F115F116017B417B5180B-180D200B-200F202A-202E2060-206F3164FE00-FE0FFEFFFFA0FFF0-FFF8",Any:"0000-FFFF",Ascii:"0000-007F",Assigned:"0000-0377037A-037E0384-038A038C038E-03A103A3-05270531-05560559-055F0561-05870589058A058F0591-05C705D0-05EA05F0-05F40600-06040606-061B061E-070D070F-074A074D-07B107C0-07FA0800-082D0830-083E0840-085B085E08A008A2-08AC08E4-08FE0900-09770979-097F0981-09830985-098C098F09900993-09A809AA-09B009B209B6-09B909BC-09C409C709C809CB-09CE09D709DC09DD09DF-09E309E6-09FB0A01-0A030A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A3C0A3E-0A420A470A480A4B-0A4D0A510A59-0A5C0A5E0A66-0A750A81-0A830A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABC-0AC50AC7-0AC90ACB-0ACD0AD00AE0-0AE30AE6-0AF10B01-0B030B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3C-0B440B470B480B4B-0B4D0B560B570B5C0B5D0B5F-0B630B66-0B770B820B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BBE-0BC20BC6-0BC80BCA-0BCD0BD00BD70BE6-0BFA0C01-0C030C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D-0C440C46-0C480C4A-0C4D0C550C560C580C590C60-0C630C66-0C6F0C78-0C7F0C820C830C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBC-0CC40CC6-0CC80CCA-0CCD0CD50CD60CDE0CE0-0CE30CE6-0CEF0CF10CF20D020D030D05-0D0C0D0E-0D100D12-0D3A0D3D-0D440D46-0D480D4A-0D4E0D570D60-0D630D66-0D750D79-0D7F0D820D830D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60DCA0DCF-0DD40DD60DD8-0DDF0DF2-0DF40E01-0E3A0E3F-0E5B0E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB90EBB-0EBD0EC0-0EC40EC60EC8-0ECD0ED0-0ED90EDC-0EDF0F00-0F470F49-0F6C0F71-0F970F99-0FBC0FBE-0FCC0FCE-0FDA1000-10C510C710CD10D0-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A135D-137C1380-139913A0-13F41400-169C16A0-16F01700-170C170E-17141720-17361740-17531760-176C176E-1770177217731780-17DD17E0-17E917F0-17F91800-180E1810-18191820-18771880-18AA18B0-18F51900-191C1920-192B1930-193B19401944-196D1970-19741980-19AB19B0-19C919D0-19DA19DE-1A1B1A1E-1A5E1A60-1A7C1A7F-1A891A90-1A991AA0-1AAD1B00-1B4B1B50-1B7C1B80-1BF31BFC-1C371C3B-1C491C4D-1C7F1CC0-1CC71CD0-1CF61D00-1DE61DFC-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FC41FC6-1FD31FD6-1FDB1FDD-1FEF1FF2-1FF41FF6-1FFE2000-2064206A-20712074-208E2090-209C20A0-20B920D0-20F02100-21892190-23F32400-24262440-244A2460-26FF2701-2B4C2B50-2B592C00-2C2E2C30-2C5E2C60-2CF32CF9-2D252D272D2D2D30-2D672D6F2D702D7F-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2DE0-2E3B2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB3000-303F3041-30963099-30FF3105-312D3131-318E3190-31BA31C0-31E331F0-321E3220-32FE3300-4DB54DC0-9FCCA000-A48CA490-A4C6A4D0-A62BA640-A697A69F-A6F7A700-A78EA790-A793A7A0-A7AAA7F8-A82BA830-A839A840-A877A880-A8C4A8CE-A8D9A8E0-A8FBA900-A953A95F-A97CA980-A9CDA9CF-A9D9A9DEA9DFAA00-AA36AA40-AA4DAA50-AA59AA5C-AA7BAA80-AAC2AADB-AAF6AB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2EABC0-ABEDABF0-ABF9AC00-D7A3D7B0-D7C6D7CB-D7FBD800-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1D-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBC1FBD3-FD3FFD50-FD8FFD92-FDC7FDF0-FDFDFE00-FE19FE20-FE26FE30-FE52FE54-FE66FE68-FE6BFE70-FE74FE76-FEFCFEFFFF01-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDCFFE0-FFE6FFE8-FFEEFFF9-FFFD"})}(XRegExp),function(e){function t(e,t,n,r){return{value:e,name:t,start:n,end:r}}e.matchRecursive=function(n,r,i,s,o){s=s||"",o=o||{};var u=s.indexOf("g")>-1,a=s.indexOf("y")>-1,f=s.replace(/y/g,""),l=o.escapeChar,c=o.valueNames,h=[],p=0,d=0,v=0,m=0,g,y,b,w,E;r=e(r,f),i=e(i,f);if(l){if(l.length>1)throw new SyntaxError("can't use more than one escape character");l=e.escape(l),E=new RegExp("(?:"+l+"[\\S\\s]|(?:(?!"+e.union([r,i]).source+")[^"+l+"])+)+",s.replace(/[^im]+/g,""))}for(;;){l&&(v+=(e.exec(n,E,v,"sticky")||[""])[0].length),b=e.exec(n,r,v),w=e.exec(n,i,v),b&&w&&(b.index<=w.index?w=null:b=null);if(b||w)d=(b||w).index,v=d+(b||w)[0].length;else if(!p)break;if(a&&!p&&d>m)break;if(b)p||(g=d,y=v),++p;else{if(!w||!p)throw new Error("string contains unbalanced delimiters");if(!--p){c?(c[0]&&g>m&&h.push(t(c[0],n.slice(m,g),m,g)),c[1]&&h.push(t(c[1],n.slice(g,y),g,y)),c[2]&&h.push(t(c[2],n.slice(y,d),y,d)),c[3]&&h.push(t(c[3],n.slice(d,v),d,v))):h.push(n.slice(y,d)),m=v;if(!u)break}}d===v&&++v}return u&&!a&&c&&c[0]&&n.length>m&&h.push(t(c[0],n.slice(m),m,n.length)),h}}(XRegExp),function(e){function r(e){var t=/^(?:\(\?:\))?\^/,n=/\$(?:\(\?:\))?$/;return n.test(e.replace(/\\[\s\S]/g,""))?e.replace(t,"").replace(n,""):e}function i(t){return e.isRegExp(t)?t.xregexp&&!t.xregexp.isNative?t:e(t.source):e(t)}var t=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,n=e.union([/\({{([\w$]+)}}\)|{{([\w$]+)}}/,t],"g");e.build=function(s,o,u){var a=/^\(\?([\w$]+)\)/.exec(s),f={},l=0,c,h=0,p=[0],d,v,m;a&&(u=u||"",a[1].replace(/./g,function(e){u+=u.indexOf(e)>-1?"":e}));for(m in o)o.hasOwnProperty(m)&&(v=i(o[m]),f[m]={pattern:r(v.source),names:v.xregexp.captureNames||[]});return s=i(s),d=s.xregexp.captureNames||[],s=s.source.replace(n,function(e,n,r,i,s){var o=n||r,u,a;if(o){if(!f.hasOwnProperty(o))throw new ReferenceError("undefined property "+e);return n?(u=d[h],p[++h]=++l,a="(?<"+(u||o)+">"):a="(?:",c=l,a+f[o].pattern.replace(t,function(e,t,n){if(t){u=f[o].names[l-c],++l;if(u)return"(?<"+u+">"}else if(n)return"\\"+(+n+c);return e})+")"}if(i){u=d[h],p[++h]=++l;if(u)return"(?<"+u+">"}else if(s)return"\\"+p[+s];return e}),e(s,u)}}(XRegExp),function(e){function t(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}t(e.prototype,{apply:function(e,t){return this.test(t[0])},call:function(e,t){return this.test(t)},forEach:function(t,n,r){return e.forEach(t,this,n,r)},globalize:function(){return e.globalize(this)},xexec:function(t,n,r){return e.exec(t,this,n,r)},xtest:function(t,n,r){return e.test(t,this,n,r)}})}(XRegExp),define("xregexp",function(e){return function(){var t,n;return n=function(){return{XRegExp:XRegExp}},t=n.apply(e,arguments),t||e.XRegExp}}(this)),define("salve/datatypes/regexp",["require","./xmlcharacters","xregexp"],function(e){function x(e){var t=new Error(e);this.name="SalveParsingError",this.stack=t.stack,this.message=t.message}function T(e,t){throw new x(e)}function A(e){k.unshift({negative:e,captured_multi_char:[]})}var t=function(e,t,n,r){for(n=n||{},r=e.length;r--;n[e[r]]=t);return n},n=[1,8],r=[1,10],i=[1,13],s=[1,19],o=[1,20],u=[1,14],a=[1,15],f=[1,16],l=[1,17],c=[5,23],h=[5,8,20,22,23,26,30,31,42,43,44,45],p=[5,8,12,13,14,15,20,22,23,26,30,31,42,43,44,45],d=[5,8,12,13,14,15,20,22,23,26,29,30,31,36,38,40,41,42,43,44,45],v=[1,37],m=[1,39],g=[1,40],y=[38,40,41,42,43,44,45],b=[29,36,38,40,41,42,43,44,45],w={trace:function(){},yy:{},symbols_:{error:2,start:3,input:4,EOF:5,regexp:6,branch:7,"|":8,piece:9,atom:10,quantifier:11,"?":12,"*":13,"+":14,"{":15,quantity:16,"}":17,NUMBER:18,",":19,CHAR:20,charClass:21,"(":22,")":23,charClassEsc:24,charClassExpr:25,WILDCARDESC:26,charClassExprStart:27,charGroup:28,"]":29,"[":30,"[^":31,posCharGroups:32,charClassSub:33,posCharGroup:34,charRange:35,CLASSSUBTRACTION:36,seRange:37,"-":38,charOrEsc:39,XMLCHAR:40,SingleCharEsc:41,SINGLECHARESC:42,MULTICHARESC:43,CATESC:44,COMPLESC:45,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",8:"|",12:"?",13:"*",14:"+",15:"{",17:"}",18:"NUMBER",19:",",20:"CHAR",22:"(",23:")",26:"WILDCARDESC",29:"]",30:"[",31:"[^",36:"CLASSSUBTRACTION",38:"-",40:"XMLCHAR",41:"SingleCharEsc",42:"SINGLECHARESC",43:"MULTICHARESC",44:"CATESC",45:"COMPLESC"},productions_:[0,[3,1],[4,1],[4,2],[6,1],[6,3],[7,1],[7,2],[9,1],[9,2],[11,1],[11,1],[11,1],[11,3],[16,1],[16,3],[16,2],[10,1],[10,1],[10,3],[21,1],[21,1],[21,1],[25,3],[27,1],[27,1],[28,1],[28,1],[32,1],[32,2],[34,1],[34,1],[33,3],[35,1],[35,1],[37,3],[37,1],[39,1],[39,1],[24,1],[24,1],[24,1],[24,1]],performAction:function(t,n,r,i,s,o,u,a){var f=o.length-1;switch(s){case 1:this.parseError=T,a=a||"re";switch(a){case"string":return o[f];case"re":var l=L?S:RegExp;return new l(o[f]);default:throw new Error("unsupported output type: "+a)}break;case 2:this.$="^$";break;case 3:this.$="^"+o[f-1]+"$";break;case 5:case 13:case 35:this.$=o[f-2].concat(o[f-1],o[f]);break;case 7:case 9:case 29:this.$=o[f-1]+o[f];break;case 15:this.$=o[f-2].concat(",",o[f]);break;case 16:this.$=o[f-1].concat(o[f]);break;case 19:this.$="(?:"+o[f-1]+o[f];break;case 23:var c=k.shift(),h=c.captured_multi_char,p=c.subtraction?"(?!"+c.subtraction+")":"";if(h.length!==0){var d=["(?:",p];if(c.negative){d.push("(?=[");for(var v=0;v<h.length;++v)d.push(O[h[v]].slice(1));d.push("])")}else for(var v=0;v<h.length;++v)d.push("[",O[h[v]],"]|");d.push(o[f-2],o[f-1],o[f],")"),this.$=d.join("")}else this.$=p!==""?"(?:"+p+o[f-2].concat(o[f-1],o[f])+")":o[f-2].concat(o[f-1],o[f]);break;case 24:A(!1),this.$=o[f];break;case 25:A(!0),this.$=o[f];break;case 32:this.$=o[f-2],k[0].subtraction=o[f];break;case 40:if(k.length){var m=O[o[f]];m.charAt(0)==="^"?(k[0].captured_multi_char.push(o[f]),this.$=""):this.$=m}else this.$=M[o[f]];break;case 41:case 42:L=!0,this.$=o[f]}},table:[{3:1,4:2,5:[1,3],6:4,7:5,9:6,10:7,20:n,21:9,22:r,24:11,25:12,26:i,27:18,30:s,31:o,42:u,43:a,44:f,45:l},{1:[3]},{1:[2,1]},{1:[2,2]},{5:[1,21]},t(c,[2,4],{10:7,21:9,24:11,25:12,27:18,9:23,8:[1,22],20:n,22:r,26:i,30:s,31:o,42:u,43:a,44:f,45:l}),t(h,[2,6]),t(h,[2,8],{11:24,12:[1,25],13:[1,26],14:[1,27],15:[1,28]}),t(p,[2,17]),t(p,[2,18]),{6:29,7:5,9:6,10:7,20:n,21:9,22:r,24:11,25:12,26:i,27:18,30:s,31:o,42:u,43:a,44:f,45:l},t(p,[2,20]),t(p,[2,21]),t(p,[2,22]),t(d,[2,39]),t(d,[2,40]),t(d,[2,41]),t(d,[2,42]),{24:34,28:30,32:31,33:32,34:33,35:35,37:36,38:v,39:38,40:m,41:g,42:u,43:a,44:f,45:l},t(y,[2,24]),t(y,[2,25]),{1:[2,3]},{6:41,7:5,9:6,10:7,20:n,21:9,22:r,24:11,25:12,26:i,27:18,30:s,31:o,42:u,43:a,44:f,45:l},t(h,[2,7]),t(h,[2,9]),t(h,[2,10]),t(h,[2,11]),t(h,[2,12]),{16:42,18:[1,43]},{23:[1,44]},{29:[1,45]},{24:34,29:[2,26],34:46,35:35,36:[1,47],37:36,38:v,39:38,40:m,41:g,42:u,43:a,44:f,45:l},{29:[2,27]},t(b,[2,28]),t(b,[2,30]),t(b,[2,31]),t(b,[2,33]),t(b,[2,34]),t([29,36,40,41,42,43,44,45],[2,36],{38:[1,48]}),t(b,[2,37]),t(b,[2,38]),t(c,[2,5]),{17:[1,49]},{17:[2,14],19:[1,50]},t(p,[2,19]),t([5,8,12,13,14,15,20,22,23,26,29,30,31,42,43,44,45],[2,23]),t(b,[2,29]),{25:51,27:18,30:s,31:o},{39:52,40:m,41:g},t(h,[2,13]),{17:[2,16],18:[1,53]},{29:[2,32]},t(b,[2,35]),{17:[2,15]}],defaultActions:{2:[2,1],3:[2,2],21:[2,3],32:[2,27],51:[2,32],53:[2,15]},parseError:function(t,n){if(!n.recoverable)throw new Error(t);this.trace(t)},parse:function(t){function w(e){r.length=r.length-2*e,s.length=s.length-e,o.length=o.length-e}var n=this,r=[0],i=[],s=[null],o=[],u=this.table,a="",f=0,l=0,c=0,h=2,p=1,d=o.slice.call(arguments,1),v=Object.create(this.lexer),m={yy:{}};for(var g in this.yy)Object.prototype.hasOwnProperty.call(this.yy,g)&&(m.yy[g]=this.yy[g]);v.setInput(t,m.yy),m.yy.lexer=v,m.yy.parser=this,typeof v.yylloc=="undefined"&&(v.yylloc={});var y=v.yylloc;o.push(y);var b=v.options&&v.options.ranges;typeof m.yy.parseError=="function"?this.parseError=m.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function E(){var e;return e=v.lex()||p,typeof e!="number"&&(e=n.symbols_[e]||e),e}var S,x,T,N,C,k,L={},A,O,M,_;for(;;){T=r[r.length-1];if(this.defaultActions[T])N=this.defaultActions[T];else{if(S===null||typeof S=="undefined")S=E();N=u[T]&&u[T][S]}if(typeof N=="undefined"||!N.length||!N[0]){var D="";_=[];for(A in u[T])this.terminals_[A]&&A>h&&_.push("'"+this.terminals_[A]+"'");v.showPosition?D="Parse error on line "+(f+1)+":\n"+v.showPosition()+"\nExpecting "+_.join(", ")+", got '"+(this.terminals_[S]||S)+"'":D="Parse error on line "+(f+1)+": Unexpected "+(S==p?"end of input":"'"+(this.terminals_[S]||S)+"'"),this.parseError(D,{text:v.match,token:this.terminals_[S]||S,line:v.yylineno,loc:y,expected:_})}if(N[0]instanceof Array&&N.length>1)throw new Error("Parse Error: multiple actions possible at state: "+T+", token: "+S);switch(N[0]){case 1:r.push(S),s.push(v.yytext),o.push(v.yylloc),r.push(N[1]),S=null,x?(S=x,x=null):(l=v.yyleng,a=v.yytext,f=v.yylineno,y=v.yylloc,c>0&&c--);break;case 2:O=this.productions_[N[1]][1],L.$=s[s.length-O],L._$={first_line:o[o.length-(O||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(O||1)].first_column,last_column:o[o.length-1].last_column},b&&(L._$.range=[o[o.length-(O||1)].range[0],o[o.length-1].range[1]]),k=this.performAction.apply(L,[a,l,f,m.yy,N[1],s,o].concat(d));if(typeof k!="undefined")return k;O&&(r=r.slice(0,-1*O*2),s=s.slice(0,-1*O),o=o.slice(0,-1*O)),r.push(this.productions_[N[1]][0]),s.push(L.$),o.push(L._$),M=u[r[r.length-2]][r[r.length-1]],r.push(M);break;case 3:return!0}}return!0}},E=e("./xmlcharacters"),S=e("xregexp").XRegExp;x.prototype=new Error,typeof exports!="undefined"?exports.SalveParsingError=x:w.SalveParsingError=x;var N=E.xml_Name_Char,C=E.xml_Letter,k=[],L=!1,O={"\\s":" \\t\\n\\r","\\S":"^ \\t\\n\\r","\\i":""+C+"_:","\\I":"^"+C+"_:","\\c":""+N,"\\C":"^"+N,"\\d":"\\p{Nd}","\\D":"^\\p{Nd}","\\w":"^\\p{P}\\p{Z}\\p{C}","\\W":"\\p{P}\\p{Z}\\p{C}"},M=[];for(var _ in O){if(!O.hasOwnProperty(_))continue;M[_]="["+O[_]+"]"}var D=function(){var e={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,n)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=(new Array(e.length+1)).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,r,i;this.options.backtrack_lexer&&(i={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(i.yylloc.range=this.yylloc.range.slice(0))),r=e[0].match(/(?:\r\n?|\n).*/g),r&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1);if(n)return n;if(this._backtrack){for(var s in i)this[s]=i[s];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,r;this._more||(this.yytext="",this.match="");var i=this._currentRules();for(var s=0;s<i.length;s++){n=this._input.match(this.rules[i[s]]);if(n&&(!t||n[0].length>t[0].length)){t=n,r=s;if(this.options.backtrack_lexer){e=this.test_match(n,i[s]);if(e!==!1)return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}}return t?(e=this.test_match(t,i[r]),e!==!1?e:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){var t=this.conditionStack.length-1;return t>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return t=this.conditionStack.length-1-Math.abs(t||0),t>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,n,r,i){var s=i;switch(r){case 0:return 18;case 1:return 19;case 2:return this.popState(),17;case 3:return this.begin("CHARCLASS"),31;case 4:return this.begin("CHARCLASS"),30;case 5:return 42;case 6:return 43;case 7:return 36;case 8:return 38;case 9:return 40;case 10:return this.popState(),29;case 11:return 22;case 12:return 8;case 13:return 23;case 14:return 13;case 15:return 14;case 16:return 12;case 17:return this.begin("QUANTITY"),15;case 18:return 17;case 19:return 29;case 20:return"^";case 21:return 44;case 22:return 45;case 23:return 26;case 24:return 5;case 25:return 20}},rules:[/^(?:[0-9])/,/^(?:,)/,/^(?:\})/,/^(?:\[\^)/,/^(?:\[)/,/^(?:\\[-nrt\|.?*+(){}[\]^])/,/^(?:\\[sSiIcCdDwW])/,/^(?:-(?=\[))/,/^(?:-)/,/^(?:[^-[\]])/,/^(?:\])/,/^(?:\()/,/^(?:\|)/,/^(?:\))/,/^(?:\*)/,/^(?:\+)/,/^(?:\?)/,/^(?:\{)/,/^(?:\})/,/^(?:\])/,/^(?:\^)/,/^(?:\\p\{.*?\})/,/^(?:\\P\{.*?\})/,/^(?:\.)/,/^(?:$)/,/^(?:[^\\])/],conditions:{CHARCLASS:{rules:[3,4,5,6,7,8,9,10],inclusive:!1},QUANTITY:{rules:[0,1,2],inclusive:!1},INITIAL:{rules:[3,4,5,6,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],inclusive:!0}}};return e}();return w.lexer=D,w}),define("salve/datatypes/xmlschema",["require","exports","module","lodash","./errors","./regexp","./xmlcharacters"],function(e,t,n){function b(e,t){return e.search(/^\d+$/)!==-1?!1:new v(t+" must have an integer value")}function w(e,t){return!b(e,t)&&Number(e)>=0?!1:new v(t+" must have a non-negative integer value")}function E(e,t){return!b(e,t)&&Number(e)>0?!1:new v(t+" must have a positive value")}function P(e,t){switch(t){case u:break;case a:e=e.replace(/\r\n\t/g," ");break;case f:e=e.replace(/\r\n\t/g," ").trim().replace(/\s{2,}/g," ");break;default:throw new Error("unexpected value: "+t)}return e}function Bt(e){return e%4===0&&e%100!==0||e%400===0}function It(e){var t=e.match(jt);if(!t)return NaN;var n=t[1],r=Bt(Number(n)),i=Number(t[2]);if(i===0||i>12)return NaN;var s=Number(t[3]),o=Ft[i];i===2&&!r&&(o=28);if(s===0||s>o)return NaN;var u=t[4].split(":"),a=Number(u[1]);if(a>59)return NaN;var f=Number(u[2]);if(f>59)return NaN;var l=!a&&!f?24:23;if(Number(u[0])>l)return NaN;if(t[5]&&t[5]!=="Z"){var c=t[5].split(":"),h=Number(c[0].slice(1));if(h>14)return NaN;var p=Number(c[1]);if(p>59)return NaN;if(h===14&&p!==0)return NaN}return!0}var r=e("lodash"),i=e("./errors"),s=e("./regexp"),o=e("./xmlcharacters"),u=1,a=2,f=3,l=o.xml_Name_re,c=o.xml_NCName,h=o.xml_NCName_re,p=o.xml_Name_Char,d=o.xml_Letter,v=i.ParamError,m=i.ValueError,g=i.ParameterParsingError,y=i.ValueValidationError,S={name:"length",repeatable:!1,convert:Number,isInvalidParam:w,isInvalidValue:function(e,t,n){return n.valueLength(e)===t?!1:new m("length of value should be "+t)}},x={name:"minLength",repeatable:!1,convert:Number,isInvalidParam:w,isInvalidValue:function(e,t,n){return n.valueLength(e)>=t?!1:new m("length of value should be greater than or equal to "+t)}},T={name:"maxLength",repeatable:!1,convert:Number,isInvalidParam:w,isInvalidValue:function(e,t,n){return n.valueLength(e)<=t?!1:new m("length of value should be less than or equal to "+t)}},N=[/\\s/g,"[ \\t\\n\\r]",/\\S/g,"[^ \\t\\n\\r]",/\\i/g,"["+d+"_:]",/\\I/g,"[^"+d+"_:]",/\\c/g,"["+p+"]",/\\C/g,"[^"+p+"]",/\\d/g,"\\p{Nd}",/\\D/g,"[^\\d]",/\\w/g,"[^\\p{P}\\p{Z}\\p{C}]",/\\W/g,"[\\p{P}\\p{Z}\\p{C}]"],C=Object.create(null),k={name:"pattern",repeatable:"combine",convert:function(e){var t=C[e];return t===undefined&&(t=C[e]=s.parse(e)),{rng:e,internal:t}},combine:function(e){return r.map(e,this.convert)},isInvalidParam:function(e){try{this.convert(e)}catch(t){if(t instanceof s.SalveParsingError)return new v(t.message);throw t}return!1},isInvalidValue:function(e,t,n){if(t instanceof Array){var r;for(var i=0;!r&&i<t.length;++i)t[i].internal.test(e)||(r=t[i]);return r?new m("value does not match the pattern "+r.rng):!1}return t.internal.test(e)?!1:new m("value does not match the pattern "+t.rng)}},L={name:"totalDigits",repeatable:!1,convert:Number,isInvalidParam:E,isInvalidValue:function(e,t,n){var r=String(Number(e)).replace(/[-+.]/g,"");return r.length>t?new m("value must have at most "+t+" digits"):!1}},A={name:"fractionDigits",repeatable:!1,convert:Number,isInvalidParam:w,isInvalidValue:function(e,t,n){var r=String(Number(e)).replace(/^.*\./,"");return r.length>t?new m("value must have at most "+t+" fraction digits"):!1}},O={name:"maxInclusive",repeatable:!1,convert:Number,isInvalidParam:function(e,t,n){return n.disallows(e)},isInvalidValue:function(e,t,n){return e>t?new m("value must be less than or equal to "+t):!1}},M={name:"maxExclusive",repeatable:!1,convert:Number,isInvalidParam:function(e,t,n){return n.disallows(e)},isInvalidValue:function(e,t,n){return e>=t?new m("value must be less than "+t):!1}},_={name:"minInclusive",repeatable:!1,convert:Number,isInvalidParam:function(e,t,n){return n.disallows(e)},isInvalidValue:function(e,t,n){return e<t?new m("value must be greater than or equal to "+t):!1}},D={name:"minExclusive",repeatable:!1,convert:Number,isInvalidParam:function(e,t,n){return n.disallows(e)},isInvalidValue:function(e,t,n){return e<=t?new m("value must be greater than "+t):!1}},H={init:function(){this.valid_params&&(this.param_name_to_obj=r.indexBy(this.valid_params,"name")),this.default_params=this.parseParams()},whiteSpaceDefault:f,convertValue:function(e,t){return P(e,this.whiteSpaceDefault)},valueLength:function(e){return e.length},parseValue:function(e,t){var n=this.disallows(e,{},t);if(n.length)throw new y(n);return{value:this.convertValue(e,t)}},parseParams:function(e,t){var n=this,i=[],s={};r.each(t,function(e){var t=e.name;if(!n.param_name_to_obj.hasOwnProperty(t)){i.push(new v("unexpected parameter: "+t));return}var r=n.param_name_to_obj[t],o=r.isInvalidParam(e.value,t,n);o&&i.push(o),s.hasOwnProperty(t)&&!r.repeatable&&i.push(new v("cannot repeat parameter "+t)),s[t]=!0});if(i.length)throw new g(e,i);var o=Object.create(null);r.each(r.groupBy(t,"name"),function(e,t){var i=n.param_name_to_obj[t];e.length>1?o[t]=i.combine(r.reduceRight(r.pluck(e,"value"),function(e,t){return e.concat(t)},[]),n):o[t]=i.convert?i.convert(e[0].value,n):e[0].value}),o.minLength>o.maxLength&&i.push(new v("minLength must be less than or equal to maxLength")),o.length!==undefined&&(o.minLength!==undefined&&i.push(new v("length and minLength cannot appear together")),o.maxLength!==undefined&&i.push(new v("length and maxLength cannot appear together"))),o.maxInclusive!==undefined&&(o.maxExclusive!==undefined&&i.push(new v("maxInclusive and maxExclusive cannot appear together")),o.minExclusive>=o.maxInclusive&&i.push(new v("minExclusive must be less than maxInclusive"))),o.minInclusive!==undefined&&(o.minExclusive!==undefined&&i.push(new v("minInclusive and minExclusive cannot appear together")),o.minInclusive>o.maxInclusive&&i.push(new v("minInclusive must be less than or equal to maxInclusive")),o.minInclusive>=o.maxExclusive&&i.push(new v("minInclusive must be less than maxExclusive"))),o.minExclusive>o.maxExclusive&&i.push(new v("minExclusive must be less than or equal to maxExclusive"));if(i.length)throw new g(i);return o},disallowedByParams:function(e,t,n,i){var s=this;if(n){var o=[];r.each(Object.keys(n),function(e){var r=s.param_name_to_obj[e],i=r.isInvalidValue(t,n[e],s);i&&o.push(i)});if(o.length)return o}return!1},equal:function(e,t,n){if(t.value===undefined)throw Error("it looks like you are trying to use an unparsed value");var r;try{r=this.convertValue(e,n)}catch(i){if(i instanceof y)return!1;throw i}return r===t.value},disallows:function(e,t,n){var r=this;if(t instanceof Array)throw new Error("it looks like you are passing unparsed parameters to disallows");if(!t||Object.keys(t).length===0)t=this.default_params;if(this.regexp&&!P(e,f).match(this.regexp))return[new m(this.type_error_msg)];var i;try{i=this.convertValue(e,n)}catch(s){if(s instanceof y)return s.errors;throw s}var o=this.disallowedByParams(e,i,t,n);return o.length?o:!1}},B=r.extend({},H,{name:"string",type_error_msg:"value is not a string",whiteSpaceDefault:u,valid_params:[S,x,T,k],needs_context:!1,regexp:/^.*$/}),j=r.extend({},B,{name:"normalizedString",type_error_msg:"string contains a tab, carriage return or newline",regexp:/^[^\r\n\t]+$/}),F=r.extend({},j,{name:"token",type_error_msg:"not a valid token",regexp:/^(?:(?! )(?:(?!   )[^\r\n\t])*[^\r\n\t ])?$/}),I=r.extend({},F,{name:"language",type_error_msg:"not a valid language identifier",regexp:/^[a-zA-Z]{1,8}(-[a-zA-Z0-9]{1,8})*$/}),q=r.extend({},F,{name:"Name",type_error_msg:"not a valid Name",regexp:l}),R=r.extend({},q,{name:"NCName",type_error_msg:"not a valid NCName",regexp:h}),U=new RegExp("^["+p+"]+$"),z=r.extend({},F,{name:"NMTOKEN",type_error_msg:"not a valid NMTOKEN",regexp:U}),W=new RegExp("^["+p+"]+(?: ["+p+"]+)*$"),X=r.extend({},z,{name:"NMTOKENS",type_error_msg:"not a valid NMTOKENS",regexp:W,whiteSpaceDefault:f}),V=r.extend({},R,{name:"ID",type_error_msg:"not a valid ID"}),$=r.extend({},R,{name:"IDREF",type_error_msg:"not a valid IDREF"}),J=new RegExp("^"+c+"(?: "+c+")*$"),K=r.extend({},$,{name:"IDREFS",type_error_msg:"not a valid IDREFS",regexp:J,whiteSpaceDefault:f}),Q=r.extend({},B,{name:"ENTITY",type_error_msg:"not a valid ENTITY"}),G=r.extend({},B,{name:"ENTITIES",type_error_msg:"not a valid ENTITIES"}),Y="[-+]?(?!$)\\d*(\\.\\d*)?",Z=r.extend({},H,{name:"decimal",type_error_msg:"value not a decimal number",regexp:new RegExp("^"+Y+"$"),whiteSpaceDefault:f,convertValue:function(e,t){return Number(H.convertValue(e))},valid_params:[L,A,k,D,_,M,O],needs_context:!1}),et="[-+]?\\d+",tt=r.extend({},Z,{name:"integer",type_error_msg:"value is not an integer",regexp:new RegExp("^"+et+"$"),valid_params:[L,k,D,_,M,O],parseParams:function(e,t){var n=Z.parseParams(e,t);if(this.highest_val!==undefined)if(n.maxExclusive!==undefined){var r=n.maxExclusive;if(r>this.highest_val)throw new g(new v("maxExclusive cannot be greater than "+this.highest_val))}else if(n.maxInclusive!==undefined){var i=n.maxInclusive;if(i>this.highest_val)throw new g(new v("maxInclusive cannot be greater than "+this.highest_val))}else n.maxInclusive=this.highest_val;if(this.lowest_val!==undefined)if(n.minExclusive!==undefined){var r=n.minExclusive;if(r<this.lowest_val)throw new g(new v("minExclusive cannot be lower than "+this.lowest_val))}else if(n.minInclusive!==undefined){var i=n.minInclusive;if(i<this.lowest_val)throw new g(new v("minInclusive cannot be lower than "+this.lowest_val))}else n.minInclusive=this.lowest_val;return n}}),nt=r.extend({},tt,{name:"nonPositiveInteger",type_error_msg:"value is not a nonPositiveInteger",regexp:/^\+?0+|-\d+$/,highest_val:0,valid_params:[L,k,D,_,M,O]}),rt=r.extend({},nt,{name:"negativeInteger",type_error_msg:"value is not a negativeInteger",regexp:/^-\d+$/,highest_val:-1,valid_params:[L,k,D,_,M,O]}),it=r.extend({},tt,{name:"nonNegativeInteger",type_error_msg:"value is not a nonNegativeInteger",regexp:/^\+?\d+$/,lowest_val:0,valid_params:[L,k,D,_,M,O]}),st=r.extend({},it,{name:"positiveInteger",type_error_msg:"value is not a positiveInteger",regexp:/^\+?\d+$/,lowest_val:1,valid_params:[L,k,D,_,M,O]}),ot=r.extend({},tt,{name:"long",type_error_msg:"value is not a long",highest_val:0x8000000000000000,lowest_val:-0x8000000000000000,valid_params:[L,k,D,_,M,O]}),ut=r.extend({},ot,{name:"int",type_error_msg:"value is not an int",highest_val:2147483647,lowest_val:-2147483648}),at=r.extend({},ut,{name:"short",type_error_msg:"value is not a short",highest_val:32767,lowest_val:-32768}),ft=r.extend({},at,{name:"byte",type_error_msg:"value is not a byte",highest_val:127,lowest_val:-128}),lt=r.extend({},it,{name:"unsignedLong",type_error_msg:"value is not an unsignedLong",highest_val:0x10000000000000000,valid_params:[L,k,D,_,M,O]}),ct=r.extend({},lt,{name:"unsignedInt",type_error_msg:"value is not an unsignedInt",highest_val:4294967295,valid_params:[L,k,D,_,M,O]}),ht=r.extend({},ct,{name:"unsignedShort",type_error_msg:"value is not an unsignedShort",highest_val:65535,valid_params:[L,k,D,_,M,O]}),pt=r.extend({},ht,{name:"unsignedShort",type_error_msg:"value is not an unsignedByte",highest_val:255,valid_params:[L,k,D,_,M,O]}),dt=r.extend({},H,{name:"boolean",type_error_msg:"not a valid boolean",regexp:/^(1|0|true|false)$/,valid_params:[k],convertValue:function(e,t){return e==="1"||e==="true"}}),vt="[AQgw]",mt="[AEIMQUYcgkosw048]",gt="[A-Za-z0-9+/]",yt="(?:"+gt+" ?)",bt="(?:"+mt+" ?)",wt="(?:"+vt+" ?)",Et=new RegExp("^(?:(?:"+yt+"{4})*(?:(?:"+yt+"{3}"+gt+")|(?:"+yt+"{2}"+bt+"=)|(?:"+yt+wt+"= ?=)))?$"),St=r.extend({},H,{name:"base64Binary",type_error_msg:"not a valid base64Binary",regexp:Et,valid_params:[S,x,T,k],convertValue:function(e,t){return e.replace(/\s/g,"")},valueLength:function(e){return Math.floor(e.replace(/[\s=]/g,"").length*3/4)}}),xt=r.extend({},H,{name:"hexBinary",type_error_msg:"not a valid hexBinary",regexp:/^(?:[0-9a-fA-F]{2})*$/,valid_params:[S,x,T,k],convertValue:function(e,t){return e},valueLength:function(e){return e.length/2}}),Tt=new RegExp("^(?:(?:[-+]?INF)|(?:NaN)|(?:"+Y+"(?:[Ee]"+et+")?))$"),Nt=r.extend({},H,{name:"float",type_error_msg:"not a valid float",regexp:Tt,valid_params:[k,_,D,O,M],convertValue:parseFloat}),Ct=r.extend({},H,{name:"double",type_error_msg:"not a valid double",regexp:Tt,valid_params:[k,_,D,O,M],convertValue:parseFloat}),kt=r.extend({},H,{name:"QName",type_error_msg:"not a valid QName",regexp:new RegExp("^(?:"+c+":)?"+c+"$"),needs_context:!0,convertValue:function(e,t){var n=t.resolver.resolveName(H.convertValue(e));if(n===undefined)throw new y([new m("cannot resolve the name "+e)]);return"{"+n.ns+"}"+n.name},valid_params:[k,S,x,T]}),Lt=r.extend({},H,{name:"NOTATION",type_error_msg:"not a valid NOTATION",regexp:new RegExp("^(?:"+c+":)?"+c+"$"),needs_context:!0,convertValue:function(e,t){var n=t.resolver.resolveName(H.convertValue(e));if(n===undefined)throw new y([new m("cannot resolve the name "+e)]);return"{"+n.ns+"}"+n.name},valid_params:[k,S,x,T]}),At=r.extend({},H,{name:"duration",type_error_msg:"not a valid duration",regexp:/^-?P(?!$)(?:\d+Y)?(?:\d+M)?(?:\d+D)?(?:T(?!$)(?:\d+H)?(?:\d+M)?(?:\d+(\.\d+)?S)?)?$/,valid_params:[k]}),Ot="-?(?:[1-9]\\d*)?\\d{4}",Mt="[01]\\d",_t="[0-3]\\d",Dt="[012]\\d:[0-5]\\d:[0-5]\\d(?:\\.\\d+)?",Pt="(?:[+-][01]\\d:[0-5]\\d|Z)",Ht=new RegExp(Pt+"$"),jt=new RegExp("^("+Ot+")-("+Mt+")-("+_t+")T("+Dt+")("+Pt+"?)$"),Ft=[undefined,31,29,31,30,31,30,31,31,30,31,30,31],qt=r.extend({},H,{name:"dateTime",type_error_msg:"not a valid dateTime",regexp:new RegExp("^"+Ot+"-"+Mt+"-"+_t+"T"+Dt+Pt+"?$"),valid_params:[k],disallows:function(e,t,n){var r=H.disallows.call(this,e,t,n);return r?r:isNaN(It(e))?[new m(this.type_error_msg)]:!1}}),Rt=r.extend({},H,{name:"time",type_error_msg:"not a valid time",regexp:new RegExp("^"+Dt+Pt+"?$"),valid_params:[k],disallows:function(e,t,n){var r=H.disallows.call(this,e,t,n);return r?r:isNaN(It("1901-01-01T"+e))?[new m(this.type_error_msg)]:!1}}),Ut=r.extend({},H,{name:"date",type_error_msg:"not a valid date",regexp:new RegExp("^"+Ot+"-"+Mt+"-"+_t+Pt+"?$"),valid_params:[k],disallows:function(e,t,n){var r=H.disallows.call(this,e,t,n);if(r)return r;var i=e.match(Ht);return e=i?e.slice(0,i.index)+"T00:00:00"+i[0]:e+"T00:00:00",isNaN(It(e))?[new m(this.type_error_msg)]:!1}}),zt=r.extend({},H,{name:"gYearMonth",type_error_msg:"not a valid gYearMonth",regexp:new RegExp("^"+Ot+"-"+Mt+Pt+"?$"),valid_params:[k],disallows:function(e,t,n){var r=H.disallows.call(this,e,t,n);if(r)return r;var i=e.match(Ht);return e=i?e.slice(0,i.index)+"-01T00:00:00"+i[0]:e+"-01T00:00:00",isNaN(It(e))?[new m(this.type_error_msg)]:!1}}),Wt=r.extend({},H,{name:"gYear",type_error_msg:"not a valid gYear",regexp:new RegExp("^"+Ot+Pt+"?$"),valid_params:[k],disallows:function(e,t,n){var r=H.disallows.call(this,e,t,n);if(r)return r;var i=e.match(Ht);return e=i?e.slice(0,i.index)+"-01-01T00:00:00"+i[0]:e+"-01-01T00:00:00",isNaN(It(e))?[new m(this.type_error_msg)]:!1}}),Xt=r.extend({},H,{name:"gMonthDay",type_error_msg:"not a valid gMonthDay",regexp:new RegExp("^"+Mt+"-"+_t+Pt+"?$"),valid_params:[k],disallows:function(e,t,n){var r=H.disallows.call(this,e,t,n);if(r)return r;var i=e.match(Ht);return e=i?e.slice(0,i.index)+"T00:00:00"+i[0]:e+"T00:00:00",isNaN(It("2000-"+e))?[new m(this.type_error_msg)]:!1}}),Vt=r.extend({},H,{name:"gDay",type_error_msg:"not a valid gDay",regexp:new RegExp("^"+_t+Pt+"?$"),valid_params:[k],disallows:function(e,t,n){var r=H.disallows.call(this,e,t,n);if(r)return r;var i=e.match(Ht);return e=i?e.slice(0,i.index)+"T00:00:00"+i[0]:e+"T00:00:00",isNaN(It("2000-01-"+e))?[new m(this.type_error_msg)]:!1}}),$t=r.extend({},H,{name:"gMonth",type_error_msg:"not a valid gMonth",regexp:new RegExp("^"+Mt+Pt+"?$"),valid_params:[k],disallows:function(e,t,n){var r=H.disallows.call(this,e,t,n);if(r)return r;var i=e.match(Ht);return e=i?e.slice(0,i.index)+"-01T00:00:00"+i[0]:e+"-01T00:00:00",isNaN(It("2000-"+e))?[new m(this.type_error_msg)]:!1}}),Jt=/^(?:[A-Za-z][A-Za-z0-9+\-.]*:(?:\/\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\.[A-Za-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\?(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?(?:\#(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?|(?:\/\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\.[A-Za-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\-._~!$&'()*+,;=@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\?(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?(?:\#(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?)$/,Kt=r.extend({},H,{name:"anyURI",type_error_msg:"not a valid anyURI",regexp:Jt,valid_params:[k,S,x,T]}),Qt={uri:"http://www.w3.org/2001/XMLSchema-datatypes",types:{string:B,normalizedString:j,token:F,language:I,Name:q,NCName:R,NMTOKEN:z,NMTOKENS:X,ID:V,IDREF:$,IDREFS:K,ENTITY:Q,ENTITIES:G,decimal:Z,integer:tt,nonPositiveInteger:nt,negativeInteger:rt,nonNegativeInteger:it,positiveInteger:st,"long":ot,"int":ut,"short":at,"byte":ft,unsignedLong:lt,unsignedInt:ct,unsignedShort:ht,unsignedByte:pt,"boolean":dt,base64Binary:St,hexBinary:xt,"float":Nt,"double":Ct,QName:kt,NOTATION:Lt,duration:At,dateTime:qt,time:Rt,date:Ut,gYearMonth:zt,gYear:Wt,gMonthDay:Xt,gDay:Vt,gMonth:$t,anyURI:Kt}};r.each(Object.keys(Qt.types),function(e){Qt.types[e].init()}),t.xmlschema=Qt}),define("salve/datatypes",["require","exports","module","./datatypes/builtin","./datatypes/xmlschema","./datatypes/errors"],function(e,t,n){function o(){this.libraries=Object.create(null)}var r=e("./datatypes/builtin").builtin,i=e("./datatypes/xmlschema").xmlschema,s=e("./datatypes/errors");o.prototype.add=function(e){var t=e.uri;if(t in this.libraries)throw new Error("URI clash: "+t);this.libraries[t]=e},o.prototype.find=function(e){return this.libraries[e]},o.prototype.get=function(e){var t=this.find(e);if(!t)throw new Error("can't get library with URI: "+e);return t};var u=new o;u.add(r),u.add(i),t.registry=u,t.ParameterParsingError=s.ParameterParsingError,t.ValueValidationError=s.ValueValidationError,t.ValueError=s.ValueError}),define("salve/errors",["require","exports","module","./oop"],function(e,t,n){function s(e){this.msg=e}function o(e,t){s.call(this,e),this.name=t}function u(){o.apply(this,arguments)}function a(){o.apply(this,arguments)}function f(){o.apply(this,arguments)}function l(e,t){s.call(this,""),this.names_a=e,this.names_b=t}var r=e("./oop"),i=r.inherit;s.prototype.toString=function(){return this.msg},s.prototype.getNames=function(){return[]},s.prototype.toStringWithNames=function(e){return this.msg},i(o,s),o.prototype.toString=function(){return this.toStringWithNames([this.name])},o.prototype.getNames=function(){return[this.name]},o.prototype.toStringWithNames=function(e){return this.msg+": "+e[0]},i(u,o),i(a,o),i(f,o),i(l,s),l.prototype.toString=function(){return this.toStringWithNames(this.names_a.concat(this.names_b))},l.prototype.getNames=function(){return this.names_a.concat(this.names_b)},l.prototype.toStringWithNames=function(e){var t=e.slice(0,this.names_a.length),n=e.slice(this.names_a.length);return"must choose either "+t.join(", ")+" or "+n.join(", ")},t.ValidationError=s,t.ChoiceError=l,t.ElementNameError=f,t.AttributeNameError=u,t.AttributeValueError=a}),define("salve/patterns",["require","exports","module","./name_resolver","./util","./hashstructs","./oop","./set","./datatypes","./errors"],function(e,t,n){function L(e,t){e.prototype.newWalker=function(e){return new t(this,e)}}function A(e){function t(){return t.prototype.__singleton_instance!==undefined?t.prototype.__singleton_instance:(e.apply(this,arguments),t.prototype.__singleton_instance=this,this)}return t}function M(e,t){this.ns=e,this.name=t}function _(e){return e.hash()}function D(e){this.id="P"+this.__newID(),this.xml_path=e}function P(e){D.call(this,e),this.pat=undefined}function H(e){D.call(this,e),this.pat_a=undefined,this.pat_b=undefined}function B(){var e;if(arguments[0]instanceof Array)e=arguments[0];else{var t=arguments.length;e=new Array(t);for(var n=0;n<t;++n)e[n]=arguments[n]}var r=e.join(),i=B.__cache[r];return i!==undefined?i:(this.id=this.__newID(),this.params=e,this.key=r,B.__cache[r]=this,this)}function j(e){var t=function(e){return e},n=new b(t);e.forEach(function(e){var r=e;e instanceof B&&(r=e.params);var i=n;for(var s=0;s<r.length;++s)if(s===r.length-1)i.add(r[s],!1);else{var o=i.has(r[s]);o===undefined&&(o=new b(t),i.add(r[s],o)),i=o}});var r=function(){var e="",t="    ";return function(n,i){var s="",o=n.keys();return o.sort(),o.forEach(function(i){var o=n.has(i);o!==!1?(s+=e+i+":\n",e+=t,s+=r(n.has(i)),e=e.slice(t.length)):s+=e+i+"\n"}),s}}();return r(n)}function I(e){this.length=e}function q(){this.id="W"+this.__newID(),this.possible_cached=undefined,this.suppressed_attributes=!1}function R(){throw new Error("not meant to be called")}function U(){throw new Error("not meant to be called")}function W(e){q.call(this),this.possible_cached=new O}function V(e,t){P.call(this,e),this.pat=t}function $(e,t){q.call(this),this.el=e,this.name_resolver=t,this.subwalker=e!==undefined?e.pat.newWalker(this.name_resolver):undefined,this.seen_tokens=!1,this.matched=!1}function J(e,t,n,r,i){D.call(this,e),this.type=n||"token",this.datatype_library=r||"",this.ns=i||"",this.datatype=v.get(this.datatype_library).types[this.type];if(!this.datatype)throw new Error("unkown type: "+n);this.raw_value=t,this._value=undefined}function K(e,t){q.call(this),this.el=e,this.name_resolver=t,this.matched=!1,this.possible_cached=e?new O(new B("text",e.raw_value)):undefined,this.context=e&&e.datatype.needs_context?{resolver:this.name_resolver}:undefined}function Q(e,t,n,r,i){D.call(this,e),this.type=t||"token",this.datatype_library=n||"",this.except=i,this.datatype=v.get(this.datatype_library).types[this.type];if(!this.datatype)throw new Error("unkown type: "+t);this.rng_params=r||[],this._params=undefined}function G(e,t){q.call(this),this.el=e,this.name_resolver=t,this.el&&(this.possible_cached=new O(new B("text",this.el.datatype.regexp)),this.context=this.el.datatype.needs_context?{resolver:this.name_resolver}:undefined)}function Z(e){q.call(this),this.el=e,this.possible_cached=new O}function tt(e){q.call(this),this.possible_cached=new O(tt._text_event)}function nt(e,t){D.call(this,e),this.name=t,this.resolves_to=undefined}function rt(e,t){P.call(this,e);if(t!==undefined){if(t.length!==1)throw new Error("OneOrMore needs exactly one pattern.");this.pat=t[0]}}function it(e,t){q.call(this),this.seen_once=!1,this.el=e,this.name_resolver=t,this.current_iteration=undefined,this.next_iteration=undefined}function st(e,t){H.call(this,e);if(t!==undefined){if(t.length!==2)throw new Error("ChoiceWalker does not work with Choices that have not exactly 2 elements");this.pat_a=t[0],this.pat_b=t[1]}}function ot(e,t){q.call(this),this.el=e,this.name_resolver=t,this.chosen=!1,this.walker_a=this.walker_b=undefined,this.instantiated_walkers=!1}function ut(e,t){H.call(this,e);if(t!==undefined){if(t.length!==2)throw new Error("GroupWalkers walk only groups of two elements!");this.pat_a=t[0],this.pat_b=t[1]}}function at(e,t){q.call(this),this.el=e,this.name_resolver=t,this.hit_a=!1,this.ended_a=!1,this.hit_b=!1,this.walker_a=this.walker_b=undefined}function ft(e,t){H.call(this,e);if(t!==undefined){if(t.length!==2)throw new Error("InterleaveWalkers walk only interleaves of two elements!");this.pat_a=t[0],this.pat_b=t[1]}}function lt(e,t){q.call(this),this.el=e,this.name_resolver=t,this.in_a=!1,this.in_b=!1,this.walker_a=this.walker_b=undefined}function ct(e,t,n){P.call(this,e),this.name=t;if(n!==undefined){if(n.length!==1)throw new Error("Attribute needs exactly one pattern.");this.pat=n[0]}}function ht(e,t){q.call(this),this.el=e,this.name_resolver=t,this.seen_name=!1,this.seen_value=!1,this.subwalker=undefined,this.attr_name_event=e&&new B("attributeName",e.name.ns,e.name.name)}function pt(e,t,n){P.call(this,e),this.name=t;if(n!==undefined){if(n.length!==1)throw new Error("Element requires exactly one pattern.");this.pat=n[0]}}function dt(e,t){q.call(this),this.el=e,this.name_resolver=t,this.seen_name=!1,this.ended_start_tag=!1,this.closed=!1,this.walker=undefined,e!==undefined?(this.start_tag_event=new B("enterStartTag",e.name.ns,e.name.name),this.end_tag_event=new B("endTag",this.el.name.ns,this.el.name.name)):this.start_tag_event=this.end_tag_event=undefined}function vt(e,t,n){P.call(this,e),this.name=t;if(n!==undefined){if(n.length!==1)throw new Error("Define needs exactly one pattern.");this.pat=n[0]}}function mt(e,t){q.call(this),this.el=e,this.name_resolver=t,this.subwalker=e!==undefined?e.pat.newWalker(this.name_resolver):undefined}function gt(e){this.references=e}function yt(e,t,n){this.xml_path=e,this.start=t,this.definitions=Object.create(null),this._element_definitions=undefined,this._namespaces=Object.create(null);var r=this;n&&n.forEach(function(e){r.add(e)}),this._resolve(),this._prepare(this._namespaces)}function bt(e){q.call(this),this.el=e,this._name_resolver=new r.NameResolver,this.subwalker=e!==undefined?e.start.newWalker(this._name_resolver):undefined,this._misplaced_elements=[],this._swallow_attribute_value=!1,this.suspended_ws=undefined,this.ignore_next_ws=!1}var r=e("./name_resolver"),i=e("./util"),s=e("./hashstructs"),o=e("./oop"),u=e("./set").Set,a=e("./datatypes"),f=e("./errors"),l=f.ValidationError,c=f.ElementNameError,h=f.AttributeNameError,p=f.AttributeValueError,d=f.ChoiceError,v=a.registry,m=o.inherit,g=o.implement,y=s.HashSet,b=s.HashMap,w=!1;if(w){var E=function(e){console.log(e)},S=function(){E((new Error).stack)},x,T,N,C;(function(){var e="",t=" ",n=function(e){return e!==undefined?e.name!==undefined?" named "+e.name.toString():" with path "+e.xml_path:""};C=function(t,r,i){E(e+t+r+" on class "+i.constructor.name+" id "+i.id+(i.el!==undefined?n(i.el):n(i)))},x=function(n,r,s){e+=t,C("calling ",r,this);var o=n.apply(this,s);return C("called ",r,this),E(e+"return from the call: "+i.inspect(o)),e=e.slice(t.length),o},T=function(n,r,s){e+=t,C("calling ",r,this),E(e+i.inspect(s[0]));var o=n.apply(this,s);return C("called ",r,this),o!==!1&&E(e+"return from the call: "+i.inspect(o)),e=e.slice(t.length),o},N=function(n,r,i){e+=t,C("calling ",r,this);var s=n.apply(this,i);return C("called ",r,this),e=e.slice(t.length),s}})();var k=function(e,t,n){var r="___"+t;e[r]=e[t],e[t]=function(){return n.call(this,e[r],t,arguments)}}}var O=u;M.prototype.toString=function(){return"{"+this.ns+"}"+this.name},M.prototype.equal=function(e){return this.ns===e.ns&&this.name===e.name},m(D,Object),D.__id=0,D.prototype.__newID=function(){return D.__id++},D.prototype.hash=function(){return this.id},D.prototype._resolve=function(e){return undefined},D.prototype._prepare=function(e){},D.prototype.newWalker=function(){throw new Error("must define newWalker method")},D.prototype.clone=function(){return this._clone(new b(_))},D.prototype._clone=function(e){var t=e.has(this);return t!==undefined?t:(t=new this.constructor,e.add(this,t),this._copyInto(t,e),t)},D.prototype._copyInto=function(e,t){e.xml_path=this.xml_path},D.prototype._hasAttrs=function(){return!1},D.prototype._elementDefinitions=function(e){},m(P,D),P.prototype._resolve=function(e){return this.pat._resolve(e)},P.prototype._copyInto=function(e,t){D.prototype._copyInto.call(this,e,t),e.pat=this.pat._clone(t)},P.prototype._prepare=function(e){this.pat._prepare(e)},P.prototype._hasAttrs=function(){return this.pat._hasAttrs()},P.prototype._elementDefinitions=function(e){this.pat._elementDefinitions(e)},m(H,D),H.prototype._resolve=function(e){var t=this.pat_a._resolve(e),n=this.pat_b._resolve(e);return t&&n?t.concat(n):t?t:n},H.prototype._copyInto=function(e,t){D.prototype._copyInto.call(this,e,t),e.pat_a=this.pat_a._clone(t),e.pat_b=this.pat_b._clone(t)},H.prototype._prepare=function(e){this.pat_a._prepare(e),this.pat_b._prepare(e)},H.prototype._hasAttrs=function(){return this.pat_a._hasAttrs()||this.pat_b._hasAttrs()},H.prototype._elementDefinitions=function(e){this.pat_a._elementDefinitions(e),this.pat_b._elementDefinitions(e)},B.__cache=Object.create(null),B.__id=0,B.prototype.__newID=function(){return B.__id++},B.prototype.hash=function(){return this.id},B.prototype.isAttributeEvent=function(){return this.params[0]==="attributeName"||this.params[0]==="attributeValue"},B.prototype.toString=function(){return"Event: "+this.params.join(", ")};var F=new B("<empty>");q.__id=0,q.prototype.__newID=function(){return q.__id++},q.prototype.hash=function(){return this.id},q.prototype.possible=function(){return new O(this._possible())},q.prototype._possible=function(){throw new Error("must be implemented by derived classes")},q.prototype.fireEvent=function(e){throw new Error("must be implemented by derived classes")},q.prototype.canEnd=function(e){return!0},q.prototype.end=function(e){return!1},q.prototype.clone=function(){return this._clone(new b(_))},q.prototype._clone=function(e){var t=new this.constructor;return this._copyInto(t,e),t},q.prototype._cloneIfNeeded=function(e,t){var n=t.has(e);return n!==undefined?n:(n=e.clone(),t.add(e,n),n)},q.prototype._copyInto=function(e,t){e.possible_cached=this.possible_cached,e.suppressed_attributes=this.suppressed_attributes},q.prototype._suppressAttributes=function(){throw new Error("must be implemented by derived classes")},R.prototype._possible=function(e){return this.subwalker.possible()},R.prototype.fireEvent=function(e){return this.subwalker.fireEvent(e)},R.prototype._suppressAttributes=function(){this.suppressed_attributes||(this.suppressed_attributes=!0,this.subwalker._suppressAttributes())},R.prototype.canEnd=function(e){return this.subwalker.canEnd(e)},R.prototype.end=function(e){return this.subwalker.end(e)},U.prototype._suppressAttributes=function(){this.suppressed_attributes=!0},U.prototype.canEnd=function(e){return!0},U.prototype.end=function(e){return!1};var z=A(D);m(z,D),L(z,W),m(W,q),g(W,U),W.prototype.possible=function(){return new O},W.prototype._possible=function(){return this.possible_cached},W.prototype.fireEvent=function(e){return e===F||e.params[0]==="text"&&e.params[1].trim()===""?!1:undefined};var X=A(D);m(X,D),L(X,tt),m(V,P),L(V,$),m($,q),g($,R),$.prototype._copyInto=function(e,t){q.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.subwalker=this.subwalker._clone(t),e.seen_tokens=this.seen_tokens,e.matched=this.matched},$.prototype.fireEvent=function(e){if(e.params[0]!=="text")return undefined;var t=e.params[1].trim();if(t==="")return!1;this.seen_tokens=!0;var n=t.split(/\s+/);for(var r=0;r<n.length;++r){var i=this.subwalker.fireEvent(new B(e.params[0],n[r]));if(i!==!1)return i}return this.matched=!0,!1},$.prototype._suppressAttributes=function(){},$.prototype.canEnd=function(e){return this.seen_tokens?this.subwalker.canEnd(e):this.subwalker.fireEvent(F)===!1},$.prototype.end=function(e){var t=this.subwalker.end(e);return t!==!1?t:this.canEnd(e)?!1:[new l("unfulfilled list")]},m(J,D),L(J,K),J.prototype._copyInto=function(e,t){D.prototype._copyInto.call(this,e,t),e.value=this.value,e.raw_value=this.raw_value,e.type=this.type,e.datatype_library=this.datatype_library,e.ns=this.ns,e.datatype=this.datatype,e._value=this._value},Object.defineProperty(J.prototype,"value",{get:function(){var e=this._value;if(e)return e;var t;if(this.datatype.needs_context){var n=new r.NameResolver;n.definePrefix("",this.ns),t={resolver:n}}return e=this._value=this.datatype.parseValue(this.raw_value,t),e}}),m(K,q),K.prototype._copyInto=function(e,t){q.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.context=this.context?{resolver:e.name_resolver}:undefined,e.matched=this.matched},K.prototype._possible=function(){return this.possible_cached},K.prototype.fireEvent=function(e){return this.matched?undefined:e.params[0]!=="text"?undefined:this.el.datatype.equal(e.params[1],this.el.value,this.context)?(this.matched=!0,this.possible_cached=new O,!1):undefined},K.prototype.canEnd=function(e){return this.matched||this.el.raw_value===""},K.prototype.end=function(e){return this.canEnd(e)?!1:[new l("value required: "+this.el.raw_value)]},K.prototype._suppressAttributes=function(){},m(Q,D),L(Q,G),Q.prototype._copyInto=function(e,t){D.prototype._copyInto.call(this,e,t),e.type=this.type,e.datatype_library=this.datatype_library,e.except=this.except&&this.except._clone(t),e.datatype=this.datatype,e.rng_params=this.rng_params,e._params=this._params},Object.defineProperty(Q.prototype,"params",{get:function(){var e=this._params;return e?e:(e=this._params=this.datatype.parseParams(this.xml_path,this.rng_params),e)}}),m(G,q),G.prototype._copyInto=function(e,t){q.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.context=this.context?{resolver:e.name_resolver}:undefined,e.matched=this.matched},G.prototype._possible=function(){return this.possible_cached},G.prototype.fireEvent=function(e){return this.matched?undefined:e.params[0]!=="text"?undefined:this.el.datatype.disallows(e.params[1],this.el.params,this.context)?undefined:(this.matched=!0,this.possible_cached=new O,!1)},G.prototype.canEnd=function(e){return this.matched||!this.el.datatype.disallows("",this.el.params,this.context)},G.prototype.end=function(e){return this.canEnd(e)?!1:[new l("value required")]},G.prototype._suppressAttributes=function(){};var Y=A(D);m(Y,D),L(Y,Z),m(Z,q),Z.prototype._copyInto=function(e,t){q.prototype._copyInto.call(this,e,t),e.el=this.el},Z.prototype.possible=function(){return new O},Z.prototype._possible=function(){return this.possible_cached},Z.prototype.fireEvent=function(e){return undefined};var et=A(D);m(et,D),L(et,tt),m(tt,q),g(tt,U),tt._text_event=new B("text","*"),tt.prototype._possible=function(){return this.possible_cached},tt.prototype.fireEvent=function(e){return e.params[0]==="text"?!1:undefined},m(nt,D),nt.prototype._prepare=function(){return},nt.prototype._copyInto=function(e,t){D.prototype._copyInto.call(this,e,t),e.name=this.name,e.resolves_to=this.resolves_to},nt.prototype._resolve=function(e){return this.resolves_to=e[this.name],this.resolves_to===undefined?[this]:undefined},nt.prototype.newWalker=function(e){return this.resolves_to.pat.newWalker(e)},m(rt,P),L(rt,it),m(it,q),it.prototype._copyInto=function(e,t){q.prototype._copyInto.call(this,e,t),e.seen_once=this.seen_once,e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.current_iteration=this.current_iteration!==undefined?this.current_iteration._clone(t):undefined,e.next_iteration=this.next_iteration!==undefined?this.next_iteration._clone(t):undefined},it.prototype._possible=function(){if(this.possible_cached!==undefined)return this.possible_cached;this.current_iteration===undefined&&(this.current_iteration=this.el.pat.newWalker(this.name_resolver)),this.possible_cached=this.current_iteration._possible();if(this.current_iteration.canEnd()){this.possible_cached=new O(this.possible_cached),this.next_iteration===undefined&&(this.next_iteration=this.el.pat.newWalker(this.name_resolver));var e=this.next_iteration._possible(this.name_resolver);this.possible_cached.union(e)}return this.possible_cached},it.prototype.fireEvent=function(e){this.possible_cached=undefined,this.current_iteration===undefined&&(this.current_iteration=this.el.pat.newWalker(this.name_resolver));var t=this.current_iteration.fireEvent(e);t===!1&&(this.seen_once=!0);if(t!==undefined)return t;if(this.seen_once&&this.current_iteration.canEnd()){t=this.current_iteration.end();if(t)throw new Error("internal error; canEnd() returns true but end() fails");this.next_iteration===undefined&&(this.next_iteration=this.el.pat.newWalker(this.name_resolver));var n=this.next_iteration.fireEvent(e);return n===!1&&(this.current_iteration=this.next_iteration,this.next_iteration=undefined),n}return undefined},it.prototype._suppressAttributes=function(){},it.prototype.canEnd=function(e){return e?this.el.pat._hasAttrs()?(this.current_iteration===undefined&&(this.current_iteration=this.el.pat.newWalker(this.name_resolver)),this.current_iteration.canEnd(!0)):!0:this.seen_once&&this.current_iteration.canEnd()},it.prototype.end=function(e){return this.canEnd(e)?!1:(this.current_iteration===undefined&&(this.current_iteration=this.el.pat.newWalker(this.name_resolver)),this.next_iteration=undefined,this.current_iteration.end(e))},m(st,H),L(st,ot),m(ot,q),ot.prototype._copyInto=function(e,t){q.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.chosen=this.chosen,e.walker_a=this.walker_a!==undefined?this.walker_a._clone(t):undefined,e.walker_b=this.walker_b!==undefined?this.walker_b._clone(t):undefined,e.instantiated_walkers=this.instantiated_walkers},ot.prototype._instantiateWalkers=function(){this.instantiated_walkers||(this.instantiated_walkers=!0,this.walker_a=this.el.pat_a.newWalker(this.name_resolver),this.walker_b=this.el.pat_b.newWalker(this.name_resolver))},ot.prototype._possible=function(){this._instantiateWalkers();if(this.possible_cached!==undefined)return this.possible_cached;this.possible_cached=this.walker_a!==undefined?this.walker_a._possible():undefined;if(this.walker_b!==undefined){this.possible_cached=new O(this.possible_cached);var e=this.walker_b._possible();this.possible_cached.union(e)}else this.possible_cached===undefined&&(this.possible_cached=new O);return this.possible_cached},ot.prototype.fireEvent=function(e){this._instantiateWalkers(),this.possible_cached=undefined;var t=this.walker_a&&this.walker_a.fireEvent(e),n=this.walker_b&&this.walker_b.fireEvent(e);return t!==undefined?(this.chosen=!0,n===undefined?(this.walker_b=undefined,t):t):n!==undefined?(this.chosen=!0,this.walker_a=undefined,n):undefined},ot.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressed_attributes||(this.possible_cached=undefined,this.suppressed_attributes=!0,this.walker_a&&this.walker_a._suppressAttributes(),this.walker_b&&this.walker_b._suppressAttributes())},ot.prototype.canEnd=function(e){this._instantiateWalkers();var t=!1,n=!1;return e&&(t=!this.el.pat_a._hasAttrs(),n=!this.el.pat_b._hasAttrs()),t=t||!!this.walker_a&&this.walker_a.canEnd(e),n=n||!!this.walker_b&&this.walker_b.canEnd(e),t||n},ot.prototype.end=function(e){this._instantiateWalkers();if(this.canEnd(e))return!1;var t=!!this.walker_a&&this.walker_a.end(e),n=!!this.walker_b&&this.walker_b.end(e);if(!t&&!n)return!1;if(t&&!n)return t;if(!t&&n)return n;var r=[],i=[],s=!1;this.walker_a.possible().forEach(function(e){e.params[0]==="enterStartTag"?r.push(new M(e.params[1],e.params[2])):s=!0});if(!s){this.walker_b.possible().forEach(function(e){e.params[0]==="enterStartTag"?i.push(new M(e.params[1],e.params[2])):s=!0});if(!s)return[new d(r,i)]}return t||n},m(ut,H),L(ut,at),m(at,q),at.prototype._copyInto=function(e,t){q.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.hit_a=this.hit_a,e.ended_a=this.ended_a,e.hit_b=this.hit_b,e.walker_a=this.walker_a!==undefined?this.walker_a._clone(t):undefined,e.walker_b=this.walker_b!==undefined?this.walker_b._clone(t):undefined},at.prototype._instantiateWalkers=function(){this.walker_a===undefined&&(this.walker_a=this.el.pat_a.newWalker(this.name_resolver),this.walker_b=this.el.pat_b.newWalker(this.name_resolver))},at.prototype._possible=function(){this._instantiateWalkers();if(this.possible_cached!==undefined)return this.possible_cached;this.possible_cached=this.ended_a?undefined:this.walker_a._possible();if(this.suppressed_attributes){if(this.ended_a||this.walker_a.canEnd())this.possible_cached=new O(this.possible_cached),this.possible_cached.union(this.walker_b._possible())}else{var e=this.walker_b._possible();(!this.ended_a||this.hit_b)&&!this.walker_a.canEnd()&&(e=e.filter(function(e){return e.isAttributeEvent()})),this.possible_cached=new O(this.possible_cached),this.possible_cached.union(e)}return this.possible_cached},at.prototype.fireEvent=function(e){this._instantiateWalkers(),this.possible_cached=undefined;if(!this.ended_a){var t=this.walker_a.fireEvent(e);if(t!==undefined)return this.hit_a=!0,t;if(!e.isAttributeEvent()&&!this.walker_a.canEnd())return undefined}var n=this.walker_b.fireEvent(e);n!==undefined&&(this.hit_b=!0);if(!e.isAttributeEvent()&&n!==undefined&&!this.ended_a){var r=this.walker_a.end();this.ended_a=!0,n?r&&(n=n.concat(r)):n=r}return n},at.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressed_attributes||(this.possible_cached=undefined,this.suppressed_attributes=!0,this.walker_a._suppressAttributes(),this.walker_b._suppressAttributes())},at.prototype.canEnd=function(e){this._instantiateWalkers();if(e){var t=this.el.pat_a._hasAttrs(),n=this.el.pat_b._hasAttrs();return t&&n?this.walker_a.canEnd(e)&&this.walker_b.canEnd(e):t?this.walker_a.canEnd(!0):n?this.walker_b.canEnd(!0):!0}return this.walker_a.canEnd(e)&&this.walker_b.canEnd(e)},at.prototype.end=function(e){if(this.canEnd())return!1;var t;if(!this.ended_a){t=this.walker_a.end(e);if(t)return t}return t=this.walker_b.end(e),t?t:!1},m(ft,H),L(ft,lt),m(lt,q),lt.prototype._copyInto=function(e,t){q.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.in_a=this.in_a,e.in_b=this.in_b,e.walker_a=this.walker_a&&this.walker_a._clone(t),e.walker_b=this.walker_b&&this.walker_b._clone(t)},lt.prototype._instantiateWalkers=function(){this.walker_a||(this.walker_a=this.el.pat_a.newWalker(this.name_resolver)),this.walker_b||(this.walker_b=this.el.pat_b.newWalker(this.name_resolver))},lt.prototype._possible=function(){this._instantiateWalkers();if(this.possible_cached!==undefined)return this.possible_cached;if(this.in_a&&this.in_b)throw new Error("impossible state");return this.in_a&&!this.walker_a.canEnd()?this.possible_cached=this.walker_a._possible():this.in_b&&!this.walker_b.canEnd()&&(this.possible_cached=this.walker_b._possible()),this.possible_cached||(this.possible_cached=this.walker_a.possible(),this.possible_cached.union(this.walker_b._possible())),this.possible_cached},lt.prototype.fireEvent=function(e){this._instantiateWalkers(),this.possible_cached=undefined;if(this.in_a&&this.in_b)throw new Error("impossible state");var t,n;if(!this.in_a&&!this.in_b)return t=this.walker_a.fireEvent(e),t===!1?(this.in_a=!0,!1):(n=this.walker_b.fireEvent(e),n===!1?(this.in_b=!0,!1):n===undefined?t:t===undefined?n:t.concat(n));if(this.in_a){t=this.walker_a.fireEvent(e);if(t||t===!1)return t;n=this.walker_b.fireEvent(e);if(n===!1)return this.in_a=!1,this.in_b=!0,!1}else{n=this.walker_b.fireEvent(e);if(n||n===!1)return n;t=this.walker_a.fireEvent(e);if(t===!1)return this.in_a=!0,this.in_b=!1,!1}return undefined},lt.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressed_attributes||(this.possible_cached=undefined,this.suppressed_attributes=!0,this.walker_a._suppressAttributes(),this.walker_b._suppressAttributes())},lt.prototype.canEnd=function(e){return this._instantiateWalkers(),this.walker_a.canEnd(e)&&this.walker_b.canEnd(e)},lt.prototype.end=function(e){this._instantiateWalkers();var t=this.walker_a.end(e),n=this.walker_b.end(e);return t&&!n?t:n&&!t?n:!t&&!n?!1:t.concat(n)},m(ct,P),L(ct,ht),ct.prototype._copyInto=function(e,t){D.prototype._copyInto.call(this,e,t),e.name=this.name,e.pat=this.pat},ct.prototype._prepare=function(e){this.name.ns!==""&&(e[this.name.ns]=1)},ct.prototype._hasAttrs=function(){return!0},m(ht,q),ht.prototype._copyInto=function(e,t){q.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.seen_name=this.seen_name,e.seen_value=this.seen_value,e.subwalker=this.subwalker&&this.subwalker._clone(t),e.attr_name_event=this.attr_name_event},ht.prototype._possible=function(){if(this.suppressed_attributes)return new O;if(!this.seen_name)return new O(this.attr_name_event);if(!this.seen_value){this.subwalker===undefined&&(this.subwalker=this.el.pat.newWalker(this.name_resolver));var e=this.subwalker._possible(),t=new O;return e.forEach(function(e){if(e.params[0]!=="text")throw new Error("unexpected event type: "+e.params[0]);t.add(new B("attributeValue",e.params[1]))}),t}return new O},ht.prototype.possible=ht.prototype._possible,ht.prototype.fireEvent=function(e){if(this.suppressed_attributes)return undefined;if(this.seen_name){if(!this.seen_value&&e.params[0]==="attributeValue"){this.seen_value=!0,this.subwalker||(this.subwalker=this.el.pat.newWalker(this.name_resolver));var t=new B("text",e.params[1]),n=this.subwalker.fireEvent(t);return n===undefined?[new p("invalid attribute value",this.el.name)]:n instanceof I?[new p("invalid attribute value",this.el.name)]:(n===!1&&(n=this.subwalker.end()),n)}}else if(e.params[0]==="attributeName"&&e.params[1]===this.el.name.ns&&e.params[2]===this.el.name.name)return this.seen_name=!0,!1;return undefined},ht.prototype._suppressAttributes=function(){this.suppressed_attributes=!0},ht.prototype.canEnd=function(e){return this.suppressed_attributes||this.seen_value},ht.prototype.end=function(e){return this.suppressed_attributes?!1:this.seen_name?this.seen_value?!1:[new p("attribute value missing",this.el.name)]:[new h("attribute missing",this.el.name)]},m(pt,P),pt.prototype._copyInto=function(e,t){P.prototype._copyInto.call(this,e,t),e.name=this.name},pt.prototype._prepare=function(e){e[this.name.ns]=1,this.pat._prepare(e)},pt.prototype.newWalker=function(e){return this.pat instanceof Y?this.pat.newWalker(e):new dt(this,e)},pt.prototype._hasAttrs=function(){return!1},pt.prototype._elementDefinitions=function(e){var t=this.name.toString();e[t]===undefined?e[t]=[this]:e[t].push(this)},m(dt,q),dt._leaveStartTag_event=new B("leaveStartTag"),dt.prototype._copyInto=function(e,t){q.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.seen_name=this.seen_name,e.ended_start_tag=this.ended_start_tag,e.closed=this.closed,e.walker=this.walker!==undefined?this.walker._clone(t):undefined,e.start_tag_event=this.start_tag_event,e.end_tag_event=this.end_tag_event},dt.prototype._possible=function(){if(!this.seen_name)return new O(this.start_tag_event);if(!this.ended_start_tag){var e=this.walker._possible(),t=new O,n=new O;return e.forEach(function(e){e.params[0]==="attributeValue"?n.add(e):e.isAttributeEvent()&&t.add(e)}),n.size()?t=n:this.walker.canEnd(!0)&&t.add(dt._leaveStartTag_event),t}if(!this.closed){var r=new O(this.walker._possible());return this.walker.canEnd()&&r.add(this.end_tag_event),r}return new O},dt.prototype.possible=dt.prototype._possible,dt.prototype.fireEvent=function(e){var t;if(!this.ended_start_tag){if(!this.seen_name){if(e.params[0]==="enterStartTag"&&e.params[1]===this.el.name.ns&&e.params[2]===this.el.name.name)return this.walker=this.el.pat.newWalker(this.name_resolver),this.seen_name=!0,!1}else if(e.params[0]==="leaveStartTag"){this.ended_start_tag=!0;var n=this.walker.end(!0);t=[];for(var r=0;r<n.length;++r){var i=n[r];(i instanceof p||i instanceof h)&&t.push(i)}return t.length===0&&(t=!1),this.walker._suppressAttributes(),t||!1}return this.walker!==undefined?this.walker.fireEvent(e):undefined}if(!this.closed){t=this.walker.fireEvent(e);if(t===undefined)if(e.params[0]==="endTag"){if(e.params[1]===this.el.name.ns&&e.params[2]===this.el.name.name)return this.closed=!0,this.walker.end()}else if(e.params[0]==="leaveStartTag")return[new l("unexpected leaveStartTag event; it is likely that fireEvent is incorrectly called")];return t}return undefined},dt.prototype._suppressAttributes=function(){return},dt.prototype.canEnd=function(e){return e?!0:this.closed},dt.prototype.end=function(e){if(e)return!1;var t=[];if(!this.seen_name)t.push(new c("tag required",this.el.name));else if(!this.ended_start_tag||!this.closed){if(this.walker!==undefined){var n=this.walker.end();n&&(t=n)}t.push(this.ended_start_tag?new c("tag not closed",this.el.name):new c("start tag not terminated",this.el.name))}return t.length>0?t:!1},m(vt,P),L(vt,mt),vt.prototype._copyInto=function(e,t){P.prototype._copyInto.call(this,e,t),e.name=this.name},m(mt,q),g(mt,R),mt.prototype._copyInto=function(e,t){q.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.subwalker=this.subwalker._clone(t)},m(gt,Error),gt.prototype.toString=function(){return"Cannot resolve the following references: "+this.references.toString()},yt.prototype.definitions=undefined,yt.prototype.start=undefined,yt.prototype._resolve=function(){var e=[],t;for(var n in this.definitions)t=this.definitions[n]._resolve(this.definitions),t&&(e=e.concat(t));t=this.start._resolve(this.definitions),t&&(e=e.concat(t));if(e.length)throw new gt(e)},yt.prototype.add=function(e){this.definitions[e.name]=e,e.name==="start"&&(this.start=e)},yt.prototype._prepare=function(e){this.start._prepare(e);for(var t in this.definitions)this.definitions[t]._prepare(e)},yt.prototype._elementDefinitions=function(e){for(var t in this.definitions)this.definitions[t]._elementDefinitions(e)},Object.defineProperty(yt.prototype,"element_definitions",{get:function(){var e=this._element_definitions;return e?e:(e=this._element_definitions=Object.create(null),this._elementDefinitions(e),e)}}),yt.prototype.whollyContextIndependent=function(){var e=this.element_definitions;for(var t in e)if(e[t].length>1)return!1;return!0},yt.prototype.getNamespaces=function(){return Object.keys(this._namespaces)},L(yt,bt),m(bt,q),g(bt,R),bt.prototype.subwalker=undefined,bt.prototype._copyInto=function(e,t){q.prototype._copyInto.call(this,e,t),e.el=this.el,e.subwalker=this.subwalker._clone(t),e._misplaced_elements=[];for(var n=0,r;(r=this._misplaced_elements[n])!==undefined;++n)e._misplaced_elements.push(r instanceof q?r._clone(t):r.concat([]));e._swallow_attribute_value=this.swallow_attribute_value,e._name_resolver=this._cloneIfNeeded(this._name_resolver,t),e.suspended_ws=this.suspended_ws,e.ignore_next_ws=this.ignore_next_ws},bt.prototype.resolveName=function(e,t){return this._name_resolver.resolveName(e,t)},bt.prototype.unresolveName=function(e,t){return this._name_resolver.unresolveName(e,t)},bt.prototype.fireEvent=function(e){function t(e){i===undefined&&(i=[new l("text not allowed here")]);if(i===!1)return e;if(e===!1)return i;if(e===undefined)throw new Error("undefined x");return i.concat(e)}if(e.params[0]==="enterContext"||e.params[0]==="leaveContext"||e.params[0]==="definePrefix"){switch(e.params[0]){case"enterContext":this._name_resolver.enterContext();break;case"leaveContext":this._name_resolver.leaveContext();break;case"definePrefix":this._name_resolver.definePrefix(e.params[1],e.params[2])}return!1}if(e.params[0]==="text"&&e.params[1].trim()==="")return this.suspended_ws?this.suspended_ws+=e.params[1]:this.suspended_ws=e.params[1],!1;var n=this._misplaced_elements.length>0&&this._misplaced_elements[0]instanceof q?this._misplaced_elements[0]:this.subwalker,r=this.ignore_next_ws;this.ignore_next_ws=!1;var i=!1;switch(e.params[0]){case"enterStartTag":this.suspended_ws=undefined;break;case"text":if(this.ignore_next_ws){this.suspended_ws=undefined;var s=e.params[1].replace(/^\s+/,"");s.length!==e.params[1].length&&(e=new B("text",s))}else this.suspended_ws&&(i=n.fireEvent(new B("text",this.suspended_ws)),this.suspended_ws=undefined);break;case"endTag":this.ignore_next_ws=!0;default:this.suspended_ws&&!r&&(i=n.fireEvent(new B("text",this.suspended_ws))),this.suspended_ws=undefined}if(this._misplaced_elements.length>0&&this._misplaced_elements[0]instanceof Array){var o=this._misplaced_elements[0];switch(e.params[0]){case"enterStartTag":o.unshift(e.params.slice(1));break;case"endTag":o.shift()}return o.length||this._misplaced_elements.shift(),!1}if(this.swallow_attribute_value)return this.swallow_attribute_value=!1,e.params[0]==="attributeValue"?!1:[new l("attribute value required")];var u=n.fireEvent(e);if(u instanceof I){if(e.params[0]!=="text")throw new Error("got PartialMatch when firing a non-text event");var a=new B("text",e.params[1].slice(u.length));return this.fireEvent(a)}if(u===undefined)switch(e.params[0]){case"enterStartTag":var f=new M(e.params[1],e.params[2]);u=[new c("tag not allowed here",f)];var p=this.el.element_definitions[f.toString()];if(p&&p.length===1){var d=p[0].newWalker(this._name_resolver);this._misplaced_elements.unshift(d);if(d.fireEvent(e)!==!1)throw new Error("internal error: the infered element does not accept its initial event")}else this._misplaced_elements.unshift([e.params.slice(1)]);break;case"endTag":u=[new c("unexpected end tag",new M(e.params[1],e.params[2]))];break;case"attributeName":u=[new h("attribute not allowed here",new M(e.params[1],e.params[2]))],this.swallow_attribute_value=!0;break;case"attributeValue":u=[new l("unexpected attributeValue event; it is likely that fireEvent is incorrectly called")];break;case"text":u=[new l("text not allowed here")];break;case"leaveStartTag":default:throw new Error("unexpected event type in GrammarWalker's fireEvent: "+e.params[0])}if(this._misplaced_elements.length>0&&this._misplaced_elements[0]instanceof q){n=this._misplaced_elements[0];if(n.canEnd()){this._misplaced_elements.shift();var v=n.end();v&&(u=u?u.concat(v):v)}}return t(u)},bt.prototype.possible=function(e){if(this._misplaced_elements.length){var t=this._misplaced_elements[0];return t instanceof q?t.possible():new O}return this.subwalker.possible()},bt.prototype._suppressAttributes=function(){throw new Error("_suppressAttributes cannot be called on a GrammarWalker")},t.Event=B,t.eventsToTreeString=j,t.EName=M,t.ReferenceError=gt,t.ValidationError=l,t.AttributeNameError=h,t.AttributeValueError=p,t.ElementNameError=c,t.ChoiceError=d,t.Grammar=yt,t.Walker=q;var wt={};wt.GrammarWalker=bt,wt.Text=et,t.__test=function(){return wt},t.__protected={Empty:z,Data:Q,List:V,Param:X,Value:J,NotAllowed:Y,Text:et,Ref:nt,OneOrMore:rt,Choice:st,Group:ut,Attribute:ct,Element:pt,Define:vt,Grammar:yt,EName:M,Interleave:ft}}),define("salve/formats",["require","exports","module","./util","./oop","./patterns"],function(e,t,n){function l(){Error.call(this,"your schema file must be recreated with a newer version of salve-convert")}function c(e){this.options=e}function h(){c.apply(this,arguments)}function p(e){var t=JSON.parse(e);if(typeof t=="object"&&!t.v)throw new l;var n=t.v,r=t.o;if(n===2)return(new h(r)).walkObject(t.d,r);throw new Error("unknown version: "+n)}var r=e("./util"),i=e("./oop").inherit,s=e("./patterns"),o=s.__protected,u=[Array,o.Empty,o.Data,o.List,o.Param,o.Value,o.NotAllowed,o.Text,o.Ref,o.OneOrMore,o.Choice,o.Group,o.Attribute,o.Element,o.Define,o.Grammar,o.EName,o.Interleave],a={0:Array,Empty:o.Empty,1:o.Empty,Data:o.Data,2:o.Data,List:o.List,3:o.List,Param:o.Param,4:o.Param,Value:o.Value,5:o.Value,NotAllowed:o.NotAllowed,6:o.NotAllowed,Text:o.Text,7:o.Text,Ref:o.Ref,8:o.Ref,OneOrMore:o.OneOrMore,9:o.OneOrMore,Choice:o.Choice,10:o.Choice,Group:o.Group,11:o.Group,Attribute:o.Attribute,12:o.Attribute,Element:o.Element,13:o.Element,Define:o.Define,14:o.Define,Grammar:o.Grammar,15:o.Grammar,EName:o.EName,16:o.EName,Interleave:o.Interleave,17:o.Interleave},f=1;i(l,Error),c.prototype.walkObject=function(e){var t=e[0],n=u[t];if(n===undefined)throw e.length<1?new Error("array too small to contain object"):new Error("undefined type: "+t);if(n===Array)throw new Error("trying to build array with _constructObjectV2");var r=this.options&f&&n!==o.EName,i;return e.length>1?(i=e.slice(1),r?i.unshift(0,""):i.unshift(0),this._transformArray(i)):r?i=[""]:i=[],this._processObject(n,i)},c.prototype._processObject=function(e,t){return undefined},c.prototype._transformArray=function(e){if(e[0]!==0)throw new Error("array type not 0, but "+e[0]+" for array "+e);e.splice(0,1);var t=e.length;for(var n=0;n<t;n++){var r=e[n];r instanceof Array&&(r[0]!==0?e[n]=this.walkObject(r):this._transformArray(r))}},i(h,c),h.prototype._processObject=function(e,t){if(e===o.Data&&t.length>=4){var n=t[3];if(n.length%2!==0)throw new Error("parameter array length not a multiple of 2");var r=new Array(n.length/2);for(var i=0,s=n.length;i<s;i+=2)r[i/2]={name:n[i],value:n[i+1]};t[3]=r}var u=Object.create(e.prototype),a=e.apply(u,t);return a!==undefined?a:u},t.constructTree=p,t.__protected={V2JSONWalker:c,name_to_constructor:a,OPTION_NO_PATHS:f}}),define("salve/validate",["require","exports","module","./patterns","./formats"],function(e,t,n){var r=e("./patterns"),i=e("./formats");t.version="0.23.0";for(var s in r)t[s]=r[s];t.constructTree=i.constructTree}),define("wed/validator",["require","exports","module","./lib/simple_event_emitter","salve/validate","jquery","./oop","./dloc"],function(e,t,n){function m(e,t,n){r.call(this),this.schema=e,this.root=t,this.mode=n,this._cycle_entered=0,this._timeout=200,this._max_timespan=100,this._timeout_id=undefined,this._initialized=!1,this._restarting=!1,this._errors=[],this._tree=undefined,this._bound_wrapper=this._workWrapper.bind(this),this._events=[],this._validation_walker=undefined,this._working_state=undefined,this._part_done=0,this._validation_stage=l,this._previous_child=null,this._validation_stack=[new y(0,1)],this._cur_el=this.root,this._cur_el.wed_event_index_after_start=this._events.length,this._setWorkingState(h)}function g(){Error.call(this,"undefined event_index; _validateUpTo should have taken care of that"),Error.captureStackTrace(this,this.constructor)}function y(e,t){this.part_done=e,this.portion=t}var r=e("./lib/simple_event_emitter").SimpleEventEmitter,i=e("salve/validate"),s=e("jquery"),o=e("./oop"),u=e("./dloc"),a=Array.prototype.indexOf,f=1,l=2,c=3,h=1,p=2,d=3,v=4;t.INCOMPLETE=h,t.WORKING=p,t.INVALID=d,t.VALID=v,o.implement(m,r),m.prototype.start=function(){this._timeout_id!==undefined&&this.stop(),this._initialized?(this._setWorkingState(p,this._part_done),this._timeout_id=window.setTimeout(this._bound_wrapper,this._timeout)):this.initialize(function(){this._setWorkingState(p,this._part_done),this._timeout_id=window.setTimeout(this._bound_wrapper,this._timeout)}.bind(this))},m.prototype.initialize=function(t){this.schema instanceof i.Grammar?(this._tree=this.schema,this._validation_walker=this._tree.newWalker(),this._initialized=!0,t()):s.get(e.toUrl(this.schema),function(e){this._tree=i.constructTree(e),this._validation_walker=this._tree.newWalker(),this._initialized=!0,t()}.bind(this),"text").fail(function(e,t,n){throw new Error(t+" "+n)})},m.prototype.getSchemaNamespaces=function(){if(!this._initialized)throw new Error("calling getSchemaNamespaces on uninitialized validator");return this._tree.getNamespaces()},m.prototype.getDocumentNamespaces=function(){function t(n){var r=n.attributes.length;for(var i=0;i<r;++i){var s=n.attributes[i];if(s.name.lastIndexOf("xmlns",0)===0){var o=s.name.slice(6),u=e[o];u||(u=e[o]=[]),u.push(s.value)}}n=n.firstChild;while(n)n.nodeType===Node.ELEMENT_NODE&&t(n),n=n.nextSibling}var e={};return t(this.root.firstChild),e},m.prototype._workWrapper=function(){this._work()&&(this._timeout_id=window.setTimeout(this._bound_wrapper,this._timeout))},m.prototype._work=function(){if(!this._initialized)return!0;var e=new Date;for(;;){if(this._max_timespan>0&&new Date-e>=this._max_timespan)return!0;var t=this._cycle();if(!t)return!1}return!0},m.prototype._cycle=function(){this._restarting=!1;var e,t,n,r,s,o=this._validation_walker,u=this._validation_stack[0].portion;if(this.cycle_entered>0)throw new Error("internal error: _cycle is being reentered");if(this.cycle_entered<0)throw new Error("internal error: _cycle_entered negative");this.cycle_entered++;e:for(;;){var h=this._cur_el;switch(this._validation_stage){case f:this._validation_stack.unshift(new y(this._part_done,u)),this._fireAndProcessEvent(o,new i.Event("enterContext"),h,0);var m=h.attributes.length;for(n=0;n<m;++n)r=h.attributes[n],r.name==="xmlns"?this._fireAndProcessEvent(o,new i.Event("definePrefix","",r.value),h,0):r.name.lastIndexOf("xmlns:",0)===0&&this._fireAndProcessEvent(o,new i.Event("definePrefix",r.name.slice(6),r.value),h,0);t=o.resolveName(h.tagName);var g=h.parentNode?a.call(h.parentNode.childNodes,h):undefined;return this._fireAndProcessEvent(o,new i.Event("enterStartTag",t.ns,t.name),h.parentNode,g),h.wed_event_index_before_attributes=this._events.length,this._fireAttributeEvents(o,h),h.wed_event_index_after_attributes=this._events.length,this._fireAndProcessEvent(o,new i.Event("leaveStartTag"),h,0),this._validation_stage=l,h.wed_event_index_after_start=this._events.length,this.cycle_entered--,!0;case l:var b=this._previous_child===null?h.firstChild:this._previous_child.nextSibling;while(b!==null){switch(b.nodeType){case Node.TEXT_NODE:var w=new i.Event("text",b.data);e=o.fireEvent(w),e&&this._processEventResult(e,b.parentNode,a.call(b.parentNode.childNodes,b));break;case Node.ELEMENT_NODE:u/=h.childElementCount,this._cur_el=h=b,this._validation_stage=f,this._previous_child=null;continue e;default:throw new Error("unexpected node type: "+b.nodeType)}b=b.nextSibling}b===null&&(this._validation_stage=c);break;case c:if(h===this.root)return e=o.end(),e&&this._processEventResult(e,h,h.childNodes.length),this._runDocumentValidation(),this._part_done=1,this._setWorkingState(this._errors.length>0?d:v),h.wed_event_index_after=this._events.length,this.stop(),this.cycle_entered--,!1;var E=h;return t=o.resolveName(h.tagName),this._fireAndProcessEvent(o,new i.Event("endTag",t.ns,t.name),h,h.childNodes.length),this._fireAndProcessEvent(o,new i.Event("leaveContext"),h,h.childNodes.length),this._previous_child=h,this._cur_el=h=h.parentNode,h!==this.root&&(this._validation_stack.shift(),this._part_done=this._validation_stack[0].part_done+=u,u=this._validation_stack[0].portion),this._setWorkingState(p,this._part_done),E.wed_event_index_after=this._events.length,this._validation_stage=l,this.cycle_entered--,!0;default:throw new Error("unexpected state")}}this.cycle_entered--},m.prototype._runDocumentValidation=function(){if(!this.mode)return;var e=this.mode.validateDocument();for(var t=0,n;n=e[t];++t)this._processError(n)},m.prototype.stop=function(){this._timeout_id!==undefined&&window.clearTimeout(this._timeout_id),this._timeout_id=undefined,this._working_state===p&&this._setWorkingState(h)},m.prototype.restartAt=function(e){this._working_state===p&&this.stop(),this._initialized&&!this._restarting&&(this._restarting=!0,this._resetTo(e)),this.start()},m.prototype._resetTo=function(e){function t(e){e.wed_event_index_after=undefined,e.wed_event_index_after_start=undefined,e.wed_event_index_before_attributes=undefined,e.wed_event_index_after_attributes=undefined;var n=e.firstElementChild;while(n)t(n),n=n.nextElementSibling}t(this.root),this._validation_stage=l,this._previous_child=null,this._validation_walker=this._tree.newWalker(),this._events=[],this._cur_el=this.root,this._part_done=0,this._errors=[],this._emit("reset-errors",{at:0})},m.prototype._setWorkingState=function(e){if(this._working_state!==e||e===p)this._working_state=e,this._emit("state-update")},m.prototype.getWorkingState=function(){return{state:this._working_state,part_done:this._part_done}},m.prototype._processEventResult=function(e,t,n){for(var r=0,i;(i=e[r])!==undefined;++r){var s={error:i,node:t,index:n};this._processError(s)}},m.prototype._processError=function(e){this._errors.push(e),this._emit("error",e)},m.prototype._fireAttributeEvents=function(e,t){for(var n=0,r;r=t.attributes[n];++n){if(r.name==="xmlns"||r.name.lastIndexOf("xmlns",0)===0)continue;this._fireAttributeNameEvent(e,t,r),this._fireAndProcessEvent(e,new i.Event("attributeValue",r.value),r,0)}},m.prototype._fireAttributeNameEvent=function(e,t,n){var r=n.name,s=e.resolveName(r,!0);this._fireAndProcessEvent(e,new i.Event("attributeName",s.ns,s.name),n,0)},m.prototype._fireAndProcessEvent=function(e,t,n,r){this._events.push(t);var i=e.fireEvent(t);i&&this._processEventResult(i,n,r)},m.prototype._validateUpTo=function(e,t,n){n=!!n;if(n&&(!e.childNodes||e.childNodes[t].nodeType!==Node.ELEMENT_NODE))throw new Error("trying to validate after attributes but before the end of the start tag on a node which is not an element node");var r=e,i="wed_event_index_after";if(e===this.root&&t<=0){if(n)i="wed_event_index_after_attributes",r=e.childNodes[t];else if(t===0)return}else{var s;switch(e.nodeType){case Node.TEXT_NODE:r=e.previousElementSibling,r||(r=e.parentNode,i="wed_event_index_after_start");break;case Node.ELEMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:case Node.DOCUMENT_NODE:var o=e.childNodes[t];s=o?o.previousElementSibling:e.lastElementChild,s?r=s:n?(i="wed_event_index_after_attributes",r=o):i="wed_event_index_after_start";break;case Node.ATTRIBUTE_NODE:r=e.ownerElement,i="wed_event_index_before_attributes";break;default:throw new Error("unexpected node type: "+e.nodeType)}}while(r[i]===undefined)this._cycle()},o.inherit(g,Error),m.prototype._getWalkerAt=function(e,t,n){function o(e){var t=new i.Event("text",e.data);r.fireEvent(t)}n=!!n;if(n&&(!e.childNodes||e.childNodes[t].nodeType!==Node.ELEMENT_NODE))throw new Error("trying to get a walker for attribute events on a node which is not an element node");this._validateUpTo(e,t,n);var r,s;if(e===this.root&&t<=0){r=this._tree.newWalker();if(!n){if(t===0)return r;a=e.wed_event_index_after;if(a===undefined)throw new g;for(s=0;s<this._events.length;++s)r.fireEvent(this._events[s]);return r}}var u,a;switch(e.nodeType){case Node.TEXT_NODE:u=e.previousElementSibling,a=u?u.wed_event_index_after:e.parentNode.wed_event_index_after_start;if(a===undefined)throw new g;r=this._tree.newWalker();for(s=0;s<a;++s)r.fireEvent(this._events[s]);t>0&&o(e);break;case Node.ELEMENT_NODE:case Node.DOCUMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:var f=e.childNodes[t];n?a=f.wed_event_index_after_attributes:(u=f?f.previousElementSibling:e.lastElementChild,a=u?u.wed_event_index_after:e.wed_event_index_after_start);if(a===undefined)throw new g;r=this._tree.newWalker();for(s=0;s<a;++s)r.fireEvent(this._events[s]);if(!n){var l=f&&f.previousSibling;l&&l!==u&&l.nodeType===Node.TEXT_NODE&&o(l)}break;case Node.ATTRIBUTE_NODE:var c=e.ownerElement;a=c.wed_event_index_before_attributes;if(a===undefined)throw new g;r=this._tree.newWalker();for(s=0;s<a;++s)r.fireEvent(this._events[s]);e.name!=="data-wed-xmlns"&&e.name.lastIndexOf("data-wed-xmlns---",0)!==0&&this._fireAttributeNameEvent(r,c,e);break;default:throw new Error("unexpected node type: "+e.nodeType)}return r},m.prototype.possibleAt=function(e,t,n){e instanceof u.DLoc&&(n=t,t=e.offset,e=e.node);var r=this._getWalkerAt(e,t,n);return r.possible()},m.prototype.possibleWhere=function(e,t){var n=[];for(var r=0;r<=e.childNodes.length;++r){var i=this.possibleAt(e,r);i.has(t)&&n.push(r)}return n},m.prototype.speculativelyValidate=function(e,t,n){if(!this._initialized)throw new Error("uninitialized Validator");e instanceof u.DLoc&&(n=t,t=e.offset,e=e.node);var r;if(n instanceof Array){r=e.ownerDocument.createDocumentFragment();for(var i=0,s=n.length;i<s;++i)r.insertBefore(n[i].cloneNode(!0),null)}else r=n.cloneNode(!0);var o=e.ownerDocument.createElement("div");return o.insertBefore(r,null),this.speculativelyValidateFragment(e,t,o)},m.prototype.speculativelyValidateFragment=function(e,t,n){e instanceof u.DLoc&&(n=t,t=e.offset,e=e.node);if(!this._initialized)throw new Error("uninitialized Validator");if(n.nodeType!==Node.ELEMENT_NODE)throw new Error("to_parse is not an element");var r=new m(this._tree,n);return r._validation_walker=this._getWalkerAt(e,t).clone(),r._tree=this._tree,r._initialized=!0,r._validateUpTo(n,n.childNodes.length),r._errors.length?r._errors:!1},m.prototype.getErrorsFor=function(e){this._validateUpTo(e.parentNode,a.call(e.parentNode.childNodes,e)+1);var t=[];for(var n=0,r=this._errors.length;n<r;++n){var i=this._errors[n];i.node===e&&t.push(i)}return t},t.Validator=m}),define("wed/gui/modal",["require","exports","module","jquery","../util","../log","bootstrap"],function(e,t,n){function o(){this._$dom=r('<div class="modal" style="position: absolute" tabindex="1">  <div class="modal-dialog">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal"          aria-hidden="true">&times;</button>        <h3>Untitled</h3>      </div>      <div class="modal-body">        <p>No body.</p>      </div>      <div class="modal-footer">      </div>    </div>  </div></div>'),this._$header=this._$dom.find(".modal-header"),this._$body=this._$dom.find(".modal-body"),this._$footer=this._$dom.find(".modal-footer"),this._$dom.on("click",".btn",s.wrap(function(e){return this._$clicked=r(e.currentTarget),!0}.bind(this))),this._$dom.on("shown.bs.modal.modal",s.wrap(this._handleShown.bind(this))),this._$clicked=undefined}var r=e("jquery"),i=e("../util"),s=e("../log");e("bootstrap"),o.prototype.getTopLevel=function(){return this._$dom},o.prototype.setTitle=function(e){this._$header.find("h3").remove();var t=this._$dom[0].ownerDocument.createElement("h3");r(t).append(e),this._$header.append(t)},o.prototype.setBody=function(e){this._$body.empty(),this._$body.append(e)},o.prototype.setFooter=function(e){this._$footer.empty(),this._$footer.append(e)},o.prototype.addButton=function(e,t){var n=r('<a href="#" class="btn" data-dismiss="modal">'+e+"</a>");return n.addClass(t?"btn-primary":"btn-default"),this._$footer.append(n),n},o.prototype.addOkCancel=function(){return[this.addButton("Ok",!0),this.addButton("Cancel")]},o.prototype.addYesNo=function(){return[this.addButton("Yes",!0),this.addButton("No")]},o.prototype.getPrimary=function(){return this._$footer.find(".btn-primary")},o.prototype.modal=function(e){this._$clicked=undefined,e&&this._$dom.one("hidden.bs.modal.modal",s.wrap(e)),this._$dom.modal()},o.prototype.getClicked=function(){return this._$clicked},o.prototype.getClickedAsText=function(){return this._$clicked===undefined?undefined:this._$clicked.text()},o.prototype._handleShown=function(e){var t=this._$dom.parent().height();this._$body.css("max-height",t-this._$header.height()-this._$footer.height())},t.Modal=o}),define("wed/action",["require","exports","module","./lib/simple_event_emitter","./oop"],function(e,t,n){function s(e,t,n,i,s){r.call(this),this._editor=e,this._desc=t,this._abbreviated_desc=n,this._icon=i||"",this.needs_input=!!s,this._enabled=!0,this.bound_handler=this.eventHandler.bind(this),this.bound_terminal_handler=this.terminalEventHandler.bind(this)}var r=e("./lib/simple_event_emitter").SimpleEventEmitter,i=e("./oop");i.implement(s,r),s.prototype.execute=function(e){throw new Error("the execute method must be overridden.")},s.prototype.eventHandler=function(e){this.execute(e.data),e.preventDefault()},s.prototype.terminalEventHandler=function(e){return this.eventHandler(e),e.preventDefault(),e.stopPropagation(),!1},s.prototype.getDescription=function(){return this._desc},s.prototype.getDescriptionFor=function(e){return this.getDescription()},s.prototype.getAbbreviatedDescription=function(){return this._abbreviated_desc},s.prototype.getIcon=function(){return this._icon},s.prototype.getLabelFor=function(e){var t=this.getDescriptionFor(e),n=this.getIcon();return n&&t?n+" "+t:n?n:t},s.prototype.toString=function(){return this.getDescription()},s.prototype.getEnabled=function(){return this._enabled},t.Action=s}),define("wed/gui/icon",["require","exports","module"],function(e,t,n){function i(e){var t=r[e];if(!t)throw new Error("unknown icon name: "+e);return'<i class="fa fa-fw '+t+'"></i>'}var r=Object.create(null);r.add="fa-plus",r["delete"]="fa-times",r.wrap="fa-caret-square-o-down",r.unwrap="fa-caret-square-o-up",r.documentation="fa-question-circle",r.transform="fa-cog",r.any="fa-asterisk",r.element="fa-angle-left",r.attribute="fa-at",r.other="fa-circle-thin",t.makeHTML=i}),define("wed/transformation",["require","exports","module","./util","./domutil","./action","./oop","./gui/icon","lodash"],function(e,t,n){function h(e,t,n,r,i,o,a){switch(arguments.length){case 4:a=r,r=undefined;break;case 5:a=i,i=undefined;break;case 6:a=o,o=undefined}this.handler=a,this.type=t,this.kind=l[t],this.node_type=c[t],i===undefined&&this.kind&&(i=u.makeHTML(this.kind)),s.call(this,e,n,r,i,o)}function p(e,t,n,r,i,s){var o=d(t.ownerDocument,r,i,s);return e.insertAt(t,n,o),o}function d(e,t,n,r){var i=e.createElementNS(t,n);if(r!==undefined){var s=Object.keys(r).sort();for(var o=0,u;(u=s[o++])!==undefined;)i.setAttribute(u,r[u])}return i}function v(e,t,n,r,i,s,o){var u=t.data.slice(n,r),a=t.parentNode,l=f.call(a.childNodes,t);e.deleteText(t,n,u.length);var c=d(t.ownerDocument,i,s,o);return u!==""&&c.appendChild(t.ownerDocument.createTextNode(u)),t.parentNode?e.insertAt(t,n,c):e.insertAt(a,l,c),c}function m(e,t,n){var r=t.parentNode,i=f.call(r.childNodes,t);if(n===0)n=i;else if(n>=t.length)n=i+1;else{var s=t.data.slice(n);e.setTextNode(t,t.data.slice(0,n)),e.insertNodeAt(r,i+1,t.ownerDocument.createTextNode(s)),n=i+1}return t=r,[t,n]}function g(e,t,n,r,s,o,u,a){if(!i.isWellFormedRange({startContainer:t,startOffset:n,endContainer:r,endOffset:s}))throw new Error("malformed range");var f;if(t.nodeType===Node.TEXT_NODE){if(t===r)return v(e,t,n,s,o,u,a);f=m(e,t,n),t=f[0],n=f[1]}r.nodeType===Node.TEXT_NODE&&(f=m(e,r,s),r=f[0],s=f[1]);if(t!==r)throw new Error("start_container and end_container are not the same;probably due to an algorithmic mistake");var l=d(t.ownerDocument,o,u,a);while(--s>=n){var c=r.childNodes[s];e.deleteNode(c),l.insertBefore(c,l.firstChild)}return e.insertAt(t,n,l),l}function y(e,t){var n=t.parentNode,r=Array.prototype.slice.call(t.childNodes),i=t.previousSibling,s=t.nextSibling;e.deleteNode(t);var o=s?f.call(n.childNodes,s):n.childNodes.length,u=t.lastChild;while(t.firstChild)e.insertNodeAt(n,o++,t.firstChild);return e.mergeTextNodes(u),e.mergeTextNodesNF(i),r}function b(e,t){var n=e.getDataCaret();if(!t.contains(n.node))throw new Error("caret outside node");var r=e.data_updater.splitAt(t,n);e.setDataCaret(i.firstDescendantOrSelf(r[1]),0)}function w(e,t){var n=t.previousElementSibling;if(!n)return;if(n.localName!==t.localName||n.namespace!==t.namespace)return;var r=n.childNodes.length,i=n.lastChild.nodeType===Node.TEXT_NODE,s=i?n.lastChild.length:0,o=n.childNodes.length;for(var u=t.childNodes.length-1;u>=0;--u)e.data_updater.insertAt(n,o,t.childNodes[u].cloneNode(!0));i?e.setDataCaret(n.childNodes[r-1],s):e.setDataCaret(n,r),e.data_updater.removeNode(t)}function E(e,t){var n=t.nextElementSibling;if(!n)return;w(e,n)}function S(e,t){var n=t.previousElementSibling;if(!n)return;if(n.tagName!==t.tagName)return;var r=n.parentNode;e.data_updater.removeNode(t),e.data_updater.insertBefore(r,t,n),e.setDataCaret(r,f.call(r.childNodes,t))}function x(e,t){var n=t.nextElementSibling;if(!n)return;S(e,n)}var r=e("./util"),i=e("./domutil"),s=e("./action").Action,o=e("./oop"),u=e("./gui/icon"),a=e("lodash"),f=Array.prototype.indexOf,l=a.extend(Object.create(null),{add:"add","delete":"delete",transform:"transform",insert:"add","delete-element":"delete","delete-parent":"delete",wrap:"wrap","merge-with-next":"transform","merge-with-previous":"transform","swap-with-next":"transform","swap-with-previous":"transform",split:"transform",append:"add",prepend:"add",unwrap:"unwrap","add-attribute":"add","delete-attribute":"delete"}),c=a.extend(Object.create(null),{add:"other","delete":"other",transform:"other",insert:"element","delete-element":"element","delete-parent":"element",wrap:"element","merge-with-next":"element","merge-with-previous":"element","swap-with-next":"element","swap-with-previous":"element",split:"element",append:"element",prepend:"element",unwrap:"element","add-attribute":"attribute","delete-attribute":"attribute"});o.inherit(h,s),h.prototype.getDescriptionFor=function(e){return this._desc.replace(/<name>/,e.name)},h.prototype.execute=function(e){e=e||{},this._editor.fireTransformation(this,e)},t.Transformation=h,t.wrapTextInElement=v,t.wrapInElement=g,t.insertElement=p,t.makeElement=d,t.unwrap=y,t.splitNode=b,t.mergeWithPreviousHomogeneousSibling=w,t.mergeWithNextHomogeneousSibling=E,t.swapWithPreviousHomogeneousSibling=S,t.swapWithNextHomogeneousSibling=x}),define("wed/lib/pubsub",["require","exports","module","pubsub-js"],function(e,t,n){function o(e,n){this._name=e,this._subs=[],this._parent=n,this._str=n?n.toString()+"."+e:e;if(this._str in s)throw new Error("registering twice: "+this._str);var r=this._str.toUpperCase().replace(/\./g,"_");s[this._str]=this,i[r]=this;if(r in t)throw new Error("name clash between topic name and other things we export in this module");t[r]=this}function u(e){if(e in s)return s[e];var t=e.lastIndexOf("."),n,r;t!==-1?(n=e.slice(0,t),r=e.slice(t+1)):r=e;if(n){var i=s[n];return i||(i=u(n)),i.addSub(r)}return new o(r)}function a(e){return s[e]}function f(e,t){if(e instanceof o)return r.publish.call(this,String(e),t);throw new Error("topic is not a Topic object: "+e)}function l(e,t){if(e instanceof o)return r.subscribe.call(this,String(e),t);throw new Error("topic is not a Topic object: "+e)}var r=e("pubsub-js"),i=Object.create(null),s=Object.create(null);o.prototype.addSub=function(e){var t=new o(e,this);return this._subs.push(t),this[e]=t,t},o.prototype.toString=function(){return this._str},t.makeTopic=u,u("wed.mode.ready"),t.publish=f,t.subscribe=l,t.unsubscribe=r.unsubscribe}),define("wed/onbeforeunload",["require","exports","module"],function(e,t,n){function o(){return!0}function u(e,t,n,r){function i(){return n()?t:undefined}t=t||s,n=n||o,r=!!r;if(e.onbeforeunload&&e.onbeforeunload.installed_by_onbeforeunload&&!r)throw new Error("reregistering window with `force` false",e);i.installed_by_onbeforeunload=!0,e.onbeforeunload=i}var r=n.config(),i=r&&r.test,s="Do you really want to navigate away from this page?";i||u(window),t.install=u}),define("wed/wed_init",["require","exports","module","./wed_core","./wed_util","./build-info","jquery","./log","./preferences","./onerror","./domutil","./guiroot","./dloc","./savers/ajax","./savers/localforage","./tree_updater","./gui_updater","./undo_recorder","./updater_domlistener","./validator","./object_check","./gui/modal","./undo","./transformation","./lib/pubsub","./onbeforeunload"],function(e,t,n){function P(e){e.data.editor.destroy()}var r=e("./wed_core"),i=r.Editor,s=r.version,o=e("./wed_util"),u=o.paste,a=o.cut,f=e("./build-info"),l=e("jquery"),c=e("./log"),h=e("./preferences"),p=e("./onerror"),d=e("./domutil"),v=e("./guiroot"),m=e("./dloc"),g=e("./savers/ajax").Saver,y=e("./savers/localforage").Saver,b=e("./tree_updater").TreeUpdater,w=e("./gui_updater").GUIUpdater,E=e("./undo_recorder").UndoRecorder,S=e("./updater_domlistener"),x=e("./validator"),T=x.Validator,N=e("./object_check"),C=e("./gui/modal"),k=e("./undo"),L=e("./transformation"),A=e("./lib/pubsub"),O=e("./onbeforeunload"),M=d.closestByClass,_=d.closest,D=Array.prototype.indexOf;i.prototype.init=c.wrap(function(e,t,n){this.max_label_level=undefined,this._current_label_level=undefined,this._stripped_spaces=/\u200B/g,this._replaced_spaces=/\s+/g,this._normalize_entered_spaces=!0,this.preferences=new h.Preferences({tooltips:!0}),this.widget=e,this.$widget=l(this.widget),this.$frame=l(_(this.widget,"html"));var i=this.$frame[0].ownerDocument;this.my_window=i.defaultView,this.doc=i,p.register(this.my_window);var s=new this.my_window.DOMParser;n?this._data_doc=s.parseFromString(n,"text/xml"):(this._data_doc=s.parseFromString("<div></div>","text/xml"),this._data_doc.removeChild(this._data_doc.firstChild)),t.ignore_module_config?t=l.extend(!0,{},t):t=l.extend(!0,{},r.module_config,t),this.name=t.name,t.ajaxlog&&c.addURL(t.ajaxlog.url,t.ajaxlog.headers),this._save=t.save,this._first_validation_complete=!1,this._destroying=!1,this._destroyed=!1,this.options=t;var o=l('<div class="row"> <div class="wed-frame col-sm-push-2 col-lg-10 col-md-10 col-sm-10">  <div class="row">   <div class="progress">    <span></span>    <div id="validation-progress" class="progress-bar" style="width: 0%"/>   </div>  </div>  <div class="row">   <div class="wed-cut-buffer" contenteditable="true"></div>   <div class="wed-document-constrainer">    <input class="wed-comp-field" type="text"></input>    <div class="wed-caret-layer">    </div>    <div class="wed-scroller">     <div class="wed-error-layer"></div>     <div class="wed-document"><span class="root-here"/></div>    </div>   </div>   <div class="wed-location-bar"><span>&nbsp;</span></div>  </div> </div> <div id="sidebar" class="col-sm-pull-10 col-lg-2 col-md-2 col-sm-2"/></div>',i),d=o[0];this.gui_root=d.getElementsByClassName("wed-document")[0],this.$gui_root=l(this.gui_root),this._scroller=d.getElementsByClassName("wed-scroller")[0],this._$scroller=l(this._scroller),this._$input_field=l(d.getElementsByClassName("wed-comp-field")[0]),this._cut_buffer=d.getElementsByClassName("wed-cut-buffer")[0],this._caret_layer=d.getElementsByClassName("wed-caret-layer")[0],this._$caret_layer=l(this._caret_layer),this._error_layer=d.getElementsByClassName("wed-error-layer")[0],this._$error_layer=l(this._error_layer),this._layer_names=["_caret_layer","_error_layer"],this._layer_state_stack=[],this._wed_location_bar=d.getElementsByClassName("wed-location-bar")[0];var g=d.getElementsByClassName("root-here")[0];if(e.firstChild){if(!(e.firstChild instanceof this.my_window.Element))throw new Error("the data is populated with DOM elements constructed from another window");g.parentNode.insertBefore(e.firstChild,g)}g.parentNode.removeChild(g),this.widget.appendChild(d);var y=i.getElementById("sidebar");this._sidebar=y,this.$validation_progress=l(i.getElementById("validation-progress")),this.$validation_message=l(this.$validation_progress[0].previousElementSibling),this._caret_owners=this.gui_root.getElementsByClassName("_owns_caret"),this._clicked_labels=this.gui_root.getElementsByClassName("_label_clicked");var x=this._data_doc.createDocumentFragment();x.appendChild(this._data_doc.createElement("div")),this.data_root=x.firstChild,this.$data_root=l(this.data_root),this.gui_dloc_root=new v.GUIRoot(this.gui_root),this.data_dloc_root=new m.DLocRoot(this.data_root),this.data_updater=new b(this.data_root),this._gui_updater=new w(this.gui_root,this.data_updater),this._undo_recorder=new E(this,this.data_updater);var T=document.getElementsByClassName("wed-has-tooltip");this._gui_updater.addEventListener("beforeDeleteNode",function(e){var t=e.node;if(t.nodeType!==Node.TEXT_NODE)for(var n=0,r=T.length;n<r;++n){var i=T[n];if(!t.contains(i))continue;var s=l.data(i,"bs.tooltip");s&&s.destroy()}}),y.innerHTML='<div class="wed-save-and-modification-status">  <span class="wed-modification-status label label-success"         title="Modification status">   <i class="fa fa-asterisk"></i>  </span>  <span class="wed-save-status label label-default">   <i class="fa fa-cloud-upload"></i> <span></span>  </span></div><div id="sidebar-panel" class="panel-group wed-sidebar-panel"> <div class="panel panel-info wed-navigation-panel">  <div class="panel-heading">   <div class="panel-title">    <a class="accordion-toggle" data-toggle="collapse"        data-parent="#sidebar-panel"        href="#sb-nav-collapse">Navigation</a>   </div>  </div> <div id="sb-nav-collapse" data-parent="#sidebar-panel"       class="panel-collapse collapse in">   <div id="sb-nav" class="panel-body">    <ul id="navlist" class="nav nav-list">     <li class="inactive">A list of navigation links will appear here</li>    </ul>   </div>  </div> </div> <div class="panel panel-danger">  <div class="panel-heading">   <div class="panel-title">    <a class="accordion-toggle" data-toggle="collapse"       data-parent="#sidebar-panel"       href="#sb-errors-collapse">Errors</a>   </div>  </div>  <div id="sb-errors-collapse" data-parent="#sidebar-panel"       class="panel-collapse collapse">   <div id="sb-errors" class="panel-body">    <ul id="sb-errorlist" class="nav nav-list wed-errorlist">     <li class="inactive"></li>    </ul>   </div>  </div> </div></div>',this._$modification_status=l(y.getElementsByClassName("wed-modification-status")[0]),this._$save_status=l(y.getElementsByClassName("wed-save-status")[0]),this._$navigation_panel=l(y.getElementsByClassName("wed-navigation-panel")[0]),this._$navigation_panel.css("display","none"),this._current_dropdown=undefined;var N=i.createElement("span");N.className="_wed_caret",N.setAttribute("contenteditable",!1),N.textContent=" ",this._fake_caret=N,this._$fake_caret=l(N),this._inhibited_fake_caret=0,this._pending_fake_caret_refresh=!1;var O=i.createElement("span");O.innerHTML="&nbsp;",O.style.height="100%",O.style.width="1px",O.style.maxWidth="1px",this._fc_mark=O,this._$fc_mark=l(O),this._limitation_modal=new C.Modal,this._limitation_modal.setTitle("Cannot proceed"),this._paste_modal=this.makeModal(),this._paste_modal.setTitle("Invalid structure"),this._paste_modal.setBody("<p>The data you are trying to paste appears to be XML.         However, pasting it here will result in a structurally invalid         document. Do you want to paste it as text instead? (If you answer         negatively, the data won't be pasted at all.)<p>"),this._paste_modal.addYesNo(),this.straddling_modal=this.makeModal(),this.straddling_modal.setTitle("Invalid modification"),this.straddling_modal.setBody("<p>The text selected straddles disparate elements of the document.         You may be able to achieve what you want to do by selecting         smaller sections.<p>"),this.straddling_modal.addButton("Ok",!0),this.help_modal=this.makeModal(),this.help_modal.setTitle("Help"),this.help_modal.setBody("<p>The key combinations with Ctrl below are done with Command in         OS X.</p>         <ul>          <li>Clicking the right mouse button on the document contents brings up a contextual menu.</li>          <li>Clicking the right mouse button on the links in the navigation panel brings up a contextual menu.</li>          <li>F1: help</li>          <li>Ctrl-[: Decrease the label visibility level.</li>          <li>Ctrl-]: Increase the label visibility level.</li>          <li>Ctrl-S: Save</li>          <li>Ctrl-X: Cut</li>          <li>Ctrl-V: Paste</li>          <li>Ctrl-C: Copy</li>          <li>Ctrl-Z: Undo</li>          <li>Ctrl-Y: Redo</li>          <li>Ctrl-/: Bring up a contextual menu.</li>        </ul>        <p class='wed-build-info'>Build descriptor: "+f.desc+"<br/>        Build date: "+f.date+"</p>        "),this.help_modal.addButton("Close",!0),this._disconnect_modal=this.makeModal(),this._disconnect_modal.setTitle("Disconnected from server!"),this._disconnect_modal.setBody("It appears your browser is disconnected from the server.         Editing is frozen until the connection is reestablished.         Dismissing this dialog will retry saving. If the operation is         successful, you'll be able to continue editing. If not, this         message will reappear."),this._disconnect_modal.addButton("Retry",!0),this._edited_by_other_modal=this.makeModal(),this._edited_by_other_modal.setTitle("Edited by another!"),this._edited_by_other_modal.setBody("Your document was edited by someone else since you last loaded or         saved it. You must reload it before trying to edit further."),this._edited_by_other_modal.addButton("Reload",!0),this._too_old_modal=this.makeModal(),this._too_old_modal.setTitle("Newer version!"),this._too_old_modal.setBody("There is a newer version of the editor.         You must reload it before trying to edit further."),this._too_old_modal.addButton("Reload",!0),this._$navigation_list=l(i.getElementById("navlist")),this._old_sel_focus=undefined,this._sel_anchor=undefined,this._sel_focus=undefined,this._selection_stack=[],this.domlistener=new S.Listener(this.gui_root,this._gui_updater),l(this.my_window).on("unload.wed",{editor:this},P),l(this.my_window).on("popstate.wed",function(e){document.location.hash===""&&(this.gui_root.scrollTop=0)}.bind(this)),this._last_done_shown=0,this.$error_list=l(i.getElementById("sb-errorlist")),this._$excluded_from_blur=l(),this._validation_errors=[],this._undo=new k.UndoList,this.mode_path=t.mode.path,this.paste_tr=new L.Transformation(this,"add","Paste",u),this.cut_tr=new L.Transformation(this,"delete","Cut",a),this.split_node_tr=new L.Transformation(this,"split","Split <name>",function(e,t){return L.splitNode(e,t.node)}),this.merge_with_previous_homogeneous_sibling_tr=new L.Transformation(this,"merge-with-previous","Merge <name> with previous",function(e,t){return L.mergeWithPreviousHomogeneousSibling(e,t.node)}),this.merge_with_next_homogeneous_sibling_tr=new L.Transformation(this,"merge-with-next","Merge <name> with next",function(e,t){return L.mergeWithNextHomogeneousSibling(e,t.node)}),A.subscribe(A.WED_MODE_READY,function(e,t){t===this._new_mode&&this.onModeChange(t)}.bind(this)),this._global_keydown_handlers=[],this.setMode(this.mode_path,t.mode.options)}),i.prototype.setMode=c.wrap(function(t,n){var r,i=c.wrap(function(e){this._new_mode=new e.Mode(n)}).bind(this);e([t],i,function(n){if(t.indexOf("/")!==-1)throw new Error("can't load mode "+t);var r="./modes/"+t+"/"+t;e([r],i,function(t){e([r+"_mode"],i)})})}),i.prototype.onModeChange=c.wrap(function(t){if(this._destroyed)return;this.mode=t,t.init(this);var n=t.getWedOptions();if(!this._processWedOptions(n))return;var r=this.mode.getStylesheets();for(var i=0,s;(s=r[i])!==undefined;++i)this.$frame.children("head").append('<link rel="stylesheet" href="'+e.toUrl(s)+'" type="text/css" />');this._resizeHandler(),this.gui_root.setAttribute("tabindex","-1"),this.$gui_root.focus(),this.resolver=t.getAbsoluteResolver();var o=t.getValidator();this.validator=new T(this.options.schema,this.data_root,o),this.validator.addEventListener("state-update",this._onValidatorStateChange.bind(this)),this.validator.addEventListener("error",this._onValidatorError.bind(this)),this.validator.addEventListener("reset-errors",this._onResetErrors.bind(this)),this.validator.initialize(this._postInitialize.bind(this))}),i.prototype._processWedOptions=function(e){var t=function(){return this._limitation_modal.setBody("<p>The mode you are trying to use is passing incorrect options to wed. Contact the mode author with the following information: </p><ul><li>"+i.join("</li><li>")+"</li></ul>"),this._limitation_modal.modal(),this.destroy(),!1}.bind(this),n={metadata:{name:!0,authors:!0,description:!0,license:!0,copyright:!0},label_levels:{max:!0,initial:!0},attributes:!1},r=N.check(n,e),i=[],s;r.missing&&r.missing.forEach(function(e){i.push("missing option: "+e)}),r.extra&&r.extra.forEach(function(e){i.push("extra option: "+e)});if(i.length)return t();this.max_label_level=e.label_levels.max,this.max_label_level<1&&i.push("label_levels.max must be >= 1"),this._current_label_level=this.max_label_level;var o=e.label_levels.initial;o>this.max_label_level&&i.push("label_levels.initial must be < label_levels.max"),o<1&&i.push("label_levels.initial must be >= 1"),e.attributes||(e.attributes="hide");var u=this.attributes=e.attributes,a=["hide","show","edit"];a.indexOf(u)===-1&&i.push("attributes option not a valid value: "+u+"; must be one of "+a.join(", "));while(this._current_label_level>o)this.decreaseLabelVisiblityLevel();return i.length?t():!0},i.prototype._postInitialize=c.wrap(function(){if(this._destroyed)return;this.domlistener.addHandler("children-changed","._real, ._phantom_wrap, .wed-document",function(e,t,n,r,i,s){var o=t.concat(n),u=!1;for(var a=0,f=o.length;!u&&a<f;++a){var l=o[a];u=l.nodeType===Node.TEXT_NODE||l.classList.contains("_real")||l.classList.contains("_phantom_wrap")}u&&(this._last_done_shown=0,this.validator.restartAt(s))}.bind(this)),this.decorator=this.mode.makeDecorator(this.domlistener,this,this._gui_updater),this.domlistener.addHandler("attribute-changed","._real",function(e,t,n,r){if(!n&&r.indexOf("data-wed",0)===0){var i=this;setTimeout(function(){i.validator.restartAt(t)},0)}}.bind(this)),this.decorator.addHandlers(),this.domlistener.addHandler("included-element","._label",function(e,t,n,r,i,s){var o=s.classList,u=!1;for(var a=0;a<o.length&&!u;++a)o[a].lastIndexOf("_label_level_",0)===0&&(u=Number(o[a].slice(13)));if(!u)throw new Error("unable to get level");u>this._current_label_level&&o.add("_invisible")}.bind(this)),this._updating_placeholder=0,this.domlistener.addHandler("children-changed","._real, ._phantom_wrap",function(e,t,n,r,i,s){if(this._updating_placeholder)return;this._updating_placeholder++;var o=[],u,a=s.firstChild;while(a)(a.nodeType===Node.TEXT_NODE||a.classList.contains("_real")||a.classList.contains("_phantom_wrap")||a.classList.contains("_text"))&&o.push(a),a.classList&&a.classList.contains("_placeholder")&&(u=a),a=a.nextSibling;if(o.length===0||o.length===1&&n.indexOf(o[0])!==-1){if(!u){var f=this.mode.nodesAroundEditableContents(s);u=this.mode.makePlaceholderFor(s),this._gui_updater.insertBefore(s,u,f[1])}}else if(u&&!u.classList.contains("_transient")){var l=this._sel_focus&&this._sel_focus.node,c=u.contains(l),h,p;c&&(h=u.parentNode,p=D.call(h.childNodes,u)),this._gui_updater.removeNode(u),c&&this._setGUICaret(h,p,"text_edit")}this._updating_placeholder--}.bind(this));var e=function(e){if(this._updating_placeholder)return;this._updating_placeholder++;var t=this.toDataNode(e),n=d.childByClass(e,"_placeholder");t.value?n&&e.removeChild(n):n||this._gui_updater.insertBefore(e,d.makePlaceholder(),null),this._updating_placeholder--}.bind(this);this.domlistener.addHandler("children-changed","._attribute_value",function(t,n,r,i,s,o){e(o)}),this.domlistener.addHandler("included-element","._attribute_value",function(t,n,r,i,s,o){e(o)}),this.decorator.startListening(this.$gui_root),this._data_doc.firstChild&&this.data_updater.insertAt(this.data_root,0,this._data_doc.firstChild);if(this._save){switch(this._save.path){case"wed/savers/ajax":this._saver=new g(s,this.data_updater,this.data_root,this._save.options);break;case"wed/savers/localforage":this._saver=new y(s,this.data_updater,this.data_root,this._save.options);break;default:throw new Error("unknown saver: "+this._save.path)}this._saver.addEventListener("saved",this._onSaverSaved.bind(this)),this._saver.addEventListener("autosaved",this._onSaverAutosaved.bind(this)),this._saver.addEventListener("failed",this._onSaverFailed.bind(this)),this._saver.addEventListener("changed",this._onSaverChanged.bind(this)),this._saver.addEventListener("too_old",this._onSaverTooOld.bind(this)),this._save.autosave!==undefined&&this._saver.setAutosaveInterval(this._save.autosave*1e3),this._refreshSaveStatus(),this._save_status_interval=setInterval(this._refreshSaveStatus.bind(this),3e4),O.install(this.my_window,"The document has unsaved modifications. Do you really want to leave without saving?",function(){return!!this._saver.getModifiedWhen()}.bind(this),!0)}else c.error("wed cannot save data due to the absence of a save_url option");this.$gui_root.on("dragenter","*",!1),this.$gui_root.on("dragstart","*",!1),this.$gui_root.on("dragover","*",!1),this.$gui_root.on("drop","*",!1),this.$gui_root.on("wed-global-keydown",this._globalKeydownHandler.bind(this)),this.$gui_root.on("wed-global-keypress",this._globalKeypressHandler.bind(this)),this.$gui_root.on("keydown",this._keydownHandler.bind(this)),this.$gui_root.on("keypress",this._keypressHandler.bind(this)),this._$scroller.on("scroll",this._refreshFakeCaret.bind(this)),this._$input_field.on("keydown",this._keydownHandler.bind(this)),this._$input_field.on("keypress",this._keypressHandler.bind(this)),this._$input_field.on("compositionstart compositionupdate compositionend",this._compositionHandler.bind(this)),this._$input_field.on("input",this._inputHandler.bind(this)),this.$gui_root.on("mousedown",this._mousedownHandler.bind(this)),this.$gui_root.on("mouseover",this._mouseoverHandler.bind(this)),this.$gui_root.on("mouseout",this._mouseoutHandler.bind(this)),this.$gui_root.on("contextmenu",this._mouseupHandler.bind(this)),this.$gui_root.on("paste",c.wrap(this._pasteHandler.bind(this))),this._$input_field.on("paste",c.wrap(this._pasteHandler.bind(this))),this.$gui_root.on("cut",c.wrap(this._cutHandler.bind(this))),l(this.my_window).on("resize.wed",this._resizeHandler.bind(this)),this.$gui_root.on("focus",c.wrap(function(e){this._focusInputField(),e.preventDefault(),e.stopPropagation()}.bind(this))),this.$gui_root.on("click","a",function(e){return e.ctrlKey&&(window.location=e.currentTarget.href),!1}.bind(this));var t=l(this.doc.body);t.on("mouseup.wed",function(e){this.$gui_root.off("mousemove.wed mouseup"),this._$caret_layer.off("mousemove mouseup")}.bind(this)),t.on("contextmenu",function(e){return this.gui_root.contains(e.target)?!1:!0}.bind(this)),t.on("click.wed",function(e){if(e.pageX===undefined||e.pageX<0||e.pageY===undefined||e.pageY<0||e.screenX===e.screenY&&e.screenX===0)return;var t=this.doc.elementFromPoint(e.clientX,e.clientY);if(l(t).closest(this._$excluded_from_blur).length)return;var n=this.$gui_root.offset(),r=e.pageX-n.left,i=e.pageY-n.top;r>=0&&i>=0&&r<this.$gui_root.outerWidth()&&i<this.$gui_root.outerHeight()||this._blur()}.bind(this)),l(this.my_window).on("blur.wed",this._blur.bind(this)),l(this.my_window).on("focus.wed",this._focus.bind(this)),this._$caret_layer.on("mousedown click contextmenu",this._caretLayerMouseHandler.bind(this)),this._$error_layer.on("mousedown click contextmenu",function(e){return this._$caret_layer.trigger(e),!1}.bind(this)),this.$widget.removeClass("loading"),this.$widget.css("display","block");var n=this._initializeNamespaces();if(n){this._limitation_modal.setBody(n),this._limitation_modal.modal(),this.destroy();return}this.domlistener.processImmediately(),this._undo=new k.UndoList,this.$gui_root.focus(),this.validator.start();if(this._saver){var r=this;this._saver.whenCondition("initialized",function(){r._setCondition("initialized",{editor:r})})}else this._setCondition("initialized",{editor:this})}),i.prototype._initializeNamespaces=function(){var e=!1;if(!this.data_root.firstChild){var t=Object.create(null);this.validator.getSchemaNamespaces().forEach(function(n){var r=this.resolver.prefixFromURI(n);if(r==="xml")return;r===""?t.xmlns=n:(r===undefined&&(e="The mode does not allow determining the namespace prefix for "+n+"."+"The most likely issue is that the mode is buggy "+"or wed was started with incorrect options."),t["xmlns:"+r]=n)}.bind(this));if(e)return e;var n=this.validator.possibleAt(this.data_root,0).toArray();n.length===1&&n[0].params[0]==="enterStartTag"&&L.insertElement(this.data_updater,this.data_root,0,n[0].params[1],this.resolver.unresolveName(n[0].params[1],n[0].params[2]),t)}else{var r=this.validator.getDocumentNamespaces(),i=this.resolver;Object.keys(r).forEach(function(t){var n=r[t];n.length>1&&(e="The document you are trying to edit uses namespaces in a way not supported by this version of wed."),i.definePrefix(t,n[0])})}return e}}),define("wed/wed_caret",["require","exports","module","./wed_core","./wed_util","jquery","./browsers","lodash","./log","rangy","./util","./domutil","./dloc","bootstrap","jquery.bootstrap-growl"],function(e,t,n){var r=e("./wed_core"),i=r.Editor,s=e("./wed_util"),o=s.getAttrValueNode,u=e("jquery"),a=e("./browsers"),f=e("lodash"),l=e("./log"),c=e("rangy"),h=e("./util"),p=e("./domutil"),d=e("./dloc"),v=d.makeDLoc,m=d.DLoc;e("bootstrap"),e("jquery.bootstrap-growl");var g=p.closestByClass,y=p.closest,b=Array.prototype.indexOf,w=h.getOriginalName;i.prototype.dumpCaretInfo=function(){var e=this.getDataCaret();e?console.log("data caret",e.node,e.offset):console.log("no data caret"),this._sel_anchor?console.log("selection anchor",this._sel_anchor.node,this._sel_anchor.offset):console.log("no selection anchor"),this._sel_focus?console.log("selection focus",this._sel_focus.node,this._sel_focus.offset):console.log("no selection focus"),this._sel_focus&&console.log("selection focus closest real",g(this._sel_focus.node,"_real",this.gui_root)),p.dumpRange("DOM range: ",this._getDOMSelectionRange()),console.log("input field location",this._$input_field.css("top"),this._$input_field.css("left")),console.log("document.activeElement",document.activeElement);var t=this._sel_focus.node;if(t.nodeType===Node.TEXT_NODE){var n=this._sel_focus.offset;if(n<t.data.length){var r=this.doc.createRange();r.setStart(t,n),r.setEnd(t,n+1);var i=r.getBoundingClientRect();console.log("rectangle around character at caret:",i)}}},i.prototype.caretPositionRight=function(){return this.positionRight(this._sel_focus)},i.prototype.positionRight=function(e){function t(t){return t.compareDocumentPosition(e.node)&Node.DOCUMENT_POSITION_PRECEDING}if(e===undefined||e===null)return undefined;var n=e.root,r=g(e.node,"_placeholder",n);r&&(e=e.make(r.parentNode,b.call(r.parentNode.childNodes,r)+1));for(;;){var i=g(e.node,"_gui",n);e=e.make(p.nextCaretPosition(e.toArray(),this.gui_root.firstChild,!1));if(!e)break;var s=e.node,u=e.offset,a=y(s,"._gui:not(._invisible)",n);if(a){var l=a.classList.contains("__start_label");if(this.attributes==="edit"&&l){if(g(s,"_attribute_value",n))break;if(y(s,"._element_name, ._attribute",n)){var c=f.find(a.getElementsByClassName("_attribute"),t);if(c){var h=p.childByClass(c,"_attribute_value");h=o(h),e=e.make(h,0);break}}}if(i===a){e=e.make(a,a.childNodes.length);continue}e=e.make(l||g(s,"_label",a)?s.getElementsByClassName("_element_name")[0]:a,0);break}var d=g(s,"_phantom",n);if(d){e=e.make(d,d.childNodes.length);continue}r=g(s,"_placeholder",n);if(r&&u>0){e=e.make(r,r.childNodes.length);continue}if(s.nodeType===Node.ELEMENT_NODE){var v=s.childNodes[u];if(v&&v.nodeType===Node.TEXT_NODE)continue;var m=s.childNodes[u-1];if(v&&m&&v.firstChild&&v.firstChild.nodeType===Node.ELEMENT_NODE&&v.firstChild.classList.contains("_gui")&&!v.firstChild.classList.contains("_invisible")&&m.lastChild&&m.lastChild.nodeType===Node.ELEMENT_NODE&&m.lastChild.classList.contains("_gui")&&!m.lastChild.classList.contains("_invisible"))break;if(m&&m.nodeType===Node.ELEMENT_NODE&&(v&&v.nodeType===Node.ELEMENT_NODE&&!v.classList.contains("_end_wrapper")&&!m.classList.contains("_start_wrapper")||m.matches("._wed-validation-error, ._gui.__end_label")))continue;var w=this.mode.nodesAroundEditableContents(s);if(w[0]&&b.call(s.childNodes,w[0])>=u)continue;if(w[1]&&b.call(s.childNodes,w[1])<u)continue}break}return e||undefined},i.prototype.caretPositionLeft=function(){return this.positionLeft(this._sel_focus)},i.prototype.positionLeft=function(e){if(e===undefined||e===null)return undefined;var t=e.root,n=g(e.node,"_placeholder",t);n&&(e=e.make(n.parentNode,b.call(n.parentNode.childNodes,n)));for(;;){var r=g(e.node,"_element_name",t),i=r&&e.node===r&&e.offset===0;e=e.make(p.prevCaretPosition(e.toArray(),this.gui_root.firstChild,!1));if(!e)break;var s=e.node,o=e.offset,u=y(s,"._gui:not(._invisible)",t);if(u){var a=u.classList.contains("__start_label");if(this.attributes==="edit"&&a&&!i){if(g(s,"_attribute_value",u))break;var f=g(s,"_attribute",u);!f&&s.nextElementSibling&&s.nextElementSibling.classList.contains("_attribute")&&(f=s.nextElementSibling),f||(r=g(s,"_element_name",u),f=r&&r.nextElementSibling);var l=f&&f.previousElementSibling;if(!l){var c=u.getElementsByClassName("_attribute");l=c[c.length-1]}l&&!l.classList.contains("_attribute")&&(l=null);if(l){var h=p.childByClass(l,"_attribute_value");o=0,h.lastChild&&(h=h.lastChild,o=h.length,h.classList&&h.classList.contains("_placeholder")&&(o=0)),e=e.make(h,o);break}}if(!i){e=e.make(a||g(s,"_label",u)?u.getElementsByClassName("_element_name")[0]:u,0);break}e=e.make(u,0);continue}n=g(s,"_placeholder",t);if(n){e=e.make(n.firstChild,0);break}var d=g(s,"_phantom",t);if(d){e=e.make(d,0);continue}if(s.nodeType===Node.ELEMENT_NODE){var v=s.childNodes[o-1];if(v&&v.nodeType===Node.TEXT_NODE)continue;var m=s.childNodes[o];if(m&&v&&m.firstChild&&m.firstChild.nodeType===Node.ELEMENT_NODE&&m.firstChild.classList.contains("_gui")&&!m.firstChild.classList.contains("_invisible")&&v.lastChild&&v.lastChild.nodeType===Node.ELEMENT_NODE&&v.lastChild.classList.contains("_gui")&&!v.lastChild.classList.contains("_invisible"))break;if(m&&m.nodeType===Node.ELEMENT_NODE&&(v&&v.nodeType===Node.ELEMENT_NODE&&!v.classList.contains("_start_wrapper")&&!m.classList.contains("_end_wrapper")||m.matches("._gui.__start_label, .wed-validation-error")))continue;var w=this.mode.nodesAroundEditableContents(s);if(w[0]&&b.call(s.childNodes,w[0])>=o)continue;if(w[1]&&b.call(s.childNodes,w[1])<o)continue}break}return e||undefined},i.prototype.moveCaretRight=function(){var e=this.caretPositionRight();e&&this.setGUICaret(e)},i.prototype.moveCaretLeft=function(){var e=this.caretPositionLeft();e&&this.setGUICaret(e)},i.prototype.setGUICaret=function(e,t){this._setGUICaret(e,t)},i.prototype._setGUICaret=function(e,t,n){var r;e instanceof m?(n=t,t=e.offset,r=e.node):(r=e,e=v(this.gui_root,r,t));if(r.classList&&r.classList.contains("_attribute_value")){var i=o(r);r!==i&&(r=i,e=e.make(r,t))}if(this._sel_focus&&this._sel_anchor===this._sel_focus&&this._sel_focus.node===r&&this._sel_focus.offset===t)return;this._clearDOMSelection(),this._sel_anchor=e,this._sel_focus=this._sel_anchor,this._refreshFakeCaret(),this._focusInputField(),this._caretChange(n)},i.prototype._focusInputField=function(){this.my_window.focus(),this._$input_field.blur(),this._$input_field.focus()},i.prototype._blur=l.wrap(function(e){if(!this._sel_focus)return;this._sel_anchor_at_blur=this._sel_anchor,this._sel_focus_at_blur=this._sel_focus,this._$input_field.blur(),this._sel_anchor=undefined,this._sel_focus=undefined,this._refreshFakeCaret()}),i.prototype.excludeFromBlur=function(e){this._$excluded_from_blur.add(e)},i.prototype._focus=l.wrap(function(e){if(this._sel_anchor_at_blur){this._sel_anchor=this._sel_anchor_at_blur,this._sel_focus=this._sel_focus_at_blur;var t=this.gui_root.scrollTop,n=this.gui_root.scrollLeft;this._restoreCaretAndSelection(!0),this.gui_root.scrollTop=t,this.gui_root.scrollLeft=n,this._sel_anchor_at_blur=undefined,this._sel_focus_at_blur=undefined}}),i.prototype._inhibitFakeCaret=function(){this._inhibited_fake_caret++},i.prototype._uninhibitFakeCaret=function(){this._inhibited_fake_caret--;if(this._inhibited_fake_caret<0)throw new Error("too many calls to _uninhibitFakeCaret");this._pending_fake_caret_refresh&&(this._refreshFakeCaret(),this._pending_fake_caret_refresh=!1)},i.prototype._refreshFakeCaret=function(){if(this._inhibited_fake_caret){this._pending_fake_caret_refresh=!0;return}var e,t,n;this._sel_focus&&(e=this._sel_focus.node,t=this._sel_focus.offset,n=this._sel_focus.root);if(!e)return;var r,i;switch(e.nodeType){case Node.TEXT_NODE:var s=e.parentNode,o=e.previousSibling,u=e.nextSibling;p.insertIntoText(e,t,this._fc_mark);break;case Node.ELEMENT_NODE:e.insertBefore(this._fc_mark,e.childNodes[t]||null);break;default:throw new Error("unexpected node type: "+e.nodeType)}r=this._fc_mark.getBoundingClientRect();var a=this._scroller.getBoundingClientRect();r={top:r.top-a.top,left:r.left-a.left},i=this._$fc_mark.height();if(e.nodeType===Node.TEXT_NODE){var f=o?o.nextSibling:s.firstChild;while(f!==u)s.removeChild(f),f=o?o.nextSibling:s.firstChild;s.insertBefore(e,u||null)}else this._fc_mark.parentNode.removeChild(this._fc_mark);if(this._sel_anchor.isValid()&&this._sel_focus.isValid()){var l=this._sel_anchor.makeRange(this._sel_focus);l.range.collapsed||this._setDOMSelectionRange(l.range,l.reversed)}this._fake_caret.style.top=r.top+"px",this._fake_caret.style.left=r.left+"px",this._fake_caret.style.height=i+"px",this._fake_caret.style.maxHeight=i+"px",this._fake_caret.style.minHeight=i+"px",this._fake_caret.parentNode||this._caret_layer.appendChild(this._fake_caret),this._$input_field[0].style["z-index"]>0?(this._$input_field.css("top",r.top),this._$input_field.css("left",r.left)):(this._$input_field.css("top",""),this._$input_field.css("left",""))},i.prototype._findLocationAt=function(e,t){var n=this.elementAtPointUnderLayers(e,t);return n?this.gui_root.contains(n)?this._findLocationInElementAt(n,e,t):undefined:undefined},i.prototype._findLocationInElementAt=function(e,t,n,r){function o(e,r,o){o||(e.nodeType===Node.TEXT_NODE?(i.setStart(e,r),i.setEnd(e,r+1),o=[i.getBoundingClientRect()]):o=e.childNodes[r].getClientRects());for(var u=0,a;(a=o[u])!==undefined;++u){if(a.height===0&&a.width===0)continue;var f=h.distsFromRect(t,n,a.left,a.top,a.right,a.bottom);if(!s||s.dist.y>f.y||s.dist.y===f.y&&s.dist.x>f.x)return s={dist:f,node:e,start:r},f.y===0&&f.x===0}return!1}function u(e,t){if(e.nodeType===Node.TEXT_NODE){if(e.length===0)return!1;if(e.length===1)return o(e,t);var n,r,s;if(t>0&&t<e.length-1){i.setStart(e,t-1),i.setEnd(e,t),n=i.getBoundingClientRect(),i.setStart(e,t+1),i.setEnd(e,t+2),r=i.getBoundingClientRect();if(n.top!==r.top)return!1}else if(t===0){i.setStart(e,t),i.setEnd(e,t+1),s=i.getBoundingClientRect(),i.setStart(e,t+1),i.setEnd(e,t+2),r=i.getBoundingClientRect();if(s.top!==r.top)return!1}else if(t===e.length-1){i.setStart(e,t),i.setEnd(e,t+1),s=i.getBoundingClientRect(),i.setStart(e,t-1),i.setEnd(e,t),n=i.getBoundingClientRect();if(s.bottom!==n.bottom)return o(e,t,[{top:s.top,left:n.right,right:s.right,bottom:n.bottom}])}}return o(e,t)}r!==!1&&(r=!0);var i=this.doc.createRange(),s,f=o;if(a.MSIE||a.CHROME_37&&a.WINDOWS)f=u;var l=e.firstChild,c=0;e:while(l){if(r&&l.nodeType===Node.TEXT_NODE){for(var p=0;p<l.length;++p)if(f(l,p))break e}else if(f(e,c))break e;l=l.nextSibling,c++}return s?v(this.gui_root,s.node,s.start):v(this.gui_root,e,0)},i.prototype._pointToCharBoundary=function(e,t){var n=this._findLocationAt(e,t);if(n){var r=n.node,i=n.offset,o=r.nodeType;if(o===Node.ELEMENT_NODE&&i<r.childNodes.length||o===Node.TEXT_NODE&&i<r.length){var u=this.doc.createRange();u.setStart(r,i),u.setEnd(r,i+1);var a=u.getBoundingClientRect();switch(o){case Node.TEXT_NODE:var f=this.positionRight(n),l=this.positionLeft(n.make(r,i+1));f&&!l?n=f:l&&!f?n=l:n=Math.abs(s.boundaryXY(f).left-e)>=Math.abs(s.boundaryXY(l).left-e)?l:f;break;case Node.ELEMENT_NODE:var c,h=r.childNodes[i];if(h.nodeType===Node.ELEMENT_NODE){var p=this._findLocationInElementAt(h,e,t),d=p.node.nodeType===Node.ELEMENT_NODE?p.node.childNodes.length-1:-1;switch(p.offset){case 0:c=!0;break;case d:c=!1}}c===undefined&&(c=Math.abs(a.left-e)<Math.abs(a.right-e)),c||(n=n.make(r,i+1));break;default:throw new Error("unexpected node type: "+o)}}}return n},i.prototype.getGUICaret=function(e){return this._sel_focus===undefined?undefined:e?this._sel_focus:this.gui_root.contains(this._sel_focus.node)?(this._sel_focus.isValid()||(this._sel_focus=this._sel_focus.normalizeOffset()),this._normalizeCaret(this._sel_focus)):undefined},i.prototype._normalizeCaret=function(e){if(!e)return e;var t=g(e.node,"_placeholder",e.root);if(t){var n=t.parentNode;return e.make(n,b.call(n.childNodes,t))}return e},i.prototype.fromDataLocation=function(e,t){var n=this._gui_updater.fromDataLocation(e,t),r=n.offset;e=n.node;if(e.nodeType===Node.ELEMENT_NODE){var i=this.mode.nodesAroundEditableContents(e),s=b.call(e.childNodes,i[0]);if(r<=s)r=s+1;else{var o=i[1]?b.call(e.childNodes,i[1]):e.childNodes.length;r>=o&&(r=o)}}return n.make(e,r)},i.prototype.toDataLocation=function(e,t,n){var r,i;e instanceof m?(n=t,t=e.offset,r=e.node,i=e.root):r=e;if(!g(r,"_attribute_value",i)){var s,o=r.nodeType===Node.TEXT_NODE?r.parentNode:r;while(o){if(o.classList.contains("_phantom")||o.classList.contains("_gui")){if(!n)return undefined;s=o}if(o===this.gui_root)break;o=o.parentNode}s&&(r=s.parentNode,t=b.call(r.childNodes,s))}var u=this._normalizeCaret(v(this.gui_root,r,t));r=u.node,t=u.offset;var a;if(r.nodeType===Node.TEXT_NODE)return a=this.data_updater.pathToNode(this.nodeToPath(r)),v(this.data_root,a,t,!0);if(t>=r.childNodes.length)return a=this.data_updater.pathToNode(this.nodeToPath(r)),v(this.data_root,a,a.childNodes.length);var f=r.childNodes[t];if(f.nodeType!==Node.TEXT_NODE&&!f.classList.contains("_real")){var l=f.previousSibling,c;while(l)l.nodeType===Node.TEXT_NODE||l.classList.contains("_real")?(c=l,l=null):l=l.previousSibling;return c?(a=this.data_updater.pathToNode(this.nodeToPath(c)),v(this.data_root,a.parentNode,b.call(a.parentNode.childNodes,a)+1)):v(this.data_root,this.data_updater.pathToNode(this.nodeToPath(r)),0)}return a=this.data_updater.pathToNode(this.nodeToPath(f)),a instanceof this.my_window.Attr?v(this.data_root,a,t):v(this.data_root,a.parentNode,b.call(a.parentNode.childNodes,a))},i.prototype.getDataCaret=function(e){var t=this.getGUICaret();return t===undefined?undefined:this.toDataLocation(t,e)},i.prototype.setDataCaret=function(e,t,n){e instanceof m?n=t:e=v(this.data_root,e,t),n=!!n;var r=this.fromDataLocation(e);this._setGUICaret(r,n?"text_edit":undefined)},i.prototype._caretChange=l.wrap(function(e){var t=!1,n=!1;switch(e){case"text_edit":t=!0;break;case"focus":n=!0;break;case undefined:break;default:throw new Error("unexpected value for op: "+e)}var r,i,s,o=this._sel_focus;if(o){r=o.node,i=o.offset;if(r.nodeType===Node.ELEMENT_NODE){s=p.childByClass(r,"_placeholder");if(s&&!s.classList.contains("_dying")){this._setGUICaret(s,0,e);return}}}n||this._setupCompletionMenu();if(this._old_sel_focus!==undefined&&this._old_sel_focus.node===r&&this._old_sel_focus.offset===i)return;var a=this._old_sel_focus;this._old_sel_focus=o,t||this._terminateTextUndo();var f;while((f=this._caret_owners[0])!==undefined)f.classList.remove("_owns_caret");while((f=this._clicked_labels[0])!==undefined)f.classList.remove("_label_clicked");if(!o)return;if(a){var l=y(a.node,"._placeholder._transient",a.root);l&&o.root.contains(l)&&this._gui_updater.removeNode(l)}var c=o.node.nodeType===Node.ELEMENT_NODE?o.node:o.node.parentNode,d=o.root;if(!this.gui_root.contains(c))return;var v=g(c,"_real",d);v&&v.classList.add("_owns_caret");var m=g(c,"_gui",d);if(m){if(!this._sel_anchor||g(this._sel_anchor.node,"_gui",d)===m){var b=p.childrenByClass(m.parentNode,"_gui");for(var w=0,E;(E=b[w])!==undefined;++w)E.classList.add("_label_clicked")}}else c.classList.add("_owns_caret");var S=this._fake_caret,x=this._positionFromGUIRoot(S),T=u(S);this.scrollIntoView(x.left,x.top,x.left+T.outerWidth(),x.top+T.outerHeight());var N=[];while(c!==this.gui_root){if(c.nodeType!==Node.ELEMENT_NODE)throw new Error("unexpected node type: "+c.nodeType);!c.classList.contains("_placeholder")&&!g(c,"_phantom",d)&&N.unshift("<span class='_gui _label'><span>&nbsp;"+h.getOriginalName(c)+"&nbsp;</span></span>"),c=c.parentNode}this._wed_location_bar.innerHTML=N.length?N.join("/"):"<span>&nbsp;</span>"}),i.prototype.pushSelection=function(){this._selection_stack.push([this._sel_anchor,this._sel_focus]),a.MSIE_TO_10&&this._clearDOMSelection()},i.prototype.popSelection=function(){var e=this._selection_stack.pop();this._sel_anchor=e[0],this._sel_focus=e[1],this._restoreCaretAndSelection(!1)},i.prototype._restoreCaretAndSelection=function(e){if(this._sel_anchor&&this.gui_root.contains(this._sel_anchor.node)){var t=this._sel_anchor.makeRange(this._sel_focus);this._setDOMSelectionRange(t.range,t.reversed),this._refreshFakeCaret(),t.range.collapsed&&this._focusInputField(),this._caretChange(e?"focus":undefined)}else this.clearSelection()},i.prototype.clearSelection=function(){this._sel_anchor=undefined,this._sel_focus=undefined,this._refreshFakeCaret();var e=this._getDOMSelection();e.rangeCount>0&&this.gui_root.contains(e.focusNode)&&e.removeAllRanges(),this._caretChange()},i.prototype._getDOMSelection=function(){return c.getSelection(this.my_window)},i.prototype._clearDOMSelection=function(e){this._getDOMSelection().removeAllRanges(),e||this._focusInputField()},i.prototype._getDOMSelectionRange=function(){var e=p.getSelectionRange(this.my_window);return e?!this.gui_root.contains(e.startContainer)||!this.gui_root.contains(e.endContainer)?undefined:e:undefined},i.prototype.getSelectionRange=function(){return this._sel_anchor?this._sel_anchor.makeRange(this._sel_focus).range:undefined},i.prototype.setSelectionRange=function(e,t){var n=v(this.gui_root,e.startContainer,e.startOffset),r=v(this.gui_root,e.endContainer,e.endOffset);t?(this._sel_anchor=r,this._sel_focus=n):(this._sel_anchor=n,this._sel_focus=r),this._setDOMSelectionRange(e,t),this._refreshFakeCaret(),this._caretChange()},i.prototype._normalizeSelectionRange=function(){var e=this.getSelectionRange();x;if(!e)return undefined;var t=this._normalizeCaretToEditableRange(e.startContainer,e.startOffset),n=this._normalizeCaretToEditableRange(e.endContainer,e.endOffset);return t.makeRange(n).range},i.prototype._normalizeCaretToEditableRange=function(e,t){if(e instanceof m){if(e.root!=this.gui_root)throw new Error("DLoc object must be for the GUI tree");t=e.offset,e=e.node}if(e.nodeType===Node.ELEMENT_NODE){var n=this.mode.nodesAroundEditableContents(e),r=n[0]?b.call(e.childNodes,n[0]):-1;if(t<=r)t=r+1;else{var i=n[1]?b.call(e.childNodes,n[1]):e.childNodes.length;t>=i&&(t=i)}}return v(this.gui_root,e,t)},i.prototype._setDOMSelectionRange=function(e,t){if(e.collapsed){this._clearDOMSelection();return}a.FIREFOX&&p.focusNode(e.endContainer),a.MSIE_TO_10&&this._clearDOMSelection();var n=this._getDOMSelection();n.setSingleRange(e,t)},i.prototype.getDataSelectionRange=function(){var e=this.getSelectionRange();if(e===undefined)return undefined;var t=this.toDataLocation(e.startContainer,e.startOffset),n;return e.collapsed||(n=this.toDataLocation(e.endContainer,e.endOffset)),t.makeRange(n).range},i.prototype.setDataSelectionRange=function(e){var t=this.fromDataLocation(e.startContainer,e.startOffset),n;e.collapsed||(n=this.fromDataLocation(e.endContainer,e.endOffset)),this.setSelectionRange(t.makeRange(n).range)},i.prototype._caretPositionOnScreen=function(){if(!this._sel_focus)return undefined;if(this._fake_caret.parentNode)return this._fake_caret.getBoundingClientRect();var e=this._sel_focus.node;if(e.classList&&e.classList.contains("_gui"))return e.getBoundingClientRect();var t=this.getSelectionRange();if(t)return t.nativeRange.getBoundingClientRect();throw new Error("can't find position of caret")}}),define("wed/key_constants",["require","exports","module","./key"],function(e,t,n){var r=e("./key");t.CTRLEQ_S=r.makeCtrlEqKey("S"),t.CTRLEQ_Z=r.makeCtrlEqKey("Z"),t.CTRLEQ_Y=r.makeCtrlEqKey("Y"),t.CTRLEQ_C=r.makeCtrlEqKey("C"),t.CTRLEQ_X=r.makeCtrlEqKey("X"),t.CTRLEQ_V=r.makeCtrlEqKey("V"),t.CTRLEQ_FORWARD_SLASH=r.makeCtrlEqKey(191),t.CTRLEQ_PERIOD=r.makeCtrlEqKey(190),t.CTRLEQ_BACKQUOTE=r.makeCtrlEqKey(192),t.CTRLEQ_OPEN_BRACKET=r.makeCtrlEqKey(219),t.CTRLEQ_CLOSE_BRACKET=r.makeCtrlEqKey(221),t.LEFT_ARROW=r.makeKey(37,!1),t.UP_ARROW=r.makeKey(38,!1),t.RIGHT_ARROW=r.makeKey(39,!1),t.DOWN_ARROW=r.makeKey(40,!1),t.BACKSPACE=r.makeKey(8,!1),t.DELETE=r.makeKey(46,!1),t.ENTER=r.makeKey(13,!1),t.SPACE=r.makeKey(32,!1),t.ESCAPE=r.makeKey(27,!1),t.EDITING_KEYS=[t.LEFT_ARROW,t.RIGHT_ARROW,t.BACKSPACE,t.DELETE,t.ENTER]}),define("wed/gui/context_menu",["require","exports","module","jquery","../util","../log","bootstrap"],function(e,t,n){function o(e,t,n,i,s){this._dismiss_callback=s,this._dismissed=!1;var o=e.createElement("div");o.className="dropdown wed-context-menu",o.innerHTML="<a href='#' data-toggle='dropdown'></a><ul class='dropdown-menu' role='menu'></ul>";var u=o.lastElementChild,a=o.firstElementChild;t-=5,n-=5,o.style.top=n+"px",o.style.left=t+"px";var f=r(u);this._menu=u,this._$menu=f,this._dropdown=o,this._backdrop=e.createElement("div"),this._backdrop.className="wed-context-menu-backdrop",r(this._backdrop).click(this._backdrop_click_handler.bind(this)),f.on("click",this._contents_click_handler.bind(this)),f.on("mousedown",function(e){e.stopPropagation()}.bind(this)),r(o).on("contextmenu mouseup",!1);var l=e.body;l.insertBefore(o,l.firstChild),l.insertBefore(this._backdrop,l.firstChild),this._render(i);var c=f.outerWidth(),h=r(e.defaultView).width();o.style.left=Math.max(0,Math.min(t,h-c))+"px",u.style.maxWidth=h+"px";var p=Number(f.css("line-height").replace("px",""))*5,d=f.outerHeight(),v=r(e.defaultView).height(),m=v-n;m<p&&(n-=p-m,m=p),o.style.top=n+"px",u.style.maxHeight=m+"px",r(a).focus(this.handleToggleFocus.bind(this)),r(a).dropdown("toggle")}var r=e("jquery"),i=e("../util"),s=e("../log");e("bootstrap"),o.prototype.handleToggleFocus=function(){},o.prototype._contents_click_handler=function(e){return this.dismiss(),e.stopPropagation(),e.preventDefault(),!1},o.prototype._backdrop_click_handler=function(){return this.dismiss(),!1},o.prototype._render=function(e){this._$menu.append(e)},o.prototype.dismiss=function(){if(this._dismissed)return;this._$menu.dropdown("toggle"),this._dropdown&&this._dropdown.parentNode&&this._dropdown.parentNode.removeChild(this._dropdown),this._backdrop&&this._backdrop.parentNode&&this._backdrop.parentNode.removeChild(this._backdrop),this._dismiss_callback&&this._dismiss_callback(),this._dismissed=!0},t.ContextMenu=o}),define("wed/gui/action_context_menu",["require","exports","module","./context_menu","jquery","./icon","../oop","../log","../key_constants","../key","../browsers","../util"],function(e,t,n){function y(e,t,n,o,a){o.sort(function(e,t){var n=e.action&&e.action.kind,r=t.action&&t.action.kind;if(n!==r){var i=v.indexOf(n),s=v.indexOf(r);return i-s}var o=e.item.textContent,u=t.item.textContent;return o===u?0:o<u?-1:1}),this._action_items=o,this._action_kind_filter=null,this._action_type_filter=null,this._action_text_filter="";var f=e.createElement("li");f.className="wed-menu-filter",f.style.whiteSpace="nowrap";var l=e.createElement("div"),c=e.createElement("div");c.className="btn-group btn-group-xs";var h,p,m,y;for(h=0,p=d.length;h<p;++h){var E=d[h];m=e.createElement("button"),m.className="btn btn-default",E?(m.innerHTML=s.makeHTML(E),y="Show only "+E+" operations."):(m.innerHTML=s.makeHTML("other"),y="Show operations not covered by other filter buttons."),i(m).tooltip({title:y,container:"body",placement:"auto top"}),i(m).on("click",b(this,E)),c.appendChild(m)}var S=e.createElement("div");S.className="btn-group btn-group-xs";for(h=0,p=g.length;h<p;++h){var x=g[h];m=e.createElement("button"),m.className="btn btn-default",x?(m.innerHTML=s.makeHTML(x),y="Show only "+x+" operations."):(m.innerHTML=s.makeHTML("other"),y="Show operations not covered by other filter buttons."),i(m).tooltip({title:y,container:"body",placement:"auto top"}),i(m).on("click",w(this,x)),S.appendChild(m)}i(f).on("click",!1),f.appendChild(l),l.appendChild(c),l.appendChild(e.createTextNode("")),l.appendChild(S);var T=e.createElement("input");T.className="form-control input-sm",T.setAttribute("placeholder","Filter choices by text.");var N=e.createElement("div");N.appendChild(T),f.appendChild(N);var C=i(T);C.on("input",this._inputChangeHandler.bind(this)),C.on("keydown",this._inputKeydownHandler.bind(this)),this._action_filter_item=f,this._action_filter_input=T,r.ContextMenu.call(this,e,t,n,[],a),T.focus();var k=this._$menu;k.parent().on("hidden.bs.dropdown",u.wrap(function(){i(T).tooltip("destroy"),i(c).children().tooltip("destroy")})),k.on("keydown",this._actionKeydownHandler.bind(this)),k.on("keypress",this._actionKeypressHandler.bind(this))}function b(e,t){return u.wrap(function(n){e._action_kind_filter=t,e._render()})}function w(e,t){return u.wrap(function(n){e._action_type_filter=t,e._render()})}var r=e("./context_menu"),i=e("jquery"),s=e("./icon"),o=e("../oop"),u=e("../log"),a=e("../key_constants"),f=e("../key"),l=e("../browsers"),c=e("../util"),h=r.ContextMenu,p=["add","delete","wrap","unwrap"],d=p.concat(undefined),v=[undefined].concat(p),m=["element","attribute"],g=m.concat(undefined);o.inherit(y,h),y.prototype.handleToggleFocus=function(){this._action_filter_input.focus()};var E="li:not(.divider):visible a";y.prototype._actionKeydownHandler=u.wrap(function(e){if(a.ESCAPE.matchesEvent(e)&&(this._action_kind_filter!==null||this._action_type_filter!==null||this._action_text_filter)){this._action_kind_filter=null,this._action_type_filter=null,this._action_text_filter="";if(!l.FIREFOX_24)this._action_filter_input.value="",this._render();else{var t=this;setTimeout(function(){t._action_filter_input.value="",t._render()},0)}return e.stopPropagation(),e.preventDefault(),!1}return!0});var S=f.makeKey("+"),x=f.makeKey("-"),T=f.makeKey("."),N=f.makeKey(","),C=f.makeKey("?"),k=f.makeKey("<"),L=f.makeKey("@"),A=f.makeKey("!"),O=[{key:S,filter:"add",which:"kind"},{key:x,filter:"delete",which:"kind"},{key:N,filter:"wrap",which:"kind"},{key:T,filter:"unwrap",which:"kind"},{key:C,filter:undefined,which:"kind"},{key:k,filter:"element",which:"type"},{key:L,filter:"attribute",which:"type"},{key:A,filter:undefined,which:"type"}];y.prototype._actionKeypressHandler=u.wrap(function(e){if(this._action_text_filter)return!0;for(var t=0,n;(n=O[t])!==undefined;++t){var r=n.key;if(r.matchesEvent(e)){var i="_action_"+n.which+"_filter";if(this[i]!==null)continue;return this[i]=n.filter,this._render(),e.stopPropagation(),e.preventDefault(),!1}}return!0}),y.prototype._inputChangeHandler=u.wrap(function(e){var t=this._action_text_filter,n=e.target.value;t!==n&&(this._action_text_filter=n,this._render())}),y.prototype._inputKeydownHandler=u.wrap(function(e){if(a.ENTER.matchesEvent(e))return this._$menu.find(E).first().focus().click(),e.stopPropagation(),e.preventDefault(),!1;var t,n=["UP_ARROW","DOWN_ARROW","ESCAPE"];for(var r=0,s;s=n[r];++r){var o=a[s];if(o.matchesEvent(e)){t=o;break}}if(t){var u=new i.Event("keydown");return t.setEventToMatch(u),this._$menu.trigger(u),!1}return!0}),y.prototype._render=function(){var e=this._menu,t=this._action_filter_item,n=this._action_kind_filter,r=this._action_type_filter;while(e.lastChild&&e.lastChild!==t)e.removeChild(e.lastChild);var i,s,o,u,a=t.firstElementChild.firstElementChild.firstElementChild;for(i=0,s=d.length;i<s;++i){var f=d[i];o=a.classList,u=n===f?o.add:o.remove,u.call(o,"active"),a=a.nextElementSibling}a=t.firstElementChild.lastElementChild.firstElementChild;for(i=0,s=g.length;i<s;++i){var l=g[i];o=a.classList,u=r===l?o.add:o.remove,u.call(o,"active"),a=a.nextElementSibling}t.parentNode||e.appendChild(t);var c=this._computeActionItemsToDisplay(this._action_items);h.prototype._render.call(this,c)},y.prototype._computeActionItemsToDisplay=function(e){var t=this._action_kind_filter,n=this._action_type_filter,r=this._action_text_filter,i;switch(t){case null:i=function(){return!0};break;case undefined:i=function(t){return!t.action||p.indexOf(t.action.kind)===-1};break;default:i=function(n){return n.action&&n.action.kind===t}}var s;switch(n){case null:s=function(){return!0};break;case undefined:s=function(t){return!t.action||m.indexOf(t.action.node_type)===-1};break;default:s=function(t){return t.action&&t.action.node_type===n}}var o;if(r)if(r[0]==="^"){var u=RegExp(r);o=function(t){var n=t.data&&t.data.name?t.data.name:t.item.textContent;return u.test(n)}}else o=function(t){var n=t.data&&t.data.name?t.data.name:t.item.textContent;return n.indexOf(r)!==-1};else o=function(){return!0};var a=[];for(var f=0,l;(l=e[f])!==undefined;++f)i(l)&&s(l)&&o(l)&&a.push(l.item);return a},t.ContextMenu=y}),define("wed/gui/completion_menu",["require","exports","module","./context_menu","jquery","../oop","../log","../key_constants"],function(e,t,n){function f(e,t,n,r,i,s,o){this._completion_prefix=i,this._completion_items=s,this._editor=e,a.call(this,t,n,r,[],o),this._dropdown.classList.add("wed-completion-menu"),this._dropdown.firstElementChild.getAttribute("data-toggle")&&this._dropdown.removeChild(this._dropdown.firstChild),this._backdrop.parentNode.removeChild(this._backdrop),this._bound_completion_keydown_handler=this._globalKeydownHandler.bind(this),e.pushGlobalKeydownHandler(this._bound_completion_keydown_handler),e._focusInputField()}var r=e("./context_menu"),i=e("jquery"),s=e("../oop"),o=e("../log"),u=e("../key_constants"),a=r.ContextMenu;s.inherit(f,a),f.prototype._globalKeydownHandler=function(e,t){return u.ENTER.matchesEvent(t)?(this._$menu.find("li:not(.divider):visible a").first().click(),!1):u.DOWN_ARROW.matchesEvent(t)?(this._$menu.find("li:not(.divider):visible a").first().focus(),this._$menu.trigger(t),!1):u.ESCAPE.matchesEvent(t)?(this.dismiss(),!1):!0},f.prototype._render=function(){function o(e){n.type(e.data)}var e=[],t=this._completion_prefix,n=this._editor,r=n.doc,s;for(var u=0,f;(f=this._completion_items[u])!==undefined;++u)if(t==="")s=r.createElement("li"),s.innerHTML="<a href='#'></a>",s.lastChild.textContent=f,e.push(s),i(s).click(f,o);else if(f.lastIndexOf(t,0)===0){s=r.createElement("li"),s.innerHTML="<a href='#'><b></b></a>";var l=s.lastChild;l.firstChild.textContent=f.slice(0,t.length);var c=f.slice(t.length);l.appendChild(r.createTextNode(c)),e.push(s),i(s).click(c,o)}e.length===0&&this.dismiss(),e.length===1&&f===t&&this.dismiss(),a.prototype._render.call(this,e)},f.prototype.dismiss=function(){if(this._dismissed)return;this._editor.popGlobalKeydownHandler(this._bound_completion_keydown_handler),a.prototype.dismiss.call(this)},t.CompletionMenu=f}),define("wed/gui/typeahead_popup",["require","exports","module","jquery","../domutil","../log","../key_constants","bootstrap","typeahead"],function(e,t,n){function u(e,t,n,s,o,u,a){var f=e,l=i.htmlToElements('<div class="wed-typeahead-popup"><input class="typeahead form-control" type="text"><span class="spinner"><i class="fa fa-spinner fa-spin"></i></span></div>',f)[0],c=l.firstElementChild;c.setAttribute("placeholder",o),this._ta_wrapper=l,this._dismiss_callback=a,this._dismissed=!1,this._backdrop=e.createElement("div"),this._backdrop.className="wed-typeahead-popup-backdrop",r(this._backdrop).click(this._backdrop_click_handler.bind(this)),l.style.width=s+"px",l.style.left=t+"px",l.style.top=n+"px";var h=r(c);this._ta=c,this._$ta=h;var p=[u.options];u.datasets&&u.datasets.length>0&&(p=p.concat(u.datasets)),h.typeahead.apply(h,p),h.on("keydown",this._keydownHandler.bind(this)),h.on("typeahead:selected",this._selectedHandler.bind(this));var d=f.body;d.insertBefore(l,d.firstChild),d.insertBefore(this._backdrop,d.firstChild);var v=l.offsetWidth,m=e.defaultView.innerWidth;l.style.left=Math.max(0,Math.min(t,m-v))+"px",l.style.maxWidth=m+"px";var g=e.defaultView.innerHeight,y=g-n;l.style.maxHeight=y+"px";var b=l.getElementsByClassName("tt-dropdown-menu")[0],w=r(b),E=b.style.display;b.style.display="block";var S=Number(w.css("line-height").replace("px",""))*5,x=b.getBoundingClientRect(),T=g-x.top;T<S&&(n-=S-T,T=S,l.style.top=n+"px"),b.style.maxHeight=T+"px",b.style.display=E,w.off("mouseenter.tt",".tt-suggestion"),w.off("mouseleave.tt",".tt-suggestion"),w.on("click",!1),c.focus();var N=r.data(c,"ttTypeahead");N.isActivated=!0,N.input.off("blurred"),N._onBlurred=function(){this.isActivated=!1},N.input.onSync("blurred",N._onBlurred,N)}var r=e("jquery"),i=e("../domutil"),s=e("../log"),o=e("../key_constants");e("bootstrap"),e("typeahead"),u.prototype.dismiss=function(e){if(this._dismissed)return;var t=this._ta_wrapper;t&&t.parentNode&&t.parentNode.removeChild(t);var n=this._backdrop;n&&n.parentNode&&n.parentNode.removeChild(n),this._dismiss_callback&&this._dismiss_callback(e),this._dismissed=!0},u.prototype._backdrop_click_handler=s.wrap(function(){return this.dismiss(),!1}),u.prototype._keydownHandler=s.wrap(function(e){if(o.ESCAPE.matchesEvent(e))return this.dismiss(),!1}),u.prototype._selectedHandler=s.wrap(function(e,t){this.dismiss(t)}),u.prototype.hideSpinner=function(){this._ta_wrapper.getElementsByClassName("spinner")[0].style.display="none"},u.prototype.setValue=function(e){this._$ta.typeahead("val",e)},t.TypeaheadPopup=u}),define("wed/gui/tooltip",["require","exports","module","jquery","bootstrap"],function(e,t,n){function i(e){var t=e.target,n=r.data(t,"bs.tooltip");r.data(n.tip()[0],"wed-tooltip-for",t)}function s(e,t){e.tooltip(t),e[0].classList.add("wed-has-tooltip"),e.on("show.bs.tooltip",i)}var r=e("jquery");e("bootstrap"),t.tooltip=s}),define("wed/wed_gui",["require","exports","module","./wed_core","jquery","./browsers","./log","./saver","./validator","./util","./domutil","salve/validate","./key_constants","./gui/modal","./gui/context_menu","./gui/action_context_menu","./gui/completion_menu","./gui/typeahead_popup","./key","./dloc","./gui/icon","./wed_util","./gui/tooltip","bootstrap","jquery.bootstrap-growl"],function(e,t,n){var r=e("./wed_core"),i=r.Editor,s=e("jquery"),o=e("./browsers"),u=e("./log"),a=e("./saver"),f=e("./validator"),l=e("./util"),c=e("./domutil"),h=e("salve/validate"),p=e("./key_constants"),d=e("./gui/modal"),v=e("./gui/context_menu"),m=e("./gui/action_context_menu"),g=e("./gui/completion_menu"),y=e("./gui/typeahead_popup"),b=e("./key"),w=e("./dloc"),E=w.makeDLoc,S=e("./gui/icon"),x=e("./wed_util"),T=e("./gui/tooltip").tooltip,N=x.getAttrValueNode;e("bootstrap"),e("jquery.bootstrap-growl");var C=c.closestByClass,k=c.closest,L=Array.prototype.indexOf;i.prototype.resize=function(){this._resizeHandler()},i.prototype._resizeHandler=u.wrap(function(){function t(){e+=this.scrollHeight}var e=0,n=this.$widget;while(n.length>0){var r=n.nextAll().not("script");r.each(t),n=n.parent()}e+=this._wed_location_bar.scrollHeight;var i=this.my_window.innerHeight-(this._scroller.getBoundingClientRect().top+this.my_window.pageYOffset)-e-1;i=Math.floor(i),this._scroller.style.maxHeight=i+"px",this._scroller.style.minHeight=i+"px";var o=this._sidebar,u=this.my_window.innerHeight-(o.getBoundingClientRect().top+this.my_window.pageYOffset)-e;o.style.maxHeight=u+"px",o.style.minHeight=u+"px";var a=o.getElementsByClassName("wed-sidebar-panel")[0];u=this.my_window.innerHeight-(a.getBoundingClientRect().top+this.my_window.pageYOffset)-e,a.style.maxHeight=u+"px",a.style.minHeight=u+"px";var f=a.getElementsByClassName("panel"),l=a.getElementsByClassName("panel-heading"),h=0;for(var p=0,d;(d=l[p])!==undefined;++p){var v=s(d.parentNode);h+=v.outerHeight(!0)-v.innerHeight(),h+=s(d).outerHeight(!0)}var m=u-h,g;for(p=0,g;(g=f[p])!==undefined;++p){g.style.maxHeight=m+s(c.childByClass(g,"panel-heading")).outerHeight(!0)+"px";var y=g.getElementsByClassName("panel-body")[0];y.style.height=m+"px"}this._refreshValidationErrors(),this._refreshFakeCaret()}),i.prototype.openDocumentationLink=function(e){window.open(e)},i.prototype.makeDocumentationLink=function(e){var t=S.makeHTML("documentation"),n=c.htmlToElements("<a tabindex='0' href='#'>"+t+" "+"Element's documentation.</a>",this.doc)[0];return s(n).click(function(){this.openDocumentationLink(e)}.bind(this)),n},i.prototype._contextMenuHandler=function(e){if(!this._sel_focus)return!1;var t=this.getSelectionRange(),n=!t||!!t.collapsed;if(!n&&!c.isWellFormedRange(t))return!1;var r=this._sel_focus.node,i=this._sel_focus.offset;if(r.nodeType!==Node.ELEMENT_NODE){var s=r.parentNode;i=L.call(s.childNodes,r),r=s}var o=C(r,"_placeholder",this.gui_root);o&&(i=L.call(o.parentNode.childNodes,o),r=o.parentNode);var u=C(r,"_attribute_value",this.gui_root)?this._getMenuItemsForAttribute:this._getMenuItemsForElement,a=u.call(this,r,i,!n);if(a.length===0)return!0;var f=this.computeContextMenuPosition(e);return this.displayContextMenu(m.ContextMenu,f.left,f.top,a),!1},i.prototype._getMenuItemsForAttribute=function(e,t,n){var r=[];return r},i.prototype._getMenuItemsForElement=function(e,t,n){function h(t,n){var r=n.getIcon(),i=c.htmlToElements("<li><a tabindex='0' href='#'>"+(r?r+" ":"")+n.getDescriptionFor(t)+"</a></li>",e.ownerDocument)[0],o=i.firstElementChild;s(o).click(t,n.bound_terminal_handler),l.push({action:n,item:i,data:t})}var r={};if(e.classList&&e.classList.contains("_phantom")){var i;while(e&&e.classList.contains("_phantom"))i=e,e=e.parentNode;if(e&&this.gui_root.contains(e)){var o=this.mode.nodesAroundEditableContents(e),u=e.childNodes;t=L.call(u,i);var a=o[0]&&L.call(u,o[0]),f=o[1]&&L.call(u,o[1]);a!==null&&t<=a&&(t=a+1),f!==null&&t>=f&&(t=f-1),r={move_caret_to:E(this.gui_root,e,t)}}else e=null}if(!e)return[];var l=[],p,d;if(!e.classList.contains("_phantom")&&!e.parentNode.classList.contains("_gui")){var v=this.toDataNode(e),m=this.mode.documentationLinkFor(v.tagName);if(m){var g=this.makeDocumentationLink(m),y=e.ownerDocument.createElement("li");y.appendChild(g),l.push({action:null,item:y,data:null})}this.validator.possibleAt(v,t).forEach(function(e){if(e.params[0]!=="enterStartTag")return;var r=this.resolver.unresolveName(e.params[1],e.params[2]),i=this.mode.getContextualActions(n?"wrap":"insert",r,v,t);for(p=0;(d=i[p])!==undefined;++p)h({name:r},d)}.bind(this));if(v!==this.data_root.firstChild){var b=this.mode.getContextualActions(["unwrap","delete-parent"],v.tagName,v,0);for(p=0;(d=b[p])!==undefined;++p)h({node:v,name:v.tagName},d)}}var w=s(e).parents().addBack().siblings("[data-wed--separator-for]").first(),S=w.siblings().filter(function(){return this.contains(e)})[0],x=w[0]&&w[0].getAttribute("data-wed--separator-for");if(x!==undefined){var b=this.mode.getContextualActions(["merge-with-next","merge-with-previous","append","prepend"],x,s.data(S,"wed_mirror_node"),0);b.forEach(function(e){h({node:S,name:x},e)}.bind(this))}return l},i.prototype.computeContextMenuPosition=function(e,t){t=!!t;var n=!e;e=e||{};var r,i;if(e.type==="mousedown"||e.type==="mouseup"||e.type==="click"||e.type==="contextmenu")r={left:e.clientX,top:e.clientY};else if(this._fake_caret.parentNode){var o=this._positionFromGUIRoot(this._fake_caret);this.scrollIntoView(o.left,o.top,o.left+this._fake_caret.offsetWidth,o.top+this._fake_caret.offsetHeight),i=this._fake_caret.getBoundingClientRect(),r={top:t?i.bottom:i.top+this._$fake_caret.height()/2,left:i.left}}else{var u=C(this._sel_focus.node,"_gui",this.gui_root);if(!u)throw new Error("no position for displaying the menu");i=u.getBoundingClientRect();var a=s(u);r={top:t?i.bottom:i.top+a.height()/2,left:i.left+a.width()/2}}return r},i.prototype._cutHandler=function(e){if(this.getDataCaret()===undefined)return!1;var t=this._getDOMSelectionRange();return c.isWellFormedRange(t)?(this.fireTransformation(this.cut_tr,{e:e}),!0):(this.straddling_modal.modal(),!1)},i.prototype._pasteHandler=function(e){var t=this.getDataCaret();if(t===undefined)return!1;var n=e.originalEvent.clipboardData||this.my_window.clipboardData,r=n.getData("text");if(!r)return!1;r=this._normalizeEnteredText(r);if(!r)return!1;var i,s=new this.my_window.DOMParser,o=s.parseFromString("<div>"+r+"</div>","text/xml"),u=!0;o.firstChild.tagName==="parsererror"&&o.firstChild.namespace==="http://www.mozilla.org/newlayout/xml/parsererror.xml"&&(u=!1);if(u){i=o.firstChild;var a=this.validator.speculativelyValidate(t,Array.prototype.slice.call(i.childNodes));if(a)return this._paste_modal.modal(function(){this._paste_modal.getClickedAsText()==="Yes"&&(i=this.doc.createElement("div"),i.textContent=r,this.fireTransformation(this.paste_tr,{node:t.node,to_paste:i,e:e}))}.bind(this)),!1}else i=this.doc.createElement("div"),i.textContent=r;return this.fireTransformation(this.paste_tr,{node:t.node,to_paste:i,e:e}),!1},i.prototype.scrollIntoView=function(e,t,n,r){var i=this.gui_root.scrollTop,s=this.$gui_root.height(),o=i+s;if(t<i||r>o)i=t<i?t:r-s,this.gui_root.scrollTop=i;var u=this.gui_root.scrollLeft,a=this.$gui_root.width(),f=u+a;if(e<u||n>f)u=e<u?e:n-a,this.gui_root.scrollLeft=u;var l=this.gui_root.getBoundingClientRect();e=e-u+l.left,n=n-u+l.left,t=t-i+l.top,r=r-i+l.top;var c=this.doc.body.scrollHeight,h=this.doc.body.scrollWidth,p=0;if(t<0||r>c)p=t<0?t:r;var d=0;if(e<0||n>h)d=e<0?e:n;this.my_window.scrollBy(d,p)},i.prototype._keydownHandler=u.wrap(function(e){var t=this.getGUICaret();t&&this.$gui_root.trigger("wed-input-trigger-keydown",[e]);if(e.isImmediatePropagationStopped()||e.isPropagationStopped())return;this.$gui_root.trigger("wed-global-keydown",[e])}),i.prototype.pushGlobalKeydownHandler=function(e){this._global_keydown_handlers.push(e)},i.prototype.popGlobalKeydownHandler=function(e){var t=this._global_keydown_handlers.pop();if(t!==e)throw new Error("did not pop the expected handler")},i.prototype._globalKeydownHandler=u.wrap(function(e,t){function o(){return t.stopPropagation(),t.preventDefault(),!1}function A(){var e=i.getSelectionRange();if(e&&!e.collapsed){if(!c.isWellFormedRange(e))return!0;O=i._initiateTextUndo();var t=i.toDataLocation(e.startContainer,e.startOffset),n=i.toDataLocation(e.endContainer,e.endOffset),r=i.data_updater.cut(t,n);return i.setDataCaret(r[0],!0),O.recordCaretAfter(),i._refreshValidationErrors(),!0}return!1}var n,r,i=this;if(t.which===17||t.which===16||t.which===18||t.which===0)return!0;for(var a=0,f;(f=this._global_keydown_handlers[a])!==undefined;++a){var h=f(e,t);h===!1&&o()}if(t.which===112)return this.help_modal.modal(),o();if(this._development_mode){if(t.which===113)return this.dumpCaretInfo(),o();if(t.which==114)return this.dumpUndo(),o();if(t.which==115)return console.log("manual focus"),console.log("document.activeElement before",document.activeElement),console.log('document.querySelector(":focus") before',document.querySelector(":focus")),this._focusInputField(),console.log("document.activeElement after",document.activeElement),console.log('document.querySelector(":focus") after',document.querySelector(":focus")),o()}var d=this._sel_focus;if(t.which>=33&&t.which<=40){var v,m;if(p.RIGHT_ARROW.matchesEvent(t)){if(t.shiftKey){this._sel_focus=this.positionRight(this._sel_focus);var g=this._sel_anchor.makeRange(this._sel_focus);this.setSelectionRange(g.range,g.reversed)}else this.moveCaretRight();return o()}if(p.LEFT_ARROW.matchesEvent(t)){if(t.shiftKey){this._sel_focus=this.positionLeft(this._sel_focus);var g=this._sel_anchor.makeRange(this._sel_focus);this.setSelectionRange(g.range,g.reversed)}else this.moveCaretLeft();return o()}return!0}if(p.ESCAPE.matchesEvent(t))return this._closeAllTooltips()?o():!0;if(p.CTRLEQ_S.matchesEvent(t))return this.save(),o();if(p.CTRLEQ_Z.matchesEvent(t))return this.undo(),o();if(p.CTRLEQ_Y.matchesEvent(t))return this.redo(),o();if(p.CTRLEQ_C.matchesEvent(t)||p.CTRLEQ_X.matchesEvent(t)||p.CTRLEQ_V.matchesEvent(t))return!0;if(p.CTRLEQ_BACKQUOTE.matchesEvent(t))return this._development_mode=!this._development_mode,s.bootstrapGrowl(this._development_mode?"Development mode on.":"Development mode off.",{ele:"body",type:"info",align:"center"}),this._development_mode&&u.showPopup(),o();if(p.CTRLEQ_OPEN_BRACKET.matchesEvent(t))return this.decreaseLabelVisiblityLevel(),o();if(p.CTRLEQ_CLOSE_BRACKET.matchesEvent(t))return this.increaseLabelVisibilityLevel(),o();if(p.CTRLEQ_FORWARD_SLASH.matchesEvent(t)){var y=d&&d.node;if(y){var b=C(y,"_gui",d.root);if(b&&b.classList.contains("_label_clicked"))return y.nodeType===Node.TEXT_NODE&&(y=y.parentNode),s(y).trigger("wed-context-menu",[t]),o()}if(this._contextMenuHandler(t)===!1)return o()}if(d===undefined)return!0;var w=C(d.node,"_placeholder",d.root);if(w){r=this.getDataCaret();if(!l.anySpecialKeyHeld(t)){var E=!1;w.parentNode.classList.contains("_attribute_value")?E=!0:this.validator.possibleAt(r).forEach(function(e){e.params[0]==="text"&&(E=!0)});if(!E)return o()}if(p.BACKSPACE.matchesEvent(t)||p.DELETE.matchesEvent(t))return o()}var S=C(d.node,"_attribute_value",d.root),x=this.$gui_root.find(".__start_label._label_clicked, .__end_label._label_clicked");if(!S&&x[0]&&p.DELETE.matchesEvent(t)){var T=C(x[0],"_real",this.gui_root),N=this.data_updater.pathToNode(this.nodeToPath(T)),k=this.mode.getContextualActions("delete-parent",N.tagName,N,0);k[0].execute({node:N,name:N.tagName})}else if(d.node.classList&&(d.node.classList.contains("_phantom")||d.node.classList.contains("_phantom_wrap")))return o();var O,M,_;if(p.SPACE.matchesEvent(t))return r=this.getGUICaret(),r?((S||!C(r.node,"_phantom",r.root))&&this._handleKeyInsertingText(t),o()):o();if(p.DELETE.matchesEvent(t)){if(S){if(S.textContent==="")return o();this._spliceAttribute(S,this.getGUICaret().offset,1,"")}else{var D=c.nextCaretPosition(d.toArray(),this.gui_root,!0)[0];if(!D.classList||!D.classList.contains("_phantom")&&!D.classList.contains("_phantom_wrap")){if(A())return o();r=this.getDataCaret(),r.node.nodeType!==Node.TEXT_NODE&&(r=r.make(r.node.childNodes[r.offset],0)),r.node.nodeType===Node.TEXT_NODE&&(M=r.node.parentNode,_=L.call(M.childNodes,r.node),O=this._initiateTextUndo(),this.data_updater.deleteText(r,1),r.node.parentNode?this.setDataCaret(r,!0):this.setDataCaret(M,_,!0),O.recordCaretAfter())}}return this._refreshValidationErrors(),o()}if(p.BACKSPACE.matchesEvent(t)){if(S){if(S.textContent==="")return o();this._spliceAttribute(S,this.getGUICaret().offset-1,1,"")}else{var P=c.prevCaretPosition(d.toArray(),this.gui_root,!0)[0];if(!P.classList||!P.classList.contains("_phantom")&&!P.classList.contains("_phantom_wrap")){if(A())return o();r=this.getDataCaret(),r.node.nodeType!==Node.TEXT_NODE&&(r=r.make(r.node.childNodes[r.offset-1],r.node.childNodes[r.offset-1].length));if(r.node.nodeType===Node.TEXT_NODE){M=r.node.parentNode,_=L.call(M.childNodes,r.node);if(r.offset===0)return o();O=this._initiateTextUndo(),this.data_updater.deleteText(r.node,r.offset-1,1),r.node.parentNode?this.setDataCaret(r.node,r.offset-1,!0):this.setDataCaret(M,_,!0),O.recordCaretAfter()}}}return this._refreshValidationErrors(),o()}return!0});var A=b.makeKey(27);i.prototype._keypressHandler=u.wrap(function(e){if(A.matchesEvent(e))return!0;this.$gui_root.trigger("wed-input-trigger-keypress",[e]);if(e.isImmediatePropagationStopped()||e.isPropagationStopped())return!0;this.$gui_root.trigger("wed-global-keypress",[e])}),i.prototype.type=function(e){e instanceof b.Key&&(e=[e]);for(var t=0;t<e.length;++t){var n=e[t];typeof n=="string"&&(n=n===" "?p.SPACE:b.makeKey(n));var r=new s.Event("keydown");n.setEventToMatch(r),this._$input_field.trigger(r)}},i.prototype._globalKeypressHandler=u.wrap(function(e,t){function n(){return t.preventDefault(),t.stopPropagation(),!1}if(this._sel_focus===undefined)return!0;if(!t.which)return!0;if(t.which===8)return n();if(t.ctrlKey||t.altKey||t.metaKey)return!0;var r=this.getSelectionRange();if(r!==undefined&&!r.collapsed){if(!c.isWellFormedRange(r))return n();var i=this._initiateTextUndo(),s=this.toDataLocation(r.startContainer,r.startOffset),o=this.toDataLocation(r.endContainer,r.endOffset),u=this.data_updater.cut(s,o);this.setDataCaret(u[0],!0)}return this._handleKeyInsertingText(t),n()}),i.prototype._handleKeyInsertingText=function(e){var t=String.fromCharCode(e.which);if(t==="")return!1;this._insertText(t),e.preventDefault(),e.stopPropagation()},i.prototype._compositionHandler=u.wrap(function(e){if(e.type==="compositionstart")this._composing=!0,this._composition_data={data:e.originalEvent.data,start_caret:this._sel_focus},this._$input_field.css("z-index",10),this._refreshFakeCaret();else if(e.type==="compositionupdate")this._composition_data.data=e.originalEvent.data;else{if(e.type!=="compositionend")throw new Error("unexpected event type: "+e.type);this._composing=!1,this._$input_field.css("z-index","").css("top","").css("left","")}}),i.prototype._inputHandler=u.wrap(function(e){if(this._composing)return;if(this._$input_field.val()==="")return;this._insertText(this._$input_field.val()),this._$input_field.val(""),this._focusInputField()}),i.prototype._mousemoveHandler=u.wrap(function(e){var t=this.elementAtPointUnderLayers(e.clientX,e.clientY);if(!this.gui_root.contains(t))return;var n;if(t.getAttribute("contenteditable")==="true"){n=this._pointToCharBoundary(e.clientX,e.clientY);if(!n)return}else{var r;while(t.getAttribute("contenteditable")!=="true"){r=t,t=r.parentNode;if(!this.gui_root.contains(t))return}var i=L.call(t.childNodes,r),s=this.doc.createRange();s.setStart(t,i),s.setEnd(t,i+1);var o=s.getBoundingClientRect();Math.abs(o.left-e.clientX)>=Math.abs(o.right-e.clientX)&&i++,n=E(this.gui_root,t,i)}this._sel_focus=n;if(!this._prev_sel_focus||this._sel_focus.offset!=this._prev_sel_focus.offset||this._sel_focus.node!=this._prev_sel_focus.node){this._refreshFakeCaret();var u=this._sel_anchor.makeRange(this._sel_focus);this._setDOMSelectionRange(u.range,u.reversed),this._prev_sel_focus=this._sel_focus}}),i.prototype.elementAtPointUnderLayers=function(e,t){var n;o.CHROME_31&&(n=this._getDOMSelectionRange(),n&&(n=n.cloneRange())),this._hideLayers();var r=this.doc.elementFromPoint(e,t);return this._popLayerState(),n&&this._setDOMSelectionRange(n),r},i.prototype._hideLayers=function(){var e=Object.create(null);for(var t=0,n;(n=this._layer_names[t])!==undefined;++t){var r=this[n];e[n]=r.style.display,r.style.display="none"}this._layer_state_stack.push(e)},i.prototype._popLayerState=function(){var e=this._layer_state_stack.pop();for(var t=0,n;(n=this._layer_names[t])!==undefined;++t){var r=this[n];r.style.display=e[n]}},i.prototype._caretLayerMouseHandler=u.wrap(function(e){e.type==="mousedown"&&(this._$caret_layer.on("mousemove",this._caretLayerMouseHandler.bind(this)),this._$caret_layer.one("mouseup",this._caretLayerMouseHandler.bind(this)));var t=this.elementAtPointUnderLayers(e.clientX,e.clientY),n=s.Event(e.type,e);n.target=t,n.toElement=t,s(t).trigger(n),e.type==="mouseup"&&this._$caret_layer.off("mousemove"),e.preventDefault(),e.stopPropagation()}),i.prototype._moveToNormalizedLabelPosition=function(e,t,n){var r=C(e,"_attribute",t);r?C(n.node,"_attribute_value",t)?this.setGUICaret(n):this.setGUICaret(N(r.getElementsByClassName("_attribute_value")[0]),0):this.setGUICaret(t.getElementsByClassName("_element_name")[0],0)},i.prototype._mousedownHandler=u.wrap(function(e){if(!c.pointInContents(this._scroller,e.pageX,e.pageY))return!1;var t=this._pointToCharBoundary(e.clientX,e.clientY);if(!t)return!0;this.$gui_root.one("mouseup",this._mouseupHandler.bind(this)),this.$widget.find(".wed-validation-error.selected").removeClass("selected"),this.$error_list.find(".selected").removeClass("selected");var n=this.gui_root,r=e.target,i=C(r,"_placeholder",n),s=C(r,"_label",n);switch(e.which){case 1:(!k(r,"._gui, ._phantom",n)||C(r,"_attribute_value",n))&&this.$gui_root.on("mousemove.wed",this._mousemoveHandler.bind(this)),i?this.setGUICaret(i,0):s?this._moveToNormalizedLabelPosition(r,s,t):this.setGUICaret(t),this._prev_sel_focus=undefined;if(e.target.classList.contains("wed-validation-error"))return!0;break;case 3:var o=this.getSelectionRange();if(!o||!!o.collapsed)i?this.setGUICaret(i,0):s?this._moveToNormalizedLabelPosition(r,s,t):this.setGUICaret(t)}return!1}),i.prototype._mouseupHandler=u.wrap(function(e){if(!c.pointInContents(this._scroller,e.pageX,e.pageY))return!1;var t=this._pointToCharBoundary(e.clientX,e.clientY);if(!t)return!0;e.type==="contextmenu"&&(e.which=3);var n=this.gui_root,r=e.target,i=C(r,"_placeholder",n),o=C(r,"_label",n);switch(e.which){case 3:i&&this.setGUICaret(r,0),o?(this._moveToNormalizedLabelPosition(r,o,t),s(r).trigger("wed-context-menu",[e])):(this._sel_focus||this.setGUICaret(t),k(r,"*[data-wed-custom-context-menu]",n)?s(r).trigger("wed-context-menu",[e]):this._contextMenuHandler(e))}return this.$gui_root.off("mousemove"),e.preventDefault(),!1}),i.prototype._mouseoverHandler=u.wrap(function(e){var t=this.gui_root,n=C(e.target,"_label",t);if(n){var r=this,i=C(n,"_real",t),o=l.getOriginalName(i),u={title:function(){return r.preferences.get("tooltips")?r.mode.shortDescriptionFor(o):undefined},container:"body",delay:{show:1e3},placement:"auto top"};T(s(n),u);var a=s.data(n,"bs.tooltip");a.enter(a)}}),i.prototype._mouseoutHandler=u.wrap(function(e){var t=this.gui_root,n=C(e.target,"_label",t);if(n)return s(n).tooltip("destroy"),!1}),i.prototype._setupCompletionMenu=function(){this._dismissDropdownMenu();var e=this.getSelectionRange();if(!e||!e.collapsed)return;var t=this.getGUICaret(),n=t.node,r=C(n,"_attribute_value",this.gui_root);if(r){var i=n.ownerDocument,s=this.getDataCaret(),o=s.node;if(s.offset!==o.value.length)return;var u=this.mode,a=[];this.validator.possibleAt(s.node,0).forEach(function(e){if(e.params[0]!=="attributeValue")return;if(e.params[0]==="attributeValue"){var t=e.params[1];if(t instanceof RegExp)return;a.push(t)}});if(!a.length)return;var f=[];for(var l=0,c;(c=a[l])!==undefined;++l)c.lastIndexOf(o.value,0)===0&&f.push(c);if(!f.length||f.length===1&&f[0]===o.value)return;var h=this.computeContextMenuPosition(undefined,!0);this._current_dropdown=new g.CompletionMenu(this,i,h.left,h.top,o.value,a,function(){this._current_dropdown=undefined}.bind(this))}},i.prototype._positionFromGUIRoot=function(e){var t;if(e===this._fake_caret){t={left:+e.style.left.replace("px",""),top:+e.style.top.replace("px","")};if(isNaN(t.left)||isNaN(t.top))throw new Error("NAN for left or top");return t.left+=this.gui_root.scrollLeft,t.top+=this.gui_root.scrollTop,t}t=s(e).offset();var n=this.$gui_root.offset();return t.left-=n.left-this.gui_root.scrollLeft,t.top-=n.top-this.gui_root.scrollTop,t},i.prototype._dismissDropdownMenu=function(){this._current_dropdown&&this._current_dropdown.dismiss()},i.prototype.displayContextMenu=function(e,t,n,r){this._dismissDropdownMenu(),this.pushSelection(),this._current_dropdown=new e(this.doc,t,n,r,function(){this._current_dropdown=undefined,this.popSelection()}.bind(this))},i.prototype.displayTypeaheadPopup=function(e,t,n,r,i,s){return this._dismissDropdownMenu(),this.pushSelection(),this._current_typeahead=new y.TypeaheadPopup(this.doc,e,t,n,r,i,function(e){this._current_typeahead=undefined,this.popSelection(),s&&s(e)}.bind(this)),this._current_typeahead},i.prototype._refreshSaveStatus=u.wrap(function(){if(this._saver){var e=this._saver.getSavedWhen();this._$save_status.children("span").first().text(e);if(!e)this._$save_status.removeClass("label-success label-info").addClass("label-default");else{var t=this._saver.getLastSaveKind(),n,r;switch(t){case a.AUTO:n="label-info",r="The last save was an autosave.";break;case a.MANUAL:n="label-success",r="The last save was a manual save.";break;default:throw new Error("unexpected kind of save: "+t)}this._$save_status.removeClass("label-default label-info label-success").addClass(n),this._$save_status.tooltip({title:r,container:"body",placement:"auto top"})}var i=this._saver.getModifiedWhen();i!==!1?(this._$modification_status.removeClass("label-success"),this._$modification_status.addClass("label-warning"),this._$modification_status.children("i").css("visibility","")):(this._$modification_status.removeClass("label-warning"),this._$modification_status.addClass("label-success"),this._$modification_status.children("i").css("visibility","hidden"))}});var O={};O[f.INCOMPLETE]="stopped",O[f.WORKING]="working",O[f.INVALID]="invalid",O[f.VALID]="valid";var M={};M[f.INCOMPLETE]="info",M[f.WORKING]="info",M[f.INVALID]="danger",M[f.VALID]="success",i.prototype._onValidatorStateChange=function(){var e=this.validator.getWorkingState(),t=O[e.state],n=e.part_done*100>>0;if(e.state===f.WORKING){if(e.part_done-this._last_done_shown<.05)return}else if(e.state===f.VALID||e.state===f.INVALID)this._first_validation_complete||(this._first_validation_complete=!0,this._setCondition("first-validation-complete",{editor:this}));this._last_done_shown=e.part_done,this.$validation_progress.css("width",n+"%"),this.$validation_progress.removeClass("progress-bar-info progress-bar-success progress-bar-danger");var r=M[e.state];this.$validation_progress.addClass("progress-bar-"+r),this.$validation_message.text(t)},i.prototype._onValidatorError=function(e){this._validation_errors.push(e),this._processValidationError(e)},i.prototype._refreshValidationErrors=function(){var e=this.widget.getElementsByClassName("wed-validation-error"),t;while((t=e[0])!==undefined)t.parentNode.removeChild(t);this.$error_list.children("li").remove();for(var n=0,r;(r=this._validation_errors[n])!==undefined;++n)this._processValidationError(r)},i.prototype._processValidationError=function(e){var t=e.error,n=e.node,r=e.index,i=this.fromDataLocation(n,r);i=this._normalizeCaretToEditableRange(i);var o=l.newGenericID(),a=s(c.htmlToElements("<span class='_phantom wed-validation-error'>&nbsp;</span>",i.node.ownerDocument)[0]);this._$navigation_panel.css("display")==="none"&&this.$error_list.parents(".panel-collapse").collapse("show"),a.click(u.wrap(function(e){this.$error_list.parents(".panel-collapse").collapse("show");var t=this.$error_list.find("#"+o),n=this.$error_list.parent(".panel-body");n.animate({scrollTop:t.offset().top-n.offset().top+n[0].scrollTop}),this.$widget.find(".wed-validation-error.selected").removeClass("selected"),s(e.currentTarget).addClass("selected"),t.siblings().removeClass("selected"),t.addClass("selected")}.bind(this)));var f=a[0].id=l.newGenericID(),p=x.boundaryXY(i),d=this._scroller.getBoundingClientRect();a[0].style.top=p.top-d.top+this._scroller.scrollTop+"px",a[0].style.left=p.left-d.left+this._scroller.scrollLeft+"px",this._$error_layer.append(a);var v=t.getNames();for(var m=0;m<v.length;++m)v[m]=this.resolver.unresolveName(v[m].ns,v[m].name,t instanceof h.AttributeNameError||t instanceof h.AttributeValueError);var g=c.htmlToElements("<li><a href='#"+f+"'>"+t.toStringWithNames(v)+"</li>",i.node.ownerDocument)[0];g.id=o,s(g.firstElementChild).click(u.wrap(function(e){this.$widget.find(".wed-validation-error.selected").removeClass("selected"),a.addClass("selected");var t=s(e.currentTarget).parent();t.siblings().removeClass("selected"),t.addClass("selected")}.bind(this))),this.$error_list.append(g)},i.prototype._onResetErrors=function(e){if(e.at!==0)throw new Error("internal error: wed does not yet support resetting errors at an arbitrary location");this._validation_errors=[],this.$error_list.children("li").remove(),this.$widget.find(".wed-validation-error").remove()},i.prototype.setNavigationList=function(e){this._$navigation_list.empty(),this._$navigation_list.append(e),this._$navigation_panel.css("display","")},i.prototype.makeModal=function(){var e=new d.Modal,t=e.getTopLevel();return t.on("show.bs.modal.modal",function(){this.pushSelection()}.bind(this)),t.on("hidden.bs.modal.modal",function(){this.popSelection()}.bind(this)),this.$widget.prepend(t),e},i.prototype.increaseLabelVisibilityLevel=function(){if(this._current_label_level>=this.max_label_level)return;var e=this._caretPositionOnScreen();this._current_label_level++;var t=this.gui_root.getElementsByClassName("_label_level_"+this._current_label_level);for(var n=0,r=t.length;n<r;n++)t[n].classList.remove("_invisible");this._refreshValidationErrors(),this._refreshFakeCaret();if(!e)return;var i=this._caretPositionOnScreen();this.gui_root.scrollTop-=e.top-i.top,this.gui_root.scrollLeft-=e.left-i.left},i.prototype.decreaseLabelVisiblityLevel=function(){if(!this._current_label_level)return;var e=this._caretPositionOnScreen(),t=this._current_label_level;this._current_label_level--;var n=this.gui_root.getElementsByClassName("_label_level_"+t);for(var r=0,i=n.length;r<i;r++)n[r].classList.add("_invisible");this._refreshValidationErrors(),this._refreshFakeCaret();if(!e)return;var s=this._caretPositionOnScreen();this.gui_root.scrollTop-=e.top-s.top,this.gui_root.scrollLeft-=e.left-s.left},i.prototype._closeAllTooltips=function(){var e=this.doc.querySelectorAll("div.tooltip"),t=!1;for(var n=0,r;r=e[n];++n){var i=s.data(r,"wed-tooltip-for"),o=s(i).data("bs.tooltip");o&&(o.leave(o),t=!0)}return t}}),define("wed/wed",["require","exports","module","./wed_core","./wed_init","./wed_caret","./wed_gui"],function(e,t,n){var r=e("./wed_core");r.module_config=n.config(),e("./wed_init"),e("./wed_caret"),e("./wed_gui"),t.version=r.version,t.Editor=r.Editor}),define("wed/mode",["require","exports","module","./domutil","./lib/pubsub"],function(e,t,n){function s(e){this._editor=undefined,this._options=e||{},this._wed_options={label_levels:{max:1,initial:1}}}var r=e("./domutil"),i=e("./lib/pubsub");s.prototype._ready=function(){i.publish(i.WED_MODE_READY,this)},s.prototype.init=function(e){this._editor=e},s.prototype.getWedOptions=function(){return this._wed_options},s.prototype.getAbsoluteResolver=function(){throw new Error("getAbsoluteResolver must be overriden.")},s.prototype.makeDecorator=function(){throw new Error("makeDecorator must be overriden.")},s.prototype.getContextualActions=function(e,t,n,r){throw new Error("getContextualActions must be overriden")},s.prototype.getStylesheets=function(){return[]},s.prototype.nodesAroundEditableContents=function(e){var t=null,n,r=null,i,s=e.firstChild,o=0;while(s){if(s.nodeType===Node.ELEMENT_NODE){s.classList.contains("_start_wrapper")&&(n=o,t=s);if(s.classList.contains("_end_wrapper")){i=o,r=s;break}}s=s.nextSibling,o++}if(n!==undefined&&i!==undefined&&i<=n)throw new Error("end wrapper element unexpectedly appears before start wrapper element, or is also a start wrapper element");return[t,r]},s.prototype.makePlaceholderFor=function(e){return r.makePlaceholder()},s.prototype.shortDescriptionFor=function(e){return undefined},s.prototype.documentationLinkFor=function(e){return undefined},s.prototype.getValidator=function(){return null},t.Mode=s}),define("wed/decorator",["require","exports","module","./util","jquery","./domutil","./transformation","./gui/tooltip","./gui/action_context_menu","./dloc"],function(e,t,n){function h(e,t,n){this._domlistener=e,this._editor=t,this._gui_updater=n}function p(e,t){try{e.setDataCaret(t,!0)}catch(n){}}var r=e("./util"),i=e("jquery"),s=e("./domutil"),o=s.closestByClass,u=e("./transformation"),a=e("./gui/tooltip").tooltip,f=e("./gui/action_context_menu"),l=e("./dloc"),c=Array.prototype.indexOf;t.Decorator=h,h.prototype.addHandlers=function(){this._domlistener.addHandler("added-element","._real, ._phantom, ._phantom_wrap",this.contentEditableHandler.bind(this))},h.prototype.startListening=function(e){this._domlistener.startListening()},h.prototype.listDecorator=function(e,t){var n={},i=e.firstElementChild;while(i)i.classList.contains("_real")&&(n[r.getOriginalName(i)]=1),i=i.nextElementSibling;var s=Object.keys(n);if(s.length>1)throw new Error("calling listDecorator on a non-homogeneous list.");if(s.length===0)return;i=e.firstElementChild;while(i){var o=i.nextElementSibling;i.hasAttribute("data-wed--separator-for")&&this._gui_updater.removeNode(i),i=o}var u=s[0],a;typeof t=="string"?(a=e.ownerDocument.createElement("div"),a.appendChild(e.ownerDocument.createTextNode(t))):a=t,a.classList.add("_text"),a.classList.add("_phantom"),a.setAttribute("data-wed--separator-for",u);var f=!0;i=e.firstElementChild;while(i)i.classList.contains("_real")&&(f?f=!1:this._gui_updater.insertBefore(e,a.cloneNode(!0),i)),i=i.nextElementSibling},h.prototype.contentEditableHandler=function(e,t,n,r,i){function o(e){e.setAttribute("tabindex","-1"),e.setAttribute("contenteditable",e.classList.contains("_real")||s&&e.classList.contains("_attribute_value"));var t=e.firstElementChild;while(t)o(t),t=t.nextElementSibling}var s=this._editor.attributes==="edit";o(i)},h.prototype.elementDecorator=function(e,t,n,o,u){if(n>this._editor.max_label_level)throw new Error("level higher than the maximum set by the mode: "+n);var a=this._editor.getDataCaret();a&&!(a.node instanceof this._editor.my_window.Attr&&a.node.ownerElement===i.data(t,"wed_mirror_node"))&&(a=undefined);var f=r.getOriginalName(t),l="_"+f+"_label",c=s.childrenByClass(t,l),h,d;for(h=0;d=c[h];++h)t.removeChild(d);var v=[];if(this._editor.attributes==="show"||this._editor.attributes==="edit"){var m=r.getOriginalAttributes(t),g=Object.keys(m).sort(),y;for(h=0;y=g[h];++h)v.push(['<span class="_phantom _attribute">','<span class="_phantom _attribute_name">',y,'</span>="<span class="_phantom _attribute_value">',s.textToHTML(m[y]),'</span>"</span>'].join(""))}var b=(v.length?" ":"")+v.join(" "),w=t.ownerDocument;l+=" _label_level_"+n;var E=w.createElement("span");E.className="_gui _phantom __start_label _start_wrapper "+l+" _label";var S=w.createElement("span");S.className="_phantom",S.innerHTML="&nbsp;<span class='_phantom _element_name'>"+f+"</span>"+b+" >&nbsp;",E.appendChild(S),this._gui_updater.insertNodeAt(t,0,E);var x=w.createElement("span");x.className="_gui _phantom __end_label _end_wrapper "+l+" _label";var T=w.createElement("span");T.className="_phantom",T.innerHTML="&nbsp;&lt; <span class='_phantom _element_name'>"+f+"</span>&nbsp;",x.appendChild(T),this._gui_updater.insertBefore(t,x,null);var N=i(E),C=i(x);o!==undefined?N.on("wed-context-menu",o):N.on("wed-context-menu",!1),u!==undefined?C.on("wed-context-menu",u):C.on("wed-context-menu",!1),a&&p(this._editor,a)},h.prototype._contextMenuHandler=function(e,t,n){function g(e,t,n){var r=t.getIcon();d=p.createElement("a"),d.setAttribute("tabindex","-1"),d.setAttribute("href","#"),d.innerHTML=(r?r+" ":"")+t.getDescriptionFor(e)+m[n],i(d).click(e,t.bound_terminal_handler),v=p.createElement("li"),v.appendChild(d),a.push({action:t,item:v,data:e})}function y(e,t){var n=s.resolver.unresolveName(e.params[1],e.params[2]);if(s.isAttrProtected(n,t))return;var r=h.getContextualActions("add-attribute",n,t);if(r===undefined)return;for(var i=0,o;(o=r[i])!==undefined;++i)g({name:n,node:t},o)}var s=this._editor,u=t.target,a=[],h=s.mode,p=u.ownerDocument,d,v,m={"undefined":"","true":" before this element","false":" after this element"},b=o(u,"_attribute_value",s.gui_root);if(b){var w=s.toDataNode(b),E=w.ownerElement,S=E.parentNode,x=c.call(S.childNodes,E),T=l.makeDLoc(s.data_root,S,x);s.validator.possibleAt(T,!0).forEach(function(e){if(e.params[0]!=="attributeName")return;var t=T.node.childNodes[T.offset];y(e,t)}.bind(this));var N=w.name;if(!s.isAttrProtected(w)){var C=h.getContextualActions("delete-attribute",N,w);if(C===undefined)return;for(var k=0,L;(L=C[k])!==undefined;++k)g({name:N,node:w},L)}}else{u=o(u,"_real",s.gui_root);var A=u.parentNode===s.gui_root,O=r.getOriginalName(u),M=this._editor.mode.documentationLinkFor(O);M&&(v=p.createElement("li"),v.appendChild(this._editor.makeDocumentationLink(M)),a.push({action:null,item:v,data:null}));if(!A){var C=h.getContextualActions(["unwrap","delete-element"],O,i.data(u,"wed_mirror_node"),0);C!==undefined&&C.forEach(function(e){g({node:u,name:O},e,undefined)}.bind(this))}var S=u.parentNode,_=Array.prototype.indexOf.call(S.childNodes,u);e||_++;var T=s.toDataLocation(S,_);e&&s.attributes==="edit"&&s.validator.possibleAt(T,!0).forEach(function(e){if(e.params[0]!=="attributeName")return;var t=T.node.childNodes[T.offset];y(e,t)}.bind(this)),A||s.validator.possibleAt(T).forEach(function(t){if(t.params[0]!=="enterStartTag")return;var n=s.resolver.unresolveName(t.params[1],t.params[2]),r=h.getContextualActions("insert",n,T.node,T.offset);if(r===undefined)return;for(var i=0,o;(o=r[i])!==undefined;++i)g({name:n,move_caret_to:T},o,e)}.bind(this))}if(a.length===0)return!0;var D=s.computeContextMenuPosition(n);return s.displayContextMenu(f.ContextMenu,D.left,D.top,a),!1}}),define("wed/modes/generic/generic_decorator",["require","exports","module","wed/decorator","wed/oop","wed/util","wed/log"],function(e,t,n){function u(e,t,n){r.apply(this,Array.prototype.slice.call(arguments,3)),this._mode=e,this._meta=t,this._options=n}var r=e("wed/decorator").Decorator,i=e("wed/oop"),s=e("wed/util"),o=e("wed/log");i.inherit(u,r),u.prototype.addHandlers=function(){this._domlistener.addHandler("included-element",s.classFromOriginalName("*"),function(e,t,n,r,i,s){if(!e.contains(s))return;this.elementDecorator(e,s);var o=this._meta.getAdditionalClasses(s);o.length>0&&(s.className+=" "+o)}.bind(this)),this._domlistener.addHandler("children-changed",s.classFromOriginalName("*"),function(e,t,n,r,i,s){var o=t.concat(n),u=!1;for(var a=0,f=o.length;!u&&a<f;++a){var l=o[a];u=l.nodeType===Node.TEXT_NODE||l.classList.contains("_real")||l.classList.contains("_phantom_wrap")}u&&this.elementDecorator(e,s)}.bind(this)),this._domlistener.addHandler("text-changed",s.classFromOriginalName("*"),function(e,t){this.elementDecorator(e,t.parentNode)}.bind(this)),this._domlistener.addHandler("attribute-changed",s.classFromOriginalName("*"),function(e,t){this.elementDecorator(e,t)}.bind(this)),r.prototype.addHandlers.call(this)},u.prototype.elementDecorator=function(e,t){r.prototype.elementDecorator.call(this,e,t,1,o.wrap(this._contextMenuHandler.bind(this,!0)),o.wrap(this._contextMenuHandler.bind(this,!1)))},t.GenericDecorator=u}),define("wed/modes/generic/generic_tr",["require","exports","module","salve/validate","wed/dloc","wed/gui/icon","wed/util","wed/transformation"],function(e,t,n){function h(e){var t={};return t.insert=new f(e,"insert","Create new <name>","",function(e,t){var n=e.getDataCaret(),r=e.mode.getAbsoluteResolver().resolveName(t.name),i=a(e.data_updater,n.node,n.offset,r.ns,t.name);if(e.mode._options.autoinsert){d(i,e);while(i){var s=i.firstChild;if(!s)break;i=s}}e.setDataCaret(i,0)}),t.unwrap=new f(e,"unwrap","Unwrap the content of this element",undefined,function(e,t){var n=t.node.parentNode,r=c.call(n.childNodes,t.node);l(e.data_updater,t.node),e.setDataCaret(n,r)}),t.wrap=new f(e,"wrap","Wrap in <name>",undefined,function(e,t){var n=e.getSelectionRange();if(!n)throw new Error("wrap transformation called with undefined range");if(n.collapsed)throw new Error("wrap transformation called with collapsed range");var r=e.toDataLocation(n.startContainer,n.startOffset),i=e.toDataLocation(n.endContainer,n.endOffset),s=e.mode.getAbsoluteResolver().resolveName(t.name),o=u.wrapInElement(e.data_updater,r.node,r.offset,i.node,i.offset,s.ns,t.name),a=o.parentNode;e.setDataCaret(a,c.call(a.childNodes,o)+1)}),t["delete-element"]=new f(e,"delete-element","Delete this element",undefined,function(e,t){var n=t.node.parentNode,r=c.call(n.childNodes,t.node);e.data_updater.removeNode(t.node),e.setDataCaret(n,r)}),t["delete-parent"]=new f(e,"delete-parent","Delete <name>",undefined,function(e,t){var n=t.node.parentNode,r=c.call(n.childNodes,t.node);e.data_updater.removeNode(t.node),e.setDataCaret(n,r)}),t["add-attribute"]=new f(e,"add-attribute","Add @<name>",undefined,function(e,t){var n=t.node,r=o.encodeAttrName(t.name);e.data_updater.setAttribute(n,r,"");var i=n.getAttributeNode(r);e.setDataCaret(i,0)}),t["delete-attribute"]=new f(e,"delete-attribute","Delete this attribute",undefined,function(e,t){var n=t.node,r=n.name,i=n.ownerElement,s=c.call(i.attributes,n);e.data_updater.setAttribute(i,r,null);var o=i.attributes[s];if(o)e.setDataCaret(o,0);else{var u=e.fromDataLocation(i,0);e.setGUICaret(u.node.getElementsByClassName("_element_name")[0],0)}}),t["insert-text"]=new f(e,"insert-text",'Insert "<name>"',undefined,function(e,t){e.type(t.name)}),t}function p(e){var t=e.error.toString();return t.lastIndexOf("tag required: ",0)===0}function d(e,t){for(;;){var n=t.validator.getErrorsFor(e);n=n.filter(p);if(n.length===0)break;var s=n[0].error.getNames()[0],o=t.validator.possibleWhere(e,new r.Event("enterStartTag",s.ns,s.name));if(o.length!==1)break;var u=t.resolver.unresolveName(s.ns,s.name),a=t.mode.getContextualActions("insert",u,e,o[0]);if(a.length!==1)break;if(a[0].needs_input)break;t.setDataCaret(i.makeDLoc(i.getRoot(e),e,o[0])),a[0].execute({name:u})}}var r=e("salve/validate"),i=e("wed/dloc"),s=e("wed/gui/icon"),o=e("wed/util"),u=e("wed/transformation"),a=u.insertElement,f=u.Transformation,l=u.unwrap,c=Array.prototype.indexOf;t.makeTagTr=h}),define("wed/modes/generic/generic_meta",["require","exports","module","jquery","../../log","../../lib/pubsub"],function(e,t,n){function u(e){this._options=e||{},this._desc_map=undefined,this._namespace_mappings=undefined,this._resolveOptions()}var r=e("jquery"),i=e("../../log"),s=e("../../lib/pubsub"),o=s.makeTopic("wed.modes.generic.meta.ready");u.prototype._ready=function(){s.publish(o,this)},u.prototype._resolveOptions=function(){var t=this._options,n=r.extend(!0,{},t);t&&t.metadata?r.ajax({type:"GET",url:e.toUrl(t.metadata),success:i.wrap(function(e){n.metadata=e,this._options=n,this._afterResolved()}.bind(this)),dataType:"json"}).fail(i.wrap(function(e,t,n){throw new Error("cannot load metadata; status: "+t+" error thrown: "+n)})):this._afterResolved()},u.prototype._afterResolved=function(){this._metadata=this._options.metadata;if(this._metadata){if(this._metadata.version!=1)throw new Error("unexpected version number: "+this._metadata.version);this._namespace_mappings=this._metadata.namespaces;if("xml"in this._namespace_mappings)throw new Error("xml mapping already defined");this._namespace_mappings.xml="http://www.w3.org/XML/1998/namespace",this._reverse_mapping=Object.create(null);for(var e in this._namespace_mappings){var t=this._namespace_mappings[e];this._reverse_mapping[t]||(this._reverse_mapping[t]=e)}this._reverse_mapping[this._namespace_mappings[""]]="";var n=this._metadata.elements,r=Object.create(null),i=this;n.forEach(function(e){var t=e.ns||"http://www.tei-c.org/ns/1.0",n=i._reverse_mapping[t];if(n===undefined)throw new Error("undefined namespace: "+t);var s=n===""?e.name:n+":"+e.name;r[s]=e.desc}),this._desc_map=r}this._ready()},u.prototype.isInline=function(e){return!1},u.prototype.getAdditionalClasses=function(e){var t=[];return this.isInline(e)&&t.push("_inline"),t.join(" ")},u.prototype.getNamespaceMappings=function(){return this._namespace_mappings},u.prototype.shortDescriptionFor=function(e){return this._desc_map&&this._desc_map[e]},u.prototype.documentationLinkFor=function(t){if(!this._metadata)return undefined;var n=this._metadata.dochtml;return t=t.replace(":","_"),e.toUrl(n+"ref-"+t+".html")},t.Meta=u}),define("wed/modes/generic/generic",["require","exports","module","../../mode","salve/name_resolver","../../oop","./generic_decorator","./generic_tr","jquery","../../lib/pubsub","../../object_check","./generic_meta"],function(e,t,n){function c(e){r.apply(this,arguments),this.constructor===c&&(this._wed_options.metadata={name:"Generic",authors:["Louis-Dominique Dubeau"],description:"This is a basic mode bundled with wed and which can, and probably should be used as the base for other modes.",license:"MPL 2.0",copyright:"2013, 2014 Mangalam Research Center for Buddhist Languages"});var t={meta:!0,autoinsert:!1},n=l.check(t,this._options);this._options.autoinsert===undefined&&(this._options.autoinsert=!0);var i=[],s;n.missing&&n.missing.forEach(function(e){i.push("missing option: "+e)}),n.extra&&n.extra.forEach(function(e){i.push("extra option: "+e)});if(i.length)throw new Error("incorrect options: "+i.join(", "));this._wed_options.attributes="edit",this._resolveOptions()}var r=e("../../mode").Mode,i=e("salve/name_resolver"),s=e("../../oop"),o=e("./generic_decorator").GenericDecorator,u=e("./generic_tr").makeTagTr,a=e("jquery"),f=e("../../lib/pubsub"),l=e("../../object_check");e("./generic_meta"),s.inherit(c,r),c.prototype._resolveOptions=function(){var t=this._options,n=a.extend(!0,{},t);if(t&&t.meta){var r=n.meta;if(typeof r=="string")r=n.meta={path:r};else if(typeof r.path!="object"){e([r.path],function(e){n.meta.path=e,this._options=n,this._afterResolved()}.bind(this));return}}this._afterResolved()},c.prototype._afterResolved=function(){var e=this._options.meta.path.Meta,t=function(e,t){if(this._meta!==t)return;this._resolver=new i.NameResolver;var n=this._meta.getNamespaceMappings();Object.keys(n).forEach(function(e){this._resolver.definePrefix(e,n[e])}.bind(this)),this._ready()}.bind(this);f.subscribe(f.WED_MODES_GENERIC_META_READY,t),this._meta=new e(this._options.meta.options)},c.prototype.init=function(e){r.prototype.init.call(this,e),this._tag_tr=u(e)},c.prototype.getAbsoluteResolver=function(){return this._resolver},c.prototype.makeDecorator=function(){var e=Object.create(o.prototype),t=Array.prototype.slice.call(arguments);return t=[this,this._meta,this._options].concat(t),o.apply(e,t),e},c.prototype.shortDescriptionFor=function(e){return this._meta.shortDescriptionFor(e)},r.prototype.documentationLinkFor=function(e){return this._meta.documentationLinkFor(e)},r.prototype.getContextualActions=function(e,t,n,r){e instanceof Array||(e=[e]);var i=[];for(var s=0;s<e.length;s++){var o=this._tag_tr[e[s]];o!==undefined&&i.push(o)}return i},t.Mode=c}),define("wed/modes/generic/metas/tei_meta",["require","exports","module","wed/oop","wed/util","wed/modes/generic/generic_meta"],function(e,t,n){function o(e){s.apply(this,arguments),this._namespace_mappings||(this._namespace_mappings=Object.create(null),this._namespace_mappings.xml="http://www.w3.org/XML/1998/namespace",this._namespace_mappings[""]="http://www.tei-c.org/ns/1.0")}var r=e("wed/oop"),i=e("wed/util"),s=e("wed/modes/generic/generic_meta").Meta;r.inherit(o,s),o.prototype.isInline=function(e){var t=i.getOriginalName(e),n=t.split(":");n.length===1&&(n[1]=n[0],n[0]="tei");var r=n.join(":");switch(r){case"tei:note":case"mml:math":case"tei:abbr":case"tei:affiliation":case"tei:altIdentifier":case"tei:analytic":case"tei:add":case"tei:am":case"tei:att":case"tei:author":return!0}switch(r){case"tei:biblScope":case"tei:br":case"tei:byline":case"tei:c":case"tei:caesura":case"tei:choice":case"tei:code":case"tei:collection":case"tei:country":case"tei:damage":case"tei:date":case"tei:del":case"tei:depth":case"tei:dim":case"tei:dimensions":case"tei:editor":case"tei:editionStmt":case"tei:emph":case"tei:ex":case"tei:expan":return!0}switch(r){case"tei:figure":case"tei:floatingText":return!1;case"tei:foreign":case"tei:forename":case"tei:gap":case"tei:genName":case"tei:geogName":case"tei:gi":case"tei:gloss":case"tei:graphic":case"tei:height":case"tei:hi":case"tei:ident":case"tei:idno":case"tei:imprint":case"tei:institution":return!0}switch(r){case"tei:list":return!1;case"tei:locus":case"tei:mentioned":case"tei:monogr":case"tei:series":case"tei:msName":case"tei:name":case"tei:num":case"tei:orgName":case"tei:orig":case"tei:origDate":case"tei:origPlace":case"tei:pc":case"tei:persName":case"tei:placeName":case"tei:ptr":case"tei:publisher":case"tei:pubPlace":return!0}switch(r){case"tei:q":case"tei:quote":case"tei:ref":case"tei:region":case"tei:repository":case"tei:roleName":case"tei:rubric":case"tei:said":case"tei:seg":case"tei:sic":case"tei:settlement":case"tei:soCalled":case"tei:summary":case"tei:supplied":case"tei:surname":case"tei:tag":case"tei:term":case"tei:textLang":case"tei:title":case"tei:unclear":case"tei:val":case"tei:width":case"tei:dynamicContent":case"w:drawing":case"m:oMath":return!0}return!1},t.Meta=o});