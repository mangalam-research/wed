/**
 * @module util
 * @desc Various utilities for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module log
 * @desc Logging facilities
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Copyright 2013, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3alpha.804
 * Build date: 8 December 2013
 */

/**
 * Selection save and restore module for Rangy.
 * Saves and restores user selections using marker invisible elements in the DOM.
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Depends on Rangy core.
 *
 * Copyright 2013, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3alpha.804
 * Build date: 8 December 2013
 */

/**
* @author Louis-Dominique Dubeau
* @license MPL 2.0
* @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
*/

/**
 * @module domutil
 * @desc Utilities that manipulate or query the DOM tree.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module oop
 * @desc Object-oriented programming utilities.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module undo
 * @desc Basic undo/redo framework.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module wundo
 * @desc Wed-specific undo functionality.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module lib/simple_event_emitter
 * @desc A mixin class for objects that can emit events.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module lib/conditioned
 * @desc A mixin class for objects that have conditions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module exceptions
 * @desc Exceptions for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module onerror
 * @desc The error handler for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module browsers
 * @desc Browser detection. Extremely ad hoc and meant for wed's
 * internal purposes only.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module key
 * @desc Module implementing an class that describes keyboard keys.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013-2015 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module dloc
 * @desc Model for DOM locations.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module object_check
 * @desc Checks whether an object conforms to a template.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module preferences
 * @desc A model for wed's preferences.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module guiroot
 * @desc Model for a GUI root.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014-2015 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module serializer
 * @desc An XML serializer for platforms that produce erratic results.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module saver
 * @desc Data saving functionality.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module savers/ajax
 * @desc Data saving functionality, using Ajax.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module savers/localforage
 * @desc Data saving functionality, using localforage.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module tree_updater
 * @desc Facility for updating a DOM tree and issue synchronous events
 * on changes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module convert
 * @desc Convertion from XML to HTML.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui_updater
 * @desc Listens to changes on a tree and updates the GUI tree in
 * response to changes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module undo_recorder
 * @desc Listens to changes on a tree and records undo operations
 * corresponding to these changes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module domlistener
 * @desc Abstract base class for classes that raise events when a DOM
 * tree is modified.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module updater_domlistener
 * @desc Facility to listen to changes to a DOM tree.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module name_resolver
 * @desc Implements a name resolver for handling namespace changes in XML.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module util
 * @desc A mock implementation of Node's util package. This module
 * implements only what is actually used in salve.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module oop
 * @desc OOP utilities
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module hashstructs
 * @desc {@link module:hashstructs~HashSet HashSet} and {@link
 * module:hashstructs~HashMap HashMap} implementations.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module set
 * @desc Naive set implementation.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module datatypes/errors
 * @desc Errors that can be raised during parsing of types.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module datatypes/builtin
 * @desc Implementation of the builtin Relax NG datatype library.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module datatypes/xmlcharacters
 * @desc Collection of constants that model the way XML refers to
 * various characters and groups of characters.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/*!
 * XRegExp v2.0.0
 * (c) 2007-2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 */

/*!
 * XRegExp Unicode Base v1.0.0
 * (c) 2008-2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 * Uses Unicode 6.1 <http://unicode.org/>
 */

/*!
 * XRegExp Unicode Categories v1.2.0
 * (c) 2010-2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 * Uses Unicode 6.1 <http://unicode.org/>
 */

/*!
 * XRegExp Unicode Scripts v1.2.0
 * (c) 2010-2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 * Uses Unicode 6.1 <http://unicode.org/>
 */

/*!
 * XRegExp Unicode Blocks v1.2.0
 * (c) 2010-2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 * Uses Unicode 6.1 <http://unicode.org/>
 */

/*!
 * XRegExp Unicode Properties v1.0.0
 * (c) 2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 * Uses Unicode 6.1 <http://unicode.org/>
 */

/*!
 * XRegExp.matchRecursive v0.2.0
 * (c) 2009-2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 */

/*!
 * XRegExp.build v0.1.0
 * (c) 2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 * Inspired by RegExp.create by Lea Verou <http://lea.verou.me/>
 */

/*!
 * XRegExp Prototype Methods v1.0.0
 * (c) 2012 Steven Levithan <http://xregexp.com/>
 * MIT License
 */

/**
 * @module datatypes/xmlschema
 * @desc Implementation of the XMLSchema datatypes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module datatypes
 * @desc Classes that model datatypes used in RNG schemas.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module errors
 * @desc Validation errors.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013-2015 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module name_patterns
 * @desc Classes that model RNG patterns that pertain to names.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2015 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module patterns
 * @desc Classes that model RNG patterns.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013-2015 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module formats
 * @desc This module contains data and utilities to work with the
 * schema format that salve uses natively.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013-2015 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module validate
 * @desc RNG-based validator.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module validator
 * @desc This module is responsible for validating the document being
 * edited in wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/modal
 * @desc Modal dialog boxes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/icon
 * @desc The icons used by the user interface.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module action
 * @desc Editing actions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module transformation
 * @desc Transformation framework.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module lib/pubsub
 * @desc Wed's pubsub wrapper. Hides implementation details.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module onbeforeunload
 * @desc The onbeforeunload handler for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module key_constants
 * @desc Keys that wed uses, as constants.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/context_menu
 * @desc Context menus.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/action_context_menu
 * @desc Context menus meant to hold actions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/completion_menu
 * @desc Menu for completions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/typeahead_popup
 * @desc Support for a typeahead field that pops up in the editing pane.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2015 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/tooltip
 * @desc Tooltips for elements that appear in the editor pane.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module wed
 * @desc The main module for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013-2015 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module mode
 * @desc The base class for modes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
  * @module decorator
  * @desc Basic decoration facilities.
  * @author Louis-Dominique Dubeau
  * @license MPL 2.0
  * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
  */

/**
 * @module modes/generic/generic_decorator
 * @desc Decorator for the generic mode.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module modes/generic/generic_tr
 * @desc Transformation registry for the generic mode.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module modes/generic/generic_meta
 * @desc Meta-information regarding the schema.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module modes/generic/generic
 * @desc The main module for the generic mode.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

/**
 * @module modes/generic/metas/tei_meta
 * @desc The main module for the generic mode.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2013, 2014 Mangalam Research Center for Buddhist Languages
 */

define("wed/util",["require","exports","module"],function(e,t,n){"use strict";function i(e,t){return Math.sqrt(e*e+t*t)}function r(e,t,n,r,o,a){var s=t-r,l=e-n,d=t-a,c=e-o,h=0>s,u=d>0,p=0>l,_=c>0,f=p?l:_?c:0,E=h?s:u?d:0;return i(f,E)}function o(e,t,n,i,r,o){var a=t-i,s=e-n,l=t-o,d=e-r,c=0>a,h=l>0,u=0>s,p=d>0,_=u?s:p?d:0,f=c?a:h?l:0;return{x:Math.abs(_),y:Math.abs(f)}}function a(e){return e.replace(/:/g,"\\:")}function s(e){return e.classList[0]}function l(e){return"*"===e?"._real":"."+a(e)+"._real"}function d(e){return e.slice(9).replace(/---/,":").replace(/---(-+)/g,"--$1")}function c(e){return"data-wed-"+e.replace(/--(-+)/g,"---$1").replace(/:/,"---")}function h(e){for(var t=Object.create(null),n=e.attributes,i=0;i<n.length;++i){var r=n[i];0===r.localName.lastIndexOf("data-wed-",0)&&(t[d(r.localName)]=r.value)}return t}function u(){return"WED-ID-"+ ++v}function p(e){return e.altKey||e.ctrlKey||e.metaKey}function _(){window.selenium_log||(window.selenium_log=[]),window.selenium_log.push.apply(window.selenium_log,arguments)}function f(){var e=new Error;return e.stack?e.stack:E(e)}function E(e){try{throw e}catch(t){return t.stack}}function m(e,t){if(e.a&&e.b)return"("+m(e.a,t)+") or ("+m(e.b,t)+")";var n;if("AnyName"===e.pattern)n="*:*";else{if(void 0===e.ns)throw new Error("unexpected undefined obj.ns");if(void 0!==e.name)n=t.unresolveName(e.ns,e.name),void 0===n&&(n="{"+e.ns+"}"+e.name);else{var i=t.prefixFromURI(e.ns);n=void 0===i?"{"+e.ns+"}":""!==i?i+":":i,n+="*"}}return e.except&&(n+=" except ("+m(e.except,t)+")"),n}function A(e,t){var n=e.config(),i=0===Object.keys(n).length;return 0!==Object.keys(t).length?(i||console.warn("RequireJS' module configuration shadowed by ``wed/config``."),{from:"module",config:t.config}):(i||console.warn("Deprecation Warning: using RequireJS' module configuration is deprecated"),{from:"requirejs",config:n})}var v=0;t.escapeCSSClass=a,t.getOriginalName=s,t.classFromOriginalName=l,t.decodeAttrName=d,t.encodeAttrName=c,t.getOriginalAttributes=h,t.newGenericID=u,t.anySpecialKeyHeld=p,t.distFromDeltas=i,t.distFromRect=r,t.distsFromRect=o,t.seleniumLog=_,t.stackTrace=f,t.convertPatternObj=m,t.grabConfig=A}),define("optional",[],function(){return{version:"0.1.0",failed:[],load:function(e,t,n,i){0!==e.length?t([e],n,function(){this.failed.push(e),requirejs.undef(e),n({})}.bind(this)):n(this)}}}),define("wed/log",["require","exports","module","./util","optional!./config","log4javascript"],function(e,t,n){"use strict";function i(){m.show()}function r(e){this.original=e}function o(e){return e instanceof r?e:(E.fatal("Unhandled exception",e),"undefined"!=typeof console&&(console.log(e),console.log(e.stack)),new r(e))}function a(e){throw o(e)}function s(e){return function(){try{return e.apply(this,arguments)}catch(t){a(t)}}}function l(e,t){var n=new _.AjaxAppender(e);n.setThreshold(_.Level.ALL);var i=new _.XmlLayout;n.setLayout(i),t&&Object.keys(t).forEach(function(e){n.addHeader(e,t[e])}),f.addAppender(n),E.info("Ajax appender initialized"),A.push(n)}function d(){for(var e,t=0;void 0!==(e=A[t]);++t)e.sendAll()}var c=e("./util"),h=e("optional!./config"),u=c.grabConfig(n,h),p=u.config;"module"===u.from&&(p=p.log);var _=e("log4javascript");_.setShowStackTraces(!0);var f=_.getLogger("wed");f.setLevel(_.Level.ALL);var E=_.getLogger("wed.common");E.setLevel(_.Level.ALL);var m=new _.PopUpAppender(!0);m.setThreshold(_.Level.ERROR),m.setFocusPopUp(p&&p.focus_popup),m.setInitiallyMinimized(!0),m.setNewestMessageAtTop(!0),E.addAppender(m),t.trace=E.trace.bind(E),t.debug=E.debug.bind(E),t.info=E.info.bind(E),t.warn=E.warn.bind(E),t.error=E.error.bind(E),t.fatal=E.fatal.bind(E),t.showPopup=i,t.unhandled=o,t.handle=a,t.wrap=s;var A=[];t.addURL=l,t.flush=d}),function(){var e=define;define=void 0,function(e){function t(e,t){var n=typeof e[t];return n==F||!(n!=v||!e[t])||"unknown"==n}function n(e,t){return!(typeof e[t]!=v||!e[t])}function i(e,t){return typeof e[t]!=g}function r(e){return function(t,n){for(var i=n.length;i--;)if(!e(t,n[i]))return!1;return!0}}function o(e){return e&&B(e,w)&&N(e,y)}function a(e){return n(e,"body")?e.body:e.getElementsByTagName("body")[0]}function s(e){n(window,"console")&&t(window.console,"log")&&window.console.log(e)}function l(e,t){t?window.alert(e):s(e)}function d(e){T.initialized=!0,T.supported=!1,l("Rangy is not supported on this page in your browser. Reason: "+e,T.config.alertOnFail)}function c(e){l("Rangy warning: "+e,T.config.alertOnWarn)}function h(e){return e.message||e.description||String(e)}function u(){if(!T.initialized){var e,n=!1,i=!1;t(document,"createRange")&&(e=document.createRange(),B(e,D)&&N(e,C)&&(n=!0),e.detach());var r=a(document);if(!r||"body"!=r.nodeName.toLowerCase())return void d("No body element found");if(r&&t(r,"createTextRange")&&(e=r.createTextRange(),o(e)&&(i=!0)),!n&&!i)return void d("Neither Range nor TextRange are available");T.initialized=!0,T.features={implementsDomRange:n,implementsTextRange:i};var l,c;for(var u in x)(l=x[u])instanceof _&&l.init(l,T);for(var p=0,f=S.length;f>p;++p)try{S[p](T)}catch(E){c="Rangy init listener threw an exception. Continuing. Detail: "+h(E),s(c)}}}function p(e){e=e||window,u();for(var t=0,n=R.length;n>t;++t)R[t](e)}function _(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function f(e,t,n,i){var r=new _(t,n,function(e){if(!e.initialized){e.initialized=!0;try{i(T,e),e.supported=!0}catch(n){var r="Module '"+t+"' failed to load: "+h(n);s(r)}}});x[t]=r}function E(){}function m(){}var A="function"==typeof e.define&&e.define.amd,v="object",F="function",g="undefined",C=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],D=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],y=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],w=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],B=r(t),b=r(n),N=r(i),x={},T={version:"1.3alpha.804",initialized:!1,supported:!0,util:{isHostMethod:t,isHostObject:n,isHostProperty:i,areHostMethods:B,areHostObjects:b,areHostProperties:N,isTextRange:o,getBody:a},features:{},modules:x,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};T.fail=d,T.warn=c,{}.hasOwnProperty?T.util.extend=function(e,t,n){var i,r;for(var o in t)t.hasOwnProperty(o)&&(i=e[o],r=t[o],n&&null!==i&&"object"==typeof i&&null!==r&&"object"==typeof r&&T.util.extend(i,r,!0),e[o]=r);return e}:d("hasOwnProperty not supported"),function(){var e=document.createElement("div");e.appendChild(document.createElement("span"));var t,n=[].slice;try{1==n.call(e.childNodes,0)[0].nodeType&&(t=function(e){return n.call(e,0)})}catch(i){}t||(t=function(e){for(var t=[],n=0,i=e.length;i>n;++n)t[n]=e[n];return t}),T.util.toArray=t}();var k;t(document,"addEventListener")?k=function(e,t,n){e.addEventListener(t,n,!1)}:t(document,"attachEvent")?k=function(e,t,n){e.attachEvent("on"+t,n)}:d("Document does not have required addEventListener or attachEvent method"),T.util.addListener=k;var S=[];T.init=u,T.addInitListener=function(e){T.initialized?e(T):S.push(e)};var R=[];T.addCreateMissingNativeApiListener=function(e){R.push(e)},T.createMissingNativeApi=p,_.prototype={init:function(e){for(var t,n,i=this.dependencies||[],r=0,o=i.length;o>r;++r){if(n=i[r],t=x[n],!(t&&t instanceof _))throw new Error("required module '"+n+"' not found");if(t.init(),!t.supported)throw new Error("required module '"+n+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){T.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){T.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},T.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]),f(!1,e,n,t)},T.createCoreModule=function(e,t,n){f(!0,e,t,n)},T.RangePrototype=E,T.rangePrototype=new E,T.selectionPrototype=new m;var O=!1,I=function(e){O||(O=!0,T.initialized||u())};return typeof window==g?void d("No window found"):typeof document==g?void d("No document found"):(t(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",I,!1),k(window,"load",I),A&&e.define(function(){return T.amd=!0,T}),void(e.rangy=T))}(this),rangy.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==x||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function i(e){var t=e.parentNode;return 1==t.nodeType?t:null}function r(e){for(var t=0;e=e.previousSibling;)++t;return t}function o(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function a(e,t){var n,i=[];for(n=e;n;n=n.parentNode)i.push(n);for(n=t;n;n=n.parentNode)if(R(i,n))return n;return null}function s(e,t,n){for(var i=n?t:t.parentNode;i;){if(i===e)return!0;i=i.parentNode}return!1}function l(e,t){return s(e,t,!0)}function d(e,t,n){for(var i,r=n?e:e.parentNode;r;){if(i=r.parentNode,i===t)return r;r=i}return null}function c(e){var t=e.nodeType;return 3==t||4==t||8==t}function h(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function u(e,t){var n=t.nextSibling,i=t.parentNode;return n?i.insertBefore(e,n):i.appendChild(e),e}function p(e,t,n){var i=e.cloneNode(!1);if(i.deleteData(0,t),e.deleteData(t,e.length-t),u(i,e),n)for(var o,a=0;o=n[a++];)o.node==e&&o.offset>t?(o.node=i,o.offset-=t):o.node==e.parentNode&&o.offset>r(e)&&++o.offset;return i}function _(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=x)return e.ownerDocument;if(typeof e.document!=x)return e.document;if(e.parentNode)return _(e.parentNode);throw t.createError("getDocument: no document found for node")}function f(e){var n=_(e);if(typeof n.defaultView!=x)return n.defaultView;if(typeof n.parentWindow!=x)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function E(e){if(typeof e.contentDocument!=x)return e.contentDocument;if(typeof e.contentWindow!=x)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function m(e){if(typeof e.contentWindow!=x)return e.contentWindow;if(typeof e.contentDocument!=x)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function A(e){return e&&T.isHostMethod(e,"setTimeout")&&T.isHostObject(e,"document")}function v(e,t,n){var i;if(e?T.isHostProperty(e,"nodeType")?i=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?E(e):_(e):A(e)&&(i=e.document):i=document,!i)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return i}function F(e){for(var t;t=e.parentNode;)e=t;return e}function g(e,n,i,o){var s,l,c,h,u;if(e==i)return n===o?0:o>n?-1:1;if(s=d(i,e,!0))return n<=r(s)?-1:1;if(s=d(e,i,!0))return r(s)<o?-1:1;if(l=a(e,i),!l)throw new Error("comparePoints error: nodes have no common ancestor");if(c=e===l?l:d(e,l,!0),h=i===l?l:d(i,l,!0),c===h)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(u=l.firstChild;u;){if(u===c)return-1;if(u===h)return 1;u=u.nextSibling}}function C(e){try{return e.parentNode,!1}catch(t){return!0}}function D(e){if(!e)return"[No node]";if(O&&C(e))return"[Broken node]";if(c(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+r(e)+"]["+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function y(e){for(var t,n=_(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function w(e){this.root=e,this._next=e}function B(e){return new w(e)}function b(e,t){this.node=e,this.offset=t}function N(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var x="undefined",T=e.util;T.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),T.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var k=document.createElement("div");T.areHostMethods(k,["insertBefore","appendChild","cloneNode"]||!T.areHostObjects(k,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),T.isHostProperty(k,"innerHTML")||t.fail("Element is missing innerHTML property");var S=document.createTextNode("test");T.areHostMethods(S,["splitText","deleteData","insertData","appendData","cloneNode"]||!T.areHostObjects(k,["previousSibling","nextSibling","childNodes","parentNode"])||!T.areHostProperties(S,["data"]))||t.fail("Incomplete Text Node implementation");var R=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},O=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br>",O=C(n),e.features.crashyTextNodes=O}();var I;typeof window.getComputedStyle!=x?I=function(e,t){return f(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=x?I=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),w.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},b.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+D(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},N.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},N.prototype.toString=function(){return this.message},e.dom={arrayContains:R,isHtmlNamespace:n,parentElement:i,getNodeIndex:r,getNodeLength:o,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:l,getClosestAncestorIn:d,isCharacterDataNode:c,isTextOrCommentNode:h,insertAfter:u,splitDataNode:p,getDocument:_,getWindow:f,getIframeWindow:m,getIframeDocument:E,getBody:T.getBody,isWindow:A,getContentDocument:v,getRootContainer:F,comparePoints:g,isBrokenNode:C,inspectNode:D,getComputedStyleProperty:I,fragmentFromNodeChildren:y,createIterator:B,DomPosition:b},e.DOMException=N}),rangy.createCoreModule("DomRange",["DomUtil"],function(e,t){function n(e,t){return 3!=e.nodeType&&(W(e,t.startContainer)||W(e,t.endContainer))}function i(e){return e.document||V(e.startContainer)}function r(e){return new H(e.parentNode,U(e))}function o(e){return new H(e.parentNode,U(e)+1)}function a(e,t,n){var i=11==e.nodeType?e.firstChild:e;return j(t)?n==t.length?M.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:G(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),i}function s(e,t,n){if(b(e),b(t),i(t)!=i(e))throw new $("WRONG_DOCUMENT_ERR");var r=q(e.startContainer,e.startOffset,t.endContainer,t.endOffset),o=q(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?0>=r&&o>=0:0>r&&o>0}function l(e){for(var t,n,r,o=i(e.range).createDocumentFragment();n=e.next();){if(t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(r=e.getSubtreeIterator(),n.appendChild(l(r)),r.detach(!0)),10==n.nodeType)throw new $("HIERARCHY_REQUEST_ERR");o.appendChild(n)}return o}function d(e,t,n){var i,r;n=n||{stop:!1};for(var o,a;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1)return void(n.stop=!0);if(a=e.getSubtreeIterator(),d(a,t,n),a.detach(!0),n.stop)return}else for(i=M.createIterator(o);r=i.next();)if(t(r)===!1)return void(n.stop=!0)}function c(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),c(t),t.detach(!0)):e.remove()}function h(e){for(var t,n,r=i(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(h(n)),n.detach(!0)):e.remove(),10==t.nodeType)throw new $("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function u(e,t,n){var i,r=!(!t||!t.length),o=!!n;r&&(i=new RegExp("^("+t.join("|")+")$"));var a=[];return d(new _(e,!1),function(t){if((!r||i.test(t.nodeType))&&(!o||n(t))){var s=e.startContainer;if(t!=s||!j(s)||e.startOffset!=s.length){var l=e.endContainer;t==l&&j(l)&&0==e.endOffset||a.push(t)}}}),a}function p(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+M.inspectNode(e.startContainer)+":"+e.startOffset+", "+M.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function _(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&j(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||j(this.sc)?X(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||j(this.ec)?X(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function f(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function E(e){return function(t,n){for(var i,r=n?t:t.parentNode;r;){if(i=r.nodeType,K(e,i))return r;r=r.parentNode}return null}}function m(e,t){if(oe(e,t))throw new f("INVALID_NODE_TYPE_ERR")}function A(e){if(!e.startContainer)throw new $("INVALID_STATE_ERR")}function v(e,t){if(!K(t,e.nodeType))throw new f("INVALID_NODE_TYPE_ERR")}function F(e,t){if(0>t||t>(j(e)?e.length:e.childNodes.length))throw new $("INDEX_SIZE_ERR")}function g(e,t){if(ie(e,!0)!==ie(t,!0))throw new $("WRONG_DOCUMENT_ERR")}function C(e){if(re(e,!0))throw new $("NO_MODIFICATION_ALLOWED_ERR")}function D(e,t){if(!e)throw new $(t)}function y(e){return Z&&M.isBrokenNode(e)||!K(J,e.nodeType)&&!ie(e,!0)}function w(e,t){return t<=(j(e)?e.length:e.childNodes.length)}function B(e){return!!e.startContainer&&!!e.endContainer&&!y(e.startContainer)&&!y(e.endContainer)&&w(e.startContainer,e.startOffset)&&w(e.endContainer,e.endOffset)}function b(e){if(A(e),!B(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function N(e,t){b(e);var n=e.startContainer,i=e.startOffset,r=e.endContainer,o=e.endOffset,a=n===r;j(r)&&o>0&&o<r.length&&G(r,o,t),j(n)&&i>0&&i<n.length&&(n=G(n,i,t),a?(o-=i,r=n):r==n.parentNode&&o>=U(n)&&o++,i=0),e.setStartAndEnd(n,i,r,o)}function x(e){e.START_TO_START=he,e.START_TO_END=ue,e.END_TO_END=pe,e.END_TO_START=_e,e.NODE_BEFORE=fe,e.NODE_AFTER=Ee,e.NODE_BEFORE_AND_AFTER=me,e.NODE_INSIDE=Ae}function T(e){x(e),x(e.prototype)}function k(e,t){return function(){b(this);var n,i,r=this.startContainer,a=this.startOffset,s=this.commonAncestorContainer,l=new _(this,!0);r!==s&&(n=X(r,s,!0),i=o(n),r=i.node,a=i.offset),d(l,C),l.reset();var c=e(l);return l.detach(),t(this,r,a,r,a),c}}function S(t,i,a){function s(e,t){return function(n){A(this),v(n,Q),v(Y(n),J);var i=(e?r:o)(n);(t?l:d)(this,i.node,i.offset)}}function l(e,t,n){var r=e.endContainer,o=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((Y(t)!=Y(r)||1==q(t,n,r,o))&&(r=t,o=n),i(e,t,n,r,o))}function d(e,t,n){var r=e.startContainer,o=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((Y(t)!=Y(r)||-1==q(t,n,r,o))&&(r=t,o=n),i(e,r,o,t,n))}var u=function(){};u.prototype=e.rangePrototype,t.prototype=new u,P.extend(t.prototype,{setStart:function(e,t){A(this),m(e,!0),F(e,t),l(this,e,t)},setEnd:function(e,t){A(this),m(e,!0),F(e,t),d(this,e,t)},setStartAndEnd:function(){A(this);var e=arguments,t=e[0],n=e[1],r=t,o=n;switch(e.length){case 3:o=e[2];break;case 4:r=e[2],o=e[3]}i(this,t,n,r,o)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(e){b(this),e?i(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):i(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){A(this),m(e,!0),i(this,e,0,e,z(e))},selectNode:function(e){A(this),m(e,!1),v(e,Q);var t=r(e),n=o(e);i(this,t.node,t.offset,n.node,n.offset)},extractContents:k(h,i),deleteContents:k(c,i),canSurroundContents:function(){b(this),C(this.startContainer),C(this.endContainer);var e=new _(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},detach:function(){a(this)},splitBoundaries:function(){N(this)},splitBoundariesPreservingPositions:function(e){N(this,e)},normalizeBoundaries:function(){b(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,o=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,r=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},a=function(i){var o=i.previousSibling;if(o&&o.nodeType==i.nodeType){e=i;var a=i.length;if(t=o.length,i.insertData(0,o.data),o.parentNode.removeChild(o),e==n)r+=t,n=e;else if(n==i.parentNode){var s=U(i);r==s?(n=i,r=a):r>s&&r--}}},s=!0;if(j(n))n.length==r&&o(n);else{if(r>0){var l=n.childNodes[r-1];l&&j(l)&&o(l)}s=!this.collapsed}if(s){if(j(e))0==t&&a(e);else if(t<e.childNodes.length){var d=e.childNodes[t];d&&j(d)&&a(d)}}else e=n,t=r;i(this,e,t,n,r)},collapseToPoint:function(e,t){A(this),m(e,!0),F(e,t),this.setStartAndEnd(e,t)}}),T(t)}function R(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:M.getCommonAncestor(e.startContainer,e.endContainer)}function O(e,t,n,i,r){e.startContainer=t,e.startOffset=n,e.endContainer=i,e.endOffset=r,e.document=M.getDocument(t),R(e)}function I(e){A(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=e.document=null,e.collapsed=e.commonAncestorContainer=null}function L(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,R(this)}var M=e.dom,P=e.util,H=M.DomPosition,$=e.DOMException,j=M.isCharacterDataNode,U=M.getNodeIndex,W=M.isOrIsAncestorOf,V=M.getDocument,q=M.comparePoints,G=M.splitDataNode,X=M.getClosestAncestorIn,z=M.getNodeLength,K=M.arrayContains,Y=M.getRootContainer,Z=e.features.crashyTextNodes;_.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,j(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!j(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return n(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new L(i(this.range));var t=this._current,n=t,r=0,o=t,a=z(t);W(t,this.sc)&&(n=this.sc,r=this.so),W(t,this.ec)&&(o=this.ec,a=this.eo),O(e,n,r,o,a)}return new _(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},f.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},f.prototype.toString=function(){return this.message};var Q=[1,3,4,5,7,8,10],J=[2,9,11],ee=[5,6,10,12],te=[1,3,4,5,7,8,10,11],ne=[1,3,4,5,7,8],ie=E([9,11]),re=E(ee),oe=E([6,10,12]),ae=document.createElement("style"),se=!1;try{ae.innerHTML="<b>x</b>",se=3==ae.firstChild.nodeType}catch(le){}e.features.htmlParsingConforms=se;var de=se?function(e){var t=this.startContainer,n=V(t);if(!t)throw new $("INVALID_STATE_ERR");var i=null;return 1==t.nodeType?i=t:j(t)&&(i=M.parentElement(t)),i=null===i||"HTML"==i.nodeName&&M.isHtmlNamespace(V(i).documentElement)&&M.isHtmlNamespace(i)?n.createElement("body"):i.cloneNode(!1),i.innerHTML=e,M.fragmentFromNodeChildren(i)}:function(e){A(this);var t=i(this),n=t.createElement("body");return n.innerHTML=e,M.fragmentFromNodeChildren(n)},ce=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],he=0,ue=1,pe=2,_e=3,fe=0,Ee=1,me=2,Ae=3;P.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){b(this),g(this.startContainer,t.startContainer);var n,i,r,o,a=e==_e||e==he?"start":"end",s=e==ue||e==he?"start":"end";return n=this[a+"Container"],i=this[a+"Offset"],r=t[s+"Container"],o=t[s+"Offset"],q(n,i,r,o)},insertNode:function(e){if(b(this),v(e,te),C(this.startContainer),W(e,this.startContainer))throw new $("HIERARCHY_REQUEST_ERR");var t=a(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){b(this);var e,t;if(this.collapsed)return i(this).createDocumentFragment();if(this.startContainer===this.endContainer&&j(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=i(this).createDocumentFragment(),t.appendChild(e),t;var n=new _(this,!0);return e=l(n),n.detach(),e},canSurroundContents:function(){b(this),C(this.startContainer),C(this.endContainer);var e=new _(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},surroundContents:function(e){if(v(e,ne),!this.canSurroundContents())throw new f("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);a(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){b(this);for(var e,t=new L(i(this)),n=ce.length;n--;)e=ce[n],t[e]=this[e];return t},toString:function(){b(this);var e=this.startContainer;if(e===this.endContainer&&j(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new _(this,!0);return d(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){b(this);var t=e.parentNode,n=U(e);if(!t)throw new $("NOT_FOUND_ERR");var i=this.comparePoint(t,n),r=this.comparePoint(t,n+1);return 0>i?r>0?me:fe:r>0?Ee:Ae},comparePoint:function(e,t){return b(this),D(e,"HIERARCHY_REQUEST_ERR"),g(e,this.startContainer),q(e,t,this.startContainer,this.startOffset)<0?-1:q(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:de,toHtml:function(){b(this);var e=this.commonAncestorContainer.parentNode.cloneNode(!1);return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(b(this),D(e,"NOT_FOUND_ERR"),V(e)!==i(this))return!1;var n=e.parentNode,r=U(e);D(n,"NOT_FOUND_ERR");var o=q(n,r,this.endContainer,this.endOffset),a=q(n,r+1,this.startContainer,this.startOffset);return t?0>=o&&a>=0:0>o&&a>0},isPointInRange:function(e,t){return b(this),D(e,"HIERARCHY_REQUEST_ERR"),g(e,this.startContainer),q(e,t,this.startContainer,this.startOffset)>=0&&q(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return s(this,e,!1)},intersectsOrTouchesRange:function(e){return s(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=q(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=q(this.endContainer,this.endOffset,e.endContainer,e.endOffset),i=this.cloneRange();return-1==t&&i.setStart(e.startContainer,e.startOffset),1==n&&i.setEnd(e.endContainer,e.endOffset),i}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==q(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==q(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new f("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==Ae},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,z(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var i=n.pop();t.setEnd(i,i.length);var r=this.containsRange(t);return t.detach(),r}return this.containsNodeContents(e)},getNodes:function(e,t){return b(this),u(this,e,t)},getDocument:function(){return i(this)},collapseBefore:function(e){A(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){A(this),this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var n=i(this),r=e.createRange(n);t=t||M.getBody(n),r.selectNodeContents(t);var o=this.intersection(r),a=0,s=0;return o&&(r.setEnd(o.startContainer,o.startOffset),a=r.toString().length,s=a+o.toString().length,r.detach()),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var i,r,o,a,s=[t],l=!1,d=!1;!d&&(i=s.pop());)if(3==i.nodeType)r=n+i.length,!l&&e.start>=n&&e.start<=r&&(this.setStart(i,e.start-n),l=!0),l&&e.end>=n&&e.end<=r&&(this.setEnd(i,e.end-n),d=!0),n=r;else for(a=i.childNodes,o=a.length;o--;)s.push(a[o])},getName:function(){return"DomRange"},equals:function(e){return L.rangesEqual(this,e)},isValid:function(){return B(this)},inspect:function(){return p(this)}}),S(L,O,I),P.extend(L,{rangeProperties:ce,RangeIterator:_,copyComparisonConstants:T,createPrototypeRange:S,inspect:p,getRangeDocument:i,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=L,e.RangeException=f}),rangy.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,i,r=e.dom,o=e.util,a=r.DomPosition,s=e.DomRange,l=r.getBody,d=r.getContentDocument,c=r.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function i(e){for(var t,n=p.length;n--;)t=p[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,n,i,r){var o=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==i||e.endOffset!=r,s=!e.equals(e.nativeRange);(o||a||s)&&(e.setEnd(i,r),e.setStart(t,n))}function c(e){e.nativeRange.detach(),e.detached=!0;for(var t=p.length;t--;)e[p[t]]=null}var h,u,p=s.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,i(this)},s.createPrototypeRange(n,a,c),h=n.prototype,h.selectNode=function(e){this.nativeRange.selectNode(e),i(this)},h.cloneContents=function(){return this.nativeRange.cloneContents()},h.surroundContents=function(e){this.nativeRange.surroundContents(e),i(this)},h.collapse=function(e){this.nativeRange.collapse(e),i(this)},h.cloneRange=function(){return new n(this.nativeRange.cloneRange())},h.refresh=function(){i(this)},h.toString=function(){return this.nativeRange.toString()};var _=document.createTextNode("test");l(document).appendChild(_);var f=document.createRange();f.setStart(_,0),f.setEnd(_,0);try{f.setStart(_,1),h.setStart=function(e,t){this.nativeRange.setStart(e,t),i(this)},h.setEnd=function(e,t){this.nativeRange.setEnd(e,t),i(this)},u=function(e){return function(t){this.nativeRange[e](t),i(this)}}}catch(E){h.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}i(this)},h.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}i(this)},u=function(e,t){return function(n){try{this.nativeRange[e](n);
}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}i(this)}}}h.setStartBefore=u("setStartBefore","setEndBefore"),h.setStartAfter=u("setStartAfter","setEndAfter"),h.setEndBefore=u("setEndBefore","setStartBefore"),h.setEndAfter=u("setEndAfter","setStartAfter"),h.selectNodeContents=function(e){this.setStartAndEnd(e,0,r.getNodeLength(e))},f.selectNodeContents(_),f.setEnd(_,3);var m=document.createRange();m.selectNodeContents(_),m.setEnd(_,4),m.setStart(_,2),-1==f.compareBoundaryPoints(f.START_TO_END,m)&&1==f.compareBoundaryPoints(f.END_TO_START,m)?h.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:h.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var A=document.createElement("div");A.innerHTML="123";var v=A.firstChild,F=l(document);F.appendChild(A),f.setStart(v,1),f.setEnd(v,2),f.deleteContents(),"13"==v.data&&(h.deleteContents=function(){this.nativeRange.deleteContents(),i(this)},h.extractContents=function(){var e=this.nativeRange.extractContents();return i(this),e}),F.removeChild(A),F=null,o.isHostMethod(f,"createContextualFragment")&&(h.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(_),f.detach(),m.detach(),h.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var h=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var i=n.parentElement();n=e.duplicate(),n.collapse(!1);var o=n.parentElement(),a=i==o?i:r.getCommonAncestor(i,o);return a==t?a:r.getCommonAncestor(t,a)},u=function(e){return 0==e.compareEndPoints("StartToEnd",e)},p=function(e,t,n,i,o){var s=e.duplicate();s.collapse(n);var l=s.parentElement();if(r.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var d=new a(l.parentNode,r.getNodeIndex(l));return{boundaryPosition:d,nodeInfo:{nodeIndex:d.offset,containerElement:d.node}}}var h=r.getDocument(l).createElement("span");h.parentNode&&h.parentNode.removeChild(h);for(var u,p,_,f,E,m=n?"StartToStart":"StartToEnd",A=o&&o.containerElement==l?o.nodeIndex:0,v=l.childNodes.length,F=v,g=F;;){if(g==v?l.appendChild(h):l.insertBefore(h,l.childNodes[g]),s.moveToElementText(h),u=s.compareEndPoints(m,e),0==u||A==F)break;if(-1==u){if(F==A+1)break;A=g}else F=F==A+1?A:g;g=Math.floor((A+F)/2),l.removeChild(h)}if(E=h.nextSibling,-1==u&&E&&c(E)){s.setEndPoint(n?"EndToStart":"EndToEnd",e);var C;if(/[\r\n]/.test(E.data)){var D=s.duplicate(),y=D.text.replace(/\r\n/g,"\r").length;for(C=D.moveStart("character",y);-1==(u=D.compareEndPoints("StartToEnd",D));)C++,D.moveStart("character",1)}else C=s.text.length;f=new a(E,C)}else p=(i||!n)&&h.previousSibling,_=(i||n)&&h.nextSibling,f=_&&c(_)?new a(_,0):p&&c(p)?new a(p,p.data.length):new a(l,r.getNodeIndex(h));return h.parentNode.removeChild(h),{boundaryPosition:f,nodeInfo:{nodeIndex:g,containerElement:l}}},_=function(e,t){var n,i,o,a,s=e.offset,d=r.getDocument(e.node),h=l(d).createTextRange(),u=c(e.node);return u?(n=e.node,i=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,i=e.node),o=d.createElement("span"),o.innerHTML="&#feff;",n?i.insertBefore(o,n):i.appendChild(o),h.moveToElementText(o),h.collapse(!t),i.removeChild(o),u&&h[t?"moveStart":"moveEnd"]("character",s),h};if(i=function(e){this.textRange=e,this.refresh()},i.prototype=new s(document),i.prototype.refresh=function(){var e,t,n,i=h(this.textRange);u(this.textRange)?t=e=p(this.textRange,i,!0,!0).boundaryPosition:(n=p(this.textRange,i,!0,!1),e=n.boundaryPosition,t=p(this.textRange,i,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},i.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(i),i.rangeToTextRange=function(e){if(e.collapsed)return _(new a(e.startContainer,e.startOffset),!0);var t=_(new a(e.startContainer,e.startOffset),!0),n=_(new a(e.endContainer,e.endOffset),!1),i=l(s.getRangeDocument(e)).createTextRange();return i.setEndPoint("StartToStart",t),i.setEndPoint("EndToEnd",n),i},e.WrappedTextRange=i,!e.features.implementsDomRange||e.config.preferTextRange){var f=function(){return this}();"undefined"==typeof f.Range&&(f.Range=i),e.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=i}}e.createRange=function(n){return n=d(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=d(e,t,"createRangyRange"),new s(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addCreateMissingNativeApiListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),rangy.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function i(e,n){if(e){if(N.isWindow(e))return e;if(e instanceof m)return e.win;var i=N.getContentDocument(e,t,n);return N.getWindow(i)}return window}function r(e){return i(e,"getWinSelection").getSelection()}function o(e){return i(e,"getDocSelection").document.selection}function a(e){var t=!1;return e.anchorNode&&(t=1==N.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,n){var i=n?"end":"start",r=n?"start":"end";e.anchorNode=t[i+"Container"],e.anchorOffset=t[i+"Offset"],e.focusNode=t[r+"Container"],e.focusOffset=t[r+"Offset"]}function l(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function d(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function c(t){var n;return t instanceof k?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof S?n=t.nativeRange:I.implementsDomRange&&t instanceof N.getWindow(t.startContainer).Range&&(n=t),n}function h(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!N.isAncestorOf(e[0],e[t]))return!1;return!0}function u(e){var n=e.getNodes();if(!h(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function p(e){return!!e&&"undefined"!=typeof e.text}function _(e,t){var n=new S(t);e._ranges=[n],s(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function f(t){if(t._ranges.length=0,"None"==t.docSelection.type)d(t);else{var n=t.docSelection.createRange();if(p(n))_(t,n);else{t.rangeCount=n.length;for(var i,r=M(n.item(0)),o=0;o<t.rangeCount;++o)i=e.createRange(r),i.selectNode(n.item(o)),t._ranges.push(i);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function E(e,n){for(var i=e.docSelection.createRange(),r=u(n),o=M(i.item(0)),a=P(o).createControlRange(),s=0,l=i.length;l>s;++s)a.add(i.item(s));try{a.add(r)}catch(d){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),f(e)}function m(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function A(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function v(e,t){for(var n,i,r=te.length;r--;)if(n=te[r],i=n.selection,"deleteAll"==t)A(i);else if(n.win==e)return"delete"==t?(te.splice(r,1),!0):i;return"deleteAll"==t&&(te.length=0),null}function F(e,n){for(var i,r=M(n[0].startContainer),o=P(r).createControlRange(),a=0,s=n.length;s>a;++a){i=u(n[a]);try{o.add(i)}catch(l){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}o.select(),f(e)}function g(e,t){if(e.win.document!=M(t))throw new R("WRONG_DOCUMENT_ERR")}function C(t){return function(n,i){var r;this.rangeCount?(r=this.getRangeAt(0),r["set"+(t?"Start":"End")](n,i)):(r=e.createRange(this.win.document),r.setStartAndEnd(n,i)),this.setSingleRange(r,this.isBackward())}}function D(e){var t=[],n=new O(e.anchorNode,e.anchorOffset),i=new O(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var o=0,a=e.rangeCount;a>o;++o)t[o]=k.inspect(e.getRangeAt(o));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+i.inspect()+"]"}e.config.checkSelectionRanges=!0;var y,w,B="boolean",b="number",N=e.dom,x=e.util,T=x.isHostMethod,k=e.DomRange,S=e.WrappedRange,R=e.DOMException,O=N.DomPosition,I=e.features,L="Control",M=N.getDocument,P=N.getBody,H=k.rangesEqual,$=T(window,"getSelection"),j=x.isHostObject(document,"selection");I.implementsWinGetSelection=$,I.implementsDocSelection=j;var U=j&&(!$||e.config.preferTextRange);U?(y=o,e.isSelectionValid=function(e){var t=i(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||M(n.createRange().parentElement())==t}):$?(y=r,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=y;var W=y(),V=e.createNativeRange(document),q=P(document),G=x.areHostProperties(W,["anchorNode","focusNode","anchorOffset","focusOffset"]);I.selectionHasAnchorAndFocus=G;var X=T(W,"extend");I.selectionHasExtend=X;var z=typeof W.rangeCount==b;I.selectionHasRangeCount=z;var K=!1,Y=!0,Z=X?function(t,n){var i=k.getRangeDocument(n),r=e.createRange(i);r.collapseToPoint(n.endContainer,n.endOffset),t.addRange(c(r)),t.extend(n.startContainer,n.startOffset)}:null;x.areHostMethods(W,["addRange","getRangeAt","removeAllRanges"])&&typeof W.rangeCount==b&&I.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,i=n>1,r=[],o=a(t),s=0;n>s;++s)r[s]=t.getRangeAt(s);var l=P(document),d=l.appendChild(document.createElement("div"));d.contentEditable="false";var c=d.appendChild(document.createTextNode("")),h=document.createRange();if(h.setStart(c,1),h.collapse(!0),t.addRange(h),Y=1==t.rangeCount,t.removeAllRanges(),!i){var u=h.cloneRange();h.setStart(c,0),u.setEnd(c,3),u.setStart(c,2),t.addRange(h),t.addRange(u),K=2==t.rangeCount,u.detach()}for(l.removeChild(d),t.removeAllRanges(),h.detach(),s=0;n>s;++s)0==s&&o?Z?Z(t,r[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because browser does not support Selection.extend"),t.addRange(r[s])):t.addRange(r[s])}}(),I.selectionSupportsMultipleRanges=K,I.collapsedNonEditableSelectionsSupported=Y;var Q,J=!1;q&&T(q,"createControlRange")&&(Q=q.createControlRange(),x.areHostProperties(Q,["item","add"])&&(J=!0)),I.implementsControlRange=J,w=G?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var ee;T(W,"getRangeAt")?ee=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:G&&(ee=function(t){var n=M(t.anchorNode),i=e.createRange(n);return i.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&i.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),i}),m.prototype=e.selectionPrototype;var te=[],ne=function(e){if(e&&e instanceof m)return e.refresh(),e;e=i(e,"getNativeSelection");var t=v(e),n=y(e),r=j?o(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh()):(t=new m(n,r,e),te.push({win:e,selection:t})),t};e.getSelection=ne,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(N.getIframeWindow(n))};var ie=m.prototype;if(!U&&G&&x.areHostMethods(W,["removeAllRanges","addRange"])){ie.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),d(this)};var re=function(e,t){Z(e.nativeSelection,t),e.refresh()};z?ie.addRange=function(t,i){if(J&&j&&this.docSelection.type==L)E(this,t);else if(n(i)&&X)re(this,t);else{var r;if(K?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(c(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==r+1){if(e.config.checkSelectionRanges){var o=ee(this.nativeSelection,this.rangeCount-1);o&&!H(o,t)&&(t=new S(o))}this._ranges[this.rangeCount-1]=t,s(this,t,se(this.nativeSelection)),this.isCollapsed=w(this)}else this.refresh()}}:ie.addRange=function(e,t){n(t)&&X?re(this,e):(this.nativeSelection.addRange(c(e)),this.refresh())},ie.setRanges=function(e){if(J&&e.length>1)F(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(T(W,"empty")&&T(V,"select")&&J&&U))return t.fail("No means of selecting a Range or TextRange was found"),!1;ie.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=M(this.anchorNode);else if(this.docSelection.type==L){var t=this.docSelection.createRange();t.length&&(e=M(t.item(0)))}if(e){var n=P(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(i){}d(this)},ie.addRange=function(t){this.docSelection.type==L?E(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},ie.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?F(this,e):t&&this.addRange(e[0])}}ie.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new R("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var oe;if(U)oe=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=P(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==L?f(t):p(n)?_(t,n):d(t)};else if(T(W,"getRangeAt")&&typeof W.rangeCount==b)oe=function(t){if(J&&j&&t.docSelection.type==L)f(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,i=t.rangeCount;i>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));s(t,t._ranges[t.rangeCount-1],se(t.nativeSelection)),t.isCollapsed=w(t)}else d(t)};else{if(!G||typeof W.isCollapsed!=B||typeof V.collapsed!=B||!I.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;oe=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=ee(n,0),e._ranges=[t],e.rangeCount=1,l(e),e.isCollapsed=w(e)):d(e)}}ie.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,i=this.anchorOffset;if(oe(this),e){var r=t.length;if(r!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=i)return!0;for(;r--;)if(!H(t[r],this._ranges[r]))return!0;return!1}};var ae=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var i=0,r=n.length;r>i;++i)H(t,n[i])||e.addRange(n[i]);e.rangeCount||d(e)};J?ie.removeRange=function(e){if(this.docSelection.type==L){for(var t,n=this.docSelection.createRange(),i=u(e),r=M(n.item(0)),o=P(r).createControlRange(),a=!1,s=0,l=n.length;l>s;++s)t=n.item(s),t!==i||a?o.add(n.item(s)):a=!0;o.select(),f(this)}else ae(this,e)}:ie.removeRange=function(e){ae(this,e)};var se;!U&&G&&I.implementsDomRange?(se=a,ie.isBackward=function(){return se(this)}):se=ie.isBackward=function(){return!1},ie.isBackwards=ie.isBackward,ie.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},ie.collapse=function(t,n){g(this,t);var i=e.createRange(t);i.collapseToPoint(t,n),this.setSingleRange(i),this.isCollapsed=!0},ie.collapseToStart=function(){if(!this.rangeCount)throw new R("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},ie.collapseToEnd=function(){if(!this.rangeCount)throw new R("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},ie.selectAllChildren=function(t){g(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},ie.deleteFromDocument=function(){if(J&&j&&this.docSelection.type==L){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var i=0,r=n.length;r>i;++i)n[i].deleteContents();this.addRange(n[r-1])}}},ie.eachRange=function(e,t){for(var n=0,i=this._ranges.length;i>n;++n)if(e(this.getRangeAt(n)))return t},ie.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},ie.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},ie.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(i){n.push(i[e].apply(i,t))}),n},ie.setStart=C(!0),ie.setEnd=C(!1),e.rangePrototype.select=function(e){ne(this.getDocument()).setSingleRange(this,e)},ie.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},ie.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)},ie.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},ie.moveToBookmark=function(t){for(var n,i,r=[],o=0;n=t.rangeBookmarks[o++];)i=e.createRange(this.win),i.moveToBookmark(n),r.push(i);t.backward?this.setSingleRange(r[0],"backward"):this.setRanges(r)},ie.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},ie.getName=function(){return"WrappedSelection"},ie.inspect=function(){return D(this)},ie.detach=function(){v(this.win,"delete"),A(this)},m.detachAll=function(){v(null,"deleteAll")},m.inspect=D,m.isDirectionBackward=n,e.Selection=m,e.selectionPrototype=ie,e.addCreateMissingNativeApiListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return ne(e)}),e=null})}),define=e}(),define("external/rangy/rangy-core",function(e){return function(){var t,n;return n=function(){return this.rangy},t=n.apply(e,arguments),t||e.rangy}}(this)),rangy.createModule("SaveRestore",["WrappedRange"],function(e,t){function n(e,t){return(t||document).getElementById(e)}function i(e,t){var n,i="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),r=_.getDocument(e.startContainer),o=e.cloneRange();return o.collapse(t),n=r.createElement("span"),n.id=i,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(r.createTextNode(f)),o.insertNode(n),o.detach(),n}function r(e,i,r,o){var a=n(r,e);a?(i[o?"setStartBefore":"setEndBefore"](a),a.parentNode.removeChild(a)):t.warn("Marker element has been removed. Cannot restore selection.")}function o(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function a(t,n){var r,o,a=e.DomRange.getRangeDocument(t),s=t.toString();return t.collapsed?(o=i(t,!1),{document:a,markerId:o.id,collapsed:!0}):(o=i(t,!1),r=i(t,!0),{document:a,startMarkerId:r.id,endMarkerId:o.id,collapsed:!1,backward:n,toString:function(){return"original text: '"+s+"', new text: '"+t.toString()+"'"}})}function s(i,o){var a=i.document;"undefined"==typeof o&&(o=!0);var s=e.createRange(a);if(i.collapsed){var l=n(i.markerId,a);if(l){l.style.display="inline";var d=l.previousSibling;d&&3==d.nodeType?(l.parentNode.removeChild(l),s.collapseToPoint(d,d.length)):(s.collapseBefore(l),l.parentNode.removeChild(l))}else t.warn("Marker element has been removed. Cannot restore selection.")}else r(a,s,i.startMarkerId,!0),r(a,s,i.endMarkerId,!1);return o&&s.normalizeBoundaries(),s}function l(t,i){var r,s,l=[];t=t.slice(0),t.sort(o);for(var d=0,c=t.length;c>d;++d)l[d]=a(t[d],i);for(d=c-1;d>=0;--d)r=t[d],s=e.DomRange.getRangeDocument(r),r.collapsed?r.collapseAfter(n(l[d].markerId,s)):(r.setEndBefore(n(l[d].endMarkerId,s)),r.setStartAfter(n(l[d].startMarkerId,s)));return l}function d(n){if(!e.isSelectionValid(n))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var i=e.getSelection(n),r=i.getAllRanges(),o=1==r.length&&i.isBackward(),a=l(r,o);return o?i.setSingleRange(r[0],"backward"):i.setRanges(r),{win:n,rangeInfos:a,restored:!1}}function c(e){for(var t=[],n=e.length,i=n-1;i>=0;i--)t[i]=s(e[i],!0);return t}function h(t,n){if(!t.restored){var i=t.rangeInfos,r=e.getSelection(t.win),o=c(i),a=i.length;1==a&&n&&e.features.selectionHasExtend&&i[0].backward?(r.removeAllRanges(),r.addRange(o[0],!0)):r.setRanges(o),t.restored=!0}}function u(e,t){var i=n(t,e);i&&i.parentNode.removeChild(i)}function p(e){for(var t,n=e.rangeInfos,i=0,r=n.length;r>i;++i)t=n[i],t.collapsed?u(e.doc,t.markerId):(u(e.doc,t.startMarkerId),u(e.doc,t.endMarkerId))}var _=e.dom,f="\ufeff";e.util.extend(e,{saveRange:a,restoreRange:s,saveRanges:l,restoreRanges:c,saveSelection:d,restoreSelection:h,removeMarkerElement:u,removeMarkers:p})}),define("external/rangy/rangy-selectionsaverestore",["external/rangy/rangy-core"],function(e){return function(){var t;return t||e.rangy.modules.SaveRestore}}(this)),define("rangy",["external/rangy/rangy-core","external/rangy/rangy-selectionsaverestore"],function(e,t){return e.init(),e}),define("wed/domutil",["require","exports","module","jquery","rangy","./util"],function(e,t,n){"use strict";function i(e,t){for(var n=e.length,i=0;n>i;++i)if(e[i]===t)return i;return-1}function r(e){var t=q.getSelection(e);if(!(void 0===t||t.rangeCount<1))return t.getRangeAt(0)}function o(e,t,n,i){var r=q.createRange(e.ownerDocument),o=!1;return q.dom.comparePoints(e,t,n,i)<=0?(r.setStart(e,t),r.setEnd(n,i)):(r.setStart(n,i),r.setEnd(e,t),o=!0),{range:r,reversed:o}}function a(e){var t=e&&e.nodeType;switch(t){case Node.TEXT_NODE:e.parentNode.focus();break;case Node.ELEMENT_NODE:e.focus();break;default:throw new Error("tried to focus something other than a text node or an element.")}}function s(e,t,n){var r=e[0],o=e[1];void 0===n&&(n=!0);var a,s=!1,l=r.ownerDocument.defaultView;e:for(;!s;)switch(a=r.parentNode,r.nodeType){case Node.TEXT_NODE:if(o>=r.length||a.lastChild===r&&"normal"===l.getComputedStyle(a,null).whiteSpace&&/^\s+$/.test(r.data.slice(o))){if(void 0!==t&&r===t)break e;o=i(a.childNodes,r)+1,r=a}else o++,s=!0;break;case Node.ELEMENT_NODE:if(o>=r.childNodes.length){if(null===a||a===r.ownerDocument||void 0!==t&&r===t)break e;o=i(a.childNodes,r)+1,r=a,s=!0}else r=r.childNodes[o],o=0,r.childNodes.length>0&&r.childNodes[o].nodeType===Node.TEXT_NODE||(s=!0)}return s?(a=r.parentNode,n&&r.nodeType===Node.TEXT_NODE?[a,i(a.childNodes,r)]:[r,o]):null}function l(e,t,n){var r=e[0],o=e[1];void 0===n&&(n=!0);var a,s=!1;e:for(;!s;)switch(o--,a=r.parentNode,r.nodeType){case Node.TEXT_NODE:if(0>o||a.firstChild===r&&"normal"===window.getComputedStyle(a,null).whiteSpace&&/^\s+$/.test(r.data.slice(0,o))){if(void 0!==t&&r===t)break e;o=i(a.childNodes,r),r=a}else s=!0;break;case Node.ELEMENT_NODE:if(0>o||0===r.childNodes.length){if(null===a||a===r.ownerDocument||void 0!==t&&r===t)break e;o=i(a.childNodes,r),r=a,s=!0}else r=r.childNodes[o],r.nodeType===Node.ELEMENT_NODE?(o=r.childNodes.length,r.childNodes.length>0&&r.childNodes[o-1].nodeType===Node.TEXT_NODE||(s=!0)):o=r.length+1}return s?(a=r.parentNode,n&&r.nodeType===Node.TEXT_NODE?[a,i(a.childNodes,r)]:[r,o]):null}function d(e,t,n){for(var r=[],o=n;o!==e;){var a=o.parentNode;if(!a)throw new Error("node_in_a is not tree_a or a child of tree_a");r.unshift(i(a.childNodes,o)),o=a}for(var s=t;r.length;)s=s.childNodes[r.shift()];return s}function c(e){var t=document.createElement("span");return t.className="_placeholder",t.setAttribute("contenteditable","true"),t.innerHTML=e||" ",t}function h(e,t){var n=z(e,t,void 0,!1);return[n[0][0],n[1][0]]}function u(e,t,n){if(!n)throw new Error("must pass an actual node to insert");return p.apply(this,arguments)}function p(e,t,n,r){if(e.nodeType!==Node.TEXT_NODE)throw new Error("insertIntoText called on non-text");var o,a;void 0===r&&(r=!0),0>t?t=0:t>e.length&&(t=e.length);var s,l,d=n&&n.nodeType===Node.DOCUMENT_FRAGMENT_NODE,c=e.parentNode,h=i(c.childNodes,e);if(r&&(!n||d&&0===n.childNodes.length))o=a=[e,t];else{var u=document.createDocumentFragment();s=document.createTextNode(e.data.slice(0,t)),u.appendChild(s),n&&u.appendChild(n),l=document.createTextNode(e.data.slice(t));var p=l.length;if(u.appendChild(l),r&&u.normalize(),o=r&&0===t?[c,h]:[u.firstChild,t],a=r&&t===e.length?[c,h+u.childNodes.length]:[u.lastChild,u.lastChild.length-p],this.deleteNode(e),this.insertFragAt)this.insertFragAt(c,h,u);else for(;u.firstChild;)this.insertNodeAt(c,h++,u.firstChild)}return[o,a]}function _(e,t,n){if(""===n)return[void 0,void 0];var i;e:for(;;)switch(e.nodeType){case Node.ELEMENT_NODE:var r=e.childNodes[t];if(r&&r.nodeType===Node.TEXT_NODE){e=r,t=0;continue e}var o=e.childNodes[t-1];if(o&&o.nodeType===Node.TEXT_NODE){e=o,t=e.length;continue e}i=document.createTextNode(n),this.insertNodeAt(e,t,i),e=void 0;break e;case Node.TEXT_NODE:var a=e.data.slice(0,t),s=e.data.slice(t);this.setTextNodeValue(e,a+n+s),i=e;break e;default:throw new Error("unexpected node type: "+e.nodeType)}return[e,i]}function f(e,t,n){if(e.nodeType!==Node.TEXT_NODE)throw new Error("deleteText called on non-text");e.deleteData(t,n),e.length||e.parentNode.removeChild(e)}function E(e,t){if(V.data(e,"wed_mirror_node",t),V.data(t,"wed_mirror_node",e),e.nodeType===Node.ELEMENT_NODE)for(var n=0;n<e.childNodes.length;++n){var i=e.childNodes[n],r=t.childNodes[n];E(i,r)}}function m(e){if(V.removeData(e,"wed_mirror_node"),e.nodeType===Node.ELEMENT_NODE)for(var t=0;t<e.childNodes.length;++t)m(e.childNodes[t])}function A(e){for(;e&&e.childNodes&&e.childNodes.length;)e=e.firstChild;return e}function v(e){e.parentNode.removeChild(e)}function F(e,t,n){e.insertBefore(n,e.childNodes[t]||null)}function g(e){var t=e.nextSibling;if(e.nodeType===Node.TEXT_NODE&&t&&t.nodeType===Node.TEXT_NODE){var n=e.length;return e.appendData(t.data),t.parentNode.removeChild(t),[e,n]}var r=e.parentNode;return[r,i(r.childNodes,e)+1]}function C(e,t){if(!y({startContainer:e[0],startOffset:e[1],endContainer:t[0],endOffset:t[1]}))throw new Error("range is not well-formed");var n,r,o=e[0],a=e[1],s=t[0],l=t[1],d=o.parentNode;if(o.nodeType===Node.TEXT_NODE&&0===a&&(a=i(d.childNodes,o),o=d,d=o.parent),o.nodeType===Node.TEXT_NODE){var c=o===s,h=i(d.childNodes,o),u=c?l:o.length;if(r=d.ownerDocument.createTextNode(o.data.slice(a,u)),this.deleteText(o,a,r.length),n=o.parentNode?[o,a]:[d,h],c)return[n,[r]];a=o.parentNode?h+1:h,o=d}else n=[o,a];var p;if(s.nodeType===Node.TEXT_NODE){d=s.parentNode;var _=i(d.childNodes,s);p=d.ownerDocument.createTextNode(s.data.slice(0,l)),this.deleteText(s,0,l),l=_,s=d}if(o!==s)throw new Error("internal error in cut: containers unequal");if(o.nodeType!==Node.ELEMENT_NODE)throw new Error("internal error in cut: not an element");var f=[];for(l--;l>=a;)f.unshift(s.childNodes[l]),this.deleteNode(s.childNodes[l]),l--;return r&&f.unshift(r),p&&f.push(p),s.childNodes[l]&&this.mergeTextNodes(s.childNodes[l]),[n,f]}function D(e){var t;switch(e.startContainer.nodeType){case Node.TEXT_NODE:t=e.startContainer.parentNode;break;case Node.ELEMENT_NODE:t=e.startContainer;break;default:throw new Error("unexpected node type: "+e.startContainer.nodeType)}var n;switch(e.endContainer.nodeType){case Node.TEXT_NODE:n=e.endContainer.parentNode;break;case Node.ELEMENT_NODE:n=e.endContainer;break;default:throw new Error("unexpected node type: "+e.endContainer.nodeType)}return[t,n]}function y(e){var t=D(e);return t[0]===t[1]}function w(e,t){B(e,r(t))}function B(e,t){t?console.log(e,t.startContainer,t.startOffset,t.endContainer,t.endOffset):console.log(e,"no range")}function b(e,t){var n;return n=t?[e,t.startContainer.outerHTML,t.startOffset,t.endContainer.outerHTML,t.endOffset]:[e,"no range"],n.join(", ")}function N(e,t,n){var i=e.ownerDocument.body,r=e.getBoundingClientRect();return t-=r.left+i.scrollLeft,n-=r.top+i.scrollTop,t>=0&&n>=0&&t<e.clientWidth&&n<e.clientHeight}function x(e,t,n){if(void 0===e||null===e)return null;for(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode);e;){if(e.nodeType!==Node.ELEMENT_NODE)return null;if(e.matches(t))break;if(e===n){e=null;break}e=e.parentNode}return e}function T(e,t,n){if(void 0===e||null===e)return null;for(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode);e;){if(e.nodeType!==Node.ELEMENT_NODE)return null;if(e.classList.contains(t))break;if(e===n){e=null;break}e=e.parentNode}return e}function k(e,t){if(void 0===e||null===e||e.nodeType!==Node.ELEMENT_NODE)return null;var n=e.parentNode;if(!n)return null;for(var i=n.firstElementChild;i&&!i.classList.contains(t);)i=i.nextElementSibling;return i}function S(e,t){if(void 0===e||null===e||e.nodeType!==Node.ELEMENT_NODE)return[];for(var n=[],i=e.firstElementChild;i;)i.classList.contains(t)&&n.push(i),i=i.nextElementSibling;return n}function R(e,t){if(void 0===e||null===e||e.nodeType!==Node.ELEMENT_NODE)return null;for(var n=e.firstElementChild;n&&!n.classList.contains(t);)n=n.nextElementSibling;return n}function O(e){return W||(W=document.createElement("span")),W.textContent=e,W.innerHTML}function I(e){if(/[\]['"()]/.test(e))throw new Error("selector is too complex");for(var t=e.split(Q),n=[],i=0;i<t.length;++i){var r=t[i];if(r.length)if(Z.indexOf(r)>-1)n.push(r);else if(/[a-zA-Z]/.test(r[0])){r=r.trim();var o=r.split(/(.#)/);n.push(G.classFromOriginalName(o[0])),n=n.concat(o.slice(1))}else n.push(r)}return n.join("")}function L(e,t){var n=I(t),i=V.data(e,"wed_mirror_node"),r=i.querySelector(n);return V.data(r,"wed_mirror_node")}function M(e,t){for(var n,i=I(t),r=V.data(e,"wed_mirror_node"),o=r.querySelectorAll(i),a=[],s=0;n=o[s];++s)a.push(V.data(n,"wed_mirror_node"));return a}function P(e,t){var n=t||window.document,i=n.createDocumentFragment(),r=n.createElement("div");return i.appendChild(r),r.innerHTML=e,Array.prototype.slice.call(r.childNodes)}function H(e){var t=e[0],n=e[1];switch(t.nodeType){case Node.TEXT_NODE:var i=t.data;return i[n-1];case Node.ELEMENT_NODE:var r=t[n-1];if(r&&r.nodeType===Node.TEXT_NODE)return r.value[r.value-1];break;default:throw new Error("unexpected node type: "+t.nodeType)}}function $(e){var t=e[0],n=e[1];switch(t.nodeType){case Node.TEXT_NODE:var i=t.data;return i[n];case Node.ELEMENT_NODE:var r=t[n];if(r&&r.nodeType===Node.TEXT_NODE)return r.value[0];break;default:throw new Error("unexpected node type: "+t.nodeType)}}function j(e,t){for(var n=e.ownerDocument.defaultView;e&&e!==t;){if("none"===e.style.display)return!0;var i=n.getComputedStyle(e).getPropertyValue("display");if("none"===i)return!0;e=e.parentNode}return!1}function U(e){var t=Node.ATTRIBUTE_NODE;return e instanceof Attr||void 0!==t&&e.nodeType===t}var W,V=e("jquery"),q=e("rangy"),G=e("./util"),X={insertNodeAt:F,insertFragAt:F,deleteNode:v},z=p.bind(X),K=u.bind(X),Y=_.bind({insertNodeAt:F,setTextNodeValue:function(e,t){e.data=t}}),Z=",>+~ ",Q=new RegExp("(["+Z+"]+)");t.getSelectionRange=r,t.nextCaretPosition=s,t.prevCaretPosition=l,t.makePlaceholder=c,t.splitTextNode=h,t.insertIntoText=K,t.insertText=Y,t.deleteText=f,t.linkTrees=E,t.unlinkTree=m,t.firstDescendantOrSelf=A,t.isWellFormedRange=y,t.genericCutFunction=C,t.genericInsertIntoText=u,t.genericInsertText=_,t.deleteNode=v,t.mergeTextNodes=g,t.rangeFromPoints=o,t.focusNode=a,t.dumpCurrentSelection=w,t.dumpRange=B,t.dumpRangeToString=b,t.pointInContents=N,t.correspondingNode=d,t.closest=x,t.closestByClass=T,t.siblingByClass=k,t.childrenByClass=S,t.childByClass=R,t.textToHTML=O,t.toGUISelector=I,t.dataFind=L,t.dataFindAll=M,t.htmlToElements=P,t.getCharacterImmediatelyAt=$,t.getCharacterImmediatelyBefore=H,t.isNotDisplayed=j,t.indexOf=i,t.isAttr=U}),define("wed/oop",["require","exports","module"],function(e,t,n){"use strict";function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e;
}function r(e,t){var n=void 0!==t.prototype?t.prototype:t;for(var i in n)e.prototype[i]=n[i]}t.inherit=i,t.implement=r}),define("wed/undo",["require","exports","module","./oop"],function(e,t,n){"use strict";function i(){this._stack=[],this._list=[],this._index=-1,this._undoing_or_redoing=!1}function r(e){this._desc=e}function o(){r.apply(this,arguments),this._list=[]}var a=e("./oop");i.prototype.record=function(e){this._stack.length>0?this._stack[0].record(e):(this._list=this._list.splice(0,this._index+1),this._list.push(e),this._index++)},i.prototype.undo=function(){if(this._undoing_or_redoing)throw new Error("calling undo while undoing or redoing");for(this._undoing_or_redoing=!0;this._stack.length>0;)this.endGroup();this._index>=0&&this._list[this._index--].undo(),this._undoing_or_redoing=!1},i.prototype.redo=function(){if(this._undoing_or_redoing)throw new Error("calling redo while undoing or redoing");this._undoing_or_redoing=!0,this._index<this._list.length-1&&this._list[++this._index].redo(),this._undoing_or_redoing=!1},i.prototype.undoingOrRedoing=function(){return this._undoing_or_redoing},i.prototype.canUndo=function(){return this._index>-1},i.prototype.canRedo=function(){return this._index<this._list.length-1},i.prototype.startGroup=function(e){this._stack.unshift(e)},i.prototype.endGroup=function(){if(0===this._stack.length)throw new Error("ending a non-existent group.");var e=this._stack.shift();e.end(),this.record(e)},i.prototype.endAllGroups=function(){for(;this._stack.length>0;)this.endGroup()},i.prototype.getGroup=function(){return this._stack[0]},i.prototype.toString=function(){var e=[];e.push("Start of list\n");for(var t,n=0;void 0!==(t=this._list[n]);++n)e.push(t.toString());for(e.push("End of list\n"),e.push("Unfinished groups:\n"),n=this._stack.length-1;void 0!==(t=this._stack[n]);--n)e.push(t.toString());return e.push("End of unfinished groups\n"),e.join("")},t.UndoList=i,r.prototype.undo=function(){throw new Error("must override the undo method.")},r.prototype.redo=function(){throw new Error("must override the redo method.")},r.prototype.toString=function(){return this._desc+"\n"},t.Undo=r,a.inherit(o,r),o.prototype.undo=function(){for(var e=this._list.length-1;e>=0;--e)this._list[e].undo()},o.prototype.redo=function(){for(var e=0;e<this._list.length;++e)this._list[e].redo()},o.prototype.record=function(e){this._list.push(e)},o.prototype.end=function(){},o.prototype.toString=function(){var e=[];e.push("Start of ",this._desc,"\n");for(var t,n=0;void 0!==(t=this._list[n]);++n)e.push(t.toString().replace(/(^|\n)/g,"$1 ").slice(0,-1));return e.push("End of ",this._desc,"\n"),e.join("")},t.UndoGroup=o}),define("wed/wundo",["require","exports","module","./oop","./undo","./domutil"],function(e,t,n){"use strict";function i(e,t){s.UndoGroup.call(this,e),this._editor=t,this._caret_as_path_before=this.getDataCaretAsPath()}function r(e,t,n,r){i.call(this,e,t),this._undo_list=n,this._limit=r}function o(e){s.Undo.call(this,"*** MARKER *** "+e)}var a=e("./oop"),s=e("./undo");e("./domutil");a.inherit(i,s.UndoGroup),i.prototype.undo=function(){s.UndoGroup.prototype.undo.apply(this,arguments),this.setDataCaretAsPath(this._caret_as_path_before)},i.prototype.redo=function(){s.UndoGroup.prototype.redo.apply(this,arguments),this.setDataCaretAsPath(this._caret_as_path_after)},i.prototype.getDataCaretAsPath=function(){var e=this._editor.getDataCaret(!0);return e?[this._editor.data_updater.nodeToPath(e.node),e.offset]:[void 0,void 0]},i.prototype.setDataCaretAsPath=function(e){(e[0]||e[1])&&this._editor.setDataCaret(this._editor.data_updater.pathToNode(e[0]),e[1])},i.prototype.recordCaretAfter=function(){this._caret_as_path_after=this.getDataCaretAsPath()},i.prototype.end=function(){this._caret_as_path_after||this.recordCaretAfter()},t.UndoGroup=i,a.inherit(r,i),r.prototype.record=function(){if(this._list.length>=this._limit)throw new Error("TextUndoGroup.record called beyond the limit");s.UndoGroup.prototype.record.apply(this,arguments),this._list.length===this._limit&&this._undo_list.endGroup()},t.TextUndoGroup=r,a.inherit(o,s.Undo),o.prototype.undo=function(){},o.prototype.redo=function(){},t.MarkerUndo=o}),define("wed/lib/simple_event_emitter",["require","exports","module"],function(e,t,n){"use strict";function i(){this._event_listeners={},this._simple_event_emitter_trace=!1}i.prototype.addEventListener=function(e,t){var n=this._event_listeners[e];void 0===n&&(n=this._event_listeners[e]=[]),n.push(t)},i.prototype.addOneTimeEventListener=function(e,t){var n=function(i){return this.removeEventListener(e,n),t(i)}.bind(this);return this.addEventListener(e,n),n},i.prototype.removeEventListener=function(e,t){var n=this._event_listeners[e];if(void 0!==n){var i=n.lastIndexOf(t);-1!==i&&n.splice(i,1)}},i.prototype.removeAllListeners=function(e){this._event_listeners[e]=[]},i.prototype._emit=function(e,t){this._simple_event_emitter_trace&&console.log("simple_event_emitter emitting:",e,"with:",t);var n,i,r=this._event_listeners["*"];if(r&&r.length>0)for(r=r.slice(),n=0;n<r.length;++n)if(i=r[n](e,t),i===!1)return;if(r=this._event_listeners[e],r&&r.length>0)for(r=r.slice(),n=0;n<r.length;++n)if(i=r[n](t),i===!1)return},t.SimpleEventEmitter=i}),define("wed/lib/conditioned",["require","exports","module"],function(e,t,n){"use strict";function i(){this._conditions={}}i.prototype._setCondition=function(e,t){void 0===this._conditions[e]&&(this._conditions[e]=!0,this._emit(e,t))},i.prototype.getCondition=function(e){return this._conditions[e]},i.prototype.whenCondition=function(e,t){this._conditions[e]?t():this.addOneTimeEventListener(e,t)},t.Conditioned=i}),define("wed/exceptions",["require","exports","module","./oop"],function(e,t,n){"use strict";function i(){Error.apply(this,arguments)}var r=e("./oop");r.inherit(i,Error),t.AbortTransformationException=i}),define("wed/onerror",["require","exports","module","./util","optional!./config","./log","jquery"],function(e,t,n){"use strict";function i(){C=!1,A&&(v.clearTimeout(A),A=void 0),m.off(),m.remove()}function r(){return C}function o(e,t){E(document.body).append(m),m.find(".save-messages")[0].innerHTML=e,m.find(".error-message")[0].textContent=t,m.on("hide.bs.modal.modal",function(){m.remove(),window.location.reload()}),m.modal()}function a(e){function t(){if(A&&c.clearTimeout(A),1===r)s.push(l(void 0,a[0]?a[0][1]:void 0));else for(var e,t=0;void 0!==(e=a[t]);++t)s.push(l(F[e[0]].name,e[1]));o(s.join(""),i)}function n(e){a.push([this,e]),a.length===r&&t()}if(e.preventDefault(),C)return!1;C=!0;var i=d(e),r=F.length,a=[],s=[],c=window;A=c.setTimeout(t,g),v=c,f.error(i);for(var h,u=0;void 0!==(h=F[u]);++u){var p=h._saver;try{p&&p.recover(n.bind(u))}catch(_){a.push([u,void 0])}}return!1}function s(e){try{try{a(e)}catch(t){o("","Error while trying to handle fatal error: "+t.toString())}}catch(t){console.error("Error while trying to handle fatal error:"),console.error(t)}}function l(e,t){var n=["<p>",e||"Your editor"];switch(n.push(" experienced a severe error."),t){case!0:n.push(" However, it successfully saved the latest state of your data to the server. Please reload.");break;case!1:case void 0:n.push(" It was not able to save your data to the server before terminating.")}return n.push("</p>"),n.join("")}function d(e){var t="";if("error"===e.type){var n=e.message,i=e.filename,r=e.lineno,o=e.colno,a=e.error;a?t=a.stack:(t=i+":"+r,o&&(t+="."+o),t+=": "+n)}else{t+="Unhandled promise rejection!\n";var s,l,d=e.promise?e:e.detail;d&&(s=d.reason,l=d.promise),s?(t+="Reason: ",t+=s.stack?"\n"+s.stack:s):l&&(t+="Promise: "+l)}return t}var c=e("./util"),h=e("optional!./config"),u=c.grabConfig(n,h),p=u.config;"module"!==u.from&&(p={test:p.test});var _=p&&p.test,f=e("./log"),E=e("jquery"),m=E('<div class="modal wed-fatal-modal" style="position: absolute" tabindex="1">  <div class="modal-dialog">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal"aria-hidden="true">&times;</button>        <h3>Fatal Error</h3>      </div>      <div class="modal-body">        <div class="save-messages"></div>        <div class="error-message"></div>      </div>      <div class="modal-footer">        <a href="#" class="btn btn-primary" data-dismiss="modal">Reload</a>      </div>    </div>  </div></div>');t.is_terminating=r,_&&(t.__test={$modal:m,reset:i});var A,v,F=[],g=5e3,C=!1;t.handler=s,t.editors=F}),define("wed/browsers",["require","exports","module"],function(e,t,n){"use strict";var i=-1!==navigator.userAgent.indexOf(" Chrome/");t.CHROME=i;var r=-1!==navigator.userAgent.indexOf(" MSIE ");t.MSIE_TO_10=r;var o=" like Gecko",a=-1!==navigator.userAgent.indexOf(o,navigator.userAgent.length-o.length);t.MSIE_11_AND_UP=a;var s=a||r;t.MSIE=s;var l=-1!==navigator.userAgent.indexOf(" Firefox/");t.FIREFOX=l;var d=-1!==navigator.userAgent.indexOf(" Firefox/24");t.FIREFOX_24=d;var c=-1!==navigator.userAgent.indexOf(" Gecko/");t.GECKO=c;var h=0===navigator.platform.lastIndexOf("Mac",0);t.OSX=h;var u="Win32"===navigator.platform;t.WINDOWS=u}),define("wed/key",["require","exports","module","./browsers"],function(e,t,n){"use strict";function i(e,t,n,r,o,a,s){t=!!t,o=!!o,a=!!a,s=!!s;var l=[e,n,r,o,a,s,t].join(","),c=i.__cache[l];return void 0!==c?c:(this.which=e,this.keyCode=n,this.charCode=r,this.ctrlKey=o,this.altKey=a,this.metaKey=s,this.keypress=t,this.hash_key=l,this._id=d++,i.__cache[l]=this,this)}function r(e){return s(e,!1,void 0,void 0,!0,!1,!1)}function o(e){return s(e,!1,void 0,void 0,!1,!1,!0)}function a(e){return l.OSX?o(e):r(e)}function s(e,t,n,r,o,a,s){if("string"==typeof e){if(1!==e.length)throw new Error("when the first parameter is a string, a one-character string is required");e=e.charCodeAt(0)}else if("number"!=typeof e)throw new Error("the first parameter must be a string or number");return t=void 0===t?!0:!!t,(void 0===n||null===n)&&(n=t&&l.GECKO?0:e),(void 0===r||null===r)&&(r=t?e:0),o=!!o,a=!!a,s=!!s,new i(e,t,n,r,o,a,s)}var l=e("./browsers"),d=0;i.__cache={},i.prototype.matchesEvent=function(e){return e.which===this.which&&e.keyCode===this.keyCode&&e.charCode===this.charCode&&e.ctrlKey===this.ctrlKey&&e.altKey===this.altKey&&e.metaKey===this.metaKey&&(this.keypress?"keypress"===e.type:"keydown"===e.type||"keyup"===e.type)},i.prototype.setEventToMatch=function(e){e.which=this.which,e.keyCode=this.keyCode,e.charCode=this.charCode,e.ctrlKey=this.ctrlKey,e.altKey=this.altKey,e.metaKey=this.metaKey,this.keypress?e.type="keypress":e.type="keydown"},i.prototype.hash=function(){return this._id},i.prototype.anyModifier=function(){return this.ctrlKey||this.altKey||this.metaKey},t.makeKey=s,t.makeCtrlKey=r,t.makeMetaKey=o,t.makeCtrlEqKey=a,t.Key=i}),define("wed/wed_core",["require","exports","module","jquery","./log","./domutil","./oop","./wundo","./lib/simple_event_emitter","./lib/conditioned","./exceptions","./onerror","./key","bootstrap","jquery.bootstrap-growl"],function(e,t,n){"use strict";function i(){c.call(this),h.call(this),this._mode_data={},this._development_mode=!1,this._text_undo_max_length=10,p.editors.push(this)}var r=e("jquery"),o=e("./log"),a=e("./domutil"),s=a.isAttr,l=e("./oop"),d=e("./wundo"),c=e("./lib/simple_event_emitter").SimpleEventEmitter,h=e("./lib/conditioned").Conditioned,u=e("./exceptions"),p=e("./onerror"),_=(e("./key"),u.AbortTransformationException);e("bootstrap"),e("jquery.bootstrap-growl");var f=a.closestByClass;t.version="0.27.0";t.version;l.implement(i,c),l.implement(i,h),i.prototype.fireTransformation=function(e,t){this._dismissDropdownMenu();var n=this._undo.getGroup();n instanceof d.TextUndoGroup&&this._undo.endGroup();var i=new d.UndoGroup("Undo "+e.getDescriptionFor(t),this);this._undo.startGroup(i),this._inhibitFakeCaret();try{try{this._fireTransformation(e,t)}catch(r){throw r instanceof _||o.handle(r),r}finally{do n=this._undo.getGroup(),this._undo.endGroup();while(n!==i)}}catch(r){if(this.undo(),!(r instanceof _))throw r}finally{this._uninhibitFakeCaret(),this._refreshValidationErrors()}},i.prototype._fireTransformation=function(e,t){var n=t.node;if(void 0!==n)if(this.gui_root.contains(n)){var i=this.nodeToPath(n);t.node=this.data_updater.pathToNode(i)}else{var r=s(n)?n.ownerElement:n;if(!this.data_root.contains(r))throw new Error("node is neither in the gui tree nor the data tree")}var o=t.move_caret_to;if(o)switch(o.root){case this.gui_root:this.setGUICaret(o);break;case this.data_root:this.setDataCaret(o);break;default:throw new Error("caret outside GUI and data trees")}if(void 0===this._sel_focus)throw new Error("transformation applied with undefined caret.");e.handler(this,t)},i.prototype.recordUndo=function(e){this._undo.record(e)},i.prototype.undo=function(){this._undo_recorder.suppressRecording(!0),this._undo.undo(),this._undo_recorder.suppressRecording(!1)},i.prototype.redo=function(){this._undo_recorder.suppressRecording(!0),this._undo.redo(),this._undo_recorder.suppressRecording(!1)},i.prototype.dumpUndo=function(){console.log(this._undo.toString())},i.prototype.undoMarker=function(e){this.recordUndo(new d.MarkerUndo(e))},i.prototype.undoingOrRedoing=function(){return this._undo.undoingOrRedoing()},i.prototype.isAttrProtected=function(e,t){var n;if(e instanceof this.my_window.Attr)n=e.name;else if(e instanceof this.my_window.Element)n=a.siblingByClass(e,"_attribute_name").textContent;else if("string"==typeof e&&(n=e,!t))throw new Error("must specify a parent");return"xmlns"===n||0===n.lastIndexOf("xmlns:",0)},i.prototype.save=function(e){this._saver.save(e)},i.prototype._initiateTextUndo=function(){var e=this._undo.getGroup();return void 0!==e&&e instanceof d.TextUndoGroup||(e=new d.TextUndoGroup("text",this,this._undo,this._text_undo_max_length),this._undo.startGroup(e)),e},i.prototype._terminateTextUndo=function(){var e=this._undo.getGroup();e instanceof d.TextUndoGroup&&this._undo.endGroup()},i.prototype._normalizeEnteredText=function(e){return this._normalize_entered_spaces?e.replace(this._stripped_spaces,"").replace(this._replaced_spaces," "):e},i.prototype._compensateForAdjacentSpaces=function(e,t){if(!this._normalize_entered_spaces)return e;var n=t.toArray();return" "===e[0]&&" "===a.getCharacterImmediatelyBefore(n)&&(e=e.slice(1)),e&&" "===e[e.length-1]&&" "===a.getCharacterImmediatelyAt(n)&&(e=e.slice(-1)),e},i.prototype._insertText=function(e){if(this._closeAllTooltips(),e=this._normalizeEnteredText(e),""!==e){var t=this._sel_focus;if(void 0!==t){var n=f(t.node,"_real",this.gui_root);if(n&&!n.classList.contains("_readonly")){var i=f(t.node,"_attribute_value",this.gui_root);if(i)this._spliceAttribute(i,t.offset,0,e);else{if(t=this.getDataCaret(),e=this._compensateForAdjacentSpaces(e,t),""===e)return;var r=this._initiateTextUndo(),o=this.data_updater.insertText(t,e),a=o[0];if(void 0===a)this.setDataCaret(o[1],e.length,!0);else{var s;s=a===t.node?t.offset+e.length:t.node.childNodes[t.offset]===a?e.length:a.nodeValue.length,this.setDataCaret(a,s,!0)}r.recordCaretAfter()}this._refreshValidationErrors()}}}},i.prototype._spliceAttribute=function(e,t,n,i){if(!(0>t||this.isAttrProtected(e))){var o=this.toDataNode(e).value;if(!(t>o.length||t===o.length&&n>0)){this._normalize_entered_spaces&&(" "===i[0]&&" "===o[t-1]&&(i=i.slice(1))," "===i[i.length-1]&&" "===o[t+n]&&(i=i.slice(-1)));var s=this._initiateTextUndo();o=o.slice(0,t)+i+o.slice(t+n),t+=i.length;var l=r.data(f(e,"_real"),"wed_mirror_node"),d=this.nodeToPath(e),c=a.siblingByClass(e,"_attribute_name").textContent,h=this.resolver.resolveName(c,!0);this.data_updater.setAttributeNS(l,h.ns,h.name,o);var u=this.pathToNode(d);u.firstChild&&(u=u.firstChild),this._setGUICaret(u,t,"text_edit"),s.recordCaretAfter()}}},i.prototype.insertTransientPlaceholderAt=function(e){var t=r("<span class='_placeholder _transient' contenteditable='false'> </span>",e.node.ownerDocument)[0];return this._gui_updater.insertNodeAt(e,t),t},i.prototype.toDataNode=function(e){if(e.nodeType===Node.ELEMENT_NODE){var t=r.data(e,"wed_mirror_node");if(t)return t}return this.data_updater.pathToNode(this.nodeToPath(e))},i.prototype._onSaverSaved=function(){r.bootstrapGrowl("Saved",{ele:"body",type:"success",align:"center"}),this._refreshSaveStatus(),this._emit("saved")},i.prototype._onSaverAutosaved=function(){r.bootstrapGrowl("Autosaved",{ele:"body",type:"success",align:"center"}),this._refreshSaveStatus(),this._emit("autosaved")},i.prototype._onSaverChanged=function(){this._refreshSaveStatus()},i.prototype._onSaverFailed=function(e){this._refreshSaveStatus();var t=this;"save_disconnected"===e.type?this._disconnect_modal.modal(function(){t.save()}):"save_edited"===e.type?this._edited_by_other_modal.modal(function(){t.my_window.location.reload()}):r.bootstrapGrowl("Failed to save!\n"+e.msg,{ele:"body",type:"danger",align:"center"})},i.prototype._onSaverTooOld=function(){this._too_old_modal.modal(this.my_window.location.reload.bind(this.my_window.location))},i.prototype.nodeToPath=function(e){return this.gui_dloc_root.nodeToPath(e)},i.prototype.pathToNode=function(e){return this.gui_dloc_root.pathToNode(e)},i.prototype.getModeData=function(e){return this._mode_data[e]},i.prototype.setModeData=function(e,t){this._mode_data[e]=t},i.prototype.destroy=function(){if(this._destroying=!0,!this._destroyed){var e=p.editors.indexOf(this);e>=0&&p.editors.splice(e,1),this._saver&&this._saver.setAutosaveInterval(0),this._save_status_interval&&clearInterval(this._save_status_interval),this._process_validation_errors_timeout&&clearTimeout(this._process_validation_errors_timeout);try{this.validator&&this.validator.stop()}catch(t){o.unhandled(t)}try{void 0!==this.domlistener&&(this.domlistener.stopListening(),this.domlistener.clearPending())}catch(t){o.unhandled(t)}this._current_dropdown&&this._current_dropdown.dismiss();try{this.$widget.empty(),this.$frame.find("*").off(".wed"),r(this.my_window).off(".wed")}catch(t){o.unhandled(t)}for(var n,i=Object.keys(this),a=0;void 0!==(n=i[a]);++a)delete this[n];this._destroyed=!0,this.destroy=function(){}}},t.Editor=i}),define("wed/dloc",["require","exports","module","jquery","rangy","./domutil","./oop"],function(e,t,n){"use strict";function i(){throw new Error("use makeDLoc to create DLoc objects")}function r(e){var t;if(p(e))t=e.value.length;else switch(e.nodeType){case Node.TEXT_NODE:t=e.data.length;break;case Node.ELEMENT_NODE:t=e.childNodes.length;break;default:throw new Error("unexpected node type")}return t}function o(e,t,n){this.root=e,this.node=t,this.offset=n}function a(e,t,n,i){if(t instanceof Array&&(i=n,n=t[1],t=t[0]),t){if(0>n){if(!i)throw new Error("negative offsets are not allowed");n=0}if(e instanceof d)e=e.node;else if(!c.data(e,"wed-dloc-root"))throw new Error("root has not been marked as a root: "+e);if(p(t)){if(!e.contains(t.ownerElement))throw new Error("node not in root")}else if(!e.contains(t))throw new Error("node not in root");var a=r(t);if(n>a){if(!i)throw new Error("offset greater than allowable value");n=a}return new o(e,t,n)}}function s(e){for(;e;){var t=c.data(e,"wed-dloc-root");if(t)return t;e=e.parentNode}}function l(e){var t=s(e);if(!t)throw new Error("no root found");return t}function d(e){if(c.data(e,"wed-dloc-root"))throw new Error("node already marked as root");c.data(e,"wed-dloc-root",this),this.node=e}var c=e("jquery"),h=e("rangy"),u=e("./domutil"),p=u.isAttr,_=e("./oop");i.prototype.clone=function(){return new o(this.root,this.node,this.offset)},i.prototype.make=function(e,t){return a(this.root,e,t)},i.prototype.toArray=function(){return[this.node,this.offset]},i.prototype.makeRange=function(e){if(p(this.node))throw new Error("cannot make range from attribute node");if(e){if(p(e.node))throw new Error("cannot make range from attribute node");return u.rangeFromPoints(this.node,this.offset,e.node,e.offset)}var t=h.createRange(this.node.ownerDocument);return t.setStart(this.node,this.offset),t},i.prototype.isValid=function(){var e=this.node;return this.root.contains(p(e)?e.ownerElement:e)&&this.offset<=r(e)},i.prototype.normalizeOffset=function(){var e=this.node,t=r(e);return this.offset>t?this.make(e,t):this},_.inherit(o,i),d.prototype.nodeToPath=function(e){if(null===e||void 0===e)throw new Error("invalid node parameter");var t=this.node;if(t===e)return"";var n=e;if(p(e)&&(n=e.ownerElement),!t.contains(n))throw new Error("node is not a descendant of root");for(var i=[];e!==t;){var r;if(p(e))r=e.ownerElement,i.unshift("@"+e.name);else{var o=0;r=e.parentNode;for(var a=e.previousSibling;a;){var s=a.nodeType;(s===Node.TEXT_NODE||s===Node.ELEMENT_NODE)&&o++,a=a.previousSibling}i.unshift(""+o)}e=r}return i.join("/")},d.prototype.pathToNode=function(e){var t=this.node;if(""===e)return t;var n,i=e.split(/\//),r=t;"@"===i[i.length-1][0]&&(n=i.pop());for(var o,a=0;void 0!==(o=i[a]);++a){if(!/^(\d+)$/.test(o))throw new Error("malformed path expression");for(var s=o>>0,l=null,d=r.firstChild;d&&!l;){var c=d.nodeType;(c===Node.TEXT_NODE||c===Node.ELEMENT_NODE)&&--s<0&&(l=d),d=d.nextSibling}if(!l)return null;r=l}return n&&(r=r.getAttributeNode(n.slice(1))),r},t.makeDLoc=a,t.DLoc=i,t.findRoot=s,t.getRoot=l,t.DLocRoot=d}),define("wed/wed_util",["require","exports","module","./dloc","./domutil"],function(e,t,n){"use strict";function i(e,t){var n=e.parentNode;return t.contains(n)?r(l(t,n,u(n.childNodes,e))):{left:0,top:0}}function r(e){var t,n=e.node,r=e.offset,o=n.nodeType,a=o===Node.ELEMENT_NODE,s=o===Node.TEXT_NODE;if(a)t=n.childNodes.length;else{if(!s)throw new Error("unexpected node type: "+o);t=n.length}if(0===t)return i(n,e.root);for(var l,d,c=n.ownerDocument.createRange();t>r;){if(d=a?n.childNodes[r]:void 0,d&&d.nodeType===Node.ELEMENT_NODE?l=d.getClientRects()[0]:(c.setStart(n,r),c.setEnd(n,r+1),l=c.getClientRects()[0]),l&&(0!==l.left||0!==l.right||0!==l.top||0!==l.bottom))return{left:l.left,top:l.top};r++}for(r=e.offset;r;){r--,d=void 0;var h;if(s)h=!0;else{if(!a)throw new Error("unexpected node type: "+o);switch(d=n.childNodes[r],d.nodeType){case Node.TEXT_NODE:h=!0;break;case Node.ELEMENT_NODE:var u=n.ownerDocument.defaultView,p=u.getComputedStyle(d).getPropertyValue("display");h="inline"===p||"inline-block"===p;break;default:throw new Error("unexpected node type: "+d.nodeType)}}var _;if(d&&d.nodeType===Node.ELEMENT_NODE?_=d.getClientRects():(c.setStart(n,r),c.setEnd(n,r+1),_=c.getClientRects()),l=_[_.length-1])return h?{left:l.right,top:l.top}:{left:l.left,top:l.bottom}}return i(n,e.root)}function o(e){if(!e.classList||!e.classList.contains("_attribute_value"))throw new Error("getAttrValueNode operates only on attribute values");var t=e,n=e.firstChild;if(n){for(;n&&n.nodeType!==Node.TEXT_NODE;)n=n.nextSibling;n&&(t=n)}return t}function a(e,t){var n=e._getDOMSelectionRange();if(!d.isWellFormedRange(n))throw new Error("malformed range");for(var i=e.toDataLocation(n.startContainer,n.startOffset),r=e.toDataLocation(n.endContainer,n.endOffset);e._cut_buffer.firstChild;)e._cut_buffer.removeChild(e._cut_buffer.firstChild);if(c(i.node)){var o=i.node;if(o!==r.node)throw new Error("attribute selection that does not start and end in the same attribute");var a=o.value.slice(i.offset,r.offset);e._spliceAttribute(h(e.fromDataLocation(i).node,"_attribute_value",n.startContainer),i.offset,r.offset-i.offset,""),e._cut_buffer.textContent=a}else{for(var s=e.data_updater.cut(i,r),l=s[1],u=new e.my_window.DOMParser,p=u.parseFromString("<div></div>","text/xml"),_=0,f=l.length;f>_;++_)p.firstChild.appendChild(p.adoptNode(l[_]));e._cut_buffer.textContent=p.firstChild.innerHTML,e.setDataCaret(s[0])}n=e.doc.createRange();var E=e._cut_buffer;n.setStart(E,0),n.setEnd(E,E.childNodes.length);var m=e.my_window.getSelection();m.removeAllRanges(),m.addRange(n),setTimeout(function(){e._focusInputField()},0)}function s(e,t){var n,i,r=t.to_paste,o=r.cloneNode(!0),a=e.getDataCaret();if(1===r.childNodes.length&&r.firstChild.nodeType===Node.TEXT_NODE)if(c(a.node)){var s=e.getGUICaret();e._spliceAttribute(h(s.node,"_attribute_value",s.node),s.offset,0,r.firstChild.data)}else i=e.data_updater.insertText(a,r.firstChild.data),n=i[0]===i[1]&&i[1]===a.node?a.make(a.node,a.offset+r.firstChild.length):a.make(i[1],i[1].length);else{for(var l=document.createDocumentFragment();r.firstChild;)l.appendChild(r.firstChild);switch(a.node.nodeType){case Node.TEXT_NODE:a.node.parentNode;i=e.data_updater.insertIntoText(a,l),n=i[1];break;case Node.ELEMENT_NODE:var d=a.node.childNodes[a.offset],p=d?d.nextSibling:null;e.data_updater.insertBefore(a.node,l,d),n=a.make(a.node,p?u(a.node.childNodes,p):a.node.childNodes.length);break;default:throw new Error("unexpected node type: "+a.node.nodeType)}}n&&(e.setDataCaret(n),a=n),e.$gui_root.trigger("wed-post-paste",[t.e,a,o])}var l=e("./dloc").makeDLoc,d=e("./domutil"),c=d.isAttr,h=d.closestByClass,u=d.indexOf;t.boundaryXY=r,t.getAttrValueNode=o,t.cut=a,t.paste=s}),define("wed/build-info",[],function(){return{desc:"v0.27.0-1-g3b6520b-unclean",date:"Tue Aug 30 2016 13:12:36 GMT-0400 (EDT)"}}),define("is-plain-obj",["require","exports","module"],function(e,t,n){var i=Object.prototype.toString;return n.exports=function(e){var t;return"[object Object]"===i.call(e)&&(t=Object.getPrototypeOf(e),null===t||t===Object.getPrototypeOf({}))},n.exports}),define("merge-options",["require","exports","module","is-plain-obj"],function(e,t,n){function i(e){var t=[];for(var n in e)h.call(e,n)&&t.push(n);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),r=0;r<i.length;r++)u.call(e,i[r])&&t.push(i[r]);return t}function r(e){return Array.isArray(e)?o(e):c(e)?a(e):e}function o(e){var t=e.slice(0,0);return i(e).forEach(function(n){t[n]=r(e[n])}),t}function a(e){var t=null===Object.getPrototypeOf(e)?Object.create(null):{};return i(e).forEach(function(n){t[n]=r(e[n])}),t}function s(e,t,n,i){return n.forEach(function(n){n in e?e[n]=d(e[n],t[n],i):e[n]=r(t[n])}),e}function l(e,t,n){var o=e.slice(0,0),a=0;return[e,t].forEach(function(t){for(var l=[],d=0;d<t.length;d++)h.call(t,d)&&(l.push(String(d)),t===e?o[a++]=t[d]:o[a++]=r(t[d]));o=s(o,t,i(t).filter(function(e){return-1===l.indexOf(e)}),n)}),o}function d(e,t,n){return n.concatArrays&&Array.isArray(e)&&Array.isArray(t)?l(e,t,n):c(t)&&c(e)?s(e,t,i(t),n):r(t)}var c=e("is-plain-obj"),h=Object.prototype.hasOwnProperty,u=Object.propertyIsEnumerable,p=this,_={concatArrays:!1};return n.exports=function(){for(var e=d(r(_),this!==p&&this||{},_),t={},n=0;n<arguments.length;n++){var i=arguments[n];if(void 0!==i){if(!c(i))throw new TypeError("`"+i+"` is not an Option Object");t=d(t,i,e)}}return t},n.exports}),define("wed/object_check",["require","exports","module"],function(e,t,n){"use strict";function i(e,t){var n=e[t];if(n instanceof Array||"object"!=typeof n)return n;for(var r in n)if(i(n,r))return!0;return!1}function r(e,t){var n={missing:[],extra:[]};o(e,t,void 0,n);for(var i in n)n[i].length||delete n[i];return n}function o(e,t,n,r){var a,s;for(a in e)if(i(e,a))if(s=n?[n,a].join("."):a,a in t){var l=t[a],d=e[a];l instanceof Array||"object"!=typeof l||"object"!=typeof d||o(d,l,s,r)}else r.missing.push(s);for(a in t)a in e||(s=n?[n,a].join("."):a,r.extra.push(s))}t.check=r}),define("wed/preferences",["require","exports","module","lodash","./object_check"],function(e,t,n){"use strict";function i(e){return e?(this._validatePrefs(e),void(this._prefs=r.extend(Object.create(null),e))):(this._prefs=Object.create(null),void this._validatePrefs(this._prefs))}var r=e("lodash"),o=e("./object_check"),a={tooltips:!1};i.prototype._validatePrefs=function(e){var t=o.check(a,e);if(t.missing)throw new Error("missing option: "+t.missing[0]);if(t.extra)throw new Error("extra option: "+t.extra[0])},i.prototype.get=function(e){for(var t=e.split("."),n=0,i=this._prefs;n<t.length;){var r=t[n];if(""===r)throw new Error("empty part in "+e);if(i=i[r],void 0===i)return;++n}return i},i.prototype.set=function(e,t){for(var n=e.split("."),i=0,r=this._prefs;i<n.length-1;){var o=n[i];if(""===o)throw new Error("empty part in "+e);r=r[o],void 0===r&&(r=r[o]=Object.create(null)),++i}r[n[i]]=t,this._validatePrefs(this._prefs)},t.Preferences=i}),define("wed/guiroot",["require","exports","module","./oop","./dloc","./util","./domutil"],function(e,t,n){"use strict";function i(e){this.message=e}function r(e){l.DLocRoot.call(this,e)}function o(e){if(!e.classList||!e.classList.contains("_phantom_wrap"))throw new Error("the node should be a _phantom_wrap element");for(var t=0,n=e.firstChild;n;){if(n.classList){if(n.classList.contains("_phantom_wrap"))t+=o(n);else if(n.classList.contains("_real"))t+=1;else if(!n.classList.contains("_phantom"))throw new Error("unexpected element in _phantom_wrap")}else if(n.nodeType!==Node.TEXT_NODE)throw new Error("unexpected node in _phantom_wrap");n=n.nextSibling}return t}function a(e,t){if(!e.classList||!e.classList.contains("_phantom_wrap"))throw new Error("the node should be a _phantom_wrap element");for(var n,i=t,r=e.firstChild;!n&&r;){if(r.classList){if(r.classList.contains("_phantom_wrap")){var o=a(r,t);o.found&&(n=o.found),t-=o.count}else if(r.classList.contains("_real"))t-=1,0>t&&(n=r);else if(!r.classList.contains("_phantom"))throw new Error("unexpected element in _phantom_wrap")}else if(r.nodeType!==Node.TEXT_NODE)throw new Error("unexpected node in _phantom_wrap");r=r.nextSibling}return{found:n,count:i-t}}var s=e("./oop"),l=e("./dloc"),d=(e("./util"),e("./domutil")),c=d.indexOf,h=d.closestByClass;s.inherit(i,Error),i.prototype.name="AttributeNotFound",t.AttributeNotFound=i,s.inherit(r,l.DLocRoot),r.prototype.nodeToPath=function(e){var t=this.node;if(null===e||void 0===e)throw new Error("invalid node parameter");if(h(e,"_placeholder",t))throw new Error("cannot provide path to node because it is a placeholder node");if(t===e)return"";if(!t.contains(e))throw new Error("node is not a descendant of root");for(var n=[];e!==t;){var i,r,a,s,l=0;if(e.nodeType!==Node.TEXT_NODE&&!e.matches("._real, ._phantom_wrap, ._attribute_value"))throw new Error("only nodes of class ._real, ._phantom_wrap, and ._attribute_value are supported");var u=h(e,"_attribute_value",t);if(u){if(r=d.siblingByClass(u,"_attribute_name"),!r)throw new Error("no attribute name found");n.unshift("@"+r.textContent),i=h(u,"_real",t)}else{for(i=e.parentNode,a=c(i.childNodes,e),s=0;a>s;++s)r=i.childNodes[s],r.nodeType===Node.TEXT_NODE||r.nodeType===Node.ELEMENT_NODE&&r.classList.contains("_real")?l++:r.nodeType===Node.ELEMENT_NODE&&r.classList.contains("_phantom_wrap")&&(l+=o(r));i.classList.contains("_phantom_wrap")||n.unshift(""+l)}e=i}return n.join("/")},r.prototype.pathToNode=function(e){var t=this.node;if(""===e)return t;var n,r=e.split(/\//),o=t;"@"===r[r.length-1][0]&&(n=r.pop());for(var s,l=0;void 0!==(s=r[l]);++l){var c,h,u=/^(\d+)$/.exec(s);if(!u)throw new Error("malformed path expression");c=u[1]>>0;for(var p=null,_=0;!p&&_<o.childNodes.length;_++)if(h=o.childNodes[_],(h.nodeType===Node.TEXT_NODE||h.nodeType===Node.ELEMENT_NODE&&h.classList.contains("_real"))&&--c<0)p=h;else if(h.nodeType===Node.ELEMENT_NODE&&h.classList.contains("_phantom_wrap")){var f=a(h,c);f.found&&(p=f.found),c-=f.count}if(!p)return null;o=p}if(n){for(var E,m=n.slice(1),A=o.getElementsByClassName("_attribute_name"),v=0;void 0!==(E=A[v])&&E.textContent!==m;++v);if(!E)throw new i("could not find attribute with name: "+m);o=d.siblingByClass(E,"_attribute_value")}return o},t.GUIRoot=r}),define("wed/serializer",["require","exports","module"],function(e,t,n){"use strict";function i(e){if(e.nodeType!==Node.ELEMENT_NODE&&e.nodeType!==Node.DOCUMENT_NODE&&e.nodeType!==Node.DOCUMENT_FRAGMENT_NODE)throw new Error("the root node must be an element, a document or a document fragment");var t=[];return l(t,e),t.join("")}function r(e,t){if(t.childNodes.length>1)throw new Error("cannot serialize a document with more than one child node");l(e,t.firstChild)}function o(e,t){var n=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return t&&(n=n.replace(/"/g,"&quot;")),n}function a(e,t){e.push("<",t.tagName);for(var n,i=t.attributes,r=0;n=i[r];++r)e.push(" ",n.name,'="',o(n.value,!0),'"');
if(t.childNodes.length){e.push(">");for(var a=t.firstChild;a;)l(e,a),a=a.nextSibling;e.push("</",t.tagName,">")}else e.push("/>")}function s(e,t){e.push(o(t.textContent,!1))}function l(e,t){var n=d[t.nodeType];if(!n)throw new Error("can't handle node of type: "+t.nodeType);n(e,t)}var d={};d[Node.DOCUMENT_NODE]=r,d[Node.DOCUMENT_FRAGMENT_NODE]=r,d[Node.ELEMENT_NODE]=a,d[Node.TEXT_NODE]=s,t.serialize=i}),define("wed/saver",["require","exports","module","./oop","./lib/simple_event_emitter","./lib/conditioned","./browsers","./serializer"],function(e,t,n){"use strict";function i(e,t,n){a.call(this),s.call(this),this._version=e,this._data_updater=t,this._data_tree=n,this._initialized=!1,this._failed=void 0,this._current_generation=0,this._saved_generation=0,this._last_modification=void 0,this._last_save=void 0,this._last_save_kind=void 0,this._autosave_interval=void 0,this._autosave_timeout=void 0,t.addEventListener("changed",function(){this._last_modification=Date.now(),this._saved_generation===this._current_generation&&(this._current_generation++,this._emit("changed"))}.bind(this)),this._bound_autosave=this._autosave.bind(this)}function r(e){e=Math.round(e/1e3);var t="moments ago";return e>0&&(t="  ",t+=e>86400?Math.round(e/8640)/10+"d":e>3600?Math.round(e/360)/10+"h":e>60?Math.round(e/6)/10+"m":e+"s",t+=" ago"),t}var o=e("./oop"),a=e("./lib/simple_event_emitter").SimpleEventEmitter,s=e("./lib/conditioned").Conditioned,l=e("./browsers"),d=e("./serializer"),c=1,h=2;o.implement(i,a),o.implement(i,s),i.prototype.save=function(e){this._save(!1,e)},i.prototype._save=function(e,t){throw new Error("derived classes must implement this method")},i.prototype.getData=function(){return l.MSIE?d.serialize(this._data_tree.firstChild):this._data_tree.innerHTML},i.prototype._saveSuccess=function(e,t){this._saved_generation=t,this._last_save=Date.now(),this._last_save_kind=e?c:h,this._emit(e?"autosaved":"saved"),this.setAutosaveInterval(this._autosave_interval)},i.prototype._fail=function(e){this._failed=!0,e&&this._emit("failed",e)},i.prototype._autosave=function(){function e(){t.setAutosaveInterval(t._autosave_interval)}this._autosave_timeout=void 0;var t=this;this._current_generation!==this._saved_generation?this._save(!0,e):e()},i.prototype.setAutosaveInterval=function(e){this._autosave_interval=e;var t=this._autosave_timeout;t&&clearTimeout(t),this._autosave_timeout=e?setTimeout(this._bound_autosave,e):void 0},i.prototype.recover=function(e){return!this._initialized||this._failed?void e(void 0):void this._recover(e)},i.prototype._recover=function(e){throw new Error("derived classes must implement this method")},i.prototype.getModifiedWhen=function(){return this._saved_generation===this._current_generation?!1:r(Date.now()-this._last_modification)},i.prototype.getSavedWhen=function(){return void 0!==this._last_save_kind?r(Date.now()-this._last_save):void 0},i.prototype.getLastSaveKind=function(){return this._last_save_kind},t.Saver=i,t.AUTO=c,t.MANUAL=h}),define("wed/savers/ajax",["require","exports","module","../saver","../oop","../log","jquery"],function(e,t,n){"use strict";function i(e,t,n,i){o.Saver.call(this,e,t,n),this._url=i.url,this._headers=i.headers,this._etag='"'+i.initial_etag+'"',this._post({command:"check",version:e},function(e){this._initialized=!0,this._setCondition("initialized"),this._failed=!1}.bind(this),"json").fail(this._failure_wrapper(function(){throw new Error(url+" is not responding; saving is not possible.")}.bind(this))),this.setAutosaveInterval(3e5)}function r(e){var t=e.messages;if(t&&t.length){for(var n,i={},r=0;void 0!==(n=t[r]);++r){var o=n.type;if(void 0!==i[o])throw new Error("same type of message appearing more than once in one transaction");i[o]=n}return i}}var o=e("../saver"),a=e("../oop"),s=e("../log"),l=e("jquery");a.inherit(i,o.Saver),i.prototype._failure_wrapper=function(e){return s.wrap(function(t,n,i){try{if(412===t.status){var r={msg:"The document was edited by someone else.",type:"save_edited"};return void this._fail(r)}return e.apply(void 0,arguments)}catch(o){throw this._fail(),o}}.bind(this))},i.prototype._success_wrapper=function(e){return s.wrap(function(){try{return e.apply(void 0,arguments)}catch(t){throw this._fail(),t}}.bind(this))},i.prototype._save=function(e,t){function n(n){var o=r(n);if(!o)throw new Error("The server accepted the save request but did not return any information regarding whether the save was successful or not.");if(o.save_fatal_error)throw new Error("The server was not able to save the data due to a fatal error. Please contact technical support before trying to edit again.");if(o.save_transient_error)return this._emit("failed",o.save_transient_error),void(t&&t(o.save_transient_error));if(!o.save_successful)throw new Error("Unexpected response from the server while saving. Please contact technical support before trying to edit again.");o.version_too_old_error&&this._emit("too_old"),this._saveSuccess(e,i),t&&t(null)}if(this._initialized){var i=this._current_generation;this._post({command:e?"autosave":"save",version:this._version,data:this.getData()},this._success_wrapper(n.bind(this)),"json").fail(this._failure_wrapper(function(){var e={msg:"Your browser cannot contact the server",type:"save_disconnected"};this._emit("failed",e),t&&t(e)}.bind(this)))}},i.prototype._recover=function(e){function t(t){var n=r(t);return n?n.save_fatal_error?void e(!1):n.save_successful?void e(!0):void e(!1):void e(!1)}this._post({command:"recover",version:this._version,data:this.getData()},t,"json").fail(e.bind(void 0,!1))},i.prototype._post=function(e,t,n){var i;this._etag?(i=l.extend({},this._headers),i["If-Match"]=this._etag):i=this._headers;var o=this;return l.ajax({type:"POST",url:this._url,data:e,dataType:n,headers:i}).done(function(e,n,i){var a=r(e);a&&a.save_successful&&(o._etag=i.getResponseHeader("ETag")),t(e,n,i)})},t.Saver=i}),define("wed/savers/localforage",["require","exports","module","../saver","../oop","localforage"],function(e,t,n){"use strict";function i(){l.config({name:"wed",storeName:"files",version:1})}function r(e,t,n,r){a.Saver.call(this,e,t,n),this._initialized=!0,this._setCondition("initialized"),this._failed=!1,this._name=r.name,i(),this.setAutosaveInterval(3e5)}function o(e,t){var n=Object.create(null);return n.version=1,n.name=e,n.data=t,n.uploaded=new Date,n.saved="never",n.downloaded="never",n}var a=e("../saver"),s=e("../oop"),l=e("localforage");s.inherit(r,a.Saver),r.prototype._save=function(e,t){if(this._initialized){var n=this._current_generation;this._update(this._name,this.getData(),e,n,t)}},r.prototype._update=function(e,t,n,i,r){var o=this;l.getItem(e).then(function(r){if(1!==r.version)throw new Error("unexpected record version number: "+r.version);r.data=t,r.saved=new Date,l.setItem(e,r,function(e){return e?void o._fail({type:void 0,msg:"Failed to save!"}):void o._saveSuccess(n,i)})})},r.prototype._recover=function(e){this._save(!1,e)},t.Saver=r,t.config=i,t.makeFileRecord=o}),define("wed/tree_updater",["require","exports","module","./domutil","./oop","./lib/simple_event_emitter","./dloc"],function(e,t,n){"use strict";function i(e){s.call(this),this._tree=e,this._dloc_root=l.findRoot(e)}var r=e("./domutil"),o=r.indexOf,a=e("./oop"),s=e("./lib/simple_event_emitter").SimpleEventEmitter,l=e("./dloc"),d=l.DLoc,c=l.makeDLoc;a.implement(i,s);var h=i.prototype._emit;i.prototype._emit=function(){h.apply(this,arguments),h.call(this,"changed")},i.prototype.insertAt=function(e,t,n){var i,r;if(e instanceof d?(i=e.node,r=e.offset,n=t):(i=e,r=t),n instanceof Array||n instanceof NodeList)for(var o=0;o<n.length;++o,++r)this.insertAt(i,r,n[o]);else if("string"==typeof n)this.insertText(i,r,n);else if(n.nodeType===Node.TEXT_NODE)switch(i.nodeType){case Node.TEXT_NODE:this.insertText(i,r,n.data);break;case Node.ELEMENT_NODE:this.insertNodeAt(i,r,n);break;default:throw new Error("unexpected node type: "+i.nodeType)}else{if(n.nodeType!==Node.ELEMENT_NODE)throw new Error("unexpected value for what: "+n);switch(i.nodeType){case Node.TEXT_NODE:this.insertIntoText(i,r,n);break;case Node.ELEMENT_NODE:this.insertNodeAt(i,r,n);break;default:throw new Error("unexpected node type: "+i.nodeType)}}},i.prototype.splitAt=function(e,t,n){var i;if(t instanceof d?(i=t.node,n=t.offset):i=t,i===e&&i.nodeType===Node.TEXT_NODE)throw new Error("splitAt called in a way that would result in two adjacent text nodes");if(!e.contains(i))throw new Error("split location is not inside top");var a=e.cloneNode(!0),s=r.correspondingNode(e,a,i),l=this._splitAt(a,s,n),c=e.parentNode,h=o(c.childNodes,e);return this.deleteNode(e),this.insertNodeAt(c,h,l[0]),this.insertNodeAt(c,h+1,l[1]),l},i.prototype._splitAt=function(e,t,n){var i,r=t===e,a=t.parentNode;switch(t.nodeType){case Node.TEXT_NODE:if(0===n)i=[null,t];else if(n===t.length)i=[t,null];else{var s=t.data.slice(n);t.deleteData(n,t.length-n),a&&a.insertBefore(a.ownerDocument.createTextNode(s),t.nextSibling||null),i=[t,t.nextSibling]}break;case Node.ELEMENT_NODE:0>n?n=0:n>t.childNodes.length&&(n=t.childNodes.length);for(var l=t.cloneNode(!0);t.childNodes[n];)t.removeChild(t.childNodes[n]);for(;n--;)l.removeChild(l.firstChild);a&&a.insertBefore(l,t.nextSibling||null),i=[t,l];break;default:throw new Error("unexpected node type: "+t.nodeType)}return r?i:this._splitAt(e,a,o(a.childNodes,t)+1)},i.prototype.insertBefore=function(e,t,n){var i=n?o(e.childNodes,n):e.childNodes.length;if(-1===i)throw new Error("insertBefore called with a before_this value which is not a child of parent");this.insertAt(e,i,t)},i.prototype.insertText=function(e,t,n){var i;return e instanceof d?(n=t,i=e.node,t=e.offset):i=e,r.genericInsertText.call(this,i,t,n)},i.prototype.deleteText=function(e,t,n){var i;if(e instanceof d?(n=t,i=e.node,t=e.offset):i=e,i.nodeType!==Node.TEXT_NODE)throw new Error("deleteText called on non-text");this.setTextNode(i,i.data.slice(0,t)+i.data.slice(t+n))},i.prototype.insertIntoText=function(e,t,n){var i;e instanceof d?(n=t,t=e.offset,i=e.node):i=e;var o=r.genericInsertIntoText.call(this,i,t,n);return[c(this._tree,o[0]),c(this._tree,o[1])]},i.prototype.insertNodeAt=function(e,t,n){var i;if(e instanceof d?(n=t,t=e.offset,i=e.node):i=e,n.nodeType===Node.DOCUMENT_FRAGMENT_NODE)throw new Error("document fragments cannot be passed to insertNodeAt");i.insertBefore(n,i.childNodes[t]||null),this._emit("insertNodeAt",{parent:i,index:t,node:n})},i.prototype.setTextNode=function(e,t){if(e.nodeType!==Node.TEXT_NODE)throw new Error("setTextNode called on non-text");""!==t?this.setTextNodeValue(e,t):this.deleteNode(e)},i.prototype.setTextNodeValue=function(e,t){if(e.nodeType!==Node.TEXT_NODE)throw new Error("setTextNodeValue called on non-text");var n=e.data;e.data=t,this._emit("setTextNodeValue",{node:e,value:t,old_value:n})},i.prototype.removeNode=function(e){var t=e.previousSibling,n=(e.nextSibling,e.parentNode),i=o(n.childNodes,e);return this.deleteNode(e),t?this.mergeTextNodes(t):c(this._tree,n,i)},i.prototype.removeNodeNF=function(e){return e?this.removeNode(e):void 0},i.prototype.removeNodes=function(e){if(e.length){for(var t=e[0].previousSibling,n=(e[e.length-1].nextSibling,e[0].parentNode),i=o(n.childNodes,e[0]),r=0;r<e.length;++r){if(r<e.length-1&&e[r].nextSibling!==e[r+1])throw new Error("nodes are not immediately contiguous in document order");this.deleteNode(e[r])}return t?this.mergeTextNodes(t):c(this._tree,n,i)}},i.prototype.cut=function(e,t){var n=r.genericCutFunction.call(this,e.toArray(),t.toArray());return n[0]=c(this._tree,n[0]),n},i.prototype.mergeTextNodes=function(e){var t=e.nextSibling;if(e.nodeType===Node.TEXT_NODE&&t&&t.nodeType===Node.TEXT_NODE){var n=e.length;return this.setTextNodeValue(e,e.data+t.data),this.deleteNode(t),c(this._tree,e,n)}var i=e.parentNode;return c(this._tree,i,o(i.childNodes,e)+1)},i.prototype.mergeTextNodesNF=function(e){return e?this.mergeTextNodes(e):void 0},i.prototype.deleteNode=function(e){this._emit("beforeDeleteNode",{node:e});var t=e.parentNode;t.removeChild(e),this._emit("deleteNode",{node:e,former_parent:t})},i.prototype.setAttribute=function(e,t,n){this.setAttributeNS(e,"",t,n)},i.prototype.setAttributeNS=function(e,t,n,i){void 0===i&&(i=null);var r=null===i;if(e.nodeType!==Node.ELEMENT_NODE)throw new Error("setAttribute called on non-element");var o=e.getAttributeNS(t,n);""!==o||e.hasAttributeNS(t,n)||(o=null),r?e.removeAttributeNS(t,n):e.setAttributeNS(t,n,i),this._emit("setAttributeNS",{node:e,ns:t,attribute:n,old_value:o,new_value:i})},i.prototype.nodeToPath=function(e){return this._dloc_root.nodeToPath(e)},i.prototype.pathToNode=function(e){return this._dloc_root.pathToNode(e)},t.TreeUpdater=i}),define("wed/convert",["require","exports","module"],function(e,t,n){"use strict";function i(e,t){var n=e.parentNode;if(n&&n.nodeType!==Node.DOCUMENT_NODE&&n.nodeType!==Node.DOCUMENT_FRAGMENT_NODE){var r=n.getAttribute(t);return null!==r?r:i(n,t)}}function r(e,t){var n;switch(t.nodeType){case Node.ELEMENT_NODE:n=e.createElement("div"),n.className=t.tagName+" _real";for(var o,a=0;o=t.attributes[a];++a){var s="xmlns"===o.name||0===o.name.lastIndexOf("xmlns:",0);if(!s||o.value!==i(t,o.name)){var l="data-wed-"+o.name.replace(/--(-+)/,"---$1").replace(":","---");n.setAttribute(l,o.value)}}for(var d=t.firstChild;d;){var c=r(e,d);c&&n.appendChild(c),d=d.nextSibling}break;case Node.TEXT_NODE:n=document.createTextNode(t.data);break;default:throw new Error("unhandled node type: "+t.nodeType)}return n}t.toHTMLTree=r}),define("wed/gui_updater",["require","exports","module","./domutil","jquery","./oop","./tree_updater","./dloc","./convert","./util"],function(e,t,n){"use strict";function i(e,t){d.call(this,e),this._gui_tree=e,this._tree_updater=t,this._tree_updater.addEventListener("insertNodeAt",this._insertNodeAtHandler.bind(this)),this._tree_updater.addEventListener("setTextNodeValue",this._setTextNodeValueHandler.bind(this)),this._tree_updater.addEventListener("beforeDeleteNode",this._beforeDeleteNodeHandler.bind(this)),this._tree_updater.addEventListener("setAttributeNS",this._setAttributeNSHandler.bind(this))}var r=e("./domutil"),o=r.isAttr,a=r.indexOf,s=e("jquery"),l=e("./oop"),d=e("./tree_updater").TreeUpdater,c=e("./dloc"),h=e("./convert"),u=e("./util"),p=c.makeDLoc,_=c.DLoc;l.inherit(i,d),i.prototype._insertNodeAtHandler=function(e){var t=this.fromDataLocation(e.parent,e.index),n=h.toHTMLTree(this._gui_tree.ownerDocument,e.node);r.linkTrees(e.node,n),this.insertNodeAt(t,n)},i.prototype._setTextNodeValueHandler=function(e){var t=this.fromDataLocation(e.node,0);this.setTextNodeValue(t.node,e.value)},i.prototype._beforeDeleteNodeHandler=function(e){var t,n=e.node;switch(n.nodeType){case Node.TEXT_NODE:var i=this.fromDataLocation(n,0);t=i.node;break;case Node.ELEMENT_NODE:t=s.data(n,"wed_mirror_node")}this.deleteNode(t),r.unlinkTree(n),r.unlinkTree(t)},i.prototype._setAttributeNSHandler=function(e){var t=this.fromDataLocation(e.node,0);this.setAttributeNS(t.node,"",u.encodeAttrName(e.attribute),e.new_value)},i.prototype.fromDataLocation=function(e,t){var n;e instanceof _?(n=e.node,t=e.offset):n=e;var i=this.pathToNode(this._tree_updater.nodeToPath(n));if(n.nodeType===Node.TEXT_NODE)return p(this._gui_tree,i,t);if(o(n))return i.firstChild&&i.firstChild.nodeType===Node.TEXT_NODE&&(i=i.firstChild),p(this._gui_tree,i,t);if(0===t)return p(this._gui_tree,i,0);if(t>=n.childNodes.length)return p(this._gui_tree,i,i.childNodes.length);var r=this.pathToNode(this._tree_updater.nodeToPath(n.childNodes[t]));return null===r?p(this._gui_tree,i,i.childNodes.length):p(this._gui_tree,r.parentNode,a(r.parentNode.childNodes,r))},t.GUIUpdater=i}),define("wed/undo_recorder",["require","exports","module","./domutil","./oop","./undo"],function(e,t,n){"use strict";function i(e,t){this._editor=e,this._tree_updater=t,this._tree_updater.addEventListener("insertNodeAt",this._insertNodeAtHandler.bind(this)),this._tree_updater.addEventListener("setTextNodeValue",this._setTextNodeValueHandler.bind(this)),this._tree_updater.addEventListener("beforeDeleteNode",this._beforeDeleteNodeHandler.bind(this)),this._tree_updater.addEventListener("setAttributeNS",this._setAttributeNSHandler.bind(this)),this._suppress=!1}function r(e,t,n,i){h.Undo.call(this,"InsertNodeAtUndo"),this._tree_updater=e,this._parent_path=e.nodeToPath(t),this._index=n,this._node=void 0}function o(e,t,n,i){h.Undo.call(this,"SetTextNodeValueUndo"),this._tree_updater=e,this._node_path=e.nodeToPath(t),this._new_value=n,this._old_value=i}function a(e,t){h.Undo.call(this,"DeleteNodeUndo"),this._tree_updater=e;var n=t.parentNode;this._parent_path=e.nodeToPath(n),this._index=d(n.childNodes,t),this._node=t.cloneNode(!0)}function s(e,t,n,i,r,o){h.Undo.call(this,"SetAttributeNSUndo"),this._tree_updater=e,this._node_path=e.nodeToPath(t),this._ns=n,this._attribute=i,this._old_value=r,this._new_value=o}var l=e("./domutil"),d=l.indexOf,c=e("./oop"),h=e("./undo");i.prototype.suppressRecording=function(e){if(e===this._suppress)throw new Error("spurious call to suppressRecording");this._suppress=e},i.prototype._insertNodeAtHandler=function(e){this._suppress||this._editor.recordUndo(new r(this._tree_updater,e.parent,e.index,e.node))},i.prototype._setTextNodeValueHandler=function(e){this._suppress||this._editor.recordUndo(new o(this._tree_updater,e.node,e.value,e.old_value))},i.prototype._beforeDeleteNodeHandler=function(e){this._suppress||this._editor.recordUndo(new a(this._tree_updater,e.node))},i.prototype._setAttributeNSHandler=function(e){this._suppress||this._editor.recordUndo(new s(this._tree_updater,e.node,e.ns,e.attribute,e.old_value,e.new_value))},c.inherit(r,h.Undo),r.prototype.undo=function(){if(this._node)throw new Error("undo called twice in a row");var e=this._tree_updater.pathToNode(this._parent_path);this._node=e.childNodes[this._index].cloneNode(!0),this._tree_updater.deleteNode(e.childNodes[this._index])},r.prototype.redo=function(){if(!this._node)throw new Error("redo called twice in a row");var e=this._tree_updater.pathToNode(this._parent_path);this._tree_updater.insertNodeAt(e,this._index,this._node),this._node=void 0},r.prototype.toString=function(){return[this._desc,"\n"," Parent path: ",this._parent_path,"\n"," Index: ",this._index,"\n"," Node: ",this._node?this._node.outerHTML:"undefined","\n"].join("")},c.inherit(o,h.Undo),o.prototype.undo=function(){var e=this._tree_updater.pathToNode(this._node_path);this._tree_updater.setTextNodeValue(e,this._old_value)},o.prototype.redo=function(){var e=this._tree_updater.pathToNode(this._node_path);this._tree_updater.setTextNodeValue(e,this._new_value)},o.prototype.toString=function(){return[this._desc,"\n"," Node path: ",this._node_path,"\n"," New value: ",this._new_value,"\n"," Old value: ",this._old_value,"\n"].join("")},c.inherit(a,h.Undo),a.prototype.undo=function(){if(!this._node)throw new Error("undo called twice in a row");var e=this._tree_updater.pathToNode(this._parent_path);this._tree_updater.insertNodeAt(e,this._index,this._node),this._node=void 0},a.prototype.redo=function(){if(this._node)throw new Error("redo called twice in a row");var e=this._tree_updater.pathToNode(this._parent_path);this._node=e.childNodes[this._index].cloneNode(!0),this._tree_updater.deleteNode(e.childNodes[this._index])},a.prototype.toString=function(){return[this._desc,"\n"," Parent path: ",this._parent_path,"\n"," Index: ",this._index,"\n"," Node: ",this._node?this._node.outerHTML:"undefined","\n"].join("")},c.inherit(s,h.Undo),s.prototype.undo=function(){var e=this._tree_updater.pathToNode(this._node_path);this._tree_updater.setAttributeNS(e,this._ns,this._attribute,this._old_value)},s.prototype.redo=function(){var e=this._tree_updater.pathToNode(this._node_path);this._tree_updater.setAttributeNS(e,this._ns,this._attribute,this._new_value)},s.prototype.toString=function(){return[this._desc,"\n"," Node path: ",this._node_path,"\n"," Namespace: ",this._ns,"\n"," Attribute Name: ",this._attribute,"\n"," New value: ",this._new_value,"\n"," Old value: ",this._old_value,"\n"].join("")},t.UndoRecorder=i}),define("wed/domlistener",["require","exports","module"],function(e,t,n){"use strict";function i(e){this._root=e,this._event_handlers={"included-element":[],"added-element":[],"excluded-element":[],"excluding-element":[],"removed-element":[],"removing-element":[],"children-changed":[],"children-changing":[],"text-changed":[],"attribute-changed":[]},this._trigger_handlers={},this._triggers_to_fire={}}function r(){throw new Error("derived classes must override this method")}i.prototype.startListening=r,i.prototype.addHandler=function(e,t,n){e instanceof Array||(e=[e]);for(var i,r=0;void 0!==(i=e[r]);r++)if("trigger"!==i){var o=this._event_handlers[i];if(void 0===o)throw new Error("invalid event_type: "+i);o.push([t,n])}else{var a=this._trigger_handlers[t];void 0===a&&(a=this._trigger_handlers[t]=[]),a.push(n)}},i.prototype.stopListening=r,i.prototype.processImmediately=r,i.prototype.clearPending=r,i.prototype.trigger=function(e){this._triggers_to_fire[e]=1},i.prototype._processTriggers=function(){for(var e=Object.keys(this._triggers_to_fire);e.length>0;){this._triggers_to_fire={};for(var t,n=this._trigger_handlers,i=0;void 0!==(t=e[i]);++i){var r=n[t];if(void 0!==r)for(var o,a=0;void 0!==(o=r[a]);++a)this._callHandler(o)}e=Object.keys(this._triggers_to_fire)}},i.prototype._callHandler=function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);t.unshift(this._root),e.apply(void 0,t)},i.prototype._dumpMutation=function(e){console.log(e.type+":",e.target,e.addedNodes,e.removedNodes,e.previousSibling,e.nextSibling,e.attributeName,e.attributeNamespace,e.oldValue)},t.Listener=i}),define("wed/updater_domlistener",["require","exports","module","./oop","./domlistener"],function(e,t,n){"use strict";function i(e,t){o.Listener.call(this,e),this._updater=t,this._stopped=!0,this._scheduled_process_triggers=0,this._updater.addEventListener("insertNodeAt",this._insertNodeAtHandler.bind(this)),this._updater.addEventListener("setTextNodeValue",this._setTextNodeValueHandler.bind(this)),this._updater.addEventListener("beforeDeleteNode",this._beforeDeleteNodeHandler.bind(this)),this._updater.addEventListener("deleteNode",this._deleteNodeHandler.bind(this)),this._updater.addEventListener("setAttributeNS",this._setAttributeNSHandler.bind(this))}var r=e("./oop"),o=e("./domlistener");r.inherit(i,o.Listener),i.prototype.startListening=function(){this._stopped=!1},i.prototype.stopListening=function(){this._stopped=!0},i.prototype.processImmediately=function(){this._scheduled_process_triggers&&(this.clearPending(),this._processTriggers())},i.prototype.clearPending=function(){this._scheduled_process_triggers&&(window.clearTimeout(this._scheduled_process_triggers),this._scheduled_process_triggers=void 0)},i.prototype._insertNodeAtHandler=function(e){if(!this._stopped){var t=e.parent,n=e.node,i=this._childrenCalls("children-changed",e.parent,[e.node],[],n.previousSibling,n.nextSibling),r=[],o=[];e.node.nodeType===Node.ELEMENT_NODE&&(r=this._addRemCalls("added-element",n,t),o=this._incExcCalls("included-element",n,t));for(var a,s=i.concat(r,o),l=0;void 0!==(a=s[l]);++l)this._callHandler.apply(this,a);this._scheduleProcessTriggers()}},i.prototype._beforeDeleteNodeHandler=function(e){if(!this._stopped){var t=e.node,n=t.parentNode,i=this._childrenCalls("children-changing",n,[],[t],t.previousSibling,t.nextSibling),r=[],o=[];e.node.nodeType===Node.ELEMENT_NODE&&(r=this._addRemCalls("removing-element",t,n),o=this._incExcCalls("excluding-element",t,n));for(var a,s=i.concat(r,o),l=0;void 0!==(a=s[l]);++l)this._callHandler.apply(this,a);this._scheduleProcessTriggers()}},i.prototype._deleteNodeHandler=function(e){if(!this._stopped){var t=e.node,n=e.former_parent,i=this._childrenCalls("children-changed",n,[],[t],null,null),r=[],o=[];e.node.nodeType===Node.ELEMENT_NODE&&(r=this._addRemCalls("removed-element",t,n),o=this._incExcCalls("excluded-element",t,n));for(var a,s=i.concat(r,o),l=0;void 0!==(a=s[l]);++l)this._callHandler.apply(this,a);this._scheduleProcessTriggers()}},i.prototype._childrenCalls=function(e,t,n,i,r,o){if("children-changing"!==e&&"children-changed"!==e)throw new Error("incorrect call value: "+e);if(n.length&&i.length)throw new Error("we do not support having nodes added and removed in the same event");for(var a=this._event_handlers[e],s=[],l=0,d=a.length;d>l;++l){var c=a[l],h=c[0];t.matches(h)&&s.push([c[1],n,i,r,o,t])}return s},i.prototype._setTextNodeValueHandler=function(e){if(!this._stopped){for(var t=this._event_handlers["text-changed"],n=e.node,i=n.parentNode,r=0,o=t.length;o>r;++r){var a=t[r],s=a[0];i.matches(s)&&this._callHandler(a[1],n,e.old_value)}this._scheduleProcessTriggers()}},i.prototype._setAttributeNSHandler=function(e){if(!this._stopped){for(var t=e.node,n=this._event_handlers["attribute-changed"],i=0,r=n.length;r>i;++i){var o=n[i],a=o[0];t.matches(a)&&this._callHandler(o[1],t,e.ns,e.attribute,e.old_value)}this._scheduleProcessTriggers()}},i.prototype._scheduleProcessTriggers=function(){this._scheduled_process_triggers||(this._scheduled_process_triggers=window.setTimeout(function(){this._scheduled_process_triggers=void 0,this._processTriggers()}.bind(this),0))},i.prototype._addRemCalls=function(e,t,n){for(var i=this._event_handlers[e],r=[],o=t.previousSibling,a=t.nextSibling,s=0,l=i.length;l>s;++s){var d=i[s],c=d[0];t.matches(c)&&r.push([d[1],n,o,a,t])}return r},i.prototype._incExcCalls=function(e,t,n){for(var i=this._event_handlers[e],r=t.previousSibling,o=t.nextSibling,a=[],s=0,l=i.length;l>s;++s){var d=i[s],c=d[0];t.matches(c)&&a.push([d[1],t,n,r,o,t]);for(var h=t.querySelectorAll(c),u=0,p=h.length;p>u;++u)a.push([d[1],t,n,r,o,h[u]])}return a},t.Listener=i}),define("salve/name_resolver",["require","exports","module","./validate"],function(e,t,n){"use strict";function i(){this.id="N"+this.__newID(),this._context_stack=[],this.enterContext(),this._context_stack[0].forward.xml=o,this._context_stack[0].backwards[o]=["xml"],this._context_stack[0].forward.xmlns=a,this._context_stack[0].backwards[a]=["xmlns"]}var r=e("./validate"),o="http://www.w3.org/XML/1998/namespace",a="http://www.w3.org/2000/xmlns/";i.__id=0,i.prototype.__newID=function(){return i.__id++},i.prototype.hash=function(){return this.id},i.prototype.clone=function(){var e=new i;return e._context_stack=this._context_stack.slice(),e},i.prototype.definePrefix=function(e,t){if("xmlns"===e)throw new Error("trying to define 'xmlns' but the XML Namespaces standard stipulates that 'xmlns' cannot be declared (= \"defined\")");if("xml"===e&&t!==o)throw new Error("trying to define 'xml' to an incorrect URI");this._context_stack[0].forward[e]=t;var n=this._context_stack[0].backwards[t];void 0===n&&(n=this._context_stack[0].backwards[t]=[]),""===e?n.unshift(""):n.push(e)},i.prototype.enterContext=function(){this._context_stack.unshift(Object.create(null)),this._context_stack[0].forward=Object.create(null),this._context_stack[0].backwards=Object.create(null)},i.prototype.leaveContext=function(){if(!(this._context_stack.length>1))throw new Error("trying to leave the default context");this._context_stack.shift()},i.prototype.resolveName=function(e,t){void 0===t&&(t=!1);var n=e.split(":");if(1==n.length){if(t)return new r.EName("",e);n=["",e]}if(n.length>2)throw new Error("invalid name passed to resolveName");for(var i,o,a=0;void 0===i&&void 0!==(o=this._context_stack[a]);++a)i=o.forward[n[0]];return void 0===i?""===n[0]?new r.EName("",n[1]):void 0:new r.EName(i,n[1])},i.prototype.unresolveName=function(e,t){if(""===e)return t;for(var n,i,r=0;void 0===n&&void 0!==(i=this._context_stack[r]);++r)n=i.backwards[e];if(void 0!==n){var o=n[0];return""!==o?o+":"+t:t}},i.prototype.prefixFromURI=function(e){for(var t,n,i=0;void 0===t&&void 0!==(n=this._context_stack[i]);++i)t=n.backwards[e];if(void 0!==t){var r=t[0];return r}},t.NameResolver=i,t.XML1_NAMESPACE=o}),define("salve/util",["require","exports","module"],function(e,t,n){"use strict";return{inspect:function(e){return e}}}),define("salve/oop",["require","exports","module"],function(e,t,n){"use strict";function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e}function r(e,t){for(var n in t.prototype)e.prototype[n]=t.prototype[n]}t.inherit=i,t.implement=r}),define("salve/hashstructs",["require","exports","module","./oop"],function(e,t,n){"use strict";function i(e,t){if(this.hash_f=e,this.backing=Object.create(null),this._size=0,void 0!==t)if(t instanceof i){for(var n,r=this.backing,o=t.backing,a=Object.keys(o),s=0;void 0!==(n=a[s++]);)r[n]=o[n];this._size=a.length}else if(t instanceof Array)for(var l=0;l<t.length;++l)this.add(t[l]);else this.add(t)}function r(){i.apply(this,arguments)}function o(e,t){if(t instanceof Array)throw new Error("cannot initialize a map with an array");i.apply(this,arguments)}var a=e("./oop").inherit;i.prototype.hash_f=void 0,i.prototype.backing=void 0,i.prototype._size=0,i.prototype._store=function(e,t){if(void 0===e||null===e)throw new Error("undefined or null hash");void 0===this.backing[e]&&(this.backing[e]=t,this._size++)},i.prototype.union=function(e){if(null!==e&&void 0!==e){if(!(e instanceof this.constructor))throw new Error("union invalid class object; my class "+this.constructor.name+" other class "+e.constructor.name);for(var t,n=e.backing,i=Object.keys(n),r=0;void 0!==(t=i[r++]);)this._store(t,n[t])}},i.prototype.forEach=function(e){for(var t,n=this.backing,i=Object.keys(n),r=0;void 0!==(t=i[r++]);)e(n[t])},i.prototype.size=function(){return this._size},i.prototype.filter=function(e){var t=new this.constructor;void 0===t.hash_f&&(t.hash_f=this.hash_f);for(var n,i=this.backing,r=Object.keys(i),o=0;void 0!==(n=r[o++]);){var a=i[n],s=a instanceof Array?a:[a];e.apply(void 0,s)&&t._store(n,a)}return t},i.prototype.has=function(e){var t=this.hash_f(e);return this.backing[t]},i.prototype.toString=function(){return this.toArray().join(", ")},i.prototype.toArray=function(){for(var e,t=[],n=this.backing,i=Object.keys(n),r=0;void 0!==(e=i[r++]);)t.push(n[e]);return t},a(r,i),r.prototype.add=function(e){this._store(this.hash_f(e),e)},a(o,i),o.prototype.add=function(e,t){this._store(this.hash_f(e),[e,t])},o.prototype.forEach=function(e){for(var t,n=this.backing,i=Object.keys(n),r=0;void 0!==(t=i[r++]);)e(n[t][0],n[t][1])},o.prototype.has=function(e){var t=this.hash_f(e),n=this.backing[t];return void 0!==n?n[1]:void 0},o.prototype.keys=function(){return Object.keys(this.backing)},t.HashSet=r,t.HashMap=o}),define("salve/set",["require","exports","module"],function(e,t,n){"use strict";function i(e){if(void 0!==e)if(e instanceof i)this.b=e.b.concat([]);else if(e instanceof Array){this.b=[];for(var t=0;t<e.length;++t)this.add(e[t])}else this.b=[e];else this.b=[]}i.prototype.b=void 0,i.prototype.add=function(e){var t=this.b.indexOf(e);0>t&&this.b.push(e)},i.prototype.union=function(e){if(null!==e&&void 0!==e){if(!(e instanceof i))throw new Error("union with non-Set");for(var t=e.b.length,n=0;t>n;++n)this.add(e.b[n])}},i.prototype.filter=function(e){var t=new this.constructor;return t.b=this.b.filter(e),t},i.prototype.map=function(e){for(var t=new this.constructor,n=0;n<this.b.length;++n){var i=e(this.b[n]);void 0!==i&&t.add(i)}return t},i.prototype.forEach=function(e){this.b.forEach(e)},i.prototype.toString=function(){return this.b.join(", ")},i.prototype.size=function(){return this.b.length},i.prototype.has=function(e){return this.b.indexOf(e)>=0},i.prototype.toArray=function(){return this.b.slice()},t.Set=i}),define("salve/datatypes/errors",["require","exports","module","../oop","lodash"],function(e,t,n){"use strict";function i(e){this.message=e}function r(e){this.message=e}function o(e,t){var n=e+": "+l.map(t,function(e){return e.toString()}).join("\n"),i=new Error(n);this.errors=t,this.name="ParameterParsingError",this.stack=i.stack,this.message=i.message}function a(e){var t=l.map(e,function(e){return e.toString()}).join("\n"),n=new Error(t);this.errors=e,this.name="ValueValidationError",
this.stack=n.stack,this.message=n.message}var s=e("../oop"),l=e("lodash");i.prototype.toString=function(){return this.message},r.prototype.toString=function(){return this.message},s.inherit(o,Error),s.inherit(a,Error),t.ParamError=i,t.ValueError=r,t.ParameterParsingError=o,t.ValueValidationError=a}),define("salve/datatypes/builtin",["require","exports","module","lodash","../oop","./errors"],function(e,t,n){"use strict";function i(e){return e.trim().replace(/\s{2,}/g," ")}var r=e("lodash"),o=(e("../oop"),e("./errors")),a=o.ParameterParsingError,s=o.ParamError,l=o.ValueValidationError,d={parseParams:function(e,t){if(t&&t.length>0)throw new a(e,new s("this type does not accept parameters"))},parseValue:function(e,t){var n=this.disallows(e,[],t);if(n.length)throw new l(n);return{value:e}}},c=r.extend({},d,{equal:function(e,t,n,i){if(void 0===t.value)throw Error("it looks like you are trying to use an unparsed value");return e===t.value},disallows:function(e,t,n){return!1},regexp:/.*/,needs_context:!1}),h=r.extend({},d,{equal:function(e,t,n){if(void 0===t.value)throw Error("it looks like you are trying to use an unparsed value");return i(e)===i(t.value)},disallows:function(e,t,n){return!1},regexp:/.*/,needs_context:!1}),u={uri:"",types:{string:c,token:h}};t.builtin=u}),define("salve/datatypes/xmlcharacters",["require","exports","module"],function(e,t,n){"use strict";var i="A-Z_a-z----------------------------------------------------------------------------------------------------------------------------------------------------",r="--",o=i+r,a="0-9--------------",s="------------------------------------------------------------------",l="---",d="-"+o+a+"._:"+s+l,c="["+o+"_:](?:["+d+"])*",h=new RegExp("^"+c+"$"),u="["+o+"_](?:[-"+o+a+"._"+s+l+"])*",p=new RegExp("^"+u+"$");t.xml_Name_re=h,t.xml_NCName=u,t.xml_NCName_re=p,t.xml_Name_Char=d,t.xml_Letter=o});var XRegExp;XRegExp=XRegExp||function(e){"use strict";function t(e,t,n){var i;for(i in c.prototype)c.prototype.hasOwnProperty(i)&&(e[i]=c.prototype[i]);return e.xregexp={captureNames:t,isNative:!!n},e}function n(e){return(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":"")}function i(e,i,r){if(!c.isRegExp(e))throw new TypeError("type RegExp expected");var o=_.replace.call(n(e)+(i||""),C,"");return r&&(o=_.replace.call(o,new RegExp("["+r+"]+","g"),"")),e=e.xregexp&&!e.xregexp.isNative?t(c(e.source,o),e.xregexp.captureNames?e.xregexp.captureNames.slice(0):null):t(new RegExp(e.source,o),null,!0)}function r(e,t){var n=e.length;if(Array.prototype.lastIndexOf)return e.lastIndexOf(t);for(;n--;)if(e[n]===t)return n;return-1}function o(e,t){return Object.prototype.toString.call(e).toLowerCase()==="[object "+t+"]"}function a(e){return e=e||{},"all"===e||e.all?e={natives:!0,extensibility:!0}:o(e,"string")&&(e=c.forEach(e,/[^\s,]+/,function(e){this[e]=!0},{})),e}function s(e,t,n,i){var r,o,a=m.length,s=null;B=!0;try{for(;a--;)if(o=m[a],("all"===o.scope||o.scope===n)&&(!o.trigger||o.trigger.call(i))&&(o.pattern.lastIndex=t,r=f.exec.call(o.pattern,e),r&&r.index===t)){s={output:o.handler.call(i,r,n),match:r};break}}catch(l){throw l}finally{B=!1}return s}function l(e){c.addToken=h[e?"on":"off"],p.extensibility=e}function d(e){RegExp.prototype.exec=(e?f:_).exec,RegExp.prototype.test=(e?f:_).test,String.prototype.match=(e?f:_).match,String.prototype.replace=(e?f:_).replace,String.prototype.split=(e?f:_).split,p.natives=e}var c,h,u,p={natives:!1,extensibility:!1},_={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},f={},E={},m=[],A="default",v="class",F={"default":/^(?:\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9]\d*|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S])|\(\?[:=!]|[?*+]\?|{\d+(?:,\d*)?}\??)/,"class":/^(?:\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S]))/},g=/\$(?:{([\w$]+)}|(\d\d?|[\s\S]))/g,C=/([\s\S])(?=[\s\S]*\1)/g,D=/^(?:[?*+]|{\d+(?:,\d*)?})\??/,y=_.exec.call(/()??/,"")[1]===e,w=RegExp.prototype.sticky!==e,B=!1,b="gim"+(w?"y":"");return c=function(n,r){if(c.isRegExp(n)){if(r!==e)throw new TypeError("can't supply flags when constructing one RegExp from another");return i(n)}if(B)throw new Error("can't call the XRegExp constructor within token definition functions");var o,a,l,d=[],h=A,u={hasNamedCapture:!1,captureNames:[],hasFlag:function(e){return r.indexOf(e)>-1}},p=0;if(n=n===e?"":String(n),r=r===e?"":String(r),_.match.call(r,C))throw new SyntaxError("invalid duplicate regular expression flag");for(n=_.replace.call(n,/^\(\?([\w$]+)\)/,function(e,t){if(_.test.call(/[gy]/,t))throw new SyntaxError("can't use flag g or y in mode modifier");return r=_.replace.call(r+t,C,""),""}),c.forEach(r,/[\s\S]/,function(e){if(b.indexOf(e[0])<0)throw new SyntaxError("invalid regular expression flag "+e[0])});p<n.length;)o=s(n,p,h,u),o?(d.push(o.output),p+=o.match[0].length||1):(a=_.exec.call(F[h],n.slice(p)),a?(d.push(a[0]),p+=a[0].length):(l=n.charAt(p),"["===l?h=v:"]"===l&&(h=A),d.push(l),++p));return t(new RegExp(d.join(""),_.replace.call(r,/[^gimy]+/g,"")),u.hasNamedCapture?u.captureNames:null)},h={on:function(e,t,n){n=n||{},e&&m.push({pattern:i(e,"g"+(w?"y":"")),handler:t,scope:n.scope||A,trigger:n.trigger||null}),n.customFlags&&(b=_.replace.call(b+n.customFlags,C,""))},off:function(){throw new Error("extensibility must be installed before using addToken")}},c.addToken=h.off,c.cache=function(e,t){var n=e+"/"+(t||"");return E[n]||(E[n]=c(e,t))},c.escape=function(e){return _.replace.call(e,/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},c.exec=function(e,t,n,r){var o,a=i(t,"g"+(r&&w?"y":""),r===!1?"y":"");return a.lastIndex=n=n||0,o=f.exec.call(a,e),r&&o&&o.index!==n&&(o=null),t.global&&(t.lastIndex=o?a.lastIndex:0),o},c.forEach=function(e,t,n,i){for(var r,o=0,a=-1;r=c.exec(e,t,o);)n.call(i,r,++a,e,t),o=r.index+(r[0].length||1);return i},c.globalize=function(e){return i(e,"g")},c.install=function(e){e=a(e),!p.natives&&e.natives&&d(!0),!p.extensibility&&e.extensibility&&l(!0)},c.isInstalled=function(e){return!!p[e]},c.isRegExp=function(e){return o(e,"regexp")},c.matchChain=function(e,t){return function n(e,i){var r,o=t[i].regex?t[i]:{regex:t[i]},a=[],s=function(e){a.push(o.backref?e[o.backref]||"":e[0])};for(r=0;r<e.length;++r)c.forEach(e[r],o.regex,s);return i!==t.length-1&&a.length?n(a,i+1):a}([e],0)},c.replace=function(t,n,r,o){var a,s=c.isRegExp(n),l=n;return s?(o===e&&n.global&&(o="all"),l=i(n,"all"===o?"g":"","all"===o?"":"g")):"all"===o&&(l=new RegExp(c.escape(String(n)),"g")),a=f.replace.call(String(t),l,r),s&&n.global&&(n.lastIndex=0),a},c.split=function(e,t,n){return f.split.call(e,t,n)},c.test=function(e,t,n,i){return!!c.exec(e,t,n,i)},c.uninstall=function(e){e=a(e),p.natives&&e.natives&&d(!1),p.extensibility&&e.extensibility&&l(!1)},c.union=function(e,t){var n,i,r,a,s=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,l=0,d=function(e,t,r){var o=i[l-n];if(t){if(++l,o)return"(?<"+o+">"}else if(r)return"\\"+(+r+n);return e},h=[];if(!o(e,"array")||!e.length)throw new TypeError("patterns must be a nonempty array");for(a=0;a<e.length;++a)r=e[a],c.isRegExp(r)?(n=l,i=r.xregexp&&r.xregexp.captureNames||[],h.push(c(r.source).source.replace(s,d))):h.push(c.escape(r));return c(h.join("|"),t)},c.version="2.0.0",f.exec=function(t){var i,o,a,s,l;if(this.global||(s=this.lastIndex),i=_.exec.apply(this,arguments)){if(!y&&i.length>1&&r(i,"")>-1&&(a=new RegExp(this.source,_.replace.call(n(this),"g","")),_.replace.call(String(t).slice(i.index),a,function(){var t;for(t=1;t<arguments.length-2;++t)arguments[t]===e&&(i[t]=e)})),this.xregexp&&this.xregexp.captureNames)for(l=1;l<i.length;++l)o=this.xregexp.captureNames[l-1],o&&(i[o]=i[l]);this.global&&!i[0].length&&this.lastIndex>i.index&&(this.lastIndex=i.index)}return this.global||(this.lastIndex=s),i},f.test=function(e){return!!f.exec.call(this,e)},f.match=function(e){if(c.isRegExp(e)){if(e.global){var t=_.match.apply(this,arguments);return e.lastIndex=0,t}}else e=new RegExp(e);return f.exec.call(e,this)},f.replace=function(e,t){var n,i,a,s,l=c.isRegExp(e);return l?(e.xregexp&&(n=e.xregexp.captureNames),e.global||(s=e.lastIndex)):e+="",o(t,"function")?i=_.replace.call(String(this),e,function(){var i,r=arguments;if(n)for(r[0]=new String(r[0]),i=0;i<n.length;++i)n[i]&&(r[0][n[i]]=r[i+1]);return l&&e.global&&(e.lastIndex=r[r.length-2]+r[0].length),t.apply(null,r)}):(a=String(this),i=_.replace.call(a,e,function(){var e=arguments;return _.replace.call(String(t),g,function(t,i,o){var a;if(i){if(a=+i,a<=e.length-3)return e[a]||"";if(a=n?r(n,i):-1,0>a)throw new SyntaxError("backreference to undefined group "+t);return e[a+1]||""}if("$"===o)return"$";if("&"===o||0===+o)return e[0];if("`"===o)return e[e.length-1].slice(0,e[e.length-2]);if("'"===o)return e[e.length-1].slice(e[e.length-2]+e[0].length);if(o=+o,!isNaN(o)){if(o>e.length-3)throw new SyntaxError("backreference to undefined group "+t);return e[o]||""}throw new SyntaxError("invalid token "+t)})})),l&&(e.global?e.lastIndex=0:e.lastIndex=s),i},f.split=function(t,n){if(!c.isRegExp(t))return _.split.apply(this,arguments);var i,r=String(this),o=t.lastIndex,a=[],s=0;return n=(n===e?-1:n)>>>0,c.forEach(r,t,function(e){e.index+e[0].length>s&&(a.push(r.slice(s,e.index)),e.length>1&&e.index<r.length&&Array.prototype.push.apply(a,e.slice(1)),i=e[0].length,s=e.index+i)}),s===r.length?(!_.test.call(t,"")||i)&&a.push(""):a.push(r.slice(s)),t.lastIndex=o,a.length>n?a.slice(0,n):a},u=h.on,u(/\\([ABCE-RTUVXYZaeg-mopqyz]|c(?![A-Za-z])|u(?![\dA-Fa-f]{4})|x(?![\dA-Fa-f]{2}))/,function(e,t){if("B"===e[1]&&t===A)return e[0];throw new SyntaxError("invalid escape "+e[0])},{scope:"all"}),u(/\[(\^?)]/,function(e){return e[1]?"[\\s\\S]":"\\b\\B"}),u(/(?:\(\?#[^)]*\))+/,function(e){return _.test.call(D,e.input.slice(e.index+e[0].length))?"":"(?:)"}),u(/\\k<([\w$]+)>/,function(e){var t=isNaN(e[1])?r(this.captureNames,e[1])+1:+e[1],n=e.index+e[0].length;if(!t||t>this.captureNames.length)throw new SyntaxError("backreference to undefined group "+e[0]);return"\\"+t+(n===e.input.length||isNaN(e.input.charAt(n))?"":"(?:)")}),u(/(?:\s+|#.*)+/,function(e){return _.test.call(D,e.input.slice(e.index+e[0].length))?"":"(?:)"},{trigger:function(){return this.hasFlag("x")},customFlags:"x"}),u(/\./,function(){return"[\\s\\S]"},{trigger:function(){return this.hasFlag("s")},customFlags:"s"}),u(/\(\?P?<([\w$]+)>/,function(e){if(!isNaN(e[1]))throw new SyntaxError("can't use integer as capture name "+e[0]);return this.captureNames.push(e[1]),this.hasNamedCapture=!0,"("}),u(/\\(\d+)/,function(e,t){if(!(t===A&&/^[1-9]/.test(e[1])&&+e[1]<=this.captureNames.length)&&"0"!==e[1])throw new SyntaxError("can't use octal escape or backreference to undefined group "+e[0]);return e[0]},{scope:"all"}),u(/\((?!\?)/,function(){return this.hasFlag("n")?"(?:":(this.captureNames.push(null),"(")},{customFlags:"n"}),"undefined"!=typeof exports&&(exports.XRegExp=c),c}(),function(e){"use strict";function t(e){return e.replace(/[- _]+/g,"").toLowerCase()}function n(e){return e.replace(/\w{4}/g,"\\u$&")}function i(e){for(;e.length<4;)e="0"+e;return e}function r(e){return parseInt(e,16)}function o(e){return parseInt(e,10).toString(16)}function a(t){var n,a=[],s=-1;return e.forEach(t,/\\u(\w{4})(?:-\\u(\w{4}))?/,function(e){n=r(e[1]),n>s+1&&(a.push("\\u"+i(o(s+1))),n>s+2&&a.push("-\\u"+i(o(n-1)))),s=r(e[2]||e[1])}),65535>s&&(a.push("\\u"+i(o(s+1))),65534>s&&a.push("-\\uFFFF")),a.join("")}function s(e){return l["^"+e]||(l["^"+e]=a(l[e]))}var l={};e.install("extensibility"),e.addUnicodePackage=function(i,r){var o;if(!e.isInstalled("extensibility"))throw new Error("extensibility must be installed before adding Unicode packages");if(i)for(o in i)i.hasOwnProperty(o)&&(l[t(o)]=n(i[o]));if(r)for(o in r)r.hasOwnProperty(o)&&(l[t(r[o])]=l[t(o)])},e.addUnicodePackage({L:"0041-005A0061-007A00AA00B500BA00C0-00D600D8-00F600F8-02C102C6-02D102E0-02E402EC02EE0370-037403760377037A-037D03860388-038A038C038E-03A103A3-03F503F7-0481048A-05270531-055605590561-058705D0-05EA05F0-05F20620-064A066E066F0671-06D306D506E506E606EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA07F407F507FA0800-0815081A082408280840-085808A008A2-08AC0904-0939093D09500958-09610971-09770979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10CF10CF20D05-0D0C0D0E-0D100D12-0D3A0D3D0D4E0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E460E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EC60EDC-0EDF0F000F40-0F470F49-0F6C0F88-0F8C1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10A0-10C510C710CD10D0-10FA10FC-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317D717DC1820-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541AA71B05-1B331B45-1B4B1B83-1BA01BAE1BAF1BBA-1BE51C00-1C231C4D-1C4F1C5A-1C7D1CE9-1CEC1CEE-1CF11CF51CF61D00-1DBF1E00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FBC1FBE1FC2-1FC41FC6-1FCC1FD0-1FD31FD6-1FDB1FE0-1FEC1FF2-1FF41FF6-1FFC2071207F2090-209C21022107210A-211321152119-211D212421262128212A-212D212F-2139213C-213F2145-2149214E218321842C00-2C2E2C30-2C5E2C60-2CE42CEB-2CEE2CF22CF32D00-2D252D272D2D2D30-2D672D6F2D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2E2F300530063031-3035303B303C3041-3096309D-309F30A1-30FA30FC-30FF3105-312D3131-318E31A0-31BA31F0-31FF3400-4DB54E00-9FCCA000-A48CA4D0-A4FDA500-A60CA610-A61FA62AA62BA640-A66EA67F-A697A6A0-A6E5A717-A71FA722-A788A78B-A78EA790-A793A7A0-A7AAA7F8-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2A9CFAA00-AA28AA40-AA42AA44-AA4BAA60-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADB-AADDAAE0-AAEAAAF2-AAF4AB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2EABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF21-FF3AFF41-FF5AFF66-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC"},{L:"Letter"}),e.addToken(/\\([pP]){(\^?)([^}]*)}/,function(e,n){var i="P"===e[1]||e[2]?"^":"",r=t(e[3]);if("P"===e[1]&&e[2])throw new SyntaxError("invalid double negation \\P{^");if(!l.hasOwnProperty(r))throw new SyntaxError("invalid or unknown Unicode property "+e[0]);return"class"===n?i?s(r):l[r]:"["+i+l[r]+"]"},{scope:"all"})}(XRegExp),function(e){"use strict";if(!e.addUnicodePackage)throw new ReferenceError("Unicode Base must be loaded before Unicode Categories");e.install("extensibility"),e.addUnicodePackage({Ll:"0061-007A00B500DF-00F600F8-00FF01010103010501070109010B010D010F01110113011501170119011B011D011F01210123012501270129012B012D012F01310133013501370138013A013C013E014001420144014601480149014B014D014F01510153015501570159015B015D015F01610163016501670169016B016D016F0171017301750177017A017C017E-0180018301850188018C018D019201950199-019B019E01A101A301A501A801AA01AB01AD01B001B401B601B901BA01BD-01BF01C601C901CC01CE01D001D201D401D601D801DA01DC01DD01DF01E101E301E501E701E901EB01ED01EF01F001F301F501F901FB01FD01FF02010203020502070209020B020D020F02110213021502170219021B021D021F02210223022502270229022B022D022F02310233-0239023C023F0240024202470249024B024D024F-02930295-02AF037103730377037B-037D039003AC-03CE03D003D103D5-03D703D903DB03DD03DF03E103E303E503E703E903EB03ED03EF-03F303F503F803FB03FC0430-045F04610463046504670469046B046D046F04710473047504770479047B047D047F0481048B048D048F04910493049504970499049B049D049F04A104A304A504A704A904AB04AD04AF04B104B304B504B704B904BB04BD04BF04C204C404C604C804CA04CC04CE04CF04D104D304D504D704D904DB04DD04DF04E104E304E504E704E904EB04ED04EF04F104F304F504F704F904FB04FD04FF05010503050505070509050B050D050F05110513051505170519051B051D051F05210523052505270561-05871D00-1D2B1D6B-1D771D79-1D9A1E011E031E051E071E091E0B1E0D1E0F1E111E131E151E171E191E1B1E1D1E1F1E211E231E251E271E291E2B1E2D1E2F1E311E331E351E371E391E3B1E3D1E3F1E411E431E451E471E491E4B1E4D1E4F1E511E531E551E571E591E5B1E5D1E5F1E611E631E651E671E691E6B1E6D1E6F1E711E731E751E771E791E7B1E7D1E7F1E811E831E851E871E891E8B1E8D1E8F1E911E931E95-1E9D1E9F1EA11EA31EA51EA71EA91EAB1EAD1EAF1EB11EB31EB51EB71EB91EBB1EBD1EBF1EC11EC31EC51EC71EC91ECB1ECD1ECF1ED11ED31ED51ED71ED91EDB1EDD1EDF1EE11EE31EE51EE71EE91EEB1EED1EEF1EF11EF31EF51EF71EF91EFB1EFD1EFF-1F071F10-1F151F20-1F271F30-1F371F40-1F451F50-1F571F60-1F671F70-1F7D1F80-1F871F90-1F971FA0-1FA71FB0-1FB41FB61FB71FBE1FC2-1FC41FC61FC71FD0-1FD31FD61FD71FE0-1FE71FF2-1FF41FF61FF7210A210E210F2113212F21342139213C213D2146-2149214E21842C30-2C5E2C612C652C662C682C6A2C6C2C712C732C742C76-2C7B2C812C832C852C872C892C8B2C8D2C8F2C912C932C952C972C992C9B2C9D2C9F2CA12CA32CA52CA72CA92CAB2CAD2CAF2CB12CB32CB52CB72CB92CBB2CBD2CBF2CC12CC32CC52CC72CC92CCB2CCD2CCF2CD12CD32CD52CD72CD92CDB2CDD2CDF2CE12CE32CE42CEC2CEE2CF32D00-2D252D272D2DA641A643A645A647A649A64BA64DA64FA651A653A655A657A659A65BA65DA65FA661A663A665A667A669A66BA66DA681A683A685A687A689A68BA68DA68FA691A693A695A697A723A725A727A729A72BA72DA72F-A731A733A735A737A739A73BA73DA73FA741A743A745A747A749A74BA74DA74FA751A753A755A757A759A75BA75DA75FA761A763A765A767A769A76BA76DA76FA771-A778A77AA77CA77FA781A783A785A787A78CA78EA791A793A7A1A7A3A7A5A7A7A7A9A7FAFB00-FB06FB13-FB17FF41-FF5A",Lu:"0041-005A00C0-00D600D8-00DE01000102010401060108010A010C010E01100112011401160118011A011C011E01200122012401260128012A012C012E01300132013401360139013B013D013F0141014301450147014A014C014E01500152015401560158015A015C015E01600162016401660168016A016C016E017001720174017601780179017B017D018101820184018601870189-018B018E-0191019301940196-0198019C019D019F01A001A201A401A601A701A901AC01AE01AF01B1-01B301B501B701B801BC01C401C701CA01CD01CF01D101D301D501D701D901DB01DE01E001E201E401E601E801EA01EC01EE01F101F401F6-01F801FA01FC01FE02000202020402060208020A020C020E02100212021402160218021A021C021E02200222022402260228022A022C022E02300232023A023B023D023E02410243-02460248024A024C024E03700372037603860388-038A038C038E038F0391-03A103A3-03AB03CF03D2-03D403D803DA03DC03DE03E003E203E403E603E803EA03EC03EE03F403F703F903FA03FD-042F04600462046404660468046A046C046E04700472047404760478047A047C047E0480048A048C048E04900492049404960498049A049C049E04A004A204A404A604A804AA04AC04AE04B004B204B404B604B804BA04BC04BE04C004C104C304C504C704C904CB04CD04D004D204D404D604D804DA04DC04DE04E004E204E404E604E804EA04EC04EE04F004F204F404F604F804FA04FC04FE05000502050405060508050A050C050E05100512051405160518051A051C051E05200522052405260531-055610A0-10C510C710CD1E001E021E041E061E081E0A1E0C1E0E1E101E121E141E161E181E1A1E1C1E1E1E201E221E241E261E281E2A1E2C1E2E1E301E321E341E361E381E3A1E3C1E3E1E401E421E441E461E481E4A1E4C1E4E1E501E521E541E561E581E5A1E5C1E5E1E601E621E641E661E681E6A1E6C1E6E1E701E721E741E761E781E7A1E7C1E7E1E801E821E841E861E881E8A1E8C1E8E1E901E921E941E9E1EA01EA21EA41EA61EA81EAA1EAC1EAE1EB01EB21EB41EB61EB81EBA1EBC1EBE1EC01EC21EC41EC61EC81ECA1ECC1ECE1ED01ED21ED41ED61ED81EDA1EDC1EDE1EE01EE21EE41EE61EE81EEA1EEC1EEE1EF01EF21EF41EF61EF81EFA1EFC1EFE1F08-1F0F1F18-1F1D1F28-1F2F1F38-1F3F1F48-1F4D1F591F5B1F5D1F5F1F68-1F6F1FB8-1FBB1FC8-1FCB1FD8-1FDB1FE8-1FEC1FF8-1FFB21022107210B-210D2110-211221152119-211D212421262128212A-212D2130-2133213E213F214521832C00-2C2E2C602C62-2C642C672C692C6B2C6D-2C702C722C752C7E-2C802C822C842C862C882C8A2C8C2C8E2C902C922C942C962C982C9A2C9C2C9E2CA02CA22CA42CA62CA82CAA2CAC2CAE2CB02CB22CB42CB62CB82CBA2CBC2CBE2CC02CC22CC42CC62CC82CCA2CCC2CCE2CD02CD22CD42CD62CD82CDA2CDC2CDE2CE02CE22CEB2CED2CF2A640A642A644A646A648A64AA64CA64EA650A652A654A656A658A65AA65CA65EA660A662A664A666A668A66AA66CA680A682A684A686A688A68AA68CA68EA690A692A694A696A722A724A726A728A72AA72CA72EA732A734A736A738A73AA73CA73EA740A742A744A746A748A74AA74CA74EA750A752A754A756A758A75AA75CA75EA760A762A764A766A768A76AA76CA76EA779A77BA77DA77EA780A782A784A786A78BA78DA790A792A7A0A7A2A7A4A7A6A7A8A7AAFF21-FF3A",Lt:"01C501C801CB01F21F88-1F8F1F98-1F9F1FA8-1FAF1FBC1FCC1FFC",Lm:"02B0-02C102C6-02D102E0-02E402EC02EE0374037A0559064006E506E607F407F507FA081A0824082809710E460EC610FC17D718431AA71C78-1C7D1D2C-1D6A1D781D9B-1DBF2071207F2090-209C2C7C2C7D2D6F2E2F30053031-3035303B309D309E30FC-30FEA015A4F8-A4FDA60CA67FA717-A71FA770A788A7F8A7F9A9CFAA70AADDAAF3AAF4FF70FF9EFF9F",Lo:"00AA00BA01BB01C0-01C3029405D0-05EA05F0-05F20620-063F0641-064A066E066F0671-06D306D506EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA0800-08150840-085808A008A2-08AC0904-0939093D09500958-09610972-09770979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10CF10CF20D05-0D0C0D0E-0D100D12-0D3A0D3D0D4E0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E450E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EDC-0EDF0F000F40-0F470F49-0F6C0F88-0F8C1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10D0-10FA10FD-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317DC1820-18421844-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541B05-1B331B45-1B4B1B83-1BA01BAE1BAF1BBA-1BE51C00-1C231C4D-1C4F1C5A-1C771CE9-1CEC1CEE-1CF11CF51CF62135-21382D30-2D672D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE3006303C3041-3096309F30A1-30FA30FF3105-312D3131-318E31A0-31BA31F0-31FF3400-4DB54E00-9FCCA000-A014A016-A48CA4D0-A4F7A500-A60BA610-A61FA62AA62BA66EA6A0-A6E5A7FB-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2AA00-AA28AA40-AA42AA44-AA4BAA60-AA6FAA71-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADBAADCAAE0-AAEAAAF2AB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2EABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA6DFA70-FAD9FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF66-FF6FFF71-FF9DFFA0-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",M:"0300-036F0483-04890591-05BD05BF05C105C205C405C505C70610-061A064B-065F067006D6-06DC06DF-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0859-085B08E4-08FE0900-0903093A-093C093E-094F0951-0957096209630981-098309BC09BE-09C409C709C809CB-09CD09D709E209E30A01-0A030A3C0A3E-0A420A470A480A4B-0A4D0A510A700A710A750A81-0A830ABC0ABE-0AC50AC7-0AC90ACB-0ACD0AE20AE30B01-0B030B3C0B3E-0B440B470B480B4B-0B4D0B560B570B620B630B820BBE-0BC20BC6-0BC80BCA-0BCD0BD70C01-0C030C3E-0C440C46-0C480C4A-0C4D0C550C560C620C630C820C830CBC0CBE-0CC40CC6-0CC80CCA-0CCD0CD50CD60CE20CE30D020D030D3E-0D440D46-0D480D4A-0D4D0D570D620D630D820D830DCA0DCF-0DD40DD60DD8-0DDF0DF20DF30E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F3E0F3F0F71-0F840F860F870F8D-0F970F99-0FBC0FC6102B-103E1056-1059105E-10601062-10641067-106D1071-10741082-108D108F109A-109D135D-135F1712-17141732-1734175217531772177317B4-17D317DD180B-180D18A91920-192B1930-193B19B0-19C019C819C91A17-1A1B1A55-1A5E1A60-1A7C1A7F1B00-1B041B34-1B441B6B-1B731B80-1B821BA1-1BAD1BE6-1BF31C24-1C371CD0-1CD21CD4-1CE81CED1CF2-1CF41DC0-1DE61DFC-1DFF20D0-20F02CEF-2CF12D7F2DE0-2DFF302A-302F3099309AA66F-A672A674-A67DA69FA6F0A6F1A802A806A80BA823-A827A880A881A8B4-A8C4A8E0-A8F1A926-A92DA947-A953A980-A983A9B3-A9C0AA29-AA36AA43AA4CAA4DAA7BAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1AAEB-AAEFAAF5AAF6ABE3-ABEAABECABEDFB1EFE00-FE0FFE20-FE26",Mn:"0300-036F0483-04870591-05BD05BF05C105C205C405C505C70610-061A064B-065F067006D6-06DC06DF-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0859-085B08E4-08FE0900-0902093A093C0941-0948094D0951-095709620963098109BC09C1-09C409CD09E209E30A010A020A3C0A410A420A470A480A4B-0A4D0A510A700A710A750A810A820ABC0AC1-0AC50AC70AC80ACD0AE20AE30B010B3C0B3F0B41-0B440B4D0B560B620B630B820BC00BCD0C3E-0C400C46-0C480C4A-0C4D0C550C560C620C630CBC0CBF0CC60CCC0CCD0CE20CE30D41-0D440D4D0D620D630DCA0DD2-0DD40DD60E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F71-0F7E0F80-0F840F860F870F8D-0F970F99-0FBC0FC6102D-10301032-10371039103A103D103E10581059105E-10601071-1074108210851086108D109D135D-135F1712-17141732-1734175217531772177317B417B517B7-17BD17C617C9-17D317DD180B-180D18A91920-19221927192819321939-193B1A171A181A561A58-1A5E1A601A621A65-1A6C1A73-1A7C1A7F1B00-1B031B341B36-1B3A1B3C1B421B6B-1B731B801B811BA2-1BA51BA81BA91BAB1BE61BE81BE91BED1BEF-1BF11C2C-1C331C361C371CD0-1CD21CD4-1CE01CE2-1CE81CED1CF41DC0-1DE61DFC-1DFF20D0-20DC20E120E5-20F02CEF-2CF12D7F2DE0-2DFF302A-302D3099309AA66FA674-A67DA69FA6F0A6F1A802A806A80BA825A826A8C4A8E0-A8F1A926-A92DA947-A951A980-A982A9B3A9B6-A9B9A9BCAA29-AA2EAA31AA32AA35AA36AA43AA4CAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1AAECAAEDAAF6ABE5ABE8ABEDFB1EFE00-FE0FFE20-FE26",Mc:"0903093B093E-09400949-094C094E094F0982098309BE-09C009C709C809CB09CC09D70A030A3E-0A400A830ABE-0AC00AC90ACB0ACC0B020B030B3E0B400B470B480B4B0B4C0B570BBE0BBF0BC10BC20BC6-0BC80BCA-0BCC0BD70C01-0C030C41-0C440C820C830CBE0CC0-0CC40CC70CC80CCA0CCB0CD50CD60D020D030D3E-0D400D46-0D480D4A-0D4C0D570D820D830DCF-0DD10DD8-0DDF0DF20DF30F3E0F3F0F7F102B102C10311038103B103C105610571062-10641067-106D108310841087-108C108F109A-109C17B617BE-17C517C717C81923-19261929-192B193019311933-193819B0-19C019C819C91A19-1A1B1A551A571A611A631A641A6D-1A721B041B351B3B1B3D-1B411B431B441B821BA11BA61BA71BAA1BAC1BAD1BE71BEA-1BEC1BEE1BF21BF31C24-1C2B1C341C351CE11CF21CF3302E302FA823A824A827A880A881A8B4-A8C3A952A953A983A9B4A9B5A9BAA9BBA9BD-A9C0AA2FAA30AA33AA34AA4DAA7BAAEBAAEEAAEFAAF5ABE3ABE4ABE6ABE7ABE9ABEAABEC",Me:"0488048920DD-20E020E2-20E4A670-A672",N:"0030-003900B200B300B900BC-00BE0660-066906F0-06F907C0-07C90966-096F09E6-09EF09F4-09F90A66-0A6F0AE6-0AEF0B66-0B6F0B72-0B770BE6-0BF20C66-0C6F0C78-0C7E0CE6-0CEF0D66-0D750E50-0E590ED0-0ED90F20-0F331040-10491090-10991369-137C16EE-16F017E0-17E917F0-17F91810-18191946-194F19D0-19DA1A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C5920702074-20792080-20892150-21822185-21892460-249B24EA-24FF2776-27932CFD30073021-30293038-303A3192-31953220-32293248-324F3251-325F3280-328932B1-32BFA620-A629A6E6-A6EFA830-A835A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",Nd:"0030-00390660-066906F0-06F907C0-07C90966-096F09E6-09EF0A66-0A6F0AE6-0AEF0B66-0B6F0BE6-0BEF0C66-0C6F0CE6-0CEF0D66-0D6F0E50-0E590ED0-0ED90F20-0F291040-10491090-109917E0-17E91810-18191946-194F19D0-19D91A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C59A620-A629A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",Nl:"16EE-16F02160-21822185-218830073021-30293038-303AA6E6-A6EF",No:"00B200B300B900BC-00BE09F4-09F90B72-0B770BF0-0BF20C78-0C7E0D70-0D750F2A-0F331369-137C17F0-17F919DA20702074-20792080-20892150-215F21892460-249B24EA-24FF2776-27932CFD3192-31953220-32293248-324F3251-325F3280-328932B1-32BFA830-A835",P:"0021-00230025-002A002C-002F003A003B003F0040005B-005D005F007B007D00A100A700AB00B600B700BB00BF037E0387055A-055F0589058A05BE05C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E085E0964096509700AF00DF40E4F0E5A0E5B0F04-0F120F140F3A-0F3D0F850FD0-0FD40FD90FDA104A-104F10FB1360-13681400166D166E169B169C16EB-16ED1735173617D4-17D617D8-17DA1800-180A194419451A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601BFC-1BFF1C3B-1C3F1C7E1C7F1CC0-1CC71CD32010-20272030-20432045-20512053-205E207D207E208D208E2329232A2768-277527C527C627E6-27EF2983-299829D8-29DB29FC29FD2CF9-2CFC2CFE2CFF2D702E00-2E2E2E30-2E3B3001-30033008-30113014-301F3030303D30A030FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFAAF0AAF1ABEBFD3EFD3FFE10-FE19FE30-FE52FE54-FE61FE63FE68FE6AFE6BFF01-FF03FF05-FF0AFF0C-FF0FFF1AFF1BFF1FFF20FF3B-FF3DFF3FFF5BFF5DFF5F-FF65",Pd:"002D058A05BE140018062010-20152E172E1A2E3A2E3B301C303030A0FE31FE32FE58FE63FF0D",Ps:"0028005B007B0F3A0F3C169B201A201E2045207D208D23292768276A276C276E27702772277427C527E627E827EA27EC27EE2983298529872989298B298D298F299129932995299729D829DA29FC2E222E242E262E283008300A300C300E3010301430163018301A301DFD3EFE17FE35FE37FE39FE3BFE3DFE3FFE41FE43FE47FE59FE5BFE5DFF08FF3BFF5BFF5FFF62",Pe:"0029005D007D0F3B0F3D169C2046207E208E232A2769276B276D276F27712773277527C627E727E927EB27ED27EF298429862988298A298C298E2990299229942996299829D929DB29FD2E232E252E272E293009300B300D300F3011301530173019301B301E301FFD3FFE18FE36FE38FE3AFE3CFE3EFE40FE42FE44FE48FE5AFE5CFE5EFF09FF3DFF5DFF60FF63",Pi:"00AB2018201B201C201F20392E022E042E092E0C2E1C2E20",Pf:"00BB2019201D203A2E032E052E0A2E0D2E1D2E21",Pc:"005F203F20402054FE33FE34FE4D-FE4FFF3F",Po:"0021-00230025-0027002A002C002E002F003A003B003F0040005C00A100A700B600B700BF037E0387055A-055F058905C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E085E0964096509700AF00DF40E4F0E5A0E5B0F04-0F120F140F850FD0-0FD40FD90FDA104A-104F10FB1360-1368166D166E16EB-16ED1735173617D4-17D617D8-17DA1800-18051807-180A194419451A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601BFC-1BFF1C3B-1C3F1C7E1C7F1CC0-1CC71CD3201620172020-20272030-2038203B-203E2041-20432047-205120532055-205E2CF9-2CFC2CFE2CFF2D702E002E012E06-2E082E0B2E0E-2E162E182E192E1B2E1E2E1F2E2A-2E2E2E30-2E393001-3003303D30FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFAAF0AAF1ABEBFE10-FE16FE19FE30FE45FE46FE49-FE4CFE50-FE52FE54-FE57FE5F-FE61FE68FE6AFE6BFF01-FF03FF05-FF07FF0AFF0CFF0EFF0FFF1AFF1BFF1FFF20FF3CFF61FF64FF65",S:"0024002B003C-003E005E0060007C007E00A2-00A600A800A900AC00AE-00B100B400B800D700F702C2-02C502D2-02DF02E5-02EB02ED02EF-02FF03750384038503F60482058F0606-0608060B060E060F06DE06E906FD06FE07F609F209F309FA09FB0AF10B700BF3-0BFA0C7F0D790E3F0F01-0F030F130F15-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F1390-139917DB194019DE-19FF1B61-1B6A1B74-1B7C1FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE20442052207A-207C208A-208C20A0-20B9210021012103-21062108210921142116-2118211E-2123212521272129212E213A213B2140-2144214A-214D214F2190-2328232B-23F32400-24262440-244A249C-24E92500-26FF2701-27672794-27C427C7-27E527F0-29822999-29D729DC-29FB29FE-2B4C2B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F309B309C319031913196-319F31C0-31E33200-321E322A-324732503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A700-A716A720A721A789A78AA828-A82BA836-A839AA77-AA79FB29FBB2-FBC1FDFCFDFDFE62FE64-FE66FE69FF04FF0BFF1C-FF1EFF3EFF40FF5CFF5EFFE0-FFE6FFE8-FFEEFFFCFFFD",Sm:"002B003C-003E007C007E00AC00B100D700F703F60606-060820442052207A-207C208A-208C21182140-2144214B2190-2194219A219B21A021A321A621AE21CE21CF21D221D421F4-22FF2308-230B23202321237C239B-23B323DC-23E125B725C125F8-25FF266F27C0-27C427C7-27E527F0-27FF2900-29822999-29D729DC-29FB29FE-2AFF2B30-2B442B47-2B4CFB29FE62FE64-FE66FF0BFF1C-FF1EFF5CFF5EFFE2FFE9-FFEC",
Sc:"002400A2-00A5058F060B09F209F309FB0AF10BF90E3F17DB20A0-20B9A838FDFCFE69FF04FFE0FFE1FFE5FFE6",Sk:"005E006000A800AF00B400B802C2-02C502D2-02DF02E5-02EB02ED02EF-02FF0375038403851FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE309B309CA700-A716A720A721A789A78AFBB2-FBC1FF3EFF40FFE3",So:"00A600A900AE00B00482060E060F06DE06E906FD06FE07F609FA0B700BF3-0BF80BFA0C7F0D790F01-0F030F130F15-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F1390-1399194019DE-19FF1B61-1B6A1B74-1B7C210021012103-210621082109211421162117211E-2123212521272129212E213A213B214A214C214D214F2195-2199219C-219F21A121A221A421A521A7-21AD21AF-21CD21D021D121D321D5-21F32300-2307230C-231F2322-2328232B-237B237D-239A23B4-23DB23E2-23F32400-24262440-244A249C-24E92500-25B625B8-25C025C2-25F72600-266E2670-26FF2701-27672794-27BF2800-28FF2B00-2B2F2B452B462B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F319031913196-319F31C0-31E33200-321E322A-324732503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A828-A82BA836A837A839AA77-AA79FDFDFFE4FFE8FFEDFFEEFFFCFFFD",Z:"002000A01680180E2000-200A20282029202F205F3000",Zs:"002000A01680180E2000-200A202F205F3000",Zl:"2028",Zp:"2029",C:"0000-001F007F-009F00AD03780379037F-0383038B038D03A20528-05300557055805600588058B-058E059005C8-05CF05EB-05EF05F5-0605061C061D06DD070E070F074B074C07B2-07BF07FB-07FF082E082F083F085C085D085F-089F08A108AD-08E308FF097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B78-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D3B0D3C0D450D490D4F-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EE0-0EFF0F480F6D-0F700F980FBD0FCD0FDB-0FFF10C610C8-10CC10CE10CF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B135C137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BF4-1BFB1C38-1C3A1C4A-1C4C1C80-1CBF1CC8-1CCF1CF7-1CFF1DE7-1DFB1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF200B-200F202A-202E2060-206F20722073208F209D-209F20BA-20CF20F1-20FF218A-218F23F4-23FF2427-243F244B-245F27002B4D-2B4F2B5A-2BFF2C2F2C5F2CF4-2CF82D262D28-2D2C2D2E2D2F2D68-2D6E2D71-2D7E2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E3C-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31BB-31BF31E4-31EF321F32FF4DB6-4DBF9FCD-9FFFA48D-A48FA4C7-A4CFA62C-A63FA698-A69EA6F8-A6FFA78FA794-A79FA7AB-A7F7A82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAF7-AB00AB07AB08AB0FAB10AB17-AB1FAB27AB2F-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-F8FFFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBC2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFD-FF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFFBFFFEFFFF",Cc:"0000-001F007F-009F",Cf:"00AD0600-060406DD070F200B-200F202A-202E2060-2064206A-206FFEFFFFF9-FFFB",Co:"E000-F8FF",Cs:"D800-DFFF",Cn:"03780379037F-0383038B038D03A20528-05300557055805600588058B-058E059005C8-05CF05EB-05EF05F5-05FF0605061C061D070E074B074C07B2-07BF07FB-07FF082E082F083F085C085D085F-089F08A108AD-08E308FF097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B78-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D3B0D3C0D450D490D4F-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EE0-0EFF0F480F6D-0F700F980FBD0FCD0FDB-0FFF10C610C8-10CC10CE10CF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B135C137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BF4-1BFB1C38-1C3A1C4A-1C4C1C80-1CBF1CC8-1CCF1CF7-1CFF1DE7-1DFB1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF2065-206920722073208F209D-209F20BA-20CF20F1-20FF218A-218F23F4-23FF2427-243F244B-245F27002B4D-2B4F2B5A-2BFF2C2F2C5F2CF4-2CF82D262D28-2D2C2D2E2D2F2D68-2D6E2D71-2D7E2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E3C-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31BB-31BF31E4-31EF321F32FF4DB6-4DBF9FCD-9FFFA48D-A48FA4C7-A4CFA62C-A63FA698-A69EA6F8-A6FFA78FA794-A79FA7AB-A7F7A82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAF7-AB00AB07AB08AB0FAB10AB17-AB1FAB27AB2F-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-D7FFFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBC2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFDFEFEFF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFF8FFFEFFFF"},{Ll:"Lowercase_Letter",Lu:"Uppercase_Letter",Lt:"Titlecase_Letter",Lm:"Modifier_Letter",Lo:"Other_Letter",M:"Mark",Mn:"Nonspacing_Mark",Mc:"Spacing_Mark",Me:"Enclosing_Mark",N:"Number",Nd:"Decimal_Number",Nl:"Letter_Number",No:"Other_Number",P:"Punctuation",Pd:"Dash_Punctuation",Ps:"Open_Punctuation",Pe:"Close_Punctuation",Pi:"Initial_Punctuation",Pf:"Final_Punctuation",Pc:"Connector_Punctuation",Po:"Other_Punctuation",S:"Symbol",Sm:"Math_Symbol",Sc:"Currency_Symbol",Sk:"Modifier_Symbol",So:"Other_Symbol",Z:"Separator",Zs:"Space_Separator",Zl:"Line_Separator",Zp:"Paragraph_Separator",C:"Other",Cc:"Control",Cf:"Format",Co:"Private_Use",Cs:"Surrogate",Cn:"Unassigned"})}(XRegExp),function(e){"use strict";if(!e.addUnicodePackage)throw new ReferenceError("Unicode Base must be loaded before Unicode Scripts");e.install("extensibility"),e.addUnicodePackage({Arabic:"0600-06040606-060B060D-061A061E0620-063F0641-064A0656-065E066A-066F0671-06DC06DE-06FF0750-077F08A008A2-08AC08E4-08FEFB50-FBC1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFCFE70-FE74FE76-FEFC",Armenian:"0531-05560559-055F0561-0587058A058FFB13-FB17",Balinese:"1B00-1B4B1B50-1B7C",Bamum:"A6A0-A6F7",Batak:"1BC0-1BF31BFC-1BFF",Bengali:"0981-09830985-098C098F09900993-09A809AA-09B009B209B6-09B909BC-09C409C709C809CB-09CE09D709DC09DD09DF-09E309E6-09FB",Bopomofo:"02EA02EB3105-312D31A0-31BA",Braille:"2800-28FF",Buginese:"1A00-1A1B1A1E1A1F",Buhid:"1740-1753",Canadian_Aboriginal:"1400-167F18B0-18F5",Cham:"AA00-AA36AA40-AA4DAA50-AA59AA5C-AA5F",Cherokee:"13A0-13F4",Common:"0000-0040005B-0060007B-00A900AB-00B900BB-00BF00D700F702B9-02DF02E5-02E902EC-02FF0374037E038503870589060C061B061F06400660-066906DD096409650E3F0FD5-0FD810FB16EB-16ED173517361802180318051CD31CE11CE9-1CEC1CEE-1CF31CF51CF62000-200B200E-2064206A-20702074-207E2080-208E20A0-20B92100-21252127-2129212C-21312133-214D214F-215F21892190-23F32400-24262440-244A2460-26FF2701-27FF2900-2B4C2B50-2B592E00-2E3B2FF0-2FFB3000-300430063008-30203030-3037303C-303F309B309C30A030FB30FC3190-319F31C0-31E33220-325F327F-32CF3358-33FF4DC0-4DFFA700-A721A788-A78AA830-A839FD3EFD3FFDFDFE10-FE19FE30-FE52FE54-FE66FE68-FE6BFEFFFF01-FF20FF3B-FF40FF5B-FF65FF70FF9EFF9FFFE0-FFE6FFE8-FFEEFFF9-FFFD",Coptic:"03E2-03EF2C80-2CF32CF9-2CFF",Cyrillic:"0400-04840487-05271D2B1D782DE0-2DFFA640-A697A69F",Devanagari:"0900-09500953-09630966-09770979-097FA8E0-A8FB",Ethiopic:"1200-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A135D-137C1380-13992D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDEAB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2E",Georgian:"10A0-10C510C710CD10D0-10FA10FC-10FF2D00-2D252D272D2D",Glagolitic:"2C00-2C2E2C30-2C5E",Greek:"0370-03730375-0377037A-037D038403860388-038A038C038E-03A103A3-03E103F0-03FF1D26-1D2A1D5D-1D611D66-1D6A1DBF1F00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FC41FC6-1FD31FD6-1FDB1FDD-1FEF1FF2-1FF41FF6-1FFE2126",Gujarati:"0A81-0A830A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABC-0AC50AC7-0AC90ACB-0ACD0AD00AE0-0AE30AE6-0AF1",Gurmukhi:"0A01-0A030A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A3C0A3E-0A420A470A480A4B-0A4D0A510A59-0A5C0A5E0A66-0A75",Han:"2E80-2E992E9B-2EF32F00-2FD5300530073021-30293038-303B3400-4DB54E00-9FCCF900-FA6DFA70-FAD9",Hangul:"1100-11FF302E302F3131-318E3200-321E3260-327EA960-A97CAC00-D7A3D7B0-D7C6D7CB-D7FBFFA0-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",Hanunoo:"1720-1734",Hebrew:"0591-05C705D0-05EA05F0-05F4FB1D-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FB4F",Hiragana:"3041-3096309D-309F",Inherited:"0300-036F04850486064B-0655065F0670095109521CD0-1CD21CD4-1CE01CE2-1CE81CED1CF41DC0-1DE61DFC-1DFF200C200D20D0-20F0302A-302D3099309AFE00-FE0FFE20-FE26",Javanese:"A980-A9CDA9CF-A9D9A9DEA9DF",Kannada:"0C820C830C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBC-0CC40CC6-0CC80CCA-0CCD0CD50CD60CDE0CE0-0CE30CE6-0CEF0CF10CF2",Katakana:"30A1-30FA30FD-30FF31F0-31FF32D0-32FE3300-3357FF66-FF6FFF71-FF9D",Kayah_Li:"A900-A92F",Khmer:"1780-17DD17E0-17E917F0-17F919E0-19FF",Lao:"0E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB90EBB-0EBD0EC0-0EC40EC60EC8-0ECD0ED0-0ED90EDC-0EDF",Latin:"0041-005A0061-007A00AA00BA00C0-00D600D8-00F600F8-02B802E0-02E41D00-1D251D2C-1D5C1D62-1D651D6B-1D771D79-1DBE1E00-1EFF2071207F2090-209C212A212B2132214E2160-21882C60-2C7FA722-A787A78B-A78EA790-A793A7A0-A7AAA7F8-A7FFFB00-FB06FF21-FF3AFF41-FF5A",Lepcha:"1C00-1C371C3B-1C491C4D-1C4F",Limbu:"1900-191C1920-192B1930-193B19401944-194F",Lisu:"A4D0-A4FF",Malayalam:"0D020D030D05-0D0C0D0E-0D100D12-0D3A0D3D-0D440D46-0D480D4A-0D4E0D570D60-0D630D66-0D750D79-0D7F",Mandaic:"0840-085B085E",Meetei_Mayek:"AAE0-AAF6ABC0-ABEDABF0-ABF9",Mongolian:"1800180118041806-180E1810-18191820-18771880-18AA",Myanmar:"1000-109FAA60-AA7B",New_Tai_Lue:"1980-19AB19B0-19C919D0-19DA19DE19DF",Nko:"07C0-07FA",Ogham:"1680-169C",Ol_Chiki:"1C50-1C7F",Oriya:"0B01-0B030B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3C-0B440B470B480B4B-0B4D0B560B570B5C0B5D0B5F-0B630B66-0B77",Phags_Pa:"A840-A877",Rejang:"A930-A953A95F",Runic:"16A0-16EA16EE-16F0",Samaritan:"0800-082D0830-083E",Saurashtra:"A880-A8C4A8CE-A8D9",Sinhala:"0D820D830D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60DCA0DCF-0DD40DD60DD8-0DDF0DF2-0DF4",Sundanese:"1B80-1BBF1CC0-1CC7",Syloti_Nagri:"A800-A82B",Syriac:"0700-070D070F-074A074D-074F",Tagalog:"1700-170C170E-1714",Tagbanwa:"1760-176C176E-177017721773",Tai_Le:"1950-196D1970-1974",Tai_Tham:"1A20-1A5E1A60-1A7C1A7F-1A891A90-1A991AA0-1AAD",Tai_Viet:"AA80-AAC2AADB-AADF",Tamil:"0B820B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BBE-0BC20BC6-0BC80BCA-0BCD0BD00BD70BE6-0BFA",Telugu:"0C01-0C030C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D-0C440C46-0C480C4A-0C4D0C550C560C580C590C60-0C630C66-0C6F0C78-0C7F",Thaana:"0780-07B1",Thai:"0E01-0E3A0E40-0E5B",Tibetan:"0F00-0F470F49-0F6C0F71-0F970F99-0FBC0FBE-0FCC0FCE-0FD40FD90FDA",Tifinagh:"2D30-2D672D6F2D702D7F",Vai:"A500-A62B",Yi:"A000-A48CA490-A4C6"})}(XRegExp),function(e){"use strict";if(!e.addUnicodePackage)throw new ReferenceError("Unicode Base must be loaded before Unicode Blocks");e.install("extensibility"),e.addUnicodePackage({InBasic_Latin:"0000-007F",InLatin_1_Supplement:"0080-00FF",InLatin_Extended_A:"0100-017F",InLatin_Extended_B:"0180-024F",InIPA_Extensions:"0250-02AF",InSpacing_Modifier_Letters:"02B0-02FF",InCombining_Diacritical_Marks:"0300-036F",InGreek_and_Coptic:"0370-03FF",InCyrillic:"0400-04FF",InCyrillic_Supplement:"0500-052F",InArmenian:"0530-058F",InHebrew:"0590-05FF",InArabic:"0600-06FF",InSyriac:"0700-074F",InArabic_Supplement:"0750-077F",InThaana:"0780-07BF",InNKo:"07C0-07FF",InSamaritan:"0800-083F",InMandaic:"0840-085F",InArabic_Extended_A:"08A0-08FF",InDevanagari:"0900-097F",InBengali:"0980-09FF",InGurmukhi:"0A00-0A7F",InGujarati:"0A80-0AFF",InOriya:"0B00-0B7F",InTamil:"0B80-0BFF",InTelugu:"0C00-0C7F",InKannada:"0C80-0CFF",InMalayalam:"0D00-0D7F",InSinhala:"0D80-0DFF",InThai:"0E00-0E7F",InLao:"0E80-0EFF",InTibetan:"0F00-0FFF",InMyanmar:"1000-109F",InGeorgian:"10A0-10FF",InHangul_Jamo:"1100-11FF",InEthiopic:"1200-137F",InEthiopic_Supplement:"1380-139F",InCherokee:"13A0-13FF",InUnified_Canadian_Aboriginal_Syllabics:"1400-167F",InOgham:"1680-169F",InRunic:"16A0-16FF",InTagalog:"1700-171F",InHanunoo:"1720-173F",InBuhid:"1740-175F",InTagbanwa:"1760-177F",InKhmer:"1780-17FF",InMongolian:"1800-18AF",InUnified_Canadian_Aboriginal_Syllabics_Extended:"18B0-18FF",InLimbu:"1900-194F",InTai_Le:"1950-197F",InNew_Tai_Lue:"1980-19DF",InKhmer_Symbols:"19E0-19FF",InBuginese:"1A00-1A1F",InTai_Tham:"1A20-1AAF",InBalinese:"1B00-1B7F",InSundanese:"1B80-1BBF",InBatak:"1BC0-1BFF",InLepcha:"1C00-1C4F",InOl_Chiki:"1C50-1C7F",InSundanese_Supplement:"1CC0-1CCF",InVedic_Extensions:"1CD0-1CFF",InPhonetic_Extensions:"1D00-1D7F",InPhonetic_Extensions_Supplement:"1D80-1DBF",InCombining_Diacritical_Marks_Supplement:"1DC0-1DFF",InLatin_Extended_Additional:"1E00-1EFF",InGreek_Extended:"1F00-1FFF",InGeneral_Punctuation:"2000-206F",InSuperscripts_and_Subscripts:"2070-209F",InCurrency_Symbols:"20A0-20CF",InCombining_Diacritical_Marks_for_Symbols:"20D0-20FF",InLetterlike_Symbols:"2100-214F",InNumber_Forms:"2150-218F",InArrows:"2190-21FF",InMathematical_Operators:"2200-22FF",InMiscellaneous_Technical:"2300-23FF",InControl_Pictures:"2400-243F",InOptical_Character_Recognition:"2440-245F",InEnclosed_Alphanumerics:"2460-24FF",InBox_Drawing:"2500-257F",InBlock_Elements:"2580-259F",InGeometric_Shapes:"25A0-25FF",InMiscellaneous_Symbols:"2600-26FF",InDingbats:"2700-27BF",InMiscellaneous_Mathematical_Symbols_A:"27C0-27EF",InSupplemental_Arrows_A:"27F0-27FF",InBraille_Patterns:"2800-28FF",InSupplemental_Arrows_B:"2900-297F",InMiscellaneous_Mathematical_Symbols_B:"2980-29FF",InSupplemental_Mathematical_Operators:"2A00-2AFF",InMiscellaneous_Symbols_and_Arrows:"2B00-2BFF",InGlagolitic:"2C00-2C5F",InLatin_Extended_C:"2C60-2C7F",InCoptic:"2C80-2CFF",InGeorgian_Supplement:"2D00-2D2F",InTifinagh:"2D30-2D7F",InEthiopic_Extended:"2D80-2DDF",InCyrillic_Extended_A:"2DE0-2DFF",InSupplemental_Punctuation:"2E00-2E7F",InCJK_Radicals_Supplement:"2E80-2EFF",InKangxi_Radicals:"2F00-2FDF",InIdeographic_Description_Characters:"2FF0-2FFF",InCJK_Symbols_and_Punctuation:"3000-303F",InHiragana:"3040-309F",InKatakana:"30A0-30FF",InBopomofo:"3100-312F",InHangul_Compatibility_Jamo:"3130-318F",InKanbun:"3190-319F",InBopomofo_Extended:"31A0-31BF",InCJK_Strokes:"31C0-31EF",InKatakana_Phonetic_Extensions:"31F0-31FF",InEnclosed_CJK_Letters_and_Months:"3200-32FF",InCJK_Compatibility:"3300-33FF",InCJK_Unified_Ideographs_Extension_A:"3400-4DBF",InYijing_Hexagram_Symbols:"4DC0-4DFF",InCJK_Unified_Ideographs:"4E00-9FFF",InYi_Syllables:"A000-A48F",InYi_Radicals:"A490-A4CF",InLisu:"A4D0-A4FF",InVai:"A500-A63F",InCyrillic_Extended_B:"A640-A69F",InBamum:"A6A0-A6FF",InModifier_Tone_Letters:"A700-A71F",InLatin_Extended_D:"A720-A7FF",InSyloti_Nagri:"A800-A82F",InCommon_Indic_Number_Forms:"A830-A83F",InPhags_pa:"A840-A87F",InSaurashtra:"A880-A8DF",InDevanagari_Extended:"A8E0-A8FF",InKayah_Li:"A900-A92F",InRejang:"A930-A95F",InHangul_Jamo_Extended_A:"A960-A97F",InJavanese:"A980-A9DF",InCham:"AA00-AA5F",InMyanmar_Extended_A:"AA60-AA7F",InTai_Viet:"AA80-AADF",InMeetei_Mayek_Extensions:"AAE0-AAFF",InEthiopic_Extended_A:"AB00-AB2F",InMeetei_Mayek:"ABC0-ABFF",InHangul_Syllables:"AC00-D7AF",InHangul_Jamo_Extended_B:"D7B0-D7FF",InHigh_Surrogates:"D800-DB7F",InHigh_Private_Use_Surrogates:"DB80-DBFF",InLow_Surrogates:"DC00-DFFF",InPrivate_Use_Area:"E000-F8FF",InCJK_Compatibility_Ideographs:"F900-FAFF",InAlphabetic_Presentation_Forms:"FB00-FB4F",InArabic_Presentation_Forms_A:"FB50-FDFF",InVariation_Selectors:"FE00-FE0F",InVertical_Forms:"FE10-FE1F",InCombining_Half_Marks:"FE20-FE2F",InCJK_Compatibility_Forms:"FE30-FE4F",InSmall_Form_Variants:"FE50-FE6F",InArabic_Presentation_Forms_B:"FE70-FEFF",InHalfwidth_and_Fullwidth_Forms:"FF00-FFEF",InSpecials:"FFF0-FFFF"})}(XRegExp),function(e){"use strict";if(!e.addUnicodePackage)throw new ReferenceError("Unicode Base must be loaded before Unicode Properties");e.install("extensibility"),e.addUnicodePackage({Alphabetic:"0041-005A0061-007A00AA00B500BA00C0-00D600D8-00F600F8-02C102C6-02D102E0-02E402EC02EE03450370-037403760377037A-037D03860388-038A038C038E-03A103A3-03F503F7-0481048A-05270531-055605590561-058705B0-05BD05BF05C105C205C405C505C705D0-05EA05F0-05F20610-061A0620-06570659-065F066E-06D306D5-06DC06E1-06E806ED-06EF06FA-06FC06FF0710-073F074D-07B107CA-07EA07F407F507FA0800-0817081A-082C0840-085808A008A2-08AC08E4-08E908F0-08FE0900-093B093D-094C094E-09500955-09630971-09770979-097F0981-09830985-098C098F09900993-09A809AA-09B009B209B6-09B909BD-09C409C709C809CB09CC09CE09D709DC09DD09DF-09E309F009F10A01-0A030A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A3E-0A420A470A480A4B0A4C0A510A59-0A5C0A5E0A70-0A750A81-0A830A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD-0AC50AC7-0AC90ACB0ACC0AD00AE0-0AE30B01-0B030B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D-0B440B470B480B4B0B4C0B560B570B5C0B5D0B5F-0B630B710B820B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BBE-0BC20BC6-0BC80BCA-0BCC0BD00BD70C01-0C030C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D-0C440C46-0C480C4A-0C4C0C550C560C580C590C60-0C630C820C830C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD-0CC40CC6-0CC80CCA-0CCC0CD50CD60CDE0CE0-0CE30CF10CF20D020D030D05-0D0C0D0E-0D100D12-0D3A0D3D-0D440D46-0D480D4A-0D4C0D4E0D570D60-0D630D7A-0D7F0D820D830D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60DCF-0DD40DD60DD8-0DDF0DF20DF30E01-0E3A0E40-0E460E4D0E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB90EBB-0EBD0EC0-0EC40EC60ECD0EDC-0EDF0F000F40-0F470F49-0F6C0F71-0F810F88-0F970F99-0FBC1000-10361038103B-103F1050-10621065-1068106E-1086108E109C109D10A0-10C510C710CD10D0-10FA10FC-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A135F1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA16EE-16F01700-170C170E-17131720-17331740-17531760-176C176E-1770177217731780-17B317B6-17C817D717DC1820-18771880-18AA18B0-18F51900-191C1920-192B1930-19381950-196D1970-19741980-19AB19B0-19C91A00-1A1B1A20-1A5E1A61-1A741AA71B00-1B331B35-1B431B45-1B4B1B80-1BA91BAC-1BAF1BBA-1BE51BE7-1BF11C00-1C351C4D-1C4F1C5A-1C7D1CE9-1CEC1CEE-1CF31CF51CF61D00-1DBF1E00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FBC1FBE1FC2-1FC41FC6-1FCC1FD0-1FD31FD6-1FDB1FE0-1FEC1FF2-1FF41FF6-1FFC2071207F2090-209C21022107210A-211321152119-211D212421262128212A-212D212F-2139213C-213F2145-2149214E2160-218824B6-24E92C00-2C2E2C30-2C5E2C60-2CE42CEB-2CEE2CF22CF32D00-2D252D272D2D2D30-2D672D6F2D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2DE0-2DFF2E2F3005-30073021-30293031-30353038-303C3041-3096309D-309F30A1-30FA30FC-30FF3105-312D3131-318E31A0-31BA31F0-31FF3400-4DB54E00-9FCCA000-A48CA4D0-A4FDA500-A60CA610-A61FA62AA62BA640-A66EA674-A67BA67F-A697A69F-A6EFA717-A71FA722-A788A78B-A78EA790-A793A7A0-A7AAA7F8-A801A803-A805A807-A80AA80C-A827A840-A873A880-A8C3A8F2-A8F7A8FBA90A-A92AA930-A952A960-A97CA980-A9B2A9B4-A9BFA9CFAA00-AA36AA40-AA4DAA60-AA76AA7AAA80-AABEAAC0AAC2AADB-AADDAAE0-AAEFAAF2-AAF5AB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2EABC0-ABEAAC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1D-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF21-FF3AFF41-FF5AFF66-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",Uppercase:"0041-005A00C0-00D600D8-00DE01000102010401060108010A010C010E01100112011401160118011A011C011E01200122012401260128012A012C012E01300132013401360139013B013D013F0141014301450147014A014C014E01500152015401560158015A015C015E01600162016401660168016A016C016E017001720174017601780179017B017D018101820184018601870189-018B018E-0191019301940196-0198019C019D019F01A001A201A401A601A701A901AC01AE01AF01B1-01B301B501B701B801BC01C401C701CA01CD01CF01D101D301D501D701D901DB01DE01E001E201E401E601E801EA01EC01EE01F101F401F6-01F801FA01FC01FE02000202020402060208020A020C020E02100212021402160218021A021C021E02200222022402260228022A022C022E02300232023A023B023D023E02410243-02460248024A024C024E03700372037603860388-038A038C038E038F0391-03A103A3-03AB03CF03D2-03D403D803DA03DC03DE03E003E203E403E603E803EA03EC03EE03F403F703F903FA03FD-042F04600462046404660468046A046C046E04700472047404760478047A047C047E0480048A048C048E04900492049404960498049A049C049E04A004A204A404A604A804AA04AC04AE04B004B204B404B604B804BA04BC04BE04C004C104C304C504C704C904CB04CD04D004D204D404D604D804DA04DC04DE04E004E204E404E604E804EA04EC04EE04F004F204F404F604F804FA04FC04FE05000502050405060508050A050C050E05100512051405160518051A051C051E05200522052405260531-055610A0-10C510C710CD1E001E021E041E061E081E0A1E0C1E0E1E101E121E141E161E181E1A1E1C1E1E1E201E221E241E261E281E2A1E2C1E2E1E301E321E341E361E381E3A1E3C1E3E1E401E421E441E461E481E4A1E4C1E4E1E501E521E541E561E581E5A1E5C1E5E1E601E621E641E661E681E6A1E6C1E6E1E701E721E741E761E781E7A1E7C1E7E1E801E821E841E861E881E8A1E8C1E8E1E901E921E941E9E1EA01EA21EA41EA61EA81EAA1EAC1EAE1EB01EB21EB41EB61EB81EBA1EBC1EBE1EC01EC21EC41EC61EC81ECA1ECC1ECE1ED01ED21ED41ED61ED81EDA1EDC1EDE1EE01EE21EE41EE61EE81EEA1EEC1EEE1EF01EF21EF41EF61EF81EFA1EFC1EFE1F08-1F0F1F18-1F1D1F28-1F2F1F38-1F3F1F48-1F4D1F591F5B1F5D1F5F1F68-1F6F1FB8-1FBB1FC8-1FCB1FD8-1FDB1FE8-1FEC1FF8-1FFB21022107210B-210D2110-211221152119-211D212421262128212A-212D2130-2133213E213F21452160-216F218324B6-24CF2C00-2C2E2C602C62-2C642C672C692C6B2C6D-2C702C722C752C7E-2C802C822C842C862C882C8A2C8C2C8E2C902C922C942C962C982C9A2C9C2C9E2CA02CA22CA42CA62CA82CAA2CAC2CAE2CB02CB22CB42CB62CB82CBA2CBC2CBE2CC02CC22CC42CC62CC82CCA2CCC2CCE2CD02CD22CD42CD62CD82CDA2CDC2CDE2CE02CE22CEB2CED2CF2A640A642A644A646A648A64AA64CA64EA650A652A654A656A658A65AA65CA65EA660A662A664A666A668A66AA66CA680A682A684A686A688A68AA68CA68EA690A692A694A696A722A724A726A728A72AA72CA72EA732A734A736A738A73AA73CA73EA740A742A744A746A748A74AA74CA74EA750A752A754A756A758A75AA75CA75EA760A762A764A766A768A76AA76CA76EA779A77BA77DA77EA780A782A784A786A78BA78DA790A792A7A0A7A2A7A4A7A6A7A8A7AAFF21-FF3A",Lowercase:"0061-007A00AA00B500BA00DF-00F600F8-00FF01010103010501070109010B010D010F01110113011501170119011B011D011F01210123012501270129012B012D012F01310133013501370138013A013C013E014001420144014601480149014B014D014F01510153015501570159015B015D015F01610163016501670169016B016D016F0171017301750177017A017C017E-0180018301850188018C018D019201950199-019B019E01A101A301A501A801AA01AB01AD01B001B401B601B901BA01BD-01BF01C601C901CC01CE01D001D201D401D601D801DA01DC01DD01DF01E101E301E501E701E901EB01ED01EF01F001F301F501F901FB01FD01FF02010203020502070209020B020D020F02110213021502170219021B021D021F02210223022502270229022B022D022F02310233-0239023C023F0240024202470249024B024D024F-02930295-02B802C002C102E0-02E40345037103730377037A-037D039003AC-03CE03D003D103D5-03D703D903DB03DD03DF03E103E303E503E703E903EB03ED03EF-03F303F503F803FB03FC0430-045F04610463046504670469046B046D046F04710473047504770479047B047D047F0481048B048D048F04910493049504970499049B049D049F04A104A304A504A704A904AB04AD04AF04B104B304B504B704B904BB04BD04BF04C204C404C604C804CA04CC04CE04CF04D104D304D504D704D904DB04DD04DF04E104E304E504E704E904EB04ED04EF04F104F304F504F704F904FB04FD04FF05010503050505070509050B050D050F05110513051505170519051B051D051F05210523052505270561-05871D00-1DBF1E011E031E051E071E091E0B1E0D1E0F1E111E131E151E171E191E1B1E1D1E1F1E211E231E251E271E291E2B1E2D1E2F1E311E331E351E371E391E3B1E3D1E3F1E411E431E451E471E491E4B1E4D1E4F1E511E531E551E571E591E5B1E5D1E5F1E611E631E651E671E691E6B1E6D1E6F1E711E731E751E771E791E7B1E7D1E7F1E811E831E851E871E891E8B1E8D1E8F1E911E931E95-1E9D1E9F1EA11EA31EA51EA71EA91EAB1EAD1EAF1EB11EB31EB51EB71EB91EBB1EBD1EBF1EC11EC31EC51EC71EC91ECB1ECD1ECF1ED11ED31ED51ED71ED91EDB1EDD1EDF1EE11EE31EE51EE71EE91EEB1EED1EEF1EF11EF31EF51EF71EF91EFB1EFD1EFF-1F071F10-1F151F20-1F271F30-1F371F40-1F451F50-1F571F60-1F671F70-1F7D1F80-1F871F90-1F971FA0-1FA71FB0-1FB41FB61FB71FBE1FC2-1FC41FC61FC71FD0-1FD31FD61FD71FE0-1FE71FF2-1FF41FF61FF72071207F2090-209C210A210E210F2113212F21342139213C213D2146-2149214E2170-217F218424D0-24E92C30-2C5E2C612C652C662C682C6A2C6C2C712C732C742C76-2C7D2C812C832C852C872C892C8B2C8D2C8F2C912C932C952C972C992C9B2C9D2C9F2CA12CA32CA52CA72CA92CAB2CAD2CAF2CB12CB32CB52CB72CB92CBB2CBD2CBF2CC12CC32CC52CC72CC92CCB2CCD2CCF2CD12CD32CD52CD72CD92CDB2CDD2CDF2CE12CE32CE42CEC2CEE2CF32D00-2D252D272D2DA641A643A645A647A649A64BA64DA64FA651A653A655A657A659A65BA65DA65FA661A663A665A667A669A66BA66DA681A683A685A687A689A68BA68DA68FA691A693A695A697A723A725A727A729A72BA72DA72F-A731A733A735A737A739A73BA73DA73FA741A743A745A747A749A74BA74DA74FA751A753A755A757A759A75BA75DA75FA761A763A765A767A769A76BA76DA76F-A778A77AA77CA77FA781A783A785A787A78CA78EA791A793A7A1A7A3A7A5A7A7A7A9A7F8-A7FAFB00-FB06FB13-FB17FF41-FF5A",White_Space:"0009-000D0020008500A01680180E2000-200A20282029202F205F3000",Noncharacter_Code_Point:"FDD0-FDEFFFFEFFFF",Default_Ignorable_Code_Point:"00AD034F115F116017B417B5180B-180D200B-200F202A-202E2060-206F3164FE00-FE0FFEFFFFA0FFF0-FFF8",Any:"0000-FFFF",Ascii:"0000-007F",Assigned:"0000-0377037A-037E0384-038A038C038E-03A103A3-05270531-05560559-055F0561-05870589058A058F0591-05C705D0-05EA05F0-05F40600-06040606-061B061E-070D070F-074A074D-07B107C0-07FA0800-082D0830-083E0840-085B085E08A008A2-08AC08E4-08FE0900-09770979-097F0981-09830985-098C098F09900993-09A809AA-09B009B209B6-09B909BC-09C409C709C809CB-09CE09D709DC09DD09DF-09E309E6-09FB0A01-0A030A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A3C0A3E-0A420A470A480A4B-0A4D0A510A59-0A5C0A5E0A66-0A750A81-0A830A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABC-0AC50AC7-0AC90ACB-0ACD0AD00AE0-0AE30AE6-0AF10B01-0B030B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3C-0B440B470B480B4B-0B4D0B560B570B5C0B5D0B5F-0B630B66-0B770B820B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BBE-0BC20BC6-0BC80BCA-0BCD0BD00BD70BE6-0BFA0C01-0C030C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D-0C440C46-0C480C4A-0C4D0C550C560C580C590C60-0C630C66-0C6F0C78-0C7F0C820C830C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBC-0CC40CC6-0CC80CCA-0CCD0CD50CD60CDE0CE0-0CE30CE6-0CEF0CF10CF20D020D030D05-0D0C0D0E-0D100D12-0D3A0D3D-0D440D46-0D480D4A-0D4E0D570D60-0D630D66-0D750D79-0D7F0D820D830D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60DCA0DCF-0DD40DD60DD8-0DDF0DF2-0DF40E01-0E3A0E3F-0E5B0E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB90EBB-0EBD0EC0-0EC40EC60EC8-0ECD0ED0-0ED90EDC-0EDF0F00-0F470F49-0F6C0F71-0F970F99-0FBC0FBE-0FCC0FCE-0FDA1000-10C510C710CD10D0-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A135D-137C1380-139913A0-13F41400-169C16A0-16F01700-170C170E-17141720-17361740-17531760-176C176E-1770177217731780-17DD17E0-17E917F0-17F91800-180E1810-18191820-18771880-18AA18B0-18F51900-191C1920-192B1930-193B19401944-196D1970-19741980-19AB19B0-19C919D0-19DA19DE-1A1B1A1E-1A5E1A60-1A7C1A7F-1A891A90-1A991AA0-1AAD1B00-1B4B1B50-1B7C1B80-1BF31BFC-1C371C3B-1C491C4D-1C7F1CC0-1CC71CD0-1CF61D00-1DE61DFC-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FC41FC6-1FD31FD6-1FDB1FDD-1FEF1FF2-1FF41FF6-1FFE2000-2064206A-20712074-208E2090-209C20A0-20B920D0-20F02100-21892190-23F32400-24262440-244A2460-26FF2701-2B4C2B50-2B592C00-2C2E2C30-2C5E2C60-2CF32CF9-2D252D272D2D2D30-2D672D6F2D702D7F-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2DE0-2E3B2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB3000-303F3041-30963099-30FF3105-312D3131-318E3190-31BA31C0-31E331F0-321E3220-32FE3300-4DB54DC0-9FCCA000-A48CA490-A4C6A4D0-A62BA640-A697A69F-A6F7A700-A78EA790-A793A7A0-A7AAA7F8-A82BA830-A839A840-A877A880-A8C4A8CE-A8D9A8E0-A8FBA900-A953A95F-A97CA980-A9CDA9CF-A9D9A9DEA9DFAA00-AA36AA40-AA4DAA50-AA59AA5C-AA7BAA80-AAC2AADB-AAF6AB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2EABC0-ABEDABF0-ABF9AC00-D7A3D7B0-D7C6D7CB-D7FBD800-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1D-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBC1FBD3-FD3FFD50-FD8FFD92-FDC7FDF0-FDFDFE00-FE19FE20-FE26FE30-FE52FE54-FE66FE68-FE6BFE70-FE74FE76-FEFCFEFFFF01-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDCFFE0-FFE6FFE8-FFEEFFF9-FFFD"})}(XRegExp),function(e){"use strict";function t(e,t,n,i){return{value:e,name:t,start:n,end:i}}e.matchRecursive=function(n,i,r,o,a){o=o||"",a=a||{};var s,l,d,c,h,u=o.indexOf("g")>-1,p=o.indexOf("y")>-1,_=o.replace(/y/g,""),f=a.escapeChar,E=a.valueNames,m=[],A=0,v=0,F=0,g=0;if(i=e(i,_),r=e(r,_),f){if(f.length>1)throw new SyntaxError("can't use more than one escape character");f=e.escape(f),h=new RegExp("(?:"+f+"[\\S\\s]|(?:(?!"+e.union([i,r]).source+")[^"+f+"])+)+",o.replace(/[^im]+/g,""))}for(;;){if(f&&(F+=(e.exec(n,h,F,"sticky")||[""])[0].length),d=e.exec(n,i,F),c=e.exec(n,r,F),d&&c&&(d.index<=c.index?c=null:d=null),d||c)v=(d||c).index,F=v+(d||c)[0].length;else if(!A)break;if(p&&!A&&v>g)break;if(d)A||(s=v,l=F),++A;else{if(!c||!A)throw new Error("string contains unbalanced delimiters");if(!--A&&(E?(E[0]&&s>g&&m.push(t(E[0],n.slice(g,s),g,s)),E[1]&&m.push(t(E[1],n.slice(s,l),s,l)),E[2]&&m.push(t(E[2],n.slice(l,v),l,v)),E[3]&&m.push(t(E[3],n.slice(v,F),v,F))):m.push(n.slice(l,v)),g=F,!u))break}v===F&&++F}return u&&!p&&E&&E[0]&&n.length>g&&m.push(t(E[0],n.slice(g),g,n.length)),m}}(XRegExp),function(e){"use strict";function t(e){var t=/^(?:\(\?:\))?\^/,n=/\$(?:\(\?:\))?$/;return n.test(e.replace(/\\[\s\S]/g,""))?e.replace(t,"").replace(n,""):e}function n(t){return e.isRegExp(t)?t.xregexp&&!t.xregexp.isNative?t:e(t.source):e(t)}var i=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,r=e.union([/\({{([\w$]+)}}\)|{{([\w$]+)}}/,i],"g");e.build=function(o,a,s){var l,d,c,h,u=/^\(\?([\w$]+)\)/.exec(o),p={},_=0,f=0,E=[0];u&&(s=s||"",u[1].replace(/./g,function(e){s+=s.indexOf(e)>-1?"":e}));for(h in a)a.hasOwnProperty(h)&&(c=n(a[h]),p[h]={pattern:t(c.source),names:c.xregexp.captureNames||[]});return o=n(o),d=o.xregexp.captureNames||[],o=o.source.replace(r,function(e,t,n,r,o){var a,s,c=t||n;if(c){if(!p.hasOwnProperty(c))throw new ReferenceError("undefined property "+e);return t?(a=d[f],E[++f]=++_,s="(?<"+(a||c)+">"):s="(?:",l=_,s+p[c].pattern.replace(i,function(e,t,n){if(t){if(a=p[c].names[_-l],++_,a)return"(?<"+a+">"}else if(n)return"\\"+(+n+l);return e})+")"}if(r){if(a=d[f],E[++f]=++_,a)return"(?<"+a+">"}else if(o)return"\\"+E[+o];return e}),e(o,s)}}(XRegExp),function(e){"use strict";function t(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}t(e.prototype,{apply:function(e,t){return this.test(t[0])},
call:function(e,t){return this.test(t)},forEach:function(t,n,i){return e.forEach(t,this,n,i)},globalize:function(){return e.globalize(this)},xexec:function(t,n,i){return e.exec(t,this,n,i)},xtest:function(t,n,i){return e.test(t,this,n,i)}})}(XRegExp),define("xregexp",function(e){return function(){var t,n;return n=function(){return{XRegExp:XRegExp}},t=n.apply(e,arguments),t||e.XRegExp}}(this)),define("salve/datatypes/regexp",["require","./xmlcharacters","xregexp"],function(e){function t(e){var t=new Error(e);this.name="SalveParsingError",this.stack=t.stack,this.message=t.message}function n(e,n){throw new t(e)}function i(e){N.unshift({negative:e,captured_multi_char:[]})}var r=function(e,t,n,i){for(n=n||{},i=e.length;i--;n[e[i]]=t);return n},o=[1,8],a=[1,10],s=[1,13],l=[1,19],d=[1,20],c=[1,14],h=[1,15],u=[1,16],p=[1,17],_=[5,23],f=[5,8,20,22,23,26,30,31,42,43,44,45],E=[5,8,12,13,14,15,20,22,23,26,30,31,42,43,44,45],m=[5,8,12,13,14,15,20,22,23,26,29,30,31,36,38,40,41,42,43,44,45],A=[1,37],v=[1,39],F=[1,40],g=[38,40,41,42,43,44,45],C=[29,36,38,40,41,42,43,44,45],D={trace:function(){},yy:{},symbols_:{error:2,start:3,input:4,EOF:5,regexp:6,branch:7,"|":8,piece:9,atom:10,quantifier:11,"?":12,"*":13,"+":14,"{":15,quantity:16,"}":17,NUMBER:18,",":19,CHAR:20,charClass:21,"(":22,")":23,charClassEsc:24,charClassExpr:25,WILDCARDESC:26,charClassExprStart:27,charGroup:28,"]":29,"[":30,"[^":31,posCharGroups:32,charClassSub:33,posCharGroup:34,charRange:35,CLASSSUBTRACTION:36,seRange:37,"-":38,charOrEsc:39,XMLCHAR:40,SingleCharEsc:41,SINGLECHARESC:42,MULTICHARESC:43,CATESC:44,COMPLESC:45,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",8:"|",12:"?",13:"*",14:"+",15:"{",17:"}",18:"NUMBER",19:",",20:"CHAR",22:"(",23:")",26:"WILDCARDESC",29:"]",30:"[",31:"[^",36:"CLASSSUBTRACTION",38:"-",40:"XMLCHAR",41:"SingleCharEsc",42:"SINGLECHARESC",43:"MULTICHARESC",44:"CATESC",45:"COMPLESC"},productions_:[0,[3,1],[4,1],[4,2],[6,1],[6,3],[7,1],[7,2],[9,1],[9,2],[11,1],[11,1],[11,1],[11,3],[16,1],[16,3],[16,2],[10,1],[10,1],[10,3],[21,1],[21,1],[21,1],[25,3],[27,1],[27,1],[28,1],[28,1],[32,1],[32,2],[34,1],[34,1],[33,3],[35,1],[35,1],[37,3],[37,1],[39,1],[39,1],[24,1],[24,1],[24,1],[24,1]],performAction:function(e,t,r,o,a,s,l,d){var c=s.length-1;switch(a){case 1:switch(this.parseError=n,d=d||"re"){case"string":return s[c];case"re":var h=x?w:RegExp;return new h(s[c]);default:throw new Error("unsupported output type: "+d)}break;case 2:this.$="^$";break;case 3:this.$="^"+s[c-1]+"$";break;case 5:case 13:case 35:this.$=s[c-2].concat(s[c-1],s[c]);break;case 7:case 9:case 29:this.$=s[c-1]+s[c];break;case 15:this.$=s[c-2].concat(",",s[c]);break;case 16:this.$=s[c-1].concat(s[c]);break;case 19:this.$="(?:"+s[c-1]+s[c];break;case 23:var u=N.shift(),p=u.captured_multi_char,_=u.subtraction?"(?!"+u.subtraction+")":"";if(0!==p.length){var f=["(?:",_];if(u.negative){f.push("(?=[");for(var E=0;E<p.length;++E)f.push(T[p[E]].slice(1));f.push("])")}else for(var E=0;E<p.length;++E)f.push("[",T[p[E]],"]|");f.push(s[c-2],s[c-1],s[c],")"),this.$=f.join("")}else this.$=""!==_?"(?:"+_+s[c-2].concat(s[c-1],s[c])+")":s[c-2].concat(s[c-1],s[c]);break;case 24:i(!1),this.$=s[c];break;case 25:i(!0),this.$=s[c];break;case 32:this.$=s[c-2],N[0].subtraction=s[c];break;case 40:if(N.length){var m=T[s[c]];"^"===m.charAt(0)?(N[0].captured_multi_char.push(s[c]),this.$=""):this.$=m}else this.$=k[s[c]];break;case 41:case 42:x=!0,this.$=s[c]}},table:[{3:1,4:2,5:[1,3],6:4,7:5,9:6,10:7,20:o,21:9,22:a,24:11,25:12,26:s,27:18,30:l,31:d,42:c,43:h,44:u,45:p},{1:[3]},{1:[2,1]},{1:[2,2]},{5:[1,21]},r(_,[2,4],{10:7,21:9,24:11,25:12,27:18,9:23,8:[1,22],20:o,22:a,26:s,30:l,31:d,42:c,43:h,44:u,45:p}),r(f,[2,6]),r(f,[2,8],{11:24,12:[1,25],13:[1,26],14:[1,27],15:[1,28]}),r(E,[2,17]),r(E,[2,18]),{6:29,7:5,9:6,10:7,20:o,21:9,22:a,24:11,25:12,26:s,27:18,30:l,31:d,42:c,43:h,44:u,45:p},r(E,[2,20]),r(E,[2,21]),r(E,[2,22]),r(m,[2,39]),r(m,[2,40]),r(m,[2,41]),r(m,[2,42]),{24:34,28:30,32:31,33:32,34:33,35:35,37:36,38:A,39:38,40:v,41:F,42:c,43:h,44:u,45:p},r(g,[2,24]),r(g,[2,25]),{1:[2,3]},{6:41,7:5,9:6,10:7,20:o,21:9,22:a,24:11,25:12,26:s,27:18,30:l,31:d,42:c,43:h,44:u,45:p},r(f,[2,7]),r(f,[2,9]),r(f,[2,10]),r(f,[2,11]),r(f,[2,12]),{16:42,18:[1,43]},{23:[1,44]},{29:[1,45]},{24:34,29:[2,26],34:46,35:35,36:[1,47],37:36,38:A,39:38,40:v,41:F,42:c,43:h,44:u,45:p},{29:[2,27]},r(C,[2,28]),r(C,[2,30]),r(C,[2,31]),r(C,[2,33]),r(C,[2,34]),r([29,36,40,41,42,43,44,45],[2,36],{38:[1,48]}),r(C,[2,37]),r(C,[2,38]),r(_,[2,5]),{17:[1,49]},{17:[2,14],19:[1,50]},r(E,[2,19]),r([5,8,12,13,14,15,20,22,23,26,29,30,31,42,43,44,45],[2,23]),r(C,[2,29]),{25:51,27:18,30:l,31:d},{39:52,40:v,41:F},r(f,[2,13]),{17:[2,16],18:[1,53]},{29:[2,32]},r(C,[2,35]),{17:[2,15]}],defaultActions:{2:[2,1],3:[2,2],21:[2,3],32:[2,27],51:[2,32],53:[2,15]},parseError:function(e,t){function n(e,t){this.message=e,this.hash=t}if(!t.recoverable)throw n.prototype=new Error,new n(e,t);this.trace(e)},parse:function(e){var t=this,n=[0],i=[null],r=[],o=this.table,a="",s=0,l=0,d=0,c=2,h=1,u=r.slice.call(arguments,1),p=Object.create(this.lexer),_={yy:{}};for(var f in this.yy)Object.prototype.hasOwnProperty.call(this.yy,f)&&(_.yy[f]=this.yy[f]);p.setInput(e,_.yy),_.yy.lexer=p,_.yy.parser=this,"undefined"==typeof p.yylloc&&(p.yylloc={});var E=p.yylloc;r.push(E);var m=p.options&&p.options.ranges;"function"==typeof _.yy.parseError?this.parseError=_.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var A,v,F,g,C,D,y,w,B,b=function(){var e;return e=p.lex()||h,"number"!=typeof e&&(e=t.symbols_[e]||e),e},N={};;){if(F=n[n.length-1],this.defaultActions[F]?g=this.defaultActions[F]:((null===A||"undefined"==typeof A)&&(A=b()),g=o[F]&&o[F][A]),"undefined"==typeof g||!g.length||!g[0]){var x="";B=[];for(D in o[F])this.terminals_[D]&&D>c&&B.push("'"+this.terminals_[D]+"'");x=p.showPosition?"Parse error on line "+(s+1)+":\n"+p.showPosition()+"\nExpecting "+B.join(", ")+", got '"+(this.terminals_[A]||A)+"'":"Parse error on line "+(s+1)+": Unexpected "+(A==h?"end of input":"'"+(this.terminals_[A]||A)+"'"),this.parseError(x,{text:p.match,token:this.terminals_[A]||A,line:p.yylineno,loc:E,expected:B})}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+F+", token: "+A);switch(g[0]){case 1:n.push(A),i.push(p.yytext),r.push(p.yylloc),n.push(g[1]),A=null,v?(A=v,v=null):(l=p.yyleng,a=p.yytext,s=p.yylineno,E=p.yylloc,d>0&&d--);break;case 2:if(y=this.productions_[g[1]][1],N.$=i[i.length-y],N._$={first_line:r[r.length-(y||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(y||1)].first_column,last_column:r[r.length-1].last_column},m&&(N._$.range=[r[r.length-(y||1)].range[0],r[r.length-1].range[1]]),C=this.performAction.apply(N,[a,l,s,_.yy,g[1],i,r].concat(u)),"undefined"!=typeof C)return C;y&&(n=n.slice(0,-1*y*2),i=i.slice(0,-1*y),r=r.slice(0,-1*y)),n.push(this.productions_[g[1]][0]),i.push(N.$),r.push(N._$),w=o[n[n.length-2]][n[n.length-1]],n.push(w);break;case 3:return!0}}return!0}},y=e("./xmlcharacters"),w=e("xregexp").XRegExp;t.prototype=new Error,"undefined"!=typeof exports?exports.SalveParsingError=t:D.SalveParsingError=t;var B=y.xml_Name_Char,b=y.xml_Letter,N=[],x=!1,T={"\\s":" \\t\\n\\r","\\S":"^ \\t\\n\\r","\\i":""+b+"_:","\\I":"^"+b+"_:","\\c":""+B,"\\C":"^"+B,"\\d":"\\p{Nd}","\\D":"^\\p{Nd}","\\w":"^\\p{P}\\p{Z}\\p{C}","\\W":"\\p{P}\\p{Z}\\p{C}"},k=[];for(var S in T)T.hasOwnProperty(S)&&(k[S]="["+T[S]+"]");var R=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,i,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),i=e[0].match(/(?:\r\n?|\n).*/g),i&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var o in r)this[o]=r[o];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,i;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),o=0;o<r.length;o++)if(n=this._input.match(this.rules[r[o]]),n&&(!t||n[0].length>t[0].length)){if(t=n,i=o,this.options.backtrack_lexer){if(e=this.test_match(n,r[o]),e!==!1)return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?(e=this.test_match(t,r[i]),e!==!1?e:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){var e=this.conditionStack.length-1;return e>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return e=this.conditionStack.length-1-Math.abs(e||0),e>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,n,i){switch(n){case 0:return 18;case 1:return 19;case 2:return this.popState(),17;case 3:return this.begin("CHARCLASS"),31;case 4:return this.begin("CHARCLASS"),30;case 5:return 42;case 6:return 43;case 7:return 36;case 8:return 38;case 9:return 40;case 10:return this.popState(),29;case 11:return 22;case 12:return 8;case 13:return 23;case 14:return 13;case 15:return 14;case 16:return 12;case 17:return this.begin("QUANTITY"),15;case 18:return 17;case 19:return 29;case 20:return"^";case 21:return 44;case 22:return 45;case 23:return 26;case 24:return 5;case 25:return 20}},rules:[/^(?:[0-9])/,/^(?:,)/,/^(?:\})/,/^(?:\[\^)/,/^(?:\[)/,/^(?:\\[-nrt\|.?*+(){}[\]^])/,/^(?:\\[sSiIcCdDwW])/,/^(?:-(?=\[))/,/^(?:-)/,/^(?:[^-[\]])/,/^(?:\])/,/^(?:\()/,/^(?:\|)/,/^(?:\))/,/^(?:\*)/,/^(?:\+)/,/^(?:\?)/,/^(?:\{)/,/^(?:\})/,/^(?:\])/,/^(?:\^)/,/^(?:\\p\{.*?\})/,/^(?:\\P\{.*?\})/,/^(?:\.)/,/^(?:$)/,/^(?:[^\\])/],conditions:{CHARCLASS:{rules:[3,4,5,6,7,8,9,10],inclusive:!1},QUANTITY:{rules:[0,1,2],inclusive:!1},INITIAL:{rules:[3,4,5,6,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],inclusive:!0}}};return e}();return D.lexer=R,D}),define("salve/datatypes/xmlschema",["require","exports","module","lodash","./errors","./regexp","./xmlcharacters"],function(e,t,n){"use strict";function i(e,t){return-1!==e.search(/^\d+$/)?!1:new F(t+" must have an integer value")}function r(e,t){return!i(e,t)&&Number(e)>=0?!1:new F(t+" must have a non-negative integer value")}function o(e,t){return!i(e,t)&&Number(e)>0?!1:new F(t+" must have a positive value")}function a(e,t){switch(t){case p:break;case _:e=e.replace(/\r\n\t/g," ");break;case f:e=e.replace(/\r\n\t/g," ").trim().replace(/\s{2,}/g," ");break;default:throw new Error("unexpected value: "+t)}return e}function s(e){return e%4===0&&e%100!==0||e%400===0}function l(e){var t=e.match(Le);if(!t)return NaN;var n=t[1],i=s(Number(n)),r=Number(t[2]);if(0===r||r>12)return NaN;var o=Number(t[3]),a=Me[r];if(2!==r||i||(a=28),0===o||o>a)return NaN;var l=t[4].split(":"),d=Number(l[1]);if(d>59)return NaN;var c=Number(l[2]);if(c>59)return NaN;var h=d||c?23:24;if(Number(l[0])>h)return NaN;if(t[5]&&"Z"!==t[5]){var u=t[5].split(":"),p=Number(u[0].slice(1));if(p>14)return NaN;var _=Number(u[1]);if(_>59)return NaN;if(14===p&&0!==_)return NaN}return!0}var d=e("lodash"),c=e("./errors"),h=e("./regexp"),u=e("./xmlcharacters"),p=1,_=2,f=3,E=u.xml_Name_re,m=u.xml_NCName,A=u.xml_NCName_re,v=u.xml_Name_Char,F=(u.xml_Letter,c.ParamError),g=c.ValueError,C=c.ParameterParsingError,D=c.ValueValidationError,y={name:"length",repeatable:!1,convert:Number,isInvalidParam:r,isInvalidValue:function(e,t,n){return n.valueLength(e)===t?!1:new g("length of value should be "+t)}},w={name:"minLength",repeatable:!1,convert:Number,isInvalidParam:r,isInvalidValue:function(e,t,n){return n.valueLength(e)>=t?!1:new g("length of value should be greater than or equal to "+t)}},B={name:"maxLength",repeatable:!1,convert:Number,isInvalidParam:r,isInvalidValue:function(e,t,n){return n.valueLength(e)<=t?!1:new g("length of value should be less than or equal to "+t)}},b=Object.create(null),N={name:"pattern",repeatable:"combine",convert:function(e){var t=b[e];return void 0===t&&(t=b[e]=h.parse(e)),{rng:e,internal:t}},combine:function(e){return d.map(e,this.convert)},isInvalidParam:function(e){try{this.convert(e)}catch(t){if(t instanceof h.SalveParsingError)return new F(t.message);throw t}return!1},isInvalidValue:function(e,t,n){if(t instanceof Array){for(var i,r=0;!i&&r<t.length;++r)t[r].internal.test(e)||(i=t[r]);return i?new g("value does not match the pattern "+i.rng):!1}return t.internal.test(e)?!1:new g("value does not match the pattern "+t.rng)}},x={name:"totalDigits",repeatable:!1,convert:Number,isInvalidParam:o,isInvalidValue:function(e,t,n){var i=String(Number(e)).replace(/[-+.]/g,"");return i.length>t?new g("value must have at most "+t+" digits"):!1}},T={name:"fractionDigits",repeatable:!1,convert:Number,isInvalidParam:r,isInvalidValue:function(e,t,n){var i=String(Number(e)).replace(/^.*\./,"");return i.length>t?new g("value must have at most "+t+" fraction digits"):!1}},k={name:"maxInclusive",repeatable:!1,convert:Number,isInvalidParam:function(e,t,n){return n.disallows(e)},isInvalidValue:function(e,t,n){return e>t?new g("value must be less than or equal to "+t):!1}},S={name:"maxExclusive",repeatable:!1,convert:Number,isInvalidParam:function(e,t,n){return n.disallows(e)},isInvalidValue:function(e,t,n){return e>=t?new g("value must be less than "+t):!1}},R={name:"minInclusive",repeatable:!1,convert:Number,isInvalidParam:function(e,t,n){return n.disallows(e)},isInvalidValue:function(e,t,n){return t>e?new g("value must be greater than or equal to "+t):!1}},O={name:"minExclusive",repeatable:!1,convert:Number,isInvalidParam:function(e,t,n){return n.disallows(e)},isInvalidValue:function(e,t,n){return t>=e?new g("value must be greater than "+t):!1}},I={init:function(){this.valid_params&&(this.param_name_to_obj=d.keyBy(this.valid_params,"name")),this.default_params=this.parseParams()},whiteSpaceDefault:f,convertValue:function(e,t){return a(e,this.whiteSpaceDefault)},valueLength:function(e){return e.length},parseValue:function(e,t){var n=this.disallows(e,{},t);if(n.length)throw new D(n);return{value:this.convertValue(e,t)}},parseParams:function(e,t){var n=this,i=[],r={};if(d.each(t,function(e){var t=e.name;if(!n.param_name_to_obj.hasOwnProperty(t))return void i.push(new F("unexpected parameter: "+t));var o=n.param_name_to_obj[t],a=o.isInvalidParam(e.value,t,n);a&&i.push(a),r.hasOwnProperty(t)&&!o.repeatable&&i.push(new F("cannot repeat parameter "+t)),r[t]=!0}),i.length)throw new C(e,i);var o=Object.create(null);if(d.each(d.groupBy(t,"name"),function(e,t){var i=n.param_name_to_obj[t];e.length>1?o[t]=i.combine(d.reduceRight(d.map(e,"value"),function(e,t){return e.concat(t)},[]),n):o[t]=i.convert?i.convert(e[0].value,n):e[0].value}),o.minLength>o.maxLength&&i.push(new F("minLength must be less than or equal to maxLength")),void 0!==o.length&&(void 0!==o.minLength&&i.push(new F("length and minLength cannot appear together")),void 0!==o.maxLength&&i.push(new F("length and maxLength cannot appear together"))),void 0!==o.maxInclusive&&(void 0!==o.maxExclusive&&i.push(new F("maxInclusive and maxExclusive cannot appear together")),o.minExclusive>=o.maxInclusive&&i.push(new F("minExclusive must be less than maxInclusive"))),void 0!==o.minInclusive&&(void 0!==o.minExclusive&&i.push(new F("minInclusive and minExclusive cannot appear together")),o.minInclusive>o.maxInclusive&&i.push(new F("minInclusive must be less than or equal to maxInclusive")),o.minInclusive>=o.maxExclusive&&i.push(new F("minInclusive must be less than maxExclusive"))),o.minExclusive>o.maxExclusive&&i.push(new F("minExclusive must be less than or equal to maxExclusive")),i.length)throw new C(i);return o},disallowedByParams:function(e,t,n,i){var r=this;if(n){var o=[];if(d.each(Object.keys(n),function(e){var i=r.param_name_to_obj[e],a=i.isInvalidValue(t,n[e],r);a&&o.push(a)}),o.length)return o}return!1},equal:function(e,t,n){if(void 0===t.value)throw Error("it looks like you are trying to use an unparsed value");var i;try{i=this.convertValue(e,n)}catch(r){if(r instanceof D)return!1;throw r}return i===t.value},disallows:function(e,t,n){if(t instanceof Array)throw new Error("it looks like you are passing unparsed parameters to disallows");if(t&&0!==Object.keys(t).length||(t=this.default_params),this.regexp&&!a(e,f).match(this.regexp))return[new g(this.type_error_msg)];var i;try{i=this.convertValue(e,n)}catch(r){if(r instanceof D)return r.errors;throw r}var o=this.disallowedByParams(e,i,t,n);return o.length?o:!1}},L=d.extend({},I,{name:"string",type_error_msg:"value is not a string",whiteSpaceDefault:p,valid_params:[y,w,B,N],needs_context:!1,regexp:/^.*$/}),M=d.extend({},L,{name:"normalizedString",type_error_msg:"string contains a tab, carriage return or newline",regexp:/^[^\r\n\t]+$/}),P=d.extend({},M,{name:"token",type_error_msg:"not a valid token",regexp:/^(?:(?! )(?:(?!   )[^\r\n\t])*[^\r\n\t ])?$/}),H=d.extend({},P,{name:"language",type_error_msg:"not a valid language identifier",regexp:/^[a-zA-Z]{1,8}(-[a-zA-Z0-9]{1,8})*$/}),$=d.extend({},P,{name:"Name",type_error_msg:"not a valid Name",regexp:E}),j=d.extend({},$,{name:"NCName",type_error_msg:"not a valid NCName",regexp:A}),U=new RegExp("^["+v+"]+$"),W=d.extend({},P,{name:"NMTOKEN",type_error_msg:"not a valid NMTOKEN",regexp:U}),V=new RegExp("^["+v+"]+(?: ["+v+"]+)*$"),q=d.extend({},W,{name:"NMTOKENS",type_error_msg:"not a valid NMTOKENS",regexp:V,whiteSpaceDefault:f}),G=d.extend({},j,{name:"ID",type_error_msg:"not a valid ID"}),X=d.extend({},j,{name:"IDREF",type_error_msg:"not a valid IDREF"}),z=new RegExp("^"+m+"(?: "+m+")*$"),K=d.extend({},X,{name:"IDREFS",type_error_msg:"not a valid IDREFS",regexp:z,whiteSpaceDefault:f}),Y=d.extend({},L,{name:"ENTITY",type_error_msg:"not a valid ENTITY"}),Z=d.extend({},L,{name:"ENTITIES",type_error_msg:"not a valid ENTITIES"}),Q="[-+]?(?!$)\\d*(\\.\\d*)?",J=d.extend({},I,{name:"decimal",type_error_msg:"value not a decimal number",regexp:new RegExp("^"+Q+"$"),whiteSpaceDefault:f,convertValue:function(e,t){return Number(I.convertValue(e))},valid_params:[x,T,N,O,R,S,k],needs_context:!1}),ee="[-+]?\\d+",te=d.extend({},J,{name:"integer",type_error_msg:"value is not an integer",regexp:new RegExp("^"+ee+"$"),valid_params:[x,N,O,R,S,k],parseParams:function(e,t){var n=J.parseParams(e,t);if(void 0!==this.highest_val)if(void 0!==n.maxExclusive){var i=n.maxExclusive;if(i>this.highest_val)throw new C(new F("maxExclusive cannot be greater than "+this.highest_val))}else if(void 0!==n.maxInclusive){var r=n.maxInclusive;if(r>this.highest_val)throw new C(new F("maxInclusive cannot be greater than "+this.highest_val))}else n.maxInclusive=this.highest_val;if(void 0!==this.lowest_val)if(void 0!==n.minExclusive){var i=n.minExclusive;if(i<this.lowest_val)throw new C(new F("minExclusive cannot be lower than "+this.lowest_val))}else if(void 0!==n.minInclusive){var r=n.minInclusive;if(r<this.lowest_val)throw new C(new F("minInclusive cannot be lower than "+this.lowest_val))}else n.minInclusive=this.lowest_val;return n}}),ne=d.extend({},te,{name:"nonPositiveInteger",type_error_msg:"value is not a nonPositiveInteger",regexp:/^\+?0+|-\d+$/,highest_val:0,valid_params:[x,N,O,R,S,k]}),ie=d.extend({},ne,{name:"negativeInteger",type_error_msg:"value is not a negativeInteger",regexp:/^-\d+$/,highest_val:-1,valid_params:[x,N,O,R,S,k]}),re=d.extend({},te,{name:"nonNegativeInteger",type_error_msg:"value is not a nonNegativeInteger",regexp:/^\+?\d+$/,lowest_val:0,valid_params:[x,N,O,R,S,k]}),oe=d.extend({},re,{name:"positiveInteger",type_error_msg:"value is not a positiveInteger",regexp:/^\+?\d+$/,lowest_val:1,valid_params:[x,N,O,R,S,k]}),ae=d.extend({},te,{name:"long",type_error_msg:"value is not a long",highest_val:0x8000000000000000,lowest_val:-0x8000000000000000,valid_params:[x,N,O,R,S,k]}),se=d.extend({},ae,{name:"int",type_error_msg:"value is not an int",highest_val:2147483647,lowest_val:-2147483648}),le=d.extend({},se,{name:"short",type_error_msg:"value is not a short",highest_val:32767,lowest_val:-32768}),de=d.extend({},le,{name:"byte",type_error_msg:"value is not a byte",highest_val:127,lowest_val:-128}),ce=d.extend({},re,{name:"unsignedLong",type_error_msg:"value is not an unsignedLong",highest_val:0x10000000000000000,valid_params:[x,N,O,R,S,k]}),he=d.extend({},ce,{name:"unsignedInt",type_error_msg:"value is not an unsignedInt",highest_val:4294967295,valid_params:[x,N,O,R,S,k]}),ue=d.extend({},he,{name:"unsignedShort",type_error_msg:"value is not an unsignedShort",highest_val:65535,valid_params:[x,N,O,R,S,k]}),pe=d.extend({},ue,{name:"unsignedShort",type_error_msg:"value is not an unsignedByte",highest_val:255,valid_params:[x,N,O,R,S,k]}),_e=d.extend({},I,{name:"boolean",type_error_msg:"not a valid boolean",regexp:/^(1|0|true|false)$/,valid_params:[N],convertValue:function(e,t){return"1"===e||"true"===e}}),fe="[AQgw]",Ee="[AEIMQUYcgkosw048]",me="[A-Za-z0-9+/]",Ae="(?:"+me+" ?)",ve="(?:"+Ee+" ?)",Fe="(?:"+fe+" ?)",ge=new RegExp("^(?:(?:"+Ae+"{4})*(?:(?:"+Ae+"{3}"+me+")|(?:"+Ae+"{2}"+ve+"=)|(?:"+Ae+Fe+"= ?=)))?$"),Ce=d.extend({},I,{name:"base64Binary",type_error_msg:"not a valid base64Binary",regexp:ge,valid_params:[y,w,B,N],convertValue:function(e,t){return e.replace(/\s/g,"")},valueLength:function(e){return Math.floor(3*e.replace(/[\s=]/g,"").length/4)}}),De=d.extend({},I,{name:"hexBinary",type_error_msg:"not a valid hexBinary",regexp:/^(?:[0-9a-fA-F]{2})*$/,valid_params:[y,w,B,N],convertValue:function(e,t){return e},valueLength:function(e){return e.length/2}}),ye=new RegExp("^(?:(?:[-+]?INF)|(?:NaN)|(?:"+Q+"(?:[Ee]"+ee+")?))$"),we=d.extend({},I,{name:"float",type_error_msg:"not a valid float",regexp:ye,valid_params:[N,R,O,k,S],convertValue:parseFloat}),Be=d.extend({},I,{name:"double",type_error_msg:"not a valid double",regexp:ye,valid_params:[N,R,O,k,S],convertValue:parseFloat}),be=d.extend({},I,{name:"QName",type_error_msg:"not a valid QName",regexp:new RegExp("^(?:"+m+":)?"+m+"$"),needs_context:!0,convertValue:function(e,t){var n=t.resolver.resolveName(I.convertValue(e));if(void 0===n)throw new D([new g("cannot resolve the name "+e)]);return"{"+n.ns+"}"+n.name},valid_params:[N,y,w,B]}),Ne=d.extend({},I,{name:"NOTATION",type_error_msg:"not a valid NOTATION",regexp:new RegExp("^(?:"+m+":)?"+m+"$"),needs_context:!0,convertValue:function(e,t){var n=t.resolver.resolveName(I.convertValue(e));if(void 0===n)throw new D([new g("cannot resolve the name "+e)]);return"{"+n.ns+"}"+n.name},valid_params:[N,y,w,B]}),xe=d.extend({},I,{name:"duration",type_error_msg:"not a valid duration",regexp:/^-?P(?!$)(?:\d+Y)?(?:\d+M)?(?:\d+D)?(?:T(?!$)(?:\d+H)?(?:\d+M)?(?:\d+(\.\d+)?S)?)?$/,valid_params:[N]}),Te="-?(?:[1-9]\\d*)?\\d{4}",ke="[01]\\d",Se="[0-3]\\d",Re="[012]\\d:[0-5]\\d:[0-5]\\d(?:\\.\\d+)?",Oe="(?:[+-][01]\\d:[0-5]\\d|Z)",Ie=new RegExp(Oe+"$"),Le=new RegExp("^("+Te+")-("+ke+")-("+Se+")T("+Re+")("+Oe+"?)$"),Me=[void 0,31,29,31,30,31,30,31,31,30,31,30,31],Pe=d.extend({},I,{name:"dateTime",type_error_msg:"not a valid dateTime",regexp:new RegExp("^"+Te+"-"+ke+"-"+Se+"T"+Re+Oe+"?$"),valid_params:[N],disallows:function(e,t,n){var i=I.disallows.call(this,e,t,n);return i?i:isNaN(l(e))?[new g(this.type_error_msg)]:!1}}),He=d.extend({},I,{name:"time",type_error_msg:"not a valid time",regexp:new RegExp("^"+Re+Oe+"?$"),valid_params:[N],disallows:function(e,t,n){var i=I.disallows.call(this,e,t,n);return i?i:isNaN(l("1901-01-01T"+e))?[new g(this.type_error_msg)]:!1}}),$e=d.extend({},I,{name:"date",type_error_msg:"not a valid date",regexp:new RegExp("^"+Te+"-"+ke+"-"+Se+Oe+"?$"),valid_params:[N],disallows:function(e,t,n){var i=I.disallows.call(this,e,t,n);if(i)return i;var r=e.match(Ie);return e=r?e.slice(0,r.index)+"T00:00:00"+r[0]:e+"T00:00:00",isNaN(l(e))?[new g(this.type_error_msg)]:!1}}),je=d.extend({},I,{name:"gYearMonth",type_error_msg:"not a valid gYearMonth",regexp:new RegExp("^"+Te+"-"+ke+Oe+"?$"),valid_params:[N],disallows:function(e,t,n){var i=I.disallows.call(this,e,t,n);if(i)return i;var r=e.match(Ie);return e=r?e.slice(0,r.index)+"-01T00:00:00"+r[0]:e+"-01T00:00:00",isNaN(l(e))?[new g(this.type_error_msg)]:!1}}),Ue=d.extend({},I,{name:"gYear",type_error_msg:"not a valid gYear",regexp:new RegExp("^"+Te+Oe+"?$"),valid_params:[N],disallows:function(e,t,n){var i=I.disallows.call(this,e,t,n);if(i)return i;var r=e.match(Ie);return e=r?e.slice(0,r.index)+"-01-01T00:00:00"+r[0]:e+"-01-01T00:00:00",isNaN(l(e))?[new g(this.type_error_msg)]:!1}}),We=d.extend({},I,{name:"gMonthDay",type_error_msg:"not a valid gMonthDay",regexp:new RegExp("^"+ke+"-"+Se+Oe+"?$"),valid_params:[N],disallows:function(e,t,n){var i=I.disallows.call(this,e,t,n);if(i)return i;var r=e.match(Ie);return e=r?e.slice(0,r.index)+"T00:00:00"+r[0]:e+"T00:00:00",isNaN(l("2000-"+e))?[new g(this.type_error_msg)]:!1}}),Ve=d.extend({},I,{name:"gDay",type_error_msg:"not a valid gDay",regexp:new RegExp("^"+Se+Oe+"?$"),valid_params:[N],disallows:function(e,t,n){var i=I.disallows.call(this,e,t,n);if(i)return i;var r=e.match(Ie);return e=r?e.slice(0,r.index)+"T00:00:00"+r[0]:e+"T00:00:00",isNaN(l("2000-01-"+e))?[new g(this.type_error_msg)]:!1}}),qe=d.extend({},I,{name:"gMonth",type_error_msg:"not a valid gMonth",regexp:new RegExp("^"+ke+Oe+"?$"),valid_params:[N],disallows:function(e,t,n){var i=I.disallows.call(this,e,t,n);if(i)return i;var r=e.match(Ie);return e=r?e.slice(0,r.index)+"-01T00:00:00"+r[0]:e+"-01T00:00:00",isNaN(l("2000-"+e))?[new g(this.type_error_msg)]:!1}}),Ge=/^(?:[A-Za-z][A-Za-z0-9+\-.]*:(?:\/\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\.[A-Za-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\?(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?(?:\#(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?|(?:\/\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\.[A-Za-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\-._~!$&'()*+,;=@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\?(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?(?:\#(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?)$/,Xe=d.extend({},I,{name:"anyURI",type_error_msg:"not a valid anyURI",regexp:Ge,valid_params:[N,y,w,B]}),ze={uri:"http://www.w3.org/2001/XMLSchema-datatypes",types:{string:L,normalizedString:M,token:P,language:H,Name:$,NCName:j,NMTOKEN:W,NMTOKENS:q,ID:G,IDREF:X,IDREFS:K,ENTITY:Y,ENTITIES:Z,decimal:J,integer:te,nonPositiveInteger:ne,negativeInteger:ie,nonNegativeInteger:re,positiveInteger:oe,
"long":ae,"int":se,"short":le,"byte":de,unsignedLong:ce,unsignedInt:he,unsignedShort:ue,unsignedByte:pe,"boolean":_e,base64Binary:Ce,hexBinary:De,"float":we,"double":Be,QName:be,NOTATION:Ne,duration:xe,dateTime:Pe,time:He,date:$e,gYearMonth:je,gYear:Ue,gMonthDay:We,gDay:Ve,gMonth:qe,anyURI:Xe}};d.each(Object.keys(ze.types),function(e){ze.types[e].init()}),t.xmlschema=ze}),define("salve/datatypes",["require","exports","module","./datatypes/builtin","./datatypes/xmlschema","./datatypes/errors"],function(e,t,n){"use strict";function i(){this.libraries=Object.create(null)}var r=e("./datatypes/builtin").builtin,o=e("./datatypes/xmlschema").xmlschema,a=e("./datatypes/errors");i.prototype.add=function(e){var t=e.uri;if(t in this.libraries)throw new Error("URI clash: "+t);this.libraries[t]=e},i.prototype.find=function(e){return this.libraries[e]},i.prototype.get=function(e){var t=this.find(e);if(!t)throw new Error("can't get library with URI: "+e);return t};var s=new i;s.add(r),s.add(o),t.registry=s,t.ParameterParsingError=a.ParameterParsingError,t.ValueValidationError=a.ValueValidationError,t.ValueError=a.ValueError}),define("salve/errors",["require","exports","module","./oop"],function(e,t,n){"use strict";function i(e){this.msg=e}function r(e,t){i.call(this,e),this.name=t}function o(){r.apply(this,arguments)}function a(){r.apply(this,arguments)}function s(){r.apply(this,arguments)}function l(e,t){i.call(this,""),this.names_a=e,this.names_b=t}var d=e("./oop"),c=d.inherit;i.prototype.toString=function(){return this.msg},i.prototype.getNames=function(){return[]},i.prototype.toStringWithNames=function(e){return this.msg},c(r,i),r.prototype.toString=function(){return this.toStringWithNames([this.name])},r.prototype.getNames=function(){return[this.name]},r.prototype.toStringWithNames=function(e){return this.msg+": "+e[0]},c(o,r),c(a,r),c(s,r),c(l,i),l.prototype.toString=function(){return this.toStringWithNames(this.names_a.concat(this.names_b))},l.prototype.getNames=function(){return this.names_a.concat(this.names_b)},l.prototype.toStringWithNames=function(e){var t=e.slice(0,this.names_a.length),n=e.slice(this.names_a.length);return"must choose either "+t.join(", ")+" or "+n.join(", ")},t.ValidationError=i,t.ChoiceError=l,t.ElementNameError=s,t.AttributeNameError=o,t.AttributeValueError=a}),define("salve/name_patterns",["require","exports","module","./oop"],function(e,t,n){"use strict";function i(e){this.path=e}function r(e,t,n){i.call(this,e),this.ns=t,this.name=n}function o(e,t){i.call(this,e),this.a=t[0],this.b=t[1]}function a(e,t,n){i.call(this,e),this.ns=t,this.except=n}function s(e,t){i.call(this,e),this.except=t}var l=e("./oop");i.prototype.match=function(e,t){throw new Error("subclasses must implement this method.")},i.prototype.wildcardMatch=function(e,t){throw new Error("subclasses must implement this method.")},i.prototype.simple=function(){throw new Error("subclasses must implement this method.")},i.prototype.getNamespaces=function(){var e=Object.create(null);return this._recordNamespaces(e),Object.keys(e)},i.prototype._recordNamespaces=function(e){throw new Error("subclasses must implement this method.")},i.prototype.toObject=function(){throw new Error("subclasses must implement this method.")},i.prototype.toJSON=function(){return this.toObject()},i.prototype.toArray=function(){throw new Error("subclasses must implement this method.")},i.prototype.toString=function(){return JSON.stringify(this)},l.inherit(r,i),r.prototype.match=function(e,t){return this.ns===e&&this.name===t},r.prototype.wildcardMatch=function(e,t){return!1},r.prototype.toObject=function(){return{ns:this.ns,name:this.name}},r.prototype.simple=function(){return!0},r.prototype.toArray=function(){return[this]},r.prototype._recordNamespaces=function(e){e[this.ns]=1},l.inherit(o,i),o.prototype.match=function(e,t){return this.a.match(e,t)||this.b.match(e,t)},o.prototype.wildcardMatch=function(e,t){return this.a.wildcardMatch(e,t)||this.b.wildcardMatch(e,t)},o.prototype.toObject=function(){return{a:this.a.toObject(),b:this.b.toObject()}},o.prototype.simple=function(){return this.a.simple()&&this.b.simple()},o.prototype.toArray=function(){var e=this.a.toArray();if(!e)return null;var t=this.b.toArray();return t?e.concat(t):null},o.prototype._recordNamespaces=function(e){this.a._recordNamespaces(e),this.b._recordNamespaces(e)},l.inherit(a,i),a.prototype.match=function(e,t){return this.ns===e&&!(this.except&&this.except.match(e,t))},a.prototype.wildcardMatch=function(e,t){return this.match(e,t)},a.prototype.toObject=function(){var e={ns:this.ns};return this.except&&(e.except=this.except.toObject()),e},a.prototype.simple=function(){return!1},a.prototype.toArray=function(){return null},a.prototype._recordNamespaces=function(e){e[this.ns]=1,this.except&&(e["::except"]=1)},l.inherit(s,i),s.prototype.match=function(e,t){return!this.except||!this.except.match(e,t)},s.prototype.wildcardMatch=function(e,t){return this.match(e,t)},s.prototype.toObject=function(){var e={pattern:"AnyName"};return this.except&&(e.except=this.except.toObject()),e},s.prototype.simple=function(){return!1},s.prototype.toArray=function(){return null},s.prototype._recordNamespaces=function(e){e["*"]=1,this.except&&(e["::except"]=1)},t.Name=r,t.NameChoice=o,t.NsName=a,t.AnyName=s}),define("salve/patterns",["require","exports","module","./name_resolver","./util","./hashstructs","./oop","./set","./datatypes","./errors","./name_patterns"],function(e,t,n){"use strict";function i(e,t){e.prototype.newWalker=function(e){return new t(this,e)}}function r(e){function t(){return void 0!==t.prototype.__singleton_instance?t.prototype.__singleton_instance:(e.apply(this,arguments),t.prototype.__singleton_instance=this,this)}return t}function o(e,t){this.ns=e,this.name=t}function a(e){return e.hash()}function s(e){this.id="P"+this.__newID(),this.xml_path=e}function l(e){s.call(this,e),this.pat=void 0}function d(e){s.call(this,e),this.pat_a=void 0,this.pat_b=void 0}function c(){var e;if(arguments[0]instanceof Array)e=arguments[0];else{var t=arguments.length;e=new Array(t);for(var n=0;t>n;++n)e[n]=arguments[n]}var i=e.join(),r=c.__cache[i];return void 0!==r?r:(this.id=this.__newID(),this.params=e,this.key=i,c.__cache[i]=this,this)}function h(e){var t=function(e){return e},n=new re(t);e.forEach(function(e){var i=e;e instanceof c&&(i=e.params);for(var r=n,o=0;o<i.length;++o)if(o===i.length-1)r.add(i[o],!1);else{var a=r.has(i[o]);void 0===a&&(a=new re(t),r.add(i[o],a)),r=a}});var i=function(){var e="",t="    ";return function(n,r){var o="",a=n.keys();return a.sort(),a.forEach(function(r){var a=n.has(r);a!==!1?(o+=e+r+":\n",e+=t,o+=i(n.has(r)),e=e.slice(t.length)):o+=e+r+"\n"}),o}}();return i(n)}function u(e){this.length=e}function p(){this.id="W"+this.__newID(),this.possible_cached=void 0,this.suppressed_attributes=!1}function _(){throw new Error("not meant to be called")}function f(){throw new Error("not meant to be called")}function E(e){p.call(this),this.possible_cached=new he}function m(e,t){l.call(this,e),this.pat=t}function A(e,t){p.call(this),this.el=e,this.name_resolver=t,this.subwalker=void 0!==e?e.pat.newWalker(this.name_resolver):void 0,this.seen_tokens=!1,this.matched=!1}function v(e,t,n,i,r){if(s.call(this,e),this.type=n||"token",this.datatype_library=i||"",this.ns=r||"",this.datatype=te.get(this.datatype_library).types[this.type],!this.datatype)throw new Error("unkown type: "+n);this.raw_value=t,this._value=void 0}function F(e,t){p.call(this),this.el=e,this.name_resolver=t,this.matched=!1,this.possible_cached=e?new he(new c("text",e.raw_value)):void 0,this.context=e&&e.datatype.needs_context?{resolver:this.name_resolver}:void 0}function g(e,t,n,i,r){if(s.call(this,e),this.type=t||"token",this.datatype_library=n||"",this.except=r,this.datatype=te.get(this.datatype_library).types[this.type],!this.datatype)throw new Error("unkown type: "+t);this.rng_params=i||[],this._params=void 0}function C(e,t){p.call(this),this.el=e,this.name_resolver=t,this.el&&(this.possible_cached=new he(new c("text",this.el.datatype.regexp)),this.context=this.el.datatype.needs_context?{resolver:this.name_resolver}:void 0)}function D(e){p.call(this),this.el=e,this.possible_cached=new he}function y(e){p.call(this),this.possible_cached=new he(y._text_event)}function w(e,t){s.call(this,e),this.name=t,this.resolves_to=void 0}function B(e,t){if(l.call(this,e),void 0!==t){if(1!==t.length)throw new Error("OneOrMore needs exactly one pattern.");this.pat=t[0]}}function b(e,t){p.call(this),this.seen_once=!1,this.el=e,this.name_resolver=t,this.current_iteration=void 0,this.next_iteration=void 0}function N(e,t){if(d.call(this,e),void 0!==t){if(2!==t.length)throw new Error("ChoiceWalker does not work with Choices that have not exactly 2 elements");this.pat_a=t[0],this.pat_b=t[1]}}function x(e,t){p.call(this),this.el=e,this.name_resolver=t,this.chosen=!1,this.walker_a=this.walker_b=void 0,this.instantiated_walkers=!1}function T(e,t){if(d.call(this,e),void 0!==t){if(2!==t.length)throw new Error("GroupWalkers walk only groups of two elements!");this.pat_a=t[0],this.pat_b=t[1]}}function k(e,t){p.call(this),this.el=e,this.name_resolver=t,this.hit_a=!1,this.ended_a=!1,this.hit_b=!1,this.walker_a=this.walker_b=void 0}function S(e,t){if(d.call(this,e),void 0!==t){if(2!==t.length)throw new Error("InterleaveWalkers walk only interleaves of two elements!");this.pat_a=t[0],this.pat_b=t[1]}}function R(e,t){p.call(this),this.el=e,this.name_resolver=t,this.in_a=!1,this.in_b=!1,this.walker_a=this.walker_b=void 0}function O(e,t,n){if(l.call(this,e),this.name=t,void 0!==n){if(1!==n.length)throw new Error("Attribute needs exactly one pattern.");this.pat=n[0]}}function I(e,t){p.call(this),this.el=e,this.name_resolver=t,this.seen_name=!1,this.seen_value=!1,this.subwalker=void 0,this.attr_name_event=e&&new c("attributeName",e.name)}function L(e,t,n){if(l.call(this,e),this.name=t,void 0!==n){if(1!==n.length)throw new Error("Element requires exactly one pattern.");this.pat=n[0]}}function M(e,t){p.call(this),this.el=e,this.name_resolver=t,this.seen_name=!1,this.ended_start_tag=!1,this.closed=!1,this.walker=void 0,this.start_tag_event=e&&new c("enterStartTag",e.name),this.end_tag_event=void 0,this.bound_name=void 0}function P(e,t,n){if(l.call(this,e),this.name=t,void 0!==n){if(1!==n.length)throw new Error("Define needs exactly one pattern.");this.pat=n[0]}}function H(e,t){p.call(this),this.el=e,this.name_resolver=t,this.subwalker=void 0!==e?e.pat.newWalker(this.name_resolver):void 0}function $(e){this.references=e}function j(e,t,n){this.xml_path=e,this.start=t,this.definitions=Object.create(null),this._element_definitions=void 0,this._namespaces=Object.create(null);var i=this;n&&n.forEach(function(e){i.add(e)}),this._resolve(),this._prepare(this._namespaces)}function U(e){p.call(this),this.el=e,this._name_resolver=new W.NameResolver,this.subwalker=void 0!==e?e.start.newWalker(this._name_resolver):void 0,this._misplaced_elements=[],this._swallow_attribute_value=!1,this.suspended_ws=void 0,this.ignore_next_ws=!1,this._prev_ev_was_text=!1}var W=e("./name_resolver"),V=e("./util"),q=e("./hashstructs"),G=e("./oop"),X=e("./set").Set,z=e("./datatypes"),K=e("./errors"),Y=K.ValidationError,Z=K.ElementNameError,Q=K.AttributeNameError,J=K.AttributeValueError,ee=K.ChoiceError,te=z.registry,ne=G.inherit,ie=G.implement,re=(q.HashSet,q.HashMap),oe=!1;if(oe){var ae,se,le,de,ce=function(e){console.log(e)};!function(){var e="",t=" ",n=function(e){var t=e.el;if(!t)return"";if(void 0===t.name)return" with path "+t.xml_path;var n=" named "+t.name.toString();return e.bound_name?n+" (bound to "+e.bound_name.toString()+")":n};de=function(t,i,r){ce(e+t+i+" on class "+r.constructor.name+" id "+r.id+n(r))},ae=function(n,i,r){e+=t,de("calling ",i,this);var o=n.apply(this,r);return de("called ",i,this),ce(e+"return from the call: "+V.inspect(o)),e=e.slice(t.length),o},se=function(n,i,r){e+=t,de("calling ",i,this),ce(e+V.inspect(r[0]));var o=n.apply(this,r);return de("called ",i,this),o!==!1&&ce(e+"return from the call: "+V.inspect(o)),e=e.slice(t.length),o},le=function(n,i,r){e+=t,de("calling ",i,this);var o=n.apply(this,r);return de("called ",i,this),e=e.slice(t.length),o}}()}var he=X;o.prototype.toString=function(){return"{"+this.ns+"}"+this.name},o.prototype.equal=function(e){return this.ns===e.ns&&this.name===e.name},ne(s,Object),s.__id=0,s.prototype.__newID=function(){return s.__id++},s.prototype.hash=function(){return this.id},s.prototype._resolve=function(e){},s.prototype._prepare=function(e){},s.prototype.newWalker=function(){throw new Error("must define newWalker method")},s.prototype.clone=function(){return this._clone(new re(a))},s.prototype._clone=function(e){var t=e.has(this);return void 0!==t?t:(t=new this.constructor,e.add(this,t),this._copyInto(t,e),t)},s.prototype._copyInto=function(e,t){e.xml_path=this.xml_path},s.prototype._hasAttrs=function(){return!1},s.prototype._elementDefinitions=function(e){},ne(l,s),l.prototype._resolve=function(e){return this.pat._resolve(e)},l.prototype._copyInto=function(e,t){s.prototype._copyInto.call(this,e,t),e.pat=this.pat._clone(t)},l.prototype._prepare=function(e){this.pat._prepare(e)},l.prototype._hasAttrs=function(){return this.pat._hasAttrs()},l.prototype._elementDefinitions=function(e){this.pat._elementDefinitions(e)},ne(d,s),d.prototype._resolve=function(e){var t=this.pat_a._resolve(e),n=this.pat_b._resolve(e);return t&&n?t.concat(n):t?t:n},d.prototype._copyInto=function(e,t){s.prototype._copyInto.call(this,e,t),e.pat_a=this.pat_a._clone(t),e.pat_b=this.pat_b._clone(t)},d.prototype._prepare=function(e){this.pat_a._prepare(e),this.pat_b._prepare(e)},d.prototype._hasAttrs=function(){return this.pat_a._hasAttrs()||this.pat_b._hasAttrs()},d.prototype._elementDefinitions=function(e){this.pat_a._elementDefinitions(e),this.pat_b._elementDefinitions(e)},c.__cache=Object.create(null),c.__id=0,c.prototype.__newID=function(){return c.__id++},c.prototype.hash=function(){return this.id},c.prototype.isAttributeEvent=function(){return"attributeName"===this.params[0]||"attributeValue"===this.params[0]},c.prototype.toString=function(){return"Event: "+this.params.join(", ")};var ue=new c("<empty>");p.__id=0,p.prototype.__newID=function(){return p.__id++},p.prototype.hash=function(){return this.id},p.prototype.possible=function(){return new he(this._possible())},p.prototype._possible=function(){throw new Error("must be implemented by derived classes")},p.prototype.fireEvent=function(e){throw new Error("must be implemented by derived classes")},p.prototype.canEnd=function(e){return!0},p.prototype.end=function(e){return!1},p.prototype.clone=function(){return this._clone(new re(a))},p.prototype._clone=function(e){var t=new this.constructor;return this._copyInto(t,e),t},p.prototype._cloneIfNeeded=function(e,t){var n=t.has(e);return void 0!==n?n:(n=e.clone(),t.add(e,n),n)},p.prototype._copyInto=function(e,t){e.possible_cached=this.possible_cached,e.suppressed_attributes=this.suppressed_attributes},p.prototype._suppressAttributes=function(){throw new Error("must be implemented by derived classes")},_.prototype._possible=function(e){return this.subwalker.possible()},_.prototype.fireEvent=function(e){return this.subwalker.fireEvent(e)},_.prototype._suppressAttributes=function(){this.suppressed_attributes||(this.suppressed_attributes=!0,this.subwalker._suppressAttributes())},_.prototype.canEnd=function(e){return this.subwalker.canEnd(e)},_.prototype.end=function(e){return this.subwalker.end(e)},f.prototype._suppressAttributes=function(){this.suppressed_attributes=!0},f.prototype.canEnd=function(e){return!0},f.prototype.end=function(e){return!1};var pe=r(s);ne(pe,s),i(pe,E),ne(E,p),ie(E,f),E.prototype.possible=function(){return new he},E.prototype._possible=function(){return this.possible_cached},E.prototype.fireEvent=function(e){return e===ue||"text"===e.params[0]&&""===e.params[1].trim()?!1:void 0};var _e=r(s);ne(_e,s),i(_e,y),ne(m,l),i(m,A),ne(A,p),ie(A,_),A.prototype._copyInto=function(e,t){p.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.subwalker=this.subwalker._clone(t),e.seen_tokens=this.seen_tokens,e.matched=this.matched},A.prototype.fireEvent=function(e){if("text"===e.params[0]){var t=e.params[1].trim();if(""===t)return!1;this.seen_tokens=!0;for(var n=t.split(/\s+/),i=0;i<n.length;++i){var r=this.subwalker.fireEvent(new c(e.params[0],n[i]));if(r!==!1)return r}return this.matched=!0,!1}},A.prototype._suppressAttributes=function(){},A.prototype.canEnd=function(e){return this.seen_tokens?this.subwalker.canEnd(e):this.subwalker.fireEvent(ue)===!1},A.prototype.end=function(e){var t=this.subwalker.end(e);return t!==!1?t:this.canEnd(e)?!1:[new Y("unfulfilled list")]},ne(v,s),i(v,F),v.prototype._copyInto=function(e,t){s.prototype._copyInto.call(this,e,t),e.value=this.value,e.raw_value=this.raw_value,e.type=this.type,e.datatype_library=this.datatype_library,e.ns=this.ns,e.datatype=this.datatype,e._value=this._value},Object.defineProperty(v.prototype,"value",{get:function(){var e=this._value;if(e)return e;var t;if(this.datatype.needs_context){var n=new W.NameResolver;n.definePrefix("",this.ns),t={resolver:n}}return e=this._value=this.datatype.parseValue(this.raw_value,t)}}),ne(F,p),F.prototype._copyInto=function(e,t){p.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.context=this.context?{resolver:e.name_resolver}:void 0,e.matched=this.matched},F.prototype._possible=function(){return this.possible_cached},F.prototype.fireEvent=function(e){return!this.matched&&"text"===e.params[0]&&this.el.datatype.equal(e.params[1],this.el.value,this.context)?(this.matched=!0,this.possible_cached=new he,!1):void 0},F.prototype.canEnd=function(e){return this.matched||""===this.el.raw_value},F.prototype.end=function(e){return this.canEnd(e)?!1:[new Y("value required: "+this.el.raw_value)]},F.prototype._suppressAttributes=function(){},ne(g,s),i(g,C),g.prototype._copyInto=function(e,t){s.prototype._copyInto.call(this,e,t),e.type=this.type,e.datatype_library=this.datatype_library,e.except=this.except&&this.except._clone(t),e.datatype=this.datatype,e.rng_params=this.rng_params,e._params=this._params},Object.defineProperty(g.prototype,"params",{get:function(){var e=this._params;return e?e:e=this._params=this.datatype.parseParams(this.xml_path,this.rng_params)}}),ne(C,p),C.prototype._copyInto=function(e,t){p.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.context=this.context?{resolver:e.name_resolver}:void 0,e.matched=this.matched},C.prototype._possible=function(){return this.possible_cached},C.prototype.fireEvent=function(e){if(!this.matched&&"text"===e.params[0]&&!this.el.datatype.disallows(e.params[1],this.el.params,this.context)){if(this.el.except){var t=this.el.except.newWalker(this.name_resolver),n=t.fireEvent(e);if(n===!1)return}return this.matched=!0,this.possible_cached=new he,!1}},C.prototype.canEnd=function(e){if(this.matched)return!0;if(this.el.except){var t=this.el.except.newWalker(this.name_resolver);if(t.canEnd())return!1}return!this.el.datatype.disallows("",this.el.params,this.context)},C.prototype.end=function(e){return this.canEnd(e)?!1:[new Y("value required")]},C.prototype._suppressAttributes=function(){};var fe=r(s);ne(fe,s),i(fe,D),ne(D,p),D.prototype._copyInto=function(e,t){p.prototype._copyInto.call(this,e,t),e.el=this.el},D.prototype.possible=function(){return new he},D.prototype._possible=function(){return this.possible_cached},D.prototype.fireEvent=function(e){};var Ee=r(s);ne(Ee,s),i(Ee,y),ne(y,p),ie(y,f),y._text_event=new c("text",/^.*$/),y.prototype._possible=function(){return this.possible_cached},y.prototype.fireEvent=function(e){return"text"===e.params[0]?!1:void 0},ne(w,s),w.prototype._prepare=function(){},w.prototype._copyInto=function(e,t){s.prototype._copyInto.call(this,e,t),e.name=this.name,e.resolves_to=this.resolves_to},w.prototype._resolve=function(e){return this.resolves_to=e[this.name],void 0===this.resolves_to?[this]:void 0},w.prototype.newWalker=function(e){return this.resolves_to.pat.newWalker(e)},ne(B,l),i(B,b),ne(b,p),b.prototype._copyInto=function(e,t){p.prototype._copyInto.call(this,e,t),e.seen_once=this.seen_once,e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.current_iteration=void 0!==this.current_iteration?this.current_iteration._clone(t):void 0,e.next_iteration=void 0!==this.next_iteration?this.next_iteration._clone(t):void 0},b.prototype._instantiateCurrentIteration=function(){void 0===this.current_iteration&&(this.current_iteration=this.el.pat.newWalker(this.name_resolver))},b.prototype._instantiateNextIteration=function(){void 0===this.next_iteration&&(this.next_iteration=this.el.pat.newWalker(this.name_resolver),this.suppressed_attributes&&this.next_iteration._suppressAttributes())},b.prototype._possible=function(){if(void 0!==this.possible_cached)return this.possible_cached;if(this._instantiateCurrentIteration(),this.possible_cached=this.current_iteration._possible(),this.current_iteration.canEnd()){this.possible_cached=new he(this.possible_cached),this._instantiateNextIteration();var e=this.next_iteration._possible(this.name_resolver);this.possible_cached.union(e)}return this.possible_cached},b.prototype.fireEvent=function(e){this.possible_cached=void 0,this._instantiateCurrentIteration();var t=this.current_iteration.fireEvent(e);if(t===!1&&(this.seen_once=!0),void 0!==t)return t;if(this.seen_once&&this.current_iteration.canEnd()){if(t=this.current_iteration.end())throw new Error("internal error; canEnd() returns true but end() fails");this._instantiateNextIteration();var n=this.next_iteration.fireEvent(e);return n===!1&&(this.current_iteration=this.next_iteration,this.next_iteration=void 0),n}},b.prototype._suppressAttributes=function(){this._instantiateCurrentIteration(),this.suppressed_attributes||(this.suppressed_attributes=!0,this.possible_cached=void 0,this.current_iteration._suppressAttributes(),this.next_iteration&&this.next_iteration._suppressAttributes())},b.prototype.canEnd=function(e){return e?this.el.pat._hasAttrs()?(this._instantiateCurrentIteration(),this.current_iteration.canEnd(!0)):!0:this.seen_once&&this.current_iteration.canEnd()},b.prototype.end=function(e){return this.canEnd(e)?!1:(this._instantiateCurrentIteration(),this.next_iteration=void 0,this.current_iteration.end(e))},ne(N,d),i(N,x),ne(x,p),x.prototype._copyInto=function(e,t){p.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.chosen=this.chosen,e.walker_a=void 0!==this.walker_a?this.walker_a._clone(t):void 0,e.walker_b=void 0!==this.walker_b?this.walker_b._clone(t):void 0,e.instantiated_walkers=this.instantiated_walkers},x.prototype._instantiateWalkers=function(){this.instantiated_walkers||(this.instantiated_walkers=!0,this.walker_a=this.el.pat_a.newWalker(this.name_resolver),this.walker_b=this.el.pat_b.newWalker(this.name_resolver))},x.prototype._possible=function(){if(this._instantiateWalkers(),void 0!==this.possible_cached)return this.possible_cached;if(this.possible_cached=void 0!==this.walker_a?this.walker_a._possible():void 0,void 0!==this.walker_b){this.possible_cached=new he(this.possible_cached);var e=this.walker_b._possible();this.possible_cached.union(e)}else void 0===this.possible_cached&&(this.possible_cached=new he);return this.possible_cached},x.prototype.fireEvent=function(e){this._instantiateWalkers(),this.possible_cached=void 0;var t=this.walker_a&&this.walker_a.fireEvent(e),n=this.walker_b&&this.walker_b.fireEvent(e);return void 0!==t?(this.chosen=!0,void 0===n?(this.walker_b=void 0,t):t):void 0!==n?(this.chosen=!0,this.walker_a=void 0,n):void 0},x.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressed_attributes||(this.possible_cached=void 0,this.suppressed_attributes=!0,this.walker_a&&this.walker_a._suppressAttributes(),this.walker_b&&this.walker_b._suppressAttributes())},x.prototype.canEnd=function(e){this._instantiateWalkers();var t=!1,n=!1;return e&&(t=!this.el.pat_a._hasAttrs(),n=!this.el.pat_b._hasAttrs()),t=t||!!this.walker_a&&this.walker_a.canEnd(e),n=n||!!this.walker_b&&this.walker_b.canEnd(e),t||n},x.prototype.end=function(e){if(this._instantiateWalkers(),this.canEnd(e))return!1;var t=!!this.walker_a&&this.walker_a.end(e),n=!!this.walker_b&&this.walker_b.end(e);if(!t&&!n)return!1;if(t&&!n)return t;if(!t&&n)return n;var i=[],r=[],o=!1;return this.walker_a.possible().forEach(function(e){"enterStartTag"===e.params[0]?i.push(e.params[1]):o=!0}),o||(this.walker_b.possible().forEach(function(e){"enterStartTag"===e.params[0]?r.push(e.params[1]):o=!0}),o)?t||n:[new ee(i,r)]},ne(T,d),i(T,k),ne(k,p),k.prototype._copyInto=function(e,t){p.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.hit_a=this.hit_a,e.ended_a=this.ended_a,e.hit_b=this.hit_b,e.walker_a=void 0!==this.walker_a?this.walker_a._clone(t):void 0,e.walker_b=void 0!==this.walker_b?this.walker_b._clone(t):void 0},k.prototype._instantiateWalkers=function(){void 0===this.walker_a&&(this.walker_a=this.el.pat_a.newWalker(this.name_resolver),this.walker_b=this.el.pat_b.newWalker(this.name_resolver))},k.prototype._possible=function(){if(this._instantiateWalkers(),void 0!==this.possible_cached)return this.possible_cached;if(this.possible_cached=this.ended_a?void 0:this.walker_a._possible(),this.suppressed_attributes)(this.ended_a||this.walker_a.canEnd())&&(this.possible_cached=new he(this.possible_cached),this.possible_cached.union(this.walker_b._possible()));else{var e=this.walker_b._possible();this.ended_a&&!this.hit_b||this.walker_a.canEnd()||(e=e.filter(function(e){return e.isAttributeEvent()})),this.possible_cached=new he(this.possible_cached),this.possible_cached.union(e)}return this.possible_cached},k.prototype.fireEvent=function(e){if(this._instantiateWalkers(),this.possible_cached=void 0,!this.ended_a){var t=this.walker_a.fireEvent(e);if(void 0!==t)return this.hit_a=!0,t;if(!e.isAttributeEvent()&&!this.walker_a.canEnd())return}var n=this.walker_b.fireEvent(e);if(void 0!==n&&(this.hit_b=!0),!e.isAttributeEvent()&&void 0!==n&&!this.ended_a){var i=this.walker_a.end();this.ended_a=!0,n?i&&(n=n.concat(i)):n=i}return n},k.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressed_attributes||(this.possible_cached=void 0,this.suppressed_attributes=!0,this.walker_a._suppressAttributes(),this.walker_b._suppressAttributes())},k.prototype.canEnd=function(e){if(this._instantiateWalkers(),e){var t=this.el.pat_a._hasAttrs(),n=this.el.pat_b._hasAttrs();return t&&n?this.walker_a.canEnd(e)&&this.walker_b.canEnd(e):t?this.walker_a.canEnd(!0):n?this.walker_b.canEnd(!0):!0}return this.walker_a.canEnd(e)&&this.walker_b.canEnd(e)},k.prototype.end=function(e){if(this.canEnd())return!1;var t;return!this.ended_a&&(t=this.walker_a.end(e))?t:(t=this.walker_b.end(e),t?t:!1)},ne(S,d),i(S,R),ne(R,p),R.prototype._copyInto=function(e,t){p.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.in_a=this.in_a,e.in_b=this.in_b,e.walker_a=this.walker_a&&this.walker_a._clone(t),e.walker_b=this.walker_b&&this.walker_b._clone(t)},R.prototype._instantiateWalkers=function(){this.walker_a||(this.walker_a=this.el.pat_a.newWalker(this.name_resolver)),this.walker_b||(this.walker_b=this.el.pat_b.newWalker(this.name_resolver))},R.prototype._possible=function(){if(this._instantiateWalkers(),void 0!==this.possible_cached)return this.possible_cached;if(this.in_a&&this.in_b)throw new Error("impossible state");return this.in_a&&!this.walker_a.canEnd()?this.possible_cached=this.walker_a._possible():this.in_b&&!this.walker_b.canEnd()&&(this.possible_cached=this.walker_b._possible()),this.possible_cached||(this.possible_cached=this.walker_a.possible(),this.possible_cached.union(this.walker_b._possible())),this.possible_cached},R.prototype.fireEvent=function(e){if(this._instantiateWalkers(),this.possible_cached=void 0,this.in_a&&this.in_b)throw new Error("impossible state");var t,n;if(!this.in_a&&!this.in_b)return t=this.walker_a.fireEvent(e),t===!1?(this.in_a=!0,!1):(n=this.walker_b.fireEvent(e),n===!1?(this.in_b=!0,!1):void 0===n?t:void 0===t?n:t.concat(n));if(this.in_a){if(t=this.walker_a.fireEvent(e),t||t===!1)return t;if(n=this.walker_b.fireEvent(e),n===!1)return this.in_a=!1,this.in_b=!0,!1}else{if(n=this.walker_b.fireEvent(e),n||n===!1)return n;if(t=this.walker_a.fireEvent(e),t===!1)return this.in_a=!0,this.in_b=!1,!1}},R.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressed_attributes||(this.possible_cached=void 0,this.suppressed_attributes=!0,this.walker_a._suppressAttributes(),this.walker_b._suppressAttributes())},R.prototype.canEnd=function(e){return this._instantiateWalkers(),this.walker_a.canEnd(e)&&this.walker_b.canEnd(e)},R.prototype.end=function(e){this._instantiateWalkers();var t=this.walker_a.end(e),n=this.walker_b.end(e);return t&&!n?t:n&&!t?n:t||n?t.concat(n):!1},ne(O,l),i(O,I),O.prototype._copyInto=function(e,t){s.prototype._copyInto.call(this,e,t),e.name=this.name,e.pat=this.pat},O.prototype._prepare=function(e){var t=Object.create(null);this.name._recordNamespaces(t),delete t[""];for(var n,i=Object.keys(t),r=0;n=i[r];++r)e[n]=1},O.prototype._hasAttrs=function(){return!0},ne(I,p),I.prototype._copyInto=function(e,t){p.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.seen_name=this.seen_name,e.seen_value=this.seen_value,e.subwalker=this.subwalker&&this.subwalker._clone(t),e.attr_name_event=this.attr_name_event},I.prototype._possible=function(){if(this.suppressed_attributes)return new he;if(this.seen_name){if(this.seen_value)return new he;void 0===this.subwalker&&(this.subwalker=this.el.pat.newWalker(this.name_resolver));var e=this.subwalker._possible(),t=new he;return e.forEach(function(e){if("text"!==e.params[0])throw new Error("unexpected event type: "+e.params[0]);t.add(new c("attributeValue",e.params[1]))}),t}return new he(this.attr_name_event)},I.prototype.possible=I.prototype._possible,I.prototype.fireEvent=function(e){if(!this.suppressed_attributes)if(this.seen_name){if(!this.seen_value&&"attributeValue"===e.params[0]){this.seen_value=!0,this.subwalker||(this.subwalker=this.el.pat.newWalker(this.name_resolver));var t=new c("text",e.params[1]),n=this.subwalker.fireEvent(t);return void 0===n?[new J("invalid attribute value",this.el.name)]:n instanceof u?[new J("invalid attribute value",this.el.name)]:(n===!1&&(n=this.subwalker.end()),n)}}else if("attributeName"===e.params[0]&&this.el.name.match(e.params[1],e.params[2]))return this.seen_name=!0,!1},I.prototype._suppressAttributes=function(){this.suppressed_attributes=!0},I.prototype.canEnd=function(e){return this.seen_value},I.prototype.end=function(e){return this.seen_name?this.seen_value?!1:[new J("attribute value missing",this.el.name)]:[new Q("attribute missing",this.el.name)]},ne(L,l),L.prototype._copyInto=function(e,t){l.prototype._copyInto.call(this,e,t),e.name=this.name},L.prototype._prepare=function(e){this.name._recordNamespaces(e),this.pat._prepare(e)},L.prototype.newWalker=function(e){return this.pat instanceof fe?this.pat.newWalker(e):new M(this,e)},L.prototype._hasAttrs=function(){return!1},L.prototype._elementDefinitions=function(e){var t=this.name.toString();void 0===e[t]?e[t]=[this]:e[t].push(this)},ne(M,p),M._leaveStartTag_event=new c("leaveStartTag"),M.prototype._copyInto=function(e,t){p.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.seen_name=this.seen_name,e.ended_start_tag=this.ended_start_tag,e.closed=this.closed,e.walker=void 0!==this.walker?this.walker._clone(t):void 0,e.start_tag_event=this.start_tag_event,e.end_tag_event=this.end_tag_event,
e.bound_name=this.bound_name},M.prototype._possible=function(){if(this.seen_name){if(this.ended_start_tag){if(this.closed)return new he;var e=new he(this.walker._possible());return this.walker.canEnd()&&e.add(this.end_tag_event),e}var t=this.walker._possible(),n=new he,i=new he;return t.forEach(function(e){"attributeValue"===e.params[0]?i.add(e):e.isAttributeEvent()&&n.add(e)}),i.size()?n=i:this.walker.canEnd(!0)&&n.add(M._leaveStartTag_event),n}return new he(this.start_tag_event)},M.prototype.possible=M.prototype._possible,M.prototype.fireEvent=function(e){var t,n,i,r;if(!this.ended_start_tag){if(this.seen_name){if("leaveStartTag"===e.params[0]){for(this.ended_start_tag=!0,n=this.walker.end(!0),t=[],r=0;i=n[r];++r)(i instanceof J||i instanceof Q)&&t.push(i);return 0===t.length&&(t=!1),this.walker._suppressAttributes(),t||!1}}else if("enterStartTag"===e.params[0]&&this.el.name.match(e.params[1],e.params[2]))return this.walker=this.el.pat.newWalker(this.name_resolver),this.seen_name=!0,this.bound_name=new Ae.Name("",e.params[1],e.params[2]),this.end_tag_event=new c("endTag",this.bound_name),!1;return void 0!==this.walker?this.walker.fireEvent(e):void 0}if(!this.closed){if(t=this.walker.fireEvent(e),void 0===t)if("endTag"===e.params[0]){if(this.bound_name.match(e.params[1],e.params[2])){for(this.closed=!0,n=this.walker.end(),t=[],r=0;i=n[r];++r)i instanceof J||i instanceof Q||t.push(i);return 0!==t.length&&t}}else if("leaveStartTag"===e.params[0])return[new Y("unexpected leaveStartTag event; it is likely that fireEvent is incorrectly called")];return t}},M.prototype._suppressAttributes=function(){},M.prototype.canEnd=function(e){return e?!0:this.closed},M.prototype.end=function(e){if(e)return!1;var t=[];if(this.seen_name){if(!this.ended_start_tag||!this.closed){if(void 0!==this.walker){var n=this.walker.end();n&&(t=n)}t.push(this.ended_start_tag?new Z("tag not closed",this.el.name):new Z("start tag not terminated",this.el.name))}}else t.push(new Z("tag required",this.el.name));return t.length>0?t:!1},ne(P,l),i(P,H),P.prototype._copyInto=function(e,t){l.prototype._copyInto.call(this,e,t),e.name=this.name},ne(H,p),ie(H,_),H.prototype._copyInto=function(e,t){p.prototype._copyInto.call(this,e,t),e.el=this.el,e.name_resolver=this._cloneIfNeeded(this.name_resolver,t),e.subwalker=this.subwalker._clone(t)},ne($,Error),$.prototype.toString=function(){return"Cannot resolve the following references: "+this.references.toString()},j.prototype.definitions=void 0,j.prototype.start=void 0,j.prototype._resolve=function(){var e,t=[];for(var n in this.definitions)e=this.definitions[n]._resolve(this.definitions),e&&(t=t.concat(e));if(e=this.start._resolve(this.definitions),e&&(t=t.concat(e)),t.length)throw new $(t)},j.prototype.add=function(e){this.definitions[e.name]=e,"start"===e.name&&(this.start=e)},j.prototype._prepare=function(e){this.start._prepare(e);for(var t in this.definitions)this.definitions[t]._prepare(e)},j.prototype._elementDefinitions=function(e){for(var t in this.definitions)this.definitions[t]._elementDefinitions(e)},Object.defineProperty(j.prototype,"element_definitions",{get:function(){var e=this._element_definitions;return e?e:(e=this._element_definitions=Object.create(null),this._elementDefinitions(e),e)}}),j.prototype.whollyContextIndependent=function(){var e=this.element_definitions;for(var t in e)if(e[t].length>1)return!1;return!0},j.prototype.getNamespaces=function(){return Object.keys(this._namespaces)},i(j,U),ne(U,p),ie(U,_),U.prototype.subwalker=void 0,U.prototype._copyInto=function(e,t){p.prototype._copyInto.call(this,e,t),e.el=this.el,e.subwalker=this.subwalker._clone(t),e._misplaced_elements=[];for(var n,i=0;void 0!==(n=this._misplaced_elements[i]);++i)e._misplaced_elements.push(n instanceof p?n._clone(t):n.concat([]));e._swallow_attribute_value=this.swallow_attribute_value,e._name_resolver=this._cloneIfNeeded(this._name_resolver,t),e.suspended_ws=this.suspended_ws,e.ignore_next_ws=this.ignore_next_ws,e._prev_ev_was_text=this._prev_ev_was_text},U.prototype.resolveName=function(e,t){return this._name_resolver.resolveName(e,t)},U.prototype.unresolveName=function(e,t){return this._name_resolver.unresolveName(e,t)},U.prototype.fireEvent=function(e){function t(e){if(void 0===r&&(r=[new Y("text not allowed here")]),r===!1)return e;if(e===!1)return r;if(void 0===e)throw new Error("undefined x");return r.concat(e)}if("enterContext"===e.params[0]||"leaveContext"===e.params[0]||"definePrefix"===e.params[0]){switch(e.params[0]){case"enterContext":this._name_resolver.enterContext();break;case"leaveContext":this._name_resolver.leaveContext();break;case"definePrefix":this._name_resolver.definePrefix(e.params[1],e.params[2])}return!1}if("text"===e.params[0]&&""===e.params[1].trim())return this.suspended_ws?this.suspended_ws+=e.params[1]:this.suspended_ws=e.params[1],!1;var n=this._misplaced_elements.length>0&&this._misplaced_elements[0]instanceof p?this._misplaced_elements[0]:this.subwalker,i=this.ignore_next_ws;this.ignore_next_ws=!1;var r=!1;switch(e.params[0]){case"enterStartTag":this.suspended_ws=void 0;break;case"text":if(this._prev_ev_was_text)throw new Error("fired two text events in a row: this is disallowed by salve");if(this.ignore_next_ws){this.suspended_ws=void 0;var o=e.params[1].replace(/^\s+/,"");o.length!==e.params[1].length&&(e=new c("text",o))}else this.suspended_ws&&(r=n.fireEvent(new c("text",this.suspended_ws)),this.suspended_ws=void 0);break;case"endTag":this.ignore_next_ws=!0;default:this.suspended_ws&&!i&&(r=n.fireEvent(new c("text",this.suspended_ws))),this.suspended_ws=void 0}if(this._prev_ev_was_text="text"===e.params[0],this._misplaced_elements.length>0&&this._misplaced_elements[0]instanceof Array){var a=this._misplaced_elements[0];switch(e.params[0]){case"enterStartTag":a.unshift(e.params.slice(1));break;case"endTag":a.shift()}return a.length||this._misplaced_elements.shift(),!1}if(this.swallow_attribute_value)return this.swallow_attribute_value=!1,"attributeValue"===e.params[0]?!1:[new Y("attribute value required")];var s=n.fireEvent(e);if(s instanceof u){if("text"!==e.params[0])throw new Error("got PartialMatch when firing a non-text event");var l=new c("text",e.params[1].slice(s.length));return this.fireEvent(l)}if(void 0===s)switch(e.params[0]){case"enterStartTag":var d=new Ae.Name("",e.params[1],e.params[2]);s=[new Z("tag not allowed here",d)];var h=this.el.element_definitions[d.toString()];if(h&&1===h.length){var _=h[0].newWalker(this._name_resolver);if(this._misplaced_elements.unshift(_),_.fireEvent(e)!==!1)throw new Error("internal error: the infered element does not accept its initial event")}else this._misplaced_elements.unshift([e.params.slice(1)]);break;case"endTag":s=[new Z("unexpected end tag",new Ae.Name("",e.params[1],e.params[2]))];break;case"attributeName":s=[new Q("attribute not allowed here",new Ae.Name("",e.params[1],e.params[2]))],this.swallow_attribute_value=!0;break;case"attributeValue":s=[new Y("unexpected attributeValue event; it is likely that fireEvent is incorrectly called")];break;case"text":s=[new Y("text not allowed here")];break;case"leaveStartTag":default:throw new Error("unexpected event type in GrammarWalker's fireEvent: "+e.params[0])}if(this._misplaced_elements.length>0&&this._misplaced_elements[0]instanceof p&&(n=this._misplaced_elements[0],n.canEnd())){this._misplaced_elements.shift();var f=n.end();f&&(s=s?s.concat(f):f)}return t(s)},U.prototype.possible=function(e){if(this._misplaced_elements.length){var t=this._misplaced_elements[0];return t instanceof p?t.possible():new he}return this.subwalker.possible()},U.prototype._suppressAttributes=function(){throw new Error("_suppressAttributes cannot be called on a GrammarWalker")},t.Event=c,t.eventsToTreeString=h,t.EName=o,t.ReferenceError=$,t.ValidationError=Y,t.AttributeNameError=Q,t.AttributeValueError=J,t.ElementNameError=Z,t.ChoiceError=ee,t.Grammar=j,t.Walker=p;var me={};me.GrammarWalker=U,me.Text=Ee,t.__test=function(){return me};var Ae=e("./name_patterns");t.__protected={Empty:pe,Data:g,List:m,Param:_e,Value:v,NotAllowed:fe,Text:Ee,Ref:w,OneOrMore:B,Choice:N,Group:T,Attribute:O,Element:L,Define:P,Grammar:j,EName:o,Interleave:S,Name:Ae.Name,NameChoice:Ae.NameChoice,NsName:Ae.NsName,AnyName:Ae.AnyName}}),define("salve/formats",["require","exports","module","./util","./oop","./patterns"],function(e,t,n){"use strict";function i(){Error.call(this,"your schema file must be recreated with a newer version of salve-convert")}function r(e){this.options=e}function o(){r.apply(this,arguments)}function a(e){var t=JSON.parse(e);if("object"==typeof t&&!t.v)throw new i;var n=t.v,r=t.o;if(3===n)return new o(r).walkObject(t.d,r);throw new Error("unknown version: "+n)}var s=(e("./util"),e("./oop").inherit),l=e("./patterns"),d=l.__protected,c=[Array,d.Empty,d.Data,d.List,d.Param,d.Value,d.NotAllowed,d.Text,d.Ref,d.OneOrMore,d.Choice,d.Group,d.Attribute,d.Element,d.Define,d.Grammar,d.EName,d.Interleave,d.Name,d.NameChoice,d.NsName,d.AnyName],h={0:Array,Empty:d.Empty,1:d.Empty,Data:d.Data,2:d.Data,List:d.List,3:d.List,Param:d.Param,4:d.Param,Value:d.Value,5:d.Value,NotAllowed:d.NotAllowed,6:d.NotAllowed,Text:d.Text,7:d.Text,Ref:d.Ref,8:d.Ref,OneOrMore:d.OneOrMore,9:d.OneOrMore,Choice:d.Choice,10:d.Choice,Group:d.Group,11:d.Group,Attribute:d.Attribute,12:d.Attribute,Element:d.Element,13:d.Element,Define:d.Define,14:d.Define,Grammar:d.Grammar,15:d.Grammar,EName:d.EName,16:d.EName,Interleave:d.Interleave,17:d.Interleave,Name:d.Name,18:d.Name,NameChoice:d.NameChoice,19:d.NameChoice,NsName:d.NsName,20:d.NsName,AnyName:d.AnyName,21:d.AnyName},u=1;s(i,Error),r.prototype.walkObject=function(e){var t=e[0],n=c[t];if(void 0===n){if(e.length<1)throw new Error("array too small to contain object");throw new Error("undefined type: "+t)}if(n===Array)throw new Error("trying to build array with _constructObjectV2");var i,r=this.options&u&&n!==d.EName;return e.length>1?(i=e.slice(1),r?i.unshift(0,""):i.unshift(0),this._transformArray(i)):i=r?[""]:[],this._processObject(n,i)},r.prototype._processObject=function(e,t){},r.prototype._transformArray=function(e){if(0!==e[0])throw new Error("array type not 0, but "+e[0]+" for array "+e);e.splice(0,1);for(var t=e.length,n=0;t>n;n++){var i=e[n];i instanceof Array&&(0!==i[0]?e[n]=this.walkObject(i):this._transformArray(i))}},s(o,r),o.prototype._processObject=function(e,t){if(e===d.Data&&t.length>=4){var n=t[3];if(n.length%2!==0)throw new Error("parameter array length not a multiple of 2");for(var i=new Array(n.length/2),r=0,o=n.length;o>r;r+=2)i[r/2]={name:n[r],value:n[r+1]};t[3]=i}var a=Object.create(e.prototype),s=e.apply(a,t);return void 0!==s?s:a},t.constructTree=a,t.__protected={V2JSONWalker:r,name_to_constructor:h,OPTION_NO_PATHS:u}}),define("salve/validate",["require","exports","module","./patterns","./formats"],function(e,t,n){"use strict";var i=e("./patterns"),r=e("./formats");t.version="2.0.0";for(var o in i)t[o]=i[o];t.constructTree=r.constructTree}),define("wed/validator",["require","exports","module","./lib/simple_event_emitter","salve/validate","salve/name_patterns","jquery","./oop","./dloc","./domutil"],function(e,t,n){"use strict";function i(e,t,n){s.call(this),this.schema=e,this.root=t,this.mode=n,this._cycle_entered=0,this._timeout=200,this._max_timespan=100,this._timeout_id=void 0,this._initialized=!1,this._restarting=!1,this._errors=[],this._tree=void 0,this._bound_wrapper=this._workWrapper.bind(this),this._events=[],this._validation_walker=void 0,this._working_state=void 0,this._part_done=0,this._validation_stage=E,this._previous_child=null,this._validation_stack=[new a(0,1)],this._cur_el=this.root,this._walker_cache=Object.create(null),this._walker_cache_max=-1,this._walker_cache_gap=100,this._cur_el.wed_event_index_after_start=this._events.length,this._setWorkingState(A,0)}function r(){Error.call(this,"undefined event_index; _validateUpTo should have taken care of that"),Error.captureStackTrace(this,this.constructor)}function o(e,t,n,i){for(var r,o=e.possible().toArray(),a=!1,s=0;r=o[s];++s)if(r.params[0]===t){var l=r.params[1],d=l.match(n,i);if(a=a||d,d&&!l.wildcardMatch(n,i))return!1}return a}function a(e,t){this.part_done=e,this.portion=t}var s=e("./lib/simple_event_emitter").SimpleEventEmitter,l=e("salve/validate"),d=(e("salve/name_patterns"),e("jquery")),c=e("./oop"),h=e("./dloc"),u=e("./domutil"),p=u.indexOf,_=u.isAttr,f=1,E=2,m=3,A=1,v=2,F=3,g=4;t.INCOMPLETE=A,t.WORKING=v,t.INVALID=F,t.VALID=g,c.implement(i,s),i.prototype.start=function(){void 0!==this._timeout_id&&this.stop(),this._initialized?(this._setWorkingState(v,this._part_done),this._timeout_id=window.setTimeout(this._bound_wrapper,this._timeout)):this.initialize(function(){this._setWorkingState(v,this._part_done),this._timeout_id=window.setTimeout(this._bound_wrapper,this._timeout)}.bind(this))},i.prototype.initialize=function(t){this.schema instanceof l.Grammar?(this._tree=this.schema,this._validation_walker=this._tree.newWalker(),this._initialized=!0,t()):d.get(e.toUrl(this.schema),function(e){this._tree=l.constructTree(e),this._validation_walker=this._tree.newWalker(),this._initialized=!0,t()}.bind(this),"text").fail(function(e,t,n){throw new Error(t+" "+n)})},i.prototype.getSchemaNamespaces=function(){if(!this._initialized)throw new Error("calling getSchemaNamespaces on uninitialized validator");return this._tree.getNamespaces()},i.prototype.getDocumentNamespaces=function(){function e(n){for(var i=n.attributes.length,r=0;i>r;++r){var o=n.attributes[r];if(0===o.name.lastIndexOf("xmlns",0)){var a=o.name.slice(6),s=t[a];s||(s=t[a]=[]),s.push(o.value)}}for(n=n.firstChild;n;)n.nodeType===Node.ELEMENT_NODE&&e(n),n=n.nextSibling}var t={};return e(this.root.firstChild),t},i.prototype._workWrapper=function(){this._work()&&(this._timeout_id=window.setTimeout(this._bound_wrapper,this._timeout))},i.prototype._work=function(){if(!this._initialized)return!0;for(var e=new Date;;){if(this._max_timespan>0&&new Date-e>=this._max_timespan)return!0;var t=this._cycle();if(!t)return!1}return!0};var C=new l.Event("enterContext"),D=new l.Event("leaveStartTag"),y=new l.Event("leaveContext");i.prototype._cycle=function(){if(this._restarting=!1,this.cycle_entered>0)throw new Error("internal error: _cycle is being reentered");if(this.cycle_entered<0)throw new Error("internal error: _cycle_entered negative");this.cycle_entered++;var e,t,n,i,r=this._validation_walker,o=this._validation_stack,s=o[0].portion,d=this._events,c=this._validation_stage;e:for(;;){var h=this._cur_el;switch(c){case f:o.unshift(new a(this._part_done,s)),this._fireAndProcessEvent(r,C,h,0);var u=h.attributes.length;for(n=0;u>n;++n)i=h.attributes[n],"xmlns"===i.name?this._fireAndProcessEvent(r,new l.Event("definePrefix","",i.value),h,0):0===i.name.lastIndexOf("xmlns:",0)&&this._fireAndProcessEvent(r,new l.Event("definePrefix",i.name.slice(6),i.value),h,0);return t=r.resolveName(h.tagName),this._setPossibleDueToWildcard(h,r,"enterStartTag",t.ns,t.name),this._fireAndProcessEvent(r,new l.Event("enterStartTag",t.ns,t.name),h.parentNode,h.parentNode&&h),h.wed_event_index_before_attributes=d.length,this._fireAttributeEvents(r,h),h.wed_event_index_after_attributes=d.length,this._fireAndProcessEvent(r,D,h,0),c=this._validation_stage=E,h.wed_event_index_after_start=d.length,this.cycle_entered--,!0;case E:for(var _=null===this._previous_child?h.firstChild:this._previous_child.nextSibling;null!==_;){switch(_.nodeType){case Node.TEXT_NODE:var A=new l.Event("text",_.data);e=r.fireEvent(A),e&&this._processEventResult(e,_.parentNode,p(_.parentNode.childNodes,_));break;case Node.ELEMENT_NODE:s/=h.childElementCount,this._cur_el=h=_,c=this._validation_stage=f,this._previous_child=null;continue e;default:throw new Error("unexpected node type: "+_.nodeType)}_=_.nextSibling}null===_&&(c=this._validation_stage=m);break;case m:if(h===this.root)return e=r.end(),e&&this._processEventResult(e,h,h.childNodes.length),this._runDocumentValidation(),this._setWorkingState(this._errors.length>0?F:g,1),h.wed_event_index_after=d.length,this.stop(),this.cycle_entered--,!1;var w=h;t=r.resolveName(h.tagName),this._fireAndProcessEvent(r,new l.Event("endTag",t.ns,t.name),h,h.childNodes.length),this._fireAndProcessEvent(r,y,h,h.childNodes.length),this._previous_child=h,this._cur_el=h=h.parentNode;var B=this._part_done;if(h!==this.root){o.shift();var b=o[0];B=b.part_done+=s,s=b.portion}return this._setWorkingState(v,B),w.wed_event_index_after=this._events.length,c=this._validation_stage=E,this.cycle_entered--,!0;default:throw new Error("unexpected state")}}this.cycle_entered--},i.prototype._runDocumentValidation=function(){if(this.mode)for(var e,t=this.mode.validateDocument(),n=0;e=t[n];++n)this._processError(e)},i.prototype.stop=function(){void 0!==this._timeout_id&&window.clearTimeout(this._timeout_id),this._timeout_id=void 0,this._working_state===v&&this._setWorkingState(A,this._part_done)},i.prototype.restartAt=function(e){this._working_state===v&&this.stop(),this._initialized&&!this._restarting&&(this._restarting=!0,this._resetTo(e)),this.start()},i.prototype._resetTo=function(e){function t(e){e.wed_event_index_after=void 0,e.wed_event_index_after_start=void 0,e.wed_event_index_before_attributes=void 0,e.wed_event_index_after_attributes=void 0,e.wed_possible_due_to_wildcard=void 0;for(var n=e.firstElementChild;n;)t(n),n=n.nextElementSibling}t(this.root),this._validation_stage=E,this._previous_child=null,this._validation_walker=this._tree.newWalker(),this._events=[],this._cur_el=this.root,this._part_done=0,this._errors=[],this._walker_cache=Object.create(null),this._walker_cache_max=-1,this._emit("reset-errors",{at:0})},i.prototype._setWorkingState=function(e,t){var n=!1;this._working_state!==e&&(this._working_state=e,n=!0),this._part_done!==t&&(this._part_done=t,n=!0),n&&this._emit("state-update",{state:e,part_done:t})},i.prototype.getWorkingState=function(){return{state:this._working_state,part_done:this._part_done}},i.prototype._processEventResult=function(e,t,n){for(var i,r=0;void 0!==(i=e[r]);++r){var o={error:i,node:t,index:n};this._processError(o)}},i.prototype._processError=function(e){this._errors.push(e),this._emit("error",e)},i.prototype._fireAttributeEvents=function(e,t){for(var n,i=0;n=t.attributes[i];++i)"xmlns"!==n.name&&0!==n.name.lastIndexOf("xmlns",0)&&(this._fireAttributeNameEvent(e,t,n),this._fireAndProcessEvent(e,new l.Event("attributeValue",n.value),n,0))},i.prototype._fireAttributeNameEvent=function(e,t,n){var i=n.name,r=e.resolveName(i,!0);this._setPossibleDueToWildcard(n,e,"attributeName",r.ns,r.name),this._fireAndProcessEvent(e,new l.Event("attributeName",r.ns,r.name),n,0)},i.prototype._fireAndProcessEvent=function(e,t,n,i){this._events.push(t);var r=e.fireEvent(t);r&&(n&&i&&"number"!=typeof i&&(i=n?p(n.childNodes,i):void 0),this._processEventResult(r,n,i))},i.prototype._validateUpTo=function(e,t,n){if(n=!!n,n&&(!e.childNodes||e.childNodes[t].nodeType!==Node.ELEMENT_NODE))throw new Error("trying to validate after attributes but before the end of the start tag on a node which is not an element node");var i=e,r="wed_event_index_after";if(e===this.root&&0>=t){if(n)r="wed_event_index_after_attributes",i=e.childNodes[t];else if(0===t)return}else{var o;if(_(e))i=e.ownerElement,r="wed_event_index_before_attributes";else switch(e.nodeType){case Node.TEXT_NODE:i=e.previousElementSibling,i||(i=e.parentNode,r="wed_event_index_after_start");break;case Node.ELEMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:case Node.DOCUMENT_NODE:var a=e.childNodes[t];o=a?a.previousElementSibling:e.lastElementChild,o?i=o:n?(r="wed_event_index_after_attributes",i=a):r="wed_event_index_after_start";break;default:throw new Error("unexpected node type: "+e.nodeType)}}for(;void 0===i[r];)this._cycle()},c.inherit(r,Error),i.prototype._getWalkerAt=function(e,t,n){function i(e){if(void 0===e)throw new r;var t=c._walker_cache,n=c._walker_cache_max,i=t[e];if(i)return i;var o=e;if(o>=n)o=n,i=t[o];else for(;!i&&--o>=0;)i=t[o];i?i=i.clone():(i=c._tree.newWalker(),o=0);for(var a=o;e>a;++a)i.fireEvent(c._events[a]);return e-o>=c._walker_cache_gap&&(t[e]=i,c._walker_cache_max=Math.max(e,n)),i}function o(e){var t=new l.Event("text",e.data);a.fireEvent(t)}if(n=!!n,n&&(!e.childNodes||e.childNodes[t].nodeType!==Node.ELEMENT_NODE))throw new Error("trying to get a walker for attribute events on a node which is not an element node");if(this._validateUpTo(e,t,n),e===this.root&&0>=t&&!n)return 0===t?this._tree.newWalker():this._validation_walker;var a,s,d,c=this;if(_(e)){var h=e.ownerElement;a=i(h.wed_event_index_before_attributes),"xmlns"!==e.name&&"xmlns"!==e.prefix&&(a=a.clone(),this._fireAttributeNameEvent(a,h,e))}else switch(e.nodeType){case Node.TEXT_NODE:s=e.previousElementSibling,a=i(s?s.wed_event_index_after:e.parentNode.wed_event_index_after_start),t>0&&(a=a.clone(),o(e));break;case Node.ELEMENT_NODE:case Node.DOCUMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:var u=e.childNodes[t];if(n?d=u.wed_event_index_after_attributes:(s=u?u.previousElementSibling:e.lastElementChild,d=s?s.wed_event_index_after:e.wed_event_index_after_start),a=i(d),!n){var p=u&&u.previousSibling;p&&p!==s&&p.nodeType===Node.TEXT_NODE&&(a=a.clone(),o(p))}break;default:throw new Error("unexpected node type: "+e.nodeType)}return a},i.prototype.possibleAt=function(e,t,n){e instanceof h.DLoc&&(n=t,t=e.offset,e=e.node);var i=this._getWalkerAt(e,t,n);return i.possible()},i.prototype.possibleWhere=function(e,t){for(var n=[],i=0;i<=e.childNodes.length;++i){var r=this.possibleAt(e,i);if(r.has(t))n.push(i);else if("enterStartTag"===t.params[0]||"attributeName"===t.params[0])for(var o,a=r.toArray(),s=0;o=a[s];++s)if(o.params[0]===t.params[0]&&o.params[1].match(t.params[1],t.params[2])){n.push(i);break}}return n},i.prototype.speculativelyValidate=function(e,t,n){if(!this._initialized)throw new Error("uninitialized Validator");e instanceof h.DLoc&&(n=t,t=e.offset,e=e.node);var i;if(n instanceof Array){i=e.ownerDocument.createDocumentFragment();for(var r=0,o=n.length;o>r;++r)i.insertBefore(n[r].cloneNode(!0),null)}else i=n.cloneNode(!0);var a=e.ownerDocument.createElement("div");return a.insertBefore(i,null),this.speculativelyValidateFragment(e,t,a)},i.prototype.speculativelyValidateFragment=function(e,t,n){if(e instanceof h.DLoc&&(n=t,t=e.offset,e=e.node),!this._initialized)throw new Error("uninitialized Validator");if(n.nodeType!==Node.ELEMENT_NODE)throw new Error("to_parse is not an element");var r=new i(this._tree,n);return r._validation_walker=this._getWalkerAt(e,t).clone(),r._tree=this._tree,r._initialized=!0,r._validateUpTo(n,n.childNodes.length),r._errors.length?r._errors:!1},i.prototype.getErrorsFor=function(e){this._validateUpTo(e.parentNode,p(e.parentNode.childNodes,e)+1);for(var t=[],n=0,i=this._errors.length;i>n;++n){var r=this._errors[n];r.node===e&&t.push(r)}return t},i.prototype._setPossibleDueToWildcard=function(e,t,n,i,r){var a=e.wed_possible_due_to_wildcard,s=o(t,n,i,r);e.wed_possible_due_to_wildcard=s,(void 0===a||a!==s)&&this._emit("possible-due-to-wildcard-change",e)},t.Validator=i}),define("wed/gui/modal",["require","exports","module","jquery","../util","../log","interact","../browsers","bootstrap"],function(e,t,n){"use strict";function i(e){var e=e||{};this._$dom=o('<div class="modal" style="position: absolute" tabindex="1">  <div class="modal-dialog">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal"          aria-hidden="true">&times;</button>        <h3 class="modal-title">Untitled</h3>      </div>      <div class="modal-body">        <p>No body.</p>      </div>      <div class="modal-footer">      </div>    </div>  </div></div>'),this._$header=this._$dom.find(".modal-header"),this._$body=this._$dom.find(".modal-body"),this._$footer=this._$dom.find(".modal-footer"),this._$dom.on("click",".btn",a.wrap(function(e){return this._$clicked=o(e.currentTarget),!0}.bind(this))),this._$dom.on("shown.bs.modal.modal",a.wrap(this._handleShown.bind(this))),this._$clicked=void 0;var t=this._$dom.find(".modal-content")[0],n=this._$body[0],i=n.ownerDocument.defaultView;e.resizable&&(n.style.overflow="auto",s(t).resizable({restrict:{restriction:{left:0,top:0,right:i.innerWidth-10,bottom:i.innerHeight-10}}}).on("resizemove",function(e){var t=e.target,i=new r;i.updateElementRect(t,e.dx,e.dy),i.updateElementRect(n,e.dx,e.dy)})),e.draggable&&s(this._$header[0]).draggable({restrict:{restriction:{left:0,top:0,right:i.innerWidth-10,bottom:i.innerHeight-10}}}).on("dragmove",function(e){var n=t;n.getBoundingClientRect();n.style.left=e.clientX-e.clientX0+"px",n.style.top=e.clientY-e.clientY0+"px"})}function r(){this.changes=[],this.rolledback=!1}var o=e("jquery"),a=(e("../util"),e("../log")),s=e("interact"),l=e("../browsers");e("bootstrap"),r.prototype.updateElementRect=function(e,t,n){if(!this.rolledback){var i=e.getBoundingClientRect();l.MSIE&&(e.style.width=i.width+"px",e.style.height=i.height+"px",i=e.getBoundingClientRect());var r=i.width+t,o=i.height+n;e.style.width=r+"px",e.style.height=o+"px",this.changes.push({el:e,rect:i});var a=e.getBoundingClientRect();(a.width!=r||a.height!=o)&&this.rollback()}},r.prototype.rollback=function(){for(var e,t=0;e=this.changes[t];++t){var n=e.el,i=e.rect;n.style.width=i.width+"px",n.style.height=i.height+"px"}this.rolledback=!0},i.prototype.getTopLevel=function(){return this._$dom},i.prototype.setTitle=function(e){var t=this._$header.find("h3");t.empty(),t.append(e)},i.prototype.setBody=function(e){this._$body.empty(),this._$body.append(e)},i.prototype.setFooter=function(e){this._$footer.empty(),this._$footer.append(e)},i.prototype.addButton=function(e,t){var n=o('<a href="#" class="btn" data-dismiss="modal">'+e+"</a>");return n.addClass(t?"btn-primary":"btn-default"),this._$footer.append(n),n},i.prototype.addOkCancel=function(){return[this.addButton("Ok",!0),this.addButton("Cancel")]},i.prototype.addYesNo=function(){return[this.addButton("Yes",!0),this.addButton("No")]},i.prototype.getPrimary=function(){return this._$footer.find(".btn-primary")},i.prototype.modal=function(e){this._$clicked=void 0,e&&this._$dom.one("hidden.bs.modal.modal",a.wrap(e)),this._$dom.modal()},i.prototype.getClicked=function(){return this._$clicked},i.prototype.getClickedAsText=function(){return void 0!==this._$clicked?this._$clicked.text():void 0},i.prototype._handleShown=function(e){var t=this._$dom.parent().height();this._$body.css("max-height",t-this._$header.height()-this._$footer.height())},t.Modal=i}),define("wed/gui/icon",["require","exports","module"],function(e,t,n){"use strict";function i(e){var t=r[e];if(!t)throw new Error("unknown icon name: "+e);return'<i class="fa fa-fw '+t+'"></i>'}var r=Object.create(null);r.add="fa-plus",r["delete"]="fa-times",r.wrap="fa-caret-square-o-down",r.unwrap="fa-caret-square-o-up",r.documentation="fa-question-circle",r.transform="fa-cog",r.any="fa-asterisk",r.element="fa-angle-left",r.attribute="fa-at",r.other="fa-circle-thin",r.exclamation="fa-exclamation",t.makeHTML=i}),define("wed/action",["require","exports","module","./lib/simple_event_emitter","./oop"],function(e,t,n){"use strict";function i(e,t,n,i,o){r.call(this),this._editor=e,this._desc=t,this._abbreviated_desc=n,this._icon=i||"",this.needs_input=!!o,this._enabled=!0,this.bound_handler=this.eventHandler.bind(this),this.bound_terminal_handler=this.terminalEventHandler.bind(this)}var r=e("./lib/simple_event_emitter").SimpleEventEmitter,o=e("./oop");o.implement(i,r),i.prototype.execute=function(e){throw new Error("the execute method must be overridden.")},i.prototype.eventHandler=function(e){this.execute(e.data),e.preventDefault()},i.prototype.terminalEventHandler=function(e){return this.eventHandler(e),e.preventDefault(),e.stopPropagation(),!1},i.prototype.getDescription=function(){return this._desc},i.prototype.getDescriptionFor=function(e){return this.getDescription()},i.prototype.getAbbreviatedDescription=function(){return this._abbreviated_desc},i.prototype.getIcon=function(){return this._icon},i.prototype.getLabelFor=function(e){var t=this.getDescriptionFor(e),n=this.getIcon();return n&&t?n+" "+t:n?n:t},i.prototype.toString=function(){return this.getDescription()},i.prototype.getEnabled=function(){return this._enabled},t.Action=i}),define("wed/transformation",["require","exports","module","./util","./domutil","./action","./oop","./gui/icon","lodash"],function(e,t,n){"use strict";function i(e,t,n,i,r,o,a){switch(arguments.length){case 4:a=i,i=void 0;break;case 5:a=r,r=void 0;break;case 6:a=o,o=void 0}this.handler=a,this.type=t,this.kind=g[t],this.node_type=C[t],void 0===r&&this.kind&&(r=v.makeHTML(this.kind)),m.call(this,e,n,i,r,o)}function r(e,t,n,i,r,a){var s=o(t.ownerDocument,i,r,a);return e.insertAt(t,n,s),s}function o(e,t,n,i){var r=e.createElementNS(t,n);if(void 0!==i)for(var o,a=Object.keys(i).sort(),s=0;void 0!==(o=a[s++]);)r.setAttribute(o,i[o]);return r}function a(e,t,n,i,r,a,s){var l=t.data.slice(n,i),d=t.parentNode,c=E(d.childNodes,t);e.deleteText(t,n,l.length);var h=o(t.ownerDocument,r,a,s);return""!==l&&h.appendChild(t.ownerDocument.createTextNode(l)),t.parentNode?e.insertAt(t,n,h):e.insertAt(d,c,h),h}function s(e,t,n){var i=t.parentNode,r=E(i.childNodes,t);if(0===n)n=r;else if(n>=t.length)n=r+1;else{var o=t.data.slice(n);e.setTextNode(t,t.data.slice(0,n)),e.insertNodeAt(i,r+1,t.ownerDocument.createTextNode(o)),n=r+1}return t=i,[t,n]}function l(e,t,n,i,r,l,d,c){if(!f.isWellFormedRange({startContainer:t,startOffset:n,endContainer:i,endOffset:r}))throw new Error("malformed range");var h;if(t.nodeType===Node.TEXT_NODE){if(t===i)return a(e,t,n,r,l,d,c);h=s(e,t,n),t=h[0],n=h[1]}if(i.nodeType===Node.TEXT_NODE&&(h=s(e,i,r),i=h[0],r=h[1]),t!==i)throw new Error("start_container and end_container are not the same;probably due to an algorithmic mistake");for(var u=o(t.ownerDocument,l,d,c);--r>=n;){var p=i.childNodes[r];e.deleteNode(p),u.insertBefore(p,u.firstChild)}return e.insertAt(t,n,u),u}function d(e,t){var n=t.parentNode,i=Array.prototype.slice.call(t.childNodes),r=t.previousSibling,o=t.nextSibling;e.deleteNode(t);for(var a=o?E(n.childNodes,o):n.childNodes.length,s=t.lastChild;t.firstChild;)e.insertNodeAt(n,a++,t.firstChild);return e.mergeTextNodes(s),e.mergeTextNodesNF(r),i}function c(e,t){var n=e.getDataCaret();if(!t.contains(n.node))throw new Error("caret outside node");var i=e.data_updater.splitAt(t,n);e.setDataCaret(f.firstDescendantOrSelf(i[1]),0)}function h(e,t){var n=t.previousElementSibling;if(n&&n.localName===t.localName&&n.namespace===t.namespace){for(var i=n.childNodes.length,r=n.lastChild,o=r&&r.nodeType===Node.TEXT_NODE,a=o?r.length:0,s=n.childNodes.length,l=t.childNodes.length-1;l>=0;--l)e.data_updater.insertAt(n,s,t.childNodes[l].cloneNode(!0));o&&e.data_updater.mergeTextNodes(r),o?e.setDataCaret(n.childNodes[i-1],a):e.setDataCaret(n,i),e.data_updater.removeNode(t)}}function u(e,t){var n=t.nextElementSibling;n&&h(e,n)}function p(e,t){var n=t.previousElementSibling;if(n&&n.tagName===t.tagName){var i=n.parentNode;e.data_updater.removeNode(t),e.data_updater.insertBefore(i,t,n),e.setDataCaret(i,E(i.childNodes,t))}}function _(e,t){var n=t.nextElementSibling;n&&p(e,n)}var f=(e("./util"),e("./domutil")),E=f.indexOf,m=e("./action").Action,A=e("./oop"),v=e("./gui/icon"),F=e("lodash"),g=F.extend(Object.create(null),{add:"add","delete":"delete",transform:"transform",insert:"add","delete-element":"delete","delete-parent":"delete",wrap:"wrap","merge-with-next":"transform","merge-with-previous":"transform","swap-with-next":"transform","swap-with-previous":"transform",split:"transform",append:"add",prepend:"add",unwrap:"unwrap","add-attribute":"add","delete-attribute":"delete"}),C=F.extend(Object.create(null),{add:"other","delete":"other",transform:"other",insert:"element","delete-element":"element","delete-parent":"element",wrap:"element","merge-with-next":"element","merge-with-previous":"element","swap-with-next":"element","swap-with-previous":"element",
split:"element",append:"element",prepend:"element",unwrap:"element","add-attribute":"attribute","delete-attribute":"attribute"});A.inherit(i,m),i.prototype.getDescriptionFor=function(e){return this._desc.replace(/<name>/,e.name)},i.prototype.execute=function(e){e=e||{},this._editor.fireTransformation(this,e)},t.Transformation=i,t.wrapTextInElement=a,t.wrapInElement=l,t.insertElement=r,t.makeElement=o,t.unwrap=d,t.splitNode=c,t.mergeWithPreviousHomogeneousSibling=h,t.mergeWithNextHomogeneousSibling=u,t.swapWithPreviousHomogeneousSibling=p,t.swapWithNextHomogeneousSibling=_}),define("wed/lib/pubsub",["require","exports","module","pubsub-js"],function(e,t,n){"use strict";function i(e,n){if(this._name=e,this._subs=[],this._parent=n,this._str=n?n.toString()+"."+e:e,this._str in d)throw new Error("registering twice: "+this._str);var i=this._str.toUpperCase().replace(/\./g,"_");if(d[this._str]=this,l[i]=this,i in t)throw new Error("name clash between topic name and other things we export in this module");t[i]=this}function r(e){if(e in d)return d[e];var t,n,o=e.lastIndexOf(".");if(-1!==o?(t=e.slice(0,o),n=e.slice(o+1)):n=e,t){var a=d[t];return a||(a=r(t)),a.addSub(n)}return new i(n)}function o(e,t){if(!(e instanceof i))throw new Error("topic is not a Topic object: "+e);return s.publish.call(this,String(e),t)}function a(e,t){if(!(e instanceof i))throw new Error("topic is not a Topic object: "+e);return s.subscribe.call(this,String(e),t)}var s=e("pubsub-js"),l=Object.create(null),d=Object.create(null);i.prototype.addSub=function(e){var t=new i(e,this);return this._subs.push(t),this[e]=t,t},i.prototype.toString=function(){return this._str},t.makeTopic=r,r("wed.mode.ready"),t.publish=o,t.subscribe=a,t.unsubscribe=s.unsubscribe}),define("wed/onbeforeunload",["require","exports","module","./util","optional!./config"],function(e,t,n){"use strict";function i(){return!0}function r(e,t,n,r){function o(){return n()?t:void 0}if(t=t||d,n=n||i,r=!!r,e.onbeforeunload&&e.onbeforeunload.installed_by_onbeforeunload&&!r)throw new Error("reregistering window with `force` false",e);o.installed_by_onbeforeunload=!0,e.onbeforeunload=o}var o=e("./util"),a=e("optional!./config"),s=o.grabConfig(n,a).config,l=s&&s.test,d="Do you really want to navigate away from this page?";l||r(window),t.install=r}),define("wed/wed_init",["require","exports","module","./wed_core","./wed_util","./build-info","jquery","merge-options","./log","./preferences","./domutil","./guiroot","./dloc","./savers/ajax","./savers/localforage","./tree_updater","./gui_updater","./undo_recorder","./updater_domlistener","./validator","./object_check","./gui/modal","./gui/icon","./undo","./transformation","./lib/pubsub","./onbeforeunload","./action","./oop"],function(e,t,n){"use strict";function i(){I.apply(this,arguments)}function r(e){e.data.editor.destroy()}var o=e("./wed_core"),a=o.Editor,s=o.version,l=e("./wed_util"),d=l.paste,c=l.cut,h=e("./build-info"),u=e("jquery"),p=e("merge-options"),_=e("./log"),f=e("./preferences"),E=e("./domutil"),m=e("./guiroot"),A=e("./dloc"),v=A.makeDLoc,F=e("./savers/ajax").Saver,g=e("./savers/localforage").Saver,C=e("./tree_updater").TreeUpdater,D=e("./gui_updater").GUIUpdater,y=e("./undo_recorder").UndoRecorder,w=e("./updater_domlistener"),B=e("./validator"),b=B.Validator,N=e("./object_check"),x=e("./gui/modal"),T=e("./gui/icon"),k=e("./undo"),S=e("./transformation"),R=e("./lib/pubsub"),O=e("./onbeforeunload"),I=e("./action").Action,L=e("./oop"),M=(E.closestByClass,E.closest),P=E.indexOf;L.inherit(i,I),i.prototype.execute=function(e){var t=this._editor;t._complex_pattern_modal.modal()},a.prototype.init=_.wrap(function(t,n,a){this.max_label_level=void 0,this._current_label_level=void 0,this._stripped_spaces=/\u200B/g,this._replaced_spaces=/\s+/g,this._normalize_entered_spaces=!0,this.preferences=new f.Preferences({tooltips:!0}),this.widget=t,this.$widget=u(this.widget),this.$frame=u(M(this.widget,"html"));var s=this.$frame[0].ownerDocument;this.my_window=s.defaultView,this.doc=s;var l=new this.my_window.DOMParser;a?this._data_doc=l.parseFromString(a,"text/xml"):(this._data_doc=l.parseFromString("<div></div>","text/xml"),this._data_doc.removeChild(this._data_doc.firstChild)),n=n.ignore_module_config?p({},n):p({},o.module_config,n),this.name=n.name,n.ajaxlog&&_.addURL(n.ajaxlog.url,n.ajaxlog.headers),this._save=n.save,this._first_validation_complete=!1,this._destroying=!1,this._destroyed=!1,this.options=n;var E=u('<div class="row"> <div class="wed-frame col-sm-push-2 col-lg-10 col-md-10 col-sm-10">  <div class="row">   <div class="progress">    <span></span>    <div id="validation-progress" class="progress-bar" style="width: 0%"/>   </div>  </div>  <div class="row">   <div class="wed-cut-buffer" contenteditable="true"></div>   <div class="wed-document-constrainer">    <input class="wed-comp-field" type="text"></input>    <div class="wed-caret-layer">    </div>    <div class="wed-scroller">     <div class="wed-error-layer"></div>     <div class="wed-document"><span class="root-here"/></div>    </div>   </div>   <div class="wed-location-bar"><span>&nbsp;</span></div>  </div> </div> <div id="sidebar" class="col-sm-pull-10 col-lg-2 col-md-2 col-sm-2"/></div>',s),v=E[0];this.gui_root=v.getElementsByClassName("wed-document")[0],this.$gui_root=u(this.gui_root),this._scroller=v.getElementsByClassName("wed-scroller")[0],this._$scroller=u(this._scroller),this._$input_field=u(v.getElementsByClassName("wed-comp-field")[0]),this._cut_buffer=v.getElementsByClassName("wed-cut-buffer")[0],this._caret_layer=v.getElementsByClassName("wed-caret-layer")[0],this._$caret_layer=u(this._caret_layer),this._error_layer=v.getElementsByClassName("wed-error-layer")[0],this._$error_layer=u(this._error_layer),this._layer_names=["_caret_layer","_error_layer"],this._layer_state_stack=[],this._wed_location_bar=v.getElementsByClassName("wed-location-bar")[0];var F=v.getElementsByClassName("root-here")[0];if(t.firstChild){if(!(t.firstChild instanceof this.my_window.Element))throw new Error("the data is populated with DOM elements constructed from another window");F.parentNode.insertBefore(t.firstChild,F)}F.parentNode.removeChild(F),this.widget.appendChild(v);var g=s.getElementById("sidebar");this._sidebar=g,this.validation_progress=s.getElementById("validation-progress"),this.validation_message=this.validation_progress.previousElementSibling,this._caret_owners=this.gui_root.getElementsByClassName("_owns_caret"),this._clicked_labels=this.gui_root.getElementsByClassName("_label_clicked");var B=this._data_doc.createDocumentFragment();B.appendChild(this._data_doc.createElement("div")),this.data_root=B.firstChild,this.$data_root=u(this.data_root),this.gui_dloc_root=new m.GUIRoot(this.gui_root),this.data_dloc_root=new A.DLocRoot(this.data_root),this.data_updater=new C(this.data_root),this._gui_updater=new D(this.gui_root,this.data_updater),this._undo_recorder=new y(this,this.data_updater);var b=document.getElementsByClassName("wed-has-tooltip");this._gui_updater.addEventListener("beforeDeleteNode",function(e){var t=e.node;if(t.nodeType!==Node.TEXT_NODE)for(var n=0,i=b.length;i>n;++n){var r=b[n];if(t.contains(r)){var o=u.data(r,"bs.tooltip");o&&o.destroy()}}}),g.innerHTML='<div class="wed-save-and-modification-status">  <span class="wed-modification-status label label-success"         title="Modification status">   <i class="fa fa-asterisk"></i>  </span>  <span class="wed-save-status label label-default">   <i class="fa fa-cloud-upload"></i> <span></span>  </span></div><div id="sidebar-panel" class="panel-group wed-sidebar-panel"> <div class="panel panel-info wed-navigation-panel">  <div class="panel-heading">   <div class="panel-title">    <a class="accordion-toggle" data-toggle="collapse"        data-parent="#sidebar-panel"        href="#sb-nav-collapse">Navigation</a>   </div>  </div> <div id="sb-nav-collapse" data-parent="#sidebar-panel"       class="panel-collapse collapse in">   <div id="sb-nav" class="panel-body">    <ul id="navlist" class="nav nav-list">     <li class="inactive">A list of navigation links will appear here</li>    </ul>   </div>  </div> </div> <div class="panel panel-danger">  <div class="panel-heading">   <div class="panel-title">    <a class="accordion-toggle" data-toggle="collapse"       data-parent="#sidebar-panel"       href="#sb-errors-collapse">Errors</a>   </div>  </div>  <div id="sb-errors-collapse" data-parent="#sidebar-panel"       class="panel-collapse collapse">   <div id="sb-errors" class="panel-body">    <ul id="sb-errorlist" class="nav nav-list wed-errorlist">     <li class="inactive"></li>    </ul>   </div>  </div> </div></div>',this._$modification_status=u(g.getElementsByClassName("wed-modification-status")[0]),this._$save_status=u(g.getElementsByClassName("wed-save-status")[0]),this._$navigation_panel=u(g.getElementsByClassName("wed-navigation-panel")[0]),this._$navigation_panel.css("display","none"),this._current_dropdown=void 0;var N=s.createElement("span");N.className="_wed_caret",N.setAttribute("contenteditable",!1),N.textContent=" ",this._fake_caret=N,this._$fake_caret=u(N),this._inhibited_fake_caret=0,this._pending_fake_caret_refresh=!1;var O=s.createElement("span");O.innerHTML="&nbsp;",O.style.height="100%",O.style.width="1px",O.style.maxWidth="1px",this._fc_mark=O,this._$fc_mark=u(O),this._limitation_modal=new x.Modal,this._limitation_modal.setTitle("Cannot proceed"),this._complex_pattern_modal=this.makeModal(),this._complex_pattern_modal.setTitle("Complex Name Pattern Encountered"),this._complex_pattern_modal.setBody("<p>The schema contains here a complex name pattern modal.          While wed has no problem validating such cases. It does not          currently have facilities to add elements or attributes that          match such patterns. You can continue editing your document but          you will not be able to take advantage of the possibilities          provided by the complex pattern here.</p>"),this._complex_pattern_modal.addButton("Ok",!0),this._paste_modal=this.makeModal(),this._paste_modal.setTitle("Invalid structure"),this._paste_modal.setBody("<p>The data you are trying to paste appears to be XML.         However, pasting it here will result in a structurally invalid         document. Do you want to paste it as text instead? (If you answer         negatively, the data won't be pasted at all.)<p>"),this._paste_modal.addYesNo(),this.straddling_modal=this.makeModal(),this.straddling_modal.setTitle("Invalid modification"),this.straddling_modal.setBody("<p>The text selected straddles disparate elements of the document.         You may be able to achieve what you want to do by selecting         smaller sections.<p>"),this.straddling_modal.addButton("Ok",!0);var I=this.doc_link=e.toUrl("../../doc/index.html");this.help_modal=this.makeModal(),this.help_modal.setTitle("Help"),this.help_modal.setBody("<p>Click <a href='"+I+"' target='_blank'>this link</a> to see wed's generic help. The link by default will open in a new tab.</p><p>The key combinations with Ctrl below are done with Command in OS X.</p><ul>  <li>Clicking the right mouse button on the document contents brings up a contextual menu.</li>  <li>F1: help</li>  <li>Ctrl-[: Decrease the label visibility level.</li>  <li>Ctrl-]: Increase the label visibility level.</li>  <li>Ctrl-S: Save</li>  <li>Ctrl-X: Cut</li>  <li>Ctrl-V: Paste</li>  <li>Ctrl-C: Copy</li>  <li>Ctrl-Z: Undo</li>  <li>Ctrl-Y: Redo</li>  <li>Ctrl-/: Bring up a contextual menu.</li></ul><p class='wed-build-info'>Build descriptor: "+h.desc+"<br/>Build date: "+h.date+"</p>"),this.help_modal.addButton("Close",!0),this._disconnect_modal=this.makeModal(),this._disconnect_modal.setTitle("Disconnected from server!"),this._disconnect_modal.setBody("It appears your browser is disconnected from the server.         Editing is frozen until the connection is reestablished.         Dismissing this dialog will retry saving. If the operation is         successful, you'll be able to continue editing. If not, this         message will reappear."),this._disconnect_modal.addButton("Retry",!0),this._edited_by_other_modal=this.makeModal(),this._edited_by_other_modal.setTitle("Edited by another!"),this._edited_by_other_modal.setBody("Your document was edited by someone else since you last loaded or         saved it. You must reload it before trying to edit further."),this._edited_by_other_modal.addButton("Reload",!0),this._too_old_modal=this.makeModal(),this._too_old_modal.setTitle("Newer version!"),this._too_old_modal.setBody("There is a newer version of the editor.         You must reload it before trying to edit further."),this._too_old_modal.addButton("Reload",!0),this._$navigation_list=u(s.getElementById("navlist")),this._old_sel_focus=void 0,this._sel_anchor=void 0,this._sel_focus=void 0,this._selection_stack=[],this.domlistener=new w.Listener(this.gui_root,this._gui_updater),u(this.my_window).on("unload.wed",{editor:this},r),u(this.my_window).on("popstate.wed",function(e){""===document.location.hash&&(this.gui_root.scrollTop=0)}.bind(this)),this._last_done_shown=0,this.$error_list=u(s.getElementById("sb-errorlist")),this._$excluded_from_blur=u(),this._validation_errors=[],this._processed_validation_errors_up_to=-1,this._process_validation_errors_timeout=void 0,this._process_validation_errors_delay=500,this._errorItemHandler_bound=this._errorItemHandler.bind(this),this._undo=new k.UndoList,this.mode_path=n.mode.path,this.complex_pattern_action=new i(this,"Complex name pattern",void 0,T.makeHTML("exclamation"),!0),this.paste_tr=new S.Transformation(this,"add","Paste",d),this.cut_tr=new S.Transformation(this,"delete","Cut",c),this.split_node_tr=new S.Transformation(this,"split","Split <name>",function(e,t){return S.splitNode(e,t.node)}),this.merge_with_previous_homogeneous_sibling_tr=new S.Transformation(this,"merge-with-previous","Merge <name> with previous",function(e,t){return S.mergeWithPreviousHomogeneousSibling(e,t.node)}),this.merge_with_next_homogeneous_sibling_tr=new S.Transformation(this,"merge-with-next","Merge <name> with next",function(e,t){return S.mergeWithNextHomogeneousSibling(e,t.node)}),R.subscribe(R.WED_MODE_READY,function(e,t){t===this._new_mode&&this.onModeChange(t)}.bind(this)),this._global_keydown_handlers=[],this.setMode(this.mode_path,n.mode.options)}),a.prototype.setMode=_.wrap(function(t,n){var i=_.wrap(function(e){this._new_mode=new e.Mode(n)}).bind(this);e([t],i,function(n){if(-1!==t.indexOf("/"))throw new Error("can't load mode "+t);var r="./modes/"+t+"/"+t;e([r],i,function(t){e([r+"_mode"],i)})})}),a.prototype.onModeChange=_.wrap(function(t){if(!this._destroyed){this.mode=t,t.init(this);var n=t.getWedOptions();if(this._processWedOptions(n)){for(var i,r=this.mode.getStylesheets(),o=0;void 0!==(i=r[o]);++o)this.$frame.children("head").append('<link rel="stylesheet" href="'+e.toUrl(i)+'" type="text/css" />');this._resizeHandler(),this.gui_root.setAttribute("tabindex","-1"),this.$gui_root.focus(),this.resolver=t.getAbsoluteResolver();var a=t.getValidator();this.validator=new b(this.options.schema,this.data_root,a),this.validator.addEventListener("state-update",this._onValidatorStateChange.bind(this)),this.validator.addEventListener("error",this._onValidatorError.bind(this)),this.validator.addEventListener("possible-due-to-wildcard-change",this._onPossibleDueToWildcardChange.bind(this)),this.validator.addEventListener("reset-errors",this._onResetErrors.bind(this)),this.validator.initialize(this._postInitialize.bind(this))}}}),a.prototype._processWedOptions=function(e){var t=function(){return this._limitation_modal.setBody("<p>The mode you are trying to use is passing incorrect options to wed. Contact the mode author with the following information: </p><ul><li>"+r.join("</li><li>")+"</li></ul>"),this._limitation_modal.modal(),this.destroy(),!1}.bind(this),n={metadata:{name:!0,authors:!0,description:!0,license:!0,copyright:!0},label_levels:{max:!0,initial:!0},attributes:!1},i=N.check(n,e),r=[];if(i.missing&&i.missing.forEach(function(e){r.push("missing option: "+e)}),i.extra&&i.extra.forEach(function(e){r.push("extra option: "+e)}),r.length)return t();this.max_label_level=e.label_levels.max,this.max_label_level<1&&r.push("label_levels.max must be >= 1"),this._current_label_level=this.max_label_level;var o=e.label_levels.initial;o>this.max_label_level&&r.push("label_levels.initial must be < label_levels.max"),1>o&&r.push("label_levels.initial must be >= 1"),e.attributes||(e.attributes="hide");var a=this.attributes=e.attributes,s=["hide","show","edit"];for(-1===s.indexOf(a)&&r.push("attributes option not a valid value: "+a+"; must be one of "+s.join(", "));this._current_label_level>o;)this.decreaseLabelVisiblityLevel();return r.length?t():!0},a.prototype._postInitialize=_.wrap(function(){if(!this._destroyed){this.domlistener.addHandler("children-changed","._real, ._phantom_wrap, .wed-document",function(e,t,n,i,r,o){for(var a=t.concat(n),s=!1,l=0,d=a.length;!s&&d>l;++l){var c=a[l];s=c.nodeType===Node.TEXT_NODE||c.classList.contains("_real")||c.classList.contains("_phantom_wrap")}s&&(this._last_done_shown=0,this.validator.restartAt(o))}.bind(this)),this.decorator=this.mode.makeDecorator(this.domlistener,this,this._gui_updater),this.domlistener.addHandler("attribute-changed","._real",function(e,t,n,i){if(!n&&0===i.indexOf("data-wed",0)){var r=this;setTimeout(function(){r._destroyed||r.validator.restartAt(t)},0)}}.bind(this)),this.decorator.addHandlers(),this.domlistener.addHandler("included-element","._label",function(e,t,n,i,r,o){for(var a=o.classList,s=!1,l=0;l<a.length&&!s;++l)0===a[l].lastIndexOf("_label_level_",0)&&(s=Number(a[l].slice(13)));if(!s)throw new Error("unable to get level");s>this._current_label_level&&a.add("_invisible")}.bind(this)),this._updating_placeholder=0,this.domlistener.addHandler("children-changed","._real, ._phantom_wrap, .wed-document",function(e,t,n,i,r,o){if(!this._updating_placeholder){this._updating_placeholder++;for(var a,s=[],l=o.firstChild;l;)(l.nodeType===Node.TEXT_NODE||l.classList.contains("_real")||l.classList.contains("_phantom_wrap")||l.classList.contains("_text"))&&s.push(l),l.classList&&l.classList.contains("_placeholder")&&(a=l),l=l.nextSibling;if(0===s.length||1===s.length&&-1!==n.indexOf(s[0])){if(!a){var d=this.mode.nodesAroundEditableContents(o);o===this.gui_root?(a=this.insertTransientPlaceholderAt(v(this.gui_root,this.gui_root,0)),this._setGUICaret(this.gui_root,0,"text_edit")):(a=this.mode.makePlaceholderFor(o),this._gui_updater.insertBefore(o,a,d[1]))}}else if(a&&!a.classList.contains("_transient")){var c,h,u=this._sel_focus&&this._sel_focus.node,p=a.contains(u);p&&(c=a.parentNode,h=P(c.childNodes,a)),this._gui_updater.removeNode(a),p&&this._setGUICaret(c,h,"text_edit")}this._updating_placeholder--}}.bind(this));var e=function(e){if(!this._updating_placeholder){this._updating_placeholder++;var t=this.toDataNode(e),n=E.childByClass(e,"_placeholder");t.value?n&&e.removeChild(n):n||this._gui_updater.insertBefore(e,E.makePlaceholder(),null),this._updating_placeholder--}}.bind(this);if(this.domlistener.addHandler("children-changed","._attribute_value",function(t,n,i,r,o,a){e(a)}),this.domlistener.addHandler("included-element","._attribute_value",function(t,n,i,r,o,a){e(a)}),this.decorator.startListening(this.$gui_root),this._data_doc.firstChild&&this.data_updater.insertAt(this.data_root,0,this._data_doc.firstChild),this._save){switch(this._save.path){case"wed/savers/ajax":this._saver=new F(s,this.data_updater,this.data_root,this._save.options);break;case"wed/savers/localforage":this._saver=new g(s,this.data_updater,this.data_root,this._save.options);break;default:throw new Error("unknown saver: "+this._save.path)}this._saver.addEventListener("saved",this._onSaverSaved.bind(this)),this._saver.addEventListener("autosaved",this._onSaverAutosaved.bind(this)),this._saver.addEventListener("failed",this._onSaverFailed.bind(this)),this._saver.addEventListener("changed",this._onSaverChanged.bind(this)),this._saver.addEventListener("too_old",this._onSaverTooOld.bind(this)),void 0!==this._save.autosave&&this._saver.setAutosaveInterval(1e3*this._save.autosave),this._refreshSaveStatus(),this._save_status_interval=setInterval(this._refreshSaveStatus.bind(this),3e4),O.install(this.my_window,"The document has unsaved modifications. Do you really want to leave without saving?",function(){return this._destroyed?!1:!!this._saver.getModifiedWhen()}.bind(this),!0)}else _.error("wed cannot save data due to the absence of a save_url option");this.$gui_root.on("dragenter","*",!1),this.$gui_root.on("dragstart","*",!1),this.$gui_root.on("dragover","*",!1),this.$gui_root.on("drop","*",!1),this.$gui_root.on("wed-global-keydown",this._globalKeydownHandler.bind(this)),this.$gui_root.on("wed-global-keypress",this._globalKeypressHandler.bind(this)),this.$gui_root.on("keydown",this._keydownHandler.bind(this)),this.$gui_root.on("keypress",this._keypressHandler.bind(this)),this._$scroller.on("scroll",this._refreshFakeCaret.bind(this)),this._$input_field.on("keydown",this._keydownHandler.bind(this)),this._$input_field.on("keypress",this._keypressHandler.bind(this)),this._$input_field.on("compositionstart compositionupdate compositionend",this._compositionHandler.bind(this)),this._$input_field.on("input",this._inputHandler.bind(this)),this.$gui_root.on("mousedown",this._mousedownHandler.bind(this)),this.$gui_root.on("mouseover",this._mouseoverHandler.bind(this)),this.$gui_root.on("mouseout",this._mouseoutHandler.bind(this)),this.$gui_root.on("contextmenu",this._mouseupHandler.bind(this)),this.$gui_root.on("paste",_.wrap(this._pasteHandler.bind(this))),this._$input_field.on("paste",_.wrap(this._pasteHandler.bind(this))),this.$gui_root.on("cut",_.wrap(this._cutHandler.bind(this))),u(this.my_window).on("resize.wed",this._resizeHandler.bind(this)),this.$gui_root.on("focus",_.wrap(function(e){this._focusInputField(),e.preventDefault(),e.stopPropagation()}.bind(this))),this.$gui_root.on("click","a",function(e){return e.ctrlKey&&(window.location=e.currentTarget.href),!1}.bind(this));var t=u(this.doc.body);t.on("mouseup.wed",function(e){this.$gui_root.off("mousemove.wed mouseup"),this._$caret_layer.off("mousemove mouseup")}.bind(this)),t.on("contextmenu.wed",function(e){return this.gui_root.contains(e.target)?!1:!0}.bind(this)),t.on("click.wed",function(e){if(!(void 0===e.pageX||e.pageX<0||void 0===e.pageY||e.pageY<0||e.screenX===e.screenY&&0===e.screenX||this.widget.contains(e.target))){var t=this.doc.elementFromPoint(e.clientX,e.clientY);if(!u(t).closest(this._$excluded_from_blur).length){var n=this.$gui_root.offset(),i=e.pageX-n.left,r=e.pageY-n.top;i>=0&&r>=0&&i<this.$gui_root.outerWidth()&&r<this.$gui_root.outerHeight()||this._blur()}}}.bind(this)),u(this.my_window).on("blur.wed",this._blur.bind(this)),u(this.my_window).on("focus.wed",this._focus.bind(this)),this._$caret_layer.on("mousedown click contextmenu",this._caretLayerMouseHandler.bind(this)),this._$error_layer.on("mousedown click contextmenu",function(e){return this._$caret_layer.trigger(e),!1}.bind(this)),this.$widget.removeClass("loading"),this.$widget.css("display","block");var n=this._initializeNamespaces();if(n)return this._limitation_modal.setBody(n),this._limitation_modal.modal(),void this.destroy();this.domlistener.processImmediately(),this._undo=new k.UndoList,this.$gui_root.focus(),this.validator.start();var i=this.options.demo;if(i){"string"!=typeof i&&(i="Some functions may not be available.");var r=this.makeModal();r.setTitle("Demo"),r.setBody("<p>This is a demo of wed. "+i+"</p><p>Click <a href='"+this.doc_link+"' target='_blank'>this link</a> to see wed's generic help. The link by default will open in a new tab.</p>"),r.addButton("Ok",!0),r.modal()}if(this._saver){var o=this;this._saver.whenCondition("initialized",function(){o._destroyed||o._setCondition("initialized",{editor:o})})}else this._setCondition("initialized",{editor:this})}}),a.prototype._initializeNamespaces=function(){var e=!1;if(this.data_root.firstChild){var t=this.validator.getDocumentNamespaces(),n=this.resolver;Object.keys(t).forEach(function(i){var r=t[i];r.length>1&&(e="The document you are trying to edit uses namespaces in a way not supported by this version of wed."),n.definePrefix(i,r[0])})}else{var i=Object.create(null);if(this.validator.getSchemaNamespaces().forEach(function(t){if("*"!==t&&"::except"!==t){var n=this.resolver.prefixFromURI(t);"xml"!==n&&(""===n?i.xmlns=t:(void 0===n&&(e="The mode does not allow determining the namespace prefix for "+t+".The most likely issue is that the mode is buggy or wed was started with incorrect options."),i["xmlns:"+n]=t))}}.bind(this)),e)return e;var r=this.validator.possibleAt(this.data_root,0).toArray();if(1===r.length&&"enterStartTag"===r[0].params[0]){var o=r[0].params[1];o.simple()&&1===o.toArray().length&&(S.insertElement(this.data_updater,this.data_root,0,o.ns,this.resolver.unresolveName(o.ns,o.name),i),this.setDataCaret(this.data_root.firstElementChild,0))}if(!this.data_root.firstChild){var a=this.insertTransientPlaceholderAt(v(this.gui_root,this.gui_root,0));this.setGUICaret(a,0),this._focus()}}return e}}),define("wed/wed_caret",["require","exports","module","./wed_core","./wed_util","jquery","./browsers","lodash","./log","rangy","./util","./domutil","./dloc","bootstrap","jquery.bootstrap-growl"],function(e,t,n){"use strict";var i=e("./wed_core"),r=i.Editor,o=e("./wed_util"),a=o.getAttrValueNode,s=e("jquery"),l=e("./browsers"),d=e("lodash"),c=e("./log"),h=e("rangy"),u=e("./util"),p=e("./domutil"),_=e("./dloc"),f=_.makeDLoc,E=_.DLoc;e("bootstrap"),e("jquery.bootstrap-growl");var m=p.closestByClass,A=p.closest,v=p.indexOf;u.getOriginalName;r.prototype.dumpCaretInfo=function(){var e=this.getDataCaret();e?console.log("data caret",e.node,e.offset):console.log("no data caret"),this._sel_anchor?console.log("selection anchor",this._sel_anchor.node,this._sel_anchor.offset):console.log("no selection anchor"),this._sel_focus?console.log("selection focus",this._sel_focus.node,this._sel_focus.offset):console.log("no selection focus"),this._sel_focus&&console.log("selection focus closest real",m(this._sel_focus.node,"_real",this.gui_root)),p.dumpRange("DOM range: ",this._getDOMSelectionRange()),console.log("input field location",this._$input_field.css("top"),this._$input_field.css("left")),console.log("document.activeElement",document.activeElement);var t=this._sel_focus.node;if(t.nodeType===Node.TEXT_NODE){var n=this._sel_focus.offset;if(n<t.data.length){var i=this.doc.createRange();i.setStart(t,n),i.setEnd(t,n+1);var r=i.getBoundingClientRect();console.log("rectangle around character at caret:",r)}}},r.prototype.caretPositionRight=function(){return this.positionRight(this._sel_focus)},r.prototype.positionRight=function(e){function t(t){return t.compareDocumentPosition(e.node)&Node.DOCUMENT_POSITION_PRECEDING}if(void 0!==e&&null!==e){var n=e.root,i=m(e.node,"_placeholder",n);for(i&&(e=e.make(i.parentNode,v(i.parentNode.childNodes,i)+1));;){var r=m(e.node,"_gui",n),o=this.gui_root.firstChild;if(o.classList.contains("_placeholder")&&(o=this.gui_root),e=e.make(p.nextCaretPosition(e.toArray(),o,!1)),!e)break;var s=e.node,l=e.offset,c=A(s,"._gui:not(._invisible)",n);if(c){var h=c.classList.contains("__start_label");if("edit"===this.attributes&&h){if(m(s,"_attribute_value",n))break;if(A(s,"._element_name, ._attribute",n)){var u=d.find(c.getElementsByClassName("_attribute"),t);if(u){var _=p.childByClass(u,"_attribute_value");_=a(_),e=e.make(_,0);break}}}if(r===c){e=e.make(c,c.childNodes.length);continue}e=e.make(h||m(s,"_label",c)?s.getElementsByClassName("_element_name")[0]:c,0);break}var f=m(s,"_phantom",n);if(f)e=e.make(f,f.childNodes.length);else{if(i=m(s,"_placeholder",n),!(i&&l>0)){if(s.nodeType===Node.ELEMENT_NODE){var E=s.childNodes[l];if(E&&E.nodeType===Node.TEXT_NODE)continue;var F=s.childNodes[l-1];if(E&&F&&E.firstChild&&E.firstChild.nodeType===Node.ELEMENT_NODE&&E.firstChild.classList.contains("_gui")&&!E.firstChild.classList.contains("_invisible")&&F.lastChild&&F.lastChild.nodeType===Node.ELEMENT_NODE&&F.lastChild.classList.contains("_gui")&&!F.lastChild.classList.contains("_invisible"))break;if(F&&F.nodeType===Node.ELEMENT_NODE&&(E&&E.nodeType===Node.ELEMENT_NODE&&!E.classList.contains("_end_wrapper")&&!F.classList.contains("_start_wrapper")||F.matches("._wed-validation-error, ._gui.__end_label")))continue;var g=this.mode.nodesAroundEditableContents(s);if(g[0]&&v(s.childNodes,g[0])>=l)continue;if(g[1]&&v(s.childNodes,g[1])<l)continue}break}e=e.make(i,i.childNodes.length)}}return e||void 0}},r.prototype.caretPositionLeft=function(){return this.positionLeft(this._sel_focus)},r.prototype.positionLeft=function(e){if(void 0!==e&&null!==e){var t=e.root,n=m(e.node,"_placeholder",t);for(n&&(e=e.make(n.parentNode,v(n.parentNode.childNodes,n)));;){var i=m(e.node,"_element_name",t),r=i&&e.node===i&&0===e.offset,o=this.gui_root.firstChild;if(o.classList.contains("_placeholder")&&(o=this.gui_root),e=e.make(p.prevCaretPosition(e.toArray(),o,!1)),!e)break;var a=e.node,s=e.offset,l=A(a,"._gui:not(._invisible)",t);if(l){var d=l.classList.contains("__start_label");if("edit"===this.attributes&&d&&!r){if(m(a,"_attribute_value",l))break;var c=m(a,"_attribute",l);!c&&a.nextElementSibling&&a.nextElementSibling.classList.contains("_attribute")&&(c=a.nextElementSibling),c||(i=m(a,"_element_name",l),c=i&&i.nextElementSibling);var h=c&&c.previousElementSibling;if(!h){var u=l.getElementsByClassName("_attribute");h=u[u.length-1]}if(h&&!h.classList.contains("_attribute")&&(h=null),h){var _=p.childByClass(h,"_attribute_value");s=0,_.lastChild&&(_=_.lastChild,s=_.length,_.classList&&_.classList.contains("_placeholder")&&(s=0)),e=e.make(_,s);break}}if(!r){e=e.make(d||m(a,"_label",l)?l.getElementsByClassName("_element_name")[0]:l,0);break}e=e.make(l,0)}else{if(n=m(a,"_placeholder",t)){e=e.make(n.firstChild,0);break}var f=m(a,"_phantom",t);if(!f){if(a.nodeType===Node.ELEMENT_NODE){var E=a.childNodes[s-1];if(E&&E.nodeType===Node.TEXT_NODE)continue;var F=a.childNodes[s];if(F&&E&&F.firstChild&&F.firstChild.nodeType===Node.ELEMENT_NODE&&F.firstChild.classList.contains("_gui")&&!F.firstChild.classList.contains("_invisible")&&E.lastChild&&E.lastChild.nodeType===Node.ELEMENT_NODE&&E.lastChild.classList.contains("_gui")&&!E.lastChild.classList.contains("_invisible"))break;if(F&&F.nodeType===Node.ELEMENT_NODE&&(E&&E.nodeType===Node.ELEMENT_NODE&&!E.classList.contains("_start_wrapper")&&!F.classList.contains("_end_wrapper")||F.matches("._gui.__start_label, .wed-validation-error")))continue;var g=this.mode.nodesAroundEditableContents(a);if(g[0]&&v(a.childNodes,g[0])>=s)continue;if(g[1]&&v(a.childNodes,g[1])<s)continue}break}e=e.make(f,0)}}return e||void 0}},r.prototype.moveCaretRight=function(){var e=this.caretPositionRight();e&&this.setGUICaret(e)},r.prototype.moveCaretLeft=function(){var e=this.caretPositionLeft();e&&this.setGUICaret(e)},r.prototype.setGUICaret=function(e,t){this._setGUICaret(e,t)},r.prototype._setGUICaret=function(e,t,n){var i;if(e instanceof E?(n=t,t=e.offset,i=e.node):(i=e,e=f(this.gui_root,i,t)),i.classList&&i.classList.contains("_attribute_value")){var r=a(i);i!==r&&(i=r,e=e.make(i,t))}this._sel_focus&&this._sel_anchor===this._sel_focus&&this._sel_focus.node===i&&this._sel_focus.offset===t||(this._clearDOMSelection(),this._sel_anchor=e,this._sel_focus=this._sel_anchor,this._refreshFakeCaret(),this._focusInputField(),this._caretChange(n))},r.prototype._focusInputField=function(){this.my_window.focus(),this._$input_field.blur(),this._$input_field.focus()},r.prototype._blur=c.wrap(function(e){this._sel_focus&&(this._sel_anchor_at_blur=this._sel_anchor,this._sel_focus_at_blur=this._sel_focus,this._$input_field.blur(),this._sel_anchor=void 0,this._sel_focus=void 0,this._refreshFakeCaret())}),r.prototype.excludeFromBlur=function(e){this._$excluded_from_blur.add(e)},r.prototype._focus=c.wrap(function(e){if(this._sel_anchor_at_blur){
this._sel_anchor=this._sel_anchor_at_blur,this._sel_focus=this._sel_focus_at_blur;var t=this.gui_root.scrollTop,n=this.gui_root.scrollLeft;this._restoreCaretAndSelection(!0),this.gui_root.scrollTop=t,this.gui_root.scrollLeft=n,this._sel_anchor_at_blur=void 0,this._sel_focus_at_blur=void 0}}),r.prototype._inhibitFakeCaret=function(){this._inhibited_fake_caret++},r.prototype._uninhibitFakeCaret=function(){if(this._inhibited_fake_caret--,this._inhibited_fake_caret<0)throw new Error("too many calls to _uninhibitFakeCaret");this._pending_fake_caret_refresh&&(this._refreshFakeCaret(),this._pending_fake_caret_refresh=!1)},r.prototype._refreshFakeCaret=function(){if(this._inhibited_fake_caret)return void(this._pending_fake_caret_refresh=!0);var e,t,n;if(this._sel_focus&&(e=this._sel_focus.node,t=this._sel_focus.offset,n=this._sel_focus.root),e){var i,r;switch(e.nodeType){case Node.TEXT_NODE:var o=e.parentNode,a=e.previousSibling,s=e.nextSibling;p.insertIntoText(e,t,this._fc_mark);break;case Node.ELEMENT_NODE:e.insertBefore(this._fc_mark,e.childNodes[t]||null);break;default:throw new Error("unexpected node type: "+e.nodeType)}i=this._fc_mark.getBoundingClientRect();var l=this._scroller.getBoundingClientRect();if(i={top:i.top-l.top,left:i.left-l.left},r=this._$fc_mark.height(),e.nodeType===Node.TEXT_NODE){for(var d=a?a.nextSibling:o.firstChild;d!==s;)o.removeChild(d),d=a?a.nextSibling:o.firstChild;o.insertBefore(e,s||null)}else this._fc_mark.parentNode.removeChild(this._fc_mark);if(this._sel_anchor.isValid()&&this._sel_focus.isValid()){var c=this._sel_anchor.makeRange(this._sel_focus);c.range.collapsed||this._setDOMSelectionRange(c.range,c.reversed)}this._fake_caret.style.top=i.top+"px",this._fake_caret.style.left=i.left+"px",this._fake_caret.style.height=r+"px",this._fake_caret.style.maxHeight=r+"px",this._fake_caret.style.minHeight=r+"px",this._fake_caret.parentNode||this._caret_layer.appendChild(this._fake_caret),this._$input_field[0].style["z-index"]>0?(this._$input_field.css("top",i.top),this._$input_field.css("left",i.left)):(this._$input_field.css("top",""),this._$input_field.css("left",""))}},r.prototype._findLocationAt=function(e,t){var n=this.elementAtPointUnderLayers(e,t);if(n&&this.gui_root.contains(n))return this._findLocationInElementAt(n,e,t)},r.prototype._findLocationInElementAt=function(e,t,n,i){function r(e,i){var r;e.nodeType===Node.TEXT_NODE?(a.setStart(e,i),a.setEnd(e,i+1),r=a.getClientRects()):r=e.childNodes[i].getClientRects();for(var s,l=0;void 0!==(s=r[l]);++l)if(0!==s.height&&0!==s.width){var d=u.distsFromRect(t,n,s.left,s.top,s.right,s.bottom);if(!o||o.dist.y>d.y||o.dist.y===d.y&&o.dist.x>d.x)return o={dist:d,node:e,start:i},0===d.y&&0===d.x}return!1}i!==!1&&(i=!0);var o,a=this.doc.createRange(),s=e.firstChild,l=0;e:for(;s;){if(i&&s.nodeType===Node.TEXT_NODE){for(var d=0;d<s.length;++d)if(r(s,d))break e}else if(r(e,l))break e;s=s.nextSibling,l++}return o?f(this.gui_root,o.node,o.start):f(this.gui_root,e,0)},r.prototype._pointToCharBoundary=function(e,t){var n=this._findLocationAt(e,t);if(n){var i=n.node,r=n.offset,a=i.nodeType;if(a===Node.ELEMENT_NODE&&r<i.childNodes.length||a===Node.TEXT_NODE&&r<i.length){var s=this.doc.createRange();s.setStart(i,r),s.setEnd(i,r+1);var l=s.getBoundingClientRect();switch(a){case Node.TEXT_NODE:var d=this.positionRight(n),c=this.positionLeft(n.make(i,r+1));d&&!c?n=d:c&&!d?n=c:d&&c&&(n=Math.abs(o.boundaryXY(d).left-e)>=Math.abs(o.boundaryXY(c).left-e)?c:d);break;case Node.ELEMENT_NODE:var h,u=i.childNodes[r];if(u.nodeType===Node.ELEMENT_NODE){var p=this._findLocationInElementAt(u,e,t),_=p.node.nodeType===Node.ELEMENT_NODE?p.node.childNodes.length-1:-1;switch(p.offset){case 0:h=!0;break;case _:h=!1}}void 0===h&&(h=Math.abs(l.left-e)<Math.abs(l.right-e)),h||(n=n.make(i,r+1));break;default:throw new Error("unexpected node type: "+a)}}}return n},r.prototype.getGUICaret=function(e){if(void 0!==this._sel_focus){if(e)return this._sel_focus;if(this.gui_root.contains(this._sel_focus.node))return this._sel_focus.isValid()||(this._sel_focus=this._sel_focus.normalizeOffset()),this._normalizeCaret(this._sel_focus)}},r.prototype._normalizeCaret=function(e){if(!e)return e;var t=m(e.node,"_placeholder",e.root);if(t){var n=t.parentNode;return e.make(n,v(n.childNodes,t))}return e},r.prototype.fromDataLocation=function(e,t){var n=this._gui_updater.fromDataLocation(e,t),i=n.offset;if(e=n.node,e.nodeType===Node.ELEMENT_NODE){var r=this.mode.nodesAroundEditableContents(e),o=v(e.childNodes,r[0]);if(o>=i)i=o+1;else{var a=r[1]?v(e.childNodes,r[1]):e.childNodes.length;i>=a&&(i=a)}}return n.make(e,i)},r.prototype.toDataLocation=function(e,t,n){var i,r;if(e instanceof E?(n=t,t=e.offset,i=e.node,r=e.root):i=e,!m(i,"_attribute_value",r)){var o,a=i.nodeType===Node.TEXT_NODE?i.parentNode:i,s=m(a,"_phantom_wrap",r);if(s){var l=s.getElementsByClassName("_real")[0];i=l.parentNode,t=v(i.childNodes,l)}else{for(;a;){if(a.classList.contains("_phantom")||a.classList.contains("_gui")){if(!n)return;o=a}if(a===this.gui_root)break;a=a.parentNode}o&&(i=o.parentNode,t=v(i.childNodes,o))}}var d=this._normalizeCaret(f(this.gui_root,i,t));i=d.node,t=d.offset;var c;if(i.nodeType===Node.TEXT_NODE)return c=this.data_updater.pathToNode(this.nodeToPath(i)),f(this.data_root,c,t,!0);if(t>=i.childNodes.length)return c=this.data_updater.pathToNode(this.nodeToPath(i)),f(this.data_root,c,c.childNodes.length);var h=i.childNodes[t];if(h.nodeType!==Node.TEXT_NODE&&!h.classList.contains("_real")){for(var u,p=h.previousSibling;p;)p.nodeType===Node.TEXT_NODE||p.classList.contains("_real")?(u=p,p=null):p=p.previousSibling;return u?(c=this.data_updater.pathToNode(this.nodeToPath(u)),f(this.data_root,c.parentNode,v(c.parentNode.childNodes,c)+1)):f(this.data_root,this.data_updater.pathToNode(this.nodeToPath(i)),0)}return c=this.data_updater.pathToNode(this.nodeToPath(h)),c instanceof this.my_window.Attr?f(this.data_root,c,t):f(this.data_root,c.parentNode,v(c.parentNode.childNodes,c))},r.prototype.getDataCaret=function(e){var t=this.getGUICaret();if(void 0!==t)return this.toDataLocation(t,e)},r.prototype.setDataCaret=function(e,t,n){e instanceof E?n=t:e=f(this.data_root,e,t),n=!!n;var i=this.fromDataLocation(e);this._setGUICaret(i,n?"text_edit":void 0)},r.prototype._caretChange=c.wrap(function(e){var t=!1,n=!1;switch(e){case"text_edit":t=!0;break;case"focus":n=!0;break;case void 0:break;default:throw new Error("unexpected value for op: "+e)}var i,r,o,a=this._sel_focus;if(a&&(i=a.node,r=a.offset,i.nodeType===Node.ELEMENT_NODE&&(o=p.childByClass(i,"_placeholder"),o&&!o.classList.contains("_dying"))))return void this._setGUICaret(o,0,e);if(n||this._setupCompletionMenu(),void 0===this._old_sel_focus||this._old_sel_focus.node!==i||this._old_sel_focus.offset!==r){var l=this._old_sel_focus;this._old_sel_focus=a,t||this._terminateTextUndo();for(var d;void 0!==(d=this._caret_owners[0]);)d.classList.remove("_owns_caret");for(;void 0!==(d=this._clicked_labels[0]);)d.classList.remove("_label_clicked");if(a){if(l){var c=A(l.node,"._placeholder._transient",l.root);c&&a.root.contains(c)&&this._gui_updater.removeNode(c)}var h=a.node.nodeType===Node.ELEMENT_NODE?a.node:a.node.parentNode,_=a.root;if(this.gui_root.contains(h)){var f=m(h,"_real",_);f&&f.classList.add("_owns_caret");var E=m(h,"_gui",_);if(E){if(!this._sel_anchor||m(this._sel_anchor.node,"_gui",_)===E)for(var v,F=p.childrenByClass(E.parentNode,"_gui"),g=0;void 0!==(v=F[g]);++g)v.classList.add("_label_clicked")}else h.classList.add("_owns_caret");var C=this._fake_caret,D=this._positionFromGUIRoot(C),y=s(C);this.scrollIntoView(D.left,D.top,D.left+y.outerWidth(),D.top+y.outerHeight());for(var w=[];h!==this.gui_root;){if(h.nodeType!==Node.ELEMENT_NODE)throw new Error("unexpected node type: "+h.nodeType);h.classList.contains("_placeholder")||m(h,"_phantom",_)||w.unshift("<span class='_gui _label'><span>&nbsp;"+u.getOriginalName(h)+"&nbsp;</span></span>"),h=h.parentNode}this._wed_location_bar.innerHTML=w.length?w.join("/"):"<span>&nbsp;</span>"}}}}),r.prototype.pushSelection=function(){this._selection_stack.push([this._sel_anchor,this._sel_focus]),l.MSIE_TO_10&&this._clearDOMSelection()},r.prototype.popSelection=function(){var e=this._selection_stack.pop();this._sel_anchor=e[0],this._sel_focus=e[1],this._restoreCaretAndSelection(!1)},r.prototype._restoreCaretAndSelection=function(e){if(this._sel_anchor&&this.gui_root.contains(this._sel_anchor.node)){var t=this._sel_anchor.makeRange(this._sel_focus);this._setDOMSelectionRange(t.range,t.reversed),this._refreshFakeCaret(),t.range.collapsed&&this._focusInputField(),this._caretChange(e?"focus":void 0)}else this.clearSelection()},r.prototype.clearSelection=function(){this._sel_anchor=void 0,this._sel_focus=void 0,this._refreshFakeCaret();var e=this._getDOMSelection();e.rangeCount>0&&this.gui_root.contains(e.focusNode)&&e.removeAllRanges(),this._caretChange()},r.prototype._getDOMSelection=function(){return h.getSelection(this.my_window)},r.prototype._clearDOMSelection=function(e){this._getDOMSelection().removeAllRanges(),e||this._focusInputField()},r.prototype._getDOMSelectionRange=function(){var e=p.getSelectionRange(this.my_window);if(e&&this.gui_root.contains(e.startContainer)&&this.gui_root.contains(e.endContainer))return e},r.prototype.getSelectionRange=function(){return this._sel_anchor?this._sel_anchor.makeRange(this._sel_focus).range:void 0},r.prototype.setSelectionRange=function(e,t){var n=f(this.gui_root,e.startContainer,e.startOffset),i=f(this.gui_root,e.endContainer,e.endOffset);t?(this._sel_anchor=i,this._sel_focus=n):(this._sel_anchor=n,this._sel_focus=i),this._setDOMSelectionRange(e,t),this._refreshFakeCaret(),this._caretChange()},r.prototype._normalizeCaretToEditableRange=function(e,t){if(e instanceof E){if(e.root!=this.gui_root)throw new Error("DLoc object must be for the GUI tree");t=e.offset,e=e.node}if(e.nodeType===Node.ELEMENT_NODE){var n=this.mode.nodesAroundEditableContents(e),i=n[0]?v(e.childNodes,n[0]):-1;if(i>=t)t=i+1;else{var r=n[1]?v(e.childNodes,n[1]):e.childNodes.length;t>=r&&(t=r)}}return f(this.gui_root,e,t)},r.prototype._setDOMSelectionRange=function(e,t){if(e.collapsed)return void this._clearDOMSelection();l.FIREFOX&&p.focusNode(e.endContainer),l.MSIE_TO_10&&this._clearDOMSelection();var n=this._getDOMSelection();n.setSingleRange(e,t)},r.prototype.getDataSelectionRange=function(){var e=this.getSelectionRange();if(void 0!==e){var t,n=this.toDataLocation(e.startContainer,e.startOffset);return e.collapsed||(t=this.toDataLocation(e.endContainer,e.endOffset)),n.makeRange(t).range}},r.prototype.setDataSelectionRange=function(e){var t,n=this.fromDataLocation(e.startContainer,e.startOffset);e.collapsed||(t=this.fromDataLocation(e.endContainer,e.endOffset)),this.setSelectionRange(n.makeRange(t).range)},r.prototype._caretPositionOnScreen=function(){if(this._sel_focus){if(this._fake_caret.parentNode)return this._fake_caret.getBoundingClientRect();var e=this._sel_focus.node;if(e.classList&&e.classList.contains("_gui"))return e.getBoundingClientRect();var t=this.getSelectionRange();if(t)return t.nativeRange.getBoundingClientRect();throw new Error("can't find position of caret")}}}),define("wed/key_constants",["require","exports","module","./key"],function(e,t,n){"use strict";var i=e("./key");t.CTRLEQ_S=i.makeCtrlEqKey("S"),t.CTRLEQ_Z=i.makeCtrlEqKey("Z"),t.CTRLEQ_Y=i.makeCtrlEqKey("Y"),t.CTRLEQ_C=i.makeCtrlEqKey("C"),t.CTRLEQ_X=i.makeCtrlEqKey("X"),t.CTRLEQ_V=i.makeCtrlEqKey("V"),t.CTRLEQ_FORWARD_SLASH=i.makeCtrlEqKey(191),t.CTRLEQ_PERIOD=i.makeCtrlEqKey(190),t.CTRLEQ_BACKQUOTE=i.makeCtrlEqKey(192),t.CTRLEQ_OPEN_BRACKET=i.makeCtrlEqKey(219),t.CTRLEQ_CLOSE_BRACKET=i.makeCtrlEqKey(221),t.LEFT_ARROW=i.makeKey(37,!1),t.UP_ARROW=i.makeKey(38,!1),t.RIGHT_ARROW=i.makeKey(39,!1),t.DOWN_ARROW=i.makeKey(40,!1),t.BACKSPACE=i.makeKey(8,!1),t.DELETE=i.makeKey(46,!1),t.ENTER=i.makeKey(13,!1),t.SPACE=i.makeKey(32,!1),t.ESCAPE=i.makeKey(27,!1),t.EDITING_KEYS=[t.LEFT_ARROW,t.RIGHT_ARROW,t.BACKSPACE,t.DELETE,t.ENTER]}),define("wed/gui/context_menu",["require","exports","module","jquery","../util","../log","../domutil","bootstrap"],function(e,t,n){"use strict";function i(e,t,n,i,a){this._dismiss_callback=a,this._dismissed=!1;var s=e.createElement("div");s.className="dropdown wed-context-menu",s.innerHTML="<a href='#' data-toggle='dropdown'></a><ul class='dropdown-menu' role='menu'></ul>";var l=s.lastElementChild,d=s.firstElementChild;t-=5,n-=5,s.style.top=n+"px",s.style.left=t+"px";var c=r(l);this._menu=l,this._$menu=c,this._dropdown=s,this._backdrop=e.createElement("div"),this._backdrop.className="wed-context-menu-backdrop",r(this._backdrop).click(this._backdrop_click_handler.bind(this)),c.on("click",this._contents_click_handler.bind(this)),c.on("mousedown",function(e){e.stopPropagation()}.bind(this)),r(s).on("contextmenu mouseup",!1);var h=e.body;h.insertBefore(s,h.firstChild),h.insertBefore(this._backdrop,h.firstChild),this._render(i);var u=c.outerWidth(),p=r(e.defaultView).width();s.style.left=Math.max(0,Math.min(t,p-u))+"px",l.style.maxWidth=p+"px";var _=5*Number(c.css("line-height").replace("px","")),f=(c.outerHeight(),r(e.defaultView).height()),E=f-n;_>E&&(n-=_-E,E=_),s.style.top=n+"px",l.style.maxHeight=E+"px",r(d).focus(this.handleToggleFocus.bind(this)),r(d).dropdown("toggle");var m=o.childByClass(s,"dropdown-backdrop");m&&s.removeChild(m)}var r=e("jquery"),o=(e("../util"),e("../log"),e("../domutil"));e("bootstrap"),i.prototype.handleToggleFocus=function(){},i.prototype._contents_click_handler=function(e){return this.dismiss(),e.stopPropagation(),e.preventDefault(),!1},i.prototype._backdrop_click_handler=function(){return this.dismiss(),!1},i.prototype._render=function(e){this._$menu.append(e)},i.prototype.dismiss=function(){this._dismissed||(this._$menu.dropdown("toggle"),this._dropdown&&this._dropdown.parentNode&&this._dropdown.parentNode.removeChild(this._dropdown),this._backdrop&&this._backdrop.parentNode&&this._backdrop.parentNode.removeChild(this._backdrop),this._dismiss_callback&&this._dismiss_callback(),this._dismissed=!0)},t.ContextMenu=i}),define("wed/gui/action_context_menu",["require","exports","module","./context_menu","jquery","./icon","../oop","../log","../key_constants","../key","../browsers","../util"],function(e,t,n){"use strict";function i(e,t,n,i,d){i.sort(function(e,t){var n=e.action&&e.action.kind,i=t.action&&t.action.kind;if(n!==i){var r=m.indexOf(n),o=m.indexOf(i);return r-o}var a=e.item.textContent,s=t.item.textContent;return a===s?0:s>a?-1:1}),this._action_items=i,this._action_kind_filter=null,this._action_type_filter=null,this._action_text_filter="";var h=e.createElement("li");h.className="wed-menu-filter",h.style.whiteSpace="nowrap";var u=e.createElement("div"),p=e.createElement("div");p.className="btn-group btn-group-xs";var _,f,A,F;for(_=0,f=E.length;f>_;++_){var g=E[_];A=e.createElement("button"),A.className="btn btn-default",g?(A.innerHTML=l.makeHTML(g),F="Show only "+g+" operations."):(A.innerHTML=l.makeHTML("other"),F="Show operations not covered by other filter buttons."),s(A).tooltip({title:F,container:"body",placement:"auto top",trigger:"hover"}),s(A).on("click",r(this,g)),p.appendChild(A)}var C=e.createElement("div");for(C.className="btn-group btn-group-xs",_=0,f=v.length;f>_;++_){var D=v[_];A=e.createElement("button"),A.className="btn btn-default",D?(A.innerHTML=l.makeHTML(D),F="Show only "+D+" operations."):(A.innerHTML=l.makeHTML("other"),F="Show operations not covered by other filter buttons."),s(A).tooltip({title:F,container:"body",placement:"auto top",trigger:"hover"}),s(A).on("click",o(this,D)),C.appendChild(A)}s(h).on("click",!1),h.appendChild(u),u.appendChild(p),u.appendChild(e.createTextNode("")),u.appendChild(C);var y=e.createElement("input");y.className="form-control input-sm",y.setAttribute("placeholder","Filter choices by text.");var w=e.createElement("div");w.appendChild(y),h.appendChild(w);var B=s(y);B.on("input",this._inputChangeHandler.bind(this)),B.on("keydown",this._inputKeydownHandler.bind(this)),this._action_filter_item=h,this._action_filter_input=y,a.ContextMenu.call(this,e,t,n,[],d),y.focus();var b=this._$menu;b.parent().on("hidden.bs.dropdown",c.wrap(function(){s(y).tooltip("destroy"),s(p).children().tooltip("destroy")})),b.on("keydown",this._actionKeydownHandler.bind(this)),b.on("keypress",this._actionKeypressHandler.bind(this))}function r(e,t){return c.wrap(function(n){e._action_kind_filter=t,e._render()})}function o(e,t){return c.wrap(function(n){e._action_type_filter=t,e._render()})}var a=e("./context_menu"),s=e("jquery"),l=e("./icon"),d=e("../oop"),c=e("../log"),h=e("../key_constants"),u=e("../key"),p=e("../browsers"),_=(e("../util"),a.ContextMenu),f=["add","delete","wrap","unwrap"],E=f.concat(void 0),m=[void 0].concat(f),A=["element","attribute"],v=A.concat(void 0);d.inherit(i,_),i.prototype.handleToggleFocus=function(){this._action_filter_input.focus()};var F="li:not(.divider):visible a";i.prototype._actionKeydownHandler=c.wrap(function(e){if(h.ESCAPE.matchesEvent(e)&&(null!==this._action_kind_filter||null!==this._action_type_filter||this._action_text_filter)){if(this._action_kind_filter=null,this._action_type_filter=null,this._action_text_filter="",p.FIREFOX_24){var t=this;setTimeout(function(){t._action_filter_input.value="",t._render()},0)}else this._action_filter_input.value="",this._render();return e.stopPropagation(),e.preventDefault(),!1}return!0});var g=u.makeKey("+"),C=u.makeKey("-"),D=u.makeKey("."),y=u.makeKey(","),w=u.makeKey("?"),B=u.makeKey("<"),b=u.makeKey("@"),N=u.makeKey("!"),x=[{key:g,filter:"add",which:"kind"},{key:C,filter:"delete",which:"kind"},{key:y,filter:"wrap",which:"kind"},{key:D,filter:"unwrap",which:"kind"},{key:w,filter:void 0,which:"kind"},{key:B,filter:"element",which:"type"},{key:b,filter:"attribute",which:"type"},{key:N,filter:void 0,which:"type"}];i.prototype._actionKeypressHandler=c.wrap(function(e){if(this._action_text_filter)return!0;for(var t,n=0;void 0!==(t=x[n]);++n){var i=t.key;if(i.matchesEvent(e)){var r="_action_"+t.which+"_filter";if(null!==this[r])continue;return this[r]=t.filter,this._render(),e.stopPropagation(),e.preventDefault(),!1}}return!0}),i.prototype._inputChangeHandler=c.wrap(function(e){var t=this._action_text_filter,n=e.target.value;t!==n&&(this._action_text_filter=n,this._render())}),i.prototype._inputKeydownHandler=c.wrap(function(e){if(h.ENTER.matchesEvent(e))return this._$menu.find(F).first().focus().click(),e.stopPropagation(),e.preventDefault(),!1;for(var t,n,i=["UP_ARROW","DOWN_ARROW","ESCAPE"],r=0;n=i[r];++r){var o=h[n];if(o.matchesEvent(e)){t=o;break}}if(t){var a=new s.Event("keydown");return t.setEventToMatch(a),this._$menu.trigger(a),!1}return!0}),i.prototype._render=function(){for(var e=this._menu,t=this._action_filter_item,n=this._action_kind_filter,i=this._action_type_filter;e.lastChild&&e.lastChild!==t;)e.removeChild(e.lastChild);var r,o,a,s,l=t.firstElementChild.firstElementChild.firstElementChild;for(r=0,o=E.length;o>r;++r){var d=E[r];a=l.classList,s=n===d?a.add:a.remove,s.call(a,"active"),l=l.nextElementSibling}for(l=t.firstElementChild.lastElementChild.firstElementChild,r=0,o=v.length;o>r;++r){var c=v[r];a=l.classList,s=i===c?a.add:a.remove,s.call(a,"active"),l=l.nextElementSibling}t.parentNode||e.appendChild(t);var h=this._computeActionItemsToDisplay(this._action_items);_.prototype._render.call(this,h)},i.prototype._computeActionItemsToDisplay=function(e){var t,n=this._action_kind_filter,i=this._action_type_filter,r=this._action_text_filter;switch(n){case null:t=function(){return!0};break;case void 0:t=function(e){return!e.action||-1===f.indexOf(e.action.kind)};break;default:t=function(e){return e.action&&e.action.kind===n}}var o;switch(i){case null:o=function(){return!0};break;case void 0:o=function(e){return!e.action||-1===A.indexOf(e.action.node_type)};break;default:o=function(e){return e.action&&e.action.node_type===i}}var a;if(r)if("^"===r[0]){var s=RegExp(r);a=function(e){var t=e.data&&e.data.name?e.data.name:e.item.textContent;return s.test(t)}}else a=function(e){var t=e.data&&e.data.name?e.data.name:e.item.textContent;return-1!==t.indexOf(r)};else a=function(){return!0};for(var l,d=[],c=0;void 0!==(l=e[c]);++c)t(l)&&o(l)&&a(l)&&d.push(l.item);return d},t.ContextMenu=i}),define("wed/gui/completion_menu",["require","exports","module","./context_menu","jquery","../oop","../log","../key_constants"],function(e,t,n){"use strict";function i(e,t,n,i,r,o,a){this._completion_prefix=r,this._completion_items=o,this._editor=e,l.call(this,t,n,i,[],a),this._dropdown.classList.add("wed-completion-menu"),this._dropdown.firstElementChild.getAttribute("data-toggle")&&this._dropdown.removeChild(this._dropdown.firstChild),this._backdrop.parentNode.removeChild(this._backdrop),this._bound_completion_keydown_handler=this._globalKeydownHandler.bind(this),e.pushGlobalKeydownHandler(this._bound_completion_keydown_handler),e._focusInputField()}var r=e("./context_menu"),o=e("jquery"),a=e("../oop"),s=(e("../log"),e("../key_constants")),l=r.ContextMenu;a.inherit(i,l),i.prototype._globalKeydownHandler=function(e,t){return s.ENTER.matchesEvent(t)?(this._$menu.find("li:not(.divider):visible a").first().click(),!1):s.DOWN_ARROW.matchesEvent(t)?(this._$menu.find("li:not(.divider):visible a").first().focus(),this._$menu.trigger(t),!1):s.ESCAPE.matchesEvent(t)?(this.dismiss(),!1):!0},i.prototype._render=function(){function e(e){a.type(e.data)}for(var t,n,i=[],r=this._completion_prefix,a=this._editor,s=a.doc,d=0;void 0!==(n=this._completion_items[d]);++d)if(""===r)t=s.createElement("li"),t.innerHTML="<a href='#'></a>",t.lastChild.textContent=n,i.push(t),o(t).click(n,e);else if(0===n.lastIndexOf(r,0)){t=s.createElement("li"),t.innerHTML="<a href='#'><b></b></a>";var c=t.lastChild;c.firstChild.textContent=n.slice(0,r.length);var h=n.slice(r.length);c.appendChild(s.createTextNode(h)),i.push(t),o(t).click(h,e)}0===i.length&&this.dismiss(),1===i.length&&n===r&&this.dismiss(),l.prototype._render.call(this,i)},i.prototype.dismiss=function(){this._dismissed||(this._editor.popGlobalKeydownHandler(this._bound_completion_keydown_handler),l.prototype.dismiss.call(this))},t.CompletionMenu=i}),define("wed/gui/typeahead_popup",["require","exports","module","jquery","../domutil","../log","../key_constants","bootstrap","typeahead"],function(e,t,n){function i(e,t,n,i,a,s,l){var d=e,c=o.htmlToElements('<div class="wed-typeahead-popup"><input class="typeahead form-control" type="text"><span class="spinner"><i class="fa fa-spinner fa-spin"></i></span></div>',d)[0],h=c.firstElementChild;h.setAttribute("placeholder",a),this._ta_wrapper=c,this._dismiss_callback=l,this._dismissed=!1,this._backdrop=e.createElement("div"),this._backdrop.className="wed-typeahead-popup-backdrop",r(this._backdrop).click(this._backdrop_click_handler.bind(this)),c.style.width=i+"px",c.style.left=t+"px",c.style.top=n+"px";var u=r(h);this._ta=h,this._$ta=u;var p=[s.options];s.datasets&&s.datasets.length>0&&(p=p.concat(s.datasets)),u.typeahead.apply(u,p),u.on("keydown",this._keydownHandler.bind(this)),u.on("typeahead:selected",this._selectedHandler.bind(this));var _=d.body;_.insertBefore(c,_.firstChild),_.insertBefore(this._backdrop,_.firstChild);var f=c.offsetWidth,E=e.defaultView.innerWidth;c.style.left=Math.max(0,Math.min(t,E-f))+"px",c.style.maxWidth=E+"px";var m=e.defaultView.innerHeight,A=m-n;c.style.maxHeight=A+"px";var v=c.getElementsByClassName("tt-dropdown-menu")[0],F=r(v),g=v.style.display;v.style.display="block";var C=5*Number(F.css("line-height").replace("px","")),D=v.getBoundingClientRect(),y=m-D.top;C>y&&(n-=C-y,y=C,c.style.top=n+"px"),v.style.maxHeight=y+"px",v.style.display=g,F.off("mouseenter.tt",".tt-suggestion"),F.off("mouseleave.tt",".tt-suggestion"),F.on("click",!1),h.focus();var w=r.data(h,"ttTypeahead");w.isActivated=!0,w.input.off("blurred"),w._onBlurred=function(){this.isActivated=!1},w.input.onSync("blurred",w._onBlurred,w)}var r=e("jquery"),o=e("../domutil"),a=e("../log"),s=e("../key_constants");e("bootstrap"),e("typeahead"),i.prototype.dismiss=function(e){if(!this._dismissed){var t=this._ta_wrapper;t&&t.parentNode&&t.parentNode.removeChild(t);var n=this._backdrop;n&&n.parentNode&&n.parentNode.removeChild(n),this._dismiss_callback&&this._dismiss_callback(e),this._dismissed=!0}},i.prototype._backdrop_click_handler=a.wrap(function(){return this.dismiss(),!1}),i.prototype._keydownHandler=a.wrap(function(e){return s.ESCAPE.matchesEvent(e)?(this.dismiss(),!1):void 0}),i.prototype._selectedHandler=a.wrap(function(e,t){this.dismiss(t)}),i.prototype.hideSpinner=function(){this._ta_wrapper.getElementsByClassName("spinner")[0].style.display="none"},i.prototype.setValue=function(e){this._$ta.typeahead("val",e)},t.TypeaheadPopup=i}),define("wed/gui/tooltip",["require","exports","module","jquery","bootstrap"],function(e,t,n){"use strict";function i(e){var t=e.target,n=o.data(t,"bs.tooltip");o.data(n.tip()[0],"wed-tooltip-for",t)}function r(e,t){e.tooltip(t),e[0].classList.add("wed-has-tooltip"),e.on("show.bs.tooltip",i)}var o=e("jquery");e("bootstrap"),t.tooltip=r}),define("wed/wed_gui",["require","exports","module","./wed_core","jquery","./browsers","./log","./saver","./validator","./util","./domutil","salve/validate","./key_constants","./gui/modal","./gui/context_menu","./gui/action_context_menu","./gui/completion_menu","./gui/typeahead_popup","./key","./dloc","./gui/icon","./wed_util","./gui/tooltip","./guiroot","./transformation","bootstrap","jquery.bootstrap-growl"],function(e,t,n){"use strict";function i(e,t){try{return e.fromDataLocation(t,0).node}catch(n){if(n instanceof B.AttributeNotFound)return;throw n}}function r(e,t,n){try{return e.fromDataLocation(t,n)}catch(i){if(i instanceof B.AttributeNotFound)return e.fromDataLocation(t.ownerElement,0);throw i}}var o=e("./wed_core"),a=o.Editor,s=e("jquery"),l=(e("./browsers"),e("./log")),d=e("./saver"),c=e("./validator"),h=e("./util"),u=e("./domutil"),p=u.isAttr,_=e("salve/validate"),f=e("./key_constants"),E=e("./gui/modal"),m=(e("./gui/context_menu"),e("./gui/action_context_menu")),A=e("./gui/completion_menu"),v=e("./gui/typeahead_popup"),F=e("./key"),g=e("./dloc"),C=g.makeDLoc,D=e("./gui/icon"),y=e("./wed_util"),w=e("./gui/tooltip").tooltip,B=e("./guiroot"),b=e("./transformation"),N=y.getAttrValueNode;e("bootstrap"),e("jquery.bootstrap-growl");var x=u.closestByClass,T=u.closest,k=u.indexOf;a.prototype.resize=function(){this._resizeHandler()},a.prototype._resizeHandler=l.wrap(function(){function e(){t+=this.scrollHeight}for(var t=0,n=this.$widget;n.length>0;){var i=n.nextAll().not("script");i.each(e),n=n.parent()}t+=this._wed_location_bar.scrollHeight;var r=this.my_window.innerHeight-(this._scroller.getBoundingClientRect().top+this.my_window.pageYOffset)-t-1;r=Math.floor(r),this._scroller.style.maxHeight=r+"px",this._scroller.style.minHeight=r+"px";var o=this._sidebar,a=this.my_window.innerHeight-(o.getBoundingClientRect().top+this.my_window.pageYOffset)-t;o.style.maxHeight=a+"px",o.style.minHeight=a+"px";var l=o.getElementsByClassName("wed-sidebar-panel")[0];a=this.my_window.innerHeight-(l.getBoundingClientRect().top+this.my_window.pageYOffset)-t,l.style.maxHeight=a+"px",l.style.minHeight=a+"px";for(var d,c=l.getElementsByClassName("panel"),h=l.getElementsByClassName("panel-heading"),p=0,_=0;void 0!==(d=h[_]);++_){var f=s(d.parentNode);p+=f.outerHeight(!0)-f.innerHeight(),p+=s(d).outerHeight(!0)}var E,m=a-p;for(_=0,E;void 0!==(E=c[_]);++_){E.style.maxHeight=m+s(u.childByClass(E,"panel-heading")).outerHeight(!0)+"px";var A=E.getElementsByClassName("panel-body")[0];A.style.height=m+"px"}this._refreshValidationErrors(),this._refreshFakeCaret()}),a.prototype.openDocumentationLink=function(e){window.open(e)},a.prototype.makeDocumentationLink=function(e){var t=D.makeHTML("documentation"),n=u.htmlToElements("<a tabindex='0' href='#'>"+t+" Element's documentation.</a>",this.doc)[0];return s(n).click(function(){this.openDocumentationLink(e)}.bind(this)),n},a.prototype._contextMenuHandler=function(e){if(!this._sel_focus)return!1;var t=this.getSelectionRange(),n=!(t&&!t.collapsed);if(!n&&!u.isWellFormedRange(t))return!1;var i=this._sel_focus.node,r=this._sel_focus.offset;if(i.nodeType!==Node.ELEMENT_NODE){var o=i.parentNode;r=k(o.childNodes,i),i=o}var a=x(i,"_placeholder",this.gui_root);a&&(r=k(a.parentNode.childNodes,a),i=a.parentNode);var s=x(i,"_real",this.gui_root),l=s&&s.classList.contains("_readonly"),d=x(i,"_attribute_value",this.gui_root)?this._getMenuItemsForAttribute:this._getMenuItemsForElement,c=d.call(this,i,r,!n);if(0===c.length)return!0;var h=this.computeContextMenuPosition(e);return this.displayContextMenu(m.ContextMenu,h.left,h.top,c,l),!1},a.prototype._getMenuItemsForAttribute=function(e,t,n){var i=[];return i},a.prototype._getMenuItemsForElement=function(e,t,n){function i(e,t){var n=_._makeMenuItemForAction(t,e);p.push({action:t,item:n,data:e})}var r={};if(e.classList&&e.classList.contains("_phantom")){for(var o;e&&e.classList.contains("_phantom");)o=e,e=e.parentNode;if(e&&this.gui_root.contains(e)){var a=this.mode.nodesAroundEditableContents(e),l=e.childNodes;t=k(l,o);var d=a[0]&&k(l,a[0]),c=a[1]&&k(l,a[1]);null!==d&&d>=t&&(t=d+1),null!==c&&t>=c&&(t=c-1),r={move_caret_to:C(this.gui_root,e,t)}}else e=null}if(!e)return[];var h,u,p=[],_=this;if(!e.classList.contains("_phantom")&&!e.parentNode.classList.contains("_gui")){var f=this.toDataLocation(e,t),E=f.node,m=this.mode.documentationLinkFor(E.tagName);if(m){var A=this.makeDocumentationLink(m),v=e.ownerDocument.createElement("li");v.appendChild(A),p.push({action:null,item:v,data:null})}var F=this.getElementTransformationsAt(f,n);for(h=0;u=F[h];++h)i(void 0!==u.name?{name:u.name}:void 0,u.tr);if(E!==this.data_root.firstChild)for(F=this.mode.getContextualActions(["unwrap","delete-parent"],E.tagName,E,0),h=0;void 0!==(u=F[h]);++h)i({node:E,name:E.tagName},u)}var g=s(e).parents().addBack().siblings("[data-wed--separator-for]").first(),D=g.siblings().filter(function(){return this.contains(e)})[0],y=g[0]&&g[0].getAttribute("data-wed--separator-for");if(void 0!==y){var F=this.mode.getContextualActions(["merge-with-next","merge-with-previous","append","prepend"],y,s.data(D,"wed_mirror_node"),0);F.forEach(function(e){i({node:D,name:y},e)}.bind(this))}return p},a.prototype._makeMenuItemForAction=function(e,t){var n=e.getIcon(),i=u.htmlToElements("<li><a tabindex='0' href='#'>"+(n?n+" ":"")+"</a></li>",this.doc)[0];void 0!==e.kind&&i.setAttribute("data-kind",e.kind);var r=i.firstElementChild,o=this.doc.createTextNode(e.getDescriptionFor(t));return r.appendChild(o),r.normalize(),s(r).click(t,e.bound_terminal_handler),i},a.prototype.computeContextMenuPosition=function(e,t){t=!!t;e=e||{};var n,i;if("mousedown"===e.type||"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type)n={left:e.clientX,top:e.clientY};else if(this._fake_caret.parentNode){var r=this._positionFromGUIRoot(this._fake_caret);this.scrollIntoView(r.left,r.top,r.left+this._fake_caret.offsetWidth,r.top+this._fake_caret.offsetHeight),i=this._fake_caret.getBoundingClientRect(),n={top:t?i.bottom:i.top+this._$fake_caret.height()/2,left:i.left}}else{var o=x(this._sel_focus.node,"_gui",this.gui_root);if(!o)throw new Error("no position for displaying the menu");i=o.getBoundingClientRect();var a=s(o);n={top:t?i.bottom:i.top+a.height()/2,left:i.left+a.width()/2}}return n},a.prototype.getElementTransformationsAt=function(e,t){t=!!t;var n=this.mode,i=this.resolver,r=[],o=this;return this.validator.possibleAt(e).forEach(function(a){if("enterStartTag"===a.params[0])if(a.params[1].simple())for(var s,l=a.params[1].toArray(),d=0;s=l[d];++d){var c=i.unresolveName(s.ns,s.name),h=n.getContextualActions(t?"wrap":"insert",c,e.node,e.offset);if(void 0===h)return;for(var u,p=0;u=h[p];++p)r.push({tr:u,name:c})}else r.push({tr:o.complex_pattern_action,name:void 0})}),r},a.prototype._cutHandler=function(e){if(void 0===this.getDataCaret())return!1;var t=this._getDOMSelectionRange();if(u.isWellFormedRange(t)){
var n=x(this._sel_anchor.node,"_real",this.gui_root);return!n||n.classList.contains("_readonly")?!1:(this.fireTransformation(this.cut_tr,{e:e}),!0)}return this.straddling_modal.modal(),!1},a.prototype._pasteHandler=function(e){var t=this.getDataCaret();if(void 0===t)return!1;var n=x(this._sel_anchor.node,"_real",this.gui_root);if(!n||n.classList.contains("_readonly"))return!1;var i=e.originalEvent.clipboardData||this.my_window.clipboardData,r=i.getData("text");if(!r)return!1;if(r=this._normalizeEnteredText(r),!r)return!1;var o,a=new this.my_window.DOMParser,s=a.parseFromString("<div>"+r+"</div>","text/xml"),l=!0;if("parsererror"===s.firstChild.tagName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"===s.firstChild.namespace&&(l=!1),l){o=s.firstChild;var d=this.validator.speculativelyValidate(t,Array.prototype.slice.call(o.childNodes));if(d)return this._paste_modal.modal(function(){"Yes"===this._paste_modal.getClickedAsText()&&(o=this.doc.createElement("div"),o.textContent=r,this.fireTransformation(this.paste_tr,{node:t.node,to_paste:o,e:e}))}.bind(this)),!1}else o=this.doc.createElement("div"),o.textContent=r;return this.fireTransformation(this.paste_tr,{node:t.node,to_paste:o,e:e}),!1},a.prototype.scrollIntoView=function(e,t,n,i){var r=this.gui_root.scrollTop,o=this.$gui_root.height(),a=r+o;(r>t||i>a)&&(r=r>t?t:i-o,this.gui_root.scrollTop=r);var s=this.gui_root.scrollLeft,l=this.$gui_root.width(),d=s+l;(s>e||n>d)&&(s=s>e?e:n-l,this.gui_root.scrollLeft=s);var c=this.gui_root.getBoundingClientRect();e=e-s+c.left,n=n-s+c.left,t=t-r+c.top,i=i-r+c.top;var h=this.doc.body.scrollHeight,u=this.doc.body.scrollWidth,p=0;(0>t||i>h)&&(p=0>t?t:i);var _=0;(0>e||n>u)&&(_=0>e?e:n),this.my_window.scrollBy(_,p)},a.prototype._keydownHandler=l.wrap(function(e){var t=this.getGUICaret();t&&this.$gui_root.trigger("wed-input-trigger-keydown",[e]),e.isImmediatePropagationStopped()||e.isPropagationStopped()||this.$gui_root.trigger("wed-global-keydown",[e])}),a.prototype.pushGlobalKeydownHandler=function(e){this._global_keydown_handlers.push(e)},a.prototype.popGlobalKeydownHandler=function(e){var t=this._global_keydown_handlers.pop();if(t!==e)throw new Error("did not pop the expected handler")},a.prototype._globalKeydownHandler=l.wrap(function(e,t){function n(){return t.stopPropagation(),t.preventDefault(),!1}function i(){var e=o.getSelectionRange();if(e&&!e.collapsed){if(!u.isWellFormedRange(e))return!0;w=o._initiateTextUndo();var t=o.toDataLocation(e.startContainer,e.startOffset),n=o.toDataLocation(e.endContainer,e.endOffset),i=o.data_updater.cut(t,n);return o.setDataCaret(i[0],!0),w.recordCaretAfter(),o._refreshValidationErrors(),!0}return!1}var r,o=this;if(17===t.which||16===t.which||18===t.which||0===t.which)return!0;for(var a,d=0;void 0!==(a=this._global_keydown_handlers[d]);++d){var c=a(e,t);c===!1&&n()}if(112===t.which)return this.help_modal.modal(),n();if(this._development_mode){if(113===t.which)return this.dumpCaretInfo(),n();if(114==t.which)return this.dumpUndo(),n();if(115==t.which)return console.log("manual focus"),console.log("document.activeElement before",document.activeElement),console.log('document.querySelector(":focus") before',document.querySelector(":focus")),this._focusInputField(),console.log("document.activeElement after",document.activeElement),console.log('document.querySelector(":focus") after',document.querySelector(":focus")),n()}var p=this._sel_focus;if(t.which>=33&&t.which<=40){if(f.RIGHT_ARROW.matchesEvent(t)){if(t.shiftKey){this._sel_focus=this.positionRight(this._sel_focus);var _=this._sel_anchor.makeRange(this._sel_focus);this.setSelectionRange(_.range,_.reversed)}else this.moveCaretRight();return n()}if(f.LEFT_ARROW.matchesEvent(t)){if(t.shiftKey){this._sel_focus=this.positionLeft(this._sel_focus);var _=this._sel_anchor.makeRange(this._sel_focus);this.setSelectionRange(_.range,_.reversed)}else this.moveCaretLeft();return n()}return!0}if(f.ESCAPE.matchesEvent(t))return this._closeAllTooltips()?n():!0;if(f.CTRLEQ_S.matchesEvent(t))return this.save(),n();if(f.CTRLEQ_Z.matchesEvent(t))return this.undo(),n();if(f.CTRLEQ_Y.matchesEvent(t))return this.redo(),n();if(f.CTRLEQ_C.matchesEvent(t)||f.CTRLEQ_X.matchesEvent(t)||f.CTRLEQ_V.matchesEvent(t))return!0;if(f.CTRLEQ_BACKQUOTE.matchesEvent(t))return this._development_mode=!this._development_mode,s.bootstrapGrowl(this._development_mode?"Development mode on.":"Development mode off.",{ele:"body",type:"info",align:"center"}),this._development_mode&&l.showPopup(),n();if(f.CTRLEQ_OPEN_BRACKET.matchesEvent(t))return this.decreaseLabelVisiblityLevel(),n();if(f.CTRLEQ_CLOSE_BRACKET.matchesEvent(t))return this.increaseLabelVisibilityLevel(),n();if(f.CTRLEQ_FORWARD_SLASH.matchesEvent(t)){var E=p&&p.node;if(E){var m=x(E,"_gui",p.root);if(m&&m.classList.contains("_label_clicked"))return E.nodeType===Node.TEXT_NODE&&(E=E.parentNode),s(E).trigger("wed-context-menu",[t]),n()}if(this._contextMenuHandler(t)===!1)return n()}if(void 0===p)return!0;var A=x(p.node,"_placeholder",p.root);if(A){if(r=this.getDataCaret(),!h.anySpecialKeyHeld(t)){var v=!1;if(A.parentNode.classList.contains("_attribute_value")?v=!0:this.validator.possibleAt(r).forEach(function(e){"text"===e.params[0]&&(v=!0)}),!v)return n()}if(f.BACKSPACE.matchesEvent(t)||f.DELETE.matchesEvent(t))return n()}var F=x(p.node,"_attribute_value",p.root),g=this.$gui_root.find(".__start_label._label_clicked, .__end_label._label_clicked");if(!F&&g[0]&&f.DELETE.matchesEvent(t)){var C=x(g[0],"_real",this.gui_root),D=this.data_updater.pathToNode(this.nodeToPath(C)),y=this.mode.getContextualActions("delete-parent",D.tagName,D,0);y[0].execute({node:D,name:D.tagName})}else if(p.node.classList&&(p.node.classList.contains("_phantom")||p.node.classList.contains("_phantom_wrap")))return n();var w,B,b;if(f.SPACE.matchesEvent(t))return(r=this.getGUICaret())?((F||!x(r.node,"_phantom",r.root))&&this._handleKeyInsertingText(t),n()):n();if(f.DELETE.matchesEvent(t)){if(F){if(""===F.textContent)return n();this._spliceAttribute(F,this.getGUICaret().offset,1,"")}else{var N=u.nextCaretPosition(p.toArray(),this.gui_root,!0)[0];if(!N.classList||!N.classList.contains("_phantom")&&!N.classList.contains("_phantom_wrap")){if(i())return n();r=this.getDataCaret(),r.node.nodeType!==Node.TEXT_NODE&&(r=r.make(r.node.childNodes[r.offset],0)),r.node.nodeType===Node.TEXT_NODE&&(B=r.node.parentNode,b=k(B.childNodes,r.node),w=this._initiateTextUndo(),this.data_updater.deleteText(r,1),r.node.parentNode?this.setDataCaret(r,!0):this.setDataCaret(B,b,!0),w.recordCaretAfter())}}return this._refreshValidationErrors(),n()}if(f.BACKSPACE.matchesEvent(t)){if(F){if(""===F.textContent)return n();this._spliceAttribute(F,this.getGUICaret().offset-1,1,"")}else{var T=u.prevCaretPosition(p.toArray(),this.gui_root,!0)[0];if(!T.classList||!T.classList.contains("_phantom")&&!T.classList.contains("_phantom_wrap")){if(i())return n();if(r=this.getDataCaret(),r.node.nodeType!==Node.TEXT_NODE&&(r=r.make(r.node.childNodes[r.offset-1],r.node.childNodes[r.offset-1].length)),r.node.nodeType===Node.TEXT_NODE){if(B=r.node.parentNode,b=k(B.childNodes,r.node),0===r.offset)return n();w=this._initiateTextUndo(),this.data_updater.deleteText(r.node,r.offset-1,1),r.node.parentNode?this.setDataCaret(r.node,r.offset-1,!0):this.setDataCaret(B,b,!0),w.recordCaretAfter()}}}return this._refreshValidationErrors(),n()}return!0});var S=F.makeKey(27);a.prototype._keypressHandler=l.wrap(function(e){return S.matchesEvent(e)?!0:(this.$gui_root.trigger("wed-input-trigger-keypress",[e]),e.isImmediatePropagationStopped()||e.isPropagationStopped()?!0:void this.$gui_root.trigger("wed-global-keypress",[e]))}),a.prototype.type=function(e){e instanceof F.Key&&(e=[e]);for(var t=0;t<e.length;++t){var n=e[t];"string"==typeof n&&(n=" "===n?f.SPACE:F.makeKey(n));var i=new s.Event("keydown");n.setEventToMatch(i),this._$input_field.trigger(i)}},a.prototype._globalKeypressHandler=l.wrap(function(e,t){function n(){return t.preventDefault(),t.stopPropagation(),!1}if(void 0===this._sel_focus)return!0;if(!t.which)return!0;if(8===t.which)return n();if(t.ctrlKey||t.altKey||t.metaKey)return!0;var i=this.getSelectionRange();if(void 0!==i&&!i.collapsed){if(!u.isWellFormedRange(i))return n();var r=(this._initiateTextUndo(),this.toDataLocation(i.startContainer,i.startOffset)),o=this.toDataLocation(i.endContainer,i.endOffset),a=this.data_updater.cut(r,o);this.setDataCaret(a[0],!0)}return this._handleKeyInsertingText(t),n()}),a.prototype._handleKeyInsertingText=function(e){var t=String.fromCharCode(e.which);return""===t?!1:(this._insertText(t),e.preventDefault(),void e.stopPropagation())},a.prototype._compositionHandler=l.wrap(function(e){if("compositionstart"===e.type)this._composing=!0,this._composition_data={data:e.originalEvent.data,start_caret:this._sel_focus},this._$input_field.css("z-index",10),this._refreshFakeCaret();else if("compositionupdate"===e.type)this._composition_data.data=e.originalEvent.data;else{if("compositionend"!==e.type)throw new Error("unexpected event type: "+e.type);this._composing=!1,this._$input_field.css("z-index","").css("top","").css("left","")}}),a.prototype._inputHandler=l.wrap(function(e){this._composing||""!==this._$input_field.val()&&(this._insertText(this._$input_field.val()),this._$input_field.val(""),this._focusInputField())}),a.prototype._mousemoveHandler=l.wrap(function(e){function t(e){return e.classList.contains("_real")||r&&e.classList.contains("_attribute_value")}var n=this.elementAtPointUnderLayers(e.clientX,e.clientY);if(this.gui_root.contains(n)){var i,r="edit"===this.attributes;if(t(n)){if(i=this._pointToCharBoundary(e.clientX,e.clientY),!i)return}else{for(var o;!t(n);)if(o=n,n=o.parentNode,!this.gui_root.contains(n))return;var a=k(n.childNodes,o),s=this.doc.createRange();s.setStart(n,a),s.setEnd(n,a+1);var l=s.getBoundingClientRect();Math.abs(l.left-e.clientX)>=Math.abs(l.right-e.clientX)&&a++,i=C(this.gui_root,n,a)}if(this._sel_focus=i,!this._prev_sel_focus||this._sel_focus.offset!=this._prev_sel_focus.offset||this._sel_focus.node!=this._prev_sel_focus.node){this._refreshFakeCaret();var d=this._sel_anchor.makeRange(this._sel_focus);this._setDOMSelectionRange(d.range,d.reversed),this._prev_sel_focus=this._sel_focus}}}),a.prototype.elementAtPointUnderLayers=function(e,t){this._hideLayers();var n=this.doc.elementFromPoint(e,t);return this._popLayerState(),n},a.prototype._hideLayers=function(){for(var e,t=Object.create(null),n=0;void 0!==(e=this._layer_names[n]);++n){var i=this[e];t[e]=i.style.display,i.style.display="none"}this._layer_state_stack.push(t)},a.prototype._popLayerState=function(){for(var e,t=this._layer_state_stack.pop(),n=0;void 0!==(e=this._layer_names[n]);++n){var i=this[e];i.style.display=t[e]}},a.prototype._caretLayerMouseHandler=l.wrap(function(e){"mousedown"===e.type&&(this._$caret_layer.on("mousemove",this._caretLayerMouseHandler.bind(this)),this._$caret_layer.one("mouseup",this._caretLayerMouseHandler.bind(this)));var t=this.elementAtPointUnderLayers(e.clientX,e.clientY),n=s.Event(e.type,e);n.target=t,n.toElement=t,s(t).trigger(n),"mouseup"===e.type&&this._$caret_layer.off("mousemove"),e.preventDefault(),e.stopPropagation()}),a.prototype._moveToNormalizedLabelPosition=function(e,t,n){var i=x(e,"_attribute",t);i?x(n.node,"_attribute_value",t)?this.setGUICaret(n):this.setGUICaret(N(i.getElementsByClassName("_attribute_value")[0]),0):this.setGUICaret(t.getElementsByClassName("_element_name")[0],0)},a.prototype._mousedownHandler=l.wrap(function(e){if(!u.pointInContents(this._scroller,e.pageX,e.pageY))return!1;var t=this._pointToCharBoundary(e.clientX,e.clientY);if(!t)return!0;this.$gui_root.one("mouseup",this._mouseupHandler.bind(this)),this.$widget.find(".wed-validation-error.selected").removeClass("selected"),this.$error_list.find(".selected").removeClass("selected");var n=this.gui_root,i=e.target,r=x(i,"_placeholder",n),o=x(i,"_label",n);switch(e.which){case 1:if((!T(i,"._gui, ._phantom",n)||x(i,"_attribute_value",n))&&this.$gui_root.on("mousemove.wed",this._mousemoveHandler.bind(this)),r?this.setGUICaret(r,0):o?this._moveToNormalizedLabelPosition(i,o,t):this.setGUICaret(t),this._prev_sel_focus=void 0,e.target.classList.contains("wed-validation-error"))return!0;break;case 3:var a=this.getSelectionRange();(!a||a.collapsed)&&(r?this.setGUICaret(r,0):o?this._moveToNormalizedLabelPosition(i,o,t):this.setGUICaret(t))}return!1}),a.prototype._mouseupHandler=l.wrap(function(e){if(!u.pointInContents(this._scroller,e.pageX,e.pageY))return!1;var t=this._pointToCharBoundary(e.clientX,e.clientY);if(!t)return!0;"contextmenu"===e.type&&(e.which=3);var n=this.gui_root,i=e.target,r=x(i,"_placeholder",n),o=x(i,"_label",n);switch(e.which){case 3:r&&this.setGUICaret(i,0),o?(this._moveToNormalizedLabelPosition(i,o,t),s(i).trigger("wed-context-menu",[e])):(this._sel_focus||this.setGUICaret(t),T(i,"*[data-wed-custom-context-menu]",n)?s(i).trigger("wed-context-menu",[e]):this._contextMenuHandler(e))}return this.$gui_root.off("mousemove"),e.preventDefault(),!1}),a.prototype._mouseoverHandler=l.wrap(function(e){var t=this.gui_root,n=x(e.target,"_label",t);if(n){var i=this,r=x(n,"_real",t),o=h.getOriginalName(r),a={title:function(){return i.preferences.get("tooltips")?i.mode.shortDescriptionFor(o):void 0},container:"body",delay:{show:1e3},placement:"auto top",trigger:"hover"};w(s(n),a);var l=s.data(n,"bs.tooltip");l.enter(l)}}),a.prototype._mouseoutHandler=l.wrap(function(e){var t=this.gui_root,n=x(e.target,"_label",t);return n?(s(n).tooltip("destroy"),!1):void 0}),a.prototype._setupCompletionMenu=function(){this._dismissDropdownMenu();var e=this.getSelectionRange();if(e&&e.collapsed){var t=this.getGUICaret(),n=t.node,i=x(n,"_attribute_value",this.gui_root);if(i){if(u.isNotDisplayed(i,this.gui_root))return;var r=n.ownerDocument,o=this.getDataCaret(),a=o.node;if(o.offset!==a.value.length)return;var s=(this.mode,[]);if(this.validator.possibleAt(o.node,0).forEach(function(e){if("attributeValue"===e.params[0]&&"attributeValue"===e.params[0]){var t=e.params[1];if(t instanceof RegExp)return;s.push(t)}}),!s.length)return;for(var l,d=[],c=0;void 0!==(l=s[c]);++c)0===l.lastIndexOf(a.value,0)&&d.push(l);if(!d.length||1===d.length&&d[0]===a.value)return;var h=this.computeContextMenuPosition(void 0,!0);this._current_dropdown=new A.CompletionMenu(this,r,h.left,h.top,a.value,s,function(){this._current_dropdown=void 0}.bind(this))}}},a.prototype._positionFromGUIRoot=function(e){var t;if(e===this._fake_caret){if(t={left:+e.style.left.replace("px",""),top:+e.style.top.replace("px","")},isNaN(t.left)||isNaN(t.top))throw new Error("NAN for left or top");return t.left+=this.gui_root.scrollLeft,t.top+=this.gui_root.scrollTop,t}t=s(e).offset();var n=this.$gui_root.offset();return t.left-=n.left-this.gui_root.scrollLeft,t.top-=n.top-this.gui_root.scrollTop,t},a.prototype._dismissDropdownMenu=function(){this._current_dropdown&&this._current_dropdown.dismiss()},a.prototype.displayContextMenu=function(e,t,n,i,r){var o=Object.create(null);i=i.filter(function(e){var t=(e.action?e.action.getDescription():"")+"\x00";e.data&&(t+=e.data.name);var n=!o[t];return o[t]=!0,n&&r?!(e.action instanceof b.Transformation):n}),this._dismissDropdownMenu(),this.pushSelection(),this._current_dropdown=new e(this.doc,t,n,i,function(){this._current_dropdown=void 0,this.popSelection()}.bind(this))},a.prototype.displayTypeaheadPopup=function(e,t,n,i,r,o){return this._dismissDropdownMenu(),this.pushSelection(),this._current_typeahead=new v.TypeaheadPopup(this.doc,e,t,n,i,r,function(e){this._current_typeahead=void 0,this.popSelection(),o&&o(e)}.bind(this)),this._current_typeahead},a.prototype._refreshSaveStatus=l.wrap(function(){if(this._saver){var e=this._saver.getSavedWhen();if(this._$save_status.children("span").first().text(e),e){var t,n,i=this._saver.getLastSaveKind();switch(i){case d.AUTO:t="label-info",n="The last save was an autosave.";break;case d.MANUAL:t="label-success",n="The last save was a manual save.";break;default:throw new Error("unexpected kind of save: "+i)}this._$save_status.removeClass("label-default label-info label-success").addClass(t),this._$save_status.tooltip("destroy"),this._$save_status.tooltip({title:n,container:"body",placement:"auto top",trigger:"hover"})}else this._$save_status.removeClass("label-success label-info").addClass("label-default");var r=this._saver.getModifiedWhen();r!==!1?(this._$modification_status.removeClass("label-success"),this._$modification_status.addClass("label-warning"),this._$modification_status.children("i").css("visibility","")):(this._$modification_status.removeClass("label-warning"),this._$modification_status.addClass("label-success"),this._$modification_status.children("i").css("visibility","hidden"))}});var R={};R[c.INCOMPLETE]="stopped",R[c.WORKING]="working",R[c.INVALID]="invalid",R[c.VALID]="valid";var O={};O[c.INCOMPLETE]="info",O[c.WORKING]="info",O[c.INVALID]="danger",O[c.VALID]="success",a.prototype._onValidatorStateChange=function(e){var t=e.state,n=e.part_done;if(t===c.WORKING){if(n-this._last_done_shown<.05)return}else(t===c.VALID||t===c.INVALID)&&(this._processValidationErrors(),this._first_validation_complete||(this._first_validation_complete=!0,this._setCondition("first-validation-complete",{editor:this})));this._last_done_shown=n;var i=100*n>>0,r=this.validation_progress;r.style.width=i+"%",r.classList.remove("progress-bar-info","progress-bar-success","progress-bar-danger"),r.classList.add("progress-bar-"+O[t]),this.validation_message.textContent=R[t]},a.prototype._onValidatorError=function(e){this._validation_errors.push(e),this._process_validation_errors_timeout||(this._process_validation_errors_timeout=setTimeout(this._processValidationErrors.bind(this),this._process_validation_errors_delay))},a.prototype._refreshValidationErrors=function(){for(var e,t=this.widget.getElementsByClassName("wed-validation-error");void 0!==(e=t[0]);)e.parentNode.removeChild(e);this.$error_list.children("li").remove(),this._processed_validation_errors_up_to=-1,this._processValidationErrors()},a.prototype._onPossibleDueToWildcardChange=function(e){var t=i(this,e);t&&t.nodeType===Node.TEXT_NODE&&(t=x(t,"_attribute",this.gui_root)),t&&this.decorator.setReadOnly(t,e.wed_possible_due_to_wildcard)},a.prototype._processValidationErrors=function(){this._process_validation_errors_timeout&&(clearTimeout(this._process_validation_errors_timeout),this._process_validation_errors_timeout=void 0);var e=this._processed_validation_errors_up_to+1,t=this._validation_errors,n=t.length;if(!(e>=n)){"none"===this._$navigation_panel.css("display")&&this.$error_list.parents(".panel-collapse").collapse("show");for(var i=[];n>e;)i.push(this._processValidationError(t[e])),e++;this.$error_list.append(i),this._processed_validation_errors_up_to=e-1}},a.prototype._processValidationError=function(e){var t=e.error,n=e.node,i=e.index,o=r(this,n,i);o=this._normalizeCaretToEditableRange(o);var a=!1;if(p(n)){var d=o.node;d.nodeType===Node.TEXT_NODE&&(d=d.parentNode),u.isNotDisplayed(d,o.root)&&(a=!0)}for(var c,f=[],E=t.getNames(),m=0;c=E[m];++m){var A=c.toArray(),v="";if(null!==A){for(var F,g=[],C=0;F=A[C];++C)g.push(this.resolver.unresolveName(F.ns,F.name,t instanceof _.AttributeNameError||t instanceof _.AttributeValueError));v=g.join(" or ")}else v=h.convertPatternObj(c.toObject(),this.resolver);f.push(v)}var D,w=h.newGenericID();if(a)D=u.htmlToElements("<li>"+t.toStringWithNames(f)+"</li>",o.node.ownerDocument)[0],D.title="This error belongs to an attribute which is not currently displayed.";else{var B=u.htmlToElements("<span class='_phantom wed-validation-error'>&nbsp;</span>",o.node.ownerDocument)[0],b=s(B);b.mousedown(l.wrap(function(e){this.$error_list.parents(".panel-collapse").collapse("show");var t=this.$error_list.find("#"+w),n=this.$error_list.parent(".panel-body");return n.animate({scrollTop:t.offset().top-n.offset().top+n[0].scrollTop}),this.$widget.find(".wed-validation-error.selected").removeClass("selected"),s(e.currentTarget).addClass("selected"),t.siblings().removeClass("selected"),t.addClass("selected"),this.setGUICaret(o),!1}.bind(this)));var N=B.id=h.newGenericID(),x=y.boundaryXY(o),T=this._scroller.getBoundingClientRect();B.style.top=x.top-T.top+this._scroller.scrollTop+"px",B.style.left=x.left-T.left+this._scroller.scrollLeft+"px",this._$error_layer.append(b),D=u.htmlToElements("<li><a href='#"+N+"'>"+t.toStringWithNames(f)+"</a></li>",o.node.ownerDocument)[0],s(D.firstElementChild).click(this._errorItemHandler_bound)}return D.id=w,D},a.prototype._errorItemHandler=l.wrap(function(e){this.$widget.find(".wed-validation-error.selected").removeClass("selected");var t=document.querySelector(e.target.attributes.href.value);t.classList.add("selected");var n=s(e.target.parentNode);n.siblings().removeClass("selected"),n.addClass("selected")}),a.prototype._onResetErrors=function(e){if(0!==e.at)throw new Error("internal error: wed does not yet support resetting errors at an arbitrary location");this._validation_errors=[],this.$error_list.children("li").remove(),this.$widget.find(".wed-validation-error").remove()},a.prototype.setNavigationList=function(e){this._$navigation_list.empty(),this._$navigation_list.append(e),this._$navigation_panel.css("display","")},a.prototype.makeModal=function(e){var t=new E.Modal(e),n=t.getTopLevel();return n.on("show.bs.modal.modal",function(){this.pushSelection()}.bind(this)),n.on("hidden.bs.modal.modal",function(){this.popSelection()}.bind(this)),this.$widget.prepend(n),t},a.prototype.increaseLabelVisibilityLevel=function(){if(!(this._current_label_level>=this.max_label_level)){var e=this._caretPositionOnScreen();this._current_label_level++;for(var t=this.gui_root.getElementsByClassName("_label_level_"+this._current_label_level),n=0,i=t.length;i>n;n++)t[n].classList.remove("_invisible");if(this._refreshValidationErrors(),this._refreshFakeCaret(),e){var r=this._caretPositionOnScreen();this.gui_root.scrollTop-=e.top-r.top,this.gui_root.scrollLeft-=e.left-r.left}}},a.prototype.decreaseLabelVisiblityLevel=function(){if(this._current_label_level){var e=this._caretPositionOnScreen(),t=this._current_label_level;this._current_label_level--;for(var n=this.gui_root.getElementsByClassName("_label_level_"+t),i=0,r=n.length;r>i;i++)n[i].classList.add("_invisible");if(this._refreshValidationErrors(),this._refreshFakeCaret(),e){var o=this._caretPositionOnScreen();this.gui_root.scrollTop-=e.top-o.top,this.gui_root.scrollLeft-=e.left-o.left}}},a.prototype._closeAllTooltips=function(){for(var e,t=this.doc.querySelectorAll("div.tooltip"),n=!1,i=0;e=t[i];++i){var r=s.data(e,"wed-tooltip-for"),o=s(r).data("bs.tooltip");o&&(o.leave(o),n=!0)}return n}}),define("wed/wed",["require","exports","module","./wed_core","optional!./config","./util","./wed_init","./wed_caret","./wed_gui"],function(e,t,n){"use strict";var i=e("./wed_core"),r=e("optional!./config"),o=e("./util");i.module_config=o.grabConfig(n,r).config,e("./wed_init"),e("./wed_caret"),e("./wed_gui"),t.version=i.version,t.Editor=i.Editor}),define("wed/mode",["require","exports","module","./domutil","./lib/pubsub"],function(e,t,n){"use strict";function i(e){this._editor=void 0,this._options=e||{},this._wed_options={label_levels:{max:1,initial:1}}}var r=e("./domutil"),o=e("./lib/pubsub");i.prototype._ready=function(){o.publish(o.WED_MODE_READY,this)},i.prototype.init=function(e){this._editor=e},i.prototype.getWedOptions=function(){return this._wed_options},i.prototype.getAbsoluteResolver=function(){throw new Error("getAbsoluteResolver must be overriden.")},i.prototype.makeDecorator=function(){throw new Error("makeDecorator must be overriden.")},i.prototype.getContextualActions=function(e,t,n,i){throw new Error("getContextualActions must be overriden")},i.prototype.getStylesheets=function(){return[]},i.prototype.nodesAroundEditableContents=function(e){for(var t,n,i=null,r=null,o=e.firstChild,a=0;o;){if(o.nodeType===Node.ELEMENT_NODE&&(o.classList.contains("_start_wrapper")&&(t=a,i=o),o.classList.contains("_end_wrapper"))){n=a,r=o;break}o=o.nextSibling,a++}if(void 0!==t&&void 0!==n&&t>=n)throw new Error("end wrapper element unexpectedly appears before start wrapper element, or is also a start wrapper element");return[i,r]},i.prototype.makePlaceholderFor=function(e){return r.makePlaceholder()},i.prototype.shortDescriptionFor=function(e){},i.prototype.documentationLinkFor=function(e){},i.prototype.getValidator=function(){return null},t.Mode=i}),define("wed/decorator",["require","exports","module","./util","jquery","./domutil","./transformation","./gui/tooltip","./gui/action_context_menu","./dloc","lodash"],function(e,t,n){"use strict";function i(e,t,n){this._domlistener=e,this._editor=t,this._gui_updater=n}function r(e,t){try{e.setDataCaret(t,!0)}catch(n){}}var o=e("./util"),a=e("jquery"),s=e("./domutil"),l=s.indexOf,d=s.closestByClass,c=(e("./transformation"),e("./gui/tooltip").tooltip,e("./gui/action_context_menu")),h=e("./dloc");e("lodash");t.Decorator=i,i.prototype.addHandlers=function(){this._domlistener.addHandler("added-element","._real, ._phantom, ._phantom_wrap",this.contentEditableHandler.bind(this))},i.prototype.startListening=function(e){this._domlistener.startListening()},i.prototype.listDecorator=function(e,t){for(var n={},i=e.firstElementChild;i;)i.classList.contains("_real")&&(n[o.getOriginalName(i)]=1),i=i.nextElementSibling;var r=Object.keys(n);if(r.length>1)throw new Error("calling listDecorator on a non-homogeneous list.");if(0!==r.length){for(i=e.firstElementChild;i;){var a=i.nextElementSibling;i.hasAttribute("data-wed--separator-for")&&this._gui_updater.removeNode(i),i=a}var s,l=r[0];"string"==typeof t?(s=e.ownerDocument.createElement("div"),s.appendChild(e.ownerDocument.createTextNode(t))):s=t,s.classList.add("_text"),s.classList.add("_phantom"),s.setAttribute("data-wed--separator-for",l);var d=!0;for(i=e.firstElementChild;i;)i.classList.contains("_real")&&(d?d=!1:this._gui_updater.insertBefore(e,s.cloneNode(!0),i)),i=i.nextElementSibling}},i.prototype.contentEditableHandler=function(e,t,n,i,r){function o(e){e.setAttribute("tabindex","-1"),e.setAttribute("contenteditable",e.classList.contains("_real")||a&&e.classList.contains("_attribute_value"));for(var t=e.firstElementChild;t;)o(t),t=t.nextElementSibling}var a="edit"===this._editor.attributes;o(r)},i.prototype.elementDecorator=function(e,t,n,i,l){if(n>this._editor.max_label_level)throw new Error("level higher than the maximum set by the mode: "+n);var d=this._editor.getDataCaret();!d||d.node instanceof this._editor.my_window.Attr&&d.node.ownerElement===a.data(t,"wed_mirror_node")||(d=void 0);var c=a.data(t,"wed_mirror_node");this.setReadOnly(t,c.wed_possible_due_to_wildcard);var h,u,p=o.getOriginalName(t),_="_"+p+"_label",f=s.childrenByClass(t,_);for(h=0;u=f[h];++h)t.removeChild(u);var E=[];if("show"===this._editor.attributes||"edit"===this._editor.attributes){var m,A=o.getOriginalAttributes(t),v=Object.keys(A).sort();for(h=0;m=v[h];++h)E.push(['<span class="_phantom _attribute">','<span class="_phantom _attribute_name">',m,'</span>="<span class="_phantom _attribute_value">',s.textToHTML(A[m]),'</span>"</span>'].join(""))}var F=(E.length?" ":"")+E.join(" "),g=t.ownerDocument;_+=" _label_level_"+n;var C=g.createElement("span");C.className="_gui _phantom __start_label _start_wrapper "+_+" _label";var D=g.createElement("span");D.className="_phantom",D.innerHTML="&nbsp;<span class='_phantom _element_name'>"+p+"</span>"+F+" >&nbsp;",C.appendChild(D),this._gui_updater.insertNodeAt(t,0,C);var y=g.createElement("span");y.className="_gui _phantom __end_label _end_wrapper "+_+" _label";var w=g.createElement("span");w.className="_phantom",w.innerHTML="&nbsp;&lt; <span class='_phantom _element_name'>"+p+"</span>&nbsp;",y.appendChild(w),this._gui_updater.insertBefore(t,y,null);var B=a(C),b=a(y);void 0!==i?B.on("wed-context-menu",i):B.on("wed-context-menu",!1),void 0!==l?b.on("wed-context-menu",l):b.on("wed-context-menu",!1),d&&r(this._editor,d)},i.prototype.setReadOnly=function(e,t){var n=e.classList;(t?n.add:n.remove).call(n,"_readonly")},i.prototype._contextMenuHandler=function(e,t,n){function i(e,t,n){var i=m._makeMenuItemForAction(t,e),r=i.getElementsByTagName("a")[0],o=g.createTextNode(C[n]);r.appendChild(o),r.normalize(),v.push({action:t,item:i,data:e})}function r(e,t){if(e.params[1].simple())for(var n,r=e.params[1].toArray(),o=0;n=r[o];++o){var a=m.resolver.unresolveName(n.ns,n.name);if(m.isAttrProtected(a,t))return;var s=F.getContextualActions("add-attribute",a,t);if(void 0===s)return;for(var l,d=0;void 0!==(l=s[d]);++d)i({name:a,node:t},l)}else i(void 0,m.complex_pattern_action)}var s,u,p,_,f,E,m=this._editor,A=t.target,v=[],F=m.mode,g=A.ownerDocument,C={undefined:"","true":" before this element","false":" after this element"},D=d(A,"_real",m.gui_root),y=D&&D.classList.contains("_readonly"),w=d(A,"_attribute_value",m.gui_root);if(w){var B=m.toDataNode(w),b=B.ownerElement;f=b.parentNode;var N=l(f.childNodes,b);E=h.makeDLoc(m.data_root,f,N),m.validator.possibleAt(E,!0).forEach(function(e){if("attributeName"===e.params[0]){var t=E.node.childNodes[E.offset];r(e,t)}}.bind(this));var x=B.name;if(!m.isAttrProtected(B)){if(u=F.getContextualActions("delete-attribute",x,B),void 0===u)return;for(p=0,_;void 0!==(_=u[p]);++p)i({name:x,node:B},_)}}else{A=d(A,"_real",m.gui_root);var T=A.parentNode===m.gui_root,k=o.getOriginalName(A),S=this._editor.mode.documentationLinkFor(k);S&&(s=g.createElement("li"),s.appendChild(this._editor.makeDocumentationLink(S)),v.push({action:null,item:s,data:null})),T||(u=F.getContextualActions(["unwrap","delete-element"],k,a.data(A,"wed_mirror_node"),0),void 0!==u&&u.forEach(function(e){i({node:A,name:k},e,void 0)}.bind(this))),f=A.parentNode;var R=l(f.childNodes,A);if(e||R++,E=m.toDataLocation(f,R),e&&"edit"===m.attributes&&m.validator.possibleAt(E,!0).forEach(function(e){if("attributeName"===e.params[0]){var t=E.node.childNodes[E.offset];r(e,t)}}.bind(this)),!T)for(u=m.getElementTransformationsAt(E),p=0;_=u[p];++p)void 0!==_.name?i({name:_.name,move_caret_to:E},_.tr,e):i(void 0,_.tr)}if(0===v.length)return!0;var O=m.computeContextMenuPosition(n);return m.displayContextMenu(c.ContextMenu,O.left,O.top,v,y),!1}}),define("wed/modes/generic/generic_decorator",["require","exports","module","wed/decorator","wed/oop","wed/util","wed/log"],function(e,t,n){"use strict";function i(e,t,n){r.apply(this,Array.prototype.slice.call(arguments,3)),this._mode=e,this._meta=t,this._options=n}var r=e("wed/decorator").Decorator,o=e("wed/oop"),a=e("wed/util"),s=e("wed/log");o.inherit(i,r),i.prototype.addHandlers=function(){this._domlistener.addHandler("included-element",a.classFromOriginalName("*"),function(e,t,n,i,r,o){if(e.contains(o)){this.elementDecorator(e,o);var a=this._meta.getAdditionalClasses(o);a.length>0&&(o.className+=" "+a)}}.bind(this)),this._domlistener.addHandler("children-changed",a.classFromOriginalName("*"),function(e,t,n,i,r,o){for(var a=t.concat(n),s=!1,l=0,d=a.length;!s&&d>l;++l){var c=a[l];s=c.nodeType===Node.TEXT_NODE||c.classList.contains("_real")||c.classList.contains("_phantom_wrap")}s&&this.elementDecorator(e,o)}.bind(this)),this._domlistener.addHandler("text-changed",a.classFromOriginalName("*"),function(e,t){this.elementDecorator(e,t.parentNode)}.bind(this)),this._domlistener.addHandler("attribute-changed",a.classFromOriginalName("*"),function(e,t){this.elementDecorator(e,t)}.bind(this)),r.prototype.addHandlers.call(this)},i.prototype.elementDecorator=function(e,t){r.prototype.elementDecorator.call(this,e,t,1,s.wrap(this._contextMenuHandler.bind(this,!0)),s.wrap(this._contextMenuHandler.bind(this,!1)))},t.GenericDecorator=i}),define("wed/modes/generic/generic_tr",["require","exports","module","salve/validate","wed/dloc","wed/gui/icon","wed/util","wed/domutil","wed/transformation"],function(e,t,n){"use strict";function i(e){var t={};return t.insert=new u(e,"insert","Create new <name>","",function(e,t){var n=e.getDataCaret(),i=e.mode.getAbsoluteResolver(),r=i.resolveName(t.name),a=e.validator._getWalkerAt(n.node,n.offset,!1),s=a.unresolveName(r.ns,r.name),l=h(e.data_updater,n.node,n.offset,r.ns,t.name);
if(!s){var d=i.prefixFromURI(r.ns),c=""===d?"xmlns":"xmlns:"+d,u=i.resolveName("xmlns:q").ns;e.data_updater.setAttributeNS(l,u,c,r.ns)}if(e.mode._options.autoinsert)for(o(l,e);l;){var p=l.firstChild;if(!p)break;l=p}e.setDataCaret(l,0)}),t.unwrap=new u(e,"unwrap","Unwrap the content of this element",void 0,function(e,t){var n=t.node.parentNode,i=d(n.childNodes,t.node);p(e.data_updater,t.node),e.setDataCaret(n,i)}),t.wrap=new u(e,"wrap","Wrap in <name>",void 0,function(e,t){var n=e.getSelectionRange();if(!n)throw new Error("wrap transformation called with undefined range");if(n.collapsed)throw new Error("wrap transformation called with collapsed range");var i=e.toDataLocation(n.startContainer,n.startOffset),r=e.toDataLocation(n.endContainer,n.endOffset),o=e.mode.getAbsoluteResolver().resolveName(t.name),a=c.wrapInElement(e.data_updater,i.node,i.offset,r.node,r.offset,o.ns,t.name),s=a.parentNode;e.setDataCaret(s,d(s.childNodes,a)+1)}),t["delete-element"]=new u(e,"delete-element","Delete this element",void 0,function(e,t){var n=t.node,i=n.parentNode,r=d(i.childNodes,n),o=e.fromDataLocation(n,0);o.node.classList.contains("_readonly")||(e.data_updater.removeNode(n),e.setDataCaret(i,r))}),t["delete-parent"]=new u(e,"delete-parent","Delete <name>",void 0,function(e,t){var n=t.node,i=n.parentNode,r=d(i.childNodes,n),o=e.fromDataLocation(n,0);o.node.classList.contains("_readonly")||(e.data_updater.removeNode(n),e.setDataCaret(i,r))}),t["add-attribute"]=new u(e,"add-attribute","Add @<name>",void 0,function(e,t){var n=t.node,i=e.fromDataLocation(n,0);if(!i.node.classList.contains("_readonly")){e.data_updater.setAttribute(n,t.name,"");var r=n.getAttributeNode(t.name);e.setDataCaret(r,0)}}),t["delete-attribute"]=new u(e,"delete-attribute","Delete this attribute",void 0,function(e,t){var n=t.node,i=n.ownerElement,r=e.fromDataLocation(i,0),o=r.node;if(!o.classList.contains("_readonly")){var a=n.name,s=l.childByClass(o,"__start_label"),c=s.getElementsByClassName("_attribute_value"),h=e.fromDataLocation(n,0).node.parentNode,u=d(c,h),p=c[u+1],_=p&&e.toDataNode(p);e.data_updater.setAttribute(i,a,null),_?e.setDataCaret(_,0):e.setGUICaret(r.node.getElementsByClassName("_element_name")[0],0)}}),t["insert-text"]=new u(e,"insert-text",'Insert "<name>"',void 0,function(e,t){e.type(t.name)}),t}function r(e){var t=e.error.toString();return 0===t.lastIndexOf("tag required: ",0)}function o(e,t){for(;;){var n=t.validator.getErrorsFor(e);if(n=n.filter(r),0===n.length)break;var i=n[0].error.getNames()[0],o=t.validator.possibleWhere(e,new a.Event("enterStartTag",i.ns,i.name));if(1!==o.length)break;var l=t.resolver.unresolveName(i.ns,i.name),d=t.mode.getContextualActions("insert",l,e,o[0]);if(1!==d.length)break;if(d[0].needs_input)break;t.setDataCaret(s.makeDLoc(s.getRoot(e),e,o[0])),d[0].execute({name:l})}}var a=e("salve/validate"),s=e("wed/dloc"),l=(e("wed/gui/icon"),e("wed/util"),e("wed/domutil")),d=l.indexOf,c=e("wed/transformation"),h=c.insertElement,u=c.Transformation,p=c.unwrap;t.makeTagTr=i}),define("wed/modes/generic/generic_meta",["require","exports","module","jquery","../../log","../../lib/pubsub"],function(e,t,n){"use strict";function i(e){this._options=e||{},this._desc_map=void 0,this._namespace_mappings=void 0,this._resolveOptions()}var r=e("jquery"),o=e("../../log"),a=e("../../lib/pubsub"),s=a.makeTopic("wed.modes.generic.meta.ready");i.prototype._ready=function(){a.publish(s,this)},i.prototype._resolveOptions=function(){var t=this._options,n=r.extend(!0,{},t);t&&t.metadata?r.ajax({type:"GET",url:e.toUrl(t.metadata),success:o.wrap(function(e){n.metadata=e,this._options=n,this._afterResolved()}.bind(this)),dataType:"json"}).fail(o.wrap(function(e,t,n){throw new Error("cannot load metadata; status: "+t+" error thrown: "+n)})):this._afterResolved()},i.prototype._afterResolved=function(){if(this._metadata=this._options.metadata,this._metadata){if(1!=this._metadata.version)throw new Error("unexpected version number: "+this._metadata.version);if(this._namespace_mappings=this._metadata.namespaces,"xml"in this._namespace_mappings)throw new Error("xml mapping already defined");this._namespace_mappings.xml="http://www.w3.org/XML/1998/namespace",this._reverse_mapping=Object.create(null);for(var e in this._namespace_mappings){var t=this._namespace_mappings[e];this._reverse_mapping[t]||(this._reverse_mapping[t]=e)}this._reverse_mapping[this._namespace_mappings[""]]="";var n=this._metadata.elements,i=Object.create(null),r=this;n.forEach(function(e){var t=e.ns||"http://www.tei-c.org/ns/1.0",n=r._reverse_mapping[t];if(void 0===n)throw new Error("undefined namespace: "+t);var o=""===n?e.name:n+":"+e.name;i[o]=e.desc}),this._desc_map=i}this._ready()},i.prototype.isInline=function(e){return!1},i.prototype.getAdditionalClasses=function(e){var t=[];return this.isInline(e)&&t.push("_inline"),t.join(" ")},i.prototype.getNamespaceMappings=function(){return this._namespace_mappings},i.prototype.shortDescriptionFor=function(e){return this._desc_map&&this._desc_map[e]},i.prototype.documentationLinkFor=function(t){if(this._metadata){var n=this._metadata.dochtml;return t=t.replace(":","_"),e.toUrl(n+"ref-"+t+".html")}},t.Meta=i}),define("wed/modes/generic/generic",["require","exports","module","../../mode","salve/name_resolver","../../oop","./generic_decorator","./generic_tr","jquery","../../lib/pubsub","../../object_check","./generic_meta"],function(e,t,n){"use strict";function i(e){r.apply(this,arguments),this.constructor===i&&(this._wed_options.metadata={name:"Generic",authors:["Louis-Dominique Dubeau"],description:"This is a basic mode bundled with wed and which can, and probably should be used as the base for other modes.",license:"MPL 2.0",copyright:"2013, 2014 Mangalam Research Center for Buddhist Languages"});var t={meta:!0,autoinsert:!1},n=h.check(t,this._options);void 0===this._options.autoinsert&&(this._options.autoinsert=!0);var o=[];if(n.missing&&n.missing.forEach(function(e){o.push("missing option: "+e)}),n.extra&&n.extra.forEach(function(e){o.push("extra option: "+e)}),o.length)throw new Error("incorrect options: "+o.join(", "));this._wed_options.attributes="edit",this._resolveOptions()}var r=e("../../mode").Mode,o=e("salve/name_resolver"),a=e("../../oop"),s=e("./generic_decorator").GenericDecorator,l=e("./generic_tr").makeTagTr,d=e("jquery"),c=e("../../lib/pubsub"),h=e("../../object_check");e("./generic_meta"),a.inherit(i,r),i.prototype._resolveOptions=function(){var t=this._options,n=d.extend(!0,{},t);if(t&&t.meta){var i=n.meta;if("string"==typeof i)i=n.meta={path:i};else if("object"!=typeof i.path)return void e([i.path],function(e){n.meta.path=e,this._options=n,this._afterResolved()}.bind(this))}this._afterResolved()},i.prototype._afterResolved=function(){var e=this._options.meta.path.Meta,t=function(e,t){if(this._meta===t){this._resolver=new o.NameResolver;var n=this._meta.getNamespaceMappings();Object.keys(n).forEach(function(e){this._resolver.definePrefix(e,n[e])}.bind(this)),this._ready()}}.bind(this);c.subscribe(c.WED_MODES_GENERIC_META_READY,t),this._meta=new e(this._options.meta.options)},i.prototype.init=function(e){r.prototype.init.call(this,e),this._tag_tr=l(e)},i.prototype.getAbsoluteResolver=function(){return this._resolver},i.prototype.makeDecorator=function(){var e=Object.create(s.prototype),t=Array.prototype.slice.call(arguments);return t=[this,this._meta,this._options].concat(t),s.apply(e,t),e},i.prototype.shortDescriptionFor=function(e){return this._meta.shortDescriptionFor(e)},r.prototype.documentationLinkFor=function(e){return this._meta.documentationLinkFor(e)},r.prototype.getContextualActions=function(e,t,n,i){e instanceof Array||(e=[e]);for(var r=[],o=0;o<e.length;o++){var a=this._tag_tr[e[o]];void 0!==a&&r.push(a)}return r},t.Mode=i}),define("wed/modes/generic/metas/tei_meta",["require","exports","module","wed/oop","wed/util","wed/modes/generic/generic_meta"],function(e,t,n){"use strict";function i(e){a.apply(this,arguments),this._namespace_mappings||(this._namespace_mappings=Object.create(null),this._namespace_mappings.xml="http://www.w3.org/XML/1998/namespace",this._namespace_mappings[""]="http://www.tei-c.org/ns/1.0")}var r=e("wed/oop"),o=e("wed/util"),a=e("wed/modes/generic/generic_meta").Meta;r.inherit(i,a),i.prototype.isInline=function(e){var t=o.getOriginalName(e),n=t.split(":");1===n.length&&(n[1]=n[0],n[0]="tei");var i=n.join(":");switch(i){case"tei:note":case"mml:math":case"tei:abbr":case"tei:affiliation":case"tei:altIdentifier":case"tei:analytic":case"tei:add":case"tei:am":case"tei:att":case"tei:author":return!0}switch(i){case"tei:biblScope":case"tei:br":case"tei:byline":case"tei:c":case"tei:caesura":case"tei:choice":case"tei:code":case"tei:collection":case"tei:country":case"tei:damage":case"tei:date":case"tei:del":case"tei:depth":case"tei:dim":case"tei:dimensions":case"tei:editor":case"tei:editionStmt":case"tei:emph":case"tei:ex":case"tei:expan":return!0}switch(i){case"tei:figure":case"tei:floatingText":return!1;case"tei:foreign":case"tei:forename":case"tei:gap":case"tei:genName":case"tei:geogName":case"tei:gi":case"tei:gloss":case"tei:graphic":case"tei:height":case"tei:hi":case"tei:ident":case"tei:idno":case"tei:imprint":case"tei:institution":return!0}switch(i){case"tei:list":return!1;case"tei:locus":case"tei:mentioned":case"tei:monogr":case"tei:series":case"tei:msName":case"tei:name":case"tei:num":case"tei:orgName":case"tei:orig":case"tei:origDate":case"tei:origPlace":case"tei:pc":case"tei:persName":case"tei:placeName":case"tei:ptr":case"tei:publisher":case"tei:pubPlace":return!0}switch(i){case"tei:q":case"tei:quote":case"tei:ref":case"tei:region":case"tei:repository":case"tei:roleName":case"tei:rubric":case"tei:said":case"tei:seg":case"tei:sic":case"tei:settlement":case"tei:soCalled":case"tei:summary":case"tei:supplied":case"tei:surname":case"tei:tag":case"tei:term":case"tei:textLang":case"tei:title":case"tei:unclear":case"tei:val":case"tei:width":case"tei:dynamicContent":case"w:drawing":case"m:oMath":return!0}return!1},t.Meta=i});