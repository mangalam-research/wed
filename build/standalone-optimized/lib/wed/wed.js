/**
 * @module log
 * @desc Logging facilities
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */

/**
 * Typeguards to facilitate working with TypeScript and the DOM.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Utilities that manipulate or query the DOM tree.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @module oop
 * @desc Object-oriented programming utilities.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
     * Basic undo/redo framework.
     * @author Louis-Dominique Dubeau
     * @license MPL 2.0
     * @copyright Mangalam Research Center for Buddhist Languages
     */

/**
 * Wed-specific undo functionality.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @module lib/simple_event_emitter
 * @desc A mixin class for objects that can emit events.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @module lib/conditioned
 * @desc A mixin class for objects that have conditions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Exceptions for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @module onerror
 * @desc The error handler for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Model for a GUI root.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Checks whether an object conforms to a template.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
  @license
                                 Apache License
                         Version 2.0, January 2004
                      http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

    "License" shall mean the terms and conditions for use, reproduction,
    and distribution as defined by Sections 1 through 9 of this document.

    "Licensor" shall mean the copyright owner or entity authorized by
    the copyright owner that is granting the License.

    "Legal Entity" shall mean the union of the acting entity and all
    other entities that control, are controlled by, or are under common
    control with that entity. For the purposes of this definition,
    "control" means (i) the power, direct or indirect, to cause the
    direction or management of such entity, whether by contract or
    otherwise, or (ii) ownership of fifty percent (50%) or more of the
    outstanding shares, or (iii) beneficial ownership of such entity.

    "You" (or "Your") shall mean an individual or Legal Entity
    exercising permissions granted by this License.

    "Source" form shall mean the preferred form for making modifications,
    including but not limited to software source code, documentation
    source, and configuration files.

    "Object" form shall mean any form resulting from mechanical
    transformation or translation of a Source form, including but
    not limited to compiled object code, generated documentation,
    and conversions to other media types.

    "Work" shall mean the work of authorship, whether in Source or
    Object form, made available under the License, as indicated by a
    copyright notice that is included in or attached to the work
    (an example is provided in the Appendix below).

    "Derivative Works" shall mean any work, whether in Source or Object
    form, that is based on (or derived from) the Work and for which the
    editorial revisions, annotations, elaborations, or other modifications
    represent, as a whole, an original work of authorship. For the purposes
    of this License, Derivative Works shall not include works that remain
    separable from, or merely link (or bind by name) to the interfaces of,
    the Work and Derivative Works thereof.

    "Contribution" shall mean any work of authorship, including
    the original version of the Work and any modifications or additions
    to that Work or Derivative Works thereof, that is intentionally
    submitted to Licensor for inclusion in the Work by the copyright owner
    or by an individual or Legal Entity authorized to submit on behalf of
    the copyright owner. For the purposes of this definition, "submitted"
    means any form of electronic, verbal, or written communication sent
    to the Licensor or its representatives, including but not limited to
    communication on electronic mailing lists, source code control systems,
    and issue tracking systems that are managed by, or on behalf of, the
    Licensor for the purpose of discussing and improving the Work, but
    excluding communication that is conspicuously marked or otherwise
    designated in writing by the copyright owner as "Not a Contribution."

    "Contributor" shall mean Licensor and any individual or Legal Entity
    on behalf of whom a Contribution has been received by Licensor and
    subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    copyright license to reproduce, prepare Derivative Works of,
    publicly display, publicly perform, sublicense, and distribute the
    Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    (except as stated in this section) patent license to make, have made,
    use, offer to sell, sell, import, and otherwise transfer the Work,
    where such license applies only to those patent claims licensable
    by such Contributor that are necessarily infringed by their
    Contribution(s) alone or by combination of their Contribution(s)
    with the Work to which such Contribution(s) was submitted. If You
    institute patent litigation against any entity (including a
    cross-claim or counterclaim in a lawsuit) alleging that the Work
    or a Contribution incorporated within the Work constitutes direct
    or contributory patent infringement, then any patent licenses
    granted to You under this License for that Work shall terminate
    as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
    Work or Derivative Works thereof in any medium, with or without
    modifications, and in Source or Object form, provided that You
    meet the following conditions:

    (a) You must give any other recipients of the Work or
        Derivative Works a copy of this License; and

    (b) You must cause any modified files to carry prominent notices
        stating that You changed the files; and

    (c) You must retain, in the Source form of any Derivative Works
        that You distribute, all copyright, patent, trademark, and
        attribution notices from the Source form of the Work,
        excluding those notices that do not pertain to any part of
        the Derivative Works; and

    (d) If the Work includes a "NOTICE" text file as part of its
        distribution, then any Derivative Works that You distribute must
        include a readable copy of the attribution notices contained
        within such NOTICE file, excluding those notices that do not
        pertain to any part of the Derivative Works, in at least one
        of the following places: within a NOTICE text file distributed
        as part of the Derivative Works; within the Source form or
        documentation, if provided along with the Derivative Works; or,
        within a display generated by the Derivative Works, if and
        wherever such third-party notices normally appear. The contents
        of the NOTICE file are for informational purposes only and
        do not modify the License. You may add Your own attribution
        notices within Derivative Works that You distribute, alongside
        or as an addendum to the NOTICE text from the Work, provided
        that such additional attribution notices cannot be construed
        as modifying the License.

    You may add Your own copyright statement to Your modifications and
    may provide additional or different license terms and conditions
    for use, reproduction, or distribution of Your modifications, or
    for any such Derivative Works as a whole, provided Your use,
    reproduction, and distribution of the Work otherwise complies with
    the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
    any Contribution intentionally submitted for inclusion in the Work
    by You to the Licensor shall be under the terms and conditions of
    this License, without any additional terms or conditions.
    Notwithstanding the above, nothing herein shall supersede or modify
    the terms of any separate license agreement you may have executed
    with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
    names, trademarks, service marks, or product names of the Licensor,
    except as required for reasonable and customary use in describing the
    origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
    agreed to in writing, Licensor provides the Work (and each
    Contributor provides its Contributions) on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
    implied, including, without limitation, any warranties or conditions
    of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
    PARTICULAR PURPOSE. You are solely responsible for determining the
    appropriateness of using or redistributing the Work and assume any
    risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
    whether in tort (including negligence), contract, or otherwise,
    unless required by applicable law (such as deliberate and grossly
    negligent acts) or agreed to in writing, shall any Contributor be
    liable to You for damages, including any direct, indirect, special,
    incidental, or consequential damages of any character arising as a
    result of this License or out of the use or inability to use the
    Work (including but not limited to damages for loss of goodwill,
    work stoppage, computer failure or malfunction, or any and all
    other commercial damages or losses), even if such Contributor
    has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
    the Work or Derivative Works thereof, You may choose to offer,
    and charge a fee for, acceptance of support, warranty, indemnity,
    or other liability obligations and/or rights consistent with this
    License. However, in accepting such obligations, You may act only
    on Your own behalf and on Your sole responsibility, not on behalf
    of any other Contributor, and only if You agree to indemnify,
    defend, and hold each Contributor harmless for any liability
    incurred by, or claims asserted against, such Contributor by reason
    of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

    To apply the Apache License to your work, attach the following
    boilerplate notice, with the fields enclosed by brackets "[]"
    replaced with your own identifying information. (Don't include
    the brackets!)  The text should be enclosed in the appropriate
    comment syntax for the file format. We also recommend that a
    file or class name and description of purpose be included on the
    same "printed page" as the copyright notice for easier
    identification within third-party archives.

 Copyright 2015-2016 Netflix, Inc., Microsoft Corp. and contributors

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 **/

/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */

/**
 * Browser detection. Extremely ad hoc and meant for wed's internal purposes
 * only.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * An XML serializer for platforms that produce erratic results.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Base class for savers.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Data saving functionality, using Ajax.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Data saving functionality, using localforage. Note that this saver is mainly
 * designed for demonstration purposes.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Data saving functionality, using IndexedDB. Note that this saver is mainly
 * designed for demonstration purposes.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Facility for updating a DOM tree and issue synchronous events on changes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Convertion from XML to HTML.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Listens to changes on a tree and updates the GUI tree in response to changes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Listens to changes on a tree and records undo operations corresponding to
 * these changes.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Listener for DOM tree changes.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Classes that model RNG patterns.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Validation errors.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Implements a name resolver for handling namespace changes in XML.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Class for XML Expanded Names.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Errors that can be raised during parsing of types.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Common tools for salve.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Implementations of some simple collections. This module is meant for salve's
 * internal purposes only. It may be yanked at any time. Do not use in your own
 * code.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 * @private
 */

/**
 * Classes that model datatypes used in RNG schemas.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 *
 */

/**
 * Collection of constants that model the way XML refers to various
 * characters and groups of characters. This module is essentially private to
 * salve.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Naive set implementation.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 * @private
 */

/**
 * This module contains data and utilities to work with the schema format that
 * salve uses natively.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Implementation of the builtin Relax NG datatype library.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Implementation of the XMLSchema datatypes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``attribute`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``choice`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``data`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``element`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``group`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``list`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern for RNG's ``param`` element.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * A mock implementation of Node's util package. This module implements only
 * what is actually used in salve.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * RNG-based validator.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/*!
 * XRegExp.build 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2012-2016 MIT License
 * Inspired by Lea Verou's RegExp.create <lea.verou.me>
 */

/*!
 * XRegExp.matchRecursive 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2009-2016 MIT License
 */

/*!
 * XRegExp Unicode Base 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2008-2016 MIT License
 */

/*!
 * XRegExp Unicode Blocks 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2010-2016 MIT License
 * Unicode data by Mathias Bynens <mathiasbynens.be>
 */

/*!
 * XRegExp Unicode Categories 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2010-2016 MIT License
 * Unicode data by Mathias Bynens <mathiasbynens.be>
 */

/*!
 * XRegExp Unicode Properties 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2012-2016 MIT License
 * Unicode data by Mathias Bynens <mathiasbynens.be>
 */

/*!
 * XRegExp Unicode Scripts 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2010-2016 MIT License
 * Unicode data by Mathias Bynens <mathiasbynens.be>
 */

/*!
 * XRegExp 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2007-2016 MIT License
 */

/**
 * A listener class.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Main module of salve-dom.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * This module is responsible for validating the document being edited in wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Task abstraction for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Controller managing the validation logic of a wed editor.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
     * The icons used by the user interface.
     * @author Louis-Dominique Dubeau
     * @license MPL 2.0
     * @copyright Mangalam Research Center for Buddhist Languages
     */

/**
 * Editing actions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Transformation framework.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @module onbeforeunload
 * @desc The onbeforeunload handler for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright 2016 Louis-Dominique Dubeau
 */

/**
 * An execution runtime for editors.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * This module implements the "caret mark". The "caret mark" is the graphical
 * indicator showing the position of the caret.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Library of caret movement computations.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Layers over the editing area.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Specialized layer for error markers.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Content scroller.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
 * Module implementing an class that describes keyboard keys.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Keys that wed uses, as constants.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Context menus.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @module gui/typeahead_popup
 * @desc Support for a typeahead field that pops up in the editing pane.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Tooltips for elements that appear in the editor pane.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @module wed
 * @desc The main module for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
     * The base types for modes.
     *
     * @author Louis-Dominique Dubeau
     * @license MPL 2.0
     * @copyright Mangalam Research Center for Buddhist Languages
     */

/**
 * Basic decoration facilities.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
     * Transformation registry for the generic mode.
     * @author Louis-Dominique Dubeau
     * @license MPL 2.0
     * @copyright Mangalam Research Center for Buddhist Languages
     */

/**
 * Reading facilities common to all readers that read specific versions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Facilities for interpreting the patterns passed in dochtml in
 * metadata files.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Reading facilities that allow reading different versions of a metadata file.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * The main module for the generic mode.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

define("wed/log",["require","exports","module","log4javascript"],function(e,t){"use strict";function r(){p.show()}function n(e){this.original=e}function i(e){return e instanceof n?e:(d.fatal("Unhandled exception",e),"undefined"!=typeof console&&(console.log(e),console.log(e.stack)),new n(e))}function o(e){throw i(e)}function a(e){return function(){try{return e.apply(this,arguments)}catch(t){o(t)}}}function s(e,t){var r=new c.AjaxAppender(e);r.setThreshold(c.Level.ALL);var n=new c.XmlLayout;r.setLayout(n),t&&Object.keys(t).forEach(function(e){r.addHeader(e,t[e])}),h.addAppender(r),d.info("Ajax appender initialized"),f.push(r)}function u(){for(var e=0;e<f.length;++e){var t=f[e];t.sendAll(),h.removeAppender(t)}}function l(){for(var e=0;e<f.length;++e)f[e].sendAll()}var c=e("log4javascript");c.setShowStackTraces(!0);var h=c.getLogger("wed");h.setLevel(c.Level.ALL);var d=c.getLogger("wed.common");d.setLevel(c.Level.ALL);var p=new c.PopUpAppender(!0);p.setThreshold(c.Level.ERROR),p.setInitiallyMinimized(!0),p.setNewestMessageAtTop(!0),d.addAppender(p),t.trace=d.trace.bind(d),t.debug=d.debug.bind(d),t.info=d.info.bind(d),t.warn=d.warn.bind(d),t.error=d.error.bind(d),t.fatal=d.fatal.bind(d),t.showPopup=r,t.unhandled=i,t.handle=o,t.wrap=a;var f=[];t.addURL=s,t.clearAppenders=u,t.flush=l}),function(e,t){"function"==typeof define&&define.amd?define("rangy",e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){function e(e,t){var r=typeof e[t];return r==b||!(r!=_||!e[t])||"unknown"==r}function t(e,t){return!(typeof e[t]!=_||!e[t])}function r(e,t){return typeof e[t]!=w}function n(e){return function(t,r){for(var n=r.length;n--;)if(!e(t,r[n]))return!1;return!0}}function i(e){return e&&C(e,S)&&P(e,N)}function o(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function a(t){typeof console!=w&&e(console,"log")&&console.log(t)}function s(e,t){O&&t?alert(e):a(e)}function u(e){R.initialized=!0,R.supported=!1,s("Rangy is not supported in this environment. Reason: "+e,R.config.alertOnFail)}function l(e){s("Rangy warning: "+e,R.config.alertOnWarn)}function c(e){return e.message||e.description||String(e)}function h(){if(O&&!R.initialized){var t,r=!1,n=!1;e(document,"createRange")&&(t=document.createRange(),C(t,x)&&P(t,E)&&(r=!0));var s=o(document);if(!s||"body"!=s.nodeName.toLowerCase())return void u("No body element found");if(s&&e(s,"createTextRange")&&(t=s.createTextRange(),i(t)&&(n=!0)),!r&&!n)return void u("Neither Range nor TextRange are available");R.initialized=!0,R.features={implementsDomRange:r,implementsTextRange:n};var l,h;for(var d in A)(l=A[d])instanceof m&&l.init(l,R);for(var p=0,f=M.length;f>p;++p)try{M[p](R)}catch(v){h="Rangy init listener threw an exception. Continuing. Detail: "+c(v),a(h)}}}function d(e,t,r){r&&(e+=" in module "+r.name),R.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function p(e,t,r,n){e[t]=function(){return d(t,r,n),e[r].apply(e,I.toArray(arguments))}}function f(e){e=e||window,h();for(var t=0,r=L.length;r>t;++t)L[t](e)}function m(e,t,r){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=r}function v(e,t,r){var n=new m(e,t,function(t){if(!t.initialized){t.initialized=!0;try{r(R,t),t.supported=!0}catch(n){var i="Module '"+e+"' failed to load: "+c(n);a(i),n.stack&&a(n.stack)}}});return A[e]=n,n}function y(){}function g(){}var _="object",b="function",w="undefined",E=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],x=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],N=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],S=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],C=n(e),T=n(t),P=n(r),k=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var r=0,n=e.length;n>r;++r)t(e[r],r)},A={},O=typeof window!=w&&typeof document!=w,I={isHostMethod:e,isHostObject:t,isHostProperty:r,areHostMethods:C,areHostObjects:T,areHostProperties:P,isTextRange:i,getBody:o,forEach:k},R={version:"1.3.0",initialized:!1,isBrowser:O,supported:!0,util:I,features:{},modules:A,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==w?!0:rangyAutoInitialize}};R.fail=u,R.warn=l;var j;({}).hasOwnProperty?(I.extend=j=function(e,t,r){var n,i;for(var o in t)t.hasOwnProperty(o)&&(n=e[o],i=t[o],r&&null!==n&&"object"==typeof n&&null!==i&&"object"==typeof i&&j(n,i,!0),e[o]=i);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},I.createOptions=function(e,t){var r={};return j(r,t),e&&j(r,e),r}):u("hasOwnProperty not supported"),O||u("Rangy can only run in a browser"),function(){var e;if(O){var t=document.createElement("div");t.appendChild(document.createElement("span"));var r=[].slice;try{1==r.call(t.childNodes,0)[0].nodeType&&(e=function(e){return r.call(e,0)})}catch(n){}}e||(e=function(e){for(var t=[],r=0,n=e.length;n>r;++r)t[r]=e[r];return t}),I.toArray=e}();var D;O&&(e(document,"addEventListener")?D=function(e,t,r){e.addEventListener(t,r,!1)}:e(document,"attachEvent")?D=function(e,t,r){e.attachEvent("on"+t,r)}:u("Document does not have required addEventListener or attachEvent method"),I.addListener=D);var M=[];I.deprecationNotice=d,I.createAliasForDeprecatedMethod=p,R.init=h,R.addInitListener=function(e){R.initialized?e(R):M.push(e)};var L=[];R.addShimListener=function(e){L.push(e)},O&&(R.shim=R.createMissingNativeApi=f,p(R,"createMissingNativeApi","shim")),m.prototype={init:function(){for(var e,t,r=this.dependencies||[],n=0,i=r.length;i>n;++n){if(t=r[n],e=A[t],!(e&&e instanceof m))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){R.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){R.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},R.createModule=function(e){var t,r;2==arguments.length?(t=arguments[1],r=[]):(t=arguments[2],r=arguments[1]);var n=v(e,r,t);R.initialized&&R.supported&&n.init()},R.createCoreModule=function(e,t,r){v(e,t,r)},R.RangePrototype=y,R.rangePrototype=new y,R.selectionPrototype=new g,R.createCoreModule("DomUtil",[],function(e,t){function r(e){var t;return typeof e.namespaceURI==O||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function n(e){var t=e.parentNode;return 1==t.nodeType?t:null}function i(e){for(var t=0;e=e.previousSibling;)++t;return t}function o(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function a(e,t){var r,n=[];for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(M(n,r))return r;return null}function s(e,t,r){for(var n=r?t:t.parentNode;n;){if(n===e)return!0;n=n.parentNode}return!1}function u(e,t){return s(e,t,!0)}function l(e,t,r){for(var n,i=r?e:e.parentNode;i;){if(n=i.parentNode,n===t)return i;i=n}return null}function c(e){var t=e.nodeType;return 3==t||4==t||8==t}function h(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function d(e,t){var r=t.nextSibling,n=t.parentNode;return r?n.insertBefore(e,r):n.appendChild(e),e}function p(e,t,r){var n=e.cloneNode(!1);if(n.deleteData(0,t),e.deleteData(t,e.length-t),d(n,e),r)for(var o,a=0;o=r[a++];)o.node==e&&o.offset>t?(o.node=n,o.offset-=t):o.node==e.parentNode&&o.offset>i(e)&&++o.offset;return n}function f(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=O)return e.ownerDocument;if(typeof e.document!=O)return e.document;if(e.parentNode)return f(e.parentNode);throw t.createError("getDocument: no document found for node")}function m(e){var r=f(e);if(typeof r.defaultView!=O)return r.defaultView;if(typeof r.parentWindow!=O)return r.parentWindow;throw t.createError("Cannot get a window object for node")}function v(e){if(typeof e.contentDocument!=O)return e.contentDocument;if(typeof e.contentWindow!=O)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function y(e){if(typeof e.contentWindow!=O)return e.contentWindow;if(typeof e.contentDocument!=O)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function g(e){return e&&I.isHostMethod(e,"setTimeout")&&I.isHostObject(e,"document")}function _(e,t,r){var n;if(e?I.isHostProperty(e,"nodeType")?n=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?v(e):f(e):g(e)&&(n=e.document):n=document,!n)throw t.createError(r+"(): Parameter must be a Window object or DOM node");return n}function b(e){for(var t;t=e.parentNode;)e=t;return e}function w(e,r,n,o){var s,u,c,h,d;if(e==n)return r===o?0:o>r?-1:1;if(s=l(n,e,!0))return r<=i(s)?-1:1;if(s=l(e,n,!0))return i(s)<o?-1:1;if(u=a(e,n),!u)throw new Error("comparePoints error: nodes have no common ancestor");if(c=e===u?u:l(e,u,!0),h=n===u?u:l(n,u,!0),c===h)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(d=u.firstChild;d;){if(d===c)return-1;if(d===h)return 1;d=d.nextSibling}}function E(e){var t;try{return t=e.parentNode,!1}catch(r){return!0}}function x(e){if(!e)return"[No node]";if(L&&E(e))return"[Broken node]";if(c(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+i(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function N(e){for(var t,r=f(e).createDocumentFragment();t=e.firstChild;)r.appendChild(t);return r}function S(e,t,r){var n=R(e),i=e.createElement("div");i.contentEditable=""+!!r,t&&(i.innerHTML=t);var o=n.firstChild;return o?n.insertBefore(i,o):n.appendChild(i),i}function C(e){return e.parentNode.removeChild(e)}function T(e){this.root=e,this._next=e}function P(e){return new T(e)}function k(e,t){this.node=e,this.offset=t}function A(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var O="undefined",I=e.util,R=I.getBody;I.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),I.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var j=document.createElement("div");I.areHostMethods(j,["insertBefore","appendChild","cloneNode"]||!I.areHostObjects(j,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),I.isHostProperty(j,"innerHTML")||t.fail("Element is missing innerHTML property");var D=document.createTextNode("test");I.areHostMethods(D,["splitText","deleteData","insertData","appendData","cloneNode"]||!I.areHostObjects(j,["previousSibling","nextSibling","childNodes","parentNode"])||!I.areHostProperties(D,["data"]))||t.fail("Incomplete Text Node implementation");var M=function(e,t){for(var r=e.length;r--;)if(e[r]===t)return!0;return!1},L=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var r=t.firstChild;t.innerHTML="<br />",L=E(r),e.features.crashyTextNodes=L}();var F;typeof window.getComputedStyle!=O?F=function(e,t){return m(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=O?F=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),T.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,r=this._current=this._next;if(this._current)if(e=r.firstChild)this._next=e;else{for(t=null;r!==this.root&&!(t=r.nextSibling);)r=r.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},k.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},A.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},A.prototype.toString=function(){return this.message},e.dom={arrayContains:M,isHtmlNamespace:r,parentElement:n,getNodeIndex:i,getNodeLength:o,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:u,getClosestAncestorIn:l,isCharacterDataNode:c,isTextOrCommentNode:h,insertAfter:d,splitDataNode:p,getDocument:f,getWindow:m,getIframeWindow:y,getIframeDocument:v,getBody:R,isWindow:g,getContentDocument:_,getRootContainer:b,comparePoints:w,isBrokenNode:E,inspectNode:x,getComputedStyleProperty:F,createTestElement:S,removeNode:C,fragmentFromNodeChildren:N,createIterator:P,DomPosition:k},e.DOMException=A}),R.createCoreModule("DomRange",["DomUtil"],function(e,t){function r(e,t){return 3!=e.nodeType&&($(e,t.startContainer)||$(e,t.endContainer))}function n(e){return e.document||H(e.startContainer)}function i(e){return K(e.startContainer)}function o(e){return new L(e.parentNode,B(e))}function a(e){return new L(e.parentNode,B(e)+1)}function s(e,t,r){var n=11==e.nodeType?e.firstChild:e;return V(t)?r==t.length?D.insertAfter(e,t):t.parentNode.insertBefore(e,0==r?t:q(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),n}function u(e,t,r){if(S(e),S(t),n(t)!=n(e))throw new F("WRONG_DOCUMENT_ERR");var i=W(e.startContainer,e.startOffset,t.endContainer,t.endOffset),o=W(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return r?0>=i&&o>=0:0>i&&o>0}function l(e){for(var t,r,i,o=n(e.range).createDocumentFragment();r=e.next();){if(t=e.isPartiallySelectedSubtree(),r=r.cloneNode(!t),t&&(i=e.getSubtreeIterator(),r.appendChild(l(i)),i.detach()),10==r.nodeType)throw new F("HIERARCHY_REQUEST_ERR");o.appendChild(r)}return o}function c(e,t,r){var n,i;r=r||{stop:!1};for(var o,a;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1)return void(r.stop=!0);if(a=e.getSubtreeIterator(),c(a,t,r),a.detach(),r.stop)return}else for(n=D.createIterator(o);i=n.next();)if(t(i)===!1)return void(r.stop=!0)}function h(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),h(t),t.detach()):e.remove()}function d(e){for(var t,r,i=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(d(r)),r.detach()):e.remove(),10==t.nodeType)throw new F("HIERARCHY_REQUEST_ERR");i.appendChild(t)}return i}function p(e,t,r){var n,i=!(!t||!t.length),o=!!r;i&&(n=new RegExp("^("+t.join("|")+")$"));var a=[];return c(new m(e,!1),function(t){if((!i||n.test(t.nodeType))&&(!o||r(t))){var s=e.startContainer;if(t!=s||!V(s)||e.startOffset!=s.length){var u=e.endContainer;t==u&&V(u)&&0==e.endOffset||a.push(t)}}}),a}function f(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+D.inspectNode(e.startContainer)+":"+e.startOffset+", "+D.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function m(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var r=e.commonAncestorContainer;this.sc===this.ec&&V(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==r||V(this.sc)?U(this.sc,r,!0):this.sc.childNodes[this.so],this._last=this.ec!==r||V(this.ec)?U(this.ec,r,!0):this.ec.childNodes[this.eo-1])}}function v(e){return function(t,r){for(var n,i=r?t:t.parentNode;i;){if(n=i.nodeType,G(e,n))return i;i=i.parentNode}return null}}function y(e,t){if(ie(e,t))throw new F("INVALID_NODE_TYPE_ERR")}function g(e,t){if(!G(t,e.nodeType))throw new F("INVALID_NODE_TYPE_ERR")}function _(e,t){if(0>t||t>(V(e)?e.length:e.childNodes.length))throw new F("INDEX_SIZE_ERR")}function b(e,t){if(re(e,!0)!==re(t,!0))throw new F("WRONG_DOCUMENT_ERR")}function w(e){if(ne(e,!0))throw new F("NO_MODIFICATION_ALLOWED_ERR")}function E(e,t){if(!e)throw new F(t)}function x(e,t){return t<=(V(e)?e.length:e.childNodes.length)}function N(e){return!!e.startContainer&&!!e.endContainer&&!(X&&(D.isBrokenNode(e.startContainer)||D.isBrokenNode(e.endContainer)))&&K(e.startContainer)==K(e.endContainer)&&x(e.startContainer,e.startOffset)&&x(e.endContainer,e.endOffset)}function S(e){if(!N(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}function C(e,t){S(e);var r=e.startContainer,n=e.startOffset,i=e.endContainer,o=e.endOffset,a=r===i;V(i)&&o>0&&o<i.length&&q(i,o,t),V(r)&&n>0&&n<r.length&&(r=q(r,n,t),a?(o-=n,i=r):i==r.parentNode&&o>=B(r)&&o++,n=0),e.setStartAndEnd(r,n,i,o)}function T(e){S(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function P(e){e.START_TO_START=ce,e.START_TO_END=he,e.END_TO_END=de,e.END_TO_START=pe,e.NODE_BEFORE=fe,e.NODE_AFTER=me,e.NODE_BEFORE_AND_AFTER=ve,e.NODE_INSIDE=ye}function k(e){P(e),P(e.prototype)}function A(e,t){return function(){S(this);var r,n,i=this.startContainer,o=this.startOffset,s=this.commonAncestorContainer,u=new m(this,!0);i!==s&&(r=U(i,s,!0),n=a(r),i=n.node,o=n.offset),c(u,w),u.reset();var l=e(u);return u.detach(),t(this,i,o,i,o),l}}function O(t,n){function i(e,t){return function(r){g(r,Y),g(K(r),J);var n=(e?o:a)(r);(t?s:u)(this,n.node,n.offset)}}function s(e,t,r){var i=e.endContainer,o=e.endOffset;(t!==e.startContainer||r!==e.startOffset)&&((K(t)!=K(i)||1==W(t,r,i,o))&&(i=t,o=r),n(e,t,r,i,o))}function u(e,t,r){var i=e.startContainer,o=e.startOffset;(t!==e.endContainer||r!==e.endOffset)&&((K(t)!=K(i)||-1==W(t,r,i,o))&&(i=t,o=r),n(e,i,o,t,r))}var l=function(){};l.prototype=e.rangePrototype,t.prototype=new l,M.extend(t.prototype,{setStart:function(e,t){y(e,!0),_(e,t),s(this,e,t)},setEnd:function(e,t){y(e,!0),_(e,t),u(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],r=e[1],i=t,o=r;switch(e.length){case 3:o=e[2];break;case 4:i=e[2],o=e[3]}n(this,t,r,i,o)},setBoundary:function(e,t,r){this["set"+(r?"Start":"End")](e,t)},setStartBefore:i(!0,!0),setStartAfter:i(!1,!0),setEndBefore:i(!0,!1),setEndAfter:i(!1,!1),collapse:function(e){S(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){y(e,!0),n(this,e,0,e,z(e))},selectNode:function(e){y(e,!1),g(e,Y);var t=o(e),r=a(e);n(this,t.node,t.offset,r.node,r.offset)},extractContents:A(d,n),deleteContents:A(h,n),canSurroundContents:function(){S(this),w(this.startContainer),w(this.endContainer);var e=new m(this,!0),t=e._first&&r(e._first,this)||e._last&&r(e._last,this);return e.detach(),!t},splitBoundaries:function(){C(this)},splitBoundariesPreservingPositions:function(e){C(this,e)},normalizeBoundaries:function(){S(this);var e,t=this.startContainer,r=this.startOffset,i=this.endContainer,o=this.endOffset,a=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(i=e,o=e.length,e.appendData(t.data),Q(t))},s=function(e){var n=e.previousSibling;if(n&&n.nodeType==e.nodeType){t=e;var a=e.length;if(r=n.length,e.insertData(0,n.data),Q(n),t==i)o+=r,i=t;else if(i==e.parentNode){var s=B(e);o==s?(i=e,o=a):o>s&&o--}}},u=!0;if(V(i))o==i.length?a(i):0==o&&(e=i.previousSibling,e&&e.nodeType==i.nodeType&&(o=e.length,t==i&&(u=!1),e.appendData(i.data),Q(i),i=e));else{if(o>0){var l=i.childNodes[o-1];l&&V(l)&&a(l)}u=!this.collapsed}if(u){if(V(t))0==r?s(t):r==t.length&&(e=t.nextSibling,e&&e.nodeType==t.nodeType&&(i==e&&(i=t,o+=t.length),t.appendData(e.data),Q(e)));else if(r<t.childNodes.length){var c=t.childNodes[r];c&&V(c)&&s(c)}}else t=i,r=o;n(this,t,r,i,o)},collapseToPoint:function(e,t){y(e,!0),_(e,t),this.setStartAndEnd(e,t)}}),k(t)}function I(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:D.getCommonAncestor(e.startContainer,e.endContainer)}function R(e,t,r,n,i){e.startContainer=t,e.startOffset=r,e.endContainer=n,e.endOffset=i,e.document=D.getDocument(t),I(e)}function j(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,I(this)}var D=e.dom,M=e.util,L=D.DomPosition,F=e.DOMException,V=D.isCharacterDataNode,B=D.getNodeIndex,$=D.isOrIsAncestorOf,H=D.getDocument,W=D.comparePoints,q=D.splitDataNode,U=D.getClosestAncestorIn,z=D.getNodeLength,G=D.arrayContains,K=D.getRootContainer,X=e.features.crashyTextNodes,Q=D.removeNode;m.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,V(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,r=this._current;!V(r)||r!==this.sc&&r!==this.ec?r.parentNode&&Q(r):(e=r===this.sc?this.so:0,t=r===this.ec?this.eo:r.length,e!=t&&r.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return r(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new j(n(this.range));var t=this._current,r=t,i=0,o=t,a=z(t);$(t,this.sc)&&(r=this.sc,i=this.so),$(t,this.ec)&&(o=this.ec,a=this.eo),R(e,r,i,o,a)}return new m(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var Y=[1,3,4,5,7,8,10],J=[2,9,11],Z=[5,6,10,12],ee=[1,3,4,5,7,8,10,11],te=[1,3,4,5,7,8],re=v([9,11]),ne=v(Z),ie=v([6,10,12]),oe=document.createElement("style"),ae=!1;try{oe.innerHTML="<b>x</b>",ae=3==oe.firstChild.nodeType}catch(se){}e.features.htmlParsingConforms=ae;var ue=ae?function(e){var t=this.startContainer,r=H(t);if(!t)throw new F("INVALID_STATE_ERR");var n=null;return 1==t.nodeType?n=t:V(t)&&(n=D.parentElement(t)),n=null===n||"HTML"==n.nodeName&&D.isHtmlNamespace(H(n).documentElement)&&D.isHtmlNamespace(n)?r.createElement("body"):n.cloneNode(!1),n.innerHTML=e,D.fragmentFromNodeChildren(n)}:function(e){var t=n(this),r=t.createElement("body");return r.innerHTML=e,D.fragmentFromNodeChildren(r)},le=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ce=0,he=1,de=2,pe=3,fe=0,me=1,ve=2,ye=3;M.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){S(this),b(this.startContainer,t.startContainer);var r,n,i,o,a=e==pe||e==ce?"start":"end",s=e==he||e==ce?"start":"end";return r=this[a+"Container"],n=this[a+"Offset"],i=t[s+"Container"],o=t[s+"Offset"],W(r,n,i,o)},insertNode:function(e){if(S(this),g(e,ee),w(this.startContainer),$(e,this.startContainer))throw new F("HIERARCHY_REQUEST_ERR");var t=s(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){S(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&V(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var r=new m(this,!0);return e=l(r),r.detach(),e},canSurroundContents:function(){S(this),w(this.startContainer),w(this.endContainer);var e=new m(this,!0),t=e._first&&r(e._first,this)||e._last&&r(e._last,this);return e.detach(),!t},surroundContents:function(e){if(g(e,te),!this.canSurroundContents())throw new F("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);s(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){S(this);for(var e,t=new j(n(this)),r=le.length;r--;)e=le[r],t[e]=this[e];return t},toString:function(){S(this);var e=this.startContainer;if(e===this.endContainer&&V(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],r=new m(this,!0);return c(r,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),r.detach(),t.join("")},compareNode:function(e){S(this);var t=e.parentNode,r=B(e);if(!t)throw new F("NOT_FOUND_ERR");var n=this.comparePoint(t,r),i=this.comparePoint(t,r+1);return 0>n?i>0?ve:fe:i>0?me:ye},comparePoint:function(e,t){return S(this),E(e,"HIERARCHY_REQUEST_ERR"),b(e,this.startContainer),W(e,t,this.startContainer,this.startOffset)<0?-1:W(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:ue,toHtml:function(){return T(this)},intersectsNode:function(e,t){if(S(this),K(e)!=i(this))return!1;var r=e.parentNode,n=B(e);if(!r)return!0;var o=W(r,n,this.endContainer,this.endOffset),a=W(r,n+1,this.startContainer,this.startOffset);return t?0>=o&&a>=0:0>o&&a>0},isPointInRange:function(e,t){return S(this),E(e,"HIERARCHY_REQUEST_ERR"),b(e,this.startContainer),W(e,t,this.startContainer,this.startOffset)>=0&&W(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return u(this,e,!1)},intersectsOrTouchesRange:function(e){return u(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=W(this.startContainer,this.startOffset,e.startContainer,e.startOffset),r=W(this.endContainer,this.endOffset,e.endContainer,e.endOffset),n=this.cloneRange();return-1==t&&n.setStart(e.startContainer,e.startOffset),1==r&&n.setEnd(e.endContainer,e.endOffset),n}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==W(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==W(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new F("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ye},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,z(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var r=t.getNodes([3]);if(r.length>0){t.setStart(r[0],0);var n=r.pop();return t.setEnd(n,n.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return S(this),p(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var r=n(this),i=e.createRange(r);t=t||D.getBody(r),i.selectNodeContents(t);var o=this.intersection(i),a=0,s=0;return o&&(i.setEnd(o.startContainer,o.startOffset),a=i.toString().length,s=a+o.toString().length),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,r=0;this.setStart(t,0),this.collapse(!0);for(var n,i,o,a,s=[t],u=!1,l=!1;!l&&(n=s.pop());)if(3==n.nodeType)i=r+n.length,!u&&e.start>=r&&e.start<=i&&(this.setStart(n,e.start-r),u=!0),u&&e.end>=r&&e.end<=i&&(this.setEnd(n,e.end-r),l=!0),r=i;else for(a=n.childNodes,o=a.length;o--;)s.push(a[o])},getName:function(){return"DomRange"},equals:function(e){return j.rangesEqual(this,e)},isValid:function(){return N(this)},inspect:function(){return f(this)},detach:function(){}}),O(j,R),M.extend(j,{rangeProperties:le,RangeIterator:m,copyComparisonConstants:k,createPrototypeRange:O,inspect:f,toHtml:T,getRangeDocument:n,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=j}),R.createCoreModule("WrappedRange",["DomRange"],function(e,t){var r,n,i=e.dom,o=e.util,a=i.DomPosition,s=e.DomRange,u=i.getBody,l=i.getContentDocument,c=i.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function n(e){for(var t,r=d.length;r--;)t=d[r],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,r,n,i){var o=e.startContainer!==t||e.startOffset!=r,a=e.endContainer!==n||e.endOffset!=i,s=!e.equals(e.nativeRange);(o||a||s)&&(e.setEnd(n,i),e.setStart(t,r))}var c,h,d=s.rangeProperties;r=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,n(this)},s.createPrototypeRange(r,a),c=r.prototype,c.selectNode=function(e){this.nativeRange.selectNode(e),n(this)},c.cloneContents=function(){return this.nativeRange.cloneContents()},c.surroundContents=function(e){this.nativeRange.surroundContents(e),n(this)},c.collapse=function(e){this.nativeRange.collapse(e),n(this)},c.cloneRange=function(){return new r(this.nativeRange.cloneRange())},c.refresh=function(){n(this)},c.toString=function(){return this.nativeRange.toString()};var p=document.createTextNode("test");u(document).appendChild(p);var f=document.createRange();f.setStart(p,0),f.setEnd(p,0);try{f.setStart(p,1),c.setStart=function(e,t){this.nativeRange.setStart(e,t),n(this)},c.setEnd=function(e,t){this.nativeRange.setEnd(e,t),n(this)},h=function(e){return function(t){this.nativeRange[e](t),n(this)}}}catch(m){c.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(r){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}n(this)},c.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(r){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}n(this)},h=function(e,t){return function(r){try{this.nativeRange[e](r)}catch(i){this.nativeRange[t](r),this.nativeRange[e](r)}n(this)}}}c.setStartBefore=h("setStartBefore","setEndBefore"),c.setStartAfter=h("setStartAfter","setEndAfter"),c.setEndBefore=h("setEndBefore","setStartBefore"),c.setEndAfter=h("setEndAfter","setStartAfter"),c.selectNodeContents=function(e){this.setStartAndEnd(e,0,i.getNodeLength(e))},f.selectNodeContents(p),f.setEnd(p,3);var v=document.createRange();v.selectNodeContents(p),v.setEnd(p,4),v.setStart(p,2),-1==f.compareBoundaryPoints(f.START_TO_END,v)&&1==f.compareBoundaryPoints(f.END_TO_START,v)?c.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:c.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var y=document.createElement("div");y.innerHTML="123";var g=y.firstChild,_=u(document);_.appendChild(y),f.setStart(g,1),f.setEnd(g,2),f.deleteContents(),"13"==g.data&&(c.deleteContents=function(){this.nativeRange.deleteContents(),n(this)},c.extractContents=function(){var e=this.nativeRange.extractContents();return n(this),e}),_.removeChild(y),_=null,o.isHostMethod(f,"createContextualFragment")&&(c.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),u(document).removeChild(p),c.getName=function(){return"WrappedRange"},e.WrappedRange=r,e.createNativeRange=function(e){return e=l(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var h=function(e){var t=e.parentElement(),r=e.duplicate();r.collapse(!0);var n=r.parentElement();r=e.duplicate(),r.collapse(!1);var o=r.parentElement(),a=n==o?n:i.getCommonAncestor(n,o);return a==t?a:i.getCommonAncestor(t,a)},d=function(e){return 0==e.compareEndPoints("StartToEnd",e)},p=function(e,t,r,n,o){var s=e.duplicate();s.collapse(r);var u=s.parentElement();if(i.isOrIsAncestorOf(t,u)||(u=t),!u.canHaveHTML){var l=new a(u.parentNode,i.getNodeIndex(u));return{boundaryPosition:l,nodeInfo:{nodeIndex:l.offset,containerElement:l.node}}}var h=i.getDocument(u).createElement("span");h.parentNode&&i.removeNode(h);for(var d,p,f,m,v,y=r?"StartToStart":"StartToEnd",g=o&&o.containerElement==u?o.nodeIndex:0,_=u.childNodes.length,b=_,w=b;;){
if(w==_?u.appendChild(h):u.insertBefore(h,u.childNodes[w]),s.moveToElementText(h),d=s.compareEndPoints(y,e),0==d||g==b)break;if(-1==d){if(b==g+1)break;g=w}else b=b==g+1?g:w;w=Math.floor((g+b)/2),u.removeChild(h)}if(v=h.nextSibling,-1==d&&v&&c(v)){s.setEndPoint(r?"EndToStart":"EndToEnd",e);var E;if(/[\r\n]/.test(v.data)){var x=s.duplicate(),N=x.text.replace(/\r\n/g,"\r").length;for(E=x.moveStart("character",N);-1==(d=x.compareEndPoints("StartToEnd",x));)E++,x.moveStart("character",1)}else E=s.text.length;m=new a(v,E)}else p=(n||!r)&&h.previousSibling,f=(n||r)&&h.nextSibling,m=f&&c(f)?new a(f,0):p&&c(p)?new a(p,p.data.length):new a(u,i.getNodeIndex(h));return i.removeNode(h),{boundaryPosition:m,nodeInfo:{nodeIndex:w,containerElement:u}}},f=function(e,t){var r,n,o,a,s=e.offset,l=i.getDocument(e.node),h=u(l).createTextRange(),d=c(e.node);return d?(r=e.node,n=r.parentNode):(a=e.node.childNodes,r=s<a.length?a[s]:null,n=e.node),o=l.createElement("span"),o.innerHTML="&#feff;",r?n.insertBefore(o,r):n.appendChild(o),h.moveToElementText(o),h.collapse(!t),n.removeChild(o),d&&h[t?"moveStart":"moveEnd"]("character",s),h};n=function(e){this.textRange=e,this.refresh()},n.prototype=new s(document),n.prototype.refresh=function(){var e,t,r,n=h(this.textRange);d(this.textRange)?t=e=p(this.textRange,n,!0,!0).boundaryPosition:(r=p(this.textRange,n,!0,!1),e=r.boundaryPosition,t=p(this.textRange,n,!1,!1,r.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},n.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(n);var m=function(e){if(e.collapsed)return f(new a(e.startContainer,e.startOffset),!0);var t=f(new a(e.startContainer,e.startOffset),!0),r=f(new a(e.endContainer,e.endOffset),!1),n=u(s.getRangeDocument(e)).createTextRange();return n.setEndPoint("StartToStart",t),n.setEndPoint("EndToEnd",r),n};if(n.rangeToTextRange=m,n.prototype.toTextRange=function(){return m(this)},e.WrappedTextRange=n,!e.features.implementsDomRange||e.config.preferTextRange){var v=function(e){return e("return this;")()}(Function);"undefined"==typeof v.Range&&(v.Range=n),e.createNativeRange=function(e){return e=l(e,t,"createNativeRange"),u(e).createTextRange()},e.WrappedRange=n}}e.createRange=function(r){return r=l(r,t,"createRange"),new e.WrappedRange(e.createNativeRange(r))},e.createRangyRange=function(e){return e=l(e,t,"createRangyRange"),new s(e)},o.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),o.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var r=t.document;"undefined"==typeof r.createRange&&(r.createRange=function(){return e.createRange(r)}),r=t=null})}),R.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function r(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function n(e,r){if(e){if(P.isWindow(e))return e;if(e instanceof y)return e.win;var n=P.getContentDocument(e,t,r);return P.getWindow(n)}return window}function i(e){return n(e,"getWinSelection").getSelection()}function o(e){return n(e,"getDocSelection").document.selection}function a(e){var t=!1;return e.anchorNode&&(t=1==P.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,r){var n=r?"end":"start",i=r?"start":"end";e.anchorNode=t[n+"Container"],e.anchorOffset=t[n+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function u(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function l(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function c(t){var r;return t instanceof O?(r=e.createNativeRange(t.getDocument()),r.setEnd(t.endContainer,t.endOffset),r.setStart(t.startContainer,t.startOffset)):t instanceof I?r=t.nativeRange:D.implementsDomRange&&t instanceof P.getWindow(t.startContainer).Range&&(r=t),r}function h(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,r=e.length;r>t;++t)if(!P.isAncestorOf(e[0],e[t]))return!1;return!0}function d(e){var r=e.getNodes();if(!h(r))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return r[0]}function p(e){return!!e&&"undefined"!=typeof e.text}function f(e,t){var r=new I(t);e._ranges=[r],s(e,r,!1),e.rangeCount=1,e.isCollapsed=r.collapsed}function m(t){if(t._ranges.length=0,"None"==t.docSelection.type)l(t);else{var r=t.docSelection.createRange();if(p(r))f(t,r);else{t.rangeCount=r.length;for(var n,i=L(r.item(0)),o=0;o<t.rangeCount;++o)n=e.createRange(i),n.selectNode(r.item(o)),t._ranges.push(n);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function v(e,r){for(var n=e.docSelection.createRange(),i=d(r),o=L(n.item(0)),a=F(o).createControlRange(),s=0,u=n.length;u>s;++s)a.add(n.item(s));try{a.add(i)}catch(l){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),m(e)}function y(e,t,r){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=r,this.refresh()}function g(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function _(e,t){for(var r,n,i=te.length;i--;)if(r=te[i],n=r.selection,"deleteAll"==t)g(n);else if(r.win==e)return"delete"==t?(te.splice(i,1),!0):n;return"deleteAll"==t&&(te.length=0),null}function b(e,r){for(var n,i=L(r[0].startContainer),o=F(i).createControlRange(),a=0,s=r.length;s>a;++a){n=d(r[a]);try{o.add(n)}catch(u){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}o.select(),m(e)}function w(e,t){if(e.win.document!=L(t))throw new R("WRONG_DOCUMENT_ERR")}function E(t){return function(r,n){var i;this.rangeCount?(i=this.getRangeAt(0),i["set"+(t?"Start":"End")](r,n)):(i=e.createRange(this.win.document),i.setStartAndEnd(r,n)),this.setSingleRange(i,this.isBackward())}}function x(e){var t=[],r=new j(e.anchorNode,e.anchorOffset),n=new j(e.focusNode,e.focusOffset),i="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var o=0,a=e.rangeCount;a>o;++o)t[o]=O.inspect(e.getRangeAt(o));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+r.inspect()+", focus: "+n.inspect()+"]"}e.config.checkSelectionRanges=!0;var N,S,C="boolean",T="number",P=e.dom,k=e.util,A=k.isHostMethod,O=e.DomRange,I=e.WrappedRange,R=e.DOMException,j=P.DomPosition,D=e.features,M="Control",L=P.getDocument,F=P.getBody,V=O.rangesEqual,B=A(window,"getSelection"),$=k.isHostObject(document,"selection");D.implementsWinGetSelection=B,D.implementsDocSelection=$;var H=$&&(!B||e.config.preferTextRange);if(H)N=o,e.isSelectionValid=function(e){var t=n(e,"isSelectionValid").document,r=t.selection;return"None"!=r.type||L(r.createRange().parentElement())==t};else{if(!B)return t.fail("Neither document.selection or window.getSelection() detected."),!1;N=i,e.isSelectionValid=function(){return!0}}e.getNativeSelection=N;var W=N();if(!W)return t.fail("Native selection was null (possibly issue 138?)"),!1;var q=e.createNativeRange(document),U=F(document),z=k.areHostProperties(W,["anchorNode","focusNode","anchorOffset","focusOffset"]);D.selectionHasAnchorAndFocus=z;var G=A(W,"extend");D.selectionHasExtend=G;var K=typeof W.rangeCount==T;D.selectionHasRangeCount=K;var X=!1,Q=!0,Y=G?function(t,r){var n=O.getRangeDocument(r),i=e.createRange(n);i.collapseToPoint(r.endContainer,r.endOffset),t.addRange(c(i)),t.extend(r.startContainer,r.startOffset)}:null;k.areHostMethods(W,["addRange","getRangeAt","removeAllRanges"])&&typeof W.rangeCount==T&&D.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var r=t.rangeCount,n=r>1,i=[],o=a(t),s=0;r>s;++s)i[s]=t.getRangeAt(s);var u=P.createTestElement(document,"",!1),l=u.appendChild(document.createTextNode("")),c=document.createRange();if(c.setStart(l,1),c.collapse(!0),t.removeAllRanges(),t.addRange(c),Q=1==t.rangeCount,t.removeAllRanges(),!n){var h=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(h&&parseInt(h[1])>=36)X=!1;else{var d=c.cloneRange();c.setStart(l,0),d.setEnd(l,3),d.setStart(l,2),t.addRange(c),t.addRange(d),X=2==t.rangeCount}}for(P.removeNode(u),t.removeAllRanges(),s=0;r>s;++s)0==s&&o?Y?Y(t,i[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(i[s])):t.addRange(i[s])}}(),D.selectionSupportsMultipleRanges=X,D.collapsedNonEditableSelectionsSupported=Q;var J,Z=!1;U&&A(U,"createControlRange")&&(J=U.createControlRange(),k.areHostProperties(J,["item","add"])&&(Z=!0)),D.implementsControlRange=Z,S=z?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var ee;A(W,"getRangeAt")?ee=function(e,t){try{return e.getRangeAt(t)}catch(r){return null}}:z&&(ee=function(t){var r=L(t.anchorNode),n=e.createRange(r);return n.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),n.collapsed!==this.isCollapsed&&n.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),n}),y.prototype=e.selectionPrototype;var te=[],re=function(e){if(e&&e instanceof y)return e.refresh(),e;e=n(e,"getNativeSelection");var t=_(e),r=N(e),i=$?o(e):null;return t?(t.nativeSelection=r,t.docSelection=i,t.refresh()):(t=new y(r,i,e),te.push({win:e,selection:t})),t};e.getSelection=re,k.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var ne=y.prototype;if(!H&&z&&k.areHostMethods(W,["removeAllRanges","addRange"])){ne.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),l(this)};var ie=function(e,t){Y(e.nativeSelection,t),e.refresh()};K?ne.addRange=function(t,n){if(Z&&$&&this.docSelection.type==M)v(this,t);else if(r(n)&&G)ie(this,t);else{var i;X?i=this.rangeCount:(this.removeAllRanges(),i=0);var o=c(t).cloneRange();try{this.nativeSelection.addRange(o)}catch(a){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==i+1){if(e.config.checkSelectionRanges){var u=ee(this.nativeSelection,this.rangeCount-1);u&&!V(u,t)&&(t=new I(u))}this._ranges[this.rangeCount-1]=t,s(this,t,se(this.nativeSelection)),this.isCollapsed=S(this)}else this.refresh()}}:ne.addRange=function(e,t){r(t)&&G?ie(this,e):(this.nativeSelection.addRange(c(e)),this.refresh())},ne.setRanges=function(e){if(Z&&$&&e.length>1)b(this,e);else{this.removeAllRanges();for(var t=0,r=e.length;r>t;++t)this.addRange(e[t])}}}else{if(!(A(W,"empty")&&A(q,"select")&&Z&&H))return t.fail("No means of selecting a Range or TextRange was found"),!1;ne.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=L(this.anchorNode);else if(this.docSelection.type==M){var t=this.docSelection.createRange();t.length&&(e=L(t.item(0)))}if(e){var r=F(e).createTextRange();r.select(),this.docSelection.empty()}}}catch(n){}l(this)},ne.addRange=function(t){this.docSelection.type==M?v(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},ne.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?b(this,e):t&&this.addRange(e[0])}}ne.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new R("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var oe;if(H)oe=function(t){var r;e.isSelectionValid(t.win)?r=t.docSelection.createRange():(r=F(t.win.document).createTextRange(),r.collapse(!0)),t.docSelection.type==M?m(t):p(r)?f(t,r):l(t)};else if(A(W,"getRangeAt")&&typeof W.rangeCount==T)oe=function(t){if(Z&&$&&t.docSelection.type==M)m(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var r=0,n=t.rangeCount;n>r;++r)t._ranges[r]=new e.WrappedRange(t.nativeSelection.getRangeAt(r));s(t,t._ranges[t.rangeCount-1],se(t.nativeSelection)),t.isCollapsed=S(t)}else l(t)};else{if(!z||typeof W.isCollapsed!=C||typeof q.collapsed!=C||!D.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;oe=function(e){var t,r=e.nativeSelection;r.anchorNode?(t=ee(r,0),e._ranges=[t],e.rangeCount=1,u(e),e.isCollapsed=S(e)):l(e)}}ne.refresh=function(e){var t=e?this._ranges.slice(0):null,r=this.anchorNode,n=this.anchorOffset;if(oe(this),e){var i=t.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=r||this.anchorOffset!=n)return!0;for(;i--;)if(!V(t[i],this._ranges[i]))return!0;return!1}};var ae=function(e,t){var r=e.getAllRanges();e.removeAllRanges();for(var n=0,i=r.length;i>n;++n)V(t,r[n])||e.addRange(r[n]);e.rangeCount||l(e)};Z&&$?ne.removeRange=function(e){if(this.docSelection.type==M){for(var t,r=this.docSelection.createRange(),n=d(e),i=L(r.item(0)),o=F(i).createControlRange(),a=!1,s=0,u=r.length;u>s;++s)t=r.item(s),t!==n||a?o.add(r.item(s)):a=!0;o.select(),m(this)}else ae(this,e)}:ne.removeRange=function(e){ae(this,e)};var se;!H&&z&&D.implementsDomRange?(se=a,ne.isBackward=function(){return se(this)}):se=ne.isBackward=function(){return!1},ne.isBackwards=ne.isBackward,ne.toString=function(){for(var e=[],t=0,r=this.rangeCount;r>t;++t)e[t]=""+this._ranges[t];return e.join("")},ne.collapse=function(t,r){w(this,t);var n=e.createRange(t);n.collapseToPoint(t,r),this.setSingleRange(n),this.isCollapsed=!0},ne.collapseToStart=function(){if(!this.rangeCount)throw new R("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},ne.collapseToEnd=function(){if(!this.rangeCount)throw new R("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},ne.selectAllChildren=function(t){w(this,t);var r=e.createRange(t);r.selectNodeContents(t),this.setSingleRange(r)},ne.deleteFromDocument=function(){if(Z&&$&&this.docSelection.type==M){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),P.removeNode(e);this.refresh()}else if(this.rangeCount){var r=this.getAllRanges();if(r.length){this.removeAllRanges();for(var n=0,i=r.length;i>n;++n)r[n].deleteContents();this.addRange(r[i-1])}}},ne.eachRange=function(e,t){for(var r=0,n=this._ranges.length;n>r;++r)if(e(this.getRangeAt(r)))return t},ne.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},ne.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},ne.callMethodOnEachRange=function(e,t){var r=[];return this.eachRange(function(n){r.push(n[e].apply(n,t||[]))}),r},ne.setStart=E(!0),ne.setEnd=E(!1),e.rangePrototype.select=function(e){re(this.getDocument()).setSingleRange(this,e)},ne.changeEachRange=function(e){var t=[],r=this.isBackward();this.eachRange(function(r){e(r),t.push(r)}),this.removeAllRanges(),r&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},ne.containsNode=function(e,t){return this.eachRange(function(r){return r.containsNode(e,t)},!0)||!1},ne.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},ne.moveToBookmark=function(t){for(var r,n,i=[],o=0;r=t.rangeBookmarks[o++];)n=e.createRange(this.win),n.moveToBookmark(r),i.push(n);t.backward?this.setSingleRange(i[0],"backward"):this.setRanges(i)},ne.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},ne.restoreRanges=function(e){this.removeAllRanges();for(var t,r=0;t=e.ranges[r];++r)this.addRange(t,e.backward&&0==r)},ne.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(O.toHtml(t))}),e.join("")},D.implementsTextRange&&(ne.getNativeTextRange=function(){var r;if(r=this.docSelection){var n=r.createRange();if(p(n))return n;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),ne.getName=function(){return"WrappedSelection"},ne.inspect=function(){return x(this)},ne.detach=function(){_(this.win,"delete"),g(this)},y.detachAll=function(){_(null,"deleteAll")},y.inspect=x,y.isDirectionBackward=r,e.Selection=y,e.selectionPrototype=ne,e.addShimListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return re(e)}),e=null})});var F=!1,V=function(e){F||(F=!0,!R.initialized&&R.config.autoInitialize&&h())};return O&&("complete"==document.readyState?V():(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",V,!1),D(window,"load",V))),R},this),define("wed/domtypeguards",["require","exports","module"],function(e,t,r){"use strict";function n(e){return null!=e&&"number"==typeof e.nodeType}function i(e){return null!=e&&e.nodeType===Node.ELEMENT_NODE}function o(e){return null!=e&&e.nodeType===Node.TEXT_NODE}function a(e){return e instanceof Attr||e.nodeType===c}function s(e){return e instanceof Attr}function u(e){return null!=e&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}function l(e){return null!=e&&e.nodeType===Node.DOCUMENT_NODE}Object.defineProperty(t,"__esModule",{value:!0}),t.isNode=n,t.isElement=i,t.isText=o;var c=Node.ATTRIBUTE_NODE,h=void 0===c?s:a;t.isAttr=h,t.isDocumentFragment=u,t.isDocument=l}),define("wed/util",["require","exports","module","bluebird"],function(e,t,r,n){"use strict";function i(e,t){return Math.sqrt(e*e+t*t)}function o(e,t,r,n,o,a){var s=t-n,u=e-r,l=t-a,c=e-o,h=0>s,d=l>0,p=0>u,f=c>0,m=p?u:f?c:0,v=h?s:d?l:0;return i(m,v)}function a(e,t,r,n,i,o){var a=t-n,s=e-r,u=t-o,l=e-i,c=0>a,h=u>0,d=0>s,p=l>0,f=d?s:p?l:0,m=c?a:h?u:0;return{x:Math.abs(f),y:Math.abs(m)}}function s(e){return e.replace(/:/g,"\\:")}function u(e){return e.classList[0]}function l(e){return"*"===e?"._real":"."+s(e)+"._real"}function c(e){return e.slice(9).replace(/---/,":").replace(/---(-+)/g,"--$1")}function h(e){return"data-wed-"+e.replace(/--(-+)/g,"---$1").replace(/:/,"---")}function d(e){for(var t=Object.create(null),r=e.attributes,n=0;n<r.length;++n){var i=r[n];0===i.localName.lastIndexOf("data-wed-",0)&&(t[c(i.localName)]=i.value)}return t}function p(){return"WED-ID-"+ ++w}function f(e){var t=e;return t.altKey||t.ctrlKey||t.metaKey}function m(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=window;void 0===r.selenium_log&&(r.selenium_log=[]),r.selenium_log.push.apply(r.selenium_log,e)}function v(e){try{throw e}catch(t){return t.stack}}function y(){var e=new Error;return null!=e.stack?e.stack:v(e)}function g(e,t){if(null!=e.a&&null!=e.b)return"("+g(e.a,t)+") or ("+g(e.b,t)+")";var r;if("AnyName"===e.pattern)r="*:*";else{if(void 0===e.ns)throw new Error("unexpected undefined obj.ns");if(void 0!==e.name)r=t.unresolveName(e.ns,e.name),void 0===r&&(r="{"+e.ns+"}"+e.name);else{var n=t.prefixFromURI(e.ns);r=void 0===n?"{"+e.ns+"}":""!==n?n+":":n,r+="*"}}return null!=e.except&&(r+=" except ("+g(e.except,t)+")"),r}function _(e){var t=new FileReader;return new n(function(r,n){t.onload=function(){r(t.result)},t.onerror=n,t.readAsText(e)})}function b(e,t){var r=void 0!==Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__;r!==t&&(void 0!==Object.setPrototypeOf?Object.setPrototypeOf(e,t.prototype):e.__proto__=t.prototype)}Object.defineProperty(t,"__esModule",{value:!0}),t.distFromDeltas=i,t.distFromRect=o,t.distsFromRect=a,t.escapeCSSClass=s,t.getOriginalName=u,t.classFromOriginalName=l,t.decodeAttrName=c,t.encodeAttrName=h,t.getOriginalAttributes=d;var w=0;t.newGenericID=p,t.anySpecialKeyHeld=f,t.seleniumLog=m,t.stackTrace=y,t.convertPatternObj=g,t.readFile=_,t.fixPrototype=b}),define("wed/domutil",["require","exports","module","jquery","rangy","./domtypeguards","./util"],function(e,t,r,n,i,o,a){"use strict";function s(e,t){for(var r=e.length,n=0;r>n;++n)if(e[n]===t)return n;return-1}function u(e){var t=i.getSelection(e);if(!(void 0===t||t.rangeCount<1))return t.getRangeAt(0)}function l(e,t,r,n){var o=i.createRange(e.ownerDocument),a=!1;return i.dom.comparePoints(e,t,r,n)<=0?(o.setStart(e,t),o.setEnd(r,n)):(o.setStart(r,n),o.setEnd(e,t),a=!0),{range:o,reversed:a}}function c(e){var t=null!=e?e.nodeType:void 0;switch(t){case Node.TEXT_NODE:if(null==e.parentNode)throw new Error("detached node");e.parentNode.focus();break;case Node.ELEMENT_NODE:e.focus();break;default:throw new Error("tried to focus something other than a text node or an element.")}}function h(e,t,r){var n=e[0],i=e[1],a=!1;if(!t.contains(n))return null;var u,l=o.isDocument(n)?n:n.ownerDocument,c=l.defaultView;e:for(;!a;)switch(u=n.parentNode,n.nodeType){case Node.TEXT_NODE:if(i>=n.length||null!=u&&u.lastChild===n&&"normal"===c.getComputedStyle(u,void 0).whiteSpace&&/^\s+$/.test(n.data.slice(i))){if(null==u||n===t)break e;i=s(u.childNodes,n)+1,n=u}else i++,a=!0;break;case Node.ELEMENT_NODE:if(i>=n.childNodes.length){if(null==u||n===t)break e;i=s(u.childNodes,n)+1,n=u,a=!0}else n=n.childNodes[i],i=0,a=!(n.childNodes.length>0&&o.isText(n.childNodes[i]))}if(!a)return null;if(r&&o.isText(n)){if(u=n.parentNode,null==u)throw new Error("detached node");i=s(u.childNodes,n),n=u}return!t.contains(n)||n===t&&i>=n.childNodes.length?null:[n,i]}function d(e,t,r){var n=e[0],i=e[1],a=!1;if(!t.contains(n))return null;var u,l=o.isDocument(n)?n:n.ownerDocument,c=l.defaultView;e:for(;!a;){if(i--,n===t&&0>i)return null;switch(u=n.parentNode,n.nodeType){case Node.TEXT_NODE:if(0>i||null!=u&&u.firstChild===n&&"normal"===c.getComputedStyle(u,void 0).whiteSpace&&/^\s+$/.test(n.data.slice(0,i))){if(null===u||n===t)break e;i=s(u.childNodes,n),n=u}else a=!0;break;case Node.ELEMENT_NODE:if(0>i||0===n.childNodes.length){if(null==u||n===t)break e;i=s(u.childNodes,n),n=u,a=!0}else n=n.childNodes[i],o.isElement(n)?(i=n.childNodes.length,a=!(n.childNodes.length>0&&o.isText(n.childNodes[i-1]))):i=n.length+1}}if(!a)return null;if(r&&o.isText(n)){if(u=n.parentNode,null==u)throw new Error("detached node");i=s(u.childNodes,n),n=u}return!t.contains(n)||n===t&&0>i?null:[n,i]}function p(e,t,r){for(var n=[],i=r;i!==e;){var o=i.parentNode;if(null==o)throw new Error("nodeInA is not treeA or a child of treeA");n.unshift(s(o.childNodes,i)),i=o}for(var a=t;0!==n.length;)a=a.childNodes[n.shift()];return a}function f(e){var t=document.createElement("span");return t.className="_placeholder",t.setAttribute("contenteditable","true"),t.textContent=void 0!==e?e:" ",t}function m(e,t,r,n){if(void 0===n&&(n=!0),!o.isText(e))throw new Error("insertIntoText called on non-text");var i,a;void 0===n&&(n=!0),0>t?t=0:t>e.length&&(t=e.length);var u,l,c=o.isDocumentFragment(r),h=e.parentNode;if(null==h)throw new Error("detached node");var d=s(h.childNodes,e);if(n&&(null==r||c&&0===r.childNodes.length))i=a=[e,t];else{var p=document.createDocumentFragment();u=document.createTextNode(e.data.slice(0,t)),p.appendChild(u),null!=r&&p.appendChild(r),l=document.createTextNode(e.data.slice(t));var f=l.length;if(p.appendChild(l),n&&p.normalize(),i=n&&0===t?[h,d]:[p.firstChild,t],a=n&&t===e.length?[h,d+p.childNodes.length]:[p.lastChild,p.lastChild.length-f],this.deleteNode(e),void 0!==this.insertFragAt)this.insertFragAt(h,d,p);else for(;null!=p.firstChild;)this.insertNodeAt(h,d++,p.firstChild)}return[i,a]}function v(e,t,r){if(null==r)throw new Error("must pass an actual node to insert");return m.call(this,e,t,r)}function y(e,t,r){if(""===r)return[void 0,void 0];var n,i;e:for(;;)switch(e.nodeType){case Node.ELEMENT_NODE:var a=e.childNodes[t];if(o.isText(a)){e=a,t=0;continue e}var s=e.childNodes[t-1];if(o.isText(s)){e=s,t=s.length;continue e}i=document.createTextNode(r),this.insertNodeAt(e,t,i);break e;case Node.TEXT_NODE:n=e;var u=n.data.slice(0,t),l=n.data.slice(t);this.setTextNodeValue(n,u+r+l),i=n;break e;default:throw new Error("unexpected node type: "+e.nodeType)}return[n,i]}function g(e,t,r){if(!o.isText(e))throw new Error("deleteText called on non-text");if(e.deleteData(t,r),0===e.length){if(null==e.parentNode)throw new Error("detached node");e.parentNode.removeChild(e)}}function _(e,t){n.data(e,"wed_mirror_node",t),n.data(t,"wed_mirror_node",e);for(var r=0;r<e.children.length;++r){var i=e.children[r],o=t.children[r];_(i,o)}}function b(e){n.removeData(e,"wed_mirror_node");for(var t=0;t<e.children.length;++t)b(e.children[t])}function w(e){for(void 0===e&&(e=null);null!==e&&null!==e.firstChild;)e=e.firstChild;return e}function E(e){for(void 0===e&&(e=null);null!==e&&null!==e.lastChild;)e=e.lastChild;return e}function x(e){if(null==e.parentNode)throw new Error("detached node");e.parentNode.removeChild(e)}function N(e,t,r){var n=e.childNodes[t];e.insertBefore(r,null!=n?n:null)}function S(e,t,r){return y.call({insertNodeAt:N,setTextNodeValue:function(e,t){e.data=t}},e,t,r)}function C(e,t,r,n){return void 0===n&&(n=!0),m.call(Q,e,t,r,n)}function T(e,t,r){return v.call(Q,e,t,r)}function P(e,t){var r=C(e,t,void 0,!1);return[r[0][0],r[1][0]]}function k(e){var t=e.nextSibling;if(o.isText(e)&&o.isText(t)){var r=e.length;return e.appendData(t.data),t.parentNode.removeChild(t),[e,r]}var n=e.parentNode;if(null==n)throw new Error("detached node");return[n,s(n.childNodes,e)+1]}function A(e){var t;switch(e.startContainer.nodeType){case Node.TEXT_NODE:if(t=e.startContainer.parentNode,null==t)throw new Error("detached node");break;case Node.ELEMENT_NODE:t=e.startContainer;break;default:throw new Error("unexpected node type: "+e.startContainer.nodeType)}var r;switch(e.endContainer.nodeType){case Node.TEXT_NODE:if(r=e.endContainer.parentNode,null==r)throw new Error("detached node");break;case Node.ELEMENT_NODE:r=e.endContainer;break;default:throw new Error("unexpected node type: "+e.endContainer.nodeType)}return[t,r]}function O(e){var t=A(e);return t[0]===t[1]}function I(e,t){if(!O({startContainer:e[0],startOffset:e[1],endContainer:t[0],endOffset:t[1]}))throw new Error("range is not well-formed");var r=e[0],n=e[1],i=t[0],a=t[1],u=r.parentNode;if(null==u)throw new Error("detached node");var l,c;if(o.isText(r)&&0===n&&(n=s(u.childNodes,r),r=u,u=r.parentNode,null==u))throw new Error("detached node");if(o.isText(r)){var h=r===i,d=s(u.childNodes,r),p=h?a:r.length;if(c=u.ownerDocument.createTextNode(r.data.slice(n,p)),this.deleteText(r,n,c.length),l=null!=r.parentNode?[r,n]:[u,d],h)return[l,[c]];n=null!=r.parentNode?d+1:d,r=u}else l=[r,n];var f;if(o.isText(i)){if(u=i.parentNode,null==u)throw new Error("detached node");var m=s(u.childNodes,i);f=u.ownerDocument.createTextNode(i.data.slice(0,a)),this.deleteText(i,0,a),a=m,i=u}if(r!==i)throw new Error("internal error in cut: containers unequal");if(!o.isElement(r))throw new Error("internal error in cut: not an element");var v=[];for(a--;a>=n;)v.unshift(i.childNodes[a]),this.deleteNode(i.childNodes[a]),a--;return null!=c&&v.unshift(c),null!=f&&v.push(f),null!=i.childNodes[a]&&this.mergeTextNodes(i.childNodes[a]),[l,v]}function R(e,t){null==t?console.log(e,"no range"):console.log(e,t.startContainer,t.startOffset,t.endContainer,t.endOffset)}function j(e,t){R(e,u(t))}function D(e,t){var r;return r=null==t?[e,"no range"]:[e,t.startContainer.outerHTML,t.startOffset,t.endContainer.outerHTML,t.endOffset],r.join(", ")}function M(e,t,r){var n=e.ownerDocument.body,i=e.getBoundingClientRect();return t-=i.left+n.scrollLeft,r-=i.top+n.scrollTop,t>=0&&r>=0&&t<e.clientWidth&&r<e.clientHeight}function L(e,t,r){if(null==e)return null;for(o.isText(e)&&(e=e.parentNode);null!=e;){if(!o.isElement(e))return null;if(e.matches(t))break;if(e===r){e=null;break}e=e.parentNode}return e}function F(e,t,r){if(null==e)return null;for(o.isText(e)&&(e=e.parentNode);null!=e;){if(!o.isElement(e))return null;if(e.classList.contains(t))break;if(e===r){e=null;break}e=e.parentNode}return e}function V(e,t){if(!o.isElement(e))return null;var r=e.parentNode;if(null==r)return null;for(var n=r.firstElementChild;null!=n&&!n.classList.contains(t);)n=n.nextElementSibling;return n}function B(e,t){if(!o.isElement(e))return[];for(var r=[],n=e.firstElementChild;null!=n;)n.classList.contains(t)&&r.push(n),n=n.nextElementSibling;return r}function $(e,t){if(!o.isElement(e))return null;for(var r=e.firstElementChild;null!=r&&!r.classList.contains(t);)r=r.nextElementSibling;return r}function H(e){return null==Y&&(Y=document.createElement("span")),Y.textContent=e,Y.innerHTML}function W(e){if(/[\]['"()]/.test(e))throw new Error("selector is too complex");for(var t=e.split(Z),r=[],n=0,i=t;n<i.length;n++){var o=i[n];if(0!==o.length)if(J.indexOf(o)>-1)r.push(o);else if(/[a-zA-Z]/.test(o[0])){o=o.trim();var s=o.split(/(.#)/);r.push(a.classFromOriginalName(s[0])),r=r.concat(s.slice(1))}else r.push(o)}return r.join("")}function q(e,t){var r=W(t),i=n.data(e,"wed_mirror_node"),o=i.querySelector(r);if(null==o)return null;var a=n.data(o,"wed_mirror_node");return null!=a?a:null}function U(e,t){for(var r=W(t),i=n.data(e,"wed_mirror_node"),o=i.querySelectorAll(r),a=[],s=0;s<o.length;++s)a.push(n.data(o[s],"wed_mirror_node"));return a}function z(e,t){var r=null!=t?t:window.document,n=r.createDocumentFragment(),i=r.createElement("div");return n.appendChild(i),i.innerHTML=e,Array.prototype.slice.call(i.childNodes)}function G(e){var t=e[0],r=e[1];switch(t.nodeType){case Node.TEXT_NODE:var n=t.data;return n[r-1];case Node.ELEMENT_NODE:var i=t.childNodes[r-1];if(o.isText(i))return i.data[i.data.length-1];break;default:throw new Error("unexpected node type: "+t.nodeType)}}function K(e){var t=e[0],r=e[1];switch(t.nodeType){case Node.TEXT_NODE:var n=t.data;return n[r];case Node.ELEMENT_NODE:var i=t.childNodes[r];if(o.isText(i))return i.data[0];break;default:throw new Error("unexpected node type: "+t.nodeType)}}function X(e,t){for(var r=e.ownerDocument.defaultView;null!=e&&e!==t;){if("none"===e.style.display)return!0;var n=r.getComputedStyle(e).getPropertyValue("display");if("none"===n)return!0;e=e.parentNode}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.isAttr=o.isAttr,t.indexOf=s,t.getSelectionRange=u,t.rangeFromPoints=l,t.focusNode=c,t.nextCaretPosition=h,t.prevCaretPosition=d,t.correspondingNode=p,t.makePlaceholder=f,t.genericInsertIntoText=v,t.genericInsertText=y,t.deleteText=g,t.linkTrees=_,t.unlinkTree=b,t.firstDescendantOrSelf=w,t.lastDescendantOrSelf=E,t.deleteNode=x,t.insertText=S;var Q={insertNodeAt:N,insertFragAt:N,deleteNode:x};t.insertIntoText=T,t.splitTextNode=P,t.mergeTextNodes=k,t.isWellFormedRange=O,t.genericCutFunction=I,t.dumpRange=R,t.dumpCurrentSelection=j,t.dumpRangeToString=D,t.pointInContents=M,t.closest=L,t.closestByClass=F,t.siblingByClass=V,t.childrenByClass=B,t.childByClass=$;var Y;t.textToHTML=H;var J=",>+~ ",Z=new RegExp("(["+J+"]+)");t.toGUISelector=W,t.dataFind=q,t.dataFindAll=U,t.htmlToElements=z,t.getCharacterImmediatelyBefore=G,t.getCharacterImmediatelyAt=K,t.isNotDisplayed=X}),define("wed/oop",["require","exports","module"],function(e,t){"use strict";function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e}function n(e,t){var r=void 0!==t.prototype?t.prototype:t;for(var n in r)e.prototype[n]=r[n]}t.inherit=r,t.implement=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/undo",["require","exports","module"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.stack=[],this.list=[],this.index=-1,this._undoingOrRedoing=!1}return e.prototype.record=function(e){this.stack.length>0?this.stack[0].record(e):(this.list=this.list.splice(0,this.index+1),this.list.push(e),this.index++)},e.prototype.undo=function(){if(this._undoingOrRedoing)throw new Error("calling undo while undoing or redoing");for(this._undoingOrRedoing=!0;this.stack.length>0;)this.endGroup();this.index>=0&&this.list[this.index--].undo(),this._undoingOrRedoing=!1},e.prototype.redo=function(){
if(this._undoingOrRedoing)throw new Error("calling redo while undoing or redoing");this._undoingOrRedoing=!0,this.index<this.list.length-1&&this.list[++this.index].redo(),this._undoingOrRedoing=!1},e.prototype.undoingOrRedoing=function(){return this._undoingOrRedoing},e.prototype.canUndo=function(){return this.index>-1},e.prototype.canRedo=function(){return this.index<this.list.length-1},e.prototype.startGroup=function(e){this.stack.unshift(e)},e.prototype.endGroup=function(){var e=this.stack.shift();if(void 0===e)throw new Error("ending a non-existent group.");e.end(),this.record(e)},e.prototype.endAllGroups=function(){for(;this.stack.length>0;)this.endGroup()},e.prototype.getGroup=function(){return this.stack[0]},e.prototype.toString=function(){var e=[];e.push("Start of list\n");for(var t=0,r=this.list;t<r.length;t++){var n=r[t];e.push(n.toString())}e.push("End of list\n"),e.push("Unfinished groups:\n");for(var i=this.stack.length-1;i>=0;--i){var o=this.stack[i];e.push(o.toString())}return e.push("End of unfinished groups\n"),e.join("")},e}();t.UndoList=n;var i=function(){function e(e){this.desc=e}return e.prototype.toString=function(){return this.desc+"\n"},e}();t.Undo=i;var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.list=[],t}return __extends(t,e),t.prototype.undo=function(){for(var e=this.list.length-1;e>=0;--e)this.list[e].undo()},t.prototype.redo=function(){for(var e=0,t=this.list;e<t.length;e++){var r=t[e];r.redo()}},t.prototype.record=function(e){this.list.push(e)},t.prototype.end=function(){},t.prototype.toString=function(){var e=[];e.push("Start of "+this.desc+"\n");for(var t=0,r=this.list;t<r.length;t++){var n=r[t];e.push(n.toString().replace(/(^|\n)/g,"$1 ").slice(0,-1))}return e.push("End of "+this.desc+"\n"),e.join("")},t}(i);t.UndoGroup=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/wundo",["require","exports","module","./undo"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r){var n=e.call(this,t)||this;return n.editor=r,n.caretAsPathBefore=n.getDataCaretAsPath(),n}return __extends(t,e),t.prototype.undo=function(){e.prototype.undo.call(this),this.setDataCaretAsPath(this.caretAsPathBefore)},t.prototype.redo=function(){if(e.prototype.redo.call(this),void 0===this.caretAsPathAfter)throw new Error("caretAsPathAfter is undefined, this indicates a corrupted state and thus an internal error");this.setDataCaretAsPath(this.caretAsPathAfter)},t.prototype.getDataCaretAsPath=function(){var e=this.editor.caretManager.getDataCaret(!0);return void 0===e?[void 0,void 0]:[this.editor.data_updater.nodeToPath(e.node),e.offset]},t.prototype.setDataCaretAsPath=function(e){(void 0!==e[0]||void 0!==e[1])&&this.editor.caretManager.setCaret(this.editor.data_updater.pathToNode(e[0]),e[1])},t.prototype.recordCaretAfter=function(){this.caretAsPathAfter=this.getDataCaretAsPath()},t.prototype.end=function(){void 0===this.caretAsPathAfter&&this.recordCaretAfter()},t}(n.UndoGroup);t.UndoGroup=i;var o=function(e){function t(t,r,n,i){var o=e.call(this,t,r)||this;return o.undoList=n,o.limit=i,o}return __extends(t,e),t.prototype.record=function(t){if(this.list.length>=this.limit)throw new Error("TextUndoGroup.record called beyond the limit");e.prototype.record.call(this,t),this.list.length===this.limit&&this.undoList.endGroup()},t}(i);t.TextUndoGroup=o;var a=function(e){function t(t){return e.call(this,"*** MARKER *** "+t)||this}return __extends(t,e),t.prototype.undo=function(){},t.prototype.redo=function(){},t}(n.Undo);t.MarkerUndo=a}),define("wed/lib/simple_event_emitter",["require","exports","module"],function(e,t){"use strict";function r(){this._event_listeners={},this._simple_event_emitter_trace=!1}r.prototype.addEventListener=function(e,t){var r=this._event_listeners[e];void 0===r&&(r=this._event_listeners[e]=[]),r.push(t)},r.prototype.addOneTimeEventListener=function(e,t){var r=function(n){return this.removeEventListener(e,r),t(n)}.bind(this);return this.addEventListener(e,r),r},r.prototype.removeEventListener=function(e,t){var r=this._event_listeners[e];if(void 0!==r){var n=r.lastIndexOf(t);-1!==n&&r.splice(n,1)}},r.prototype.removeAllListeners=function(e){this._event_listeners[e]=[]},r.prototype._emit=function(e,t){this._simple_event_emitter_trace&&console.log("simple_event_emitter emitting:",e,"with:",t);var r,n,i=this._event_listeners["*"];if(i&&i.length>0)for(i=i.slice(),r=0;r<i.length;++r)if(n=i[r](e,t),n===!1)return;if(i=this._event_listeners[e],i&&i.length>0)for(i=i.slice(),r=0;r<i.length;++r)if(n=i[r](t),n===!1)return},t.SimpleEventEmitter=r}),define("wed/lib/conditioned",["require","exports","module"],function(e,t){"use strict";function r(){this._conditions={}}r.prototype._setCondition=function(e,t){void 0===this._conditions[e]&&(this._conditions[e]=!0,this._emit(e,t))},r.prototype.getCondition=function(e){return this._conditions[e]},r.prototype.whenCondition=function(e,t){this._conditions[e]?t():this.addOneTimeEventListener(e,t)},t.Conditioned=r});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/exceptions",["require","exports","module","./util"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(r){var i=e.call(this,r)||this;return n.fixPrototype(i,t),i}return __extends(t,e),t}(Error);t.AbortTransformationException=i}),define("wed/onerror",["require","exports","module","bluebird","./log","jquery"],function(e,t){"use strict";function r(){v=!1,l&&(c.clearTimeout(l),l=void 0),m.off(),m.remove()}function n(){return v}function i(e,t){f(document.body).append(m),m.find(".save-messages")[0].innerHTML=e,m.find(".error-message")[0].textContent=t,m.on("hide.bs.modal.modal",function(){m.remove(),window.location.reload()}),m.modal()}function o(e){var t="";if("error"===e.type){var r=e.message,n=e.filename,i=e.lineno,o=e.colno,a=e.error;a?t=a.stack:(t=n+":"+i,o&&(t+="."+o),t+=": "+r)}else{t+="Unhandled promise rejection!\n";var s,u,l=e.promise?e:e.detail;l&&(s=l.reason,u=l.promise),s?(t+="Reason: ",t+=s.stack?"\n"+s.stack:s):u&&(t+="Promise: "+u)}return t}function a(e,t){var r=["<p>",e||"Your editor"];switch(r.push(" experienced a severe error."),t){case!0:r.push(" However, it successfully saved the latest state of your data to the server. Please reload.");break;default:r.push(" It was not able to save your data to the server before terminating.")}return r.push("</p>"),r.join("")}function s(e){function t(){if(l&&f.clearTimeout(l),1===s)h.push(a(void 0,u[0]?u[0][1]:void 0));else for(var e=0;e<u.length;++e){var t=u[e];h.push(a(y[t[0]].name,t[1]))}i(h.join(""),n)}function r(e){u.push([this,e])}if(e.preventDefault(),v)return!1;v=!0;var n=o(e),s=y.length,u=[],h=[],f=window;l=f.setTimeout(t,g),c=f;var m=[];p.error(n);for(var _=0;_<y.length;++_){var b=y[_],w=b._saver;if(w){var E=r.bind(b);m.push(w.recover().then(E,E))}}return d.all(m).then(t),!1}function u(e){try{try{s(e)}catch(t){i("","Error while trying to handle fatal error: "+t.toString())}}catch(t){console.error("Error while trying to handle fatal error:"),console.error(t)}}var l,c,h="undefined"!=typeof __WED_TESTING&&__WED_TESTING.testing,d=e("bluebird"),p=e("./log"),f=e("jquery"),m=f('<div class="modal wed-fatal-modal" style="position: absolute" tabindex="1">  <div class="modal-dialog">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal"aria-hidden="true">&times;</button>        <h3>Fatal Error</h3>      </div>      <div class="modal-body">        <div class="save-messages"></div>        <div class="error-message"></div>      </div>      <div class="modal-footer">        <a href="#" class="btn btn-primary" data-dismiss="modal">Reload</a>      </div>    </div>  </div></div>'),v=!1;t.is_terminating=n,h&&(t.__test={$modal:m,reset:r});var y=[],g=5e3;t.handler=u,t.editors=y}),define("is-plain-obj",["require","exports","module"],function(e,t,r){var n=Object.prototype.toString;return r.exports=function(e){var t;return"[object Object]"===n.call(e)&&(t=Object.getPrototypeOf(e),null===t||t===Object.getPrototypeOf({}))},r.exports}),define("merge-options",["require","exports","module","is-plain-obj"],function(e,t,r){function n(e){var t=[];for(var r in e)h.call(e,r)&&t.push(r);if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(e),i=0;i<n.length;i++)d.call(e,n[i])&&t.push(n[i]);return t}function i(e){return Array.isArray(e)?o(e):c(e)?a(e):e}function o(e){var t=e.slice(0,0);return n(e).forEach(function(r){t[r]=i(e[r])}),t}function a(e){var t=null===Object.getPrototypeOf(e)?Object.create(null):{};return n(e).forEach(function(r){t[r]=i(e[r])}),t}function s(e,t,r,n){return r.forEach(function(r){r in e?e[r]=l(e[r],t[r],n):e[r]=i(t[r])}),e}function u(e,t,r){var o=e.slice(0,0),a=0;return[e,t].forEach(function(t){for(var u=[],l=0;l<t.length;l++)h.call(t,l)&&(u.push(String(l)),t===e?o[a++]=t[l]:o[a++]=i(t[l]));o=s(o,t,n(t).filter(function(e){return-1===u.indexOf(e)}),r)}),o}function l(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?u(e,t,r):c(t)&&c(e)?s(e,t,n(t),r):i(t)}var c=e("is-plain-obj"),h=Object.prototype.hasOwnProperty,d=Object.propertyIsEnumerable,p=this,f={concatArrays:!1};return r.exports=function(){for(var e=l(i(f),this!==p&&this||{},f),t={},r=0;r<arguments.length;r++){var n=arguments[r];if(void 0!==n){if(!c(n))throw new TypeError("`"+n+"` is not an Option Object");t=l(t,n,e)}}return t},r.exports}),define("wed/gui/notify",["require","exports","module","jquery","merge-options","bootstrap-notify"],function(e,t,r,n,i){"use strict";function o(e,t){var r=i({element:"body",type:"info",placement:{from:"top",align:"center"},delay:1e3},t);n.notify({message:e},r)}Object.defineProperty(t,"__esModule",{value:!0}),t.notify=o}),define("wed/wed_core",["require","exports","module","jquery","./log","./domutil","./oop","./wundo","./lib/simple_event_emitter","./lib/conditioned","./exceptions","./onerror","bootstrap","./gui/notify"],function(e,t){"use strict";function r(){u.call(this),l.call(this),this._mode_data={},this._development_mode=!1,this._text_undo_max_length=10,h.editors.push(this)}var n=e("jquery"),i=e("./log"),o=e("./domutil"),a=e("./oop"),s=e("./wundo"),u=e("./lib/simple_event_emitter").SimpleEventEmitter,l=e("./lib/conditioned").Conditioned,c=e("./exceptions"),h=e("./onerror");e("bootstrap");var d=e("./gui/notify").notify,p=o.isAttr,f=o.closestByClass,m=c.AbortTransformationException;t.version="0.29.0",a.implement(r,u),a.implement(r,l);var v=r.prototype;v.fireTransformation=function(e,t){this._dismissDropdownMenu();var r=this._undo.getGroup();r instanceof s.TextUndoGroup&&this._undo.endGroup();var n=new s.UndoGroup("Undo "+e.getDescriptionFor(t),this);this._undo.startGroup(n),this.caretManager.mark.suspend(),this._enterTaskSuspension();try{try{this._fireTransformation(e,t)}catch(o){throw o instanceof m||i.handle(o),o}finally{do r=this._undo.getGroup(),this._undo.endGroup();while(r!==n)}}catch(o){if(this.undo(),!(o instanceof m))throw o}finally{this.caretManager.mark.resume(),this._exitTaskSuspension(),this.validationController.refreshErrors()}},v._enterTaskSuspension=function(){0===this._taskSuspension&&this._stopAllTasks(),this._taskSuspension++},v._exitTaskSuspension=function(){if(this._taskSuspension--,this._taskSuspension<0)throw new Error("_exitTaskSuspension underflow");0===this._taskSuspension&&this._resumeAllTasks()},v._stopAllTasks=function(){for(var e=0;e<this._taskRunners.length;++e){var t=this._taskRunners[e];t.stop()}this.validationController.stop()},v._resumeAllTasks=function(){for(var e=0;e<this._taskRunners.length;++e){var t=this._taskRunners[e];t.resume()}this.validationController.resume()},v._resumeTaskWhenPossible=function(e){0===this._taskSuspension&&e.resume()},v._fireTransformation=function(e,t){var r=t.node;if(void 0!==r)if(this.gui_root.contains(r)){var n=this.nodeToPath(r);t.node=this.data_updater.pathToNode(n)}else{var i=p(r)?r.ownerElement:r;if(!this.data_root.contains(i))throw new Error("node is neither in the gui tree nor the data tree")}var o=t.moveCaretTo;if(o&&this.caretManager.setCaret(o),void 0===this.caretManager.caret)throw new Error("transformation applied with undefined caret.");e.handler(this,t)},v.recordUndo=function(e){this._undo.record(e)},v.undo=function(){this.caretManager.mark.suspend(),this._enterTaskSuspension(),this._undo_recorder.suppressRecording(!0),this._undo.undo(),this._undo_recorder.suppressRecording(!1),this.caretManager.mark.resume(),this._exitTaskSuspension()},v.redo=function(){this.caretManager.mark.suspend(),this._enterTaskSuspension(),this._undo_recorder.suppressRecording(!0),this._undo.redo(),this._undo_recorder.suppressRecording(!1),this.caretManager.mark.resume(),this._exitTaskSuspension()},v.dumpUndo=function(){console.log(this._undo.toString())},v.undoMarker=function(e){this.recordUndo(new s.MarkerUndo(e))},v.undoingOrRedoing=function(){return this._undo.undoingOrRedoing()},v.isAttrProtected=function(e,t){var r;if(e instanceof this.my_window.Attr)r=e.name;else if(e instanceof this.my_window.Element)r=o.siblingByClass(e,"_attribute_name").textContent;else if("string"==typeof e&&(r=e,!t))throw new Error("must specify a parent");return"xmlns"===r||0===r.lastIndexOf("xmlns:",0)},v.save=function(){return this._saver.save()},v._initiateTextUndo=function(){var e=this._undo.getGroup();return void 0!==e&&e instanceof s.TextUndoGroup||(e=new s.TextUndoGroup("text",this,this._undo,this._text_undo_max_length),this._undo.startGroup(e)),e},v._terminateTextUndo=function(){var e=this._undo.getGroup();e instanceof s.TextUndoGroup&&this._undo.endGroup()},v._normalizeEnteredText=function(e){return this._normalize_entered_spaces?e.replace(this._stripped_spaces,"").replace(this._replaced_spaces," "):e},v._compensateForAdjacentSpaces=function(e,t){if(!this._normalize_entered_spaces)return e;var r=t.toArray();return" "===e[0]&&" "===o.getCharacterImmediatelyBefore(r)&&(e=e.slice(1)),e&&" "===e[e.length-1]&&" "===o.getCharacterImmediatelyAt(r)&&(e=e.slice(-1)),e},v._insertText=function(e){if(this._closeAllTooltips(),e=this._normalizeEnteredText(e),""!==e){var t=this.caretManager.caret;if(void 0!==t){var r=f(t.node,"_real",this.gui_root);if(r&&!r.classList.contains("_readonly")){this._enterTaskSuspension();try{var n=f(t.node,"_attribute_value",this.gui_root);if(n)this._spliceAttribute(n,t.offset,0,e);else{if(t=this.caretManager.getDataCaret(),e=this._compensateForAdjacentSpaces(e,t),""===e)return;var i=this._initiateTextUndo(),o=this.data_updater.insertText(t,e),a=o[0];if(void 0===a)this.caretManager.setCaret(o[1],e.length,{textEdit:!0});else{var s;s=a===t.node?t.offset+e.length:t.node.childNodes[t.offset]===a?e.length:a.nodeValue.length,this.caretManager.setCaret(a,s,{textEdit:!0})}i.recordCaretAfter()}}finally{this._exitTaskSuspension(),this.validationController.refreshErrors()}}}}},v._spliceAttribute=function(e,t,r,i){if(!(0>t||this.isAttrProtected(e))){var a=this.toDataNode(e).value;if(!(t>a.length||t===a.length&&r>0)){this._normalize_entered_spaces&&(" "===i[0]&&" "===a[t-1]&&(i=i.slice(1))," "===i[i.length-1]&&" "===a[t+r]&&(i=i.slice(-1)));var s=this._initiateTextUndo();a=a.slice(0,t)+i+a.slice(t+r),t+=i.length;var u=n.data(f(e,"_real"),"wed_mirror_node"),l=this.nodeToPath(e),c=o.siblingByClass(e,"_attribute_name").textContent,h=this.resolver.resolveName(c,!0);this.data_updater.setAttributeNS(u,h.ns,h.name,a);var d=this.pathToNode(l);d.firstChild&&(d=d.firstChild),this.caretManager.setCaret(d,t,{textEdit:!0}),s.recordCaretAfter()}}},v.insertTransientPlaceholderAt=function(e){var t=n("<span class='_placeholder _transient' contenteditable='false'> </span>",e.node.ownerDocument)[0];return this._gui_updater.insertNodeAt(e,t),t},v.toDataNode=function(e){if(e.nodeType===Node.ELEMENT_NODE){var t=n.data(e,"wed_mirror_node");if(t)return t}return this.data_updater.pathToNode(this.nodeToPath(e))},v._onSaverSaved=function(){d("Saved",{type:"success"}),this._refreshSaveStatus(),this._emit("saved")},v._onSaverAutosaved=function(){d("Autosaved",{type:"success"}),this._refreshSaveStatus(),this._emit("autosaved")},v._onSaverChanged=function(){this._refreshSaveStatus()},v._onSaverFailed=function(e){this._refreshSaveStatus();var t=this,r=e.error;"too_old"===r.type?this._too_old_modal.modal(this.my_window.location.reload.bind(this.my_window.location)):"save_disconnected"===r.type?this._disconnect_modal.modal(function(){t.save()}):"save_edited"===r.type?this._edited_by_other_modal.modal(function(){t.my_window.location.reload()}):d("Failed to save!\n"+r.msg,{type:"danger"})},v.nodeToPath=function(e){return this.gui_dloc_root.nodeToPath(e)},v.pathToNode=function(e){return this.gui_dloc_root.pathToNode(e)},v.getModeData=function(e){return this._mode_data[e]},v.setModeData=function(e,t){this._mode_data[e]=t},v.destroy=function(){if(this._destroying=!0,!this._destroyed){var e=h.editors.indexOf(this);e>=0&&h.editors.splice(e,1),this._saver&&this._saver.setAutosaveInterval(0),this._save_status_interval&&clearInterval(this._save_status_interval);try{this.validationController&&this.validationController.terminate()}catch(t){i.unhandled(t)}for(var r=0;r<this._taskRunners.length;++r){var o=this._taskRunners[r];try{o.stop()}catch(t){i.unhandled(t)}}try{void 0!==this.domlistener&&(this.domlistener.stopListening(),this.domlistener.clearPending())}catch(t){i.unhandled(t)}this._current_dropdown&&this._current_dropdown.dismiss();try{this.$widget.empty(),this.$frame.find("*").off(".wed"),n(this.my_window).off(".wed")}catch(t){i.unhandled(t)}for(var a=Object.keys(this),s=0;s<a.length;++s)delete this[a[s]];this._destroyed=!0,this.destroy=function(){}}},t.Editor=r}),define("wed/dloc",["require","exports","module","jquery","rangy","./domtypeguards","./domutil"],function(e,t,r,n,i,o,a){"use strict";function s(e){var t;if(o.isAttr(e))t=e.value.length;else switch(e.nodeType){case Node.TEXT_NODE:t=e.data.length;break;case Node.DOCUMENT_NODE:case Node.ELEMENT_NODE:t=e.childNodes.length;break;default:throw new Error("unexpected node type")}return t}function u(e){for(;null!=e;){if(o.isElement(e)||o.isDocument(e)){var t=n.data(e,"wed-dloc-root");if(null!=t)return t}e=e.parentNode}}function l(e){var t=u(e);if(null==t)throw new Error("no root found");return t}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e){if(this.node=e,null!=n.data(e,"wed-dloc-root"))throw new Error("node already marked as root");n.data(e,"wed-dloc-root",this)}return e.prototype.nodeToPath=function(e){if(null==e)throw new Error("invalid node parameter");var t=this.node;if(t===e)return"";var r=e;if(o.isAttr(e)&&(r=e.ownerElement),!t.contains(r))throw new Error("node is not a descendant of root");for(var n=[];e!==t;){var i=void 0;if(o.isAttr(e))i=e.ownerElement,n.unshift("@"+e.name);else{var a=0;i=e.parentNode;for(var s=e.previousSibling;null!==s;){var u=s.nodeType;(u===Node.TEXT_NODE||u===Node.ELEMENT_NODE)&&a++,s=s.previousSibling}n.unshift(String(a))}e=i}return n.join("/")},e.prototype.pathToNode=function(e){var t=this.node;if(""===e)return t;var r,n=e.split(/\//),i=t;"@"===n[n.length-1][0]&&(r=n.pop());for(var a=0,s=n;a<s.length;a++){var u=s[a];if(!/^(\d+)$/.test(u))throw new Error("malformed path expression");for(var l=parseInt(u),c=null,h=i.firstChild;null!==h&&null===c;){var d=h.nodeType;(d===Node.TEXT_NODE||d===Node.ELEMENT_NODE)&&--l<0&&(c=h),h=h.nextSibling}if(null===c)return null;i=c}if(void 0===r)return i;if(!o.isElement(i))throw new Error("parent must be an element since we are looking for an attribute");return i.getAttributeNode(r.slice(1))},e}();t.DLocRoot=c;var h=function(){function e(e,t,r){this.root=e,this.node=t,this.offset=r}return e.prototype.clone=function(){return new e(this.root,this.node,this.offset)},e.makeDLoc=function(t,r,i,u){if(r instanceof Array&&(u=i,d=r,r=d[0],i=d[1]),void 0===u&&(u=!1),null!=r){if(void 0===i){var l=r.parentNode;if(null===l)throw new Error("trying to get parent of a detached node");i=a.indexOf(l.childNodes,r),r=l}else{if("number"!=typeof i)throw new Error("offset is not a number, somehow");if(0>i){if(!u)throw new Error("negative offsets are not allowed");i=0}}if(t instanceof c)t=t.node;else if(null==n.data(t,"wed-dloc-root"))throw new Error("root has not been marked as a root");if(o.isAttr(r)){if(!t.contains(r.ownerElement))throw new Error("node not in root")}else if(!t.contains(r))throw new Error("node not in root");var h=s(r);if(i>h){if(!u)throw new Error("offset greater than allowable value");i=h}return new e(t,r,i);var d}},e.mustMakeDLoc=function(e,t,r,n){var i=t;if(i instanceof Array&&(i=i[0]),null==i)throw new Error("called mustMakeDLoc with an absent node");return this.makeDLoc.apply(this,arguments)},e.prototype.make=function(t,r){if(t instanceof Array)return e.mustMakeDLoc(this.root,t);if(void 0!==r&&"number"!=typeof r)throw new Error("if the 1st argument is a node, the 2nd must be a number or undefined");return e.mustMakeDLoc(this.root,t,r)},e.prototype.makeWithOffset=function(e){return e===this.offset?this:this.make(this.node,e)},e.prototype.getLocationInParent=function(){var e=this.node,t=e.parentNode;if(null===t)throw new Error("trying to get parent of a detached node");return this.make(t,a.indexOf(t.childNodes,e))},e.prototype.getLocationAfterInParent=function(){var e=this.node,t=e.parentNode;if(null===t)throw new Error("trying to get parent of a detached node");return this.make(t,a.indexOf(t.childNodes,e)+1)},e.prototype.toArray=function(){return[this.node,this.offset]},e.prototype.makeRange=function(e){if(o.isAttr(this.node))throw new Error("cannot make range from attribute node");if(this.isValid()){if(void 0===e){var t=i.createRange(this.node.ownerDocument);return t.setStart(this.node,this.offset),t}if(o.isAttr(e.node))throw new Error("cannot make range from attribute node");if(e.isValid())return a.rangeFromPoints(this.node,this.offset,e.node,e.offset)}},e.prototype.isValid=function(){var e=this.node;return this.root.contains(o.isAttr(e)?e.ownerElement:e)&&this.offset<=s(e)},e.prototype.normalizeOffset=function(){var e=this.node,t=s(e);return this.offset>t?this.make(e,t):this},e.prototype.equals=function(e){return null==e?!1:this===e||this.node===e.node&&this.offset===e.offset},e}();t.DLoc=h,t.findRoot=u,t.getRoot=l});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/guiroot",["require","exports","module","./dloc","./domtypeguards","./domutil","./util"],function(e,t,r,n,i,o,a){"use strict";function s(e){if(!i.isElement(e)||!e.classList.contains("_phantom_wrap"))throw new Error("the node should be a _phantom_wrap element");for(var t=0,r=e.firstChild;null!==r;){if(i.isElement(r)){if(r.classList.contains("_phantom_wrap"))t+=s(r);else if(r.classList.contains("_real"))t+=1;else if(!r.classList.contains("_phantom"))throw new Error("unexpected element in _phantom_wrap")}else if(r.nodeType!==Node.TEXT_NODE)throw new Error("unexpected node in _phantom_wrap");r=r.nextSibling}return t}function u(e,t){if(!i.isElement(e)||!e.classList.contains("_phantom_wrap"))throw new Error("the node should be a _phantom_wrap element");for(var r=t,n=null,o=e.firstChild;null===n&&null!==o;){if(i.isElement(o)){if(o.classList.contains("_phantom_wrap")){var a=u(o,t);null!==a.found&&(n=a.found),t-=a.count}else if(o.classList.contains("_real"))t-=1,0>t&&(n=o);else if(!o.classList.contains("_phantom"))throw new Error("unexpected element in _phantom_wrap")}else if(o.nodeType!==Node.TEXT_NODE)throw new Error("unexpected node in _phantom_wrap");o=o.nextSibling}return{found:n,count:r-t}}Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(r){var n=e.call(this,r)||this;return a.fixPrototype(n,t),n}return __extends(t,e),t}(Error);t.AttributeNotFound=l;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.nodeToPath=function(e){var t=this.node;if(null!==o.closestByClass(e,"_placeholder",t))throw new Error("cannot provide path to node because it is a placeholder node");if(t===e)return"";if(!t.contains(e))throw new Error("node is not a descendant of root");for(var r=[];e!==t;){var n=void 0;if(i.isElement(e)&&!e.matches("._real, ._phantom_wrap, ._attribute_value"))throw new Error("only nodes of class ._real, ._phantom_wrap, and ._attribute_value are supported");var a=o.closestByClass(e,"_attribute_value",t);if(null!==a){var u=o.siblingByClass(a,"_attribute_name");if(null===u)throw new Error("no attribute name found");if(r.unshift("@"+u.textContent),n=o.closestByClass(a,"_real",t),null===n)throw new Error("attribute is detached from real element")}else{if(n=e.parentNode,null===n)throw new Error("detached node");for(var l=0,c=o.indexOf(n.childNodes,e),h=0;c>h;++h){var u=n.childNodes[h];i.isText(u)||i.isElement(u)&&u.classList.contains("_real")?l++:i.isElement(u)&&u.classList.contains("_phantom_wrap")&&(l+=s(u))}i.isElement(n)&&n.classList.contains("_phantom_wrap")||r.unshift(String(l))}e=n}return r.join("/")},t.prototype.pathToNode=function(e){var t=this.node;if(""===e)return t;var r,n=e.split(/\//),a=t;"@"===n[n.length-1][0]&&(r=n.pop());for(var s=null,c=0,h=n;c<h.length;c++){var d=h[c],p=/^(\d+)$/.exec(d);if(null===p)throw new Error("malformed path expression");s=null;for(var f=parseInt(p[1]),m=0;null===s&&m<a.childNodes.length;m++){var v=a.childNodes[m];if((i.isText(v)||i.isElement(v)&&v.classList.contains("_real"))&&--f<0)s=v;else if(i.isElement(v)&&v.classList.contains("_phantom_wrap")){var y=u(v,f);null!==y.found&&(s=y.found),f-=y.count}}if(null===s)return null;a=s}if(void 0!==r){var g=r.slice(1);if(!i.isElement(a))throw new Error("looking for attribute on something which is not an element");var _=a.getElementsByClassName("_attribute_name");s=null;for(var b=0;b<_.length;++b){var w=_[b];if(w.textContent===g){s=w;break}}if(null===s)throw new l("could not find attribute with name: "+g);a=o.siblingByClass(s,"_attribute_value")}return a},t}(n.DLocRoot);t.GUIRoot=c}),define("wed/wed-util",["require","exports","module","./dloc","./domtypeguards","./domutil","./guiroot"],function(e,t,r,n,i,o,a){"use strict";function s(e,t){var r=e.parentNode;return t.contains(r)?u(n.DLoc.mustMakeDLoc(t,e)):{left:0,top:0,bottom:0}}function u(e){var t,r=e.node,n=e.offset,o=i.isElement(r),a=i.isText(r);if(o)t=r.childNodes.length;else{if(!a)throw new Error("unexpected node type: "+r.nodeType);t=r.length}if(0===t)return s(r,e.root);for(var u,l,c=r.ownerDocument.createRange();t>n;){if(l=r.childNodes[n],i.isElement(l)?u=l.getClientRects()[0]:(c.setStart(r,n),c.setEnd(r,n+1),u=c.getClientRects()[0]),null!=u&&(0!==u.left||0!==u.right||0!==u.top||0!==u.bottom))return{left:u.left,top:u.top,bottom:u.bottom};n++}n=e.offset;for(var h=r.ownerDocument.defaultView;0!==n;){n--,l=void 0;var d=void 0;if(a)d=!0;else{if(!o)throw new Error("unexpected node type: "+r.nodeType);if(l=r.childNodes[n],i.isText(l))d=!0;else{if(!i.isElement(l))throw new Error("unexpected node type: "+l.nodeType);var p=h.getComputedStyle(l).getPropertyValue("display");d="inline"===p||"inline-block"===p}}var f=void 0;if(i.isElement(l)?f=l.getClientRects():(c.setStart(r,n),c.setEnd(r,n+1),f=c.getClientRects()),u=f[f.length-1],null!=u)return d?{left:u.right,top:u.top,bottom:u.bottom}:{left:u.left,top:u.top,bottom:u.bottom}}return s(r,e.root)}function l(e){if(!e.classList.contains("_attribute_value"))throw new Error("getAttrValueNode operates only on attribute values");var t=e,r=e.firstChild;if(null!==r){for(;null!==r&&!i.isText(r);)r=r.nextSibling;null!==r&&(t=r)}return t}function c(e){var t=e.caretManager,r=t.sel;if(!r.wellFormed)throw new Error("malformed range");for(var n=r.asDataCarets(),a=n[0],s=n[1];null!==e._cut_buffer.firstChild;)e._cut_buffer.removeChild(e._cut_buffer.firstChild);if(i.isAttr(a.node)){var u=a.node;if(u!==s.node)throw new Error("attribute selection that does not start and end in the same attribute");var l=u.value.slice(a.offset,s.offset);e._spliceAttribute(o.closestByClass(t.fromDataLocation(a).node,"_attribute_value"),a.offset,s.offset-a.offset,""),e._cut_buffer.textContent=l}else{for(var c=e.data_updater.cut(a,s),h=c[1],d=new e.my_window.DOMParser,p=d.parseFromString("<div></div>","text/xml"),f=0,m=h;f<m.length;f++){var v=m[f];p.firstChild.appendChild(p.adoptNode(v))}e._cut_buffer.textContent=p.firstChild.innerHTML,e.caretManager.setCaret(c[0])}var y=e.doc.createRange(),g=e._cut_buffer;y.setStart(g,0),y.setEnd(g,g.childNodes.length);var _=e.my_window.getSelection();_.removeAllRanges(),_.addRange(y),setTimeout(function(){t.focusInputField()},0)}function h(e,t){var r,n,a=t.to_paste,s=a.cloneNode(!0),u=e.caretManager.getDataCaret();if(1===a.childNodes.length&&i.isText(a.firstChild))if(i.isAttr(u.node)){var l=e.caretManager.getNormalizedCaret();e._spliceAttribute(o.closestByClass(l.node,"_attribute_value",l.node),l.offset,0,a.firstChild.data)}else n=e.data_updater.insertText(u,a.firstChild.data),r=n[0]===n[1]&&n[1]===u.node?u.make(u.node,u.offset+a.firstChild.length):u.make(n[1],n[1].length);else{for(var c=document.createDocumentFragment();null!==a.firstChild;)c.appendChild(a.firstChild);switch(u.node.nodeType){case Node.TEXT_NODE:n=e.data_updater.insertIntoText(u,c),r=n[1];break;case Node.ELEMENT_NODE:var h=u.node.childNodes[u.offset],d=null!=h?h.nextSibling:null;e.data_updater.insertBefore(u.node,c,h),r=u.makeWithOffset(null!==d?o.indexOf(u.node.childNodes,d):u.node.childNodes.length);break;default:throw new Error("unexpected node type: "+u.node.nodeType)}}null!=r&&(e.caretManager.setCaret(r),u=r),e.$gui_root.trigger("wed-post-paste",[t.e,u,s])}function d(e,t){if(null!=t)try{var r=e.caretManager.fromDataLocation(t,0);return null!=r?r.node:void 0}catch(n){if(n instanceof a.AttributeNotFound)return;throw n}}Object.defineProperty(t,"__esModule",{value:!0}),t.boundaryXY=u,t.getAttrValueNode=l,t.cut=c,t.paste=h,t.getGUINodeIfExists=d}),define("wed/build-info",[],function(){return{desc:"v0.28.2-152-g4525c15d-unclean",date:"Thu Jul 20 2017 09:24:37 GMT-0400 (EDT)"}}),define("wed/object-check",["require","exports","module"],function(e,t,r){"use strict";function n(e,t){var r=e[t];if("object"==typeof r){for(var i in r)if(n(r,i))return!0;return!1}return r}function i(e,t,r,o){for(var a in e)if(n(e,a)){var s=void 0!==r?[r,a].join("."):a;if(a in t){var u=t[a],l=e[a];u instanceof Array||"object"!=typeof u||"object"!=typeof l||i(l,u,s,o)}else o.missing.push(s)}for(var c in t)if(!(c in e)){var s=void 0!==r?[r,c].join("."):c;o.extra.push(s)}}function o(e,t){var r={missing:[],extra:[]};i(e,t,void 0,r);var n=r;for(var o in n)0===n[o].length&&delete n[o];return n}Object.defineProperty(t,"__esModule",{value:!0}),t.check=o,t.check=o}),define("wed/preferences",["require","exports","module","lodash","./object-check"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={tooltips:!1},a=function(){function e(e){return void 0===e?(this.prefs=Object.create(null),void this._validatePrefs(this.prefs)):(this._validatePrefs(e),void(this.prefs=n.extend(Object.create(null),e)))}return e.prototype._validatePrefs=function(e){var t=i.check(o,e);if(void 0!==t.missing)throw new Error("missing option: "+t.missing[0]);
if(void 0!==t.extra)throw new Error("extra option: "+t.extra[0])},e.prototype.get=function(e){for(var t=e.split("."),r=0,n=this.prefs;r<t.length;){var i=t[r];if(""===i)throw new Error("empty part in "+e);if(n=n[i],void 0===n)return;++r}return n},e.prototype.set=function(e,t){for(var r=e.split("."),n=0,i=this.prefs;n<r.length-1;){var o=r[n];if(""===o)throw new Error("empty part in "+e);i=i[o],void 0===i&&(i=i[o]=Object.create(null)),++n}i[r[n]]=t,this._validatePrefs(this.prefs)},e}();t.Preferences=a}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("rxjs",["exports"],t):t(e.Rx=e.Rx||{})}(this,function(e){"use strict";function t(e,t){function r(){this.constructor=e}tr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function r(e){return"function"==typeof e}function n(e){return null!=e&&"object"==typeof e}function i(){try{return nr.apply(this,arguments)}catch(e){return or.e=e,or}}function o(e){return nr=e,i}function a(e){return e.reduce(function(e,t){return e.concat(t instanceof ar?t.errors:t)},[])}function s(e,t,r){if(e){if(e instanceof hr)return e;if(e[cr])return e[cr]()}return e||t||r?new hr(e,t,r):new hr(ur)}function u(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}function l(e){var t=e.value,r=e.subject;r.next(t),r.complete()}function c(e){var t=e.err,r=e.subject;r.error(t)}function h(e){var t=this,r=e.source,n=e.subscriber,i=e.context,a=r,s=a.callbackFunc,u=a.args,l=a.scheduler,c=r.subject;if(!c){c=r.subject=new br;var h=function m(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=m.source,i=n.selector,a=n.subject,s=e.shift();if(s)a.error(s);else if(i){var u=o(i).apply(this,e);u===or?t.add(l.schedule(p,0,{err:or.e,subject:a})):t.add(l.schedule(d,0,{value:u,subject:a}))}else{var c=1===e.length?e[0]:e;t.add(l.schedule(d,0,{value:c,subject:a}))}};h.source=r;var f=o(s).apply(i,u.concat(h));f===or&&c.error(or.e)}t.add(c.subscribe(n))}function d(e){var t=e.value,r=e.subject;r.next(t),r.complete()}function p(e){var t=e.err,r=e.subject;r.error(t)}function f(e){return e&&"function"==typeof e.schedule}function m(e){return e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}function v(e){var t=e.Symbol;if("function"==typeof t)return t.iterator||(t.iterator=t("iterator polyfill")),t.iterator;var r=e.Set;if(r&&"function"==typeof(new r)["@@iterator"])return"@@iterator";var n=e.Map;if(n)for(var i=Object.getOwnPropertyNames(n.prototype),o=0;o<i.length;++o){var a=i[o];if("entries"!==a&&"size"!==a&&n.prototype[a]===n.prototype.entries)return a}return"@@iterator"}function y(e,t,r,i){var o=new Ar(e,r,i);if(o.closed)return null;if(t instanceof fr)return t._isScalar?(o.next(t.value),o.complete(),null):t.subscribe(o);if(ir(t)){for(var a=0,s=t.length;s>a&&!o.closed;a++)o.next(t[a]);o.closed||o.complete()}else{if(m(t))return t.then(function(e){o.closed||(o.next(e),o.complete())},function(e){return o.error(e)}).then(null,function(e){rr.setTimeout(function(){throw e})}),o;if(t&&"function"==typeof t[kr])for(var u=t[kr]();;){var l=u.next();if(l.done){o.complete();break}if(o.next(l.value),o.closed)break}else if(t&&"function"==typeof t[pr]){var c=t[pr]();if("function"==typeof c.subscribe)return c.subscribe(new Ar(e,r,i));o.error(new TypeError("Provided object does not correctly implement Symbol.observable"))}else{var h=n(t)?"an invalid object":"'"+t+"'",d="You provided "+h+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";o.error(new TypeError(d))}}return null}function g(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=null;return"function"==typeof e[e.length-1]&&(r=e.pop()),1===e.length&&ir(e[0])&&(e=e[0].slice()),e.unshift(this),this.lift.call(new Tr(e),new Ir(r))}function _(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=null,n=null;return f(e[e.length-1])&&(n=e.pop()),"function"==typeof e[e.length-1]&&(r=e.pop()),1===e.length&&ir(e[0])&&(e=e[0]),new Tr(e,n).lift(new Ir(r))}function b(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),this.lift(new jr(e))}function w(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.lift.call(E.apply(void 0,[this].concat(e)))}function E(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=null,n=e;return f(n[e.length-1])&&(r=n.pop()),null===r&&1===e.length?e[0]:new Tr(e,r).lift(new jr(1))}function x(e){var t=e.value,r=e.subscriber;r.closed||(r.next(t),r.complete())}function N(e){var t=e.err,r=e.subscriber;r.closed||r.error(t)}function S(e){var t=e[kr];if(!t&&"string"==typeof e)return new zr(e);if(!t&&void 0!==e.length)return new Gr(e);if(!t)throw new TypeError("object is not iterable");return e[kr]()}function C(e){var t=+e.length;return isNaN(t)?0:0!==t&&T(t)?(t=P(t)*Math.floor(Math.abs(t)),0>=t?0:t>Kr?Kr:t):t}function T(e){return"number"==typeof e&&rr.isFinite(e)}function P(e){var t=+e;return 0===t?t:isNaN(t)?t:0>t?-1:1}function k(e,t){return void 0===t&&(t=0),this.lift(new Yr(e,t))}function A(e){return!!e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}function O(e){return!!e&&"function"==typeof e.on&&"function"==typeof e.off}function I(e){return!!e&&"[object NodeList]"===nn.call(e)}function R(e){return!!e&&"[object HTMLCollection]"===nn.call(e)}function j(e){return!!e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}function D(e){return!ir(e)&&e-parseFloat(e)+1>=0}function M(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.lift.call(L.apply(void 0,[this].concat(e)))}function L(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=Number.POSITIVE_INFINITY,n=null,i=e[e.length-1];return f(i)?(n=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(r=e.pop())):"number"==typeof i&&(r=e.pop()),null===n&&1===e.length?e[0]:new Tr(e,n).lift(new jr(r))}function F(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 1===e.length&&ir(e[0])&&(e=e[0]),this.lift.call(V.apply(void 0,[this].concat(e)))}function V(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];if(1===e.length){if(!ir(e[0]))return e[0];e=e[0]}return new Tr(e).lift(new xn)}function B(){}function $(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 1===e.length&&ir(e[0])&&(e=e[0]),this.lift(new Pn(e))}function H(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=null;return 1===e.length&&ir(e[0])&&(e=e[0]),r=e.shift(),new tn(r,null).lift(new Pn(e))}function W(e){var t=e.obj,r=e.keys,n=e.length,i=e.index,o=e.subscriber;if(i===n)return void o.complete();var a=r[i];o.next([a,t[a]]),e.index=i+1,this.schedule(e)}function q(e){return e instanceof Date&&!isNaN(+e)}function U(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.lift.call(z.apply(void 0,[this].concat(e)))}function z(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=e[e.length-1];return"function"==typeof r&&e.pop(),new Tr(e).lift(new $n(r))}function G(e,t){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return this.lift(new Gn(e,t))}function K(){if(rr.XMLHttpRequest){var e=new rr.XMLHttpRequest;return"withCredentials"in e&&(e.withCredentials=!!this.withCredentials),e}if(rr.XDomainRequest)return new rr.XDomainRequest;throw new Error("CORS is not supported by your browser")}function X(){if(rr.XMLHttpRequest)return new rr.XMLHttpRequest;var e=void 0;try{for(var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=0;3>r;r++)try{if(e=t[r],new rr.ActiveXObject(e))break}catch(n){}return new rr.ActiveXObject(e)}catch(n){throw new Error("XMLHttpRequest is not supported by your browser")}}function Q(e,t){return void 0===t&&(t=null),new Xn({method:"GET",url:e,headers:t})}function Y(e,t,r){return new Xn({method:"POST",url:e,body:t,headers:r})}function J(e,t){return new Xn({method:"DELETE",url:e,headers:t})}function Z(e,t,r){return new Xn({method:"PUT",url:e,body:t,headers:r})}function ee(e,t){return new Xn({method:"GET",url:e,responseType:"json",headers:t}).lift(new Gn(function(e,t){return e.response},null))}function te(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=t.length,i=0;n>i;i++){var o=t[i];for(var a in o)o.hasOwnProperty(a)&&(e[a]=o[a])}return e}function re(e){return e.Object.assign||te}function ne(e){return this.lift(new li(e))}function ie(e,t){return void 0===t&&(t=null),this.lift(new hi(e,t))}function oe(e){var t=arguments.length,r=_n;f(arguments[arguments.length-1])&&(r=arguments[arguments.length-1],t--);var n=null;t>=2&&(n=arguments[1]);var i=Number.POSITIVE_INFINITY;return t>=3&&(i=arguments[2]),this.lift(new pi(e,n,i,r))}function ae(e){var t=e.subscriber,r=e.context;r&&t.closeContext(r),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function se(e){var t=e.bufferCreationInterval,r=e.bufferTimeSpan,n=e.subscriber,i=e.scheduler,o=n.openContext(),a=this;n.closed||(n.add(o.closeAction=i.schedule(ue,r,{subscriber:n,context:o})),a.schedule(e,t))}function ue(e){var t=e.subscriber,r=e.context;t.closeContext(r)}function le(e,t){return this.lift(new vi(e,t))}function ce(e){return this.lift(new gi(e))}function he(e){var t=new bi(e),r=this.lift(t);return t.caught=r}function de(e){return this.lift(new Ir(e))}function pe(){return this.lift(new jr(1))}function fe(e,t,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"number"==typeof t&&(r=t,t=null),this.lift(new Ei(e,t,r))}function me(e,t){return this.lift(new Ei(e,t,1))}function ve(e,t,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"number"==typeof t&&(r=t,t=null),this.lift(new Ni(e,t,r))}function ye(e,t){return this.lift(new Ni(e,t,1))}function ge(e){return this.lift(new Ci(e,this))}function _e(){return this.lift(new Pi)}function be(e){return this.lift(new Ai(e))}function we(e,t){return void 0===t&&(t=_n),this.lift(new Ii(e,t))}function Ee(e){e.debouncedNext()}function xe(e){return void 0===e&&(e=null),this.lift(new ji(e))}function Ne(e,t){void 0===t&&(t=_n);var r=q(e),n=r?+e-t.now():Math.abs(e);return this.lift(new Mi(n,t))}function Se(e,t){return t?new $i(this,t).lift(new Vi(e)):this.lift(new Vi(e))}function Ce(){return function(){function e(){this._values=[]}return e.prototype.add=function(e){this.has(e)||this._values.push(e)},e.prototype.has=function(e){return-1!==this._values.indexOf(e)},Object.defineProperty(e.prototype,"size",{get:function(){return this._values.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._values.length=0},e}()}function Te(e,t){return this.lift(new qi(e,t))}function Pe(e,t){return this.lift(new zi(e,t))}function ke(e,t){return Pe.call(this,function(r,n){return t?t(r[e],n[e]):r[e]===n[e]})}function Ae(e,t,r){return this.lift(new Ki(e,t,r))}function Oe(){return this.lift(new Qi)}function Ie(e,t){return this.lift(new Ji(e,t))}function Re(e,t,r){return void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===r&&(r=void 0),t=1>(t||0)?Number.POSITIVE_INFINITY:t,this.lift(new eo(e,t,r))}function je(e,t){return this.lift(new no(e,t))}function De(e,t){return this.lift(new oo(e,t))}function Me(e){return this.lift(new so(e))}function Le(e,t){if("function"!=typeof e)throw new TypeError("predicate is not a function");return this.lift(new lo(e,this,!1,t))}function Fe(e,t){return this.lift(new lo(e,this,!0,t))}function Ve(e,t,r){return this.lift(new po(e,t,r,this))}function Be(e,t,r,n){return this.lift(new go(e,t,r,n))}function $e(){return this.lift(new xo)}function He(){return this.lift(new So)}function We(e){return this.lift(new To(e))}function qe(e,t){return void 0===t&&(t=_n),this.lift(new ko(e,t))}function Ue(e){e.clearThrottle()}function ze(e,t,r){return this.lift(new Oo(e,t,r,this))}function Ge(e){return e(this)}function Ke(e,t){return this.lift(new Ro(e,t,this))}function Xe(e){return this.lift(new Do(e))}function Qe(){return this.lift(new Lo)}function Ye(e,t){var r=!1;return arguments.length>=2&&(r=!0),this.lift(new Vo(e,t,r))}function Je(e){var t="function"==typeof e?function(t,r){return e(t,r)>0?t:r}:function(e,t){return e>t?e:t};return this.lift(new Vo(t))}function Ze(e,t,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),this.lift(new $o(e,t,r))}function et(e){var t="function"==typeof e?function(t,r){return e(t,r)<0?t:r}:function(e,t){return t>e?e:t};return this.lift(new Vo(t))}function tt(e,t){var r;if(r="function"==typeof e?e:function(){return e},"function"==typeof t)return this.lift(new Ko(r,t));var n=Object.create(this,qo);return n.source=this,n.subjectFactory=r,n}function rt(){return this.lift(new Xo)}function nt(e,t){function r(){return!r.pred.apply(r.thisArg,arguments)}return r.pred=e,r.thisArg=t,r}function it(e,t){return[De.call(this,e,t),De.call(this,nt(e,t))]}function ot(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=e.length;if(0===r)throw new Error("list of properties cannot be empty.");return G.call(this,at(e,r))}function at(e,t){var r=function(r){for(var n=r,i=0;t>i;i++){var o=n[e[i]];if("undefined"==typeof o)return;n=o}return n};return r}function st(e){return e?tt.call(this,function(){return new gr},e):tt.call(this,new gr)}function ut(e){return tt.call(this,new Yo(e))}function lt(e,t,r){return void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===t&&(t=Number.POSITIVE_INFINITY),tt.call(this,new ii(e,t,r))}function ct(){return tt.call(this,new br)}function ht(e){return void 0===e&&(e=-1),0===e?new Cr:0>e?this.lift(new Jo(-1,this)):this.lift(new Jo(e-1,this))}function dt(e){return this.lift(new ea(e))}function pt(e){return void 0===e&&(e=-1),this.lift(new ra(e,this))}function ft(e){return this.lift(new ia(e,this))}function mt(e){return this.lift(new aa(e))}function vt(e,t){return void 0===t&&(t=_n),this.lift(new ua(e,t))}function yt(e){var t=e.subscriber,r=e.period;t.notifyNext(),this.schedule(e,r)}function gt(e,t){var r=!1;return arguments.length>=2&&(r=!0),this.lift(new ca(e,t,r))}function _t(e,t){return this.lift(new da(e,t))}function bt(){return new gr}function wt(){return tt.call(this,bt).refCount()}function Et(e){return this.lift(new ma(e,this))}function xt(e){return this.lift(new ya(e))}function Nt(e){return this.lift(new _a(e))}function St(e){return this.lift(new wa(e))}function Ct(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=e[e.length-1];f(r)?e.pop():r=null;var n=e.length;return 1===n?E(new Sr(e[0],r),this):n>1?E(new Tr(e,r),this):E(new Cr(r),this)}function Tt(e,t){return void 0===t&&(t=0),this.lift(new ka(e,t))}function Pt(){return this.lift(new Aa)}function kt(e,t){return this.lift(new Ia(e,t))}function At(e,t){return this.lift(new ja(e,t))}function Ot(e){return 0===e?new Cr:this.lift(new Ma(e))}function It(e){return 0===e?new Cr:this.lift(new Fa(e))}function Rt(e){return this.lift(new Ba(e))}function jt(e){return this.lift(new Ha(e))}function Dt(e){return this.lift(new qa(e))}function Mt(e,t){return void 0===t&&(t=_n),this.lift(new za(e,t))}function Lt(e){var t=e.subscriber;t.clearThrottle()}function Ft(e){return void 0===e&&(e=_n),this.lift(new Xa(e))}function Vt(e,t){void 0===t&&(t=_n);var r=q(e),n=r?+e-t.now():Math.abs(e);return this.lift(new Ja(n,r,t,new Ya))}function Bt(e,t,r){void 0===r&&(r=_n);var n=q(e),i=n?+e-r.now():Math.abs(e);return this.lift(new es(i,n,t,r))}function $t(e){return void 0===e&&(e=_n),this.lift(new ns(e))}function Ht(){return this.lift(new os)}function Wt(e){var t=this;if(e||(rr.Rx&&rr.Rx.config&&rr.Rx.config.Promise?e=rr.Rx.config.Promise:rr.Promise&&(e=rr.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,r){var n;t.subscribe(function(e){return n=e},function(e){return r(e)},function(){return e(n)})})}function qt(e){return this.lift(new ss(e))}function Ut(e,t){return void 0===t&&(t=0),this.lift(new ls(e,t))}function zt(e,t,r){return void 0===t&&(t=null),void 0===r&&(r=_n),this.lift(new hs(e,t,r))}function Gt(e){var t=e.subscriber,r=e.windowTimeSpan,n=e.window;n&&t.closeWindow(n),e.window=t.openWindow(),this.schedule(e,r)}function Kt(e){var t=e.windowTimeSpan,r=e.subscriber,n=e.scheduler,i=e.windowCreationInterval,o=r.openWindow(),a=this,s={action:a,subscription:null},u={subscriber:r,window:o,context:s};s.subscription=n.schedule(Xt,t,u),a.add(s.subscription),a.schedule(e,i)}function Xt(e){var t=e.subscriber,r=e.window,n=e.context;n&&n.action&&n.subscription&&n.action.remove(n.subscription),t.closeWindow(r)}function Qt(e,t){return this.lift(new ps(e,t))}function Yt(e){return this.lift(new ms(e))}function Jt(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r;"function"==typeof e[e.length-1]&&(r=e.pop());var n=e;return this.lift(new ys(n,r))}function Zt(e){return this.lift(new $n(e))}function er(e,t){for(var r=0,n=t.length;n>r;r++)for(var i=t[r],o=Object.getOwnPropertyNames(i.prototype),a=0,s=o.length;s>a;a++){var u=o[a];e.prototype[u]=i.prototype[u]}}var tr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},rr="object"==typeof window&&window.window===window&&window||"object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if(!rr)throw new Error("RxJS could not find any global context (window, self, global)");var nr,ir=Array.isArray||function(e){return e&&"number"==typeof e.length},or={e:{}},ar=function(e){function r(t){e.call(this),this.errors=t;var r=Error.call(this,t?t.length+" errors occurred during unsubscription:\n  "+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"");this.name=r.name="UnsubscriptionError",this.stack=r.stack,this.message=r.message}return t(r,e),r}(Error),sr=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var i=this,s=i._parent,u=i._parents,l=i._unsubscribe,c=i._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var h=-1,d=u?u.length:0;s;)s.remove(this),s=++h<d&&u[h]||null;if(r(l)){var p=o(l).call(this);p===or&&(t=!0,e=e||(or.e instanceof ar?a(or.e.errors):[or.e]))}if(ir(c))for(h=-1,d=c.length;++h<d;){var f=c[h];if(n(f)){var p=o(f.unsubscribe).call(f);if(p===or){t=!0,e=e||[];var m=or.e;m instanceof ar?e=e.concat(a(m.errors)):e.push(m)}}}if(t)throw new ar(e)}},e.prototype.add=function(t){if(!t||t===e.EMPTY)return e.EMPTY;if(t===this)return this;var r=t;switch(typeof t){case"function":r=new e(t);case"object":if(r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if("function"!=typeof r._addParent){var n=r;r=new e,r._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=this._subscriptions||(this._subscriptions=[]);return i.push(r),r._addParent(this),r},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var r=t.indexOf(e);-1!==r&&t.splice(r,1)}},e.prototype._addParent=function(e){var t=this,r=t._parent,n=t._parents;r&&r!==e?n?-1===n.indexOf(e)&&n.push(e):this._parents=[e]:this._parent=e},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}(),ur={closed:!0,next:function(e){},error:function(e){throw e},complete:function(){}},lr=rr.Symbol,cr="function"==typeof lr&&"function"==typeof lr["for"]?lr["for"]("rxSubscriber"):"@@rxSubscriber",hr=function(e){function r(t,n,i){switch(e.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=ur;break;case 1:if(!t){this.destination=ur;break}if("object"==typeof t){t instanceof r?(this.destination=t,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new dr(this,t));break}default:this.syncErrorThrowable=!0,this.destination=new dr(this,t,n,i)}}return t(r,e),r.prototype[cr]=function(){return this},r.create=function(e,t,n){var i=new r(e,t,n);return i.syncErrorThrowable=!1,i},r.prototype.next=function(e){this.isStopped||this._next(e)},r.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},r.prototype._next=function(e){this.destination.next(e)},r.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var e=this,t=e._parent,r=e._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=r,this},r}(sr),dr=function(e){function n(t,n,i,o){e.call(this),this._parentSubscriber=t;var a,s=this;r(n)?a=n:n&&(s=n,a=n.next,i=n.error,o=n.complete,r(s.unsubscribe)&&this.add(s.unsubscribe.bind(s)),s.unsubscribe=this.unsubscribe.bind(this)),this._context=s,this._next=a,this._error=i,this._complete=o}return t(n,e),n.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},n.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}},n.prototype.complete=function(){if(!this.isStopped){var e=this._parentSubscriber;this._complete?e.syncErrorThrowable?(this.__tryOrSetError(e,this._complete),this.unsubscribe()):(this.__tryOrUnsub(this._complete),this.unsubscribe()):this.unsubscribe()}},n.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(r){throw this.unsubscribe(),r}},n.prototype.__tryOrSetError=function(e,t,r){try{t.call(this._context,r)}catch(n){return e.syncErrorValue=n,e.syncErrorThrown=!0,!0}return!1},n.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},n}(hr),pr=u(rr),fr=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n=this.operator,i=s(e,t,r);if(n?n.call(i,this.source):i.add(this._trySubscribe(i)),i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.syncErrorThrown=!0,e.syncErrorValue=t,e.error(t)}},e.prototype.forEach=function(e,t){var r=this;if(t||(rr.Rx&&rr.Rx.config&&rr.Rx.config.Promise?t=rr.Rx.config.Promise:rr.Promise&&(t=rr.Promise)),!t)throw new Error("no Promise impl found");return new t(function(t,n){var i=r.subscribe(function(t){if(i)try{e(t)}catch(r){n(r),i.unsubscribe()}else e(t)},n,t)})},e.prototype._subscribe=function(e){return this.source.subscribe(e)},e.prototype[pr]=function(){return this},e.create=function(t){return new e(t)},e}(),mr=function(e){function r(){var t=e.call(this,"object unsubscribed");this.name=t.name="ObjectUnsubscribedError",this.stack=t.stack,this.message=t.message}return t(r,e),r}(Error),vr=function(e){function r(t,r){e.call(this),this.subject=t,this.subscriber=r,this.closed=!1}return t(r,e),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}},r}(sr),yr=function(e){function r(t){e.call(this,t),this.destination=t}return t(r,e),r}(hr),gr=function(e){function r(){e.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return t(r,e),r.prototype[cr]=function(){return new yr(this)},r.prototype.lift=function(e){var t=new _r(this,this);return t.operator=e,t},r.prototype.next=function(e){if(this.closed)throw new mr;if(!this.isStopped)for(var t=this.observers,r=t.length,n=t.slice(),i=0;r>i;i++)n[i].next(e)},r.prototype.error=function(e){if(this.closed)throw new mr;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,r=t.length,n=t.slice(),i=0;r>i;i++)n[i].error(e);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new mr;this.isStopped=!0;for(var e=this.observers,t=e.length,r=e.slice(),n=0;t>n;n++)r[n].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(t){if(this.closed)throw new mr;return e.prototype._trySubscribe.call(this,t)},r.prototype._subscribe=function(e){if(this.closed)throw new mr;return this.hasError?(e.error(this.thrownError),sr.EMPTY):this.isStopped?(e.complete(),sr.EMPTY):(this.observers.push(e),new vr(this,e))},r.prototype.asObservable=function(){var e=new fr;return e.source=this,e},r.create=function(e,t){return new _r(e,t)},r}(fr),_r=function(e){function r(t,r){e.call(this),this.destination=t,this.source=r}return t(r,e),r.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},r.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},r.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},r.prototype._subscribe=function(e){var t=this.source;return t?this.source.subscribe(e):sr.EMPTY},r}(gr),br=function(e){function r(){e.apply(this,arguments),this.value=null,this.hasNext=!1,this.hasCompleted=!1}return t(r,e),r.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),sr.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),sr.EMPTY):e.prototype._subscribe.call(this,t)},r.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},r.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},r.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},r}(gr),wr=function(e){function r(t,r,n,i,o){e.call(this),this.callbackFunc=t,this.selector=r,this.args=n,this.context=i,this.scheduler=o}return t(r,e),r.create=function(e,t,n){return void 0===t&&(t=void 0),function(){for(var i=[],o=0;o<arguments.length;o++)i[o-0]=arguments[o];return new r(e,t,i,this,n)}},r.prototype._subscribe=function(e){var t=this.callbackFunc,n=this.args,i=this.scheduler,a=this.subject;if(i)return i.schedule(r.dispatch,0,{source:this,subscriber:e,context:this.context});if(!a){a=this.subject=new br;var s=function l(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=l.source,n=r.selector,i=r.subject;if(n){var a=o(n).apply(this,e);a===or?i.error(or.e):(i.next(a),i.complete())}else i.next(1===e.length?e[0]:e),i.complete()};s.source=this;var u=o(t).apply(this.context,n.concat(s));u===or&&a.error(or.e)}return a.subscribe(e)},r.dispatch=function(e){var t=this,r=e.source,n=e.subscriber,i=e.context,a=r.callbackFunc,s=r.args,u=r.scheduler,h=r.subject;if(!h){h=r.subject=new br;var d=function f(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=f.source,i=n.selector,a=n.subject;if(i){var s=o(i).apply(this,e);s===or?t.add(u.schedule(c,0,{err:or.e,subject:a})):t.add(u.schedule(l,0,{value:s,subject:a}))}else{var h=1===e.length?e[0]:e;t.add(u.schedule(l,0,{value:h,subject:a}))}};d.source=r;var p=o(a).apply(i,s.concat(d));p===or&&h.error(or.e)}t.add(h.subscribe(n))},r}(fr),Er=wr.create;fr.bindCallback=Er;var xr=function(e){function r(t,r,n,i,o){e.call(this),this.callbackFunc=t,this.selector=r,this.args=n,this.context=i,this.scheduler=o}return t(r,e),r.create=function(e,t,n){return void 0===t&&(t=void 0),function(){for(var i=[],o=0;o<arguments.length;o++)i[o-0]=arguments[o];return new r(e,t,i,this,n)}},r.prototype._subscribe=function(e){var t=this.callbackFunc,r=this.args,n=this.scheduler,i=this.subject;if(n)return n.schedule(h,0,{source:this,subscriber:e,context:this.context});if(!i){i=this.subject=new br;var a=function u(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=u.source,n=r.selector,i=r.subject,a=e.shift();if(a)i.error(a);else if(n){var s=o(n).apply(this,e);s===or?i.error(or.e):(i.next(s),i.complete())}else i.next(1===e.length?e[0]:e),i.complete()};a.source=this;var s=o(t).apply(this.context,r.concat(a));s===or&&i.error(or.e)}return i.subscribe(e)},r}(fr),Nr=xr.create;fr.bindNodeCallback=Nr;var Sr=function(e){function r(t,r){e.call(this),this.value=t,this.scheduler=r,this._isScalar=!0,r&&(this._isScalar=!1)}return t(r,e),r.create=function(e,t){return new r(e,t)},r.dispatch=function(e){var t=e.done,r=e.value,n=e.subscriber;return t?void n.complete():(n.next(r),void(n.closed||(e.done=!0,this.schedule(e))))},r.prototype._subscribe=function(e){var t=this.value,n=this.scheduler;return n?n.schedule(r.dispatch,0,{done:!1,value:t,subscriber:e}):(e.next(t),void(e.closed||e.complete()))},r}(fr),Cr=function(e){function r(t){e.call(this),this.scheduler=t}return t(r,e),r.create=function(e){return new r(e)},r.dispatch=function(e){var t=e.subscriber;t.complete()},r.prototype._subscribe=function(e){var t=this.scheduler;return t?t.schedule(r.dispatch,0,{subscriber:e}):void e.complete()},r}(fr),Tr=function(e){function r(t,r){e.call(this),this.array=t,this.scheduler=r,r||1!==t.length||(this._isScalar=!0,this.value=t[0])}return t(r,e),r.create=function(e,t){return new r(e,t)},r.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=e[e.length-1];f(n)?e.pop():n=null;var i=e.length;return i>1?new r(e,n):1===i?new Sr(e[0],n):new Cr(n)},r.dispatch=function(e){var t=e.array,r=e.index,n=e.count,i=e.subscriber;return r>=n?void i.complete():(i.next(t[r]),void(i.closed||(e.index=r+1,this.schedule(e))))},r.prototype._subscribe=function(e){var t=0,n=this.array,i=n.length,o=this.scheduler;if(o)return o.schedule(r.dispatch,0,{array:n,index:t,count:i,subscriber:e});for(var a=0;i>a&&!e.closed;a++)e.next(n[a]);e.complete()},r}(fr),Pr=function(e){function r(){e.apply(this,arguments)}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.destination.next(t)},r.prototype.notifyError=function(e,t){this.destination.error(e)},r.prototype.notifyComplete=function(e){this.destination.complete()},r}(hr),kr=v(rr),Ar=function(e){function r(t,r,n){e.call(this),this.parent=t,this.outerValue=r,this.outerIndex=n,this.index=0}return t(r,e),r.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},r.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(hr),Or={},Ir=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Rr(e,this.project))},e}(),Rr=function(e){function r(t,r){e.call(this,t),this.project=r,this.active=0,this.values=[],this.observables=[]}return t(r,e),r.prototype._next=function(e){this.values.push(Or),this.observables.push(e)},r.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var r=0;t>r;r++){var n=e[r];this.add(y(this,n,n,r))}}},r.prototype.notifyComplete=function(e){0===(this.active-=1)&&this.destination.complete()},r.prototype.notifyNext=function(e,t,r,n,i){var o=this.values,a=o[r],s=this.toRespond?a===Or?--this.toRespond:this.toRespond:0;o[r]=t,0===s&&(this.project?this._tryProject(o):this.destination.next(o.slice()))},r.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(r){return void this.destination.error(r)}this.destination.next(t)},r}(Pr);fr.combineLatest=_;var jr=function(){function e(e){this.concurrent=e;
}return e.prototype.call=function(e,t){return t.subscribe(new Dr(e,this.concurrent))},e}(),Dr=function(e){function r(t,r){e.call(this,t),this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0}return t(r,e),r.prototype._next=function(e){this.active<this.concurrent?(this.active++,this.add(y(this,e))):this.buffer.push(e)},r.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},r.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},r}(Pr),Mr=E;fr.concat=Mr;var Lr=function(e){function r(t){e.call(this),this.observableFactory=t}return t(r,e),r.create=function(e){return new r(e)},r.prototype._subscribe=function(e){return new Fr(e,this.observableFactory)},r}(fr),Fr=function(e){function r(t,r){e.call(this,t),this.factory=r,this.tryDefer()}return t(r,e),r.prototype.tryDefer=function(){try{this._callFactory()}catch(e){this._error(e)}},r.prototype._callFactory=function(){var e=this.factory();e&&this.add(y(this,e))},r}(Pr),Vr=Lr.create;fr.defer=Vr;var Br=Cr.create;fr.empty=Br;var $r=function(e){function r(t,r){e.call(this),this.sources=t,this.resultSelector=r}return t(r,e),r.create=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];if(null===e||0===arguments.length)return new Cr;var n=null;return"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&ir(e[0])&&(e=e[0]),0===e.length?new Cr:new r(e,n)},r.prototype._subscribe=function(e){return new Hr(e,this.sources,this.resultSelector)},r}(fr),Hr=function(e){function r(t,r,n){e.call(this,t),this.sources=r,this.resultSelector=n,this.completed=0,this.haveValues=0;var i=r.length;this.total=i,this.values=new Array(i);for(var o=0;i>o;o++){var a=r[o],s=y(this,a,null,o);s&&(s.outerIndex=o,this.add(s))}}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.values[r]=t,i._hasValue||(i._hasValue=!0,this.haveValues++)},r.prototype.notifyComplete=function(e){var t=this.destination,r=this,n=r.haveValues,i=r.resultSelector,o=r.values,a=o.length;if(!e._hasValue)return void t.complete();if(this.completed++,this.completed===a){if(n===a){var s=i?i.apply(this,o):o;t.next(s)}t.complete()}},r}(Pr),Wr=$r.create;fr.forkJoin=Wr;var qr=function(e){function r(t,r){e.call(this),this.promise=t,this.scheduler=r}return t(r,e),r.create=function(e,t){return new r(e,t)},r.prototype._subscribe=function(e){var t=this,r=this.promise,n=this.scheduler;if(null==n)this._isScalar?e.closed||(e.next(this.value),e.complete()):r.then(function(r){t.value=r,t._isScalar=!0,e.closed||(e.next(r),e.complete())},function(t){e.closed||e.error(t)}).then(null,function(e){rr.setTimeout(function(){throw e})});else if(this._isScalar){if(!e.closed)return n.schedule(x,0,{value:this.value,subscriber:e})}else r.then(function(r){t.value=r,t._isScalar=!0,e.closed||e.add(n.schedule(x,0,{value:r,subscriber:e}))},function(t){e.closed||e.add(n.schedule(N,0,{err:t,subscriber:e}))}).then(null,function(e){rr.setTimeout(function(){throw e})})},r}(fr),Ur=function(e){function r(t,r){if(e.call(this),this.scheduler=r,null==t)throw new Error("iterator cannot be null.");this.iterator=S(t)}return t(r,e),r.create=function(e,t){return new r(e,t)},r.dispatch=function(e){var t=e.index,r=e.hasError,n=e.iterator,i=e.subscriber;if(r)return void i.error(e.error);var o=n.next();return o.done?void i.complete():(i.next(o.value),e.index=t+1,i.closed?void("function"==typeof n["return"]&&n["return"]()):void this.schedule(e))},r.prototype._subscribe=function(e){var t=0,n=this,i=n.iterator,o=n.scheduler;if(o)return o.schedule(r.dispatch,0,{index:t,iterator:i,subscriber:e});for(;;){var a=i.next();if(a.done){e.complete();break}if(e.next(a.value),e.closed){"function"==typeof i["return"]&&i["return"]();break}}},r}(fr),zr=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length),this.str=e,this.idx=t,this.len=r}return e.prototype[kr]=function(){return this},e.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}},e}(),Gr=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=C(e)),this.arr=e,this.idx=t,this.len=r}return e.prototype[kr]=function(){return this},e.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}},e}(),Kr=Math.pow(2,53)-1,Xr=function(e){function r(t,r){e.call(this),this.arrayLike=t,this.scheduler=r,r||1!==t.length||(this._isScalar=!0,this.value=t[0])}return t(r,e),r.create=function(e,t){var n=e.length;return 0===n?new Cr:1===n?new Sr(e[0],t):new r(e,t)},r.dispatch=function(e){var t=e.arrayLike,r=e.index,n=e.length,i=e.subscriber;if(!i.closed){if(r>=n)return void i.complete();i.next(t[r]),e.index=r+1,this.schedule(e)}},r.prototype._subscribe=function(e){var t=0,n=this,i=n.arrayLike,o=n.scheduler,a=i.length;if(o)return o.schedule(r.dispatch,0,{arrayLike:i,index:t,length:a,subscriber:e});for(var s=0;a>s&&!e.closed;s++)e.next(i[s]);e.complete()},r}(fr),Qr=function(){function e(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype["do"]=function(e,t,r){var n=this.kind;switch(n){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return r&&r()}},e.prototype.accept=function(e,t,r){return e&&"function"==typeof e.next?this.observe(e):this["do"](e,t,r)},e.prototype.toObservable=function(){var e=this.kind;switch(e){case"N":return fr.of(this.value);case"E":return fr["throw"](this.error);case"C":return fr.empty()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return"undefined"!=typeof t?new e("N",t):this.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return this.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),Yr=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new Jr(e,this.scheduler,this.delay))},e}(),Jr=function(e){function r(t,r,n){void 0===n&&(n=0),e.call(this,t),this.scheduler=r,this.delay=n}return t(r,e),r.dispatch=function(e){var t=e.notification,r=e.destination;t.observe(r),this.unsubscribe()},r.prototype.scheduleMessage=function(e){this.add(this.scheduler.schedule(r.dispatch,this.delay,new Zr(e,this.destination)))},r.prototype._next=function(e){this.scheduleMessage(Qr.createNext(e))},r.prototype._error=function(e){this.scheduleMessage(Qr.createError(e))},r.prototype._complete=function(){this.scheduleMessage(Qr.createComplete())},r}(hr),Zr=function(){function e(e,t){this.notification=e,this.destination=t}return e}(),en=function(e){return e&&"number"==typeof e.length},tn=function(e){function r(t,r){e.call(this,null),this.ish=t,this.scheduler=r}return t(r,e),r.create=function(e,t){if(null!=e){if("function"==typeof e[pr])return e instanceof fr&&!t?e:new r(e,t);if(ir(e))return new Tr(e,t);if(m(e))return new qr(e,t);if("function"==typeof e[kr]||"string"==typeof e)return new Ur(e,t);if(en(e))return new Xr(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")},r.prototype._subscribe=function(e){var t=this.ish,r=this.scheduler;return null==r?t[pr]().subscribe(e):t[pr]().subscribe(new Jr(e,r,0))},r}(fr),rn=tn.create;fr.from=rn;var nn=Object.prototype.toString,on=function(e){function n(t,r,n,i){e.call(this),this.sourceObj=t,this.eventName=r,this.selector=n,this.options=i}return t(n,e),n.create=function(e,t,i,o){return r(i)&&(o=i,i=void 0),new n(e,t,o,i)},n.setupSubscription=function(e,t,r,i,o){var a;if(I(e)||R(e))for(var s=0,u=e.length;u>s;s++)n.setupSubscription(e[s],t,r,i,o);else if(j(e)){var l=e;e.addEventListener(t,r,o),a=function(){return l.removeEventListener(t,r)}}else if(O(e)){var c=e;e.on(t,r),a=function(){return c.off(t,r)}}else{if(!A(e))throw new TypeError("Invalid event target");var h=e;e.addListener(t,r),a=function(){return h.removeListener(t,r)}}i.add(new sr(a))},n.prototype._subscribe=function(e){var t=this.sourceObj,r=this.eventName,i=this.options,a=this.selector,s=a?function(){for(var t=[],r=0;r<arguments.length;r++)t[r-0]=arguments[r];var n=o(a).apply(void 0,t);n===or?e.error(or.e):e.next(n)}:function(t){return e.next(t)};n.setupSubscription(t,r,s,e,i)},n}(fr),an=on.create;fr.fromEvent=an;var sn=function(e){function n(t,r,n){e.call(this),this.addHandler=t,this.removeHandler=r,this.selector=n}return t(n,e),n.create=function(e,t,r){return new n(e,t,r)},n.prototype._subscribe=function(e){var t=this,n=this.removeHandler,i=this.selector?function(){for(var r=[],n=0;n<arguments.length;n++)r[n-0]=arguments[n];t._callSelector(e,r)}:function(t){e.next(t)},o=this._callAddHandler(i,e);r(n)&&e.add(new sr(function(){n(i,o)}))},n.prototype._callSelector=function(e,t){try{var r=this.selector.apply(this,t);e.next(r)}catch(n){e.error(n)}},n.prototype._callAddHandler=function(e,t){try{return this.addHandler(e)||null}catch(r){t.error(r)}},n}(fr),un=sn.create;fr.fromEventPattern=un;var ln=qr.create;fr.fromPromise=ln;var cn=function(e){return e},hn=function(e){function r(t,r,n,i,o){e.call(this),this.initialState=t,this.condition=r,this.iterate=n,this.resultSelector=i,this.scheduler=o}return t(r,e),r.create=function(e,t,n,i,o){return 1==arguments.length?new r(e.initialState,e.condition,e.iterate,e.resultSelector||cn,e.scheduler):void 0===i||f(i)?new r(e,t,n,cn,i):new r(e,t,n,i,o)},r.prototype._subscribe=function(e){var t=this.initialState;if(this.scheduler)return this.scheduler.schedule(r.dispatch,0,{subscriber:e,iterate:this.iterate,condition:this.condition,resultSelector:this.resultSelector,state:t});for(var n=this,i=n.condition,o=n.resultSelector,a=n.iterate;;){if(i){var s=void 0;try{s=i(t)}catch(u){return void e.error(u)}if(!s){e.complete();break}}var l=void 0;try{l=o(t)}catch(u){return void e.error(u)}if(e.next(l),e.closed)break;try{t=a(t)}catch(u){return void e.error(u)}}},r.dispatch=function(e){var t=e.subscriber,r=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(n){return void t.error(n)}else e.needIterate=!0;if(r){var i=void 0;try{i=r(e.state)}catch(n){return void t.error(n)}if(!i)return void t.complete();if(t.closed)return}var o;try{o=e.resultSelector(e.state)}catch(n){return void t.error(n)}if(!t.closed&&(t.next(o),!t.closed))return this.schedule(e)}},r}(fr);fr.generate=hn.create;var dn=function(e){function r(t,r,n){e.call(this),this.condition=t,this.thenSource=r,this.elseSource=n}return t(r,e),r.create=function(e,t,n){return new r(e,t,n)},r.prototype._subscribe=function(e){var t=this,r=t.condition,n=t.thenSource,i=t.elseSource;return new pn(e,r,n,i)},r}(fr),pn=function(e){function r(t,r,n,i){e.call(this,t),this.condition=r,this.thenSource=n,this.elseSource=i,this.tryIf()}return t(r,e),r.prototype.tryIf=function(){var e,t=this,r=t.condition,n=t.thenSource,i=t.elseSource;try{e=r();var o=e?n:i;o?this.add(y(this,o)):this._complete()}catch(a){this._error(a)}},r}(Pr),fn=dn.create;fr["if"]=fn;var mn=function(e){function r(t,r){e.call(this)}return t(r,e),r.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},r}(sr),vn=function(e){function r(t,r){e.call(this,t,r),this.scheduler=t,this.work=r,this.pending=!1}return t(r,e),r.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,this.pending=!0;var r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,t)),this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},r.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),rr.setInterval(e.flush.bind(e,this),r)},r.prototype.recycleAsyncId=function(e,t,r){return void 0===r&&(r=0),null!==r&&this.delay===r?t:rr.clearInterval(t)&&void 0||void 0},r.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);return r?r:void(this.pending===!1&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null)))},r.prototype._execute=function(e,t){var r=!1,n=void 0;try{this.work(e)}catch(i){r=!0,n=!!i&&i||new Error(i)}return r?(this.unsubscribe(),n):void 0},r.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,r=t.actions,n=r.indexOf(this);this.work=null,this.delay=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&r.splice(n,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null))},r}(mn),yn=function(){function e(t,r){void 0===r&&(r=e.now),this.SchedulerAction=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(r,t)},e.now=Date.now?Date.now:function(){return+new Date},e}(),gn=function(e){function r(){e.apply(this,arguments),this.actions=[],this.active=!1,this.scheduled=void 0}return t(r,e),r.prototype.flush=function(e){var t=this.actions;if(this.active)return void t.push(e);var r;this.active=!0;do if(r=e.execute(e.state,e.delay))break;while(e=t.shift());if(this.active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}},r}(yn),_n=new gn(vn),bn=function(e){function r(t,r){void 0===t&&(t=0),void 0===r&&(r=_n),e.call(this),this.period=t,this.scheduler=r,(!D(t)||0>t)&&(this.period=0),r&&"function"==typeof r.schedule||(this.scheduler=_n)}return t(r,e),r.create=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=_n),new r(e,t)},r.dispatch=function(e){var t=e.index,r=e.subscriber,n=e.period;r.next(t),r.closed||(e.index+=1,this.schedule(e,n))},r.prototype._subscribe=function(e){var t=0,n=this.period,i=this.scheduler;e.add(i.schedule(r.dispatch,n,{index:t,subscriber:e,period:n}))},r}(fr),wn=bn.create;fr.interval=wn;var En=L;fr.merge=En;var xn=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Nn(e))},e}(),Nn=function(e){function r(t){e.call(this,t),this.hasFirst=!1,this.observables=[],this.subscriptions=[]}return t(r,e),r.prototype._next=function(e){this.observables.push(e)},r.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var r=0;t>r&&!this.hasFirst;r++){var n=e[r],i=y(this,n,n,r);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},r.prototype.notifyNext=function(e,t,r,n,i){if(!this.hasFirst){this.hasFirst=!0;for(var o=0;o<this.subscriptions.length;o++)if(o!==r){var a=this.subscriptions[o];a.unsubscribe(),this.remove(a)}this.subscriptions=null}this.destination.next(t)},r}(Pr);fr.race=V;var Sn=function(e){function r(){e.call(this)}return t(r,e),r.create=function(){return new r},r.prototype._subscribe=function(e){B()},r}(fr),Cn=Sn.create;fr.never=Cn;var Tn=Tr.of;fr.of=Tn;var Pn=function(){function e(e){this.nextSources=e}return e.prototype.call=function(e,t){return t.subscribe(new kn(e,this.nextSources))},e}(),kn=function(e){function r(t,r){e.call(this,t),this.destination=t,this.nextSources=r}return t(r,e),r.prototype.notifyError=function(e,t){this.subscribeToNextSource()},r.prototype.notifyComplete=function(e){this.subscribeToNextSource()},r.prototype._error=function(e){this.subscribeToNextSource()},r.prototype._complete=function(){this.subscribeToNextSource()},r.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();e?this.add(y(this,e)):this.destination.complete()},r}(Pr);fr.onErrorResumeNext=H;var An=function(e){function r(t,r){e.call(this),this.obj=t,this.scheduler=r,this.keys=Object.keys(t)}return t(r,e),r.create=function(e,t){return new r(e,t)},r.prototype._subscribe=function(e){var t=this,r=t.keys,n=t.scheduler,i=r.length;if(n)return n.schedule(W,0,{obj:this.obj,keys:r,length:i,index:0,subscriber:e});for(var o=0;i>o;o++){var a=r[o];e.next([a,this.obj[a]])}e.complete()},r}(fr),On=An.create;fr.pairs=On;var In=function(e){function r(t,r,n){e.call(this),this.start=t,this._count=r,this.scheduler=n}return t(r,e),r.create=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=0),new r(e,t,n)},r.dispatch=function(e){var t=e.start,r=e.index,n=e.count,i=e.subscriber;return r>=n?void i.complete():(i.next(t),void(i.closed||(e.index=r+1,e.start=t+1,this.schedule(e))))},r.prototype._subscribe=function(e){var t=0,n=this.start,i=this._count,o=this.scheduler;if(o)return o.schedule(r.dispatch,0,{index:t,count:i,start:n,subscriber:e});for(;;){if(t++>=i){e.complete();break}if(e.next(n++),e.closed)break}},r}(fr),Rn=In.create;fr.range=Rn;var jn=function(e){function r(t,r){e.call(this),this.resourceFactory=t,this.observableFactory=r}return t(r,e),r.create=function(e,t){return new r(e,t)},r.prototype._subscribe=function(e){var t,r=this,n=r.resourceFactory,i=r.observableFactory;try{return t=n(),new Dn(e,t,i)}catch(o){e.error(o)}},r}(fr),Dn=function(e){function r(t,r,n){e.call(this,t),this.resource=r,this.observableFactory=n,t.add(r),this.tryUse()}return t(r,e),r.prototype.tryUse=function(){try{var e=this.observableFactory.call(this,this.resource);e&&this.add(y(this,e))}catch(t){this._error(t)}},r}(Pr),Mn=jn.create;fr.using=Mn;var Ln=function(e){function r(t,r){e.call(this),this.error=t,this.scheduler=r}return t(r,e),r.create=function(e,t){return new r(e,t)},r.dispatch=function(e){var t=e.error,r=e.subscriber;r.error(t)},r.prototype._subscribe=function(e){var t=this.error,n=this.scheduler;return n?n.schedule(r.dispatch,0,{error:t,subscriber:e}):void e.error(t)},r}(fr),Fn=Ln.create;fr["throw"]=Fn;var Vn=function(e){function r(t,r,n){void 0===t&&(t=0),e.call(this),this.period=-1,this.dueTime=0,D(r)?this.period=Number(r)<1&&1||Number(r):f(r)&&(n=r),f(n)||(n=_n),this.scheduler=n,this.dueTime=q(t)?+t-this.scheduler.now():t}return t(r,e),r.create=function(e,t,n){return void 0===e&&(e=0),new r(e,t,n)},r.dispatch=function(e){var t=e.index,r=e.period,n=e.subscriber,i=this;if(n.next(t),!n.closed){if(-1===r)return n.complete();e.index=t+1,i.schedule(e,r)}},r.prototype._subscribe=function(e){var t=0,n=this,i=n.period,o=n.dueTime,a=n.scheduler;return a.schedule(r.dispatch,o,{index:t,period:i,subscriber:e})},r}(fr),Bn=Vn.create;fr.timer=Bn;var $n=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Hn(e,this.project))},e}(),Hn=function(e){function r(t,r,n){void 0===n&&(n=Object.create(null)),e.call(this,t),this.iterators=[],this.active=0,this.project="function"==typeof r?r:null,this.values=n}return t(r,e),r.prototype._next=function(e){var t=this.iterators;ir(e)?t.push(new qn(e)):"function"==typeof e[kr]?t.push(new Wn(e[kr]())):t.push(new Un(this.destination,this,e))},r.prototype._complete=function(){var e=this.iterators,t=e.length;this.active=t;for(var r=0;t>r;r++){var n=e[r];n.stillUnsubscribed?this.add(n.subscribe(n,r)):this.active--}},r.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},r.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,r=this.destination,n=0;t>n;n++){var i=e[n];if("function"==typeof i.hasValue&&!i.hasValue())return}for(var o=!1,a=[],n=0;t>n;n++){var i=e[n],s=i.next();if(i.hasCompleted()&&(o=!0),s.done)return void r.complete();a.push(s.value)}this.project?this._tryProject(a):r.next(a),o&&r.complete()},r.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(r){return void this.destination.error(r)}this.destination.next(t)},r}(hr),Wn=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return e&&e.done},e}(),qn=function(){function e(e){this.array=e,this.index=0,this.length=0,this.length=e.length}return e.prototype[kr]=function(){return this},e.prototype.next=function(e){var t=this.index++,r=this.array;return t<this.length?{value:r[t],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),Un=function(e){function r(t,r,n){e.call(this,t),this.parent=r,this.observable=n,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}return t(r,e),r.prototype[kr]=function(){return this},r.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},r.prototype.hasValue=function(){return this.buffer.length>0},r.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},r.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},r.prototype.notifyNext=function(e,t,r,n,i){this.buffer.push(t),this.parent.checkIterators()},r.prototype.subscribe=function(e,t){return y(this,this.observable,this,t)},r}(Pr),zn=z;fr.zip=zn;var Gn=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new Kn(e,this.project,this.thisArg))},e}(),Kn=function(e){function r(t,r,n){e.call(this,t),this.project=r,this.count=0,this.thisArg=n||this}return t(r,e),r.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}this.destination.next(t)},r}(hr),Xn=function(e){function r(t){e.call(this);var r={async:!0,createXHR:function(){return this.crossDomain?K.call(this):X()},crossDomain:!1,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof t)r.url=t;else for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);this.request=r}return t(r,e),r.prototype._subscribe=function(e){return new Qn(e,this.request)},r.create=function(){var e=function(e){return new r(e)};return e.get=Q,e.post=Y,e["delete"]=J,e.put=Z,e.getJSON=ee,e}(),r}(fr),Qn=function(e){function r(t,r){e.call(this,t),this.request=r,this.done=!1;var n=r.headers=r.headers||{};r.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),"Content-Type"in n||rr.FormData&&r.body instanceof rr.FormData||"undefined"==typeof r.body||(n["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),r.body=this.serializeBody(r.body,r.headers["Content-Type"]),this.send()}return t(r,e),r.prototype.next=function(e){this.done=!0;var t=this,r=t.xhr,n=t.request,i=t.destination,o=new Yn(e,r,n);i.next(o)},r.prototype.send=function(){var e=this,t=e.request,r=e.request,n=r.user,i=r.method,a=r.url,s=r.async,u=r.password,l=r.headers,c=r.body,h=t.createXHR,d=o(h).call(t);if(d===or)this.error(or.e);else{this.xhr=d,this.setupEvents(d,t);var p=void 0;if(p=n?o(d.open).call(d,i,a,s,n,u):o(d.open).call(d,i,a,s),p===or)return this.error(or.e),null;if(d.timeout=t.timeout,d.responseType=t.responseType,this.setHeaders(d,l),p=c?o(d.send).call(d,c):o(d.send).call(d),p===or)return this.error(or.e),null}return d},r.prototype.serializeBody=function(e,t){if(!e||"string"==typeof e)return e;if(rr.FormData&&e instanceof rr.FormData)return e;if(t){var r=t.indexOf(";");-1!==r&&(t=t.substring(0,r))}switch(t){case"application/x-www-form-urlencoded":return Object.keys(e).map(function(t){return encodeURI(t)+"="+encodeURI(e[t])}).join("&");case"application/json":return JSON.stringify(e);default:return e}},r.prototype.setHeaders=function(e,t){for(var r in t)t.hasOwnProperty(r)&&e.setRequestHeader(r,t[r])},r.prototype.setupEvents=function(e,t){function r(e){var t=r,n=t.subscriber,i=t.progressSubscriber,o=t.request;i&&i.error(e),n.error(new Zn(this,o))}function n(e){var t=n,r=t.subscriber,i=t.progressSubscriber,o=t.request;if(4===this.readyState){var a=1223===this.status?204:this.status,s="text"===this.responseType?this.response||this.responseText:this.response;0===a&&(a=s?200:0),a>=200&&300>a?(i&&i.complete(),r.next(e),r.complete()):(i&&i.error(e),r.error(new Jn("ajax error "+a,this,o)))}}var i=t.progressSubscriber;if(e.ontimeout=r,r.request=t,r.subscriber=this,r.progressSubscriber=i,e.upload&&"withCredentials"in e){if(i){var o;o=function(e){var t=o.progressSubscriber;t.next(e)},rr.XDomainRequest?e.onprogress=o:e.upload.onprogress=o,o.progressSubscriber=i}var a;a=function(e){var t=a,r=t.progressSubscriber,n=t.subscriber,i=t.request;r&&r.error(e),n.error(new Jn("ajax error",this,i))},e.onerror=a,a.request=t,a.subscriber=this,a.progressSubscriber=i}e.onreadystatechange=n,n.subscriber=this,n.progressSubscriber=i,n.request=t},r.prototype.unsubscribe=function(){var t=this,r=t.done,n=t.xhr;!r&&n&&4!==n.readyState&&"function"==typeof n.abort&&n.abort(),e.prototype.unsubscribe.call(this)},r}(hr),Yn=function(){function e(e,t,r){switch(this.originalEvent=e,this.xhr=t,this.request=r,this.status=t.status,this.responseType=t.responseType||r.responseType,this.responseType){case"json":"response"in t?this.response=t.responseType?t.response:JSON.parse(t.response||t.responseText||"null"):this.response=JSON.parse(t.responseText||"null");break;case"xml":this.response=t.responseXML;break;case"text":default:this.response="response"in t?t.response:t.responseText}}return e}(),Jn=function(e){function r(t,r,n){e.call(this,t),this.message=t,this.xhr=r,this.request=n,this.status=r.status}return t(r,e),r}(Error),Zn=function(e){function r(t,r){e.call(this,"ajax timeout",t,r)}return t(r,e),r}(Jn),ei=Xn.create;fr.ajax=ei;var ti=function(e){function r(t,r){e.call(this,t,r),this.scheduler=t,this.work=r}return t(r,e),r.prototype.schedule=function(t,r){return void 0===r&&(r=0),r>0?e.prototype.schedule.call(this,t,r):(this.delay=r,this.state=t,this.scheduler.flush(this),this)},r.prototype.execute=function(t,r){return r>0||this.closed?e.prototype.execute.call(this,t,r):this._execute(t,r)},r.prototype.requestAsyncId=function(t,r,n){return void 0===n&&(n=0),null!==n&&n>0||null===n&&this.delay>0?e.prototype.requestAsyncId.call(this,t,r,n):t.flush(this)},r}(vn),ri=function(e){function r(){e.apply(this,arguments)}return t(r,e),r}(gn),ni=new ri(ti),ii=function(e){function r(t,r,n){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===r&&(r=Number.POSITIVE_INFINITY),e.call(this),this.scheduler=n,this._events=[],this._bufferSize=1>t?1:t,this._windowTime=1>r?1:r}return t(r,e),r.prototype.next=function(t){var r=this._getNow();this._events.push(new oi(r,t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},r.prototype._subscribe=function(e){var t,r=this._trimBufferThenGetEvents(),n=this.scheduler;if(this.closed)throw new mr;this.hasError?t=sr.EMPTY:this.isStopped?t=sr.EMPTY:(this.observers.push(e),t=new vr(this,e)),n&&e.add(e=new Jr(e,n));for(var i=r.length,o=0;i>o&&!e.closed;o++)e.next(r[o].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},r.prototype._getNow=function(){return(this.scheduler||ni).now()},r.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,r=this._windowTime,n=this._events,i=n.length,o=0;i>o&&!(e-n[o].time<r);)o++;return i>t&&(o=Math.max(o,i-t)),o>0&&n.splice(0,o),n},r}(gr),oi=function(){function e(e,t){this.time=e,this.value=t}return e}(),ai=re(rr),si=function(e){function r(t,r){if(t instanceof fr)e.call(this,r,t);else{if(e.call(this),this.WebSocketCtor=rr.WebSocket,this._output=new gr,"string"==typeof t?this.url=t:ai(this,t),!this.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new ii}}return t(r,e),r.prototype.resultSelector=function(e){return JSON.parse(e.data)},r.create=function(e){return new r(e)},r.prototype.lift=function(e){var t=new r(this,this.destination);return t.operator=e,t},r.prototype._resetState=function(){this.socket=null,this.source||(this.destination=new ii),this._output=new gr},r.prototype.multiplex=function(e,t,r){var n=this;return new fr(function(i){var a=o(e)();a===or?i.error(or.e):n.next(a);var s=n.subscribe(function(e){var t=o(r)(e);t===or?i.error(or.e):t&&i.next(e)},function(e){return i.error(e)},function(){return i.complete()});return function(){var e=o(t)();e===or?i.error(or.e):n.next(e),s.unsubscribe()}})},r.prototype._connectSocket=function(){var e=this,t=this.WebSocketCtor,r=this._output,n=null;try{n=this.protocol?new t(this.url,this.protocol):new t(this.url),this.socket=n}catch(i){return void r.error(i)}var a=new sr(function(){e.socket=null,n&&1===n.readyState&&n.close()});n.onopen=function(t){var i=e.openObserver;i&&i.next(t);var o=e.destination;e.destination=hr.create(function(e){return 1===n.readyState&&n.send(e)},function(t){var i=e.closingObserver;i&&i.next(void 0),t&&t.code?n.close(t.code,t.reason):r.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),e._resetState()},function(){var t=e.closingObserver;t&&t.next(void 0),n.close(),e._resetState()}),o&&o instanceof ii&&a.add(o.subscribe(e.destination))},n.onerror=function(t){e._resetState(),r.error(t)},n.onclose=function(t){e._resetState();var n=e.closeObserver;n&&n.next(t),t.wasClean?r.complete():r.error(t)},n.onmessage=function(t){var n=o(e.resultSelector)(t);n===or?r.error(or.e):r.next(n)}},r.prototype._subscribe=function(e){var t=this,r=this.source;if(r)return r.subscribe(e);this.socket||this._connectSocket();var n=new sr;return n.add(this._output.subscribe(e)),n.add(function(){var e=t.socket;0===t._output.observers.length&&(e&&1===e.readyState&&e.close(),t._resetState())}),n},r.prototype.unsubscribe=function(){var t=this,r=t.source,n=t.socket;n&&1===n.readyState&&(n.close(),this._resetState()),e.prototype.unsubscribe.call(this),r||(this.destination=new ii)},r}(_r),ui=si.create;fr.webSocket=ui;var li=function(){function e(e){this.closingNotifier=e}return e.prototype.call=function(e,t){return t.subscribe(new ci(e,this.closingNotifier))},e}(),ci=function(e){function r(t,r){e.call(this,t),this.buffer=[],this.add(y(this,r))}return t(r,e),r.prototype._next=function(e){this.buffer.push(e)},r.prototype.notifyNext=function(e,t,r,n,i){var o=this.buffer;this.buffer=[],this.destination.next(o)},r}(Pr);fr.prototype.buffer=ne;var hi=function(){function e(e,t){this.bufferSize=e,this.startBufferEvery=t}return e.prototype.call=function(e,t){return t.subscribe(new di(e,this.bufferSize,this.startBufferEvery))},e}(),di=function(e){function r(t,r,n){e.call(this,t),this.bufferSize=r,this.startBufferEvery=n,this.buffers=[],this.count=0}return t(r,e),r.prototype._next=function(e){var t=this.count++,r=this,n=r.destination,i=r.bufferSize,o=r.startBufferEvery,a=r.buffers,s=null==o?i:o;t%s===0&&a.push([]);for(var u=a.length;u--;){var l=a[u];l.push(e),l.length===i&&(a.splice(u,1),n.next(l))}},r.prototype._complete=function(){for(var t=this.destination,r=this.buffers;r.length>0;){var n=r.shift();n.length>0&&t.next(n)}e.prototype._complete.call(this)},r}(hr);fr.prototype.bufferCount=ie;var pi=function(){function e(e,t,r,n){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=r,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new mi(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),fi=function(){function e(){this.buffer=[]}return e}(),mi=function(e){function r(t,r,n,i,o){e.call(this,t),this.bufferTimeSpan=r,this.bufferCreationInterval=n,this.maxBufferSize=i,this.scheduler=o,this.contexts=[];var a=this.openContext();if(this.timespanOnly=null==n||0>n,this.timespanOnly){var s={subscriber:this,context:a,bufferTimeSpan:r};this.add(a.closeAction=o.schedule(ae,r,s))}else{var u={subscriber:this,context:a},l={bufferTimeSpan:r,bufferCreationInterval:n,subscriber:this,scheduler:o};this.add(a.closeAction=o.schedule(ue,r,u)),this.add(o.schedule(se,n,l))}}return t(r,e),r.prototype._next=function(e){for(var t,r=this.contexts,n=r.length,i=0;n>i;i++){var o=r[i],a=o.buffer;a.push(e),a.length==this.maxBufferSize&&(t=o)}t&&this.onBufferFull(t)},r.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},r.prototype._complete=function(){for(var t=this,r=t.contexts,n=t.destination;r.length>0;){
var i=r.shift();n.next(i.buffer)}e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){this.contexts=null},r.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();var r=this.bufferTimeSpan,n={subscriber:this,context:e,bufferTimeSpan:r};this.add(e.closeAction=this.scheduler.schedule(ae,r,n))}},r.prototype.openContext=function(){var e=new fi;return this.contexts.push(e),e},r.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts,r=t?t.indexOf(e):-1;r>=0&&t.splice(t.indexOf(e),1)},r}(hr);fr.prototype.bufferTime=oe;var vi=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new yi(e,this.openings,this.closingSelector))},e}(),yi=function(e){function r(t,r,n){e.call(this,t),this.openings=r,this.closingSelector=n,this.contexts=[],this.add(y(this,r))}return t(r,e),r.prototype._next=function(e){for(var t=this.contexts,r=t.length,n=0;r>n;n++)t[n].buffer.push(e)},r.prototype._error=function(t){for(var r=this.contexts;r.length>0;){var n=r.shift();n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,e.prototype._error.call(this,t)},r.prototype._complete=function(){for(var t=this.contexts;t.length>0;){var r=t.shift();this.destination.next(r.buffer),r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,e.prototype._complete.call(this)},r.prototype.notifyNext=function(e,t,r,n,i){e?this.closeBuffer(e):this.openBuffer(t)},r.prototype.notifyComplete=function(e){this.closeBuffer(e.context)},r.prototype.openBuffer=function(e){try{var t=this.closingSelector,r=t.call(this,e);r&&this.trySubscribe(r)}catch(n){this._error(n)}},r.prototype.closeBuffer=function(e){var t=this.contexts;if(t&&e){var r=e.buffer,n=e.subscription;this.destination.next(r),t.splice(t.indexOf(e),1),this.remove(n),n.unsubscribe()}},r.prototype.trySubscribe=function(e){var t=this.contexts,r=[],n=new sr,i={buffer:r,subscription:n};t.push(i);var o=y(this,e,i);!o||o.closed?this.closeBuffer(i):(o.context=i,this.add(o),n.add(o))},r}(Pr);fr.prototype.bufferToggle=le;var gi=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new _i(e,this.closingSelector))},e}(),_i=function(e){function r(t,r){e.call(this,t),this.closingSelector=r,this.subscribing=!1,this.openBuffer()}return t(r,e),r.prototype._next=function(e){this.buffer.push(e)},r.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){this.buffer=null,this.subscribing=!1},r.prototype.notifyNext=function(e,t,r,n,i){this.openBuffer()},r.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},r.prototype.openBuffer=function(){var e=this.closingSubscription;e&&(this.remove(e),e.unsubscribe());var t=this.buffer;this.buffer&&this.destination.next(t),this.buffer=[];var r=o(this.closingSelector)();r===or?this.error(or.e):(e=new sr,this.closingSubscription=e,this.add(e),this.subscribing=!0,e.add(y(this,r)),this.subscribing=!1)},r}(Pr);fr.prototype.bufferWhen=ce;var bi=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new wi(e,this.selector,this.caught))},e}(),wi=function(e){function r(t,r,n){e.call(this,t),this.selector=r,this.caught=n}return t(r,e),r.prototype.error=function(t){if(!this.isStopped){var r=void 0;try{r=this.selector(t,this.caught)}catch(n){return void e.prototype.error.call(this,n)}this._unsubscribeAndRecycle(),this.add(y(this,r))}},r}(Pr);fr.prototype["catch"]=he,fr.prototype._catch=he,fr.prototype.combineAll=de,fr.prototype.combineLatest=g,fr.prototype.concat=w,fr.prototype.concatAll=pe;var Ei=function(){function e(e,t,r){void 0===r&&(r=Number.POSITIVE_INFINITY),this.project=e,this.resultSelector=t,this.concurrent=r}return e.prototype.call=function(e,t){return t.subscribe(new xi(e,this.project,this.resultSelector,this.concurrent))},e}(),xi=function(e){function r(t,r,n,i){void 0===i&&(i=Number.POSITIVE_INFINITY),e.call(this,t),this.project=r,this.resultSelector=n,this.concurrent=i,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return t(r,e),r.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},r.prototype._tryNext=function(e){var t,r=this.index++;try{t=this.project(e,r)}catch(n){return void this.destination.error(n)}this.active++,this._innerSub(t,e,r)},r.prototype._innerSub=function(e,t,r){this.add(y(this,e,t,r))},r.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},r.prototype.notifyNext=function(e,t,r,n,i){this.resultSelector?this._notifyResultSelector(e,t,r,n):this.destination.next(t)},r.prototype._notifyResultSelector=function(e,t,r,n){var i;try{i=this.resultSelector(e,t,r,n)}catch(o){return void this.destination.error(o)}this.destination.next(i)},r.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},r}(Pr);fr.prototype.concatMap=me;var Ni=function(){function e(e,t,r){void 0===r&&(r=Number.POSITIVE_INFINITY),this.ish=e,this.resultSelector=t,this.concurrent=r}return e.prototype.call=function(e,t){return t.subscribe(new Si(e,this.ish,this.resultSelector,this.concurrent))},e}(),Si=function(e){function r(t,r,n,i){void 0===i&&(i=Number.POSITIVE_INFINITY),e.call(this,t),this.ish=r,this.resultSelector=n,this.concurrent=i,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return t(r,e),r.prototype._next=function(e){if(this.active<this.concurrent){var t=this.resultSelector,r=this.index++,n=this.ish,i=this.destination;this.active++,this._innerSub(n,i,t,e,r)}else this.buffer.push(e)},r.prototype._innerSub=function(e,t,r,n,i){this.add(y(this,e,n,i))},r.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},r.prototype.notifyNext=function(e,t,r,n,i){var o=this,a=o.resultSelector,s=o.destination;a?this.trySelectResult(e,t,r,n):s.next(t)},r.prototype.trySelectResult=function(e,t,r,n){var i,o=this,a=o.resultSelector,s=o.destination;try{i=a(e,t,r,n)}catch(u){return void s.error(u)}s.next(i)},r.prototype.notifyError=function(e){this.destination.error(e)},r.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},r}(Pr);fr.prototype.concatMapTo=ye;var Ci=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Ti(e,this.predicate,this.source))},e}(),Ti=function(e){function r(t,r,n){e.call(this,t),this.predicate=r,this.source=n,this.count=0,this.index=0}return t(r,e),r.prototype._next=function(e){this.predicate?this._tryPredicate(e):this.count++},r.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(r){return void this.destination.error(r)}t&&this.count++},r.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},r}(hr);fr.prototype.count=ge;var Pi=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new ki(e))},e}(),ki=function(e){function r(t){e.call(this,t)}return t(r,e),r.prototype._next=function(e){e.observe(this.destination)},r}(hr);fr.prototype.dematerialize=_e;var Ai=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Oi(e,this.durationSelector))},e}(),Oi=function(e){function r(t,r){e.call(this,t),this.durationSelector=r,this.hasValue=!1,this.durationSubscription=null}return t(r,e),r.prototype._next=function(e){try{var t=this.durationSelector.call(this,e);t&&this._tryNext(e,t)}catch(r){this.destination.error(r)}},r.prototype._complete=function(){this.emitValue(),this.destination.complete()},r.prototype._tryNext=function(e,t){var r=this.durationSubscription;this.value=e,this.hasValue=!0,r&&(r.unsubscribe(),this.remove(r)),r=y(this,t),r.closed||this.add(this.durationSubscription=r)},r.prototype.notifyNext=function(e,t,r,n,i){this.emitValue()},r.prototype.notifyComplete=function(){this.emitValue()},r.prototype.emitValue=function(){if(this.hasValue){var t=this.value,r=this.durationSubscription;r&&(this.durationSubscription=null,r.unsubscribe(),this.remove(r)),this.value=null,this.hasValue=!1,e.prototype._next.call(this,t)}},r}(Pr);fr.prototype.debounce=be;var Ii=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Ri(e,this.dueTime,this.scheduler))},e}(),Ri=function(e){function r(t,r,n){e.call(this,t),this.dueTime=r,this.scheduler=n,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}return t(r,e),r.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(Ee,this.dueTime,this))},r.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},r.prototype.debouncedNext=function(){this.clearDebounce(),this.hasValue&&(this.destination.next(this.lastValue),this.lastValue=null,this.hasValue=!1)},r.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},r}(hr);fr.prototype.debounceTime=we;var ji=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new Di(e,this.defaultValue))},e}(),Di=function(e){function r(t,r){e.call(this,t),this.defaultValue=r,this.isEmpty=!0}return t(r,e),r.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},r.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},r}(hr);fr.prototype.defaultIfEmpty=xe;var Mi=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Li(e,this.delay,this.scheduler))},e}(),Li=function(e){function r(t,r,n){e.call(this,t),this.delay=r,this.scheduler=n,this.queue=[],this.active=!1,this.errored=!1}return t(r,e),r.dispatch=function(e){for(var t=e.source,r=t.queue,n=e.scheduler,i=e.destination;r.length>0&&r[0].time-n.now()<=0;)r.shift().notification.observe(i);if(r.length>0){var o=Math.max(0,r[0].time-n.now());this.schedule(e,o)}else t.active=!1},r.prototype._schedule=function(e){this.active=!0,this.add(e.schedule(r.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},r.prototype.scheduleNotification=function(e){if(this.errored!==!0){var t=this.scheduler,r=new Fi(t.now()+this.delay,e);this.queue.push(r),this.active===!1&&this._schedule(t)}},r.prototype._next=function(e){this.scheduleNotification(Qr.createNext(e))},r.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e)},r.prototype._complete=function(){this.scheduleNotification(Qr.createComplete())},r}(hr),Fi=function(){function e(e,t){this.time=e,this.notification=t}return e}();fr.prototype.delay=Ne;var Vi=function(){function e(e){this.delayDurationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Bi(e,this.delayDurationSelector))},e}(),Bi=function(e){function r(t,r){e.call(this,t),this.delayDurationSelector=r,this.completed=!1,this.delayNotifierSubscriptions=[],this.values=[]}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.destination.next(e),this.removeSubscription(i),this.tryComplete()},r.prototype.notifyError=function(e,t){this._error(e)},r.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},r.prototype._next=function(e){try{var t=this.delayDurationSelector(e);t&&this.tryDelay(t,e)}catch(r){this.destination.error(r)}},r.prototype._complete=function(){this.completed=!0,this.tryComplete()},r.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e),r=null;return-1!==t&&(r=this.values[t],this.delayNotifierSubscriptions.splice(t,1),this.values.splice(t,1)),r},r.prototype.tryDelay=function(e,t){var r=y(this,e,t);this.add(r),this.delayNotifierSubscriptions.push(r),this.values.push(t)},r.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},r}(Pr),$i=function(e){function r(t,r){e.call(this),this.source=t,this.subscriptionDelay=r}return t(r,e),r.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new Hi(e,this.source))},r}(fr),Hi=function(e){function r(t,r){e.call(this),this.parent=t,this.source=r,this.sourceSubscribed=!1}return t(r,e),r.prototype._next=function(e){this.subscribeToSource()},r.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},r.prototype._complete=function(){this.subscribeToSource()},r.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},r}(hr);fr.prototype.delayWhen=Se;var Wi=rr.Set||Ce(),qi=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new Ui(e,this.keySelector,this.flushes))},e}(),Ui=function(e){function r(t,r,n){e.call(this,t),this.keySelector=r,this.values=new Wi,n&&this.add(y(this,n))}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.values.clear()},r.prototype.notifyError=function(e,t){this._error(e)},r.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},r.prototype._useKeySelector=function(e){var t,r=this.destination;try{t=this.keySelector(e)}catch(n){return void r.error(n)}this._finalizeNext(t,e)},r.prototype._finalizeNext=function(e,t){var r=this.values;r.has(e)||(r.add(e),this.destination.next(t))},r}(Pr);fr.prototype.distinct=Te;var zi=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Gi(e,this.compare,this.keySelector))},e}(),Gi=function(e){function r(t,r,n){e.call(this,t),this.keySelector=n,this.hasKey=!1,"function"==typeof r&&(this.compare=r)}return t(r,e),r.prototype.compare=function(e,t){return e===t},r.prototype._next=function(e){var t=this.keySelector,r=e;if(t&&(r=o(this.keySelector)(e),r===or))return this.destination.error(or.e);var n=!1;if(this.hasKey){if(n=o(this.compare)(this.key,r),n===or)return this.destination.error(or.e)}else this.hasKey=!0;Boolean(n)===!1&&(this.key=r,this.destination.next(e))},r}(hr);fr.prototype.distinctUntilChanged=Pe,fr.prototype.distinctUntilKeyChanged=ke;var Ki=function(){function e(e,t,r){this.nextOrObserver=e,this.error=t,this.complete=r}return e.prototype.call=function(e,t){return t.subscribe(new Xi(e,this.nextOrObserver,this.error,this.complete))},e}(),Xi=function(e){function r(t,r,n,i){e.call(this,t);var o=new hr(r,n,i);o.syncErrorThrowable=!0,this.add(o),this.safeSubscriber=o}return t(r,e),r.prototype._next=function(e){var t=this.safeSubscriber;t.next(e),t.syncErrorThrown?this.destination.error(t.syncErrorValue):this.destination.next(e)},r.prototype._error=function(e){var t=this.safeSubscriber;t.error(e),t.syncErrorThrown?this.destination.error(t.syncErrorValue):this.destination.error(e)},r.prototype._complete=function(){var e=this.safeSubscriber;e.complete(),e.syncErrorThrown?this.destination.error(e.syncErrorValue):this.destination.complete()},r}(hr);fr.prototype["do"]=Ae,fr.prototype._do=Ae;var Qi=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Yi(e))},e}(),Yi=function(e){function r(t){e.call(this,t),this.hasCompleted=!1,this.hasSubscription=!1}return t(r,e),r.prototype._next=function(e){this.hasSubscription||(this.hasSubscription=!0,this.add(y(this,e)))},r.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},r.prototype.notifyComplete=function(e){this.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},r}(Pr);fr.prototype.exhaust=Oe;var Ji=function(){function e(e,t){this.project=e,this.resultSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Zi(e,this.project,this.resultSelector))},e}(),Zi=function(e){function r(t,r,n){e.call(this,t),this.project=r,this.resultSelector=n,this.hasSubscription=!1,this.hasCompleted=!1,this.index=0}return t(r,e),r.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},r.prototype.tryNext=function(e){var t=this.index++,r=this.destination;try{var n=this.project(e,t);this.hasSubscription=!0,this.add(y(this,n,e,t))}catch(i){r.error(i)}},r.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},r.prototype.notifyNext=function(e,t,r,n,i){var o=this,a=o.resultSelector,s=o.destination;a?this.trySelectResult(e,t,r,n):s.next(t)},r.prototype.trySelectResult=function(e,t,r,n){var i=this,o=i.resultSelector,a=i.destination;try{var s=o(e,t,r,n);a.next(s)}catch(u){a.error(u)}},r.prototype.notifyError=function(e){this.destination.error(e)},r.prototype.notifyComplete=function(e){this.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},r}(Pr);fr.prototype.exhaustMap=Ie;var eo=function(){function e(e,t,r){this.project=e,this.concurrent=t,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new to(e,this.project,this.concurrent,this.scheduler))},e}(),to=function(e){function r(t,r,n,i){e.call(this,t),this.project=r,this.concurrent=n,this.scheduler=i,this.index=0,this.active=0,this.hasCompleted=!1,n<Number.POSITIVE_INFINITY&&(this.buffer=[])}return t(r,e),r.dispatch=function(e){var t=e.subscriber,r=e.result,n=e.value,i=e.index;t.subscribeToProjection(r,n,i)},r.prototype._next=function(e){var t=this.destination;if(t.closed)return void this._complete();var n=this.index++;if(this.active<this.concurrent){t.next(e);var i=o(this.project)(e,n);if(i===or)t.error(or.e);else if(this.scheduler){var a={subscriber:this,result:i,value:e,index:n};this.add(this.scheduler.schedule(r.dispatch,0,a))}else this.subscribeToProjection(i,e,n)}else this.buffer.push(e)},r.prototype.subscribeToProjection=function(e,t,r){this.active++,this.add(y(this,e,t,r))},r.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete()},r.prototype.notifyNext=function(e,t,r,n,i){this._next(t)},r.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},r}(Pr);fr.prototype.expand=Re;var ro=function(e){function r(){var t=e.call(this,"argument out of range");this.name=t.name="ArgumentOutOfRangeError",this.stack=t.stack,this.message=t.message}return t(r,e),r}(Error),no=function(){function e(e,t){if(this.index=e,this.defaultValue=t,0>e)throw new ro}return e.prototype.call=function(e,t){return t.subscribe(new io(e,this.index,this.defaultValue))},e}(),io=function(e){function r(t,r,n){e.call(this,t),this.index=r,this.defaultValue=n}return t(r,e),r.prototype._next=function(e){0===this.index--&&(this.destination.next(e),this.destination.complete())},r.prototype._complete=function(){var e=this.destination;this.index>=0&&("undefined"!=typeof this.defaultValue?e.next(this.defaultValue):e.error(new ro)),e.complete()},r}(hr);fr.prototype.elementAt=je;var oo=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new ao(e,this.predicate,this.thisArg))},e}(),ao=function(e){function r(t,r,n){e.call(this,t),this.predicate=r,this.thisArg=n,this.count=0,this.predicate=r}return t(r,e),r.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}t&&this.destination.next(e)},r}(hr);fr.prototype.filter=De;var so=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new uo(e,this.callback))},e}(),uo=function(e){function r(t,r){e.call(this,t),this.add(new sr(r))}return t(r,e),r}(hr);fr.prototype["finally"]=Me,fr.prototype._finally=Me;var lo=function(){function e(e,t,r,n){this.predicate=e,this.source=t,this.yieldIndex=r,this.thisArg=n}return e.prototype.call=function(e,t){return t.subscribe(new co(e,this.predicate,this.source,this.yieldIndex,this.thisArg))},e}(),co=function(e){function r(t,r,n,i,o){e.call(this,t),this.predicate=r,this.source=n,this.yieldIndex=i,this.thisArg=o,this.index=0}return t(r,e),r.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},r.prototype._next=function(e){var t=this,r=t.predicate,n=t.thisArg,i=this.index++;try{var o=r.call(n||this,e,i,this.source);o&&this.notifyComplete(this.yieldIndex?i:e)}catch(a){this.destination.error(a)}},r.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},r}(hr);fr.prototype.find=Le,fr.prototype.findIndex=Fe;var ho=function(e){function r(){var t=e.call(this,"no elements in sequence");this.name=t.name="EmptyError",this.stack=t.stack,this.message=t.message}return t(r,e),r}(Error),po=function(){function e(e,t,r,n){this.predicate=e,this.resultSelector=t,this.defaultValue=r,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new fo(e,this.predicate,this.resultSelector,this.defaultValue,this.source))},e}(),fo=function(e){function r(t,r,n,i,o){e.call(this,t),this.predicate=r,this.resultSelector=n,this.defaultValue=i,this.source=o,this.index=0,this.hasCompleted=!1,this._emitted=!1}return t(r,e),r.prototype._next=function(e){var t=this.index++;this.predicate?this._tryPredicate(e,t):this._emit(e,t)},r.prototype._tryPredicate=function(e,t){var r;try{r=this.predicate(e,t,this.source)}catch(n){return void this.destination.error(n)}r&&this._emit(e,t)},r.prototype._emit=function(e,t){return this.resultSelector?void this._tryResultSelector(e,t):void this._emitFinal(e)},r.prototype._tryResultSelector=function(e,t){var r;try{r=this.resultSelector(e,t)}catch(n){return void this.destination.error(n)}this._emitFinal(r)},r.prototype._emitFinal=function(e){var t=this.destination;this._emitted||(this._emitted=!0,t.next(e),t.complete(),this.hasCompleted=!0)},r.prototype._complete=function(){var e=this.destination;this.hasCompleted||"undefined"==typeof this.defaultValue?this.hasCompleted||e.error(new ho):(e.next(this.defaultValue),e.complete())},r}(hr);fr.prototype.first=Ve;var mo=function(){function e(){this.size=0,this._values=[],this._keys=[]}return e.prototype.get=function(e){var t=this._keys.indexOf(e);return-1===t?void 0:this._values[t]},e.prototype.set=function(e,t){var r=this._keys.indexOf(e);return-1===r?(this._keys.push(e),this._values.push(t),this.size++):this._values[r]=t,this},e.prototype["delete"]=function(e){var t=this._keys.indexOf(e);return-1===t?!1:(this._values.splice(t,1),this._keys.splice(t,1),this.size--,!0)},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this.size=0},e.prototype.forEach=function(e,t){for(var r=0;r<this.size;r++)e.call(t,this._values[r],this._keys[r])},e}(),vo=rr.Map||function(){return mo}(),yo=function(){function e(){this.values={}}return e.prototype["delete"]=function(e){return this.values[e]=null,!0},e.prototype.set=function(e,t){return this.values[e]=t,this},e.prototype.get=function(e){return this.values[e]},e.prototype.forEach=function(e,t){var r=this.values;for(var n in r)r.hasOwnProperty(n)&&null!==r[n]&&e.call(t,r[n],n)},e.prototype.clear=function(){this.values={}},e}(),go=function(){function e(e,t,r,n){this.keySelector=e,this.elementSelector=t,this.durationSelector=r,this.subjectSelector=n}return e.prototype.call=function(e,t){return t.subscribe(new _o(e,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},e}(),_o=function(e){function r(t,r,n,i,o){e.call(this,t),this.keySelector=r,this.elementSelector=n,this.durationSelector=i,this.subjectSelector=o,this.groups=null,this.attemptedToUnsubscribe=!1,this.count=0}return t(r,e),r.prototype._next=function(e){var t;try{t=this.keySelector(e)}catch(r){return void this.error(r)}this._group(e,t)},r.prototype._group=function(e,t){var r=this.groups;r||(r=this.groups="string"==typeof t?new yo:new vo);var n,i=r.get(t);if(this.elementSelector)try{n=this.elementSelector(e)}catch(o){this.error(o)}else n=e;if(!i){i=this.subjectSelector?this.subjectSelector():new gr,r.set(t,i);var a=new wo(t,i,this);if(this.destination.next(a),this.durationSelector){var s=void 0;try{s=this.durationSelector(new wo(t,i))}catch(o){return void this.error(o)}this.add(s.subscribe(new bo(t,i,this)))}}i.closed||i.next(n)},r.prototype._error=function(e){var t=this.groups;t&&(t.forEach(function(t,r){t.error(e)}),t.clear()),this.destination.error(e)},r.prototype._complete=function(){var e=this.groups;e&&(e.forEach(function(e,t){e.complete()}),e.clear()),this.destination.complete()},r.prototype.removeGroup=function(e){this.groups["delete"](e)},r.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))},r}(hr),bo=function(e){function r(t,r,n){e.call(this),this.key=t,this.group=r,this.parent=n}return t(r,e),r.prototype._next=function(e){this._complete()},r.prototype._error=function(e){var t=this.group;t.closed||t.error(e),this.parent.removeGroup(this.key)},r.prototype._complete=function(){var e=this.group;e.closed||e.complete(),this.parent.removeGroup(this.key)},r}(hr),wo=function(e){function r(t,r,n){e.call(this),this.key=t,this.groupSubject=r,this.refCountSubscription=n}return t(r,e),r.prototype._subscribe=function(e){var t=new sr,r=this,n=r.refCountSubscription,i=r.groupSubject;return n&&!n.closed&&t.add(new Eo(n)),t.add(i.subscribe(e)),t},r}(fr),Eo=function(e){function r(t){e.call(this),this.parent=t,t.count++}return t(r,e),r.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},r}(sr);fr.prototype.groupBy=Be;var xo=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new No(e))},e}(),No=function(e){function r(){e.apply(this,arguments)}return t(r,e),r.prototype._next=function(e){B()},r}(hr);fr.prototype.ignoreElements=$e;var So=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Co(e))},e}(),Co=function(e){function r(t){e.call(this,t)}return t(r,e),r.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},r.prototype._next=function(e){this.notifyComplete(!1)},r.prototype._complete=function(){this.notifyComplete(!0)},r}(hr);fr.prototype.isEmpty=He;var To=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Po(e,this.durationSelector))},e}(),Po=function(e){function r(t,r){e.call(this,t),this.durationSelector=r,this.hasValue=!1}return t(r,e),r.prototype._next=function(e){if(this.value=e,this.hasValue=!0,!this.throttled){var t=o(this.durationSelector)(e);t===or?this.destination.error(or.e):this.add(this.throttled=y(this,t))}},r.prototype.clearThrottle=function(){var e=this,t=e.value,r=e.hasValue,n=e.throttled;n&&(this.remove(n),this.throttled=null,n.unsubscribe()),r&&(this.value=null,this.hasValue=!1,this.destination.next(t))},r.prototype.notifyNext=function(e,t,r,n){this.clearThrottle()},r.prototype.notifyComplete=function(){this.clearThrottle()},r}(Pr);fr.prototype.audit=We;var ko=function(){function e(e,t){this.duration=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Ao(e,this.duration,this.scheduler))},e}(),Ao=function(e){function r(t,r,n){e.call(this,t),this.duration=r,this.scheduler=n,this.hasValue=!1}return t(r,e),r.prototype._next=function(e){this.value=e,this.hasValue=!0,this.throttled||this.add(this.throttled=this.scheduler.schedule(Ue,this.duration,this))},r.prototype.clearThrottle=function(){var e=this,t=e.value,r=e.hasValue,n=e.throttled;n&&(this.remove(n),this.throttled=null,n.unsubscribe()),r&&(this.value=null,this.hasValue=!1,this.destination.next(t))},r}(hr);fr.prototype.auditTime=qe;var Oo=function(){function e(e,t,r,n){this.predicate=e,this.resultSelector=t,this.defaultValue=r,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new Io(e,this.predicate,this.resultSelector,this.defaultValue,this.source))},e}(),Io=function(e){function r(t,r,n,i,o){e.call(this,t),this.predicate=r,this.resultSelector=n,this.defaultValue=i,this.source=o,this.hasValue=!1,this.index=0,"undefined"!=typeof i&&(this.lastValue=i,this.hasValue=!0)}return t(r,e),r.prototype._next=function(e){var t=this.index++;if(this.predicate)this._tryPredicate(e,t);else{if(this.resultSelector)return void this._tryResultSelector(e,t);this.lastValue=e,this.hasValue=!0}},r.prototype._tryPredicate=function(e,t){var r;try{r=this.predicate(e,t,this.source)}catch(n){return void this.destination.error(n)}if(r){if(this.resultSelector)return void this._tryResultSelector(e,t);this.lastValue=e,this.hasValue=!0}},r.prototype._tryResultSelector=function(e,t){var r;try{r=this.resultSelector(e,t)}catch(n){return void this.destination.error(n)}this.lastValue=r,this.hasValue=!0},r.prototype._complete=function(){var e=this.destination;this.hasValue?(e.next(this.lastValue),e.complete()):e.error(new ho)},r}(hr);fr.prototype.last=ze,fr.prototype.let=Ge,fr.prototype.letBind=Ge;var Ro=function(){function e(e,t,r){this.predicate=e,this.thisArg=t,this.source=r}return e.prototype.call=function(e,t){return t.subscribe(new jo(e,this.predicate,this.thisArg,this.source))},e}(),jo=function(e){function r(t,r,n,i){e.call(this,t),this.predicate=r,this.thisArg=n,this.source=i,this.index=0,this.thisArg=n||this}return t(r,e),r.prototype.notifyComplete=function(e){this.destination.next(e),this.destination.complete()},r.prototype._next=function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(r){return void this.destination.error(r)}t||this.notifyComplete(!1)},r.prototype._complete=function(){this.notifyComplete(!0)},r}(hr);fr.prototype.every=Ke,fr.prototype.map=G;var Do=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new Mo(e,this.value))},e}(),Mo=function(e){function r(t,r){e.call(this,t),this.value=r}return t(r,e),r.prototype._next=function(e){this.destination.next(this.value)},r}(hr);fr.prototype.mapTo=Xe;var Lo=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Fo(e))},e}(),Fo=function(e){function r(t){e.call(this,t)}return t(r,e),r.prototype._next=function(e){this.destination.next(Qr.createNext(e))},r.prototype._error=function(e){var t=this.destination;t.next(Qr.createError(e)),t.complete()},r.prototype._complete=function(){var e=this.destination;e.next(Qr.createComplete()),e.complete()},r}(hr);fr.prototype.materialize=Qe;var Vo=function(){function e(e,t,r){void 0===r&&(r=!1),this.accumulator=e,this.seed=t,this.hasSeed=r}return e.prototype.call=function(e,t){return t.subscribe(new Bo(e,this.accumulator,this.seed,this.hasSeed))},e}(),Bo=function(e){function r(t,r,n,i){e.call(this,t),this.accumulator=r,this.hasSeed=i,this.index=0,this.hasValue=!1,this.acc=n,this.hasSeed||this.index++}return t(r,e),r.prototype._next=function(e){this.hasValue||(this.hasValue=this.hasSeed)?this._tryReduce(e):(this.acc=e,this.hasValue=!0)},r.prototype._tryReduce=function(e){var t;try{t=this.accumulator(this.acc,e,this.index++)}catch(r){return void this.destination.error(r)}this.acc=t},r.prototype._complete=function(){(this.hasValue||this.hasSeed)&&this.destination.next(this.acc),this.destination.complete()},r}(hr);fr.prototype.max=Je,fr.prototype.merge=M,fr.prototype.mergeAll=b,fr.prototype.mergeMap=fe,fr.prototype.flatMap=fe,fr.prototype.flatMapTo=ve,
fr.prototype.mergeMapTo=ve;var $o=function(){function e(e,t,r){this.accumulator=e,this.seed=t,this.concurrent=r}return e.prototype.call=function(e,t){return t.subscribe(new Ho(e,this.accumulator,this.seed,this.concurrent))},e}(),Ho=function(e){function r(t,r,n,i){e.call(this,t),this.accumulator=r,this.acc=n,this.concurrent=i,this.hasValue=!1,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return t(r,e),r.prototype._next=function(e){if(this.active<this.concurrent){var t=this.index++,r=o(this.accumulator)(this.acc,e),n=this.destination;r===or?n.error(or.e):(this.active++,this._innerSub(r,e,t))}else this.buffer.push(e)},r.prototype._innerSub=function(e,t,r){this.add(y(this,e,t,r))},r.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(this.hasValue===!1&&this.destination.next(this.acc),this.destination.complete())},r.prototype.notifyNext=function(e,t,r,n,i){var o=this.destination;this.acc=t,this.hasValue=!0,o.next(t)},r.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&(this.hasValue===!1&&this.destination.next(this.acc),this.destination.complete())},r}(Pr);fr.prototype.mergeScan=Ze,fr.prototype.min=et;var Wo=function(e){function r(t,r){e.call(this),this.source=t,this.subjectFactory=r,this._refCount=0}return t(r,e),r.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},r.prototype.getSubject=function(){var e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject},r.prototype.connect=function(){var e=this._connection;return e||(e=this._connection=new sr,e.add(this.source.subscribe(new Uo(this.getSubject(),this))),e.closed?(this._connection=null,e=sr.EMPTY):this._connection=e),e},r.prototype.refCount=function(){return this.lift(new zo(this))},r}(fr),qo={operator:{value:null},_refCount:{value:0,writable:!0},_subscribe:{value:Wo.prototype._subscribe},getSubject:{value:Wo.prototype.getSubject},connect:{value:Wo.prototype.connect},refCount:{value:Wo.prototype.refCount}},Uo=function(e){function r(t,r){e.call(this,t),this.connectable=r}return t(r,e),r.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},r.prototype._complete=function(){this._unsubscribe(),e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},r}(yr),zo=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var r=this.connectable;r._refCount++;var n=new Go(e,r),i=t.subscribe(n);return n.closed||(n.connection=r.connect()),i},e}(),Go=function(e){function r(t,r){e.call(this,t),this.connectable=r}return t(r,e),r.prototype._unsubscribe=function(){var e=this.connectable;if(!e)return void(this.connection=null);this.connectable=null;var t=e._refCount;if(0>=t)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);var r=this.connection,n=e._connection;this.connection=null,!n||r&&n!==r||n.unsubscribe()},r}(hr),Ko=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var r=this.selector,n=this.subjectFactory(),i=r(n).subscribe(e);return i.add(t.subscribe(n)),i},e}();fr.prototype.multicast=tt,fr.prototype.observeOn=k,fr.prototype.onErrorResumeNext=$;var Xo=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Qo(e))},e}(),Qo=function(e){function r(t){e.call(this,t),this.hasPrev=!1}return t(r,e),r.prototype._next=function(e){this.hasPrev?this.destination.next([this.prev,e]):this.hasPrev=!0,this.prev=e},r}(hr);fr.prototype.pairwise=rt,fr.prototype.partition=it,fr.prototype.pluck=ot,fr.prototype.publish=st;var Yo=function(e){function r(t){e.call(this),this._value=t}return t(r,e),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return r&&!r.closed&&t.next(this._value),r},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new mr;return this._value},r.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},r}(gr);fr.prototype.publishBehavior=ut,fr.prototype.publishReplay=lt,fr.prototype.publishLast=ct,fr.prototype.race=F,fr.prototype.reduce=Ye;var Jo=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Zo(e,this.count,this.source))},e}(),Zo=function(e){function r(t,r,n){e.call(this,t),this.count=r,this.source=n}return t(r,e),r.prototype.complete=function(){if(!this.isStopped){var t=this,r=t.source,n=t.count;if(0===n)return e.prototype.complete.call(this);n>-1&&(this.count=n-1),r.subscribe(this._unsubscribeAndRecycle())}},r}(hr);fr.prototype.repeat=ht;var ea=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new ta(e,this.notifier,t))},e}(),ta=function(e){function r(t,r,n){e.call(this,t),this.notifier=r,this.source=n,this.sourceIsBeingSubscribedTo=!0}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},r.prototype.notifyComplete=function(t){return this.sourceIsBeingSubscribedTo===!1?e.prototype.complete.call(this):void 0},r.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries){if(this.retriesSubscription.closed)return e.prototype.complete.call(this)}else this.subscribeToRetries();this._unsubscribeAndRecycle(),this.notifications.next()}},r.prototype._unsubscribe=function(){var e=this,t=e.notifications,r=e.retriesSubscription;t&&(t.unsubscribe(),this.notifications=null),r&&(r.unsubscribe(),this.retriesSubscription=null),this.retries=null},r.prototype._unsubscribeAndRecycle=function(){var t=this,r=t.notifications,n=t.retries,i=t.retriesSubscription;return this.notifications=null,this.retries=null,this.retriesSubscription=null,e.prototype._unsubscribeAndRecycle.call(this),this.notifications=r,this.retries=n,this.retriesSubscription=i,this},r.prototype.subscribeToRetries=function(){this.notifications=new gr;var t=o(this.notifier)(this.notifications);return t===or?e.prototype.complete.call(this):(this.retries=t,void(this.retriesSubscription=y(this,t)))},r}(Pr);fr.prototype.repeatWhen=dt;var ra=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new na(e,this.count,this.source))},e}(),na=function(e){function r(t,r,n){e.call(this,t),this.count=r,this.source=n}return t(r,e),r.prototype.error=function(t){if(!this.isStopped){var r=this,n=r.source,i=r.count;if(0===i)return e.prototype.error.call(this,t);i>-1&&(this.count=i-1),n.subscribe(this._unsubscribeAndRecycle())}},r}(hr);fr.prototype.retry=pt;var ia=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new oa(e,this.notifier,this.source))},e}(),oa=function(e){function r(t,r,n){e.call(this,t),this.notifier=r,this.source=n}return t(r,e),r.prototype.error=function(t){if(!this.isStopped){var r=this.errors,n=this.retries,i=this.retriesSubscription;if(n)this.errors=null,this.retriesSubscription=null;else{if(r=new gr,n=o(this.notifier)(r),n===or)return e.prototype.error.call(this,or.e);i=y(this,n)}this._unsubscribeAndRecycle(),this.errors=r,this.retries=n,this.retriesSubscription=i,r.next(t)}},r.prototype._unsubscribe=function(){var e=this,t=e.errors,r=e.retriesSubscription;t&&(t.unsubscribe(),this.errors=null),r&&(r.unsubscribe(),this.retriesSubscription=null),this.retries=null},r.prototype.notifyNext=function(e,t,r,n,i){var o=this,a=o.errors,s=o.retries,u=o.retriesSubscription;this.errors=null,this.retries=null,this.retriesSubscription=null,this._unsubscribeAndRecycle(),this.errors=a,this.retries=s,this.retriesSubscription=u,this.source.subscribe(this)},r}(Pr);fr.prototype.retryWhen=ft;var aa=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var r=new sa(e),n=t.subscribe(r);return n.add(y(r,this.notifier)),n},e}(),sa=function(e){function r(){e.apply(this,arguments),this.hasValue=!1}return t(r,e),r.prototype._next=function(e){this.value=e,this.hasValue=!0},r.prototype.notifyNext=function(e,t,r,n,i){this.emitValue()},r.prototype.notifyComplete=function(){this.emitValue()},r.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},r}(Pr);fr.prototype.sample=mt;var ua=function(){function e(e,t){this.period=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new la(e,this.period,this.scheduler))},e}(),la=function(e){function r(t,r,n){e.call(this,t),this.period=r,this.scheduler=n,this.hasValue=!1,this.add(n.schedule(yt,r,{subscriber:this,period:r}))}return t(r,e),r.prototype._next=function(e){this.lastValue=e,this.hasValue=!0},r.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},r}(hr);fr.prototype.sampleTime=vt;var ca=function(){function e(e,t,r){void 0===r&&(r=!1),this.accumulator=e,this.seed=t,this.hasSeed=r}return e.prototype.call=function(e,t){return t.subscribe(new ha(e,this.accumulator,this.seed,this.hasSeed))},e}(),ha=function(e){function r(t,r,n,i){e.call(this,t),this.accumulator=r,this._seed=n,this.hasSeed=i,this.index=0}return t(r,e),Object.defineProperty(r.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),r.prototype._next=function(e){return this.hasSeed?this._tryNext(e):(this.seed=e,void this.destination.next(e))},r.prototype._tryNext=function(e){var t,r=this.index++;try{t=this.accumulator(this.seed,e,r)}catch(n){this.destination.error(n)}this.seed=t,this.destination.next(t)},r}(hr);fr.prototype.scan=gt;var da=function(){function e(e,t){this.compareTo=e,this.comparor=t}return e.prototype.call=function(e,t){return t.subscribe(new pa(e,this.compareTo,this.comparor))},e}(),pa=function(e){function r(t,r,n){e.call(this,t),this.compareTo=r,this.comparor=n,this._a=[],this._b=[],this._oneComplete=!1,this.add(r.subscribe(new fa(t,this)))}return t(r,e),r.prototype._next=function(e){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(e),this.checkValues())},r.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},r.prototype.checkValues=function(){for(var e=this,t=e._a,r=e._b,n=e.comparor;t.length>0&&r.length>0;){var i=t.shift(),a=r.shift(),s=!1;n?(s=o(n)(i,a),s===or&&this.destination.error(or.e)):s=i===a,s||this.emit(!1)}},r.prototype.emit=function(e){var t=this.destination;t.next(e),t.complete()},r.prototype.nextB=function(e){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(e),this.checkValues())},r}(hr),fa=function(e){function r(t,r){e.call(this,t),this.parent=r}return t(r,e),r.prototype._next=function(e){this.parent.nextB(e)},r.prototype._error=function(e){this.parent.error(e)},r.prototype._complete=function(){this.parent._complete()},r}(hr);fr.prototype.sequenceEqual=_t,fr.prototype.share=wt;var ma=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new va(e,this.predicate,this.source))},e}(),va=function(e){function r(t,r,n){e.call(this,t),this.predicate=r,this.source=n,this.seenValue=!1,this.index=0}return t(r,e),r.prototype.applySingleValue=function(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)},r.prototype._next=function(e){var t=this.predicate;this.index++,t?this.tryNext(e):this.applySingleValue(e)},r.prototype.tryNext=function(e){try{var t=this.predicate(e,this.index,this.source);t&&this.applySingleValue(e)}catch(r){this.destination.error(r)}},r.prototype._complete=function(){var e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new ho)},r}(hr);fr.prototype.single=Et;var ya=function(){function e(e){this.total=e}return e.prototype.call=function(e,t){return t.subscribe(new ga(e,this.total))},e}(),ga=function(e){function r(t,r){e.call(this,t),this.total=r,this.count=0}return t(r,e),r.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)},r}(hr);fr.prototype.skip=xt;var _a=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new ba(e,this.notifier))},e}(),ba=function(e){function r(t,r){e.call(this,t),this.hasValue=!1,this.isInnerStopped=!1,this.add(y(this,r))}return t(r,e),r.prototype._next=function(t){this.hasValue&&e.prototype._next.call(this,t)},r.prototype._complete=function(){this.isInnerStopped?e.prototype._complete.call(this):this.unsubscribe()},r.prototype.notifyNext=function(e,t,r,n,i){this.hasValue=!0},r.prototype.notifyComplete=function(){this.isInnerStopped=!0,this.isStopped&&e.prototype._complete.call(this)},r}(Pr);fr.prototype.skipUntil=Nt;var wa=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new Ea(e,this.predicate))},e}(),Ea=function(e){function r(t,r){e.call(this,t),this.predicate=r,this.skipping=!0,this.index=0}return t(r,e),r.prototype._next=function(e){var t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)},r.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(r){this.destination.error(r)}},r}(hr);fr.prototype.skipWhile=St,fr.prototype.startWith=Ct;var xa=function(){function e(e){if(this.root=e,e.setImmediate&&"function"==typeof e.setImmediate)this.setImmediate=e.setImmediate.bind(e),this.clearImmediate=e.clearImmediate.bind(e);else{this.nextHandle=1,this.tasksByHandle={},this.currentlyRunningATask=!1,this.canUseProcessNextTick()?this.setImmediate=this.createProcessNextTickSetImmediate():this.canUsePostMessage()?this.setImmediate=this.createPostMessageSetImmediate():this.canUseMessageChannel()?this.setImmediate=this.createMessageChannelSetImmediate():this.canUseReadyStateChange()?this.setImmediate=this.createReadyStateChangeSetImmediate():this.setImmediate=this.createSetTimeoutSetImmediate();var t=function r(e){delete r.instance.tasksByHandle[e]};t.instance=this,this.clearImmediate=t}}return e.prototype.identify=function(e){return this.root.Object.prototype.toString.call(e)},e.prototype.canUseProcessNextTick=function(){return"[object process]"===this.identify(this.root.process)},e.prototype.canUseMessageChannel=function(){return Boolean(this.root.MessageChannel)},e.prototype.canUseReadyStateChange=function(){var e=this.root.document;return Boolean(e&&"onreadystatechange"in e.createElement("script"))},e.prototype.canUsePostMessage=function(){var e=this.root;if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}return!1},e.prototype.partiallyApplied=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=function i(){var e=i,t=e.handler,r=e.args;"function"==typeof t?t.apply(void 0,r):new Function(""+t)()};return n.handler=e,n.args=t,n},e.prototype.addFromSetImmediateArguments=function(e){return this.tasksByHandle[this.nextHandle]=this.partiallyApplied.apply(void 0,e),this.nextHandle++},e.prototype.createProcessNextTickSetImmediate=function(){var e=function t(){var e=t.instance,r=e.addFromSetImmediateArguments(arguments);return e.root.process.nextTick(e.partiallyApplied(e.runIfPresent,r)),r};return e.instance=this,e},e.prototype.createPostMessageSetImmediate=function(){var e=this.root,t="setImmediate$"+e.Math.random()+"$",r=function i(r){var n=i.instance;r.source===e&&"string"==typeof r.data&&0===r.data.indexOf(t)&&n.runIfPresent(+r.data.slice(t.length))};r.instance=this,e.addEventListener("message",r,!1);var n=function o(){var e=o,t=e.messagePrefix,r=e.instance,n=r.addFromSetImmediateArguments(arguments);return r.root.postMessage(t+n,"*"),n};return n.instance=this,n.messagePrefix=t,n},e.prototype.runIfPresent=function(e){if(this.currentlyRunningATask)this.root.setTimeout(this.partiallyApplied(this.runIfPresent,e),0);else{var t=this.tasksByHandle[e];if(t){this.currentlyRunningATask=!0;try{t()}finally{this.clearImmediate(e),this.currentlyRunningATask=!1}}}},e.prototype.createMessageChannelSetImmediate=function(){var e=this,t=new this.root.MessageChannel;t.port1.onmessage=function(t){var r=t.data;e.runIfPresent(r)};var r=function n(){var e=n,t=e.channel,r=e.instance,i=r.addFromSetImmediateArguments(arguments);return t.port2.postMessage(i),i};return r.channel=t,r.instance=this,r},e.prototype.createReadyStateChangeSetImmediate=function(){var e=function t(){var e=t.instance,r=e.root,n=r.document,i=n.documentElement,o=e.addFromSetImmediateArguments(arguments),a=n.createElement("script");return a.onreadystatechange=function(){e.runIfPresent(o),a.onreadystatechange=null,i.removeChild(a),a=null},i.appendChild(a),o};return e.instance=this,e},e.prototype.createSetTimeoutSetImmediate=function(){var e=function t(){var e=t.instance,r=e.addFromSetImmediateArguments(arguments);return e.root.setTimeout(e.partiallyApplied(e.runIfPresent,r),0),r};return e.instance=this,e},e}(),Na=new xa(rr),Sa=function(e){function r(t,r){e.call(this,t,r),this.scheduler=t,this.work=r}return t(r,e),r.prototype.requestAsyncId=function(t,r,n){return void 0===n&&(n=0),null!==n&&n>0?e.prototype.requestAsyncId.call(this,t,r,n):(t.actions.push(this),t.scheduled||(t.scheduled=Na.setImmediate(t.flush.bind(t,null))))},r.prototype.recycleAsyncId=function(t,r,n){return void 0===n&&(n=0),null!==n&&n>0||null===n&&this.delay>0?e.prototype.recycleAsyncId.call(this,t,r,n):void(0===t.actions.length&&(Na.clearImmediate(r),t.scheduled=void 0))},r}(vn),Ca=function(e){function r(){e.apply(this,arguments)}return t(r,e),r.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,r=this.actions,n=-1,i=r.length;e=e||r.shift();do if(t=e.execute(e.state,e.delay))break;while(++n<i&&(e=r.shift()));if(this.active=!1,t){for(;++n<i&&(e=r.shift());)e.unsubscribe();throw t}},r}(gn),Ta=new Ca(Sa),Pa=function(e){function r(t,r,n){void 0===r&&(r=0),void 0===n&&(n=Ta),e.call(this),this.source=t,this.delayTime=r,this.scheduler=n,(!D(r)||0>r)&&(this.delayTime=0),n&&"function"==typeof n.schedule||(this.scheduler=Ta)}return t(r,e),r.create=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=Ta),new r(e,t,n)},r.dispatch=function(e){var t=e.source,r=e.subscriber;return this.add(t.subscribe(r))},r.prototype._subscribe=function(e){var t=this.delayTime,n=this.source,i=this.scheduler;return i.schedule(r.dispatch,t,{source:n,subscriber:e})},r}(fr),ka=function(){function e(e,t){this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return new Pa(t,this.delay,this.scheduler).subscribe(e)},e}();fr.prototype.subscribeOn=Tt;var Aa=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Oa(e))},e}(),Oa=function(e){function r(t){e.call(this,t),this.active=0,this.hasCompleted=!1}return t(r,e),r.prototype._next=function(e){this.unsubscribeInner(),this.active++,this.add(this.innerSubscription=y(this,e))},r.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&this.destination.complete()},r.prototype.unsubscribeInner=function(){this.active=this.active>0?this.active-1:0;var e=this.innerSubscription;e&&(e.unsubscribe(),this.remove(e))},r.prototype.notifyNext=function(e,t,r,n,i){this.destination.next(t)},r.prototype.notifyError=function(e){this.destination.error(e)},r.prototype.notifyComplete=function(){this.unsubscribeInner(),this.hasCompleted&&0===this.active&&this.destination.complete()},r}(Pr);fr.prototype["switch"]=Pt,fr.prototype._switch=Pt;var Ia=function(){function e(e,t){this.project=e,this.resultSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Ra(e,this.project,this.resultSelector))},e}(),Ra=function(e){function r(t,r,n){e.call(this,t),this.project=r,this.resultSelector=n,this.index=0}return t(r,e),r.prototype._next=function(e){var t,r=this.index++;try{t=this.project(e,r)}catch(n){return void this.destination.error(n)}this._innerSub(t,e,r)},r.prototype._innerSub=function(e,t,r){var n=this.innerSubscription;n&&n.unsubscribe(),this.add(this.innerSubscription=y(this,e,t,r))},r.prototype._complete=function(){var t=this.innerSubscription;(!t||t.closed)&&e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){this.innerSubscription=null},r.prototype.notifyComplete=function(t){this.remove(t),this.innerSubscription=null,this.isStopped&&e.prototype._complete.call(this)},r.prototype.notifyNext=function(e,t,r,n,i){this.resultSelector?this._tryNotifyNext(e,t,r,n):this.destination.next(t)},r.prototype._tryNotifyNext=function(e,t,r,n){var i;try{i=this.resultSelector(e,t,r,n)}catch(o){return void this.destination.error(o)}this.destination.next(i)},r}(Pr);fr.prototype.switchMap=kt;var ja=function(){function e(e,t){this.observable=e,this.resultSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Da(e,this.observable,this.resultSelector))},e}(),Da=function(e){function r(t,r,n){e.call(this,t),this.inner=r,this.resultSelector=n,this.index=0}return t(r,e),r.prototype._next=function(e){var t=this.innerSubscription;t&&t.unsubscribe(),this.add(this.innerSubscription=y(this,this.inner,e,this.index++))},r.prototype._complete=function(){var t=this.innerSubscription;(!t||t.closed)&&e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){this.innerSubscription=null},r.prototype.notifyComplete=function(t){this.remove(t),this.innerSubscription=null,this.isStopped&&e.prototype._complete.call(this)},r.prototype.notifyNext=function(e,t,r,n,i){var o=this,a=o.resultSelector,s=o.destination;a?this.tryResultSelector(e,t,r,n):s.next(t)},r.prototype.tryResultSelector=function(e,t,r,n){var i,o=this,a=o.resultSelector,s=o.destination;try{i=a(e,t,r,n)}catch(u){return void s.error(u)}s.next(i)},r}(Pr);fr.prototype.switchMapTo=At;var Ma=function(){function e(e){if(this.total=e,this.total<0)throw new ro}return e.prototype.call=function(e,t){return t.subscribe(new La(e,this.total))},e}(),La=function(e){function r(t,r){e.call(this,t),this.total=r,this.count=0}return t(r,e),r.prototype._next=function(e){var t=this.total,r=++this.count;t>=r&&(this.destination.next(e),r===t&&(this.destination.complete(),this.unsubscribe()))},r}(hr);fr.prototype.take=Ot;var Fa=function(){function e(e){if(this.total=e,this.total<0)throw new ro}return e.prototype.call=function(e,t){return t.subscribe(new Va(e,this.total))},e}(),Va=function(e){function r(t,r){e.call(this,t),this.total=r,this.ring=new Array,this.count=0}return t(r,e),r.prototype._next=function(e){var t=this.ring,r=this.total,n=this.count++;if(t.length<r)t.push(e);else{var i=n%r;t[i]=e}},r.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var r=this.count>=this.total?this.total:this.count,n=this.ring,i=0;r>i;i++){var o=t++%r;e.next(n[o])}e.complete()},r}(hr);fr.prototype.takeLast=It;var Ba=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new $a(e,this.notifier))},e}(),$a=function(e){function r(t,r){e.call(this,t),this.notifier=r,this.add(y(this,r))}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.complete()},r.prototype.notifyComplete=function(){},r}(Pr);fr.prototype.takeUntil=Rt;var Ha=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new Wa(e,this.predicate))},e}(),Wa=function(e){function r(t,r){e.call(this,t),this.predicate=r,this.index=0}return t(r,e),r.prototype._next=function(e){var t,r=this.destination;try{t=this.predicate(e,this.index++)}catch(n){return void r.error(n)}this.nextOrComplete(e,t)},r.prototype.nextOrComplete=function(e,t){var r=this.destination;Boolean(t)?r.next(e):r.complete()},r}(hr);fr.prototype.takeWhile=jt;var qa=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ua(e,this.durationSelector))},e}(),Ua=function(e){function r(t,r){e.call(this,t),this.destination=t,this.durationSelector=r}return t(r,e),r.prototype._next=function(e){this.throttled||this.tryDurationSelector(e)},r.prototype.tryDurationSelector=function(e){var t=null;try{t=this.durationSelector(e)}catch(r){return void this.destination.error(r)}this.emitAndThrottle(e,t)},r.prototype.emitAndThrottle=function(e,t){this.add(this.throttled=y(this,t)),this.destination.next(e)},r.prototype._unsubscribe=function(){var e=this.throttled;e&&(this.remove(e),this.throttled=null,e.unsubscribe())},r.prototype.notifyNext=function(e,t,r,n,i){this._unsubscribe()},r.prototype.notifyComplete=function(){this._unsubscribe()},r}(Pr);fr.prototype.throttle=Dt;var za=function(){function e(e,t){this.duration=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Ga(e,this.duration,this.scheduler))},e}(),Ga=function(e){function r(t,r,n){e.call(this,t),this.duration=r,this.scheduler=n}return t(r,e),r.prototype._next=function(e){this.throttled||(this.add(this.throttled=this.scheduler.schedule(Lt,this.duration,{subscriber:this})),this.destination.next(e))},r.prototype.clearThrottle=function(){var e=this.throttled;e&&(e.unsubscribe(),this.remove(e),this.throttled=null)},r}(hr);fr.prototype.throttleTime=Mt;var Ka=function(){function e(e,t){this.value=e,this.interval=t}return e}(),Xa=function(){function e(e){this.scheduler=e}return e.prototype.call=function(e,t){return t.subscribe(new Qa(e,this.scheduler))},e}(),Qa=function(e){function r(t,r){e.call(this,t),this.scheduler=r,this.lastTime=0,this.lastTime=r.now()}return t(r,e),r.prototype._next=function(e){var t=this.scheduler.now(),r=t-this.lastTime;this.lastTime=t,this.destination.next(new Ka(e,r))},r}(hr);fr.prototype.timeInterval=Ft;var Ya=function(e){function r(){var t=e.call(this,"Timeout has occurred");this.name=t.name="TimeoutError",this.stack=t.stack,this.message=t.message}return t(r,e),r}(Error),Ja=function(){function e(e,t,r,n){this.waitFor=e,this.absoluteTimeout=t,this.scheduler=r,this.errorInstance=n}return e.prototype.call=function(e,t){return t.subscribe(new Za(e,this.absoluteTimeout,this.waitFor,this.scheduler,this.errorInstance))},e}(),Za=function(e){function r(t,r,n,i,o){e.call(this,t),this.absoluteTimeout=r,this.waitFor=n,this.scheduler=i,this.errorInstance=o,this.index=0,this._previousIndex=0,this._hasCompleted=!1,this.scheduleTimeout()}return t(r,e),Object.defineProperty(r.prototype,"previousIndex",{get:function(){return this._previousIndex},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasCompleted",{get:function(){return this._hasCompleted},enumerable:!0,configurable:!0}),r.dispatchTimeout=function(e){var t=e.subscriber,r=e.index;t.hasCompleted||t.previousIndex!==r||t.notifyTimeout()},r.prototype.scheduleTimeout=function(){var e=this.index;this.scheduler.schedule(r.dispatchTimeout,this.waitFor,{subscriber:this,index:e}),this.index++,this._previousIndex=e},r.prototype._next=function(e){this.destination.next(e),this.absoluteTimeout||this.scheduleTimeout()},r.prototype._error=function(e){this.destination.error(e),this._hasCompleted=!0},r.prototype._complete=function(){this.destination.complete(),this._hasCompleted=!0},r.prototype.notifyTimeout=function(){this.error(this.errorInstance)},r}(hr);fr.prototype.timeout=Vt;var es=function(){function e(e,t,r,n){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=r,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new ts(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),ts=function(e){function r(t,r,n,i,o){e.call(this),this.destination=t,this.absoluteTimeout=r,this.waitFor=n,this.withObservable=i,this.scheduler=o,this.timeoutSubscription=void 0,this.index=0,this._previousIndex=0,this._hasCompleted=!1,t.add(this),this.scheduleTimeout()}return t(r,e),Object.defineProperty(r.prototype,"previousIndex",{get:function(){return this._previousIndex},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasCompleted",{get:function(){return this._hasCompleted},enumerable:!0,configurable:!0}),r.dispatchTimeout=function(e){var t=e.subscriber,r=e.index;t.hasCompleted||t.previousIndex!==r||t.handleTimeout()},r.prototype.scheduleTimeout=function(){var e=this.index,t={subscriber:this,index:e};this.scheduler.schedule(r.dispatchTimeout,this.waitFor,t),this.index++,this._previousIndex=e},r.prototype._next=function(e){this.destination.next(e),this.absoluteTimeout||this.scheduleTimeout()},r.prototype._error=function(e){this.destination.error(e),this._hasCompleted=!0},r.prototype._complete=function(){this.destination.complete(),this._hasCompleted=!0},r.prototype.handleTimeout=function(){if(!this.closed){var e=this.withObservable;this.unsubscribe(),this.destination.add(this.timeoutSubscription=y(this,e))}},r}(Pr);fr.prototype.timeoutWith=Bt;var rs=function(){function e(e,t){this.value=e,this.timestamp=t}return e}(),ns=function(){function e(e){this.scheduler=e}return e.prototype.call=function(e,t){return t.subscribe(new is(e,this.scheduler))},e}(),is=function(e){function r(t,r){e.call(this,t),this.scheduler=r}return t(r,e),r.prototype._next=function(e){var t=this.scheduler.now();this.destination.next(new rs(e,t))},r}(hr);fr.prototype.timestamp=$t;var os=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new as(e))},e}(),as=function(e){function r(t){e.call(this,t),this.array=[]}return t(r,e),r.prototype._next=function(e){this.array.push(e)},r.prototype._complete=function(){this.destination.next(this.array),this.destination.complete()},r}(hr);fr.prototype.toArray=Ht,fr.prototype.toPromise=Wt;var ss=function(){function e(e){this.windowBoundaries=e}return e.prototype.call=function(e,t){var r=new us(e),n=t.subscribe(r);return n.closed||r.add(y(r,this.windowBoundaries)),n},e}(),us=function(e){function r(t){e.call(this,t),this.window=new gr,t.next(this.window)}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.openWindow()},r.prototype.notifyError=function(e,t){this._error(e)},r.prototype.notifyComplete=function(e){this._complete()},r.prototype._next=function(e){this.window.next(e)},r.prototype._error=function(e){this.window.error(e),this.destination.error(e)},r.prototype._complete=function(){this.window.complete(),this.destination.complete()},r.prototype._unsubscribe=function(){this.window=null},r.prototype.openWindow=function(){var e=this.window;e&&e.complete();var t=this.destination,r=this.window=new gr;t.next(r)},r}(Pr);fr.prototype.window=qt;var ls=function(){function e(e,t){this.windowSize=e,this.startWindowEvery=t}return e.prototype.call=function(e,t){return t.subscribe(new cs(e,this.windowSize,this.startWindowEvery))},e}(),cs=function(e){function r(t,r,n){e.call(this,t),this.destination=t,this.windowSize=r,this.startWindowEvery=n,this.windows=[new gr],this.count=0,t.next(this.windows[0])}return t(r,e),r.prototype._next=function(e){for(var t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,r=this.destination,n=this.windowSize,i=this.windows,o=i.length,a=0;o>a&&!this.closed;a++)i[a].next(e);var s=this.count-n+1;if(s>=0&&s%t===0&&!this.closed&&i.shift().complete(),++this.count%t===0&&!this.closed){var u=new gr;i.push(u),r.next(u)}},r.prototype._error=function(e){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().error(e);this.destination.error(e)},r.prototype._complete=function(){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().complete();this.destination.complete()},r.prototype._unsubscribe=function(){this.count=0,this.windows=null},r}(hr);fr.prototype.windowCount=Ut;var hs=function(){function e(e,t,r){this.windowTimeSpan=e,this.windowCreationInterval=t,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new ds(e,this.windowTimeSpan,this.windowCreationInterval,this.scheduler));
},e}(),ds=function(e){function r(t,r,n,i){e.call(this,t),this.destination=t,this.windowTimeSpan=r,this.windowCreationInterval=n,this.scheduler=i,this.windows=[];var o=this.openWindow();if(null!==n&&n>=0){var a={subscriber:this,window:o,context:null},s={windowTimeSpan:r,windowCreationInterval:n,subscriber:this,scheduler:i};this.add(i.schedule(Xt,r,a)),this.add(i.schedule(Kt,n,s))}else{var u={subscriber:this,window:o,windowTimeSpan:r};this.add(i.schedule(Gt,r,u))}}return t(r,e),r.prototype._next=function(e){for(var t=this.windows,r=t.length,n=0;r>n;n++){var i=t[n];i.closed||i.next(e)}},r.prototype._error=function(e){for(var t=this.windows;t.length>0;)t.shift().error(e);this.destination.error(e)},r.prototype._complete=function(){for(var e=this.windows;e.length>0;){var t=e.shift();t.closed||t.complete()}this.destination.complete()},r.prototype.openWindow=function(){var e=new gr;this.windows.push(e);var t=this.destination;return t.next(e),e},r.prototype.closeWindow=function(e){e.complete();var t=this.windows;t.splice(t.indexOf(e),1)},r}(hr);fr.prototype.windowTime=zt;var ps=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new fs(e,this.openings,this.closingSelector))},e}(),fs=function(e){function r(t,r,n){e.call(this,t),this.openings=r,this.closingSelector=n,this.contexts=[],this.add(this.openSubscription=y(this,r,r))}return t(r,e),r.prototype._next=function(e){var t=this.contexts;if(t)for(var r=t.length,n=0;r>n;n++)t[n].window.next(e)},r.prototype._error=function(t){var r=this.contexts;if(this.contexts=null,r)for(var n=r.length,i=-1;++i<n;){var o=r[i];o.window.error(t),o.subscription.unsubscribe()}e.prototype._error.call(this,t)},r.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var r=t.length,n=-1;++n<r;){var i=t[n];i.window.complete(),i.subscription.unsubscribe()}e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){var e=this.contexts;if(this.contexts=null,e)for(var t=e.length,r=-1;++r<t;){var n=e[r];n.window.unsubscribe(),n.subscription.unsubscribe()}},r.prototype.notifyNext=function(e,t,r,n,i){if(e===this.openings){var a=this.closingSelector,s=o(a)(t);if(s===or)return this.error(or.e);var u=new gr,l=new sr,c={window:u,subscription:l};this.contexts.push(c);var h=y(this,s,c);h.closed?this.closeWindow(this.contexts.length-1):(h.context=c,l.add(h)),this.destination.next(u)}else this.closeWindow(this.contexts.indexOf(e))},r.prototype.notifyError=function(e){this.error(e)},r.prototype.notifyComplete=function(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))},r.prototype.closeWindow=function(e){if(-1!==e){var t=this.contexts,r=t[e],n=r.window,i=r.subscription;t.splice(e,1),n.complete(),i.unsubscribe()}},r}(Pr);fr.prototype.windowToggle=Qt;var ms=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new vs(e,this.closingSelector))},e}(),vs=function(e){function r(t,r){e.call(this,t),this.destination=t,this.closingSelector=r,this.openWindow()}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.openWindow(i)},r.prototype.notifyError=function(e,t){this._error(e)},r.prototype.notifyComplete=function(e){this.openWindow(e)},r.prototype._next=function(e){this.window.next(e)},r.prototype._error=function(e){this.window.error(e),this.destination.error(e),this.unsubscribeClosingNotification()},r.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},r.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},r.prototype.openWindow=function(e){void 0===e&&(e=null),e&&(this.remove(e),e.unsubscribe());var t=this.window;t&&t.complete();var r=this.window=new gr;this.destination.next(r);var n=o(this.closingSelector)();if(n===or){var i=or.e;this.destination.error(i),this.window.error(i)}else this.add(this.closingNotification=y(this,n))},r}(Pr);fr.prototype.windowWhen=Yt;var ys=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new gs(e,this.observables,this.project))},e}(),gs=function(e){function r(t,r,n){e.call(this,t),this.observables=r,this.project=n,this.toRespond=[];var i=r.length;this.values=new Array(i);for(var o=0;i>o;o++)this.toRespond.push(o);for(var o=0;i>o;o++){var a=r[o];this.add(y(this,a,a,o))}}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.values[r]=t;var o=this.toRespond;if(o.length>0){var a=o.indexOf(r);-1!==a&&o.splice(a,1)}},r.prototype.notifyComplete=function(){},r.prototype._next=function(e){if(0===this.toRespond.length){var t=[e].concat(this.values);this.project?this._tryProject(t):this.destination.next(t)}},r.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(r){return void this.destination.error(r)}this.destination.next(t)},r}(Pr);fr.prototype.withLatestFrom=Jt,fr.prototype.zip=U,fr.prototype.zipAll=Zt;var _s=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.subscribedFrame=e,this.unsubscribedFrame=t}return e}(),bs=function(){function e(){this.subscriptions=[]}return e.prototype.logSubscribedFrame=function(){return this.subscriptions.push(new _s(this.scheduler.now())),this.subscriptions.length-1},e.prototype.logUnsubscribedFrame=function(e){var t=this.subscriptions,r=t[e];t[e]=new _s(r.subscribedFrame,this.scheduler.now())},e}(),ws=function(e){function r(t,r){e.call(this,function(e){var t=this,r=t.logSubscribedFrame();return e.add(new sr(function(){t.logUnsubscribedFrame(r)})),t.scheduleMessages(e),e}),this.messages=t,this.subscriptions=[],this.scheduler=r}return t(r,e),r.prototype.scheduleMessages=function(e){for(var t=this.messages.length,r=0;t>r;r++){var n=this.messages[r];e.add(this.scheduler.schedule(function(e){var t=e.message,r=e.subscriber;t.notification.observe(r)},n.frame,{message:n,subscriber:e}))}},r}(fr);er(ws,[bs]);var Es=function(e){function r(t,r){e.call(this),this.messages=t,this.subscriptions=[],this.scheduler=r}return t(r,e),r.prototype._subscribe=function(t){var r=this,n=r.logSubscribedFrame();return t.add(new sr(function(){r.logUnsubscribedFrame(n)})),e.prototype._subscribe.call(this,t)},r.prototype.setup=function(){for(var e=this,t=e.messages.length,r=0;t>r;r++)!function(){var t=e.messages[r];e.scheduler.schedule(function(){t.notification.observe(e)},t.frame)}()},r}(gr);er(Es,[bs]);var xs=function(e){function r(t,r){var n=this;void 0===t&&(t=Ns),void 0===r&&(r=Number.POSITIVE_INFINITY),e.call(this,t,function(){return n.frame}),this.maxFrames=r,this.frame=0,this.index=-1}return t(r,e),r.prototype.flush=function(){for(var e,t,r=this,n=r.actions,i=r.maxFrames;(t=n.shift())&&(this.frame=t.delay)<=i&&!(e=t.execute(t.state,t.delay)););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},r.frameTimeFactor=10,r}(gn),Ns=function(e){function r(t,r,n){void 0===n&&(n=t.index+=1),e.call(this,t,r),this.scheduler=t,this.work=r,this.index=n,this.index=t.index=n}return t(r,e),r.prototype.schedule=function(t,n){if(void 0===n&&(n=0),!this.id)return e.prototype.schedule.call(this,t,n);var i=new r(this.scheduler,this.work);return this.add(i),i.schedule(t,n)},r.prototype.requestAsyncId=function(e,t,n){void 0===n&&(n=0),this.delay=e.frame+n;var i=e.actions;return i.push(this),i.sort(r.sortActions),!0},r.prototype.recycleAsyncId=function(e,t,r){void 0===r&&(r=0)},r.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},r}(vn),Ss=750,Cs=function(e){function r(t){e.call(this,Ns,Ss),this.assertDeepEqual=t,this.hotObservables=[],this.coldObservables=[],this.flushTests=[]}return t(r,e),r.prototype.createTime=function(e){var t=e.indexOf("|");if(-1===t)throw new Error('marble diagram for time should have a completion marker "|"');return t*r.frameTimeFactor},r.prototype.createColdObservable=function(e,t,n){if(-1!==e.indexOf("^"))throw new Error('cold observable cannot have subscription offset "^"');if(-1!==e.indexOf("!"))throw new Error('cold observable cannot have unsubscription marker "!"');var i=r.parseMarbles(e,t,n),o=new ws(i,this);return this.coldObservables.push(o),o},r.prototype.createHotObservable=function(e,t,n){if(-1!==e.indexOf("!"))throw new Error('hot observable cannot have unsubscription marker "!"');var i=r.parseMarbles(e,t,n),o=new Es(i,this);return this.hotObservables.push(o),o},r.prototype.materializeInnerObservable=function(e,t){var r=this,n=[];return e.subscribe(function(e){n.push({frame:r.frame-t,notification:Qr.createNext(e)})},function(e){n.push({frame:r.frame-t,notification:Qr.createError(e)})},function(){n.push({frame:r.frame-t,notification:Qr.createComplete()})}),n},r.prototype.expectObservable=function(e,t){var n=this;void 0===t&&(t=null);var i,o=[],a={actual:o,ready:!1},s=r.parseMarblesAsSubscriptions(t).unsubscribedFrame;return this.schedule(function(){i=e.subscribe(function(e){var t=e;e instanceof fr&&(t=n.materializeInnerObservable(t,n.frame)),o.push({frame:n.frame,notification:Qr.createNext(t)})},function(e){o.push({frame:n.frame,notification:Qr.createError(e)})},function(){o.push({frame:n.frame,notification:Qr.createComplete()})})},0),s!==Number.POSITIVE_INFINITY&&this.schedule(function(){return i.unsubscribe()},s),this.flushTests.push(a),{toBe:function(e,t,n){a.ready=!0,a.expected=r.parseMarbles(e,t,n,!0)}}},r.prototype.expectSubscriptions=function(e){var t={actual:e,ready:!1};return this.flushTests.push(t),{toBe:function(e){var n="string"==typeof e?[e]:e;t.ready=!0,t.expected=n.map(function(e){return r.parseMarblesAsSubscriptions(e)})}}},r.prototype.flush=function(){for(var t=this.hotObservables;t.length>0;)t.shift().setup();e.prototype.flush.call(this);for(var r=this.flushTests.filter(function(e){return e.ready});r.length>0;){var n=r.shift();this.assertDeepEqual(n.actual,n.expected)}},r.parseMarblesAsSubscriptions=function(e){if("string"!=typeof e)return new _s(Number.POSITIVE_INFINITY);for(var t=e.length,r=-1,n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,o=0;t>o;o++){var a=o*this.frameTimeFactor,s=e[o];switch(s){case"-":case" ":break;case"(":r=a;break;case")":r=-1;break;case"^":if(n!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");n=r>-1?r:a;break;case"!":if(i!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");i=r>-1?r:a;break;default:throw new Error("there can only be '^' and '!' markers in a subscription marble diagram. Found instead '"+s+"'.")}}return 0>i?new _s(n):new _s(n,i)},r.parseMarbles=function(e,t,r,n){if(void 0===n&&(n=!1),-1!==e.indexOf("!"))throw new Error('conventional marble diagrams cannot have the unsubscription marker "!"');for(var i=e.length,o=[],a=e.indexOf("^"),s=-1===a?0:a*-this.frameTimeFactor,u="object"!=typeof t?function(e){return e}:function(e){return n&&t[e]instanceof ws?t[e].messages:t[e]},l=-1,c=0;i>c;c++){var h=c*this.frameTimeFactor+s,d=void 0,p=e[c];switch(p){case"-":case" ":break;case"(":l=h;break;case")":l=-1;break;case"|":d=Qr.createComplete();break;case"^":break;case"#":d=Qr.createError(r||"error");break;default:d=Qr.createNext(u(p))}d&&o.push({frame:l>-1?l:h,notification:d})}return o},r}(xs),Ts=function(){function e(e){e.requestAnimationFrame?(this.cancelAnimationFrame=e.cancelAnimationFrame.bind(e),this.requestAnimationFrame=e.requestAnimationFrame.bind(e)):e.mozRequestAnimationFrame?(this.cancelAnimationFrame=e.mozCancelAnimationFrame.bind(e),this.requestAnimationFrame=e.mozRequestAnimationFrame.bind(e)):e.webkitRequestAnimationFrame?(this.cancelAnimationFrame=e.webkitCancelAnimationFrame.bind(e),this.requestAnimationFrame=e.webkitRequestAnimationFrame.bind(e)):e.msRequestAnimationFrame?(this.cancelAnimationFrame=e.msCancelAnimationFrame.bind(e),this.requestAnimationFrame=e.msRequestAnimationFrame.bind(e)):e.oRequestAnimationFrame?(this.cancelAnimationFrame=e.oCancelAnimationFrame.bind(e),this.requestAnimationFrame=e.oRequestAnimationFrame.bind(e)):(this.cancelAnimationFrame=e.clearTimeout.bind(e),this.requestAnimationFrame=function(t){return e.setTimeout(t,1e3/60)})}return e}(),Ps=new Ts(rr),ks=function(e){function r(t,r){e.call(this,t,r),this.scheduler=t,this.work=r}return t(r,e),r.prototype.requestAsyncId=function(t,r,n){return void 0===n&&(n=0),null!==n&&n>0?e.prototype.requestAsyncId.call(this,t,r,n):(t.actions.push(this),t.scheduled||(t.scheduled=Ps.requestAnimationFrame(t.flush.bind(t,null))))},r.prototype.recycleAsyncId=function(t,r,n){return void 0===n&&(n=0),null!==n&&n>0||null===n&&this.delay>0?e.prototype.recycleAsyncId.call(this,t,r,n):void(0===t.actions.length&&(Ps.cancelAnimationFrame(r),t.scheduled=void 0))},r}(vn),As=function(e){function r(){e.apply(this,arguments)}return t(r,e),r.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,r=this.actions,n=-1,i=r.length;e=e||r.shift();do if(t=e.execute(e.state,e.delay))break;while(++n<i&&(e=r.shift()));if(this.active=!1,t){for(;++n<i&&(e=r.shift());)e.unsubscribe();throw t}},r}(gn),Os=new As(ks),Is={asap:Ta,queue:ni,animationFrame:Os,async:_n},Rs={rxSubscriber:cr,observable:pr,iterator:kr};e.Scheduler=Is,e.Symbol=Rs,e.Subject=gr,e.AnonymousSubject=_r,e.Observable=fr,e.Subscription=sr,e.Subscriber=hr,e.AsyncSubject=br,e.ReplaySubject=ii,e.BehaviorSubject=Yo,e.ConnectableObservable=Wo,e.Notification=Qr,e.EmptyError=ho,e.ArgumentOutOfRangeError=ro,e.ObjectUnsubscribedError=mr,e.TimeoutError=Ya,e.UnsubscriptionError=ar,e.TimeInterval=Ka,e.Timestamp=rs,e.TestScheduler=Cs,e.VirtualTimeScheduler=xs,e.AjaxResponse=Yn,e.AjaxError=Jn,e.AjaxTimeoutError=Zn,Object.defineProperty(e,"__esModule",{value:!0})}),define("wed/browsers",["require","exports","module"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CHROME=-1!==navigator.userAgent.indexOf(" Chrome/"),t.MSIE_TO_10=-1!==navigator.userAgent.indexOf(" MSIE ");var n=" like Gecko";t.MSIE_11_AND_UP=-1!==navigator.userAgent.indexOf(n,navigator.userAgent.length-n.length),t.MSIE=t.MSIE_11_AND_UP||t.MSIE_TO_10,t.FIREFOX=-1!==navigator.userAgent.indexOf(" Firefox/"),t.FIREFOX_24=-1!==navigator.userAgent.indexOf(" Firefox/24"),t.GECKO=-1!==navigator.userAgent.indexOf(" Gecko/"),t.OSX=0===navigator.platform.lastIndexOf("Mac",0),t.WINDOWS="Win32"===navigator.platform}),define("wed/serializer",["require","exports","module"],function(e,t,r){"use strict";function n(e,t){var r=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return t&&(r=r.replace(/"/g,"&quot;")),r}function i(e,t){if(t.childNodes.length>1)throw new Error("cannot serialize a document with more than one child node");if(null===t.firstChild)throw new Error("cannot serialize an empty document");s(e,t.firstChild)}function o(e,t){e.push("<",t.tagName);for(var r=t.attributes,i=0;i<r.length;++i){var o=r[i];e.push(" ",o.name,'="',n(o.value,!0),'"')}if(0===t.childNodes.length)e.push("/>");else{e.push(">");for(var a=t.firstChild;null!==a;)s(e,a),a=a.nextSibling;e.push("</",t.tagName,">")}}function a(e,t){e.push(n(t.textContent,!1))}function s(e,t){var r=l[t.nodeType];if(void 0===r)throw new Error("can't handle node of type: "+t.nodeType);r(e,t)}function u(e){var t=[];return s(t,e),t.join("")}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.create(null);l[Node.DOCUMENT_NODE]=i,l[Node.DOCUMENT_FRAGMENT_NODE]=i,l[Node.ELEMENT_NODE]=o,l[Node.TEXT_NODE]=a,t.serialize=u}),define("wed/saver",["require","exports","module","bluebird","rxjs","./browsers","./serializer"],function(e,t,r,n,i,o,a){"use strict";function s(e){e=Math.round(e/1e3);var t="moments ago";return e>0&&(t="  ",t+=e>86400?Math.round(e/8640)/10+"d":e>3600?Math.round(e/360)/10+"h":e>60?Math.round(e/6)/10+"m":e+"s",t+=" ago"),t}Object.defineProperty(t,"__esModule",{value:!0});var u;!function(e){e[e.AUTO=1]="AUTO",e[e.MANUAL=2]="MANUAL"}(u=t.SaveKind||(t.SaveKind={}));var l=function(){function e(e,t,r,n){var o=this;this.runtime=e,this.version=t,this.dataUpdater=r,this.dataTree=n,this.initialized=!1,this.currentGeneration=0,this.savedGeneration=0,r.events.subscribe(function(e){"Changed"===e.name&&(o.lastModification=Date.now(),o.savedGeneration===o.currentGeneration&&(o.currentGeneration++,o._events.next({name:"Changed"})))}),this._boundAutosave=this._autosave.bind(this),this._events=new i.Subject,this.events=this._events.asObservable()}return e.prototype.save=function(){return this._save(!1)},e.prototype.getData=function(){var e=this.dataTree.firstChild;return o.MSIE?a.serialize(e):e.outerHTML},e.prototype._saveSuccess=function(e,t){this.savedGeneration=t,this.lastSave=Date.now(),this.lastSaveKind=e?u.AUTO:u.MANUAL,this._events.next(e?{name:"Autosaved"}:{name:"Saved"}),this.setAutosaveInterval(this.autosaveInterval)},e.prototype._fail=function(e){this.failed=!0,void 0!==e&&this._events.next({name:"Failed",error:e})},e.prototype._autosave=function(){var e=this;this.autosaveTimeout=void 0;var t=function(){e.setAutosaveInterval(e.autosaveInterval)};this.currentGeneration!==this.savedGeneration?this._save(!0).then(t):t()},e.prototype.setAutosaveInterval=function(e){this.autosaveInterval=e;var t=this.autosaveTimeout;void 0!==t&&clearTimeout(t),this.autosaveTimeout=0!==e?setTimeout(this._boundAutosave,e):void 0},e.prototype.recover=function(){var e=this;return n.resolve().then(function(){return!e.initialized||e.failed?n.resolve(void 0):e._recover()})},e.prototype.getModifiedWhen=function(){return this.savedGeneration===this.currentGeneration?!1:s(Date.now()-this.lastModification)},e.prototype.getSavedWhen=function(){return void 0!==this.lastSaveKind?s(Date.now()-this.lastSave):void 0},e.prototype.getLastSaveKind=function(){return this.lastSaveKind},e}();t.Saver=l});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/savers/ajax",["require","exports","module","bluebird","jquery","../saver"],function(e,t,r,n,i,o){"use strict";function a(e){var t=e.messages;if(void 0!==t&&0!==t.length){for(var r={},n=0,i=t;n<i.length;n++){var o=i[n],a=o.type;if(void 0!==r[a])throw new Error("same type of message appearing more than once in one transaction");r[a]=o}return r}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t,r,n,i,o){var a=e.call(this,t,r,n,i)||this;return a.headers=o.headers,a.etag='"'+o.initial_etag+'"',a.url=o.url,a.setAutosaveInterval(3e5),a}return __extends(t,e),t.prototype.init=function(){var e=this;return this._post({command:"check",version:this.version},"json").then(function(){e.initialized=!0,e.failed=!1})["catch"](function(){throw new Error(e.url+" is not responding to a check; saving is not possible.")})},t.prototype._save=function(e){var t=this;return n.resolve().then(function(){if(t.initialized){var r=t.currentGeneration,n=!1;return t._post({command:e?"autosave":"save",version:t.version,data:t.getData()},"json")["catch"](function(){n=!0;var e={msg:"Your browser cannot contact the server",type:"save_disconnected"};t._fail(e)}).then(function(i){if(!n){var o=a(i);if(void 0===o)throw t._fail(),new Error("The server accepted the save request but did not return any information regarding whether the save was successful or not.");if(void 0!==o.save_fatal_error)throw t._fail(),new Error("The server was not able to save the data due to a fatal error. Please contact technical support before trying to edit again.");if(void 0!==o.save_transient_error)return void t._events.next({name:"Failed",error:o.save_transient_error});if(void 0!==o.save_edited)return void t._fail(o.save_edited);if(void 0===o.save_successful)throw t._fail(),new Error("Unexpected response from the server while saving. Please contact technical support before trying to edit again.");return void 0!==o.version_too_old_error?void t._fail({type:"too_old",msg:""}):void t._saveSuccess(e,r)}})}})},t.prototype._recover=function(){var e=function(e){var t=a(e);return void 0===t?!1:void 0!==t.save_fatal_error?!1:void 0===t.save_successful?!1:!0};return this._post({command:"recover",version:this.version,data:this.getData()},"json").then(e)["catch"](function(){return!1})},t.prototype._post=function(e,t){var r,n=this;return void 0!==this.etag?(r=i.extend({},this.headers),r["If-Match"]=this.etag):r=this.headers,this.runtime.ajax({type:"POST",url:this.url,data:e,dataType:t,headers:r,bluejaxOptions:{verboseResults:!0}}).then(function(e){var t=e[0],r=e[2],i=a(t);return void 0!==i&&void 0!==i.save_successful&&(n.etag=r.getResponseHeader("ETag")),t})["catch"](function(e){var t=e.jqXHR;if(412===t.status)return{messages:[{msg:"The document was edited by someone else.",type:"save_edited"}]};throw e})},t}(o.Saver);t.Saver=s});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/savers/localforage",["require","exports","module","bluebird","localforage","../saver"],function(e,t,r,n,i,o){"use strict";function a(){return i.createInstance({name:"wed",storeName:"files"})}function s(e,t){var r=Object.create(null);return r.version=1,r.name=e,r.data=t,r.uploaded=new Date,r.saved="never",r.downloaded="never",r}Object.defineProperty(t,"__esModule",{value:!0}),t.config=a,t.makeFileRecord=s;var u=function(e){function t(t,r,i,o,s){var u=e.call(this,t,r,i,o)||this;return u.initPromise=n.resolve(),u.initialized=!0,u.failed=!1,u.name=s.name,u.store=a(),u.setAutosaveInterval(3e5),u}return __extends(t,e),t.prototype.init=function(){return this.initPromise},t.prototype._save=function(e){var t=this;return n.resolve().then(function(){return t.initialized?t._update(t.name,t.getData(),e,t.currentGeneration)["catch"](function(){}):void 0})},t.prototype._update=function(e,t,r,n){var i=this;return this.store.getItem(e).then(function(o){if(1!==o.version)throw new Error("unexpected record version number: "+o.version);return o.data=t,o.saved=new Date,i.store.setItem(e,o).then(function(){i._saveSuccess(r,n)})["catch"](function(){var e={type:void 0,msg:"Failed to save!"};throw i._fail(e),new Error("save failed")})})},t.prototype._recover=function(){return this._save(!1).then(function(){return!0})["catch"](function(){return!1})},t}(o.Saver);t.Saver=u});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/savers/indexeddb",["require","exports","module","bluebird","../saver"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,i,o,a){var s=e.call(this,t,r,i,o)||this;return s.initPromise=n.resolve(),s.initialized=!0,s.failed=!1,s.name=a.name,s.store=a.getStore(),s.setAutosaveInterval(3e5),s}return __extends(t,e),t.prototype.init=function(){return this.initPromise},t.prototype._save=function(e){var t=this;return n.resolve().then(function(){return t.initialized?t._update(t.name,t.getData(),e,t.currentGeneration)["catch"](function(){}):void 0})},t.prototype._update=function(e,t,r,n){var i=this;return this.store.put(e,t).then(function(){i._saveSuccess(r,n)})["catch"](function(){throw i._fail({type:void 0,msg:"Failed to save!"}),new Error("save failed")})},t.prototype._recover=function(){return this._save(!1).then(function(){return!0})["catch"](function(){return!1})},t}(i.Saver);t.Saver=o}),define("wed/tree-updater",["require","exports","module","rxjs","./dloc","./domtypeguards","./domutil"],function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a.indexOf,u=function(){function e(e){this.tree=e;var t=i.findRoot(e);if(void 0===t)throw new Error("the tree must have a DLocRoot");this.dlocRoot=t,this._events=new n.Subject,this.events=this._events.asObservable()}return e.prototype._emit=function(e){this._events.next(e),this._events.next({name:"Changed"})},e.prototype.insertAt=function(e,t,r){var n,a;if(e instanceof i.DLoc){if(n=e.node,a=e.offset,"number"==typeof t)throw new Error("incorrect call on insertAt: offset cannot be a number");r=t}else{if(n=e,"number"!=typeof t)throw new Error("incorrect call on insertAt: offset must be a number");a=t}if(r instanceof Array||r instanceof NodeList)for(var s=0;s<r.length;++s,++a){var u=r[s];if("string"!=typeof u&&!o.isElement(u)&&!o.isText(u))throw new Error("Array or NodeList element of the wrong type");this.insertAt(n,a,u)}else if("string"==typeof r)this.insertText(n,a,r);else if(o.isText(r))switch(n.nodeType){case Node.TEXT_NODE:this.insertText(n,a,r.data);break;case Node.ELEMENT_NODE:this.insertNodeAt(n,a,r);break;default:throw new Error("unexpected node type: "+n.nodeType)}else{if(!o.isElement(r))throw new Error("unexpected value for what: "+r);switch(n.nodeType){case Node.TEXT_NODE:this.insertIntoText(n,a,r);break;case Node.DOCUMENT_NODE:case Node.ELEMENT_NODE:this.insertNodeAt(n,a,r);break;default:throw new Error("unexpected node type: "+n.nodeType)}}},e.prototype.splitAt=function(e,t,r){var n;if(t instanceof i.DLoc?(n=t.node,r=t.offset):n=t,void 0===r)throw new Error("splitAt was called with undefined index");if(n===e&&n.nodeType===Node.TEXT_NODE)throw new Error("splitAt called in a way that would result in two adjacent text nodes");if(!e.contains(n))throw new Error("split location is not inside top");var o=e.cloneNode(!0),u=a.correspondingNode(e,o,n),l=this._splitAt(o,u,r),c=l[0],h=l[1],d=e.parentNode;if(null===d)throw new Error("called with detached top");var p=s(d.childNodes,e);return this.deleteNode(e),null!==c&&this.insertNodeAt(d,p,c),null!==h&&this.insertNodeAt(d,p+1,h),l},e.prototype._splitAt=function(e,t,r){var n,i=t===e,a=t.parentNode;if(o.isText(t))if(0===r)n=[null,t];else if(r===t.length)n=[t,null];else{var u=t.data.slice(r);t.deleteData(r,t.length-r),null!==a&&a.insertBefore(a.ownerDocument.createTextNode(u),t.nextSibling),n=[t,t.nextSibling]}else{if(!o.isElement(t))throw new Error("unexpected node type: "+t.nodeType);0>r?r=0:r>t.childNodes.length&&(r=t.childNodes.length);for(var l=t.cloneNode(!0);null!=t.childNodes[r];)t.removeChild(t.childNodes[r]);for(;0!==r--;)l.removeChild(l.firstChild);null!==a&&a.insertBefore(l,t.nextSibling),n=[t,l]}if(i)return n;if(null===a)throw new Error("unable to reach the top");return this._splitAt(e,a,s(a.childNodes,t)+1)},e.prototype.insertBefore=function(e,t,r){var n=null==r?e.childNodes.length:s(e.childNodes,r);if(-1===n)throw new Error("insertBefore called with a beforeThis value which is not a child of parent");this.insertAt(e,n,t)},e.prototype.insertText=function(e,t,r){var n;if(e instanceof i.DLoc){if("string"!=typeof t)throw new Error("text must be a string");r=t,n=e.node,t=e.offset}else n=e;return a.genericInsertText.call(this,n,t,r)},e.prototype.deleteText=function(e,t,r){var n;if(e instanceof i.DLoc)r=t,n=e.node,t=e.offset;else if(n=e,void 0===r)throw new Error("length cannot be undefined");if(!o.isText(n))throw new Error("deleteText called on non-text");this.setTextNode(n,n.data.slice(0,t)+n.data.slice(t+r))},e.prototype.insertIntoText=function(e,t,r){var n;if(e instanceof i.DLoc){if(!o.isNode(t))throw new Error("must pass a node as the 2nd argument");r=t,t=e.offset,n=e.node}else n=e;var s=a.genericInsertIntoText.call(this,n,t,r);return[i.DLoc.mustMakeDLoc(this.tree,s[0]),i.DLoc.mustMakeDLoc(this.tree,s[1])]},e.prototype.insertNodeAt=function(e,t,r){var n;if(e instanceof i.DLoc){if(!o.isNode(t))throw new Error("the 2nd argument must be a Node");r=t,t=e.offset,n=e.node}else if(n=e,"number"!=typeof t)throw new Error("index must be a number");if(null==r)throw new Error("called insertNodeAt with absent node");if(o.isDocumentFragment(r))throw new Error("document fragments cannot be passed to insertNodeAt");this._emit({name:"BeforeInsertNodeAt",parent:n,index:t,node:r});var a=n.childNodes[t];n.insertBefore(r,null!=a?a:null),this._emit({name:"InsertNodeAt",parent:n,index:t,node:r})},e.prototype.setTextNode=function(e,t){if(!o.isText(e))throw new Error("setTextNode called on non-text");""!==t?this.setTextNodeValue(e,t):this.deleteNode(e)},e.prototype.setTextNodeValue=function(e,t){if(!o.isText(e))throw new Error("setTextNodeValue called on non-text");var r=e.data;e.data=t,this._emit({name:"SetTextNodeValue",node:e,value:t,oldValue:r})},e.prototype.removeNode=function(e){if(null==e)throw new Error("called without a node value");var t=e.previousSibling,r=e.parentNode;if(null===r)throw new Error("called with detached node");var n=s(r.childNodes,e);return this.deleteNode(e),null===t?i.DLoc.mustMakeDLoc(this.tree,r,n):this.mergeTextNodes(t)},e.prototype.removeNodeNF=function(e){return null!=e?this.removeNode(e):void 0},e.prototype.removeNodes=function(e){if(0!==e.length){var t=e[0].previousSibling,r=e[0].parentNode;if(null===r)throw new Error("called with detached node");for(var n=s(r.childNodes,e[0]),o=0;o<e.length;++o){if(o<e.length-1&&e[o].nextSibling!==e[o+1])throw new Error("nodes are not immediately contiguous in document order");this.deleteNode(e[o])}return null===t?i.DLoc.makeDLoc(this.tree,r,n):this.mergeTextNodes(t)}},e.prototype.cut=function(e,t){var r=a.genericCutFunction.call(this,e.toArray(),t.toArray());return r[0]=e.make(r[0]),r},e.prototype.mergeTextNodes=function(e){var t=e.nextSibling;if(o.isText(e)&&null!==t&&o.isText(t)){var r=e.length;return this.setTextNodeValue(e,e.data+t.data),this.deleteNode(t),i.DLoc.mustMakeDLoc(this.tree,e,r)}var n=e.parentNode;if(null===n)throw new Error("called with detached node");return i.DLoc.mustMakeDLoc(this.tree,n,s(n.childNodes,e)+1)},e.prototype.mergeTextNodesNF=function(e){return null!=e?this.mergeTextNodes(e):void 0},e.prototype.deleteNode=function(e){this._emit({name:"BeforeDeleteNode",node:e});var t=e.parentNode;if(null===t)throw new Error("called with detached node");t.removeChild(e),this._emit({name:"DeleteNode",node:e,formerParent:t})},e.prototype.setAttribute=function(e,t,r){this.setAttributeNS(e,"",t,r)},e.prototype.setAttributeNS=function(e,t,r,n){if(void 0===n&&(n=null),!o.isElement(e))throw new Error("setAttribute called on non-element");var i=e.getAttributeNS(t,r);""!==i||e.hasAttributeNS(t,r)||(i=null),null!=n?e.setAttributeNS(t,r,n):e.removeAttributeNS(t,r),this._emit({name:"SetAttributeNS",node:e,ns:t,attribute:r,oldValue:i,newValue:n})},e.prototype.nodeToPath=function(e){return this.dlocRoot.nodeToPath(e)},e.prototype.pathToNode=function(e){return this.dlocRoot.pathToNode(e)},e}();t.TreeUpdater=u}),define("wed/convert",["require","exports","module","./domtypeguards"],function(e,t,r,n){"use strict";function i(e,t){var r=e.parentNode;if(n.isElement(r)){var o=r.getAttribute(t);return null!==o?o:i(r,t)}}function o(e,t){var r;if(n.isElement(t)){r=e.createElement("div"),r.className=t.tagName+" _real";for(var a=0;a<t.attributes.length;++a){var s=t.attributes[a],u="xmlns"===s.name||0===s.name.lastIndexOf("xmlns:",0);if(!u||s.value!==i(t,s.name)){var l="data-wed-"+s.name.replace(/--(-+)/,"---$1").replace(":","---");r.setAttribute(l,s.value)}}for(var c=t.firstChild;null!==c;)r.appendChild(o(e,c)),c=c.nextSibling}else{if(!n.isText(t))throw new Error("unhandled node type: "+t.nodeType);r=document.createTextNode(t.data)}return r}Object.defineProperty(t,"__esModule",{value:!0}),t.toHTMLTree=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){
e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui-updater",["require","exports","module","jquery","./convert","./dloc","./domtypeguards","./domutil","./tree-updater","./util"],function(e,t,r,n,i,o,a,s,u,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t,r){var n=e.call(this,t)||this;return n.treeUpdater=r,n.treeUpdater.events.subscribe(function(e){switch(e.name){case"InsertNodeAt":n._insertNodeAtHandler(e);break;case"SetTextNodeValue":n._setTextNodeValueHandler(e);break;case"BeforeDeleteNode":n._beforeDeleteNodeHandler(e);break;case"SetAttributeNS":n._setAttributeNSHandler(e)}}),n}return __extends(t,e),t.prototype._insertNodeAtHandler=function(e){var t=this.fromDataLocation(e.parent,e.index);if(null===t)throw new Error("cannot find gui tree position");var r=i.toHTMLTree(this.tree.ownerDocument,e.node);a.isElement(e.node)&&s.linkTrees(e.node,r),this.insertNodeAt(t,r)},t.prototype._setTextNodeValueHandler=function(e){var t=this.fromDataLocation(e.node,0);if(null===t)throw new Error("cannot find gui tree position");this.setTextNodeValue(t.node,e.value)},t.prototype._beforeDeleteNodeHandler=function(e){var t,r=e.node,i=!1;switch(r.nodeType){case Node.TEXT_NODE:var o=this.fromDataLocation(r,0);if(null===o)throw new Error("cannot find gui tree position");t=o.node;break;case Node.ELEMENT_NODE:t=n.data(r,"wed_mirror_node"),i=!0}this.deleteNode(t),i&&(s.unlinkTree(r),s.unlinkTree(t))},t.prototype._setAttributeNSHandler=function(e){var t=this.fromDataLocation(e.node,0);if(null===t)throw new Error("cannot find gui tree position");this.setAttributeNS(t.node,"",l.encodeAttrName(e.attribute),e.newValue)},t.prototype.fromDataLocation=function(e,t){var r;if(e instanceof o.DLoc)r=e.node,t=e.offset;else if(r=e,void 0===t)throw new Error("must specify an offset");var n=this.pathToNode(this.treeUpdater.nodeToPath(r));if(null===n)return null;if(a.isText(r))return o.DLoc.mustMakeDLoc(this.tree,n,t);if(s.isAttr(r))return a.isText(n.firstChild)&&(n=n.firstChild),o.DLoc.mustMakeDLoc(this.tree,n,t);if(0===t)return o.DLoc.mustMakeDLoc(this.tree,n,0);if(t>=r.childNodes.length)return o.DLoc.mustMakeDLoc(this.tree,n,n.childNodes.length);var i=this.pathToNode(this.treeUpdater.nodeToPath(r.childNodes[t]));return null===i?o.DLoc.mustMakeDLoc(this.tree,n,n.childNodes.length):o.DLoc.mustMakeDLoc(this.tree,i)},t}(u.TreeUpdater);t.GUIUpdater=c});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/undo-recorder",["require","exports","module","./domutil","./undo"],function(e,t,r,n,i){"use strict";function o(e){return null==e?"undefined":e.outerHTML}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,r,n){var i=e.call(this,"InsertNodeAtUndo")||this;return i.treeUpdater=t,i.index=n,i.parentPath=t.nodeToPath(r),i}return __extends(t,e),t.prototype.undo=function(){if(void 0!==this.node)throw new Error("undo called twice in a row");var e=this.treeUpdater.pathToNode(this.parentPath);this.node=e.childNodes[this.index].cloneNode(!0),this.treeUpdater.deleteNode(e.childNodes[this.index])},t.prototype.redo=function(){if(void 0===this.node)throw new Error("redo called twice in a row");var e=this.treeUpdater.pathToNode(this.parentPath);this.treeUpdater.insertNodeAt(e,this.index,this.node),this.node=void 0},t.prototype.toString=function(){return[this.desc,"\n"," Parent path: ",this.parentPath,"\n"," Index: ",this.index,"\n"," Node: ",o(this.node),"\n"].join("")},t}(i.Undo),s=function(e){function t(t,r,n,i){var o=e.call(this,"SetTextNodeValueUndo")||this;return o.treeUpdater=t,o.value=n,o.oldValue=i,o.nodePath=t.nodeToPath(r),o}return __extends(t,e),t.prototype.undo=function(){var e=this.treeUpdater.pathToNode(this.nodePath);this.treeUpdater.setTextNodeValue(e,this.oldValue)},t.prototype.redo=function(){var e=this.treeUpdater.pathToNode(this.nodePath);this.treeUpdater.setTextNodeValue(e,this.value)},t.prototype.toString=function(){return[this.desc,"\n"," Node path: ",this.nodePath,"\n"," Value: ",this.value,"\n"," Old value: ",this.oldValue,"\n"].join("")},t}(i.Undo),u=function(e){function t(t,r){var i=e.call(this,"DeleteNodeUndo")||this;i.treeUpdater=t;var o=r.parentNode;return i.parentPath=t.nodeToPath(o),i.index=n.indexOf(o.childNodes,r),i.node=r.cloneNode(!0),i}return __extends(t,e),t.prototype.undo=function(){if(void 0===this.node)throw new Error("undo called twice in a row");var e=this.treeUpdater.pathToNode(this.parentPath);this.treeUpdater.insertNodeAt(e,this.index,this.node),this.node=void 0},t.prototype.redo=function(){if(void 0!==this.node)throw new Error("redo called twice in a row");var e=this.treeUpdater.pathToNode(this.parentPath);this.node=e.childNodes[this.index].cloneNode(!0),this.treeUpdater.deleteNode(e.childNodes[this.index])},t.prototype.toString=function(){return[this.desc,"\n"," Parent path: ",this.parentPath,"\n"," Index: ",this.index,"\n"," Node: ",o(this.node),"\n"].join("")},t}(i.Undo),l=function(e){function t(t,r,n,i,o,a){var s=e.call(this,"SetAttributeNSUndo")||this;return s.treeUpdater=t,s.ns=n,s.attribute=i,s.oldValue=o,s.newValue=a,s.nodePath=t.nodeToPath(r),s}return __extends(t,e),t.prototype.undo=function(){var e=this.treeUpdater.pathToNode(this.nodePath);this.treeUpdater.setAttributeNS(e,this.ns,this.attribute,this.oldValue)},t.prototype.redo=function(){var e=this.treeUpdater.pathToNode(this.nodePath);this.treeUpdater.setAttributeNS(e,this.ns,this.attribute,this.newValue)},t.prototype.toString=function(){return[this.desc,"\n"," Node path: ",this.nodePath,"\n"," Namespace: ",this.ns,"\n"," Attribute Name: ",this.attribute,"\n"," New value: ",this.newValue,"\n"," Old value: ",this.oldValue,"\n"].join("")},t}(i.Undo),c=function(){function e(e,t){var r=this;this.editor=e,this.treeUpdater=t,this.suppress=!1,t.events.subscribe(function(e){switch(e.name){case"InsertNodeAt":r.insertNodeAtHandler(e);break;case"SetTextNodeValue":r.setTextNodeValueHandler(e);break;case"BeforeDeleteNode":r.beforeDeleteNodeHandler(e);break;case"SetAttributeNS":r.setAttributeNSHandler(e)}})}return e.prototype.suppressRecording=function(e){if(e===this.suppress)throw new Error("spurious call to suppressRecording");this.suppress=e},e.prototype.insertNodeAtHandler=function(e){this.suppress||this.editor.recordUndo(new a(this.treeUpdater,e.parent,e.index))},e.prototype.setTextNodeValueHandler=function(e){this.suppress||this.editor.recordUndo(new s(this.treeUpdater,e.node,e.value,e.oldValue))},e.prototype.beforeDeleteNodeHandler=function(e){this.suppress||this.editor.recordUndo(new u(this.treeUpdater,e.node))},e.prototype.setAttributeNSHandler=function(e){this.suppress||this.editor.recordUndo(new l(this.treeUpdater,e.node,e.ns,e.attribute,e.oldValue,e.newValue))},e}();t.UndoRecorder=c}),define("wed/domlistener",["require","exports","module","./domtypeguards"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var r=this;this.root=e,this.updater=t,this.eventHandlers={"included-element":[],"added-element":[],"excluded-element":[],"excluding-element":[],"removed-element":[],"removing-element":[],"children-changed":[],"children-changing":[],"text-changed":[],"attribute-changed":[]},this.triggerHandlers=Object.create(null),this.triggersToFire=Object.create(null),this.stopped=!0,this.updater.events.subscribe(function(e){switch(e.name){case"InsertNodeAt":r._insertNodeAtHandler(e);break;case"SetTextNodeValue":r._setTextNodeValueHandler(e);break;case"BeforeDeleteNode":r._beforeDeleteNodeHandler(e);break;case"DeleteNode":r._deleteNodeHandler(e);break;case"SetAttributeNS":r._setAttributeNSHandler(e)}})}return e.prototype.startListening=function(){this.stopped=!1},e.prototype.stopListening=function(){this.stopped=!0},e.prototype.processImmediately=function(){void 0!==this.scheduledProcessTriggers&&(this.clearPending(),this._processTriggers())},e.prototype.clearPending=function(){void 0!==this.scheduledProcessTriggers&&(window.clearTimeout(this.scheduledProcessTriggers),this.scheduledProcessTriggers=void 0)},e.prototype.addHandler=function(e,t,r){if("trigger"===e){var n=this.triggerHandlers[t];void 0===n&&(n=this.triggerHandlers[t]=[]),n.push(r)}else{var i=this.eventHandlers[e];if(void 0===i)throw new Error("invalid eventType: "+e);i.push([t,r])}},e.prototype.trigger=function(e){this.triggersToFire[e]=1},e.prototype._processTriggers=function(){for(var e=Object.keys(this.triggersToFire);e.length>0;){this.triggersToFire=Object.create(null);for(var t=this.triggerHandlers,r=0,n=e;r<n.length;r++){var i=n[r],o=t[i];if(void 0!==o)for(var a=0,s=o;a<s.length;a++){var u=s[a];this._callHandler(u)}}e=Object.keys(this.triggersToFire)}},e.prototype._callHandler=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];t.unshift(this.root),e.apply(void 0,t)},e.prototype._insertNodeAtHandler=function(e){if(!this.stopped){var t=e.parent,r=e.node,i=this._childrenCalls("children-changed",t,[r],[],r.previousSibling,r.nextSibling),o=[],a=[];n.isElement(r)&&(o=this._addRemCalls("added-element",r,t),a=this._incExcCalls("included-element",r,t));for(var s=i.concat(o,a),u=0,l=s;u<l.length;u++){var c=l[u];(h=this._callHandler).call.apply(h,[this,c.fn].concat(c.params))}this._scheduleProcessTriggers();var h}},e.prototype._beforeDeleteNodeHandler=function(e){if(!this.stopped){var t=e.node,r=t.parentNode,i=this._childrenCalls("children-changing",r,[],[t],t.previousSibling,t.nextSibling),o=[],a=[];n.isElement(t)&&(o=this._addRemCalls("removing-element",t,r),a=this._incExcCalls("excluding-element",t,r));for(var s=i.concat(o,a),u=0,l=s;u<l.length;u++){var c=l[u];(h=this._callHandler).call.apply(h,[this,c.fn].concat(c.params))}this._scheduleProcessTriggers();var h}},e.prototype._deleteNodeHandler=function(e){if(!this.stopped){var t=e.node,r=e.formerParent,i=this._childrenCalls("children-changed",r,[],[t],null,null),o=[],a=[];n.isElement(t)&&(o=this._addRemCalls("removed-element",t,r),a=this._incExcCalls("excluded-element",t,r));for(var s=i.concat(o,a),u=0,l=s;u<l.length;u++){var c=l[u];(h=this._callHandler).call.apply(h,[this,c.fn].concat(c.params))}this._scheduleProcessTriggers();var h}},e.prototype._childrenCalls=function(e,t,r,n,i,o){if(0!==r.length&&0!==n.length)throw new Error("we do not support having nodes added and removed in the same event");for(var a=this.eventHandlers[e],s=[],u=0,l=a;u<l.length;u++){var c=l[u],h=c[0],d=c[1];t.matches(h)&&s.push({fn:d,params:[r,n,i,o,t]})}return s},e.prototype._setTextNodeValueHandler=function(e){if(!this.stopped){for(var t=this.eventHandlers["text-changed"],r=e.node,n=r.parentNode,i=0,o=t;i<o.length;i++){var a=o[i],s=a[0],u=a[1];n.matches(s)&&this._callHandler(u,r,e.oldValue)}this._scheduleProcessTriggers()}},e.prototype._setAttributeNSHandler=function(e){if(!this.stopped){for(var t=e.node,r=this.eventHandlers["attribute-changed"],n=0,i=r;n<i.length;n++){var o=i[n],a=o[0],s=o[1];t.matches(a)&&this._callHandler(s,t,e.ns,e.attribute,e.oldValue)}this._scheduleProcessTriggers()}},e.prototype._scheduleProcessTriggers=function(){var e=this;void 0===this.scheduledProcessTriggers&&(this.scheduledProcessTriggers=window.setTimeout(function(){e.scheduledProcessTriggers=void 0,e._processTriggers()},0))},e.prototype._addRemCalls=function(e,t,r){for(var n=this.eventHandlers[e],i=[],o=t.previousSibling,a=t.nextSibling,s=0,u=n;s<u.length;s++){var l=u[s],c=l[0],h=l[1];t.matches(c)&&i.push({fn:h,params:[r,o,a,t]})}return i},e.prototype._incExcCalls=function(e,t,r){for(var n=this.eventHandlers[e],i=t.previousSibling,o=t.nextSibling,a=[],s=0,u=n;s<u.length;s++){var l=u[s],c=l[0],h=l[1];t.matches(c)&&a.push({fn:h,params:[t,r,i,o,t]});for(var d=t.querySelectorAll(c),p=0,f=Array.prototype.slice.call(d);p<f.length;p++){var m=f[p];a.push({fn:h,params:[t,r,i,o,m]})}}return a},e}();t.Listener=i}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("salve",[],t):"object"==typeof exports?exports.salve=t():e.salve=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=31)}([function(e,t,r){function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}function i(e,t){e.prototype.newWalker=function(e){return new t(this,e)}}function o(e){return e.hash()}function a(e){function t(e){return e}e instanceof w.NaiveSet&&(e=e.toArray());var r=new c.HashMap(t);e.forEach(function(e){for(var n=e.params,i=r,o=0;o<n.length;++o)if(o===n.length-1)i.add(n[o],!1);else{var a=i.has(n[o]);void 0===a&&(a=new c.HashMap(t),i.add(n[o],a)),i=a}});var n=function(){var e="",t="    ";return function(r){var i="",o=r.keys();o.sort();for(var a=0,s=o;a<s.length;a++){var u=s[a],l=r.has(u);l!==!1?(i+=""+e+u+":\n",e+=t,i+=n(r.has(u)),e=e.slice(t.length)):i+=""+e+u+"\n"}return i}}();return n(r)}function s(e,t){if(void 0===t&&(t=""),e instanceof c.HashMap)return e;throw new Error("did not get a HashMap "+t)}function u(e,t){if(void 0===t&&(t=""),e instanceof h.NameResolver)return e;throw new Error("did not get a HashMap "+t)}var l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var c=r(8),h=r(3),d=r(30),p=!1;if(p){var f=function(e){console.log(e)},m=function(){f((new Error).stack)};n(m);var v,y,g,_;!function(){var e="",t=" ",r=function(e){var t=e.el;if(null==t)return"";if(void 0===t.name)return" with path "+t.xmlPath;var r=" named "+t.name.toString();return null==e.boundName?r:r+" (bound to "+e.boundName.toString()+")"};_=function(t,n,i){f(""+e+t+n+" on class "+i.constructor.name+(" id "+i.id+r(i)))},v=function(r,n,i){e+=t,_("calling ",n,this);var o=r.apply(this,i);return _("called ",n,this),f(e+"return from the call: "+d.inspect(o)),e=e.slice(t.length),o},y=function(r,n,i){e+=t,_("calling ",n,this),f(e+d.inspect(i[0]));var o=r.apply(this,i);return _("called ",n,this),o!==!1&&f(e+"return from the call: "+d.inspect(o)),e=e.slice(t.length),o},g=function(r,n,i){e+=t,_("calling ",n,this);var o=r.apply(this,i);return _("called ",n,this),f(e+"return from the call: "+d.inspect(o)),e=e.slice(t.length),o}}();var b=function(e,t,r){var n="___"+t;e[n]=e[t],e[t]=function(){return r.call(this,e[n],t,arguments)}};n(b)}t.addWalker=i;var w=r(13),E=r(13);t.EventSet=E.NaiveSet;var x=function(){function e(e){this.id="P"+this.__newID(),this.xmlPath=e}return e.prototype.hash=function(){return this.id},e.prototype._resolve=function(e){},e.prototype._prepare=function(e){},e.prototype._hasAttrs=function(){return!1},e.prototype._gatherElementDefinitions=function(e){},e.prototype.__newID=function(){return e.__id++},e}();x.__id=0,t.BasePattern=x;var N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.newWalker=function(e){throw new Error("derived classes must override this")},t}(x);t.Pattern=N;var S=function(e){function t(t,r){var n=e.call(this,t)||this;return n.pat=r,n}return l(t,e),t.prototype._resolve=function(e){return this.pat._resolve(e)},t.prototype._prepare=function(e){this.pat._prepare(e)},t.prototype._hasAttrs=function(){return this.pat._hasAttrs()},t.prototype._gatherElementDefinitions=function(e){this.pat._gatherElementDefinitions(e)},t}(N);t.OneSubpattern=S;var C=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.patA=r,i.patB=n,i}return l(t,e),t.prototype._resolve=function(e){var t=this.patA._resolve(e),r=this.patB._resolve(e);return void 0!==t&&void 0!==r?t.concat(r):void 0!==t?t:r},t.prototype._prepare=function(e){this.patA._prepare(e),this.patB._prepare(e)},t.prototype._hasAttrs=function(){return this.patA._hasAttrs()||this.patB._hasAttrs()},t.prototype._gatherElementDefinitions=function(e){this.patA._gatherElementDefinitions(e),this.patB._gatherElementDefinitions(e)},t}(N);t.TwoSubpatterns=C;var T=function(){function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=1===t.length&&t[0]instanceof Array?t[0]:t,i=n.join(),o=e.__cache[i];return void 0!==o?o:(this.id="E"+this.__newID(),this.params=n,this.key=i,e.__cache[i]=this,this)}return e.prototype.hash=function(){return this.id},e.prototype.isAttributeEvent=function(){return"attributeName"===this.params[0]||"attributeValue"===this.params[0]},e.prototype.toString=function(){return"Event: "+this.params.join(", ")},e.prototype.__newID=function(){return e.__id++},e}();T.__cache=Object.create(null),T.__id=0,t.Event=T,t.eventsToTreeString=a,t.emptyEvent=new T("<empty>");var P=function(){function e(t){this.id="W"+this.__newID(),this.suppressedAttributes=!1,t instanceof e?(this.el=t.el,this.possibleCached=t.possibleCached,this.suppressedAttributes=t.suppressedAttributes):this.el=t,p&&(b(this,"_possible",v),b(this,"fireEvent",y),b(this,"end",g),b(this,"_suppressAttributes",g),b(this,"_clone",g))}return e.prototype.hash=function(){return this.id},e.prototype.possible=function(){return new w.NaiveSet(this._possible())},e.prototype.canEnd=function(e){return void 0===e&&(e=!1),!0},e.prototype.end=function(e){return void 0===e&&(e=!1),!1},e.prototype.clone=function(){return this._clone(new c.HashMap(o))},e.prototype._clone=function(e){return new this.constructor(this,e)},e.prototype._suppressAttributes=function(){this.suppressedAttributes=!0},e.prototype._cloneIfNeeded=function(e,t){var r=t.has(e);return void 0!==r?r:(r=e.clone(),t.add(e,r),r)},e.prototype.__newID=function(){return e.__id++},e}();P.__id=0,t.Walker=P,t.isHashMap=s,t.isNameResolver=u;var k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype._possible=function(){return this.subwalker.possible()},t.prototype.fireEvent=function(e){return this.subwalker.fireEvent(e)},t.prototype._suppressAttributes=function(){this.suppressedAttributes||(this.suppressedAttributes=!0,this.subwalker._suppressAttributes())},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this.subwalker.canEnd(e)},t.prototype.end=function(e){return void 0===e&&(e=!1),this.subwalker.end(e)},t}(P);t.SingleSubwalker=k;var A=function(e){function t(t,r){var n=e.call(this,t)||this;return n.name=r,n}return l(t,e),t.prototype._prepare=function(){},t.prototype._resolve=function(e){return this.resolvesTo=e[this.name],void 0===this.resolvesTo?[this]:void 0},t.prototype.newWalker=function(e){return this.resolvesTo.pat.newWalker(e)},t}(N);t.Ref=A;var O=function(e){function t(t,r,n){var i=e.call(this,t,n)||this;return i.name=r,i}return l(t,e),t}(S);t.Define=O;var I=function(e){function t(r,n){var i=this;if(r instanceof t){var o=r,a=s(n);i=e.call(this,o,a)||this,i.nameResolver=i._cloneIfNeeded(o.nameResolver,a),i.subwalker=o.subwalker._clone(a)}else{var l=r,c=u(n);i=e.call(this,l)||this,i.nameResolver=c,i.subwalker=l.pat.newWalker(i.nameResolver)}return i}return l(t,e),t}(k);i(O,I)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.msg=e}return e.prototype.toString=function(){return this.msg},e.prototype.getNames=function(){return[]},e.prototype.toStringWithNames=function(e){return this.msg},e}();t.ValidationError=i;var o=function(e){function t(t,r){var n=e.call(this,t)||this;return n.name=r,n}return n(t,e),t.prototype.toString=function(){return this.toStringWithNames([this.name])},t.prototype.getNames=function(){return[this.name]},t.prototype.toStringWithNames=function(e){return this.msg+": "+e[0]},t}(i);t.SingleNameError=o;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o);t.AttributeNameError=a;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o);t.AttributeValueError=s;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o);t.ElementNameError=u;var l=function(e){function t(t,r){var n=e.call(this,"")||this;return n.namesA=t,n.namesB=r,n}return n(t,e),t.prototype.toString=function(){return this.toStringWithNames(this.namesA.concat(this.namesB))},t.prototype.getNames=function(){return this.namesA.concat(this.namesB)},t.prototype.toStringWithNames=function(e){var t=e.slice(0,this.namesA.length),r=e.slice(this.namesA.length);return"must choose either "+t.join(", ")+" or "+r.join(", ")},t}(i);t.ChoiceError=l},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.path=e}return e.prototype.getNamespaces=function(){var e=Object.create(null);return this._recordNamespaces(e),Object.keys(e)},e.prototype.toJSON=function(){return this.toObject()},e.prototype.toString=function(){return JSON.stringify(this)},e}();t.Base=i;var o=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.ns=r,i.name=n,i}return n(t,e),t.prototype.match=function(e,t){return this.ns===e&&this.name===t},t.prototype.wildcardMatch=function(e,t){return!1},t.prototype.toObject=function(){return{ns:this.ns,name:this.name}},t.prototype.simple=function(){return!0},t.prototype.toArray=function(){return[this]},t.prototype._recordNamespaces=function(e){e[this.ns]=1},t}(i);t.Name=o;var a=function(e){function t(t,r){var n=e.call(this,t)||this;return n.a=r[0],n.b=r[1],n}return n(t,e),t.prototype.match=function(e,t){return this.a.match(e,t)||this.b.match(e,t)},t.prototype.wildcardMatch=function(e,t){return this.a.wildcardMatch(e,t)||this.b.wildcardMatch(e,t)},t.prototype.toObject=function(){return{a:this.a.toObject(),b:this.b.toObject()}},t.prototype.simple=function(){return this.a.simple()&&this.b.simple()},t.prototype.toArray=function(){var e=this.a.toArray();if(null===e)return null;var t=this.b.toArray();return null===t?null:e.concat(t)},t.prototype._recordNamespaces=function(e){this.a._recordNamespaces(e),this.b._recordNamespaces(e)},t}(i);t.NameChoice=a;var s=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.ns=r,i.except=n,i}return n(t,e),t.prototype.match=function(e,t){return this.ns===e&&!(void 0!==this.except&&this.except.match(e,t))},t.prototype.wildcardMatch=function(e,t){return this.match(e,t)},t.prototype.toObject=function(){var e={ns:this.ns};return void 0!==this.except&&(e.except=this.except.toObject()),e},t.prototype.simple=function(){return!1},t.prototype.toArray=function(){return null},t.prototype._recordNamespaces=function(e){e[this.ns]=1,void 0!==this.except&&(e["::except"]=1)},t}(i);t.NsName=s;var u=function(e){function t(t,r){var n=e.call(this,t)||this;return n.except=r,n}return n(t,e),t.prototype.match=function(e,t){return void 0===this.except||!this.except.match(e,t)},t.prototype.wildcardMatch=function(e,t){return this.match(e,t)},t.prototype.toObject=function(){var e={pattern:"AnyName"};return void 0!==this.except&&(e.except=this.except.toObject()),e},t.prototype.simple=function(){return!1},t.prototype.toArray=function(){return null},t.prototype._recordNamespaces=function(e){e["*"]=1,void 0!==this.except&&(e["::except"]=1)},t}(i);t.AnyName=u},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(4);t.XML1_NAMESPACE="http://www.w3.org/XML/1998/namespace",t.XMLNS_NAMESPACE="http://www.w3.org/2000/xmlns/";var i=function(){function e(){this.forward=Object.create(null),this.backwards=Object.create(null)}return e}(),o=function(){function e(e){this.id="N"+this.__newID(),void 0!==e?this._contextStack=e._contextStack.slice():(this._contextStack=[],this.enterContext(),this._contextStack[0].forward.xml=t.XML1_NAMESPACE,this._contextStack[0].backwards[t.XML1_NAMESPACE]=["xml"],this._contextStack[0].forward.xmlns=t.XMLNS_NAMESPACE,this._contextStack[0].backwards[t.XMLNS_NAMESPACE]=["xmlns"])}return e.prototype.hash=function(){return this.id},e.prototype.clone=function(){return new e(this)},e.prototype.definePrefix=function(e,r){if("xmlns"===e)throw new Error("trying to define 'xmlns' but the XML Namespaces standard stipulates that 'xmlns' cannot be declared (= \"defined\")");if("xml"===e&&r!==t.XML1_NAMESPACE)throw new Error("trying to define 'xml' to an incorrect URI");this._contextStack[0].forward[e]=r;var n=this._contextStack[0].backwards[r];void 0===n&&(n=this._contextStack[0].backwards[r]=[]),""===e?n.unshift(""):n.push(e)},e.prototype.enterContext=function(){this._contextStack.unshift(new i)},e.prototype.leaveContext=function(){if(!(this._contextStack.length>1))throw new Error("trying to leave the default context");this._contextStack.shift()},e.prototype.resolveName=function(e,t){void 0===t&&(t=!1);var r=e.split(":");if(1===r.length){if(t)return new n.EName("",e);r=["",e]}if(r.length>2)throw new Error("invalid name passed to resolveName");for(var i,o=0;void 0===i&&o<this._contextStack.length;++o){var a=this._contextStack[o];i=a.forward[r[0]]}return void 0===i?""===r[0]?new n.EName("",r[1]):void 0:new n.EName(i,r[1])},e.prototype.unresolveName=function(e,t){if(""===e)return t;for(var r,n=0;void 0===r&&n<this._contextStack.length;++n){var i=this._contextStack[n];r=i.backwards[e]}if(void 0!==r){var o=r[0];return""!==o?o+":"+t:t}},e.prototype.prefixFromURI=function(e){for(var t,r=0;void 0===t&&r<this._contextStack.length;++r){var n=this._contextStack[r];t=n.backwards[e]}return void 0!==t?t[0]:void 0},e.prototype.__newID=function(){return e.__id++},e}();o.__id=0,t.NameResolver=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.ns=e,this.name=t}return e.prototype.toString=function(){return"{"+this.ns+"}"+this.name},e.prototype.equal=function(e){return this.ns===e.ns&&this.name===e.name},e}();t.EName=n},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(7),o=function(){function e(e){this.message=e}return e.prototype.toString=function(){return this.message},e}();t.ParamError=o;var a=function(){function e(e){this.message=e}return e.prototype.toString=function(){return this.message},e}();t.ValueError=a;var s=function(e){function t(r,n){var o=e.call(this)||this;o.errors=n;var a=r+": "+n.map(function(e){return e.toString()}).join("\n"),s=new Error(a);return o.name="ParameterParsingError",o.stack=s.stack,o.message=s.message,i.fixPrototype(o,t),o}return n(t,e),t}(Error);t.ParameterParsingError=s;var u=function(e){function t(r){var n=e.call(this)||this;n.errors=r;var o=r.map(function(e){return e.toString()}).join("\n"),a=new Error(o);return n.name="ValueValidationError",n.stack=a.stack,n.message=a.message,i.fixPrototype(n,t),n}return n(t,e),t}(Error);t.ValueValidationError=u},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i.Pattern);t.NotAllowed=o;var a=function(e){function t(r,n){var o=this;if(r instanceof t){var a=r;n=i.isHashMap(n),o=e.call(this,a,n)||this}else{var s=r;o=e.call(this,s)||this,o.possibleCached=new i.EventSet}return o}return n(t,e),t.prototype.possible=function(){return new i.EventSet},t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){},t}(i.Walker);t.NotAllowedWalker=a,i.addWalker(o,a)},function(e,t,r){function n(e,t){for(var r in t)e[r]=t[r]}function i(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var i=0,o=t;i<o.length;i++){var a=o[i];n(e,a)}return e}function o(e,t){var r=void 0!==Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__;r!==t&&(void 0!==Object.setPrototypeOf?Object.setPrototypeOf(e,t.prototype):e.__proto__=t.prototype)}Object.defineProperty(t,"__esModule",{value:!0}),t.extend=i,t.fixPrototype=o},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t,r){if(this.hashF=t,this.backing=Object.create(null),this._size=0,void 0!==r)if(r instanceof e){for(var n=this.backing,i=r.backing,o=Object.keys(i),a=0,s=o;a<s.length;a++){var u=s[a];n[u]=i[u]}this._size=o.length}else if(r instanceof Array)for(var l=0,c=r;l<c.length;l++){var h=c[l];this.add(h)}else this.add(r)}return e.prototype.union=function(e){if(null!=e){if(!(e instanceof this.constructor))throw new Error("union invalid class object; my class "+this.constructor.name+" other class "+e.constructor.name);for(var t=e.backing,r=Object.keys(t),n=0,i=r;n<i.length;n++){var o=i[n];this._store(o,t[o])}}},e.prototype.forEach=function(e){for(var t=this.backing,r=Object.keys(t),n=0,i=r;n<i.length;n++){var o=i[n];e(t[o])}},e.prototype.size=function(){return this._size},e.prototype.filter=function(e){var t=new this.constructor;void 0===t.hashF&&(t.hashF=this.hashF);for(var r=this.backing,n=Object.keys(r),i=0,o=n;i<o.length;i++){var a=o[i],s=r[a],u=s instanceof Array?s:[s];e.apply(void 0,u)&&t._store(a,s)}return t},e.prototype.has=function(e){var t=this.hashF(e);return void 0!==this.backing[t]},e.prototype.toString=function(){return this.toArray().join(", ")},e.prototype.toArray=function(){for(var e=[],t=this.backing,r=Object.keys(t),n=0,i=r;n<i.length;n++){var o=i[n];e.push(t[o])}return e},e.prototype._store=function(e,t){if(null==e)throw new Error("undefined or null hash");void 0===this.backing[e]&&(this.backing[e]=t,this._size++)},e}();t.HashBase=i;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.add=function(e){this._store(this.hashF(e),e)},t}(i);t.HashSet=o;var a=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.hashF=t,n}return n(t,e),t.prototype.add=function(e,t){this._store(this.hashF(e),[e,t])},t.prototype.forEach=function(e){
for(var t=this.backing,r=Object.keys(t),n=0,i=r;n<i.length;n++){var o=i[n];e(t[o][0],t[o][1])}},t.prototype.has=function(e){var t=this.hashF(e),r=this.backing[t];return void 0!==r?r[1]:void 0},t.prototype.keys=function(){return Object.keys(this.backing)},t}(i);t.HashMap=a},function(e,t,r){function n(){return x}Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),o=r(18),a=r(0),s=r(19),u=r(20),l=r(21),c=r(22),h=r(12),d=r(23),p=r(24),f=r(25),m=r(6),v=r(26),y=r(27),g=r(28),_=r(29),b=r(2),w=r(0);t.eventsToTreeString=w.eventsToTreeString,t.Event=w.Event,t.EventSet=w.EventSet,t.BasePattern=w.BasePattern,t.Walker=w.Walker;var E=r(12);t.Grammar=E.Grammar,t.GrammarWalker=E.GrammarWalker,t.RefError=E.RefError;var x={GrammarWalker:h.GrammarWalker,Text:g.Text};t.__test=n,t.__protected={Empty:c.Empty,Data:u.Data,List:f.List,Param:y.Param,Value:_.Value,NotAllowed:m.NotAllowed,Text:g.Text,Ref:a.Ref,OneOrMore:v.OneOrMore,Choice:s.Choice,Group:d.Group,Attribute:o.Attribute,Element:l.Element,Define:a.Define,Grammar:h.Grammar,EName:i.EName,Interleave:p.Interleave,Name:b.Name,NameChoice:b.NameChoice,NsName:b.NsName,AnyName:b.AnyName}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(15),i=r(17),o=function(){function e(){this.libraries=Object.create(null)}return e.prototype.add=function(e){var t=e.uri;if(t in this.libraries)throw new Error("URI clash: "+t);this.libraries[t]=e},e.prototype.find=function(e){return this.libraries[e]},e.prototype.get=function(e){var t=this.find(e);if(void 0===t)throw new Error("can't get library with URI: "+e);return t},e}();t.Registry=o,t.registry=new o,t.registry.add(n.builtin),t.registry.add(i.xmlschema);var a=r(5);t.ParameterParsingError=a.ParameterParsingError,t.ValueValidationError=a.ValueValidationError,t.ValueError=a.ValueError},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n="A-Z_a-z----------------------------------------------------------------------------------------------------------------------------------------------------",i="--";t.xmlLetter=n+i;var o="0-9--------------",a="------------------------------------------------------------------",s="---";t.xmlNameChar="-"+t.xmlLetter+o+"._:"+a+s;var u="["+t.xmlLetter+"_:](?:["+t.xmlNameChar+"])*";t.xmlNameRe=new RegExp("^"+u+"$"),t.xmlNcname="["+t.xmlLetter+"_](?:[-"+t.xmlLetter+o+"._"+a+(s+"])*"),t.xmlNcnameRe=new RegExp("^"+t.xmlNcname+"$")},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(2),a=r(3),s=r(7),u=r(0),l=function(e){function t(r){var n=e.call(this)||this;return n.references=r,s.fixPrototype(n,t),n}return n(t,e),t.prototype.toString=function(){return"Cannot resolve the following references: "+this.references.join(", ")},t}(Error);t.RefError=l;var c=function(e){function t(t,r,n){var i=e.call(this,t)||this;i.xmlPath=t,i.start=r,i.definitions=Object.create(null),i._namespaces=Object.create(null),void 0!==n&&n.forEach(function(e){i.add(e)});var o=i._resolve(i.definitions);if(void 0!==o)throw new l(o);return i._prepare(i._namespaces),i}return n(t,e),t.prototype.add=function(e){this.definitions[e.name]=e,"start"===e.name&&(this.start=e)},t.prototype._gatherElementDefinitions=function(e){for(var t in this.definitions)this.definitions[t]._gatherElementDefinitions(e)},Object.defineProperty(t.prototype,"elementDefinitions",{get:function(){var e=this._elementDefinitions;if(void 0!==e)return e;var t=this._elementDefinitions=Object.create(null);return this._gatherElementDefinitions(t),t},enumerable:!0,configurable:!0}),t.prototype.whollyContextIndependent=function(){var e=this.elementDefinitions;for(var t in e)if(e[t].length>1)return!1;return!0},t.prototype.getNamespaces=function(){return Object.keys(this._namespaces)},t.prototype._prepare=function(e){this.start._prepare(e);for(var t in this.definitions)this.definitions[t]._prepare(e)},t.prototype._resolve=function(e){var t,r=[];for(var n in e)t=e[n]._resolve(e),void 0!==t&&(r=r.concat(t));return t=this.start._resolve(e),void 0!==t&&(r=r.concat(t)),0!==r.length?r:void 0},t.prototype.newWalker=function(){return h.makeWalker(this)},t}(u.BasePattern);t.Grammar=c;var h=function(e){function t(r,n){var i=this;if(r instanceof t){var o=r;n=u.isHashMap(n),i=e.call(this,o,n)||this,i.nameResolver=i._cloneIfNeeded(o.nameResolver,n),i.subwalker=o.subwalker._clone(n);for(var s=i._misplacedElements=[],l=0,c=o._misplacedElements;l<c.length;l++){var h=c[l];s.push(h instanceof u.Walker?h._clone(n):h.concat([]))}i._swallowAttributeValue=o._swallowAttributeValue,i.suspendedWs=o.suspendedWs,i.ignoreNextWs=o.ignoreNextWs,i._prevEvWasText=o._prevEvWasText}else{var d=r;i=e.call(this,d)||this,i.nameResolver=new a.NameResolver,i._misplacedElements=[],i._swallowAttributeValue=!1,i.ignoreNextWs=!1,i._prevEvWasText=!1,i.subwalker=d.start.newWalker(i.nameResolver)}return i}return n(t,e),t.makeWalker=function(e){return new t(e)},t.prototype.resolveName=function(e,t){return this.nameResolver.resolveName(e,t)},t.prototype.unresolveName=function(e,t){return this.nameResolver.unresolveName(e,t)},t.prototype.fireEvent=function(e){function t(e){if(void 0===r&&(r=[new i.ValidationError("text not allowed here")]),r===!1)return e;if(e===!1)return r;if(void 0===e)throw new Error("undefined x");return r.concat(e)}var r=!1;if("enterContext"===e.params[0]||"leaveContext"===e.params[0]||"definePrefix"===e.params[0]){switch(e.params[0]){case"enterContext":this.nameResolver.enterContext();break;case"leaveContext":this.nameResolver.leaveContext();break;case"definePrefix":this.nameResolver.definePrefix(e.params[1],e.params[2]);break;default:throw new Error("unexpected event: "+e.params[0])}return!1}if("text"===e.params[0]&&""===e.params[1].trim())return void 0!==this.suspendedWs?this.suspendedWs+=e.params[1]:this.suspendedWs=e.params[1],!1;var n=this._misplacedElements.length>0&&this._misplacedElements[0]instanceof u.Walker?this._misplacedElements[0]:this.subwalker,a=this.ignoreNextWs;switch(this.ignoreNextWs=!1,e.params[0]){case"enterStartTag":this.suspendedWs=void 0;break;case"text":if(this._prevEvWasText)throw new Error("fired two text events in a row: this is disallowed by salve");if(a){this.suspendedWs=void 0;var s=e.params[1].replace(/^\s+/,"");s.length!==e.params[1].length&&(e=new u.Event("text",s))}else void 0!==this.suspendedWs&&""!==this.suspendedWs&&(r=n.fireEvent(new u.Event("text",this.suspendedWs)),this.suspendedWs=void 0);break;case"endTag":this.ignoreNextWs=!0;default:void 0===this.suspendedWs||""===this.suspendedWs||a||(r=n.fireEvent(new u.Event("text",this.suspendedWs))),this.suspendedWs=void 0}if(this._prevEvWasText="text"===e.params[0],this._misplacedElements.length>0&&this._misplacedElements[0]instanceof Array){var l=this._misplacedElements[0];switch(e.params[0]){case"enterStartTag":l.unshift(e.params.slice(1));break;case"endTag":l.shift()}return 0===l.length&&this._misplacedElements.shift(),!1}if(this._swallowAttributeValue)return this._swallowAttributeValue=!1,"attributeValue"===e.params[0]?!1:[new i.ValidationError("attribute value required")];var c=n.fireEvent(e);if(void 0===c)switch(e.params[0]){case"enterStartTag":var h=new o.Name("",e.params[1],e.params[2]);c=[new i.ElementNameError("tag not allowed here",h)];var d=this.el.elementDefinitions[h.toString()];if(void 0!==d&&1===d.length){var p=d[0].newWalker(this.nameResolver);if(this._misplacedElements.unshift(p),p.fireEvent(e)!==!1)throw new Error("internal error: the infered element does not accept its initial event")}else this._misplacedElements.unshift([e.params.slice(1)]);break;case"endTag":c=[new i.ElementNameError("unexpected end tag",new o.Name("",e.params[1],e.params[2]))];break;case"attributeName":c=[new i.AttributeNameError("attribute not allowed here",new o.Name("",e.params[1],e.params[2]))],this._swallowAttributeValue=!0;break;case"attributeValue":c=[new i.ValidationError("unexpected attributeValue event; it is likely that fireEvent is incorrectly called")];break;case"text":c=[new i.ValidationError("text not allowed here")];break;case"leaveStartTag":default:throw new Error("unexpected event type in GrammarWalker's fireEvent: "+e.params[0].toString())}if(this._misplacedElements.length>0&&this._misplacedElements[0]instanceof u.Walker&&(n=this._misplacedElements[0],n.canEnd())){this._misplacedElements.shift();var f=n.end();f&&(c=c?c.concat(f):f)}return t(c)},t.prototype.possible=function(){if(0!==this._misplacedElements.length){var e=this._misplacedElements[0];return e instanceof u.Walker?e.possible():new u.EventSet}return this.subwalker.possible()},t.prototype._suppressAttributes=function(){throw new Error("_suppressAttributes cannot be called on a GrammarWalker")},t}(u.SingleSubwalker);t.GrammarWalker=h},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(t){if(null!=t)if(t instanceof e)this.b=t.b.concat([]);else if(t instanceof Array){this.b=[];for(var r=0,n=t;r<n.length;r++){var i=n[r];this.add(i)}}else this.b=[t];else this.b=[]}return e.prototype.add=function(e){var t=this.b.indexOf(e);0>t&&this.b.push(e)},e.prototype.union=function(t){if(null!=t){if(!(t instanceof e))throw new Error("union with non-NaiveSet");for(var r=t.b.length,n=0;r>n;++n)this.add(t.b[n])}},e.prototype.filter=function(e){var t=this,r=new this.constructor;return r.b=this.b.filter(function(r,n){return e(r,n,t)}),r},e.prototype.map=function(e){for(var t=new this.constructor,r=0;r<this.b.length;++r){var n=this.b[r],i=e(n,r,this);void 0!==i&&t.add(i)}return t},e.prototype.forEach=function(e){var t=this;this.b.forEach(function(r,n){e(r,n,t)})},e.prototype.toString=function(){return this.b.join(", ")},e.prototype.size=function(){return this.b.length},e.prototype.has=function(e){return this.b.indexOf(e)>=0},e.prototype.toArray=function(){return this.b.slice()},e}();t.NaiveSet=n},function(e,t,r){function n(e){var t="string"==typeof e?JSON.parse(e):e;if("object"==typeof t&&void 0===t.v)throw new h;var r=t.v,n=t.o,i=t.d;if(3===r)return new p(n).walkObject(i);throw new Error("unknown version: "+r)}var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(9),a=r(7),s=o.__protected,u=[Array,s.Empty,s.Data,s.List,s.Param,s.Value,s.NotAllowed,s.Text,s.Ref,s.OneOrMore,s.Choice,s.Group,s.Attribute,s.Element,s.Define,s.Grammar,s.EName,s.Interleave,s.Name,s.NameChoice,s.NsName,s.AnyName],l={0:Array,Empty:s.Empty,1:s.Empty,Data:s.Data,2:s.Data,List:s.List,3:s.List,Param:s.Param,4:s.Param,Value:s.Value,5:s.Value,NotAllowed:s.NotAllowed,6:s.NotAllowed,Text:s.Text,7:s.Text,Ref:s.Ref,8:s.Ref,OneOrMore:s.OneOrMore,9:s.OneOrMore,Choice:s.Choice,10:s.Choice,Group:s.Group,11:s.Group,Attribute:s.Attribute,12:s.Attribute,Element:s.Element,13:s.Element,Define:s.Define,14:s.Define,Grammar:s.Grammar,15:s.Grammar,EName:s.EName,16:s.EName,Interleave:s.Interleave,17:s.Interleave,Name:s.Name,18:s.Name,NameChoice:s.NameChoice,19:s.NameChoice,NsName:s.NsName,20:s.NsName,AnyName:s.AnyName,21:s.AnyName},c=1,h=function(e){function t(){var r=e.call(this,"your schema file must be recreated with a newer version of salve-convert")||this;return a.fixPrototype(r,t),r}return i(t,e),t}(Error),d=function(){function e(e){this.options=e}return e.prototype.walkObject=function(e){var t=e[0],r=u[t];if(void 0===r){if(e.length<1)throw new Error("array too small to contain object");throw new Error("undefined type: "+t)}if(r===Array)throw new Error("trying to build array with _constructObjectV2");var n,i=0!==(this.options&c)&&r!==s.EName;return e.length>1?(n=e.slice(1),i?n.unshift(0,""):n.unshift(0),this._transformArray(n)):n=i?[""]:[],this._processObject(r,n)},e.prototype._processObject=function(e,t){},e.prototype._transformArray=function(e){if(0!==e[0])throw new Error("array type not 0, but "+e[0]+" for array "+e);e.splice(0,1);for(var t=e.length,r=0;t>r;r++){var n=e[r];n instanceof Array&&(0!==n[0]?e[r]=this.walkObject(n):this._transformArray(n))}},e}();t.V2JSONWalker=d;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype._processObject=function(e,t){if(e===s.Data&&t.length>=4){var r=t[3];if(r.length%2!==0)throw new Error("parameter array length not a multiple of 2");for(var n=new Array(r.length/2),i=r.length,o=0;i>o;o+=2)n[o/2]={name:r[o],value:r[o+1]};t[3]=n}else if(e===s.OneOrMore){if(1!==t[1].length)throw new Error("OneOrMore with an array of patterns that contains other than 1 pattern");t=[t[0],t[1][0]]}else if(e===s.Attribute||e===s.Element||e===s.Define){if(1!==t[2].length)throw new Error("PatternOnePattern with an array of patterns that contains other than 1 pattern");t=[t[0],t[1],t[2][0]]}else if(e===s.Choice||e===s.Group||e===s.Interleave){if(2!==t[1].length)throw new Error("PatternTwoPatterns with an array of patterns that contains other than 2 pattern");t=[t[0],t[1][0],t[1][1]]}var a=Object.create(e.prototype),u=e.apply(a,t);return void 0!==u?u:a},t}(d);t.constructTree=n,t.__protected={V2JSONWalker:d,nameToConstructor:l,OPTION_NO_PATHS:c}},function(e,t,r){function n(e){return e.trim().replace(/\s{2,}/g," ")}var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(5),a=function(){function e(){}return e.prototype.parseParams=function(e,t){if(void 0!==t&&t.length>0)throw new o.ParameterParsingError(e,[new o.ParamError("this type does not accept parameters")])},e.prototype.parseValue=function(e){var t=this.disallows(e);if(t instanceof Array&&0!==t.length)throw new o.ValueValidationError(t);return{value:e}},e}(),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.regexp=/.*/,t.needsContext=!1,t}return i(t,e),t.prototype.equal=function(e,t){if(void 0===t.value)throw Error("it looks like you are trying to use an unparsed value");return e===t.value},t.prototype.disallows=function(e){return!1},t}(a),u=new s,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="token",t.needsContext=!1,t.regexp=/.*/,t}return i(t,e),t.prototype.equal=function(e,t){if(void 0===t.value)throw Error("it looks like you are trying to use an unparsed value");return n(e)===n(t.value)},t.prototype.disallows=function(e){return!1},t}(a),c=new l;t.builtin={uri:"",types:{string:u,token:c}}},function(e,t,r){(function(e,n){var i=function(){function e(e){var t=new Error(e);this.name="SalveParsingError",this.stack=t.stack,this.message=t.message}function n(t,r){throw new e(t)}function i(e){A.unshift({negative:e,capturedMultiChar:[]})}function o(){this.yy={}}var a=function(e,t,r,n){for(r=r||{},n=e.length;n--;r[e[n]]=t);return r},s=[1,8],u=[1,10],l=[1,13],c=[1,19],h=[1,20],d=[1,14],p=[1,15],f=[1,16],m=[1,17],v=[5,23],y=[5,8,20,22,23,26,30,31,42,43,44,45],g=[5,8,12,13,14,15,20,22,23,26,30,31,42,43,44,45],_=[5,8,12,13,14,15,20,22,23,26,29,30,31,36,38,40,41,42,43,44,45],b=[1,37],w=[1,39],E=[1,40],x=[38,40,41,42,43,44,45],N=[29,36,38,40,41,42,43,44,45],S={trace:function(){},yy:{},symbols_:{error:2,start:3,input:4,EOF:5,regexp:6,branch:7,"|":8,piece:9,atom:10,quantifier:11,"?":12,"*":13,"+":14,"{":15,quantity:16,"}":17,NUMBER:18,",":19,CHAR:20,charClass:21,"(":22,")":23,charClassEsc:24,charClassExpr:25,WILDCARDESC:26,charClassExprStart:27,charGroup:28,"]":29,"[":30,"[^":31,posCharGroups:32,charClassSub:33,posCharGroup:34,charRange:35,CLASSSUBTRACTION:36,seRange:37,"-":38,charOrEsc:39,XMLCHAR:40,SingleCharEsc:41,SINGLECHARESC:42,MULTICHARESC:43,CATESC:44,COMPLESC:45,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",8:"|",12:"?",13:"*",14:"+",15:"{",17:"}",18:"NUMBER",19:",",20:"CHAR",22:"(",23:")",26:"WILDCARDESC",29:"]",30:"[",31:"[^",36:"CLASSSUBTRACTION",38:"-",40:"XMLCHAR",41:"SingleCharEsc",42:"SINGLECHARESC",43:"MULTICHARESC",44:"CATESC",45:"COMPLESC"},productions_:[0,[3,1],[4,1],[4,2],[6,1],[6,3],[7,1],[7,2],[9,1],[9,2],[11,1],[11,1],[11,1],[11,3],[16,1],[16,3],[16,2],[10,1],[10,1],[10,3],[21,1],[21,1],[21,1],[25,3],[27,1],[27,1],[28,1],[28,1],[32,1],[32,2],[34,1],[34,1],[33,3],[35,1],[35,1],[37,3],[37,1],[39,1],[39,1],[24,1],[24,1],[24,1],[24,1]],performAction:function(e,t,r,o,a,s,u,l){var c=s.length-1;switch(a){case 1:switch(this.parseError=n,l=l||"re"){case"string":return s[c];case"re":var h=O.test(s[c])?T:RegExp;return new h(s[c]);default:throw new Error("unsupported output type: "+l)}break;case 2:this.$="^$";break;case 3:this.$="^"+s[c-1]+"$";break;case 5:case 13:case 35:this.$=s[c-2].concat(s[c-1],s[c]);break;case 7:case 9:case 29:this.$=s[c-1]+s[c];break;case 15:this.$=s[c-2].concat(",",s[c]);break;case 16:this.$=s[c-1].concat(s[c]);break;case 19:this.$="(?:"+s[c-1]+s[c];break;case 23:var d=A.shift(),p=d.capturedMultiChar,f=d.subtraction?"(?!"+d.subtraction+")":"";if(0!==p.length){var m=["(?:",f];if(d.negative){m.push("(?=[");for(var v=0;v<p.length;++v)m.push(I[p[v]].slice(1));m.push("])")}else for(var v=0;v<p.length;++v)m.push("[",I[p[v]],"]|");m.push(s[c-2],s[c-1],s[c],")"),this.$=m.join("")}else this.$=""!==f?"(?:"+f+s[c-2].concat(s[c-1],s[c])+")":s[c-2].concat(s[c-1],s[c]);break;case 24:i(!1),this.$=s[c];break;case 25:i(!0),this.$=s[c];break;case 32:this.$=s[c-2],A[0].subtraction=s[c];break;case 40:if(A.length){var y=I[s[c]];"^"===y.charAt(0)?(A[0].capturedMultiChar.push(s[c]),this.$=""):this.$=y}else this.$=R[s[c]]}},table:[{3:1,4:2,5:[1,3],6:4,7:5,9:6,10:7,20:s,21:9,22:u,24:11,25:12,26:l,27:18,30:c,31:h,42:d,43:p,44:f,45:m},{1:[3]},{1:[2,1]},{1:[2,2]},{5:[1,21]},a(v,[2,4],{10:7,21:9,24:11,25:12,27:18,9:23,8:[1,22],20:s,22:u,26:l,30:c,31:h,42:d,43:p,44:f,45:m}),a(y,[2,6]),a(y,[2,8],{11:24,12:[1,25],13:[1,26],14:[1,27],15:[1,28]}),a(g,[2,17]),a(g,[2,18]),{6:29,7:5,9:6,10:7,20:s,21:9,22:u,24:11,25:12,26:l,27:18,30:c,31:h,42:d,43:p,44:f,45:m},a(g,[2,20]),a(g,[2,21]),a(g,[2,22]),a(_,[2,39]),a(_,[2,40]),a(_,[2,41]),a(_,[2,42]),{24:34,28:30,32:31,33:32,34:33,35:35,37:36,38:b,39:38,40:w,41:E,42:d,43:p,44:f,45:m},a(x,[2,24]),a(x,[2,25]),{1:[2,3]},{6:41,7:5,9:6,10:7,20:s,21:9,22:u,24:11,25:12,26:l,27:18,30:c,31:h,42:d,43:p,44:f,45:m},a(y,[2,7]),a(y,[2,9]),a(y,[2,10]),a(y,[2,11]),a(y,[2,12]),{16:42,18:[1,43]},{23:[1,44]},{29:[1,45]},{24:34,29:[2,26],34:46,35:35,36:[1,47],37:36,38:b,39:38,40:w,41:E,42:d,43:p,44:f,45:m},{29:[2,27]},a(N,[2,28]),a(N,[2,30]),a(N,[2,31]),a(N,[2,33]),a(N,[2,34]),a([29,36,40,41,42,43,44,45],[2,36],{38:[1,48]}),a(N,[2,37]),a(N,[2,38]),a(v,[2,5]),{17:[1,49]},{17:[2,14],19:[1,50]},a(g,[2,19]),a([5,8,12,13,14,15,20,22,23,26,29,30,31,42,43,44,45],[2,23]),a(N,[2,29]),{25:51,27:18,30:c,31:h},{39:52,40:w,41:E},a(y,[2,13]),{17:[2,16],18:[1,53]},{29:[2,32]},a(N,[2,35]),{17:[2,15]}],defaultActions:{2:[2,1],3:[2,2],21:[2,3],32:[2,27],51:[2,32],53:[2,15]},parseError:function(e,t){function r(e,t){this.message=e,this.hash=t}if(!t.recoverable)throw r.prototype=Error,new r(e,t);this.trace(e)},parse:function(e){var t=this,r=[0],n=[null],i=[],o=this.table,a="",s=0,u=0,l=0,c=2,h=1,d=i.slice.call(arguments,1),p=Object.create(this.lexer),f={yy:{}};for(var m in this.yy)Object.prototype.hasOwnProperty.call(this.yy,m)&&(f.yy[m]=this.yy[m]);p.setInput(e,f.yy),f.yy.lexer=p,f.yy.parser=this,"undefined"==typeof p.yylloc&&(p.yylloc={});var v=p.yylloc;i.push(v);var y=p.options&&p.options.ranges;"function"==typeof f.yy.parseError?this.parseError=f.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var g,_,b,w,E,x,N,S,C,T=function(){var e;return e=p.lex()||h,"number"!=typeof e&&(e=t.symbols_[e]||e),e},P={};;){if(b=r[r.length-1],this.defaultActions[b]?w=this.defaultActions[b]:((null===g||"undefined"==typeof g)&&(g=T()),w=o[b]&&o[b][g]),"undefined"==typeof w||!w.length||!w[0]){var k="";C=[];for(x in o[b])this.terminals_[x]&&x>c&&C.push("'"+this.terminals_[x]+"'");k=p.showPosition?"Parse error on line "+(s+1)+":\n"+p.showPosition()+"\nExpecting "+C.join(", ")+", got '"+(this.terminals_[g]||g)+"'":"Parse error on line "+(s+1)+": Unexpected "+(g==h?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(k,{text:p.match,token:this.terminals_[g]||g,line:p.yylineno,loc:v,expected:C})}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+b+", token: "+g);switch(w[0]){case 1:r.push(g),n.push(p.yytext),i.push(p.yylloc),r.push(w[1]),g=null,_?(g=_,_=null):(u=p.yyleng,a=p.yytext,s=p.yylineno,v=p.yylloc,l>0&&l--);break;case 2:if(N=this.productions_[w[1]][1],P.$=n[n.length-N],P._$={first_line:i[i.length-(N||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(N||1)].first_column,last_column:i[i.length-1].last_column},y&&(P._$.range=[i[i.length-(N||1)].range[0],i[i.length-1].range[1]]),E=this.performAction.apply(P,[a,u,s,f.yy,w[1],n,i].concat(d)),"undefined"!=typeof E)return E;N&&(r=r.slice(0,-1*N*2),n=n.slice(0,-1*N),i=i.slice(0,-1*N)),r.push(this.productions_[w[1]][0]),n.push(P.$),i.push(P._$),S=o[r[r.length-2]][r[r.length-1]],r.push(S);break;case 3:return!0}}return!0}},C=r(11),T=r(41);e.prototype=new Error,t.SalveParsingError=e;var P=C.xmlNameChar,k=C.xmlLetter,A=[],O=/\\p/i,I={"\\s":" \\t\\n\\r","\\S":"^ \\t\\n\\r","\\i":""+k+"_:","\\I":"^"+k+"_:","\\c":""+P,"\\C":"^"+P,"\\d":"\\p{Nd}","\\D":"^\\p{Nd}","\\w":"^\\p{P}\\p{Z}\\p{C}","\\W":"\\p{P}\\p{Z}\\p{C}"},R=[];for(var j in I)I.hasOwnProperty(j)&&(R[j]="["+I[j]+"]");var D=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,r=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),r.length-1&&(this.yylineno-=r.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:r?(r.length===n.length?this.yylloc.first_column:0)+n[n.length-r.length].length-r[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var r,n,i;if(this.options.backtrack_lexer&&(i={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(i.yylloc.range=this.yylloc.range.slice(0))),n=e[0].match(/(?:\r\n?|\n).*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],r=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),r)return r;if(this._backtrack){for(var o in i)this[o]=i[o];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,r,n;this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),o=0;o<i.length;o++)if(r=this._input.match(this.rules[i[o]]),r&&(!t||r[0].length>t[0].length)){if(t=r,n=o,this.options.backtrack_lexer){if(e=this.test_match(r,i[o]),e!==!1)return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?(e=this.test_match(t,i[n]),e!==!1?e:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){var e=this.conditionStack.length-1;return e>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return e=this.conditionStack.length-1-Math.abs(e||0),e>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,r,n){switch(r){case 0:return 18;case 1:return 19;case 2:return this.popState(),17;case 3:return this.begin("CHARCLASS"),31;case 4:return this.begin("CHARCLASS"),30;case 5:return 42;case 6:return 43;case 7:return 36;case 8:return 38;case 9:return 40;case 10:return this.popState(),29;case 11:return 22;case 12:return 8;case 13:return 23;case 14:return 13;case 15:return 14;case 16:return 12;case 17:return this.begin("QUANTITY"),15;case 18:return 17;case 19:return 29;case 20:return"^";case 21:return 44;case 22:return 45;case 23:return 26;case 24:return 5;case 25:return 20}},rules:[/^(?:[0-9])/,/^(?:,)/,/^(?:\})/,/^(?:\[\^)/,/^(?:\[)/,/^(?:\\[-nrt\|.?*+(){}[\]^])/,/^(?:\\[sSiIcCdDwW])/,/^(?:-(?=\[))/,/^(?:-)/,/^(?:[^-[\]])/,/^(?:\])/,/^(?:\()/,/^(?:\|)/,/^(?:\))/,/^(?:\*)/,/^(?:\+)/,/^(?:\?)/,/^(?:\{)/,/^(?:\})/,/^(?:\])/,/^(?:\^)/,/^(?:\\p\{.*?\})/,/^(?:\\P\{.*?\})/,/^(?:\.)/,/^(?:$)/,/^(?:[^\\])/],conditions:{CHARCLASS:{rules:[3,4,5,6,7,8,9,10],inclusive:!1},QUANTITY:{rules:[0,1,2],inclusive:!1},INITIAL:{rules:[3,4,5,6,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],inclusive:!0}}};return e}();return S.lexer=D,o.prototype=S,S.Parser=o,new o}();t.parser=i,t.Parser=i.Parser,t.parse=function(){return i.parse.apply(i,arguments)},t.main=function(){throw new Error("this module cannot be used as main")},"undefined"!=typeof e&&r.c[r.s]===e&&t.main(n.argv.slice(1))}).call(t,r(33)(e),r(32))},function(e,t,r){function n(e,t){return-1!==e.search(/^\d+$/)?!1:new h.ParamError(t+" must have an integer value")}function i(e,t){return!n(e,t)&&Number(e)>=0?!1:new h.ParamError(t+" must have a non-negative integer value")}function o(e,t){return!n(e,t)&&Number(e)>0?!1:new h.ParamError(t+" must have a positive value")}function a(e,t){switch(t){case c.PRESERVE:break;case c.REPLACE:e=e.replace(/\r\n\t/g," ");break;case c.COLLAPSE:e=e.replace(/\r\n\t/g," ").trim().replace(/\s{2,}/g," ");break;default:throw new Error("unexpected value: "+t)}return e}function s(e){return e%4===0&&e%100!==0||e%400===0}function u(e){var t=e.match(Be);if(null===t)return!1;var r=t[1],n=s(Number(r)),i=Number(t[2]);if(0===i||i>12)return!1;var o=Number(t[3]),a=$e[i];if(2!==i||n||(a=28),0===o||o>a)return!1;var u=t[4].split(":"),l=Number(u[1]);if(l>59)return!1;var c=Number(u[2]);if(c>59)return!1;var h=0===l&&0===c?24:23;if(Number(u[0])>h)return!1;if(void 0!==t[5]&&""!==t[5]&&"Z"!==t[5]){var d=t[5].split(":"),p=Number(d[0].slice(1));if(p>14)return!1;var f=Number(d[1]);if(f>59)return!1;if(14===p&&0!==f)return!1}return!0}var l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var c,h=r(5),d=r(16),p=r(11);!function(e){e[e.PRESERVE=1]="PRESERVE",e[e.REPLACE=2]="REPLACE",e[e.COLLAPSE=3]="COLLAPSE"}(c||(c={}));for(var f=function(){function e(){this.repeatable=!1}return e.prototype.combine=function(e){if(!this.repeatable)throw new Error("this parameter is not repeatable");throw new Error("derived classes must implement this method if they are repeatable")},e}(),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.convert=function(e){return Number(e)},t}(f),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.isInvalidParam=function(e,t){return i(e,t)},t}(m),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="length",t}return l(t,e),t.prototype.isInvalidValue=function(e,t,r){return r.valueLength(e)===t?!1:new h.ValueError("length of value should be "+t)},t}(v),g=new y,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="minLength",t}return l(t,e),t.prototype.isInvalidValue=function(e,t,r){return r.valueLength(e)>=t?!1:new h.ValueError("length of value should be greater than or equal to "+t)},t}(v),b=new _,w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="maxLength",t}return l(t,e),t.prototype.isInvalidValue=function(e,t,r){return r.valueLength(e)<=t?!1:new h.ValueError("length of value should be less than or equal to "+t)},t}(v),E=new w,x=Object.create(null),N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;
return t.name="pattern",t.repeatable=!0,t}return l(t,e),t.prototype.convert=function(e){var t=x[e];return void 0===t&&(t=x[e]=d.parse(e)),{rng:e,internal:t}},t.prototype.combine=function(e){return e.map(this.convert)},t.prototype.isInvalidParam=function(e){try{this.convert(e)}catch(t){if(t instanceof d.SalveParsingError)return new h.ParamError(t.message);throw t}return!1},t.prototype.isInvalidValue=function(e,t){if(t instanceof Array){for(var r=void 0,n=0,i=t;n<i.length;n++){var o=i[n];if(!o.internal.test(e)){r=o;break}}return void 0===r?!1:new h.ValueError("value does not match the pattern "+r.rng)}return t.internal.test(e)?!1:new h.ValueError("value does not match the pattern "+t.rng)},t}(f),S=new N,C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="totalDigits",t}return l(t,e),t.prototype.isInvalidParam=function(e,t){return o(e,t)},t.prototype.isInvalidValue=function(e,t){var r=String(Number(e)).replace(/[-+.]/g,"");return r.length>t?new h.ValueError("value must have at most "+t+" digits"):!1},t}(m),T=new C,P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="fractionDigits",t}return l(t,e),t.prototype.isInvalidValue=function(e,t){var r=String(Number(e)).replace(/^.*\./,"");return r.length>t?new h.ValueError("value must have at most "+t+" fraction digits"):!1},t}(v),k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.isInvalidParam=function(e,t,r){var n=r.disallows(e);return n?new h.ParamError(n[0].message):!1},t}(m),A=new P,O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="maxInclusive",t}return l(t,e),t.prototype.isInvalidValue=function(e,t){return e>t?new h.ValueError("value must be less than or equal to "+t):!1},t}(k),I=new O,R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="maxExclusive",t}return l(t,e),t.prototype.isInvalidValue=function(e,t){return e>=t?new h.ValueError("value must be less than "+t):!1},t}(k),j=new R,D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="minInclusive",t}return l(t,e),t.prototype.isInvalidValue=function(e,t){return t>e?new h.ValueError("value must be greater than or equal to "+t):!1},t}(k),M=new D,L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="minExclusive",t}return l(t,e),t.prototype.isInvalidValue=function(e,t){return t>=e?new h.ValueError("value must be greater than "+t):!1},t}(k),F=new L,V=function(){function e(){this.whiteSpaceDefault=c.COLLAPSE}return e.throwMissingLocation=function(e){throw new Error("internal error: undefined location")},Object.defineProperty(e.prototype,"paramNameToObj",{get:function(){var e=this._paramNameToObj,t=void 0!==e?e:Object.create(null);if(void 0===e){this._paramNameToObj=t;for(var r=0,n=this.validParams;r<n.length;r++){var i=n[r];t[i.name]=i}}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultParams",{get:function(){var e=this._defaultParams;if(void 0!==e)return e;var t;return this._defaultParams=t=this.parseParams(),t},enumerable:!0,configurable:!0}),e.prototype.convertValue=function(e,t){return a(e,this.whiteSpaceDefault)},e.prototype.valueLength=function(e){return e.length},e.prototype.parseValue=function(e,t){var r=this.disallows(e,{},t);if(r)throw new h.ValueValidationError(r);return{value:this.convertValue(e,t)}},e.prototype.parseParams=function(t,r){var n=[],i=Object.create(null);r=void 0!==r?r:[];for(var o=0,a=r;o<a.length;o++){var s=a[o],u=s.name,l=s.value,c=this.paramNameToObj[u];if(void 0===c)return void n.push(new h.ParamError("unexpected parameter: "+u));var d=c.isInvalidParam(l,u,this);d&&n.push(d),void 0===i[u]||c.repeatable||n.push(new h.ParamError("cannot repeat parameter "+u));var p=i[u];void 0===p&&(p=i[u]=[]),p.push(l)}if(0!==n.length){if(void 0!==t)throw new h.ParameterParsingError(t,n);e.throwMissingLocation(n)}var f=i;for(var m in f){var l=f[m],c=this.paramNameToObj[m];l.length>1?f[m]=c.combine(l):f[m]=void 0!==c.convert?c.convert(l[0]):l[0]}if(f.minLength>f.maxLength&&n.push(new h.ParamError("minLength must be less than or equal to maxLength")),void 0!==f.length&&(void 0!==f.minLength&&n.push(new h.ParamError("length and minLength cannot appear together")),void 0!==f.maxLength&&n.push(new h.ParamError("length and maxLength cannot appear together"))),void 0!==f.maxInclusive&&(void 0!==f.maxExclusive&&n.push(new h.ParamError("maxInclusive and maxExclusive cannot appear together")),f.minExclusive>=f.maxInclusive&&n.push(new h.ParamError("minExclusive must be less than maxInclusive"))),void 0!==f.minInclusive&&(void 0!==f.minExclusive&&n.push(new h.ParamError("minInclusive and minExclusive cannot appear together")),f.minInclusive>f.maxInclusive&&n.push(new h.ParamError("minInclusive must be less than or equal to maxInclusive")),f.minInclusive>=f.maxExclusive&&n.push(new h.ParamError("minInclusive must be less than maxExclusive"))),f.minExclusive>f.maxExclusive&&n.push(new h.ParamError("minExclusive must be less than or equal to maxExclusive")),0!==n.length){if(void 0!==t)throw new h.ParameterParsingError(t,n);e.throwMissingLocation(n)}return f},e.prototype.disallowedByParams=function(e,t,r,n){if(void 0!==r){for(var i=[],o=0,a=Object.keys(r);o<a.length;o++){var s=a[o],u=this.paramNameToObj[s],l=u.isInvalidValue(t,r[s],this);l&&i.push(l)}if(0!==i.length)return i}return!1},e.prototype.equal=function(e,t,r){if(void 0===t.value)throw Error("it looks like you are trying to use an unparsed value");var n;try{n=this.convertValue(e,r)}catch(i){if(i instanceof h.ValueValidationError)return!1;throw i}return n===t.value},e.prototype.disallows=function(e,t,r){if(t instanceof Array)throw new Error("it looks like you are passing unparsed parameters to disallows");if((void 0===t||0===Object.keys(t).length)&&(t=this.defaultParams),null===a(e,c.COLLAPSE).match(this.regexp))return[new h.ValueError(this.typeErrorMsg)];var n;try{n=this.convertValue(e,r)}catch(i){if(i instanceof h.ValueValidationError)return i.errors;throw i}return this.disallowedByParams(e,n,t,r)},e}(),B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="string",t.typeErrorMsg="value is not a string",t.whiteSpaceDefault=c.PRESERVE,t.validParams=[g,b,E,S],t.needsContext=!1,t.regexp=/^.*$/,t}return l(t,e),t}(V),$=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="normalizedString",t.typeErrorMsg="string contains a tab, carriage return or newline",t.regexp=/^[^\r\n\t]+$/,t}return l(t,e),t}(B),H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="token",t.typeErrorMsg="not a valid token",t.regexp=/^(?:(?! )(?:(?! {3})[^\r\n\t])*[^\r\n\t ])?$/,t}return l(t,e),t}($),W=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="language",t.typeErrorMsg="not a valid language identifier",t.regexp=/^[a-zA-Z]{1,8}(-[a-zA-Z0-9]{1,8})*$/,t}return l(t,e),t}(H),q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Name",t.typeErrorMsg="not a valid Name",t.regexp=p.xmlNameRe,t}return l(t,e),t}(H),U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="NCName",t.typeErrorMsg="not a valid NCName",t.regexp=p.xmlNcnameRe,t}return l(t,e),t}(q),z=new RegExp("^["+p.xmlNameChar+"]+$"),G=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="NMTOKEN",t.typeErrorMsg="not a valid NMTOKEN",t.regexp=z,t}return l(t,e),t}(H),K=new RegExp("^["+p.xmlNameChar+"]+(?: ["+p.xmlNameChar+"]+)*$"),X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="NMTOKENS",t.typeErrorMsg="not a valid NMTOKENS",t.regexp=K,t.whiteSpaceDefault=c.COLLAPSE,t}return l(t,e),t}(G),Q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="ID",t.typeErrorMsg="not a valid ID",t}return l(t,e),t}(U),Y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="IDREF",t.typeErrorMsg="not a valid IDREF",t}return l(t,e),t}(U),J=new RegExp("^"+p.xmlNcname+"(?: "+p.xmlNcname+")*$"),Z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="IDREFS",t.typeErrorMsg="not a valid IDREFS",t.regexp=J,t.whiteSpaceDefault=c.COLLAPSE,t}return l(t,e),t}(Y),ee=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="ENTITY",t.typeErrorMsg="not a valid ENTITY",t}return l(t,e),t}(B),te=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="ENTITIES",t.typeErrorMsg="not a valid ENTITIES",t}return l(t,e),t}(B),re="[-+]?(?!$)\\d*(\\.\\d*)?",ne=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="decimal",t.typeErrorMsg="value not a decimal number",t.regexp=new RegExp("^"+re+"$"),t.whiteSpaceDefault=c.COLLAPSE,t.needsContext=!1,t.validParams=[T,A,S,F,M,j,I],t}return l(t,e),t.prototype.convertValue=function(t){return Number(e.prototype.convertValue.call(this,t))},t}(V),ie="[-+]?\\d+",oe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="integer",t.typeErrorMsg="value is not an integer",t.regexp=new RegExp("^"+ie+"$"),t.validParams=[T,S,F,M,j,I],t}return l(t,e),t.prototype.parseParams=function(t,r){function n(e){var r=[new h.ParamError(e)];if(void 0!==t)throw new h.ParameterParsingError(t,r);return V.throwMissingLocation(r)}var i,o,a=e.prototype.parseParams.call(this,t,r),s=this.highestVal;return void 0!==s&&(void 0!==a.maxExclusive?(i=a.maxExclusive,i>s&&n("maxExclusive cannot be greater than "+s)):void 0!==a.maxInclusive?(o=a.maxInclusive,o>s&&n("maxInclusive cannot be greater than "+s)):a.maxInclusive=this.highestVal),void 0!==this.lowestVal&&(void 0!==a.minExclusive?(i=a.minExclusive,i<this.lowestVal&&n("minExclusive cannot be lower than "+this.lowestVal)):void 0!==a.minInclusive?(o=a.minInclusive,o<this.lowestVal&&n("minInclusive cannot be lower than "+this.lowestVal)):a.minInclusive=this.lowestVal),a},t}(ne),ae=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="nonPositiveInteger",t.typeErrorMsg="value is not a nonPositiveInteger",t.regexp=/^\+?0+|-\d+$/,t.highestVal=0,t.validParams=[T,S,F,M,j,I],t}return l(t,e),t}(oe),se=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="negativeInteger",t.typeErrorMsg="value is not a negativeInteger",t.regexp=/^-\d+$/,t.highestVal=-1,t.validParams=[T,S,F,M,j,I],t}return l(t,e),t}(ae),ue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="nonNegativeInteger",t.typeErrorMsg="value is not a nonNegativeInteger",t.regexp=/^(\+?\d+|-0)$/,t.lowestVal=0,t.validParams=[T,S,F,M,j,I],t}return l(t,e),t}(oe),le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="positiveInteger",t.typeErrorMsg="value is not a positiveInteger",t.regexp=/^\+?\d+$/,t.lowestVal=1,t.validParams=[T,S,F,M,j,I],t}return l(t,e),t}(ue),ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="long",t.typeErrorMsg="value is not a long",t.highestVal=0x8000000000000000,t.lowestVal=-0x8000000000000000,t.validParams=[T,S,F,M,j,I],t}return l(t,e),t}(oe),he=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="int",t.typeErrorMsg="value is not an int",t.highestVal=2147483647,t.lowestVal=-2147483648,t}return l(t,e),t}(ce),de=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="short",t.typeErrorMsg="value is not a short",t.highestVal=32767,t.lowestVal=-32768,t}return l(t,e),t}(he),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="byte",t.typeErrorMsg="value is not a byte",t.highestVal=127,t.lowestVal=-128,t}return l(t,e),t}(de),fe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="unsignedLong",t.typeErrorMsg="value is not an unsignedLong",t.highestVal=0x10000000000000000,t.validParams=[T,S,F,M,j,I],t}return l(t,e),t}(ue),me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="unsignedInt",t.typeErrorMsg="value is not an unsignedInt",t.highestVal=4294967295,t.validParams=[T,S,F,M,j,I],t}return l(t,e),t}(fe),ve=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="unsignedShort",t.typeErrorMsg="value is not an unsignedShort",t.highestVal=65535,t.validParams=[T,S,F,M,j,I],t}return l(t,e),t}(me),ye=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="unsignedByte",t.typeErrorMsg="value is not an unsignedByte",t.highestVal=255,t.validParams=[T,S,F,M,j,I],t}return l(t,e),t}(ve),ge=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="boolean",t.typeErrorMsg="not a valid boolean",t.regexp=/^(1|0|true|false)$/,t.validParams=[S],t.needsContext=!1,t}return l(t,e),t.prototype.convertValue=function(e){return"1"===e||"true"===e},t}(V),_e="[AQgw]",be="[AEIMQUYcgkosw048]",we="[A-Za-z0-9+/]",Ee="(?:"+we+" ?)",xe="(?:"+be+" ?)",Ne="(?:"+_e+" ?)",Se=new RegExp("^(?:(?:"+Ee+"{4})*(?:(?:"+Ee+"{3}"+we+")|(?:"+Ee+"{2}"+xe+"=)|(?:"+(""+Ee+Ne+"= ?=)))?$")),Ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="base64Binary",t.typeErrorMsg="not a valid base64Binary",t.regexp=Se,t.needsContext=!1,t.validParams=[g,b,E,S],t}return l(t,e),t.prototype.convertValue=function(e){return e.replace(/\s/g,"")},t.prototype.valueLength=function(e){return Math.floor(3*e.replace(/[\s=]/g,"").length/4)},t}(V),Te=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="hexBinary",t.typeErrorMsg="not a valid hexBinary",t.regexp=/^(?:[0-9a-fA-F]{2})*$/,t.needsContext=!1,t.validParams=[g,b,E,S],t}return l(t,e),t.prototype.convertValue=function(e){return e},t.prototype.valueLength=function(e){return e.length/2},t}(V),Pe=new RegExp("^(?:(?:[-+]?INF)|(?:NaN)|(?:"+re+"(?:[Ee]"+ie+")?))$"),ke=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="float",t.typeErrorMsg="not a valid float",t.regexp=Pe,t.needsContext=!1,t.validParams=[S,M,F,I,j],t}return l(t,e),t.prototype.convertValue=function(e,t){return parseFloat(e)},t}(V),Ae=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="double",t.typeErrorMsg="not a valid double",t.regexp=Pe,t.needsContext=!1,t.validParams=[S,M,F,I,j],t}return l(t,e),t.prototype.convertValue=function(e,t){return parseFloat(e)},t}(V),Oe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="QName",t.typeErrorMsg="not a valid QName",t.regexp=new RegExp("^(?:"+p.xmlNcname+":)?"+p.xmlNcname+"$"),t.needsContext=!0,t.validParams=[S,g,b,E],t}return l(t,e),t.prototype.convertValue=function(t,r){var n=r.resolver.resolveName(e.prototype.convertValue.call(this,t));if(void 0===n)throw new h.ValueValidationError([new h.ValueError("cannot resolve the name "+t)]);return"{"+n.ns+"}"+n.name},t}(V),Ie=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="NOTATION",t.typeErrorMsg="not a valid NOTATION",t.regexp=new RegExp("^(?:"+p.xmlNcname+":)?"+p.xmlNcname+"$"),t.needsContext=!0,t.validParams=[S,g,b,E],t}return l(t,e),t.prototype.convertValue=function(t,r){var n=r.resolver.resolveName(e.prototype.convertValue.call(this,t));if(void 0===n)throw new h.ValueValidationError([new h.ValueError("cannot resolve the name "+t)]);return"{"+n.ns+"}"+n.name},t}(V),Re=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="duration",t.typeErrorMsg="not a valid duration",t.regexp=/^-?P(?!$)(?:\d+Y)?(?:\d+M)?(?:\d+D)?(?:T(?!$)(?:\d+H)?(?:\d+M)?(?:\d+(\.\d+)?S)?)?$/,t.validParams=[S],t.needsContext=!1,t}return l(t,e),t}(V),je="-?(?:[1-9]\\d*)?\\d{4}",De="[01]\\d",Me="[0-3]\\d",Le="[012]\\d:[0-5]\\d:[0-5]\\d(?:\\.\\d+)?",Fe="(?:[+-][01]\\d:[0-5]\\d|Z)",Ve=new RegExp(Fe+"$"),Be=new RegExp("^("+je+")-("+De+")-("+Me+")T("+Le+")"+("("+Fe+"?)$")),$e=[void 0,31,29,31,30,31,30,31,31,30,31,30,31],He=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="dateTime",t.typeErrorMsg="not a valid dateTime",t.regexp=new RegExp("^"+je+"-"+De+"-"+Me+("T"+Le+Fe+"?$")),t.needsContext=!1,t.validParams=[S],t}return l(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);return n instanceof Array?n:u(t)?!1:[new h.ValueError(this.typeErrorMsg)]},t}(V),We=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="time",t.typeErrorMsg="not a valid time",t.regexp=new RegExp("^"+Le+Fe+"?$"),t.validParams=[S],t.needsContext=!1,t}return l(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);return n?n:u("1901-01-01T"+t)?!1:[new h.ValueError(this.typeErrorMsg)]},t}(V),qe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="date",t.typeErrorMsg="not a valid date",t.regexp=new RegExp("^"+je+"-"+De+"-"+Me+Fe+"?$"),t.needsContext=!1,t.validParams=[S],t}return l(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var i=t.match(Ve);return t=null!==i?t.slice(0,i.index)+"T00:00:00"+i[0]:t+"T00:00:00",u(t)?!1:[new h.ValueError(this.typeErrorMsg)]},t}(V),Ue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gYearMonth",t.typeErrorMsg="not a valid gYearMonth",t.regexp=new RegExp("^"+je+"-"+De+Fe+"?$"),t.validParams=[S],t.needsContext=!1,t}return l(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var i=t.match(Ve);return t=null!==i?t.slice(0,i.index)+"-01T00:00:00"+i[0]:t+"-01T00:00:00",u(t)?!1:[new h.ValueError(this.typeErrorMsg)]},t}(V),ze=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gYear",t.typeErrorMsg="not a valid gYear",t.regexp=new RegExp("^"+je+Fe+"?$"),t.needsContext=!1,t.validParams=[S],t}return l(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var i=t.match(Ve);return t=null!==i?t.slice(0,i.index)+"-01-01T00:00:00"+i[0]:t+"-01-01T00:00:00",u(t)?!1:[new h.ValueError(this.typeErrorMsg)]},t}(V),Ge=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gMonthDay",t.typeErrorMsg="not a valid gMonthDay",t.regexp=new RegExp("^"+De+"-"+Me+Fe+"?$"),t.needsContext=!1,t.validParams=[S],t}return l(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var i=t.match(Ve);return t=null!==i?t.slice(0,i.index)+"T00:00:00"+i[0]:t+"T00:00:00",u("2000-"+t)?!1:[new h.ValueError(this.typeErrorMsg)]},t}(V),Ke=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gDay",t.typeErrorMsg="not a valid gDay",t.regexp=new RegExp("^"+Me+Fe+"?$"),t.needsContext=!1,t.validParams=[S],t}return l(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var i=t.match(Ve);return t=null!==i?t.slice(0,i.index)+"T00:00:00"+i[0]:t+"T00:00:00",u("2000-01-"+t)?!1:[new h.ValueError(this.typeErrorMsg)]},t}(V),Xe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gMonth",t.typeErrorMsg="not a valid gMonth",t.regexp=new RegExp("^"+De+Fe+"?$"),t.needsContext=!1,t.validParams=[S],t}return l(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var i=t.match(Ve);return t=null!==i?t.slice(0,i.index)+"-01T00:00:00"+i[0]:t+"-01T00:00:00",u("2000-"+t)?!1:[new h.ValueError(this.typeErrorMsg)]},t}(V),Qe=/^(?:[A-Za-z][A-Za-z0-9+\-.]*:(?:\/\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\.[A-Za-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\?(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?(?:\#(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?|(?:\/\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\.[A-Za-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\-._~!$&'()*+,;=@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\?(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?(?:\#(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?)$/,Ye=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="anyURI",t.typeErrorMsg="not a valid anyURI",t.regexp=Qe,t.needsContext=!1,t.validParams=[S,g,b,E],t}return l(t,e),t}(V),Je=[B,$,H,W,q,U,G,X,Q,Y,Z,ee,te,ne,oe,ae,se,ue,le,ce,he,de,pe,fe,me,ve,ye,ge,Ce,Te,ke,Ae,Oe,Ie,Re,He,We,qe,Ue,ze,Ge,Ke,Xe,Ye],Ze={uri:"http://www.w3.org/2001/XMLSchema-datatypes",types:{}},et=0,tt=Je;et<tt.length;et++){var rt=tt[et],nt=new rt;Ze.types[nt.name]=nt}t.xmlschema=Ze},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(0),a=function(e){function t(t,r,n){var i=e.call(this,t,n)||this;return i.name=r,i}return n(t,e),t.prototype._prepare=function(e){var t=Object.create(null);this.name._recordNamespaces(t),delete t[""];for(var r in t)e[r]=1},t.prototype._hasAttrs=function(){return!0},t}(o.OneSubpattern);t.Attribute=a;var s=function(e){function t(r,n){var i=this;if(r instanceof t){var a=r,s=o.isHashMap(n);i=e.call(this,a,s)||this,i.nameResolver=i._cloneIfNeeded(a.nameResolver,s),i.seenName=a.seenName,i.seenValue=a.seenValue,i.subwalker=void 0!==a.subwalker?a.subwalker._clone(s):void 0,i.attrNameEvent=a.attrNameEvent,i.neutralized=a.neutralized}else{var u=r,l=o.isNameResolver(n);i=e.call(this,u)||this,i.nameResolver=l,i.attrNameEvent=new o.Event("attributeName",u.name),i.seenName=!1,i.seenValue=!1,i.neutralized=!1}return i}return n(t,e),t.prototype._possible=function(){if(this.suppressedAttributes)return new o.EventSet;if(!this.seenName)return new o.EventSet(this.attrNameEvent);if(!this.seenValue){void 0===this.subwalker&&(this.subwalker=this.el.pat.newWalker(this.nameResolver));var e=this.subwalker._possible(),t=new o.EventSet;return e.forEach(function(e){if("text"!==e.params[0])throw new Error("unexpected event type: "+e.params[0]);t.add(new o.Event("attributeValue",e.params[1]))}),t}return new o.EventSet},t.prototype.possible=function(){return this._possible()},t.prototype.fireEvent=function(e){if(!this.suppressedAttributes&&!this.neutralized){if("neutralizeAttribute"===e.params[0]&&this.el.name.toString()===e.params[1].toString())return this.neutralized=!0,!1;if(this.seenName){if(!this.seenValue&&"attributeValue"===e.params[0]){this.seenValue=!0,void 0===this.subwalker&&(this.subwalker=this.el.pat.newWalker(this.nameResolver));var t=new o.Event("text",e.params[1]),r=this.subwalker.fireEvent(t);return void 0===r?[new i.AttributeValueError("invalid attribute value",this.el.name)]:(r===!1&&(r=this.subwalker.end()),r)}}else if("attributeName"===e.params[0]&&this.el.name.match(e.params[1],e.params[2]))return this.seenName=!0,!1}},t.prototype._suppressAttributes=function(){this.suppressedAttributes=!0},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this.seenValue||this.neutralized},t.prototype.end=function(e){return void 0===e&&(e=!1),this.neutralized?!1:this.seenName?this.seenValue?!1:[new i.AttributeValueError("attribute value missing",this.el.name)]:[new i.AttributeNameError("attribute missing",this.el.name)]},t}(o.Walker);o.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(0),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o.TwoSubpatterns);t.Choice=a;var s=function(e){function t(r,n){var i=this;if(r instanceof t){var a=r,s=o.isHashMap(n);i=e.call(this,a,s)||this,i.nameResolver=i._cloneIfNeeded(a.nameResolver,s),i.chosen=a.chosen,i.walkerA=void 0!==a.walkerA?a.walkerA._clone(s):void 0,i.walkerB=void 0!==a.walkerB?a.walkerB._clone(s):void 0,i.instantiatedWalkers=a.instantiatedWalkers}else{var u=r,l=o.isNameResolver(n);i=e.call(this,u)||this,i.nameResolver=l,i.chosen=!1,i.instantiatedWalkers=!1}return i}return n(t,e),t.prototype._possible=function(){if(this._instantiateWalkers(),void 0!==this.possibleCached)return this.possibleCached;if(this.possibleCached=void 0!==this.walkerA?this.walkerA._possible():void 0,void 0!==this.walkerB){this.possibleCached=new o.EventSet(this.possibleCached);var e=this.walkerB._possible();this.possibleCached.union(e)}else void 0===this.possibleCached&&(this.possibleCached=new o.EventSet);return this.possibleCached},t.prototype.fireEvent=function(e){this._instantiateWalkers(),this.possibleCached=void 0;var t=void 0!==this.walkerA?this.walkerA.fireEvent(e):void 0,r=void 0!==this.walkerB?this.walkerB.fireEvent(e):void 0;return void 0!==t?(this.chosen=!0,void 0===r?(this.walkerB=void 0,t):t):void 0!==r?(this.chosen=!0,this.walkerA=void 0,r):void 0},t.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressedAttributes||(this.possibleCached=void 0,this.suppressedAttributes=!0,void 0!==this.walkerA&&this.walkerA._suppressAttributes(),void 0!==this.walkerB&&this.walkerB._suppressAttributes())},t.prototype.canEnd=function(e){void 0===e&&(e=!1),this._instantiateWalkers();var t=!1,r=!1;return e&&(t=!this.el.patA._hasAttrs(),r=!this.el.patB._hasAttrs()),t=t||void 0!==this.walkerA&&this.walkerA.canEnd(e),r=r||void 0!==this.walkerB&&this.walkerB.canEnd(e),t||r},t.prototype.end=function(e){if(void 0===e&&(e=!1),this._instantiateWalkers(),this.canEnd(e))return!1;var t=void 0!==this.walkerA&&this.walkerA.end(e),r=void 0!==this.walkerB&&this.walkerB.end(e);if(!t&&!r)return!1;if(t&&!r)return t;if(!t&&r)return r;var n=[],o=[],a=!1;return this.walkerA.possible().forEach(function(e){"enterStartTag"===e.params[0]?n.push(e.params[1]):a=!0}),a||(this.walkerB.possible().forEach(function(e){"enterStartTag"===e.params[0]?o.push(e.params[1]):a=!0}),a)?t||r:[new i.ChoiceError(n,o)]},t.prototype._instantiateWalkers=function(){this.instantiatedWalkers||(this.instantiatedWalkers=!0,this.walkerA=this.el.patA.newWalker(this.nameResolver),this.walkerB=this.el.patB.newWalker(this.nameResolver))},t}(o.Walker);o.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),o=r(1),a=r(0),s=function(e){function t(t,r,n,o,a){void 0===r&&(r="token"),void 0===n&&(n="");var s=e.call(this,t)||this;if(s.type=r,s.datatypeLibrary=n,s.except=a,s.datatype=i.registry.get(s.datatypeLibrary).types[s.type],void 0===s.datatype)throw new Error("unkown type: "+r);return s.rngParams=void 0!==o?o:[],s}return n(t,e),Object.defineProperty(t.prototype,"params",{get:function(){var e=this._params;return null!=e?e:e=this._params=this.datatype.parseParams(this.xmlPath,this.rngParams)},enumerable:!0,configurable:!0}),t}(a.Pattern);t.Data=s;var u=function(e){function t(r,n){var i=this;if(r instanceof t){var o=r,s=a.isHashMap(n);i=e.call(this,o,s)||this,i.nameResolver=i._cloneIfNeeded(o.nameResolver,s),i.context=void 0!==o.context?{resolver:i.nameResolver}:void 0,i.matched=o.matched}else{var u=r,l=a.isNameResolver(n,"as 2nd argument");i=e.call(this,u)||this,i.nameResolver=l,i.possibleCached=new a.EventSet(new a.Event("text",i.el.datatype.regexp)),i.context=u.datatype.needsContext?{resolver:i.nameResolver}:void 0,i.matched=!1}return i}return n(t,e),t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){if(!this.matched&&"text"===e.params[0]&&!this.el.datatype.disallows(e.params[1],this.el.params,this.context)){if(void 0!==this.el.except){var t=this.el.except.newWalker(this.nameResolver),r=t.fireEvent(e);if(r===!1)return}return this.matched=!0,this.possibleCached=new a.EventSet,!1}},t.prototype.canEnd=function(e){if(void 0===e&&(e=!1),this.matched)return!0;if(void 0!==this.el.except){var t=this.el.except.newWalker(this.nameResolver);if(t.canEnd())return!1}return!this.el.datatype.disallows("",this.el.params,this.context)},t.prototype.end=function(e){return void 0===e&&(e=!1),this.canEnd(e)?!1:[new o.ValidationError("value required")]},t.prototype._suppressAttributes=function(){},t}(a.Walker);a.addWalker(s,u)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(2),a=r(0),s=r(6),u=function(e){function t(t,r,n){var i=e.call(this,t,n)||this;return i.name=r,i}return n(t,e),t.prototype._prepare=function(e){this.name._recordNamespaces(e),this.pat._prepare(e)},t.prototype.newWalker=function(e){return this.pat instanceof s.NotAllowed?this.pat.newWalker(e):l.makeWalker(this,e)},t.prototype._hasAttrs=function(){return!1},t.prototype._gatherElementDefinitions=function(e){var t=this.name.toString();void 0===e[t]?e[t]=[this]:e[t].push(this);
},t}(a.OneSubpattern);t.Element=u;var l=function(e){function t(r,n){var i=this;if(r instanceof t){var o=r,s=a.isHashMap(n);i=e.call(this,o,s)||this,i.nameResolver=i._cloneIfNeeded(o.nameResolver,s),i.seenName=o.seenName,i.endedStartTag=o.endedStartTag,i.closed=o.closed,i.walker=void 0!==o.walker?o.walker._clone(s):void 0,i.startTagEvent=o.startTagEvent,i.endTagEvent=o.endTagEvent,i.boundName=o.boundName}else{var u=r,l=a.isNameResolver(n);i=e.call(this,u)||this,i.nameResolver=l,i.seenName=!1,i.endedStartTag=!1,i.closed=!1,i.startTagEvent=new a.Event("enterStartTag",u.name)}return i}return n(t,e),t.makeWalker=function(e,r){return new t(e,r)},t.prototype._possible=function(){if(!this.seenName)return new a.EventSet(this.startTagEvent);if(!this.endedStartTag){var e=this.walker,r=e._possible(),n=new a.EventSet,i=new a.EventSet;return r.forEach(function(e){"attributeValue"===e.params[0]?i.add(e):e.isAttributeEvent()&&n.add(e)}),0!==i.size()?n=i:e.canEnd(!0)&&n.add(t._leaveStartTagEvent),n}if(!this.closed){var e=this.walker,o=new a.EventSet(e._possible());return e.canEnd()&&o.add(this.endTagEvent),o}return new a.EventSet},t.prototype.possible=function(){return this._possible()},t.prototype.fireEvent=function(e){if(!this.endedStartTag){if(this.seenName){if("leaveStartTag"===e.params[0]){this.endedStartTag=!0;var t=this.walker,r=t.end(!0),n=[];if(r)for(var s=0,u=r;s<u.length;s++){var l=u[s];(l instanceof i.AttributeValueError||l instanceof i.AttributeNameError)&&n.push(l),l instanceof i.AttributeNameError&&t.fireEvent(new a.Event(["neutralizeAttribute",l.name]))}return t._suppressAttributes(),0!==n.length?n:!1}}else if("enterStartTag"===e.params[0]&&this.el.name.match(e.params[1],e.params[2]))return this.walker=this.el.pat.newWalker(this.nameResolver),this.seenName=!0,this.boundName=new o.Name("",e.params[1],e.params[2]),this.endTagEvent=new a.Event("endTag",this.boundName),!1;return void 0!==this.walker?this.walker.fireEvent(e):void 0}if(!this.closed){var t=this.walker,n=t.fireEvent(e);if(void 0===n)if("endTag"===e.params[0]){if(this.boundName.match(e.params[1],e.params[2])){this.closed=!0;var r=t.end();if(n=[],r)for(var c=0,h=r;c<h.length;c++){var l=h[c];l instanceof i.AttributeValueError||l instanceof i.AttributeNameError||n.push(l)}return 0!==n.length?n:!1}}else if("leaveStartTag"===e.params[0])return[new i.ValidationError("unexpected leaveStartTag event; it is likely that fireEvent is incorrectly called")];return n}},t.prototype._suppressAttributes=function(){},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),e?!0:this.closed},t.prototype.end=function(e){if(void 0===e&&(e=!1),e)return!1;var t=[];if(this.seenName){if(!this.endedStartTag||!this.closed){if(void 0!==this.walker){var r=this.walker.end();r&&(t=r)}t.push(this.endedStartTag?new i.ElementNameError("tag not closed",this.el.name):new i.ElementNameError("start tag not terminated",this.el.name))}}else t.push(new i.ElementNameError("tag required",this.el.name));return t.length>0?t:!1},t}(a.Walker);l._leaveStartTagEvent=new a.Event("leaveStartTag")},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i.Pattern);t.Empty=o;var a=function(e){function t(r,n){var o=this;return r instanceof t?(n=i.isHashMap(n),o=e.call(this,r,n)||this):(o=e.call(this,r)||this,o.possibleCached=new i.EventSet),o}return n(t,e),t.prototype.possible=function(){return new i.EventSet},t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){return e===i.emptyEvent||"text"===e.params[0]&&""===e.params[1].trim()?!1:void 0},t}(i.Walker);t.EmptyWalker=a,i.addWalker(o,a)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(0),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o.TwoSubpatterns);t.Group=a;var s=function(e){function t(r,n){var i=this;if(r instanceof t){var a=r,s=o.isHashMap(n);i=e.call(this,a,s)||this,i.nameResolver=i._cloneIfNeeded(a.nameResolver,s),i.hitA=a.hitA,i.endedA=a.endedA,i.hitB=a.hitB,i.walkerA=void 0!==a.walkerA?a.walkerA._clone(s):void 0,i.walkerB=void 0!==a.walkerB?a.walkerB._clone(s):void 0}else{var u=r,l=o.isNameResolver(n);i=e.call(this,u)||this,i.nameResolver=l,i.hitA=!1,i.endedA=!1,i.hitB=!1}return i}return n(t,e),t.prototype._possible=function(){if(this._instantiateWalkers(),void 0!==this.possibleCached)return this.possibleCached;var e=this.walkerA,t=this.walkerB;if(this.possibleCached=this.endedA?void 0:e._possible(),this.suppressedAttributes)(this.endedA||e.canEnd())&&(this.possibleCached=new o.EventSet(this.possibleCached),this.possibleCached.union(t._possible()));else{var r=t._possible();this.endedA&&!this.hitB||e.canEnd()||(r=r.filter(function(e){return e.isAttributeEvent()})),this.possibleCached=new o.EventSet(this.possibleCached),this.possibleCached.union(r)}return this.possibleCached},t.prototype.fireEvent=function(e){this._instantiateWalkers();var t=this.walkerA,r=this.walkerB;if(this.possibleCached=void 0,!this.endedA){var n=t.fireEvent(e);if(void 0!==n)return this.hitA=!0,n;if(!e.isAttributeEvent()&&!t.canEnd())return}var i=r.fireEvent(e);if(void 0!==i&&(this.hitB=!0),!e.isAttributeEvent()&&void 0!==i&&!this.endedA){var o=t.end();this.endedA=!0,i?o&&(i=i.concat(o)):i=o}return i},t.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressedAttributes||(this.possibleCached=void 0,this.suppressedAttributes=!0,this.walkerA._suppressAttributes(),this.walkerB._suppressAttributes())},t.prototype.canEnd=function(e){void 0===e&&(e=!1),this._instantiateWalkers();var t=this.walkerA,r=this.walkerB;if(e){var n=this.el.patA._hasAttrs(),i=this.el.patB._hasAttrs();return n&&i?t.canEnd(e)&&r.canEnd(e):n?t.canEnd(!0):i?r.canEnd(!0):!0}return t.canEnd(e)&&r.canEnd(e)},t.prototype.end=function(e){if(void 0===e&&(e=!1),this.canEnd(e))return!1;var t,r=this.walkerA,n=this.walkerB;if(e){var o=this.el.patA._hasAttrs(),a=this.el.patB._hasAttrs();if(o){if(this.endedA)throw new Error("invalid state: endedA is true but we are processing attributes");if(t=r.end(!0),a){var s=n.end(!0);s&&(t=t?t.concat(s):s)}return t}return a?n.end(!0):!1}var u=!1;if(!this.endedA&&(u=r.end(!1)))for(var l=0,c=u;l<c.length;l++){var h=c[l];if(!(h instanceof i.AttributeValueError||h instanceof i.AttributeNameError))return u}var d=n.end(!1);return d?u?u.concat(d):d:u},t.prototype._instantiateWalkers=function(){void 0===this.walkerA&&(this.walkerA=this.el.patA.newWalker(this.nameResolver),this.walkerB=this.el.patB.newWalker(this.nameResolver))},t}(o.Walker);o.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i.TwoSubpatterns);t.Interleave=o;var a=function(e){function t(r,n){var o=this;if(r instanceof t){var a=r,s=i.isHashMap(n);o=e.call(this,a,s)||this,o.nameResolver=o._cloneIfNeeded(a.nameResolver,s),o.inA=a.inA,o.inB=a.inB,o.walkerA=void 0!==a.walkerA?a.walkerA._clone(s):void 0,o.walkerB=void 0!==a.walkerB?a.walkerB._clone(s):void 0}else{var u=r,l=i.isNameResolver(n);o=e.call(this,u)||this,o.nameResolver=l,o.inA=!1,o.inB=!1}return o}return n(t,e),t.prototype._possible=function(){if(this._instantiateWalkers(),void 0!==this.possibleCached)return this.possibleCached;if(this.inA&&this.inB)throw new Error("impossible state");var e=this.walkerA,t=this.walkerB;return this.inA&&!e.canEnd()?this.possibleCached=e._possible():this.inB&&!t.canEnd()&&(this.possibleCached=t._possible()),void 0===this.possibleCached&&(this.possibleCached=e.possible(),this.possibleCached.union(t._possible())),this.possibleCached},t.prototype.fireEvent=function(e){if(this._instantiateWalkers(),this.possibleCached=void 0,this.inA&&this.inB)throw new Error("impossible state");var t,r,n=this.walkerA,i=this.walkerB;if(!this.inA&&!this.inB)return t=n.fireEvent(e),t===!1?(this.inA=!0,!1):(r=i.fireEvent(e),r===!1?(this.inB=!0,!1):void 0===r?t:void 0===t?r:t.concat(r));if(this.inA){if(t=n.fireEvent(e),t instanceof Array||t===!1)return t;if(r=i.fireEvent(e),r===!1)return this.inA=!1,this.inB=!0,!1}else{if(r=i.fireEvent(e),r instanceof Array||r===!1)return r;if(t=n.fireEvent(e),t===!1)return this.inA=!0,this.inB=!1,!1}},t.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressedAttributes||(this.possibleCached=void 0,this.suppressedAttributes=!0,this.walkerA._suppressAttributes(),this.walkerB._suppressAttributes())},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this._instantiateWalkers(),this.walkerA.canEnd(e)&&this.walkerB.canEnd(e)},t.prototype.end=function(e){void 0===e&&(e=!1),this._instantiateWalkers();var t=this.walkerA.end(e),r=this.walkerB.end(e);return t&&!r?t:r&&!t?r:t&&r?t.concat(r):!1},t.prototype._instantiateWalkers=function(){void 0===this.walkerA&&(this.walkerA=this.el.patA.newWalker(this.nameResolver)),void 0===this.walkerB&&(this.walkerB=this.el.patB.newWalker(this.nameResolver))},t}(i.Walker);i.addWalker(o,a)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(0),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o.OneSubpattern);t.List=a;var s=function(e){function t(r,n){var i=this;if(r instanceof t){var a=r,s=o.isHashMap(n,"as 2nd argument");i=e.call(this,a,s)||this,i.nameResolver=i._cloneIfNeeded(a.nameResolver,s),i.subwalker=a.subwalker._clone(s),i.seenTokens=a.seenTokens,i.matched=a.matched}else{var u=r,l=o.isNameResolver(n,"as 2nd argument");i=e.call(this,u)||this,i.nameResolver=l,i.subwalker=u.pat.newWalker(i.nameResolver),i.seenTokens=!1,i.matched=!1}return i}return n(t,e),t.prototype.fireEvent=function(e){if("text"===e.params[0]){var t=e.params[1].trim();if(""===t)return!1;this.seenTokens=!0;for(var r=t.split(/\s+/),n=0,i=r;n<i.length;n++){var a=i[n],s=this.subwalker.fireEvent(new o.Event(e.params[0],a));if(s!==!1)return s}return this.matched=!0,!1}},t.prototype._suppressAttributes=function(){},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this.seenTokens?this.subwalker.canEnd(e):this.subwalker.fireEvent(o.emptyEvent)===!1},t.prototype.end=function(e){void 0===e&&(e=!1);var t=this.subwalker.end(e);return t!==!1?t:this.canEnd(e)?!1:[new i.ValidationError("unfulfilled list")]},t}(o.SingleSubwalker);o.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i.OneSubpattern);t.OneOrMore=o;var a=function(e){function t(r,n){var o=this;if(r instanceof t){var a=r,s=i.isHashMap(n);o=e.call(this,a,s)||this,o.seenOnce=a.seenOnce,o.nameResolver=o._cloneIfNeeded(a.nameResolver,s),o.currentIteration=void 0!==a.currentIteration?a.currentIteration._clone(s):void 0,o.nextIteration=void 0!==a.nextIteration?a.nextIteration._clone(s):void 0}else{var u=r,l=i.isNameResolver(n);o=e.call(this,u)||this,o.nameResolver=l,o.seenOnce=!1}return o}return n(t,e),t.prototype._possible=function(){if(void 0!==this.possibleCached)return this.possibleCached;if(this._instantiateCurrentIteration(),this.possibleCached=this.currentIteration._possible(),this.currentIteration.canEnd()){this.possibleCached=new i.EventSet(this.possibleCached),this._instantiateNextIteration();var e=this.nextIteration._possible();this.possibleCached.union(e)}return this.possibleCached},t.prototype.fireEvent=function(e){this.possibleCached=void 0,this._instantiateCurrentIteration();var t=this.currentIteration,r=t.fireEvent(e);if(r===!1&&(this.seenOnce=!0),void 0!==r)return r;if(this.seenOnce&&t.canEnd()){if(r=t.end())throw new Error("internal error; canEnd() returns true but end() fails");this._instantiateNextIteration();var n=this.nextIteration.fireEvent(e);return n===!1&&(this.currentIteration=this.nextIteration,this.nextIteration=void 0),n}},t.prototype._suppressAttributes=function(){this._instantiateCurrentIteration(),this.suppressedAttributes||(this.suppressedAttributes=!0,this.possibleCached=void 0,this.currentIteration._suppressAttributes(),void 0!==this.nextIteration&&this.nextIteration._suppressAttributes())},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),e?this.el.pat._hasAttrs()?(this._instantiateCurrentIteration(),this.currentIteration.canEnd(!0)):!0:this.seenOnce&&this.currentIteration.canEnd()},t.prototype.end=function(e){return void 0===e&&(e=!1),this.canEnd(e)?!1:(this._instantiateCurrentIteration(),this.currentIteration.end(e))},t.prototype._instantiateCurrentIteration=function(){void 0===this.currentIteration&&(this.currentIteration=this.el.pat.newWalker(this.nameResolver))},t.prototype._instantiateNextIteration=function(){void 0===this.nextIteration&&(this.nextIteration=this.el.pat.newWalker(this.nameResolver),this.suppressedAttributes&&this.nextIteration._suppressAttributes())},t}(i.Walker);i.addWalker(o,a)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(e){function t(t){e.call(this,t)||this;throw new Error("this pattern is a placeholder and should never actually be used")}return n(t,e),t}(i.Pattern);t.Param=o},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(6),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i.Pattern);t.Text=a;var s=function(e){function t(r,n){var a=this;if(r instanceof o.NotAllowedWalker){var s=r;n=i.isHashMap(n),a=e.call(this,s,n)||this}else a=e.call(this,r)||this,a.possibleCached=new i.EventSet(t._textEvent);return a}return n(t,e),t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){return"text"===e.params[0]?!1:void 0},t}(i.Walker);s._textEvent=new i.Event("text",/^.*$/),i.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),o=r(1),a=r(3),s=r(0),u=function(e){function t(t,r,n,o,a){void 0===n&&(n="token"),void 0===o&&(o=""),void 0===a&&(a="");var s=e.call(this,t)||this;if(s.type=n,s.datatypeLibrary=o,s.ns=a,s.datatype=i.registry.get(s.datatypeLibrary).types[s.type],void 0===s.datatype)throw new Error("unkown type: "+n);return s.rawValue=r,s}return n(t,e),Object.defineProperty(t.prototype,"value",{get:function(){var e=this._value;if(null!=e)return e;var t;if(this.datatype.needsContext){var r=new a.NameResolver;r.definePrefix("",this.ns),t={resolver:r}}return e=this._value=this.datatype.parseValue(this.rawValue,t)},enumerable:!0,configurable:!0}),t}(s.Pattern);t.Value=u;var l=function(e){function t(r,n){var i=this;if(r instanceof t){var o=r,a=s.isHashMap(n,"as 2nd argument");i=e.call(this,o,a)||this,i.nameResolver=i._cloneIfNeeded(o.nameResolver,a),i.context=void 0!==o.context?{resolver:i.nameResolver}:void 0,i.matched=o.matched}else{var u=r,l=s.isNameResolver(n,"as 2nd argument");i=e.call(this,u)||this,i.nameResolver=l,i.possibleCached=new s.EventSet(new s.Event("text",u.rawValue)),i.context=u.datatype.needsContext?{resolver:i.nameResolver}:void 0,i.matched=!1}return i}return n(t,e),t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){return!this.matched&&"text"===e.params[0]&&this.el.datatype.equal(e.params[1],this.el.value,this.context)?(this.matched=!0,this.possibleCached=new s.EventSet,!1):void 0},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this.matched||""===this.el.rawValue},t.prototype.end=function(e){return void 0===e&&(e=!1),this.canEnd(e)?!1:[new o.ValidationError("value required: "+this.el.rawValue)]},t.prototype._suppressAttributes=function(){},t}(s.Walker);s.addWalker(u,l)},function(e,t,r){function n(e){return void 0===e?"undefined":null===e?"null":e.toString()}Object.defineProperty(t,"__esModule",{value:!0}),t.inspect=n},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.version="4.1.2";var n=r(9);t.eventsToTreeString=n.eventsToTreeString,t.Event=n.Event,t.EventSet=n.EventSet,t.Grammar=n.Grammar,t.GrammarWalker=n.GrammarWalker,t.BasePattern=n.BasePattern,t.RefError=n.RefError,t.Walker=n.Walker,t.__test=n.__test;var i=r(14);t.constructTree=i.constructTree;var o=r(4);t.EName=o.EName;var a=r(1);t.AttributeNameError=a.AttributeNameError,t.AttributeValueError=a.AttributeValueError,t.ChoiceError=a.ChoiceError,t.ElementNameError=a.ElementNameError,t.ValidationError=a.ValidationError;var s=r(3);t.NameResolver=s.NameResolver;var u=r(2);t.BaseName=u.Base,t.Name=u.Name,t.NameChoice=u.NameChoice,t.NsName=u.NsName,t.AnyName=u.AnyName;var l=r(8);t.HashMap=l.HashMap},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function i(e){if(c===setTimeout)return setTimeout(e,0);if((c===r||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function o(e){if(h===clearTimeout)return clearTimeout(e);if((h===n||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function a(){m&&p&&(m=!1,p.length?f=p.concat(f):v=-1,f.length&&s())}function s(){if(!m){var e=i(a);m=!0;for(var t=f.length;t;){for(p=f,f=[];++v<t;)p&&p[v].run();v=-1,t=f.length}p=null,m=!1,o(e)}}function u(e,t){this.fun=e,this.array=t}function l(){}var c,h,d=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:r}catch(e){c=r}try{h="function"==typeof clearTimeout?clearTimeout:n}catch(e){h=n}}();var p,f=[],m=!1,v=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new u(e,t)),1!==f.length||m||i(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=function(e){"use strict";function t(e){var t=/^(?:\(\?:\))*\^/,r=/\$(?:\(\?:\))*$/;return t.test(e)&&r.test(e)&&r.test(e.replace(/\\[\s\S]/g,""))?e.replace(t,"").replace(r,""):e}function r(t){return e.isRegExp(t)?t[n]&&t[n].captureNames?t:e(t.source):e(t)}var n="xregexp",i=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,o=e.union([/\({{([\w$]+)}}\)|{{([\w$]+)}}/,i],"g");e.build=function(a,s,u){var l,c,h,d,p=/^\(\?([\w$]+)\)/.exec(a),f={},m=0,v=0,y=[0];p&&(u=u||"",p[1].replace(/./g,function(e){u+=u.indexOf(e)>-1?"":e}));for(d in s)s.hasOwnProperty(d)&&(h=r(s[d]),f[d]={pattern:t(h.source),names:h[n].captureNames||[]});return a=r(a),c=a[n].captureNames||[],a=a.source.replace(o,function(e,t,r,n,o){var a,s,u,h=t||r;if(h){if(!f.hasOwnProperty(h))throw new ReferenceError("Undefined property "+e);return t?(a=c[v],y[++v]=++m,s="(?<"+(a||h)+">"):s="(?:",l=m,s+f[h].pattern.replace(i,function(e,t,r){if(t){if(a=f[h].names[m-l],++m,a)return"(?<"+a+">"}else if(r)return u=+r-1,f[h].names[u]?"\\k<"+f[h].names[u]+">":"\\"+(+r+l);return e})+")"}if(n){if(a=c[v],y[++v]=++m,a)return"(?<"+a+">"}else if(o)return u=+o-1,c[u]?"\\k<"+c[u]+">":"\\"+y[+o];return e}),e(a,u)}}},function(e,t){e.exports=function(e){"use strict";function t(e,t,r,n){return{name:e,value:t,start:r,end:n}}e.matchRecursive=function(r,n,i,o,a){o=o||"",a=a||{};var s,u,l,c,h,d=o.indexOf("g")>-1,p=o.indexOf("y")>-1,f=o.replace(/y/g,""),m=a.escapeChar,v=a.valueNames,y=[],g=0,_=0,b=0,w=0;if(n=e(n,f),i=e(i,f),m){if(m.length>1)throw new Error("Cannot use more than one escape character");m=e.escape(m),h=new RegExp("(?:"+m+"[\\S\\s]|(?:(?!"+e.union([n,i]).source+")[^"+m+"])+)+",o.replace(/[^imu]+/g,""))}for(;;){if(m&&(b+=(e.exec(r,h,b,"sticky")||[""])[0].length),l=e.exec(r,n,b),c=e.exec(r,i,b),l&&c&&(l.index<=c.index?c=null:l=null),l||c)_=(l||c).index,b=_+(l||c)[0].length;else if(!g)break;if(p&&!g&&_>w)break;if(l)g||(s=_,u=b),++g;else{if(!c||!g)throw new Error("Unbalanced delimiter found in string");if(!--g&&(v?(v[0]&&s>w&&y.push(t(v[0],r.slice(w,s),w,s)),v[1]&&y.push(t(v[1],r.slice(s,u),s,u)),v[2]&&y.push(t(v[2],r.slice(u,_),u,_)),v[3]&&y.push(t(v[3],r.slice(_,b),_,b))):y.push(r.slice(u,_)),w=b,!d))break}_===b&&++b}return d&&!p&&v&&v[0]&&r.length>w&&y.push(t(v[0],r.slice(w),w,r.length)),y}}},function(e,t){e.exports=function(e){"use strict";function t(e){return e.replace(/[- _]+/g,"").toLowerCase()}function r(e){var t=/^\\[xu](.+)/.exec(e);return t?u(t[1]):e.charCodeAt("\\"===e.charAt(0)?1:0)}function n(t){var n="",i=-1;return e.forEach(t,/(\\x..|\\u....|\\?[\s\S])(?:-(\\x..|\\u....|\\?[\s\S]))?/,function(e){var t=r(e[1]);t>i+1&&(n+="\\u"+c(l(i+1)),t>i+2&&(n+="-\\u"+c(l(t-1)))),i=r(e[2]||e[1])}),65535>i&&(n+="\\u"+c(l(i+1)),65534>i&&(n+="-\\uFFFF")),n}function i(e){var t="b!";return s[e][t]||(s[e][t]=n(s[e].bmp))}function o(e,t){var r=s[e],n="";return r.bmp&&!r.isBmpLast&&(n="["+r.bmp+"]"+(r.astral?"|":"")),r.astral&&(n+=r.astral),r.isBmpLast&&r.bmp&&(n+=(r.astral?"|":"")+"["+r.bmp+"]"),t?"(?:(?!"+n+")(?:[-][-]|[\x00-]))":"(?:"+n+")"}function a(e,t){var r=t?"a!":"a=";return s[e][r]||(s[e][r]=o(e,t))}var s={},u=e._dec,l=e._hex,c=e._pad4;e.addToken(/\\([pP])(?:{(\^?)([^}]*)}|([A-Za-z]))/,function(e,r,n){var o="Invalid double negation ",u="Unknown Unicode token ",l="Unicode token missing data ",c="Astral mode required for Unicode token ",h="Astral mode does not support Unicode tokens within character classes",d="P"===e[1]||!!e[2],p=n.indexOf("A")>-1,f=t(e[4]||e[3]),m=s[f];if("P"===e[1]&&e[2])throw new SyntaxError(o+e[0]);if(!s.hasOwnProperty(f))throw new SyntaxError(u+e[0]);if(m.inverseOf){if(f=t(m.inverseOf),!s.hasOwnProperty(f))throw new ReferenceError(l+e[0]+" -> "+m.inverseOf);m=s[f],d=!d}if(!m.bmp&&!p)throw new SyntaxError(c+e[0]);if(p){if("class"===r)throw new SyntaxError(h);return a(f,d)}return"class"===r?d?i(f):m.bmp:(d?"[^":"[")+m.bmp+"]"},{scope:"all",optionalFlags:"A",leadChar:"\\"}),e.addUnicodeData=function(r){var n,i,o="Unicode token requires name",a="Unicode token has no character data ";for(i=0;i<r.length;++i){if(n=r[i],!n.name)throw new Error(o);if(!(n.inverseOf||n.bmp||n.astral))throw new Error(a+n.name);s[t(n.name)]=n,n.alias&&(s[t(n.alias)]=n)}e.cache.flush("patterns")}}},function(e,t){e.exports=function(e){"use strict";if(!e.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Blocks");e.addUnicodeData([{name:"InAegean_Numbers",astral:"[-]"},{name:"InAhom",astral:"[-]"},{name:"InAlchemical_Symbols",astral:"[-]"},{name:"InAlphabetic_Presentation_Forms",bmp:"-"},{name:"InAnatolian_Hieroglyphs",astral:"[-]"},{name:"InAncient_Greek_Musical_Notation",astral:"[-]"},{name:"InAncient_Greek_Numbers",astral:"[-]"},{name:"InAncient_Symbols",astral:"[-]"},{name:"InArabic",bmp:"-"},{name:"InArabic_Extended_A",bmp:"-"},{name:"InArabic_Mathematical_Alphabetic_Symbols",astral:"[-]"},{name:"InArabic_Presentation_Forms_A",bmp:"-"},{name:"InArabic_Presentation_Forms_B",bmp:"-\ufeff"},{name:"InArabic_Supplement",bmp:"-"},{name:"InArmenian",bmp:"-"},{name:"InArrows",bmp:"-"},{name:"InAvestan",astral:"[-]"},{name:"InBalinese",bmp:"-"},{name:"InBamum",bmp:"-"},{name:"InBamum_Supplement",astral:"[-]"},{name:"InBasic_Latin",bmp:"\x00-"},{name:"InBassa_Vah",astral:"[-]"},{name:"InBatak",bmp:"-"},{name:"InBengali",bmp:"-"},{name:"InBlock_Elements",bmp:"-"},{name:"InBopomofo",bmp:"-"},{name:"InBopomofo_Extended",bmp:"-"},{name:"InBox_Drawing",bmp:"-"},{name:"InBrahmi",astral:"[-]"},{name:"InBraille_Patterns",bmp:"-"},{name:"InBuginese",bmp:"-"},{name:"InBuhid",bmp:"-"},{name:"InByzantine_Musical_Symbols",astral:"[-]"},{name:"InCJK_Compatibility",bmp:"-"},{name:"InCJK_Compatibility_Forms",bmp:"-"},{name:"InCJK_Compatibility_Ideographs",bmp:"-"},{name:"InCJK_Compatibility_Ideographs_Supplement",astral:"[-]"},{name:"InCJK_Radicals_Supplement",bmp:"-"},{name:"InCJK_Strokes",bmp:"-"},{name:"InCJK_Symbols_and_Punctuation",bmp:"-"},{name:"InCJK_Unified_Ideographs",bmp:"-"},{name:"InCJK_Unified_Ideographs_Extension_A",bmp:"-"},{name:"InCJK_Unified_Ideographs_Extension_B",astral:"[-][-]|[-]"},{name:"InCJK_Unified_Ideographs_Extension_C",astral:"[-]|[-][-]|[-]"},{name:"InCJK_Unified_Ideographs_Extension_D",astral:"[-]|[-]"},{name:"InCJK_Unified_Ideographs_Extension_E",astral:"[-][-]|[-]|[-]"},{name:"InCarian",astral:"[-]"},{name:"InCaucasian_Albanian",astral:"[-]"},{name:"InChakma",astral:"[-]"},{name:"InCham",bmp:"-"},{name:"InCherokee",bmp:"-"},{name:"InCherokee_Supplement",bmp:"-"},{name:"InCombining_Diacritical_Marks",bmp:"-"},{name:"InCombining_Diacritical_Marks_Extended",bmp:"-"},{name:"InCombining_Diacritical_Marks_Supplement",bmp:"-"},{name:"InCombining_Diacritical_Marks_for_Symbols",bmp:"-"},{name:"InCombining_Half_Marks",bmp:"-"},{name:"InCommon_Indic_Number_Forms",bmp:"-"},{name:"InControl_Pictures",bmp:"-"},{name:"InCoptic",bmp:"-"},{name:"InCoptic_Epact_Numbers",astral:"[-]"},{name:"InCounting_Rod_Numerals",astral:"[-]"},{name:"InCuneiform",astral:"[-]"},{name:"InCuneiform_Numbers_and_Punctuation",astral:"[-]"},{name:"InCurrency_Symbols",bmp:"-"},{name:"InCypriot_Syllabary",astral:"[-]"},{name:"InCyrillic",bmp:"-"},{name:"InCyrillic_Extended_A",bmp:"-"},{name:"InCyrillic_Extended_B",bmp:"-"},{name:"InCyrillic_Supplement",bmp:"-"},{name:"InDeseret",astral:"[-]"},{name:"InDevanagari",bmp:"-"},{name:"InDevanagari_Extended",bmp:"-"},{name:"InDingbats",bmp:"-"},{name:"InDomino_Tiles",astral:"[-]"},{name:"InDuployan",astral:"[-]"},{name:"InEarly_Dynastic_Cuneiform",astral:"[-]"},{name:"InEgyptian_Hieroglyphs",astral:"[-]|[-]"},{name:"InElbasan",astral:"[-]"},{name:"InEmoticons",astral:"[-]"},{name:"InEnclosed_Alphanumeric_Supplement",astral:"[-]"},{name:"InEnclosed_Alphanumerics",bmp:"-"},{name:"InEnclosed_CJK_Letters_and_Months",bmp:"-"},{name:"InEnclosed_Ideographic_Supplement",astral:"[-]"},{name:"InEthiopic",bmp:"-"},{name:"InEthiopic_Extended",bmp:"-"},{name:"InEthiopic_Extended_A",bmp:"-"},{name:"InEthiopic_Supplement",bmp:"-"},{name:"InGeneral_Punctuation",bmp:"-"},{name:"InGeometric_Shapes",bmp:"-"},{name:"InGeometric_Shapes_Extended",astral:"[-]"},{name:"InGeorgian",bmp:"-"},{name:"InGeorgian_Supplement",bmp:"-"},{name:"InGlagolitic",bmp:"-"},{name:"InGothic",astral:"[-]"},{name:"InGrantha",astral:"[-]"},{name:"InGreek_Extended",bmp:"-"},{name:"InGreek_and_Coptic",bmp:"-"},{name:"InGujarati",bmp:"-"},{name:"InGurmukhi",bmp:"-"},{name:"InHalfwidth_and_Fullwidth_Forms",bmp:"-"},{name:"InHangul_Compatibility_Jamo",bmp:"-"},{name:"InHangul_Jamo",bmp:"-"},{name:"InHangul_Jamo_Extended_A",bmp:"-"},{name:"InHangul_Jamo_Extended_B",bmp:"-"},{name:"InHangul_Syllables",bmp:"-"},{name:"InHanunoo",bmp:"-"},{name:"InHatran",astral:"[-]"},{name:"InHebrew",bmp:"-"},{name:"InHigh_Private_Use_Surrogates",bmp:"-"},{name:"InHigh_Surrogates",bmp:"-"},{name:"InHiragana",bmp:"-"},{name:"InIPA_Extensions",bmp:"-"},{name:"InIdeographic_Description_Characters",bmp:"-"},{name:"InImperial_Aramaic",astral:"[-]"},{name:"InInscriptional_Pahlavi",astral:"[-]"},{name:"InInscriptional_Parthian",astral:"[-]"},{name:"InJavanese",bmp:"-"},{name:"InKaithi",astral:"[-]"},{name:"InKana_Supplement",astral:"[-]"},{name:"InKanbun",bmp:"-"},{name:"InKangxi_Radicals",bmp:"-"},{name:"InKannada",bmp:"-"},{name:"InKatakana",bmp:"-"},{name:"InKatakana_Phonetic_Extensions",bmp:"-"},{name:"InKayah_Li",bmp:"-"},{name:"InKharoshthi",astral:"[-]"},{name:"InKhmer",bmp:"-"},{name:"InKhmer_Symbols",bmp:"-"},{name:"InKhojki",astral:"[-]"},{name:"InKhudawadi",astral:"[-]"},{name:"InLao",bmp:"-"},{name:"InLatin_Extended_Additional",bmp:"-"},{name:"InLatin_Extended_A",bmp:"-"},{name:"InLatin_Extended_B",bmp:"-"},{name:"InLatin_Extended_C",bmp:"-"},{name:"InLatin_Extended_D",bmp:"-"},{name:"InLatin_Extended_E",bmp:"-"},{name:"InLatin_1_Supplement",bmp:"-"},{name:"InLepcha",bmp:"-"},{name:"InLetterlike_Symbols",bmp:"-"},{name:"InLimbu",bmp:"-"},{name:"InLinear_A",astral:"[-]"},{name:"InLinear_B_Ideograms",astral:"[-]"},{name:"InLinear_B_Syllabary",astral:"[-]"},{name:"InLisu",bmp:"-"},{name:"InLow_Surrogates",bmp:"-"},{name:"InLycian",astral:"[-]"},{name:"InLydian",astral:"[-]"},{name:"InMahajani",astral:"[-]"},{name:"InMahjong_Tiles",astral:"[-]"},{name:"InMalayalam",bmp:"-"},{name:"InMandaic",bmp:"-"},{name:"InManichaean",astral:"[-]"},{name:"InMathematical_Alphanumeric_Symbols",astral:"[-]"},{name:"InMathematical_Operators",bmp:"-"},{name:"InMeetei_Mayek",bmp:"-"},{name:"InMeetei_Mayek_Extensions",bmp:"-"},{name:"InMende_Kikakui",astral:"[-]"},{name:"InMeroitic_Cursive",astral:"[-]"},{name:"InMeroitic_Hieroglyphs",
astral:"[-]"},{name:"InMiao",astral:"[-]"},{name:"InMiscellaneous_Mathematical_Symbols_A",bmp:"-"},{name:"InMiscellaneous_Mathematical_Symbols_B",bmp:"-"},{name:"InMiscellaneous_Symbols",bmp:"-"},{name:"InMiscellaneous_Symbols_and_Arrows",bmp:"-"},{name:"InMiscellaneous_Symbols_and_Pictographs",astral:"[-]|[-]"},{name:"InMiscellaneous_Technical",bmp:"-"},{name:"InModi",astral:"[-]"},{name:"InModifier_Tone_Letters",bmp:"-"},{name:"InMongolian",bmp:"-"},{name:"InMro",astral:"[-]"},{name:"InMultani",astral:"[-]"},{name:"InMusical_Symbols",astral:"[-]"},{name:"InMyanmar",bmp:"-"},{name:"InMyanmar_Extended_A",bmp:"-"},{name:"InMyanmar_Extended_B",bmp:"-"},{name:"InNKo",bmp:"-"},{name:"InNabataean",astral:"[-]"},{name:"InNew_Tai_Lue",bmp:"-"},{name:"InNumber_Forms",bmp:"-"},{name:"InOgham",bmp:"-"},{name:"InOl_Chiki",bmp:"-"},{name:"InOld_Hungarian",astral:"[-]"},{name:"InOld_Italic",astral:"[-]"},{name:"InOld_North_Arabian",astral:"[-]"},{name:"InOld_Permic",astral:"[-]"},{name:"InOld_Persian",astral:"[-]"},{name:"InOld_South_Arabian",astral:"[-]"},{name:"InOld_Turkic",astral:"[-]"},{name:"InOptical_Character_Recognition",bmp:"-"},{name:"InOriya",bmp:"-"},{name:"InOrnamental_Dingbats",astral:"[-]"},{name:"InOsmanya",astral:"[-]"},{name:"InPahawh_Hmong",astral:"[-]"},{name:"InPalmyrene",astral:"[-]"},{name:"InPau_Cin_Hau",astral:"[-]"},{name:"InPhags_pa",bmp:"-"},{name:"InPhaistos_Disc",astral:"[-]"},{name:"InPhoenician",astral:"[-]"},{name:"InPhonetic_Extensions",bmp:"-"},{name:"InPhonetic_Extensions_Supplement",bmp:"-"},{name:"InPlaying_Cards",astral:"[-]"},{name:"InPrivate_Use_Area",bmp:"-"},{name:"InPsalter_Pahlavi",astral:"[-]"},{name:"InRejang",bmp:"-"},{name:"InRumi_Numeral_Symbols",astral:"[-]"},{name:"InRunic",bmp:"-"},{name:"InSamaritan",bmp:"-"},{name:"InSaurashtra",bmp:"-"},{name:"InSharada",astral:"[-]"},{name:"InShavian",astral:"[-]"},{name:"InShorthand_Format_Controls",astral:"[-]"},{name:"InSiddham",astral:"[-]"},{name:"InSinhala",bmp:"-"},{name:"InSinhala_Archaic_Numbers",astral:"[-]"},{name:"InSmall_Form_Variants",bmp:"-"},{name:"InSora_Sompeng",astral:"[-]"},{name:"InSpacing_Modifier_Letters",bmp:"-"},{name:"InSpecials",bmp:"-"},{name:"InSundanese",bmp:"-"},{name:"InSundanese_Supplement",bmp:"-"},{name:"InSuperscripts_and_Subscripts",bmp:"-"},{name:"InSupplemental_Arrows_A",bmp:"-"},{name:"InSupplemental_Arrows_B",bmp:"-"},{name:"InSupplemental_Arrows_C",astral:"[-]"},{name:"InSupplemental_Mathematical_Operators",bmp:"-"},{name:"InSupplemental_Punctuation",bmp:"-"},{name:"InSupplemental_Symbols_and_Pictographs",astral:"[-]"},{name:"InSupplementary_Private_Use_Area_A",astral:"[-][-]"},{name:"InSupplementary_Private_Use_Area_B",astral:"[-][-]"},{name:"InSutton_SignWriting",astral:"[-]"},{name:"InSyloti_Nagri",bmp:"-"},{name:"InSyriac",bmp:"-"},{name:"InTagalog",bmp:"-"},{name:"InTagbanwa",bmp:"-"},{name:"InTags",astral:"[-]"},{name:"InTai_Le",bmp:"-"},{name:"InTai_Tham",bmp:"-"},{name:"InTai_Viet",bmp:"-"},{name:"InTai_Xuan_Jing_Symbols",astral:"[-]"},{name:"InTakri",astral:"[-]"},{name:"InTamil",bmp:"-"},{name:"InTelugu",bmp:"-"},{name:"InThaana",bmp:"-"},{name:"InThai",bmp:"-"},{name:"InTibetan",bmp:"-"},{name:"InTifinagh",bmp:"-"},{name:"InTirhuta",astral:"[-]"},{name:"InTransport_and_Map_Symbols",astral:"[-]"},{name:"InUgaritic",astral:"[-]"},{name:"InUnified_Canadian_Aboriginal_Syllabics",bmp:"-"},{name:"InUnified_Canadian_Aboriginal_Syllabics_Extended",bmp:"-"},{name:"InVai",bmp:"-"},{name:"InVariation_Selectors",bmp:"-"},{name:"InVariation_Selectors_Supplement",astral:"[-]"},{name:"InVedic_Extensions",bmp:"-"},{name:"InVertical_Forms",bmp:"-"},{name:"InWarang_Citi",astral:"[-]"},{name:"InYi_Radicals",bmp:"-"},{name:"InYi_Syllables",bmp:"-"},{name:"InYijing_Hexagram_Symbols",bmp:"-"}])}},function(e,t){e.exports=function(e){"use strict";if(!e.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Categories");e.addUnicodeData([{name:"C",alias:"Other",isBmpLast:!0,bmp:"\x00---------------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[------]|[--]|[----------]|[-------]|[--]|[----]|[]|[-----]|[-------]|[----------------]|[-]|[------]|[-]|[--]|[----------------]|[-]|[-]|[-]|[--------][-]|[----]|[-----]|[-]|[-----------]|[---------------------]|[-]|[----]|[-]|[-]|[--------]|[-]"},{name:"Cc",alias:"Control",bmp:"\x00--"},{name:"Cf",alias:"Format",bmp:"-----\ufeff-",astral:"[-]|[-]|[-]|"},{name:"Cn",alias:"Unassigned",bmp:"---------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[---]|[-----]|[----------]|[-------]|[--]|[----]|[]|[-----]|[-------]|[----------------]|[-]|[------]|[][]|[-]|[----]|[-]|[-]|[-]|[--------][-]|[----]|[-----]|[-]|[--]|[-----------]|[---------------------]|[-]|[----------------]|[-]|[-]|[--------]|[-]"},{name:"Co",alias:"Private_Use",bmp:"-",astral:"[--][-]|[][-]"},{name:"Cs",alias:"Surrogate",bmp:"-"},{name:"L",alias:"Letter",bmp:"A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[--]|[--]|[--]|[---]|[-]|[------]|[---------------]|[-]|[-]|[--]|[---][-]|[------]|[-------]|[-]|[--------------------]|[-------------------------]|[-------------------]|[-]|[--------------]|[--]|[-]|[----]|[]|[-]"},{name:"Ll",alias:"Lowercase_Letter",bmp:"a-z------------------------------------------------",astral:"[-]|[--------------------------]|[-]|[-]"},{name:"Lm",alias:"Modifier_Letter",bmp:"------------",astral:"[-]|[-]"},{name:"Lo",alias:"Other_Letter",bmp:"-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[--]|[--]|[--]|[-]|[-]|[---------------]|[-]|[-]|[-]|[---][-]|[------]|[-]|[-]|[--------------------]|[-------------------]|[-]|[--------------]|[------]|[------]|[-]|[----]|[]|[-]"},{name:"Lt",alias:"Titlecase_Letter",bmp:"---"},{name:"Lu",alias:"Uppercase_Letter",bmp:"A-Z---------------------------------------",astral:"[-]|[-]|[-]|[-----------------------]"},{name:"M",alias:"Mark",bmp:"------------------------------------------------------------------------------------------------------------",astral:"[------]|[------]|[----------------]|[--]|[--]|[]|[-]|[----]|[---]|[-]|[-]"},{name:"Mc",alias:"Spacing_Mark",bmp:"-----------------------------",astral:"[-]|[------]|[-----]|[-]"},{name:"Me",alias:"Enclosing_Mark",bmp:"---"},{name:"Mn",alias:"Nonspacing_Mark",bmp:"-------------------------------------------------------------------------------",astral:"[-------]|[-----]|[--]|[-]|[]|[-]|[----]|[---]|[------------]|[-]|[-]"},{name:"N",alias:"Number",bmp:"0-9------------------------------------------------------------",astral:"[-----]|[-]|[--]|[-]|[-]|[---]|[-]|[------]|[-]|[-]|[-]|[-------------]|[----]"},{name:"Nd",alias:"Decimal_Number",bmp:"0-9------------------------------------",astral:"[-]|[-]|[----]|[-]|[-----]|[--]"},{name:"Nl",alias:"Letter_Number",bmp:"------",astral:"[-]|[--]"},{name:"No",alias:"Other_Number",bmp:"----------------------",astral:"[--]|[--]|[-]|[-]|[-]|[-------------]|[]|[-]|[-]|[----]"},{name:"P",alias:"Punctuation",bmp:"!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}-------------------------------------------------",astral:"[----]|[-]|[---]|[-]|||[------]|[-]|[-]"},{name:"Pc",alias:"Connector_Punctuation",bmp:"_-"},{name:"Pd",alias:"Dash_Punctuation",bmp:"\\x2D-"},{name:"Pe",alias:"Close_Punctuation",bmp:"\\x29\\x5D}"},{name:"Pf",alias:"Final_Punctuation",bmp:""},{name:"Pi",alias:"Initial_Punctuation",bmp:""},{name:"Po",alias:"Other_Punctuation",bmp:"!-#%-'\\x2A,\\x2E/:;\\x3F@\\x5C----------------------------------------------",astral:"[----]|[-]|[---]|[-]|||[------]|[-]|[-]"},{name:"Ps",alias:"Open_Punctuation",bmp:"\\x28\\x5B\\x7B"},{name:"S",alias:"Symbol",bmp:"\\x24\\x2B<->\\x5E`\\x7C~-------------------------------------------------------------------------",astral:"[-------]|[-------------]|[-------]|[]|[----]|||[]|[-]|[----]|[--------]|[]"},{name:"Sc",alias:"Currency_Symbol",bmp:"\\x24--"},{name:"Sk",alias:"Modifier_Symbol",bmp:"\\x5E`----------",astral:"[-]"},{name:"Sm",alias:"Math_Symbol",bmp:"\\x2B<->\\x7C~---------------------",astral:"[]|[]"},{name:"So",alias:"Other_Symbol",bmp:"-----------------------------------------------------------",astral:"[-------]|[-------]|[-------------]|[----]|||[]|[-]|[----]|[--------]"},{name:"Z",alias:"Separator",bmp:" -\u2028\u2029"},{name:"Zl",alias:"Line_Separator",bmp:"\u2028"},{name:"Zp",alias:"Paragraph_Separator",bmp:"\u2029"},{name:"Zs",alias:"Space_Separator",bmp:" -"}])}},function(e,t){e.exports=function(e){"use strict";if(!e.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Properties");var t=[{name:"ASCII",bmp:"\x00-"},{name:"Alphabetic",bmp:"A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[--]|[---------------------]|[--]|[--]|[---]|[-]|[-------]|[------]|[---]|[-]|[-]|[---][-]|[-------------------------]|[----]|[-]|[--------------]|[--------]|[--]|[--]|[----------------]|[---------------------]|[-]|[]|[---]|[-]"},{name:"Any",isBmpLast:!0,bmp:"\x00-",astral:"[-][-]"},{name:"Default_Ignorable_Code_Point",bmp:"-----\ufeff-",astral:"[-][-]|[-]|[-]"},{name:"Lowercase",bmp:"a-z----------------------------------------------------",astral:"[-]|[--------------------------]|[-]|[-]"},{name:"Noncharacter_Code_Point",bmp:"-",astral:"[][]"},{name:"Uppercase",bmp:"A-Z-----------------------------------------",astral:"[-]|[-]|[-----------------------]|[-]|[---]"},{name:"White_Space",bmp:"	-\r -\u2028\u2029"}];t.push({name:"Assigned",inverseOf:"Cn"}),e.addUnicodeData(t)}},function(e,t){e.exports=function(e){"use strict";if(!e.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Scripts");e.addUnicodeData([{name:"Ahom",astral:"[---]"},{name:"Anatolian_Hieroglyphs",astral:"[-]"},{name:"Arabic",bmp:"------------------",astral:"[-]|[--------------]"},{name:"Armenian",bmp:"-----"},{name:"Avestan",astral:"[--]"},{name:"Balinese",bmp:"--"},{name:"Bamum",bmp:"-",astral:"[-]"},{name:"Bassa_Vah",astral:"[--]"},{name:"Batak",bmp:"--"},{name:"Bengali",bmp:"---------"},{name:"Bopomofo",bmp:"--"},{name:"Brahmi",astral:"[--]"},{name:"Braille",bmp:"-"},{name:"Buginese",bmp:"-"},{name:"Buhid",bmp:"-"},{name:"Canadian_Aboriginal",bmp:"--"},{name:"Carian",astral:"[-]"},{name:"Caucasian_Albanian",astral:"[-]"},{name:"Chakma",astral:"[--]"},{name:"Cham",bmp:"----"},{name:"Cherokee",bmp:"---"},{name:"Common",bmp:"\x00-@\\x5B-`\\x7B---------------------------------------------------\ufeff------",astral:"[-------]|[-]|[----------------]|[-]|[-------]|[------]|[--------]|[--------------]"},{name:"Coptic",bmp:"---"},{name:"Cuneiform",astral:"[---]|[-]"},{name:"Cypriot",astral:"[--]"},{name:"Cyrillic",bmp:"----"},{name:"Deseret",astral:"[-]"},{name:"Devanagari",bmp:"----"},{name:"Duployan",astral:"[-----]"},{name:"Egyptian_Hieroglyphs",astral:"[-]|[-]"},{name:"Elbasan",astral:"[-]"},{name:"Ethiopic",bmp:"------------------------------"},{name:"Georgian",bmp:"----"},{name:"Glagolitic",bmp:"--"},{name:"Gothic",astral:"[-]"},{name:"Grantha",astral:"[----------]"},{name:"Greek",bmp:"-----------------------",astral:"[-]|[-]"},{name:"Gujarati",bmp:"-----------"},{name:"Gurmukhi",bmp:"--------"},{name:"Han",bmp:"---------",astral:"[--]|[---][-]|[--]|[-]|[--]|[-]"},{name:"Hangul",bmp:"-------------"},{name:"Hanunoo",bmp:"-"},{name:"Hatran",astral:"[--]"},{name:"Hebrew",bmp:"------"},{name:"Hiragana",bmp:"--",astral:"|"},{name:"Imperial_Aramaic",astral:"[--]"},{name:"Inherited",bmp:"------------",astral:"[----]|[]|[-]"},{name:"Inscriptional_Pahlavi",astral:"[--]"},{name:"Inscriptional_Parthian",astral:"[--]"},{name:"Javanese",bmp:"--"},{name:"Kaithi",astral:"[-]"},{name:"Kannada",bmp:"-----------"},{name:"Katakana",bmp:"-------",astral:""},{name:"Kayah_Li",bmp:"-"},{name:"Kharoshthi",astral:"[-------]"},{name:"Khmer",bmp:"----"},{name:"Khojki",astral:"[--]"},{name:"Khudawadi",astral:"[--]"},{name:"Lao",bmp:"---------"},{name:"Latin",bmp:"A-Za-z----------------------"},{name:"Lepcha",bmp:"---"},{name:"Limbu",bmp:"----"},{name:"Linear_A",astral:"[---]"},{name:"Linear_B",astral:"[------]"},{name:"Lisu",bmp:"-"},{name:"Lycian",astral:"[-]"},{name:"Lydian",astral:"[-]"},{name:"Mahajani",astral:"[-]"},{name:"Malayalam",bmp:"----------"},{name:"Mandaic",bmp:"-"},{name:"Manichaean",astral:"[--]"},{name:"Meetei_Mayek",bmp:"---"},{name:"Mende_Kikakui",astral:"[--]"},{name:"Meroitic_Cursive",astral:"[---]"},{name:"Meroitic_Hieroglyphs",astral:"[-]"},{name:"Miao",astral:"[---]"},{name:"Modi",astral:"[--]"},{name:"Mongolian",bmp:"----"},{name:"Mro",astral:"[--]"},{name:"Multani",astral:"[----]"},{name:"Myanmar",bmp:"---"},{name:"Nabataean",astral:"[--]"},{name:"New_Tai_Lue",bmp:"---"},{name:"Nko",bmp:"-"},{name:"Ogham",bmp:"-"},{name:"Ol_Chiki",bmp:"-"},{name:"Old_Hungarian",astral:"[---]"},{name:"Old_Italic",astral:"[-]"},{name:"Old_North_Arabian",astral:"[-]"},{name:"Old_Permic",astral:"[-]"},{name:"Old_Persian",astral:"[--]"},{name:"Old_South_Arabian",astral:"[-]"},{name:"Old_Turkic",astral:"[-]"},{name:"Oriya",bmp:"---------"},{name:"Osmanya",astral:"[--]"},{name:"Pahawh_Hmong",astral:"[-----]"},{name:"Palmyrene",astral:"[-]"},{name:"Pau_Cin_Hau",astral:"[-]"},{name:"Phags_Pa",bmp:"-"},{name:"Phoenician",astral:"[-]"},{name:"Psalter_Pahlavi",astral:"[---]"},{name:"Rejang",bmp:"-"},{name:"Runic",bmp:"--"},{name:"Samaritan",bmp:"--"},{name:"Saurashtra",bmp:"--"},{name:"Sharada",astral:"[--]"},{name:"Shavian",astral:"[-]"},{name:"Siddham",astral:"[--]"},{name:"SignWriting",astral:"[---]"},{name:"Sinhala",bmp:"--------",astral:"[-]"},{name:"Sora_Sompeng",astral:"[--]"},{name:"Sundanese",bmp:"--"},{name:"Syloti_Nagri",bmp:"-"},{name:"Syriac",bmp:"---"},{name:"Tagalog",bmp:"--"},{name:"Tagbanwa",bmp:"--"},{name:"Tai_Le",bmp:"--"},{name:"Tai_Tham",bmp:"-----"},{name:"Tai_Viet",bmp:"--"},{name:"Takri",astral:"[--]"},{name:"Tamil",bmp:"---------"},{name:"Telugu",bmp:"------------"},{name:"Thaana",bmp:"-"},{name:"Thai",bmp:"--"},{name:"Tibetan",bmp:"------"},{name:"Tifinagh",bmp:"-"},{name:"Tirhuta",astral:"[--]"},{name:"Ugaritic",astral:"[-]"},{name:"Vai",bmp:"-"},{name:"Warang_Citi",astral:"[-]"},{name:"Yi",bmp:"--"}])}},function(e,t,r){var n=r(42);r(34)(n),r(35)(n),r(36)(n),r(37)(n),r(38)(n),r(39)(n),r(40)(n),e.exports=n},function(e,t,r){function n(e){var t=!0;try{new RegExp("",e)}catch(r){t=!1}return t&&"y"===e?new RegExp("aa|.","y").test("b"):t}function i(e,t,r,n,i){var o;if(e[x]={captureNames:t},i)return e;if(e.__proto__)e.__proto__=E.prototype;else for(o in E.prototype)e[o]=E.prototype[o];return e[x].source=r,e[x].flags=n?n.split("").sort().join(""):n,e}function o(e){return S.replace.call(e,/([\s\S])(?=[\s\S]*\1)/g,"")}function a(e,t){if(!E.isRegExp(e))throw new TypeError("Type RegExp expected");var r=e[x]||{},n=u(e),a="",s="",c=null,h=null;return t=t||{},t.removeG&&(s+="g"),t.removeY&&(s+="y"),s&&(n=S.replace.call(n,new RegExp("["+s+"]+","g"),"")),t.addG&&(a+="g"),t.addY&&(a+="y"),a&&(n=o(n+a)),t.isInternalOnly||(void 0!==r.source&&(c=r.source),null!=r.flags&&(h=a?o(r.flags+a):r.flags)),e=i(new RegExp(e.source,n),l(e)?r.captureNames.slice(0):null,c,h,t.isInternalOnly)}function s(e){return parseInt(e,16)}function u(e){return D?e.flags:S.exec.call(/\/([a-z]*)$/i,RegExp.prototype.toString.call(e))[1]}function l(e){return!(!e[x]||!e[x].captureNames)}function c(e){return parseInt(e,10).toString(16)}function h(e,t){var r,n=e.length;for(r=0;n>r;++r)if(e[r]===t)return r;return-1}function d(e,t){return M.call(e)==="[object "+t+"]"}function p(e,t,r){return S.test.call(r.indexOf("x")>-1?/^(?:\s|#[^#\n]*|\(\?#[^)]*\))*(?:[?*+]|{\d+(?:,\d*)?})/:/^(?:\(\?#[^)]*\))*(?:[?*+]|{\d+(?:,\d*)?})/,e.slice(t))}function f(e){for(;e.length<4;)e="0"+e;return e}function m(e,t){var r;if(o(t)!==t)throw new SyntaxError("Invalid duplicate regex flag "+t);for(e=S.replace.call(e,/^\(\?([\w$]+)\)/,function(e,r){if(S.test.call(/[gy]/,r))throw new SyntaxError("Cannot use flag g or y in mode modifier "+e);return t=o(t+r),""}),r=0;r<t.length;++r)if(!V[t.charAt(r)])throw new SyntaxError("Unknown regex flag "+t.charAt(r));return{pattern:e,flags:t}}function v(e){var t={};return d(e,"String")?(E.forEach(e,/[^\s,]+/,function(e){t[e]=!0}),t):e}function y(e){if(!/^[\w$]$/.test(e))throw new Error("Flag must be a single character A-Za-z0-9_$");V[e]=!0}function g(e,t,r,n,i){for(var o,a,s=k.length,u=e.charAt(r),l=null;s--;)if(a=k[s],!(a.leadChar&&a.leadChar!==u||a.scope!==n&&"all"!==a.scope||a.flag&&-1===t.indexOf(a.flag))&&(o=E.exec(e,a.regex,r,"sticky"))){l={matchLength:o[0].length,output:a.handler.call(i,o,n,t),reparse:a.reparse};break}return l}function _(e){N.astral=e}function b(e){RegExp.prototype.exec=(e?C:S).exec,RegExp.prototype.test=(e?C:S).test,String.prototype.match=(e?C:S).match,String.prototype.replace=(e?C:S).replace,String.prototype.split=(e?C:S).split,N.natives=e}function w(e){if(null==e)throw new TypeError("Cannot convert null or undefined to object");return e}function E(e,t){if(E.isRegExp(e)){if(void 0!==t)throw new TypeError("Cannot supply flags when copying a RegExp");return a(e)}if(e=void 0===e?"":String(e),t=void 0===t?"":String(t),E.isInstalled("astral")&&-1===t.indexOf("A")&&(t+="A"),P[e]||(P[e]={}),!P[e][t]){for(var r,n={hasNamedCapture:!1,captureNames:[]},o=A,s="",u=0,l=m(e,t),c=l.pattern,h=l.flags;u<c.length;){do r=g(c,h,u,o,n),r&&r.reparse&&(c=c.slice(0,u)+r.output+c.slice(u+r.matchLength));while(r&&r.reparse);if(r)s+=r.output,u+=r.matchLength||1;else{var d=E.exec(c,I[o],u,"sticky")[0];s+=d,u+=d.length,"["===d&&o===A?o=O:"]"===d&&o===O&&(o=A)}}P[e][t]={pattern:S.replace.call(s,/(?:\(\?:\))+/g,"(?:)"),flags:S.replace.call(h,/[^gimuy]+/g,""),captures:n.hasNamedCapture?n.captureNames:null}}var p=P[e][t];return i(new RegExp(p.pattern,p.flags),p.captures,e,t)}var x="xregexp",N={astral:!1,natives:!1},S={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},C={},T={},P={},k=[],A="default",O="class",I={
"default":/\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9]\d*|x[\dA-Fa-f]{2}|u(?:[\dA-Fa-f]{4}|{[\dA-Fa-f]+})|c[A-Za-z]|[\s\S])|\(\?(?:[:=!]|<[=!])|[?*+]\?|{\d+(?:,\d*)?}\??|[\s\S]/,"class":/\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[\dA-Fa-f]{2}|u(?:[\dA-Fa-f]{4}|{[\dA-Fa-f]+})|c[A-Za-z]|[\s\S])|[\s\S]/},R=/\$(?:{([\w$]+)}|(\d\d?|[\s\S]))/g,j=void 0===S.exec.call(/()??/,"")[1],D=void 0!==/x/.flags,M={}.toString,L=n("u"),F=n("y"),V={g:!0,i:!0,m:!0,u:L,y:F};E.prototype=new RegExp,E.version="3.1.1",E._hasNativeFlag=n,E._dec=s,E._hex=c,E._pad4=f,E.addToken=function(e,t,r){r=r||{};var n,i=r.optionalFlags;if(r.flag&&y(r.flag),i)for(i=S.split.call(i,""),n=0;n<i.length;++n)y(i[n]);k.push({regex:a(e,{addG:!0,addY:F,isInternalOnly:!0}),handler:t,scope:r.scope||A,flag:r.flag,reparse:r.reparse,leadChar:r.leadChar}),E.cache.flush("patterns")},E.cache=function(e,t){return T[e]||(T[e]={}),T[e][t]||(T[e][t]=E(e,t))},E.cache.flush=function(e){"patterns"===e?P={}:T={}},E.escape=function(e){return S.replace.call(w(e),/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},E.exec=function(e,t,r,n){var i,o,s="g",u=!1;return u=F&&!!(n||t.sticky&&n!==!1),u&&(s+="y"),t[x]=t[x]||{},o=t[x][s]||(t[x][s]=a(t,{addG:!0,addY:u,removeY:n===!1,isInternalOnly:!0})),o.lastIndex=r=r||0,i=C.exec.call(o,e),n&&i&&i.index!==r&&(i=null),t.global&&(t.lastIndex=i?o.lastIndex:0),i},E.forEach=function(e,t,r){for(var n,i=0,o=-1;n=E.exec(e,t,i);)r(n,++o,e,t),i=n.index+(n[0].length||1)},E.globalize=function(e){return a(e,{addG:!0})},E.install=function(e){e=v(e),!N.astral&&e.astral&&_(!0),!N.natives&&e.natives&&b(!0)},E.isInstalled=function(e){return!!N[e]},E.isRegExp=function(e){return"[object RegExp]"===M.call(e)},E.match=function(e,t,r){var n,i,o=t.global&&"one"!==r||"all"===r,s=(o?"g":"")+(t.sticky?"y":"")||"noGY";return t[x]=t[x]||{},i=t[x][s]||(t[x][s]=a(t,{addG:!!o,removeG:"one"===r,isInternalOnly:!0})),n=S.match.call(w(e),i),t.global&&(t.lastIndex="one"===r&&n?n.index+n[0].length:0),o?n||[]:n&&n[0]},E.matchChain=function(e,t){return function r(e,n){function i(e){if(o.backref){if(!(e.hasOwnProperty(o.backref)||+o.backref<e.length))throw new ReferenceError("Backreference to undefined group: "+o.backref);a.push(e[o.backref]||"")}else a.push(e[0])}for(var o=t[n].regex?t[n]:{regex:t[n]},a=[],s=0;s<e.length;++s)E.forEach(e[s],o.regex,i);return n!==t.length-1&&a.length?r(a,n+1):a}([e],0)},E.replace=function(e,t,r,n){var i,o=E.isRegExp(t),s=t.global&&"one"!==n||"all"===n,u=(s?"g":"")+(t.sticky?"y":"")||"noGY",l=t;return o?(t[x]=t[x]||{},l=t[x][u]||(t[x][u]=a(t,{addG:!!s,removeG:"one"===n,isInternalOnly:!0}))):s&&(l=new RegExp(E.escape(String(t)),"g")),i=C.replace.call(w(e),l,r),o&&t.global&&(t.lastIndex=0),i},E.replaceEach=function(e,t){var r,n;for(r=0;r<t.length;++r)n=t[r],e=E.replace(e,n[0],n[1],n[2]);return e},E.split=function(e,t,r){return C.split.call(w(e),t,r)},E.test=function(e,t,r,n){return!!E.exec(e,t,r,n)},E.uninstall=function(e){e=v(e),N.astral&&e.astral&&_(!1),N.natives&&e.natives&&b(!1)},E.union=function(e,t){function r(e,t,r){var a=i[o-n];if(t){if(++o,a)return"(?<"+a+">"}else if(r)return"\\"+(+r+n);return e}var n,i,o=0;if(!d(e,"Array")||!e.length)throw new TypeError("Must provide a nonempty array of patterns to merge");for(var a,s=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,u=[],l=0;l<e.length;++l)a=e[l],E.isRegExp(a)?(n=o,i=a[x]&&a[x].captureNames||[],u.push(S.replace.call(E(a.source).source,s,r))):u.push(E.escape(a));return E(u.join("|"),t)},C.exec=function(e){var t,r,n,i=this.lastIndex,o=S.exec.apply(this,arguments);if(o){if(!j&&o.length>1&&h(o,"")>-1&&(r=a(this,{removeG:!0,isInternalOnly:!0}),S.replace.call(String(e).slice(o.index),r,function(){var e,t=arguments.length;for(e=1;t-2>e;++e)void 0===arguments[e]&&(o[e]=void 0)})),this[x]&&this[x].captureNames)for(n=1;n<o.length;++n)t=this[x].captureNames[n-1],t&&(o[t]=o[n]);this.global&&!o[0].length&&this.lastIndex>o.index&&(this.lastIndex=o.index)}return this.global||(this.lastIndex=i),o},C.test=function(e){return!!C.exec.call(this,e)},C.match=function(e){var t;if(E.isRegExp(e)){if(e.global)return t=S.match.apply(this,arguments),e.lastIndex=0,t}else e=new RegExp(e);return C.exec.call(e,w(this))},C.replace=function(e,t){var r,n,i,o=E.isRegExp(e);return o?(e[x]&&(n=e[x].captureNames),r=e.lastIndex):e+="",i=d(t,"Function")?S.replace.call(String(this),e,function(){var r,i=arguments;if(n)for(i[0]=new String(i[0]),r=0;r<n.length;++r)n[r]&&(i[0][n[r]]=i[r+1]);return o&&e.global&&(e.lastIndex=i[i.length-2]+i[0].length),t.apply(void 0,i)}):S.replace.call(null==this?this:String(this),e,function(){var e=arguments;return S.replace.call(String(t),R,function(t,r,i){var o;if(r){if(o=+r,o<=e.length-3)return e[o]||"";if(o=n?h(n,r):-1,0>o)throw new SyntaxError("Backreference to undefined group "+t);return e[o+1]||""}if("$"===i)return"$";if("&"===i||0===+i)return e[0];if("`"===i)return e[e.length-1].slice(0,e[e.length-2]);if("'"===i)return e[e.length-1].slice(e[e.length-2]+e[0].length);if(i=+i,!isNaN(i)){if(i>e.length-3)throw new SyntaxError("Backreference to undefined group "+t);return e[i]||""}throw new SyntaxError("Invalid token "+t)})}),o&&(e.global?e.lastIndex=0:e.lastIndex=r),i},C.split=function(e,t){if(!E.isRegExp(e))return S.split.apply(this,arguments);var r,n=String(this),i=[],o=e.lastIndex,a=0;return t=(void 0===t?-1:t)>>>0,E.forEach(n,e,function(e){e.index+e[0].length>a&&(i.push(n.slice(a,e.index)),e.length>1&&e.index<n.length&&Array.prototype.push.apply(i,e.slice(1)),r=e[0].length,a=e.index+r)}),a===n.length?(!S.test.call(e,"")||r)&&i.push(""):i.push(n.slice(a)),e.lastIndex=o,i.length>t?i.slice(0,t):i},E.addToken(/\\([ABCE-RTUVXYZaeg-mopqyz]|c(?![A-Za-z])|u(?![\dA-Fa-f]{4}|{[\dA-Fa-f]+})|x(?![\dA-Fa-f]{2}))/,function(e,t){if("B"===e[1]&&t===A)return e[0];throw new SyntaxError("Invalid escape "+e[0])},{scope:"all",leadChar:"\\"}),E.addToken(/\\u{([\dA-Fa-f]+)}/,function(e,t,r){var n=s(e[1]);if(n>1114111)throw new SyntaxError("Invalid Unicode code point "+e[0]);if(65535>=n)return"\\u"+f(c(n));if(L&&r.indexOf("u")>-1)return e[0];throw new SyntaxError("Cannot use Unicode code point above \\u{FFFF} without flag u")},{scope:"all",leadChar:"\\"}),E.addToken(/\[(\^?)]/,function(e){return e[1]?"[\\s\\S]":"\\b\\B"},{leadChar:"["}),E.addToken(/\(\?#[^)]*\)/,function(e,t,r){return p(e.input,e.index+e[0].length,r)?"":"(?:)"},{leadChar:"("}),E.addToken(/\s+|#[^\n]*\n?/,function(e,t,r){return p(e.input,e.index+e[0].length,r)?"":"(?:)"},{flag:"x"}),E.addToken(/\./,function(){return"[\\s\\S]"},{flag:"s",leadChar:"."}),E.addToken(/\\k<([\w$]+)>/,function(e){var t=isNaN(e[1])?h(this.captureNames,e[1])+1:+e[1],r=e.index+e[0].length;if(!t||t>this.captureNames.length)throw new SyntaxError("Backreference to undefined group "+e[0]);return"\\"+t+(r===e.input.length||isNaN(e.input.charAt(r))?"":"(?:)")},{leadChar:"\\"}),E.addToken(/\\(\d+)/,function(e,t){if(!(t===A&&/^[1-9]/.test(e[1])&&+e[1]<=this.captureNames.length)&&"0"!==e[1])throw new SyntaxError("Cannot use octal escape or backreference to undefined group "+e[0]);return e[0]},{scope:"all",leadChar:"\\"}),E.addToken(/\(\?P?<([\w$]+)>/,function(e){if(!isNaN(e[1]))throw new SyntaxError("Cannot use integer as capture name "+e[0]);if("length"===e[1]||"__proto__"===e[1])throw new SyntaxError("Cannot use reserved word as capture name "+e[0]);if(h(this.captureNames,e[1])>-1)throw new SyntaxError("Cannot use same name for multiple groups "+e[0]);return this.captureNames.push(e[1]),this.hasNamedCapture=!0,"("},{leadChar:"("}),E.addToken(/\((?!\?)/,function(e,t,r){return r.indexOf("n")>-1?"(?:":(this.captureNames.push(null),"(")},{optionalFlags:"n",leadChar:"("}),e.exports=E}])}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("salve")):"function"==typeof define&&define.amd?define("salve-dom",["salve"],t):"object"==typeof exports?exports["salve-dom"]=t(require("salve")):e["salve-dom"]=t(e.salve)}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._eventListeners=Object.create(null),this._generalListeners=[],this._trace=!1}return e.prototype.addEventListener=function(e,t){if("*"===e)this._generalListeners.push(t);else{var r=this._eventListeners[e];void 0===r&&(r=this._eventListeners[e]=[]),r.push(t)}},e.prototype.addOneTimeEventListener=function(e,t){var r=this,n=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return r.removeEventListener(e,n),t.apply(r,i)};return this.addEventListener(e,n),n},e.prototype.removeEventListener=function(e,t){var r="*"===e?this._generalListeners:this._eventListeners[e];if(void 0!==r){var n=r.lastIndexOf(t);-1!==n&&r.splice(n,1)}},e.prototype.removeAllListeners=function(e){"*"===e?this._generalListeners=[]:this._eventListeners[e]=[]},e.prototype._emit=function(e,t){this._trace&&console.log("simple_event_emitter emitting:",e,"with:",t);var r=this._generalListeners;if(r.length>0){r=r.slice();for(var n=0,i=r;n<i.length;n++){var o=i[n],a=o.call(void 0,e,t);if(a===!1)return}}var r=this._eventListeners[e];if(void 0!==r&&r.length>0){r=r.slice();for(var s=0,u=r;s<u.length;s++){var o=u[s],a=o.call(void 0,t);if(a===!1)return}}},e}();t.EventEmitter=n},function(e,t,r){function n(e,t){var r=void 0!==Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__;r!==t&&(void 0!==Object.setPrototypeOf?Object.setPrototypeOf(e,t.prototype):e.__proto__=t.prototype)}Object.defineProperty(t,"__esModule",{value:!0}),t.fixPrototype=n},function(t,r){t.exports=e},function(e,t,r){function n(e,t){return Array.prototype.indexOf.call(e,t)}function i(e){var t=Node.ATTRIBUTE_NODE;return e instanceof Attr||void 0!==t&&e.nodeType===t}function o(e,t,r,n){for(var i=e.possible().toArray(),o=!1,a=0,s=i;a<s.length;a++){var u=s[a];if(u.params[0]===t){var l=u.params[1],c=l.match(r,n);if(o=o||c,c&&!l.wildcardMatch(r,n))return!1}}return o}var a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=r(2),u=r(0),l=r(1);t.isAttr=i;var c;!function(e){e[e.START_TAG=1]="START_TAG",e[e.CONTENTS=2]="CONTENTS",e[e.END_TAG=3]="END_TAG"}(c||(c={}));var h;!function(e){e[e.INCOMPLETE=1]="INCOMPLETE",e[e.WORKING=2]="WORKING",e[e.INVALID=3]="INVALID",e[e.VALID=4]="VALID"}(h=t.WorkingState||(t.WorkingState={}));var d=function(){function e(e,t){this.partDone=e,this.portion=t}return e}(),p=new s.Event("enterContext"),f=new s.Event("leaveStartTag"),m=new s.Event("leaveContext"),v=function(e){function t(){var r=e.call(this,"undefined event_index; _validateUpTo should have taken care of that")||this;return l.fixPrototype(r,t),r}return a(t,e),t}(Error),y=function(){function e(e,t,r){void 0===r&&(r={}),this.schema=e,this.root=t,this._cycleEntered=0,this._timeout=200,this._maxTimespan=100,this._resetting=!1,this._errors=[],this._boundWrapper=this._workWrapper.bind(this),this._validationEvents=[],this._workingState=h.INCOMPLETE,this._partDone=0,this._validationStage=c.CONTENTS,this._previousChild=null,this._validationStack=[new d(0,1)],this._walkerCache=Object.create(null),this._walkerCacheMax=-1,this._prefix="salveDom",this._walkerCacheGap=100,this._events=new u.EventEmitter;for(var n=["timeout","maxTimespan","walkerCacheGap"],i=0,o=n;i<o.length;i++){var a=o[i],s=r[a];if(void 0!==s){if(0>s)throw new Error("the value for "+a+" cannot be negative");this["_"+a]=r[a]}}void 0!==r.prefix&&(this._prefix=r.prefix),this._curEl=this.root,this._setNodeProperty(this._curEl,"EventIndexAfterStart",this._validationEvents.length),this._setWorkingState(h.INCOMPLETE,0),this._validationWalker=this.schema.newWalker(),this.events=this._events}return e.prototype.makeKey=function(e){return""+this._prefix+e},e.prototype.getNodeProperty=function(e,t){return e[this.makeKey(t)]},e.prototype._setNodeProperty=function(e,t,r){e[this.makeKey(t)]=r},e.prototype._clearNodeProperties=function(e){for(var t=["EventIndexAfter","EventIndexAfterStart","EventIndexBeforeAttributes","EventIndexAfterAttributes","PossibleDueToWildcard"],r=0,n=t;r<n.length;r++){var i=n[r];delete e[this.makeKey(i)]}},e.prototype.start=function(){void 0!==this._timeoutId&&this._stop(h.WORKING),this._timeoutId=setTimeout(this._boundWrapper,0)},e.prototype.getSchemaNamespaces=function(){return this.schema.getNamespaces()},e.prototype.getDocumentNamespaces=function(){function e(r){if(null!==r){for(var n=r.attributes.length,i=0;n>i;++i){var o=r.attributes[i];if(0===o.name.lastIndexOf("xmlns",0)){var a=o.name.slice(6),s=t[a];void 0===s&&(s=t[a]=[]),s.push(o.value)}}for(var u=r.firstChild;null!==u;)u.nodeType===Node.ELEMENT_NODE&&e(u),u=u.nextSibling}}var t={};return e(this.root.firstChild),t},e.prototype._workWrapper=function(){this._work()&&(this._timeoutId=setTimeout(this._boundWrapper,this._timeout))},e.prototype._work=function(){for(var e=Date.now();;){if(this._maxTimespan>0&&Date.now()-e>=this._maxTimespan)return!0;var t=this._cycle();if(!t)return!1}},e.prototype._cycle=function(){var e=this;if(this._resetting=!1,this._cycleEntered>0)throw new Error("internal error: _cycle is being reentered");if(this._cycleEntered<0)throw new Error("internal error: _cycleEntered negative");this._cycleEntered++;var t=this._validationWalker,r=this._validationStack,i=this._validationEvents,o=r[0].portion,a=this._validationStage,u=function(){var u=l._curEl;switch(a){case c.START_TAG:u=u,r.unshift(new d(l._partDone,o)),l._fireAndProcessEvent(t,p,u,0);for(var v=u.attributes.length,y=0;v>y;++y){var g=u.attributes[y];"xmlns"===g.name?l._fireAndProcessEvent(t,new s.Event("definePrefix","",g.value),u,0):0===g.name.lastIndexOf("xmlns:",0)&&l._fireAndProcessEvent(t,new s.Event("definePrefix",g.name.slice(6),g.value),u,0)}var _=u.tagName,b=u.parentNode,w=n(b.childNodes,u),E=t.resolveName(_,!1);return void 0===E&&(l._processEventResult([new s.ValidationError("cannot resolve the name "+_)],b,w),E=new s.EName("",_)),l._setPossibleDueToWildcard(u,t,"enterStartTag",E.ns,E.name),l._fireAndProcessEvent(t,new s.Event("enterStartTag",E.ns,E.name),b,w),l._setNodeProperty(u,"EventIndexBeforeAttributes",i.length),l._fireAttributeEvents(t,u),l._setNodeProperty(u,"EventIndexAfterAttributes",i.length),l._fireAndProcessEvent(t,f,u,0),a=l._validationStage=c.CONTENTS,l._setNodeProperty(u,"EventIndexAfterStart",i.length),l._cycleEntered--,{value:!0};case c.CONTENTS:for(var x,N=null===l._previousChild?u.firstChild:l._previousChild.nextSibling,S=[],C=function(){if(0!==S.length){var r=new s.Event("text",S.join("")),i=t.fireEvent(r);if(i instanceof Array){if(void 0===x)throw new Error("flushText running with undefined node");var o=x.parentNode;e._processEventResult(i,o,n(o.childNodes,x))}}S=[],x=void 0};null!==N;){switch(N.nodeType){case Node.TEXT_NODE:S.push(N.data),void 0===x&&(x=N);break;case Node.ELEMENT_NODE:return C(),o/=u.childElementCount,l._curEl=u=N,a=l._validationStage=c.START_TAG,l._previousChild=null,"continue-stage_change";case Node.COMMENT_NODE:break;default:throw new Error("unexpected node type: "+N.nodeType)}N=N.nextSibling}C(),a=l._validationStage=c.END_TAG;break;case c.END_TAG:if(u===l.root){var T=t.end();return T instanceof Array&&l._processEventResult(T,u,u.childNodes.length),l._runDocumentValidation(),l._setNodeProperty(u,"EventIndexAfter",i.length),l._partDone=1,l._stop(l._errors.length>0?h.INVALID:h.VALID),l._cycleEntered--,{value:!1}}var P=u,_=u.tagName,E=t.resolveName(_,!1);void 0===E&&(E=new s.EName("",_)),l._fireAndProcessEvent(t,new s.Event("endTag",E.ns,E.name),u,u.childNodes.length),l._fireAndProcessEvent(t,m,u,u.childNodes.length),l._previousChild=u,l._curEl=u=u.parentNode;var k=l._partDone;if(u!==l.root){r.shift();var A=r[0];k=A.partDone+=o,o=A.portion}return l._setWorkingState(h.WORKING,k),l._setNodeProperty(P,"EventIndexAfter",l._validationEvents.length),a=l._validationStage=c.CONTENTS,l._cycleEntered--,{value:!0};default:throw new Error("unexpected state")}},l=this;e:for(;;){var v=u();if("object"==typeof v)return v.value;switch(v){case"continue-stage_change":continue e}}},e.prototype.stop=function(){this._stop()},e.prototype._stop=function(e){void 0!==this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0,void 0===e?this._workingState===h.WORKING&&this._setWorkingState(h.INCOMPLETE,this._partDone):this._setWorkingState(e,this._partDone)},e.prototype._runDocumentValidation=function(){},e.prototype.restartAt=function(e){this.resetTo(e),this.start()},e.prototype.resetTo=function(e){this._resetting||(this._resetting=!0,this._resetTo(e))},e.prototype._erase=function(e){this._clearNodeProperties(e);for(var t=e.firstElementChild;null!==t;)this._erase(t),t=t.nextElementSibling},e.prototype._resetTo=function(e){this._erase(this.root),this._validationStage=c.CONTENTS,this._previousChild=null,this._validationWalker=this.schema.newWalker(),this._validationEvents=[],this._curEl=this.root,this._partDone=0,this._errors=[],this._walkerCache=Object.create(null),this._walkerCacheMax=-1,this._events._emit("reset-errors",{at:0})},e.prototype._setWorkingState=function(e,t){var r=!1;this._workingState!==e&&(this._workingState=e,r=!0),this._partDone!==t&&(this._partDone=t,r=!0),r&&this._events._emit("state-update",{state:e,partDone:t})},e.prototype.getWorkingState=function(){return{state:this._workingState,partDone:this._partDone}},Object.defineProperty(e.prototype,"errors",{get:function(){return this._errors.slice()},enumerable:!0,configurable:!0}),e.prototype._processEventResult=function(e,t,r){for(var n=0,i=e;n<i.length;n++){var o=i[n];this._processError({error:o,node:t,index:r})}},e.prototype._processError=function(e){this._errors.push(e),this._events._emit("error",e)},e.prototype._fireAttributeEvents=function(e,t){for(var r=t.attributes,n=0;n<r.length;++n){var i=r[n];"xmlns"!==i.name&&0!==i.name.lastIndexOf("xmlns",0)&&this._fireAttributeNameEvent(e,t,i)&&this._fireAndProcessEvent(e,new s.Event("attributeValue",i.value),i,0)}},e.prototype._fireAttributeNameEvent=function(e,t,r){var n=r.name,i=e.resolveName(n,!0);return void 0===i?(this._processError({error:new s.ValidationError("cannot resolve attribute name "+n),node:r,index:0}),!1):(this._setPossibleDueToWildcard(r,e,"attributeName",i.ns,i.name),this._fireAndProcessEvent(e,new s.Event("attributeName",i.ns,i.name),r,0),!0)},e.prototype._fireAndProcessEvent=function(e,t,r,i){this._validationEvents.push(t);var o=e.fireEvent(t);o instanceof Array&&(null!=r&&void 0!==i&&"number"!=typeof i&&(i=n(r.childNodes,i)),this._processEventResult(o,r,i))},e.prototype._validateUpTo=function(e,t,r){if(void 0===r&&(r=!1),r=!!r,r&&(void 0===e.childNodes||e.childNodes[t].nodeType!==Node.ELEMENT_NODE))throw new Error("trying to validate after attributes but before the end of the start tag on a node which is not an element node");var n=e,o="EventIndexAfter";if(e===this.root&&0>=t){if(r)o="EventIndexAfterAttributes",n=e.childNodes[t];else if(0===t)return}else if(i(e))n=e.ownerElement,o="EventIndexBeforeAttributes";else switch(e.nodeType){case Node.TEXT_NODE:n=e.previousElementSibling,null===n&&(n=e.parentNode,o="EventIndexAfterStart");break;case Node.ELEMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:case Node.DOCUMENT_NODE:var a=e.childNodes[t],s=void 0===a?e.lastElementChild:a.previousElementSibling;r?(o="EventIndexAfterAttributes",n=a):null!==s?n=s:o="EventIndexAfterStart";break;default:throw new Error("unexpected node type: "+e.nodeType)}for(;void 0===this.getNodeProperty(n,o);)this._cycle()},e.prototype._getWalkerAt=function(e,t,r){function n(e){if(void 0===o)throw new Error("calling fireTextEvent without a walker");o.fireEvent(new s.Event("text",e.data))}if(void 0===r&&(r=!1),r=!!r,r&&(void 0===e.childNodes||e.childNodes[t].nodeType!==Node.ELEMENT_NODE))throw new Error("trying to get a walker for attribute events on a node which is not an element node");if(this._validateUpTo(e,t,r),e===this.root&&0>=t&&!r)return 0===t?this.schema.newWalker():this._validationWalker;var o;if(i(e)){var a=e.ownerElement;o=this.readyWalker(this.getNodeProperty(a,"EventIndexBeforeAttributes")),"xmlns"!==e.name&&"xmlns"!==e.prefix&&(o=o.clone(),this._fireAttributeNameEvent(o,a,e))}else switch(e.nodeType){case Node.TEXT_NODE:var u=e.previousElementSibling,l=void 0,c=void 0;null!==u?(l=u,c="EventIndexAfter"):(l=e.parentNode,c="EventIndexAfterStart"),o=this.readyWalker(this.getNodeProperty(l,c)),t>0&&(o=o.clone(),n(e));break;case Node.ELEMENT_NODE:case Node.DOCUMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:var h=e.childNodes[t],u=void 0,l=void 0,c=void 0;if(r?(l=h,c="EventIndexAfterAttributes"):(u=void 0===h?e.lastElementChild:h.previousElementSibling,null!==u?(l=u,c="EventIndexAfter"):(l=e,c="EventIndexAfterStart")),o=this.readyWalker(this.getNodeProperty(l,c)),!r){var d=null!=h?h.previousSibling:null;null!==d&&d!==u&&d.nodeType===Node.TEXT_NODE&&(o=o.clone(),n(d))}break;default:throw new Error("unexpected node type: "+e.nodeType)}return o},e.prototype.readyWalker=function(e){if(void 0===e)throw new v;var t=this._walkerCache,r=this._walkerCacheMax,n=t[e];if(n)return n;var i=e;if(i>=r)i=r,n=t[i];else for(;!n&&--i>=0;)n=t[i];n?n=n.clone():(n=this.schema.newWalker(),i=0);for(var o=i;e>o;++o)n.fireEvent(this._validationEvents[o]);return e-i>=this._walkerCacheGap&&(t[e]=n,this._walkerCacheMax=Math.max(e,r)),n},e.prototype.possibleAt=function(e,t,r){void 0===r&&(r=!1);var n=this._getWalkerAt(e,t,r);return n.possible()},e.prototype.possibleWhere=function(e,t){for(var r=[],n=0;n<=e.childNodes.length;++n){var i=this.possibleAt(e,n);if(i.has(t))r.push(n);else if("enterStartTag"===t.params[0]||"attributeName"===t.params[0])for(var o=0,a=i.toArray();o<a.length;o++){var s=a[o];if(s.params[0]===t.params[0]&&s.params[1].match(t.params[1],t.params[2])){r.push(n);break}}}return r},e.prototype.speculativelyValidate=function(e,t,r){var n;if(r instanceof Array){n=e.ownerDocument.createDocumentFragment();for(var i=0,o=r;i<o.length;i++){var a=o[i];n.insertBefore(a.cloneNode(!0),null)}}else n=r.cloneNode(!0);var s=e.ownerDocument.createElement("div");return s.insertBefore(n,null),this.speculativelyValidateFragment(e,t,s)},e.prototype.speculativelyValidateFragment=function(t,r,n){if(n.nodeType!==Node.ELEMENT_NODE)throw new Error("toParse is not an element");var i=new e(this.schema,n);return i._validationWalker=this._getWalkerAt(t,r).clone(),i._validateUpTo(n,n.childNodes.length),0!==i._errors.length?i._errors:!1},e.prototype.getErrorsFor=function(e){var t=e.parentNode;if(null===t)throw new Error("node without a parent!");this._validateUpTo(t,n(t.childNodes,e)+1);for(var r=[],i=0,o=this._errors;i<o.length;i++){var a=o[i];a.node===e&&r.push(a)}return r},e.prototype._setPossibleDueToWildcard=function(e,t,r,n,i){var a=this.getNodeProperty(e,"PossibleDueToWildcard"),s=o(t,r,n,i);this._setNodeProperty(e,"PossibleDueToWildcard",s),(void 0===a||a!==s)&&this._events._emit("possible-due-to-wildcard-change",e)},e.prototype.resolveNameAt=function(e,t,r,n){return void 0===n&&(n=!1),this._getWalkerAt(e,t).resolveName(r,n)},e.prototype.unresolveNameAt=function(e,t,r,n){return this._getWalkerAt(e,t).unresolveName(r,n)},e}();t.Validator=y}])});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/validator",["require","exports","module","salve-dom","./dloc","./domtypeguards"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INCOMPLETE=n.WorkingState.INCOMPLETE,t.WORKING=n.WorkingState.WORKING,t.INVALID=n.WorkingState.INVALID,t.VALID=n.WorkingState.VALID;var a=function(e){function t(t,r,n){var i=e.call(this,t,r,{timeout:0,maxTimespan:100})||this;return i.modeValidator=n,i}return __extends(t,e),t.prototype._runDocumentValidation=function(){if(void 0!==this.modeValidator)for(var e=this.modeValidator.validateDocument(),t=0,r=e;t<r.length;t++){var n=r[t];this._processError(n)}},t.prototype.possibleAt=function(t,r,n){if(void 0===r&&(r=!1),void 0===n&&(n=!1),t instanceof i.DLoc){if("boolean"!=typeof r)throw new Error("2nd parameter must be boolean");n=r,r=t.offset,t=t.node}if("number"!=typeof r)throw new Error("index must be a number");return e.prototype.possibleAt.call(this,t,r,n)},t.prototype.speculativelyValidate=function(t,r,n){if(t instanceof i.DLoc){if(!(o.isNode(r)||r instanceof Array))throw new Error("2nd argument must be a Node or an array of Nodes");n=r,r=t.offset,t=t.node}if("number"!=typeof r)throw new Error("index must be a number");if(void 0===n)throw new Error("toParse must be defined");return e.prototype.speculativelyValidate.call(this,t,r,n)},t.prototype.speculativelyValidateFragment=function(t,r,n){if(t instanceof i.DLoc){if("number"==typeof r||!o.isElement(r))throw new Error("toParse is not an element");n=r,r=t.offset,t=t.node}if("number"!=typeof r)throw new Error("index must be a number");if(void 0===n)throw new Error("toParse must be defined");return e.prototype.speculativelyValidateFragment.call(this,t,r,n)},t}(n.Validator);t.Validator=a});var __assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;n>r;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};define("wed/task-runner",["require","exports","module","rxjs"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t={}),this.task=e,this._timeout=0,this._maxTimespan=100,this._boundWrapper=this._workWrapper.bind(this);for(var r=["timeout","maxTimespan"],i=0,o=r;i<o.length;i++){var a=o[i],s=t[a];if(void 0!==s){if(0>s)throw new Error("the value for "+a+" cannot be negative");this["_"+a]=t[a]}}this._state=new n.BehaviorSubject({running:!1,completed:!1,terminated:!1}),this.state=this._state.asObservable()}return Object.defineProperty(e.prototype,"running",{get:function(){return this._state.value.running},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"completed",{get:function(){return this._state.value.completed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"terminated",{get:function(){return this._state.value.terminated},enumerable:!0,configurable:!0}),e.prototype.onCompleted=function(){return this.state.first(function(e){return e.completed}).toPromise()},e.prototype._stateFieldChange=function(e,t){var r=this._state.value,n=__assign({},this._state.value);n[e]=t,n[e]!==r[e]&&this._state.next(n)},e.prototype._setTimeoutId=function(e){this._timeoutId=e,this._stateFieldChange("running",void 0!==this._timeoutId)},e.prototype.start=function(){this.reset(),this.resume()},e.prototype.reset=function(){this._stateFieldChange("completed",!1),this.task.reset(this)},e.prototype.resume=function(){this.completed||(void 0!==this._timeoutId&&this.stop(),this._setTimeoutId(setTimeout(this._boundWrapper,0)))},e.prototype._workWrapper=function(){this._work()?this._setTimeoutId(setTimeout(this._boundWrapper,this._timeout)):this._stateFieldChange("completed",!0)},e.prototype._work=function(){for(var e=Date.now();;){if(this._maxTimespan>0&&Date.now()-e>=this._maxTimespan)return!0;var t=this.task.cycle(this);if(!t)return!1}},e.prototype.stop=function(){void 0!==this._timeoutId&&clearTimeout(this._timeoutId),this._setTimeoutId(void 0)},e.prototype.terminate=function(){this.stop(),this._stateFieldChange("terminated",!0),this._state.complete()},e}();t.TaskRunner=i}),define("wed/tasks/process-validation-errors",["require","exports","module"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.controller=e}return e.prototype.reset=function(){this.errors=this.controller.copyErrorList()},e.prototype.cycle=function(){var e=this.controller,t=this.errors;if(0===t.length)return!1;for(var r=Math.min(t.length,30),n=[],i=[],o=0;0!==r;){r--;var a=t[o];if(e.processError(a)){t.splice(o,1);var s=a.item;if(void 0===s)throw new Error("there should be an item");n.push(s);var u=a.marker;null!=u&&i.push(u)}else++o}return e.appendItems(n),e.appendMarkers(i),0!==t.length},e}();t.ProcessValidationErrors=n}),define("wed/tasks/refresh-validation-errors",["require","exports","module"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.controller=e}return e.prototype.reset=function(){this.errors=this.controller.copyErrorList(),this.resumeAt=0},e.prototype.cycle=function(){for(var e=this.resumeAt,t=Math.min(this.errors.length,this.resumeAt+20),r=this.errors;t>e;){var n=r[e];null!=n.marker&&this.controller.processError(n),e++}return this.resumeAt=e,e<r.length},e}();t.RefreshValidationErrors=n}),define("wed/validation-controller",["require","exports","module","salve","salve-dom","./dloc","./domtypeguards","./domutil","./guiroot","./task-runner","./tasks/process-validation-errors","./tasks/refresh-validation-errors","./util","./wed-util"],function(e,t,r,n,i,o,a,s,u,l,c,h,d,p){"use strict";function f(e,t,r){var n=e.caretManager;try{return n.fromDataLocation(t,r)}catch(i){if(i instanceof u.AttributeNotFound)return n.fromDataLocation(t.ownerElement,0);throw i}}function m(e,t){for(var r=e.createDocumentFragment(),n=0,i=t;n<i.length;n++){var o=i[n];r.appendChild(o)}return r}function v(e,t){for(var r=[],n=e.getNames(),i=0,o=n;i<o.length;i++){var a=o[i],s=a.toArray(),u="";if(null!==s){for(var l=[],c=0,h=s;c<h.length;c++){var p=h[c];l.push(t.unresolveName(p.ns,p.name))}u=l.join(" or ")}else u=d.convertPatternObj(a.toObject(),t);r.push(u)}return r}Object.defineProperty(t,"__esModule",{value:!0});var y={};y[i.WorkingState.INCOMPLETE]="stopped",y[i.WorkingState.WORKING]="working",y[i.WorkingState.INVALID]="invalid",y[i.WorkingState.VALID]="valid";var g={};g[i.WorkingState.INCOMPLETE]="info",g[i.WorkingState.WORKING]="info",g[i.WorkingState.INVALID]="danger",g[i.WorkingState.VALID]="success";var _=function(){function e(e,t,r,n,i,o,a,s,u,d){this.editor=e,this.validator=t,this.resolver=r,this.scroller=n,this.guiRoot=i,this.progressBar=o,this.validationMessage=a,this.errorLayer=s,this.errorList=u,this.errorItemHandler=d,this.lastDoneShown=0,this.processErrorsDelay=500,this._errors=[],this.processedErrorsUpTo=-1,this.document=i.ownerDocument,this.$errorList=$(u),this.refreshErrorsRunner=new l.TaskRunner(new h.RefreshValidationErrors(this)),this.processErrorsRunner=new l.TaskRunner(new c.ProcessValidationErrors(this)),this.validator.events.addEventListener("state-update",this.onValidatorStateChange.bind(this)),this.validator.events.addEventListener("error",this.onValidatorError.bind(this)),this.validator.events.addEventListener("reset-errors",this.onResetErrors.bind(this))}return e.prototype.copyErrorList=function(){return this._errors.slice()},e.prototype.stop=function(){this.refreshErrorsRunner.stop(),this.processErrorsRunner.stop(),this.validator.stop()},e.prototype.resume=function(){this.refreshErrorsRunner.resume(),this.processErrorsRunner.resume(),this.validator.start()},e.prototype.onValidatorStateChange=function(e){var t=e.state,r=e.partDone;if(t===i.WorkingState.WORKING){if(r-this.lastDoneShown<.05)return}else(t===i.WorkingState.VALID||t===i.WorkingState.INVALID)&&this.processErrors();
this.lastDoneShown=r;var n=100*r,o=this.progressBar;o.style.width=n+"%",o.classList.remove("progress-bar-info","progress-bar-success","progress-bar-danger"),o.classList.add("progress-bar-"+g[t]),this.validationMessage.textContent=y[t]},e.prototype.onValidatorError=function(e){this._errors.push({ev:e,marker:void 0,item:void 0}),void 0===this.processErrorsTimeout&&(this.processErrorsTimeout=setTimeout(this.processErrors.bind(this),this.processErrorsDelay))},e.prototype.onResetErrors=function(e){if(0!==e.at)throw new Error("internal error: wed does not yet support resetting errors at an arbitrary location");this.lastDoneShown=0,this.clearErrors()},e.prototype.processErrors=function(){void 0!==this.processErrorsTimeout&&(clearTimeout(this.processErrorsTimeout),this.processErrorsTimeout=void 0),this.processErrorsRunner.reset(),this.editor._resumeTaskWhenPossible(this.processErrorsRunner)},e.prototype.findInsertionPoint=function(e){var t=e.error,r=e.node,i=e.index;if(null==r)throw new Error("error without a node");if(void 0===i)throw new Error("error without an index");var s,u=t instanceof n.AttributeNameError;if(u){var l=p.getGUINodeIfExists(this.editor,r);if(void 0===l)return;if(!a.isElement(l))throw new Error("attribute name errors should be associated with elements");var c=l.querySelector("._gui.__start_label ._greater_than");s=o.DLoc.mustMakeDLoc(this.guiRoot,c,0)}else{if(s=f(this.editor,r,i),null===s)return;s=this.editor.caretManager.normalizeToEditableRange(s)}return s},e.prototype.processError=function(e){var t=this;this.editor.expandErrorPanelWhenNoNavigation();var r=e.ev,n=r.error,i=r.node,o=this.findInsertionPoint(r);if(void 0===o)return!1;var u,l=e.marker;if(null==i)throw new Error("error without a node");if(void 0===l){var c=o.node.ownerDocument,h=!1;if(a.isAttr(i)){var f=o.node;if(f.nodeType===Node.TEXT_NODE&&(f=f.parentNode),!a.isElement(f))throw new Error("we should be landing on an element");h=s.isNotDisplayed(f,o.root)}var m=v(n,this.resolver);u=c.createElement("li");var y=u.id=d.newGenericID();if(h)u.textContent=n.toStringWithNames(m),u.title="This error belongs to an attribute which is not currently displayed.";else{l=c.createElement("span"),l.className="_phantom wed-validation-error",l.innerText="";var g=$(l);g.mousedown(function(){t.$errorList.parents(".panel-collapse").collapse("show");var e=$(t.errorList.querySelector("#"+y)),r=t.$errorList.parent(".panel-body");return r.animate({scrollTop:e.offset().top-r.offset().top+r[0].scrollTop}),t.errorLayer.select(l),e.siblings().removeClass("selected"),e.addClass("selected"),t.editor.caretManager.setCaret(o),!1});var _=l.id=d.newGenericID(),b=c.createElement("a");b.href="#"+_,b.textContent=n.toStringWithNames(m),u.appendChild(b),$(u.firstElementChild).click(this.errorItemHandler)}}if(void 0!==l){var w=p.boundaryXY(o),E=this.scroller,x=E.getBoundingClientRect();l.style.top=w.top-x.top+E.scrollTop+"px",l.style.left=w.left-x.left+E.scrollLeft+"px"}return void 0===e.item&&(e.item=u),e.marker=l,!0},e.prototype.clearErrors=function(){this._errors=[],this.processedErrorsUpTo=-1,this.refreshErrorsRunner.stop(),this.processErrorsRunner.stop(),this.errorLayer.clear();for(var e=this.errorList;null!=e.lastChild;)e.removeChild(e.lastChild);this.refreshErrorsRunner.reset(),this.processErrorsRunner.reset()},e.prototype.terminate=function(){void 0!==this.processErrorsTimeout&&clearTimeout(this.processErrorsTimeout),this.stop()},e.prototype.refreshErrors=function(){this.refreshErrorsRunner.reset(),this.editor._resumeTaskWhenPossible(this.refreshErrorsRunner)},e.prototype.recreateErrors=function(){this.errorLayer.clear();for(var e=this.errorList;null!==e.lastChild;)e.removeChild(e.lastChild);for(var t=0,r=this._errors;t<r.length;t++){var n=r[t];n.marker=void 0,n.item=void 0}this.processedErrorsUpTo=-1,this.processErrors()},e.prototype.appendItems=function(e){this.errorList.appendChild(m(this.document,e))},e.prototype.appendMarkers=function(e){this.errorLayer.append(m(this.document,e))},e}();t.ValidationController=_}),define("wed/gui/modal",["require","exports","module","interact","jquery","../browsers","bootstrap"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){this.changes=[],this.rolledback=!1}return e.prototype.updateElementRect=function(e,t,r){if(!this.rolledback){var n=e.getBoundingClientRect();o.MSIE&&(e.style.width=n.width+"px",e.style.height=n.height+"px",n=e.getBoundingClientRect());var i=n.width+t,a=n.height+r;e.style.width=i+"px",e.style.height=a+"px",this.changes.push({el:e,rect:n});var s=e.getBoundingClientRect();(s.width!==i||s.height!==a)&&this.rollback()}},e.prototype.rollback=function(){for(var e=this.changes,t=0,r=e;t<r.length;t++){var n=r[t],i=n.el,o=n.rect;i.style.width=o.width+"px",i.style.height=o.height+"px"}this.rolledback=!0},e}(),s=function(){function e(e){var t=this;e=null!=e?e:{},this._$dom=i('<div class="modal" style="position: absolute" tabindex="1">  <div class="modal-dialog">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal"          aria-hidden="true">&times;</button>        <h3 class="modal-title">Untitled</h3>      </div>      <div class="modal-body">        <p>No body.</p>      </div>      <div class="modal-footer">      </div>    </div>  </div></div>'),this._$header=this._$dom.find(".modal-header"),this._$body=this._$dom.find(".modal-body"),this._$footer=this._$dom.find(".modal-footer"),this._$dom.on("click",".btn",function(e){return t._$clicked=i(e.currentTarget),!0}),this._$dom.on("shown.bs.modal.modal",this._handleShown.bind(this));var r=this._$dom.find(".modal-content")[0],o=this._$body[0],s=o.ownerDocument.defaultView,u=this._$dom;e.resizable&&(o.style.overflow="auto",n(r).resizable({}).on("resizestart",function(){var e=u.data("bs.modal");null!=e&&(e.ignoreBackdropClick=!0)}).on("resizeend",function(){setTimeout(function(){var e=u.data("bs.modal");null!=e&&(e.ignoreBackdropClick=!1)},0)}).on("resizemove",function(e){var t=e.target,r=new a;r.updateElementRect(t,e.dx,e.dy),r.updateElementRect(o,e.dx,e.dy)})),e.draggable&&n(this._$header[0]).draggable({restrict:{restriction:{left:0,top:0,right:s.innerWidth-10,bottom:s.innerHeight-10}}}).on("dragmove",function(e){var t=r;t.style.left=e.clientX-e.clientX0+"px",t.style.top=e.clientY-e.clientY0+"px"})}return e.prototype.getTopLevel=function(){return this._$dom},e.prototype.setTitle=function(e){var t=this._$header.find("h3");t.empty(),t.append(e)},e.prototype.setBody=function(e){this._$body.empty(),this._$body.append(e)},e.prototype.setFooter=function(e){this._$footer.empty(),this._$footer.append(e)},e.prototype.addButton=function(e,t){void 0===t&&(t=!1);var r=this._$dom[0].ownerDocument.createElement("a");return r.href="#",r.className="btn",r.setAttribute("data-dismiss","modal"),r.textContent=e,r.classList.add(t?"btn-primary":"btn-default"),this._$footer.append(r),i(r)},e.prototype.addOkCancel=function(){return[this.addButton("Ok",!0),this.addButton("Cancel")]},e.prototype.addYesNo=function(){return[this.addButton("Yes",!0),this.addButton("No")]},e.prototype.getPrimary=function(){return this._$footer.find(".btn-primary")},e.prototype.modal=function(e){this._$clicked=void 0,void 0!==e&&this._$dom.one("hidden.bs.modal.modal",e),this._$dom.modal()},e.prototype.getClicked=function(){return this._$clicked},e.prototype.getClickedAsText=function(){return void 0!==this._$clicked?this._$clicked.text():void 0},e.prototype._handleShown=function(){var e=this._$dom[0].ownerDocument.defaultView,t=e.innerHeight,r=this._$dom.find(".modal-dialog")[0],n=r.getBoundingClientRect(),i=window.getComputedStyle(r),o=-n.top+(t-n.height)-parseInt(i.marginBottom),a=n.height+o;r.style.maxHeight=a+"px";var s=this._$dom.find(".modal-content")[0];s.style.maxHeight=a+"px"},e}();t.Modal=s}),define("wed/gui/icon",["require","exports","module"],function(e,t,r){"use strict";function n(e){var t=i[e];if(void 0===t)throw new Error("unknown icon name: "+e);return'<i class="fa fa-fw '+t+'"></i>'}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.create(null);i.add="fa-plus",i["delete"]="fa-times",i.wrap="fa-caret-square-o-down",i.unwrap="fa-caret-square-o-up",i.documentation="fa-question-circle",i.transform="fa-cog",i.any="fa-asterisk",i.element="fa-angle-left",i.attribute="fa-at",i.other="fa-circle-thin",i.exclamation="fa-exclamation",t.makeHTML=n}),define("wed/action",["require","exports","module"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){void 0===n&&(n=""),void 0===i&&(i=!1),this.editor=e,this.desc=t,this.abbreviatedDesc=r,this.icon=n,this.needsInput=i,this._enabled=!0,this.needsInput=!!i,this.boundHandler=this.eventHandler.bind(this),this.boundTerminalHandler=this.terminalEventHandler.bind(this)}return e.prototype.eventHandler=function(e){this.execute(e.data),e.preventDefault()},e.prototype.terminalEventHandler=function(e){return this.eventHandler(e),e.preventDefault(),e.stopPropagation(),!1},e.prototype.getDescription=function(){return this.desc},e.prototype.getDescriptionFor=function(e){return this.getDescription()},e.prototype.getAbbreviatedDescription=function(){return this.abbreviatedDesc},e.prototype.getIcon=function(){return this.icon},e.prototype.getLabelFor=function(e){var t=this.getDescriptionFor(e),r=this.getIcon();return""!==r&&""!==t?r+" "+t:""!==r?r:t},e.prototype.toString=function(){return this.getDescription()},e.prototype.getEnabled=function(){return this._enabled},e}();t.Action=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/transformation",["require","exports","module","lodash","./action","./domtypeguards","./domutil","./gui/icon"],function(e,t,r,n,i,o,a,s){"use strict";function u(e,t){if(void 0!==e)return e;var r=b[t];return void 0!==r?s.makeHTML(r):void 0}function l(e,t,r,n){var i=e.createElementNS(t,r);if(void 0!==n)for(var o=Object.keys(n).sort(),a=0,s=o;a<s.length;a++){var u=s[a];i.setAttribute(u,n[u])}return i}function c(e,t,r,n,i,a){var s=o.isDocument(t)?t:t.ownerDocument,u=l(s,n,i,a);return e.insertAt(t,r,u),u}function h(e,t,r,n,i,o,s){var u=t.data.slice(r,n),c=t.parentNode;if(null===c)throw new Error("detached node");var h=a.indexOf(c.childNodes,t);e.deleteText(t,r,u.length);var d=l(t.ownerDocument,i,o,s);return""!==u&&d.appendChild(t.ownerDocument.createTextNode(u)),null===t.parentNode?e.insertAt(c,h,d):e.insertAt(t,r,d),d}function d(e,t,r){var n=t.parentNode;if(null===n)throw new Error("detached node");var i=a.indexOf(n.childNodes,t);if(0===r)r=i;else if(r>=t.length)r=i+1;else{var o=t.data.slice(r);e.setTextNode(t,t.data.slice(0,r)),e.insertNodeAt(n,i+1,t.ownerDocument.createTextNode(o)),r=i+1}return[n,r]}function p(e,t,r,n,i,s,u,c){if(!a.isWellFormedRange({startContainer:t,startOffset:r,endContainer:n,endOffset:i}))throw new Error("malformed range");if(o.isText(t)){if(t===n)return h(e,t,r,i,s,u,c);m=d(e,t,r),t=m[0],r=m[1]}if(o.isText(n)&&(v=d(e,n,i),n=v[0],i=v[1]),t!==n)throw new Error("startContainer and endContainer are not the same;probably due to an algorithmic mistake");for(var p=l(t.ownerDocument,s,u,c);--i>=r;){var f=n.childNodes[i];e.deleteNode(f),p.insertBefore(f,p.firstChild)}return e.insertAt(t,r,p),p;var m,v}function f(e,t){var r=t.parentNode;if(null===r)throw new Error("detached node");var n=Array.prototype.slice.call(t.childNodes),i=t.previousSibling,o=t.nextSibling;e.deleteNode(t);for(var s=null!==o?a.indexOf(r.childNodes,o):r.childNodes.length,u=t.lastChild;null!=t.firstChild;)e.insertNodeAt(r,s++,t.firstChild);return null!==u&&e.mergeTextNodes(u),e.mergeTextNodesNF(i),n}function m(e,t){var r=e.caretManager.getDataCaret();if(!t.contains(r.node))throw new Error("caret outside node");var n=e.data_updater.splitAt(t,r);e.caretManager.setCaret(a.firstDescendantOrSelf(n[1]),0)}function v(e,t){var r=t.previousElementSibling;if(null!==r&&r.localName===t.localName&&r.namespaceURI===t.namespaceURI){for(var n=r.childNodes.length,i=r.lastChild,a=o.isText(i),s=a?i.length:0,u=r.childNodes.length,l=t.childNodes.length-1;l>=0;--l)e.data_updater.insertAt(r,u,t.childNodes[l].cloneNode(!0));a?(e.data_updater.mergeTextNodes(i),e.caretManager.setCaret(r.childNodes[n-1],s)):e.caretManager.setCaret(r,n),e.data_updater.removeNode(t)}}function y(e,t){var r=t.nextElementSibling;null!==r&&v(e,r)}function g(e,t){var r=t.previousElementSibling;if(null!==r&&r.localName===t.localName&&r.namespaceURI===t.namespaceURI){var n=r.parentNode;if(null===n)throw new Error("detached node");e.data_updater.removeNode(t),e.data_updater.insertBefore(n,t,r),e.caretManager.setCaret(t)}}function _(e,t){var r=t.nextElementSibling;null!==r&&g(e,r)}Object.defineProperty(t,"__esModule",{value:!0});var b=n.extend(Object.create(null),{add:"add","delete":"delete",transform:"transform",insert:"add","delete-element":"delete","delete-parent":"delete",wrap:"wrap","wrap-content":"wrap","merge-with-next":"transform","merge-with-previous":"transform","swap-with-next":"transform","swap-with-previous":"transform",split:"transform",append:"add",prepend:"add",unwrap:"unwrap","add-attribute":"add","delete-attribute":"delete"}),w=n.extend(Object.create(null),{add:"other","delete":"other",transform:"other",insert:"element","delete-element":"element","delete-parent":"element",wrap:"element","wrap-content":"element","merge-with-next":"element","merge-with-previous":"element","swap-with-next":"element","swap-with-previous":"element",split:"element",append:"element",prepend:"element",unwrap:"element","add-attribute":"attribute","delete-attribute":"attribute"}),E=function(e){function t(t,r,n,i,o,a,s){var l=this;if("function"==typeof i?(s=i,l=e.call(this,t,n,void 0,u(void 0,r),!1)||this):"function"==typeof o?(s=o,l=e.call(this,t,n,i,u(void 0,r),!1)||this):"function"==typeof a?(s=a,l=e.call(this,t,n,i,u(o,r),!1)||this):l=e.call(this,t,n,i,u(o,r),a)||this,void 0===s)throw new Error("did not specify a handler");return l.handler=s,l.transformationType=r,l.kind=b[r],l.nodeType=w[r],l}return __extends(t,e),t.prototype.getDescriptionFor=function(e){return this.desc.replace(/<name>/,e.name)},t.prototype.execute=function(e){this.editor.fireTransformation(this,e)},t}(i.Action);t.Transformation=E,t.makeElement=l,t.insertElement=c,t.wrapTextInElement=h,t.wrapInElement=p,t.unwrap=f,t.splitNode=m,t.mergeWithPreviousHomogeneousSibling=v,t.mergeWithNextHomogeneousSibling=y,t.swapWithPreviousHomogeneousSibling=g,t.swapWithNextHomogeneousSibling=_}),define("wed/onbeforeunload",["require","exports","module"],function(e,t){"use strict";function r(){return!0}function n(e,t,n){function i(){return t()||void 0}if(t=t||r,n=!!n,e.onbeforeunload&&e.onbeforeunload.installed_by_onbeforeunload&&!n)throw new Error("reregistering window with `force` false",e);i.installed_by_onbeforeunload=!0,e.onbeforeunload=i}var i="undefined"!=typeof __WED_TESTING&&__WED_TESTING.testing;i||n(window),t.install=n}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("bluejax.try",["jquery"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery")):(e.bluejax=e.bluejax||{},e.bluejax["try"]=t(jQuery))}(this,function(e){"use strict";function t(t){var r=t.context;delete t.context;var n=e.extend(!0,{},t);return r&&(n.context=r,t.context=r),n}function r(e){var r,n,i=e[0];if(1===e.length)n="object"!=typeof i?{url:i}:i;else{if(2!==e.length)throw Error("we support 1 or 2 args, got "+e.length);n=e[1],n.url=i}return r=n.bluejaxOptions,r?(n=t(n),r=n.bluejaxOptions,delete n.bluejaxOptions):r={},[r,n]}function n(e,t){return 0===e.status&&"parsererror"!==t&&"abort"!==t}function i(t,r,i){this.shouldRetry=i.shouldRetry||n,this.jqOptions=r,void 0===i.tries&&(i.tries=1),this.tries=i.tries;var o,a=this.saved={complete:void 0,error:void 0,statusCode:void 0,success:void 0};this.callbackContext=r.context||t,delete r.context;for(o in a)a[o]=r[o],delete r[o];var s=this,u=this.wrapperXhr={readyState:0,getResponseHeader:function(e){return this.latestXhr.getResponseHeader(e)},getAllResponseHeaders:function(){return this.latestXhr.getAllResponseHeaders()},setRequestHeader:function(e,t){return console.warn("called setRequestHeader a wrapperXhr"),this},overrideMimeType:function(e){return console.warn("called overrideMimeType on a wrapperXhr"),this},statusCode:function(e){return console.warn("called statusCode on a wrapperXhr"),this},abort:function(e){var t=this.latestXhr.abort(e);return s.transferToWrapper(this.latestXhr),t}},c=this.deferred=e.Deferred();c.promise(u);var h=e.Callbacks("once memory");3>l&&(u.success=u.done,u.error=u.fail,u.complete=h.add),h.add(a.complete),u.done(a.success),u.fail(a.error)}function o(e,t,r){var n=new i(e,t,r);return n.iterate(),n.wrapperXhr}function a(t,n,i){var a=n?[t,n]:[t],s=n||t,u=r(a),l=e.extend(!0,{},i,u[0]),c=u[1];return o(s,c,l)}function s(e,t){return a(e,t)}function u(e){return function(t,r){return a(t,r,e)}}var l=parseInt(e.fn.jquery.split(".",1)[0]);i.prototype.transferToWrapper=function(e){for(var t=["readyState","status","statusText","responseXML","responseText"],r=0;r<t.length;++r){var n=t[r];this.wrapperXhr[n]=e[n]}},i.prototype.handleStatusCode=function(e,t){var r=this.saved.statusCode;if(r){var n=r[e];n&&n.apply(this.callbackContext,t)}},i.prototype.iterate=function(){this.tries-=1;var t=e.ajax(this.jqOptions);this.wrapperXhr.latestXhr=t,t.fail(this.failed.bind(this)).done(this.succeeded.bind(this)),this.transferToWrapper(t)},i.prototype.failed=function(e,t,r){this.transferToWrapper(e),this.tries<1||!this.shouldRetry(e,t,r)?(this.deferred.rejectWith(this.callbackContext,[this.wrapperXhr,t,r]),this.handleStatusCode(e.status,[this.wrapperXhr,t,r])):this.iterate()},i.prototype.succeeded=function(e,t,r){this.transferToWrapper(r),this.deferred.resolveWith(this.callbackContext,[e,t,this.wrapperXhr]),this.handleStatusCode(r.status,[e,t,this.wrapperXhr])};var c={ajax:s,make:u,perform:o,extractBluejaxOptions:r};return c.version="1.0.0",c}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("bluejax",["bluejax.try","jquery","bluebird"],t):"object"==typeof module&&module.exports?module.exports=t(require("bluejax.try"),require("jquery"),require("bluebird")):e.bluejax=t(e.bluejax["try"],jQuery,Promise)}(this,function(e,t,r){"use strict";function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e}function i(e,t){try{Object.defineProperty(e,"name",{value:t})}catch(r){if(!(r instanceof TypeError))throw r}e.prototype.name=t}function o(e,t,r,n){if(this.jqXHR=e,this.textStatus=t,this.errorThrown=r,Error.captureStackTrace)Error.captureStackTrace(this,this.constructor);else{var i=new Error;if(i.stack)this.stack=i.stack;else try{throw i}catch(o){this.stack=o.stack}}var a="Ajax operation failed";r?a+=": "+r+" ("+e.status+")":t&&(a+=": "+t),a+=".",n&&(a+=" Called with: "+JSON.stringify(n)),this.message=a}function a(e,t,r,n){var i=x[t];return i||(i=x[0!==e.status?"http":"ajax"]),new i(e,t,r,n)}function s(e,t){o.call(this),this.message=e,this.originalError=t}function u(e){s.call(this,"your browser is offline",e)}function l(e){s.call(this,"the server appears to be down",e)}function c(e){s.call(this,"the network appears to be down",e)}function h(e){return e+=e.indexOf("?")<0?"?":"&_=",e+Date.now()}function d(e){return"/"===e[e.length-1]&&e.indexOf("?")<0&&(e+="favicon.ico"),e}function p(e,t){var n=t.knownServers;if(!n||0===n.length)throw new l(e);return r.all(n.map(function(e){return _({url:h(d(e)),timeout:1e3}).reflect()})).filter(function(e){return e.isFulfilled()}).then(function(t){if(0===t.length)throw new c(e);throw new l(e)})}function f(e,t){if("onLine"in navigator&&!navigator.onLine)throw new u(e);var r,n=t.serverURL;return r=n?_({url:h(d(n))})["catch"](function(){return p(e,t)}):p(e,t),r.then(function(){throw e})}function m(e){return!(e instanceof N.HttpError||e instanceof N.ParserError||e instanceof N.AbortError)}function v(t,n,i,o){var s,u=new r(function(r,u){function l(e,t,n){r(o.verboseResults?[e,t,n]:e)}function c(e,n,i){var s=a(e,n,i,o.verboseExceptions?t:null);if(m(s)){var l=o.diagnose;l&&l.on?r(f(s,l)):u(s)}else u(s)}s=e.perform.call(this,n,i,o),s.fail(c).done(l)});return{xhr:s,promise:u}}function y(r,n,i){var o=n?[r,n]:[r],a=n||r,s=e.extractBluejaxOptions(o),u=t.extend({},i,s[0]),l=s[1];return v(o,a,l,u)}function g(e,t,r){return y(e,t,r).promise}function _(e,t){return g(e,t)}function b(e,t){return y(e,t)}function w(e,t){return function(r,n){var i=y(r,n,e);return t?i[t]:i}}n(o,Error),i(o,"GeneralAjaxError");for(var E=["timeout","abort","parsererror","ajax","http"],x={},N={},S=0;S<E.length;++S){var C,T=E[S];C="parsererror"!==T?T[0].toUpperCase()+T.slice(1)+"Error":"ParserError";var P=function(){o.apply(this,arguments)};x[T]=P,N[C]=P,n(P,o),i(P,C)}N.ConnectivityError=s,n(s,o),i(s,"ConnectivityError"),N.BrowserOfflineError=u,n(u,s),i(u,"BrowserOfflineError"),N.ServerDownError=l,n(l,s),i(l,"ServerDownError"),N.NetworkDownError=c,n(c,s),i(c,"NetworkDownError");var k={"try":e,ajax:_,ajax$:b,GeneralAjaxError:o,make:w};k.version="1.1.0";for(var A in N)k[A]=N[A];return k}),define("wed/ajax",["require","exports","module","bluejax","jquery","bootstrap"],function(e,t,r,n,i){"use strict";function o(e){function t(t){if(arguments.length>1)throw new Error("we do not support passing the url as a separate argument; please use a single settings argument");var r=i.call(void 0,t);return r.promise=r.promise["catch"](n.ConnectivityError,function(t){document.body.appendChild(s);var n=s.querySelector("span.reason");n.textContent=t.message,a.on("hide.bs.modal.modal",function(t){t.stopPropagation(),t.preventDefault(),o(e.diagnose.serverURL).then(function(){window.location.reload()}).suppressUnhandledRejections()}),a.modal(),r.promise.cancel()}),r}function r(e){return t(e).promise}var i=n.make(e),o=n.make({diagnose:{on:!0,knownServers:e.diagnose.knownServers}},"promise");return{ajax:r,ajax$:t}}Object.defineProperty(t,"__esModule",{value:!0});var a=i("<div class='modal btw-fatal-modal' style='position: absolute' tabindex='1'>  <div class='modal-dialog'>    <div class='modal-content'>      <div class='modal-header'>        <button type='button' class='close' data-dismiss='modal'aria-hidden='true'>&times;</button>        <h3>Connectivity Problem</h3>      </div>      <div class='modal-body'>        <p>We have detected a connectivity problem:            <span class='reason'></span>.</p>        <p>When you click the Ok button, we will recheck the connectivity.            If there is still a problem, this dialog will remain. Otherwise,            the window will be reloaded. If you were modifying information            on the            site when the outage occurred, please verify that what you were            trying to do actually happened.</p>      </div>      <div class='modal-footer'>        <a href='#' class='btn btn-primary' data-dismiss='modal'>Ok</a>      </div>    </div>  </div></div>"),s=a[0];t.make=o}),define("wed/runtime",["require","exports","module","bluebird","dexie","merge-options","./ajax","./util"],function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function t(e){e=o({},e),this.options=e;var t=null!=e.bluejaxOptions?e.bluejaxOptions:{tries:3,delay:100,diagnose:{on:!0,knownServers:["http://www.google.com/","http://www.cloudfront.com/"]}},r=a.make(t);this.ajax=r.ajax,this.ajax$=r.ajax$}return t.prototype.resolve=function(e){var t=this;return n.resolve().then(function(){var r=e.indexOf("://");if(-1===r)return t.ajax({url:e,dataType:"text"});var n=e.substr(0,r);if("indexeddb"===n){var o=e.substr(r+3),a=o.split("/"),s=a[0],u=a[1],l=a[2],c=a[3],h=a[4],d=a[5];if("v1"!==s)throw new Error("unsupported version number: "+s);switch(c){case"string":break;case"number":h=Number(h);break;default:throw new Error("unknown type: "+c)}var p=new i.Dexie(u);return p.open().then(function(){return p.table(l).get(h)}).then(function(t){if(null==t)throw Error("cannot resolve key from: "+e);if(void 0===d)return t;if(!(d in t))throw Error("cannot resolve property in the record of: "+e);return t[d]})}throw new Error("unknown scheme: "+n)})},t.prototype.resolveToString=function(e){return this.resolve(e).then(function(e){return"string"==typeof e?e:e instanceof File?s.readFile(e):String(e)})},t.prototype.resolveModules=function(t){return n.resolve().then(function(){return t instanceof Array||(t=[t]),new n(function(r,n){e(t,function(){r(Array.prototype.slice.call(arguments))},n)})})},t}();t.Runtime=u}),define("wed/caret-mark",["require","exports","module","jquery","./domtypeguards","./wed-util"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,r,i,o){this.manager=e,this.layer=r,this.inputField=i,this.scroller=o,this.suspended=0,this.pendingRefresh=!1;var a=this.el=t.createElement("span");a.className="_wed_caret",a.setAttribute("contenteditable","false"),a.textContent=" ";var s=this.dummy=t.createElement("span");s.textContent="",s.style.height="100%",s.style.width="1px",s.style.maxWidth="1px",this.$dummy=n(s),this.boundRefresh=this.refresh.bind(this)}return e.prototype.suspend=function(){this.suspended++},e.prototype.resume=function(){if(this.suspended--,this.suspended<0)throw new Error("too many calls to resume");this.pendingRefresh&&(this.refresh(),this.pendingRefresh=!1)},e.prototype.refresh=function(){if(this.suspended>0)return void(this.pendingRefresh=!0);var e=this.manager.caret;if(null!=e){var t=o.boundaryXY(e),r=this.scroller.getBoundingClientRect(),n={top:t.top-r.top,left:t.left-r.left},a=e.node,s=i.isElement(a)?a:a.parentNode,u=getComputedStyle(s).lineHeight,l=this.el,c=n.top+"px",h=n.left+"px";l.style.top=c,l.style.left=h,l.style.height=u,l.style.maxHeight=u,l.style.minHeight=u,null===l.parentNode&&this.layer.append(this.el);var d=this.inputField;Number(d.style.zIndex)>0?(d.style.top=c,d.style.left=h):(d.style.top="",d.style.left="")}},e.prototype.getPositionFromScroller=function(){var e=this.el,t={left:Number(e.style.left.replace("px","")),top:Number(e.style.top.replace("px",""))};if(isNaN(t.left)||isNaN(t.top))throw new Error("NAN for left or top");return t.left+=this.scroller.scrollLeft,t.top+=this.scroller.scrollTop,t},Object.defineProperty(e.prototype,"inDOM",{get:function(){return null!==this.el.parentNode},enumerable:!0,configurable:!0}),e.prototype.scrollIntoView=function(){var e=this.getPositionFromScroller(),t=this.getBoundingClientRect();this.scroller.scrollIntoView(e.left,e.top,e.left+t.width,e.top+t.height)},e.prototype.getBoundingClientRect=function(){return this.el.getBoundingClientRect()},e}();t.CaretMark=a}),define("wed/caret-movement",["require","exports","module","./domtypeguards","./domutil","./wed-util"],function(e,t,r,n,i,o){"use strict";function a(e,t,r){var n=i.closestByClass(e.node,"_placeholder",t);if(null!==n){var o=n.parentNode,a=i.indexOf(o.childNodes,n);r&&a++,e=e.make(o,a)}return e}function s(e){var t=e.firstChild;if(!n.isElement(t))throw new Error("docRoot does not contain an element");return t.classList.contains("_placeholder")&&(t=e),t}function u(e,t,r){var n=r.nodesAroundEditableContents(e),o=n[0],a=n[1];return null!==o&&i.indexOf(e.childNodes,o)>=t?!1:null!==a&&i.indexOf(e.childNodes,a)<t?!1:!0}function l(e,t){if(void 0===t||void 0===e)return!1;var r=t.firstChild,i=e.lastChild;return n.isElement(r)&&r.classList.contains("_gui")&&!r.classList.contains("_invisible")&&n.isElement(i)&&i.classList.contains("_gui")&&!i.classList.contains("_invisible")}function c(e,t){for(var r=Array.prototype.slice.call(e),n=0,i=r;n<i.length;n++){var o=i[n];if(0!==(o.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING))return o}}function h(e,t,r,n,i){var o=v[t];if(void 0===o)throw new Error("cannot resolve direction: "+t);return o(e,r,n,i)}function d(e,t,r,h){if(null!=e){var d=e.root;e=a(e,d,!0);for(var p=s(r);;){var f=i.closestByClass(e.node,"_gui",d),m=i.nextCaretPosition(e.toArray(),p,!1);if(null===m){e=null;break}e=e.make(m);var v=e.node,y=e.offset,g=i.closest(v,"._gui:not(._invisible)",d);if(null!==g){var _=g.classList.contains("__start_label");if(t&&_){if(null!==i.closestByClass(v,"_attribute_value",d))break;if(null!==i.closest(v,"._element_name, ._attribute",d)){var b=c(g.getElementsByClassName("_attribute"),v);if(void 0!==b){var w=o.getAttrValueNode(i.childByClass(b,"_attribute_value"));e=e.make(w,0);break}}}if(f===g){e=e.make(g,g.childNodes.length);continue}e=e.make(_||null!==i.closestByClass(v,"_label",g)?v.getElementsByClassName("_element_name")[0]:g,0);break}var E=i.closestByClass(v,"_phantom",d);if(null===E){var x=i.closestByClass(v,"_placeholder",d);if(!(null!==x&&y>0)){if(n.isElement(v)){var N=v.childNodes[y];if(n.isText(N))continue;var S=v.childNodes[y-1];if(l(S,N))break;if(n.isElement(S)&&(n.isElement(N)&&!N.classList.contains("_end_wrapper")&&!S.classList.contains("_start_wrapper")||S.matches("._wed-validation-error, ._gui.__end_label")))continue;if(!u(v,y,h))continue}break}e=e.make(x,x.childNodes.length)}else e=e.make(E,E.childNodes.length)}return null!==e?e:void 0}}function p(e,t,r,o){if(null!=e){var c=e.root;e=a(e,c,!1);for(var h=s(r);;){var d=i.closestByClass(e.node,"_element_name",c),p=e.node===d&&0===e.offset,f=i.prevCaretPosition(e.toArray(),h,!1);if(null===f){e=null;break}e=e.make(f);var m=e.node,v=e.offset,y=i.closest(m,"._gui:not(._invisible)",c);if(null===y){var g=i.closestByClass(m,"_placeholder",c);if(null!==g){e=e.make(g.firstChild,0);break}var _=i.closestByClass(m,"_phantom",c);if(null===_){if(n.isElement(m)){var b=m.childNodes[v-1];if(n.isText(b))continue;var w=m.childNodes[v];if(l(b,w))break;if(n.isElement(w)&&(n.isElement(b)&&!b.classList.contains("_start_wrapper")&&!w.classList.contains("_end_wrapper")||w.matches("._gui.__start_label, .wed-validation-error")))continue;if(!u(m,v,o))continue}break}e=e.make(_,0)}else{var E=y.classList.contains("__start_label");if(t&&E&&!p){if(null!==i.closestByClass(m,"_attribute_value",y))break;var x=i.closestByClass(m,"_attribute",y);null===x&&n.isElement(m)&&null!==m.nextElementSibling&&m.nextElementSibling.classList.contains("_attribute")&&(x=m.nextElementSibling),null===x&&(d=i.closestByClass(m,"_element_name",y),x=null!==d?d.nextElementSibling:null);var N=null!==x?x.previousElementSibling:null;if(null===N){var S=y.getElementsByClassName("_attribute");S.length>0&&(N=S[S.length-1])}if(null===N||N.classList.contains("_attribute")||(N=null),null!==N){var C=i.childByClass(N,"_attribute_value");if(v=0,null!==C.lastChild)if(C=C.lastChild,n.isElement(C)&&C.classList.contains("_placeholder"))v=0;else{if(!n.isText(C))throw new Error("unexpected content in attribute value");v=C.length}e=e.make(C,v);break}}if(!p){e=e.make(E||null!==i.closestByClass(m,"_label",y)?y.getElementsByClassName("_element_name")[0]:y,0);break}e=e.make(y,0)}}return null!==e?e:void 0}}function f(e,t,r,n){if(null!=e){for(var i=o.boundaryXY(e),a=i;i.bottom>a.top;){if(e=d(e,t,r,n),void 0===e)return;a=o.boundaryXY(e)}for(var s,u=a.bottom,l=1/0;void 0!==e;){var c=Math.abs(a.left-i.left);if(c>l)break;if(u<=a.top)break;l=c,s=e,e=d(e,t,r,n),void 0!==e&&(a=o.boundaryXY(e))}return s}}function m(e,t,r,n){if(null!=e){for(var i=o.boundaryXY(e),a=i;i.top<a.bottom;){if(e=p(e,t,r,n),void 0===e)return;a=o.boundaryXY(e)}for(var s,u=a.top,l=1/0;void 0!==e;){var c=Math.abs(a.left-i.left);if(c>l)break;if(a.bottom<=u)break;l=c,s=e,e=p(e,t,r,n),void 0!==e&&(a=o.boundaryXY(e))}return s}}Object.defineProperty(t,"__esModule",{value:!0});var v={right:d,left:p,up:m,down:f};t.newPosition=h,t.positionRight=d,t.positionLeft=p,t.positionDown=f,t.positionUp=m}),define("wed/wed-selection",["require","exports","module","./domutil"],function(e,t,r,n){"use strict";
Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,r){this.converter=e,this.anchor=t,this.focus=void 0===r?t:r}return Object.defineProperty(e.prototype,"range",{get:function(){var e=this.rangeInfo;if(void 0!==e)return e.range},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeInfo",{get:function(){return this.anchor.makeRange(this.focus)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collapsed",{get:function(){return this.anchor.equals(this.focus)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wellFormed",{get:function(){var e=this.range;return void 0===e?!1:n.isWellFormedRange(e)},enumerable:!0,configurable:!0}),e.prototype.asDataCarets=function(){var e=this.range;if(void 0!==e){var t=this.converter.toDataLocation(e.startContainer,e.startOffset),r=this.converter.toDataLocation(e.endContainer,e.endOffset);if(void 0!==t&&void 0!==r)return[t,r]}},e.prototype.equals=function(e){return null==e?!1:this.focus.equals(e.focus)&&this.anchor.equals(e.anchor)},e}();t.WedSelection=i}),define("wed/caret-manager",["require","exports","module","jquery","rangy","rxjs","./browsers","./caret-mark","./caret-movement","./dloc","./domtypeguards","./domutil","./object-check","./wed-selection","./wed-util"],function(e,t,r,n,i,o,a,s,u,l,c,h,d,p,f){"use strict";function m(e){if(!c.isElement(e))return null;for(var t=e.previousSibling;null!==t&&!(c.isText(t)||c.isElement(t)&&t.classList.contains("_real"));)t=t.previousSibling;return t}Object.defineProperty(t,"__esModule",{value:!0});var v={textEdit:!1},y=function(){function e(e,t,r,i,a,u,l,c){var h=this;this.guiRoot=e,this.dataRoot=t,this.inputField=r,this.guiUpdater=i,this.inAttributes=l,this.mode=c,this.selectionStack=[],this.mark=new s.CaretMark(this,e.node.ownerDocument,a,r,u),u.events.subscribe(function(){h.mark.refresh()}),this.guiRootEl=e.node,this.dataRootEl=t.node,this.doc=this.guiRootEl.ownerDocument,this.win=this.doc.defaultView,this.$inputField=n(this.inputField),this._events=new o.Subject,this.events=this._events.asObservable(),n(this.guiRootEl).on("focus",function(e){h.focusInputField(),e.preventDefault(),e.stopPropagation()}),n(this.win).on("blur.wed",this.onBlur.bind(this)),n(this.win).on("focus.wed",this.onFocus.bind(this))}return Object.defineProperty(e.prototype,"caret",{get:function(){return this.focus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sel",{get:function(){return this._sel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focus",{get:function(){return void 0!==this._sel?this._sel.focus:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return void 0!==this._sel?this._sel.anchor:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"range",{get:function(){var e=this.rangeInfo;return void 0!==e?e.range:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeInfo",{get:function(){var e=this._sel;if(void 0!==e)return e.rangeInfo},enumerable:!0,configurable:!0}),e.prototype.getNormalizedCaret=function(){var e=this.caret;if(void 0===e)return e;if(this.guiRootEl.contains(e.node)){if(!e.isValid()){var t=new p.WedSelection(this,this.anchor,e.normalizeOffset());this._sel=t,e=t.focus}var r=this._normalizeCaret(e);return null==r?void 0:r}},e.prototype.normalizeToEditableRange=function(e){if(e.root!==this.guiRootEl)throw new Error("DLoc object must be for the GUI tree");var t=e.offset,r=e.node;if(c.isElement(r)){var n=this.mode.nodesAroundEditableContents(r),i=n[0],o=n[1],a=null!==i?h.indexOf(r.childNodes,i):-1;if(a>=t)t=a+1;else{var s=null!==o?h.indexOf(r.childNodes,o):r.childNodes.length;t>=s&&(t=s)}return e.makeWithOffset(t)}return e},e.prototype.getDataCaret=function(e){var t=this.getNormalizedCaret();if(void 0!==t)return this.toDataLocation(t,e)},e.prototype.fromDataLocation=function(e,t){if(e instanceof l.DLoc&&(t=e.offset,e=e.node),void 0===t)throw new Error("offset is undefined");var r=this.guiUpdater.fromDataLocation(e,t);if(null!==r){var n=r.offset;if(e=r.node,c.isElement(e)){var i=this.mode.nodesAroundEditableContents(e),o=i[0],a=i[1],s=null!==o?h.indexOf(e.childNodes,o):-1;if(s>=n)n=s+1;else{var u=null!==a?h.indexOf(e.childNodes,a):e.childNodes.length;n>=u&&(n=u)}return r.makeWithOffset(n)}return r}},e.prototype.toDataLocation=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var n,i;if(e instanceof l.DLoc){if("boolean"!=typeof t)throw new Error("2nd argument must be a boolean");r=t,t=e.offset,n=e.node,i=e.root}else n=e;if("number"!=typeof t)throw new Error("offset must be a number");var o=this.makeCaret(n,t);if(null===h.closestByClass(n,"_attribute_value",i)){var a=h.closestByClass(n,"_phantom_wrap",i);if(null!==a)o=this.makeCaret(a.getElementsByClassName("_real")[0]);else{for(var s=void 0,u=c.isText(n)?n.parentNode:n;null!==u&&u!==this.guiRootEl;){if(u.classList.contains("_phantom")||u.classList.contains("_gui")){if(!r)return;s=u}u=u.parentNode}void 0!==s&&(o=this.makeCaret(s))}}var d=this._normalizeCaret(o);if(null!=d){n=d.node,t=d.offset;var p=this.dataRoot.pathToNode(this.guiRoot.nodeToPath(n));if(c.isText(n))return this.makeCaret(p,t,!0);if(t>=n.childNodes.length)return null===p?void 0:this.makeCaret(p,p.childNodes.length);var f=n.childNodes[t];if(c.isElement(f)&&!f.classList.contains("_real")){var v=m(f);if(null===v)return this.makeCaret(p,0);if(p=this.dataRoot.pathToNode(this.guiRoot.nodeToPath(v)),null===p)return;var y=p.parentNode;return this.makeCaret(y,h.indexOf(y.childNodes,p)+1)}return p=this.dataRoot.pathToNode(this.guiRoot.nodeToPath(f)),this.makeCaret(p,c.isAttr(p)?t:void 0)}},e.prototype._normalizeCaret=function(e){if(null==e)return e;var t=h.closestByClass(e.node,"_placeholder",e.root);return null!==t?e.make(t):e},e.prototype.makeCaret=function(e,t,r){if(void 0===r&&(r=!1),null!=e){var n=e;c.isAttr(e)&&(n=e.ownerElement);var i;if(this.guiRootEl.contains(n)?i=this.guiRoot:this.dataRootEl.contains(n)&&(i=this.dataRoot),void 0!==i)return l.DLoc.mustMakeDLoc(i,e,t,r)}},e.prototype.setRange=function(e,t,r,n){var i,o;if(e instanceof l.DLoc&&t instanceof l.DLoc?(i=e,o=t):(i=this.makeCaret(e,t),o=this.makeCaret(r,n)),void 0===i||void 0===o)throw new Error("must provide both anchor and focus");if(i.root===this.dataRootEl&&(i=this.fromDataLocation(i),o=this.fromDataLocation(o),void 0===i||void 0===o))throw new Error("cannot find GUI anchor and focus");var a=this._sel=new p.WedSelection(this,i,o);if(void 0===this.prevCaret||!this.prevCaret.equals(o)){this.mark.refresh();var s=a.rangeInfo;if(void 0===s)throw new Error("unable to make a range");this._setDOMSelectionRange(s.range,s.reversed)}this._caretChange()},e.prototype.newPosition=function(e,t){return u.newPosition(e,t,this.inAttributes,this.guiRootEl,this.mode)},e.prototype.newCaretPosition=function(e){return this.newPosition(this.caret,e)},e.prototype.move=function(e,t){void 0===t&&(t=!1);var r=this.newCaretPosition(e);if(void 0!==r)if(t){var n=this.anchor;void 0!==n&&this.setRange(n,r)}else this.setCaret(r)},e.prototype.setCaret=function(e,t,r){var n;if(e instanceof l.DLoc){if(n=e,"number"==typeof t)throw new Error("2nd argument must be options");r=t,t=void 0}else{if(void 0!==t&&"number"!=typeof t)throw new Error("2nd argument must be number");var i=this.makeCaret(e,t);if(void 0===i)return;n=i}if(void 0!==r){var o=d.check(v,r);if(void 0!==o.missing)throw new Error("there are missing options");if(void 0!==o.extra)throw new Error("unknown options passed to setCaret: "+o.extra.join(","))}else r={};this._setGUICaret(n.root===this.guiRootEl?n:this.fromDataLocation(n),r)},e.prototype.setCaretToLabelPosition=function(e,t,r){var n,i=0,o=h.closestByClass(e,"_attribute",t);null!==o?null!==h.closestByClass(r.node,"_attribute_value",t)?(n=r.node,i=r.offset):n=f.getAttrValueNode(o.getElementsByClassName("_attribute_value")[0]):n=t.getElementsByClassName("_element_name")[0],this.setCaret(n,i)},e.prototype.pushSelection=function(){this.selectionStack.push(this._sel),a.MSIE_TO_10&&this._clearDOMSelection()},e.prototype.popSelection=function(){this._sel=this.selectionStack.pop(),this._restoreCaretAndSelection(!1)},e.prototype.popSelectionAndDiscard=function(){this.selectionStack.pop()},e.prototype._restoreCaretAndSelection=function(e){if(void 0!==this.caret&&void 0!==this.anchor&&this.guiRootEl.contains(this.anchor.node)){var t=this.rangeInfo;if(void 0===t)throw new Error("could not make a range");this._setDOMSelectionRange(t.range,t.reversed),this.mark.refresh(),t.range.collapsed&&this.focusInputField(),this._caretChange({focus:e})}else this.clearSelection()},e.prototype.clearSelection=function(){this._sel=void 0,this.mark.refresh();var e=this._getDOMSelection();e.rangeCount>0&&this.guiRootEl.contains(e.focusNode)&&e.removeAllRanges(),this._caretChange()},e.prototype._getDOMSelectionRange=function(){var e=h.getSelectionRange(this.win);if(void 0!==e&&this.guiRootEl.contains(e.startContainer)&&this.guiRootEl.contains(e.endContainer))return e},e.prototype._setDOMSelectionRange=function(e,t){if(e.collapsed)return void this._clearDOMSelection();a.FIREFOX&&h.focusNode(e.endContainer),a.MSIE_TO_10&&this._clearDOMSelection();var r=this._getDOMSelection();r.setSingleRange(e,t)},e.prototype._setGUICaret=function(e,t){var r=e.offset,n=e.node;if(c.isElement(n)){if(n.classList.contains("_attribute_value")){var i=f.getAttrValueNode(n);n!==i&&(n=i,e=e.make(n,r))}var o=h.childByClass(n,"_placeholder");null===o||o.classList.contains("_dying")||(n=o,r=0,e=e.make(n,r))}(void 0===this.caret||this.anchor!==this.caret||this.caret.node!==n||this.caret.offset!==r)&&(this._clearDOMSelection(!0),this._sel=new p.WedSelection(this,e),this.mark.refresh(),this.focusInputField(),this._caretChange(t))},e.prototype._caretChange=function(e){void 0===e&&(e={});var t=this.prevCaret,r=this.caret;void 0!==t&&t.equals(r)||(this._events.next({manager:this,caret:r,prevCaret:t,options:e}),this.prevCaret=r)},e.prototype._clearDOMSelection=function(e){void 0===e&&(e=!1),this._getDOMSelection().removeAllRanges(),e||this.focusInputField()},e.prototype._getDOMSelection=function(){return i.getSelection(this.win)},e.prototype.focusInputField=function(){this.win.focus(),this.$inputField.blur(),this.$inputField.focus()},e.prototype.onBlur=function(){void 0!==this.caret&&(this.selAtBlur=this._sel,this.$inputField.blur(),this._sel=void 0,this.mark.refresh())},e.prototype.onFocus=function(){void 0!==this.selAtBlur&&(this._sel=this.selAtBlur,this._restoreCaretAndSelection(!0),this.selAtBlur=void 0)},e.prototype.dumpCaretInfo=function(){var e=this.getDataCaret();void 0!==e?console.log("data caret",e.node,e.offset):console.log("no data caret"),void 0!==this.anchor?console.log("selection anchor",this.anchor.node,this.anchor.offset):console.log("no selection anchor");var t=this.caret;if(void 0!==t){var r=t.node,n=t.offset;if(console.log("selection focus",r,n),console.log("selection focus closest real",h.closestByClass(r,"_real",this.guiRootEl)),c.isText(r)&&n<r.data.length){var i=this.doc.createRange();i.setStart(r,n),i.setEnd(r,n+1);var o=i.getBoundingClientRect();console.log("rectangle around character at caret:",o)}}else console.log("no selection focus");h.dumpRange("DOM range: ",this._getDOMSelectionRange()),console.log("input field location",this.inputField.style.top,this.inputField.style.left),console.log("document.activeElement",document.activeElement)},e}();t.CaretManager=y}),define("wed/gui/layer",["require","exports","module"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.el=e}return e.prototype.clear=function(){for(var e=this.el;null!==e.lastChild;)e.removeChild(e.lastChild)},e.prototype.append=function(e){this.el.appendChild(e)},e}();t.Layer=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui/error-layer",["require","exports","module","./layer"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){var r=e.call(this,t)||this;return r.el=t,r}return __extends(t,e),t.prototype.select=function(e){if(e.parentNode!==this.el)throw new Error("marker is not a child of the layer element");this.unselectAll(),e.classList.add("selected")},t.prototype.unselectAll=function(){for(var e=this.el.firstElementChild;null!==e;)e.classList.remove("selected"),e=e.nextElementSibling},t}(n.Layer);t.ErrorLayer=i}),define("wed/gui/scroller",["require","exports","module","rxjs","../domutil"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){var t=this;this.el=e,this._events=new n.Subject,this.events=this._events.asObservable(),$(e).on("scroll",function(){t._events.next({scroller:t})})}return Object.defineProperty(e.prototype,"scrollTop",{get:function(){return this.el.scrollTop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollLeft",{get:function(){return this.el.scrollLeft},enumerable:!0,configurable:!0}),e.prototype.getBoundingClientRect=function(){return this.el.getBoundingClientRect()},e.prototype.coerceHeight=function(e){var t=this.el,r=e+"px";t.style.maxHeight=r,t.style.minHeight=r},e.prototype.isPointInside=function(e,t){return i.pointInContents(this.el,e,t)},e.prototype.scrollIntoView=function(e,t,r,n){var i=this.el,o=i.scrollTop,a=i.clientHeight,s=o+a;(o>t||n>s)&&(o=o>t?t:n-a,i.scrollTop=o);var u=i.scrollLeft,l=i.clientWidth,c=u+l;(u>e||r>c)&&(u=u>e?e:r-l,i.scrollLeft=u);var h=i.getBoundingClientRect();e=e-u+h.left,r=r-u+h.left,t=t-o+h.top,n=n-o+h.top;var d=i.ownerDocument,p=d.body.scrollHeight,f=d.body.scrollWidth,m=0;(0>t||n>p)&&(m=0>t?t:n);var v=0;(0>e||r>f)&&(v=0>e?e:r),d.defaultView.scrollBy(v,m)},e}();t.Scroller=o}),!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("ajv",[],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Ajv=e()}(function(){return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[a]={exports:{}};t[a][0].call(c.exports,function(e){var r=t[a][1][e];return i(r||e)},c,c.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){"use strict";var n=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];t.exports=function(e,t){for(var r=0;r<t.length;r++){e=JSON.parse(JSON.stringify(e));var i,o=t[r].split("/"),a=e;for(i=1;i<o.length;i++)a=a[o[i]];for(i=0;i<n.length;i++){var s=n[i],u=a[s];u&&(a[s]={anyOf:[u,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/$data.json#"}]})}}return e}},{}],2:[function(e,t,r){"use strict";var n=t.exports=function(){this._cache={}};n.prototype.put=function(e,t){this._cache[e]=t},n.prototype.get=function(e){return this._cache[e]},n.prototype.del=function(e){delete this._cache[e]},n.prototype.clear=function(){this._cache={}}},{}],3:[function(e,t,r){"use strict";t.exports={$ref:e("../dotjs/ref"),allOf:e("../dotjs/allOf"),anyOf:e("../dotjs/anyOf"),"const":e("../dotjs/const"),contains:e("../dotjs/contains"),dependencies:e("../dotjs/dependencies"),"enum":e("../dotjs/enum"),format:e("../dotjs/format"),items:e("../dotjs/items"),maximum:e("../dotjs/_limit"),minimum:e("../dotjs/_limit"),maxItems:e("../dotjs/_limitItems"),minItems:e("../dotjs/_limitItems"),maxLength:e("../dotjs/_limitLength"),minLength:e("../dotjs/_limitLength"),maxProperties:e("../dotjs/_limitProperties"),minProperties:e("../dotjs/_limitProperties"),multipleOf:e("../dotjs/multipleOf"),not:e("../dotjs/not"),oneOf:e("../dotjs/oneOf"),pattern:e("../dotjs/pattern"),properties:e("../dotjs/properties"),propertyNames:e("../dotjs/propertyNames"),required:e("../dotjs/required"),uniqueItems:e("../dotjs/uniqueItems"),validate:e("../dotjs/validate")}},{"../dotjs/_limit":14,"../dotjs/_limitItems":15,"../dotjs/_limitLength":16,"../dotjs/_limitProperties":17,"../dotjs/allOf":18,"../dotjs/anyOf":19,"../dotjs/const":20,"../dotjs/contains":21,"../dotjs/dependencies":23,"../dotjs/enum":24,"../dotjs/format":25,"../dotjs/items":26,"../dotjs/multipleOf":27,"../dotjs/not":28,"../dotjs/oneOf":29,"../dotjs/pattern":30,"../dotjs/properties":31,"../dotjs/propertyNames":32,"../dotjs/ref":33,"../dotjs/required":34,"../dotjs/uniqueItems":35,"../dotjs/validate":36}],4:[function(e,t,r){"use strict";function n(e,t,r){function o(e){var t=e.$schema;return t&&!s.getSchema(t)?n.call(s,{$ref:t},!0):Promise.resolve()}function a(e){try{return s._compile(e)}catch(r){if(r instanceof i)return function(r){function n(){delete s._loadingSchemas[u]}function i(e){return s._refs[e]||s._schemas[e]}var u=r.missingSchema;if(i(u))throw new Error("Schema "+u+" is loaded but "+r.missingRef+" cannot be resolved");var l=s._loadingSchemas[u];return l||(l=s._loadingSchemas[u]=s._opts.loadSchema(u)).then(n,n),l.then(function(e){return i(u)?void 0:o(e).then(function(){i(u)||s.addSchema(e,u,void 0,t)})}).then(function(){return a(e)})}(r);throw r}}var s=this;if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");"function"==typeof t&&(r=t,t=void 0);var u=o(e).then(function(){var r=s._addSchema(e,void 0,t);return r.validate||a(r)});return r&&u.then(function(e){r(null,e)},r),u}var i=e("./error_classes").MissingRef;t.exports=n},{"./error_classes":6}],5:[function(e,t,r){"use strict";t.exports=function n(e,t){if(e===t)return!0;var r,i=Array.isArray(e),o=Array.isArray(t);if(i&&o){if(e.length!=t.length)return!1;for(r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}if(i!=o)return!1;if(e&&t&&"object"==typeof e&&"object"==typeof t){var a=Object.keys(e);if(a.length!==Object.keys(t).length)return!1;var s=e instanceof Date,u=t instanceof Date;if(s&&u)return e.getTime()==t.getTime();if(s!=u)return!1;var l=e instanceof RegExp,c=t instanceof RegExp;if(l&&c)return e.toString()==t.toString();if(l!=c)return!1;for(r=0;r<a.length;r++)if(!Object.prototype.hasOwnProperty.call(t,a[r]))return!1;for(r=0;r<a.length;r++)if(!n(e[a[r]],t[a[r]]))return!1;return!0}return!1}},{}],6:[function(e,t,r){"use strict";function n(e){this.message="validation failed",this.errors=e,this.ajv=this.validation=!0}function i(e,t,r){this.message=r||i.message(e,t),this.missingRef=a.url(e,t),this.missingSchema=a.normalizeId(a.fullPath(this.missingRef))}function o(e){return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var a=e("./resolve");t.exports={Validation:o(n),MissingRef:o(i)},i.message=function(e,t){return"can't resolve reference "+t+" from id "+e}},{"./resolve":9}],7:[function(e,t,r){"use strict";function n(e){return e="full"==e?"full":"fast",c.copy(n[e])}function i(e){var t=e.match(h);if(!t)return!1;var r=+t[1],n=+t[2];return r>=1&&12>=r&&n>=1&&n<=d[r]}function o(e,t){var r=e.match(p);if(!r)return!1;var n=r[1],i=r[2],o=r[3],a=r[5];return 23>=n&&59>=i&&59>=o&&(!t||a)}function a(e){var t=e.split(E);return 2==t.length&&i(t[0])&&o(t[1],!0)}function s(e){return e.length<=255&&f.test(e)}function u(e){return x.test(e)&&m.test(e)}function l(e){if(N.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}}var c=e("./util"),h=/^\d\d\d\d-(\d\d)-(\d\d)$/,d=[0,31,29,31,30,31,30,31,31,30,31,30,31],p=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d:\d\d)?$/i,f=/^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i,m=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?(?:\#(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?$/i,v=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@\/?]|%[0-9a-f]{2})*)?(?:\#(?:[a-z0-9\-._~!$&'"()*+,;=:@\/?]|%[0-9a-f]{2})*)?$/i,y=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#.\/;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\:[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\:[1-9][0-9]{0,3}|\*)?)*\})*$/i,g=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+\-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+\-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,_=/^(?:urn\:uuid\:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,b=/^(?:\/(?:[^~\/]|~0|~1)*)*$|^\#(?:\/(?:[a-z0-9_\-\.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,w=/^(?:0|[1-9][0-9]*)(?:\#|(?:\/(?:[^~\/]|~0|~1)*)*)$/;t.exports=n,n.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^[0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s][0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i,uri:/^(?:[a-z][a-z0-9+-.]*)(?:\:|\/)\/?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+-.]*:)?\/\/)?[^\s]*$/i,"uri-template":y,url:g,email:/^[a-z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:f,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:l,uuid:_,"json-pointer":b,"relative-json-pointer":w},n.full={date:i,time:o,"date-time":a,uri:u,"uri-reference":v,"uri-template":y,url:g,email:/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&''*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:s,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:l,uuid:_,"json-pointer":b,"relative-json-pointer":w};var E=/t|\s/i,x=/\/|\:/,N=/[^\\]\\Z/},{"./util":13}],8:[function(e,t,r){"use strict";function n(e,t,r,a){function w(){var e=B.validate,t=e.apply(null,arguments);return w.errors=e.errors,t}function E(e,r,i,o){var a=!r||r&&r.schema==e;if(r.schema!=t.schema)return n.call(A,e,r,i,o);var m=!0===e.$async,w=v({isTop:!0,schema:e,isRoot:a,baseId:o,root:r,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:f.MissingRef,RULES:H,validate:v,util:p,resolve:d,resolveRef:x,usePattern:T,useDefault:P,useCustomRule:k,opts:O,formats:$,self:A});w=h(I,l)+h(j,s)+h(M,u)+h(F,c)+w,O.processCode&&(w=O.processCode(w));var E;try{E=new Function("self","RULES","formats","root","refVal","defaults","customRules","co","equal","ucs2length","ValidationError",w)(A,H,$,t,I,M,F,y,_,g,b),I[0]=E}catch(e){throw console.error("Error compiling schema, function code:",w),e}return E.schema=e,E.errors=null,E.refs=R,E.refVal=I,E.root=a?E:r,m&&(E.$async=!0),!0===O.sourceCode&&(E.source={code:w,patterns:j,defaults:M}),E}function x(e,i,o){i=d.url(e,i);var a,s,u=R[i];if(void 0!==u)return a=I[u],s="refVal["+u+"]",C(a,s);if(!o&&t.refs){var l=t.refs[i];if(void 0!==l)return a=t.refVal[l],s=N(i,a),C(a,s)}s=N(i);var c=d.call(A,E,t,i);if(void 0===c){var h=r&&r[i];h&&(c=d.inlineRef(h,O.inlineRefs)?h:n.call(A,h,t,r,e))}return void 0!==c?(S(i,c),C(c,s)):void 0}function N(e,t){var r=I.length;return I[r]=t,R[e]=r,"refVal"+r}function S(e,t){I[R[e]]=t}function C(e,t){return"object"==typeof e||"boolean"==typeof e?{code:t,schema:e,inline:!0}:{code:t,$async:e&&e.$async}}function T(e){var t=D[e];return void 0===t&&(t=D[e]=j.length,j[t]=e),"pattern"+t}function P(e){switch(typeof e){case"boolean":case"number":return""+e;case"string":return p.toQuotedString(e);case"object":if(null===e)return"null";var t=m(e),r=L[t];return void 0===r&&(r=L[t]=M.length,M[r]=e),"default"+r}}function k(e,t,r,n){var i=e.definition.validateSchema;if(i&&!1!==A._opts.validateSchema&&!i(t)){var o="keyword schema is invalid: "+A.errorsText(i.errors);if("log"!=A._opts.validateSchema)throw new Error(o);console.error(o)}var a,s=e.definition.compile,u=e.definition.inline,l=e.definition.macro;if(s)a=s.call(A,t,r,n);else if(l)a=l.call(A,t,r,n),!1!==O.validateSchema&&A.validateSchema(a,!0);else if(u)a=u.call(A,n,e.keyword,t,r);else if(!(a=e.definition.validate))return;if(void 0===a)throw new Error('custom keyword "'+e.keyword+'"failed to compile');var c=F.length;return F[c]=a,{code:"customRule"+c,validate:a}}var A=this,O=this._opts,I=[void 0],R={},j=[],D={},M=[],L={},F=[];t=t||{schema:e,refVal:I,refs:R};var V=i.call(this,e,t,a),B=this._compilations[V.index];if(V.compiling)return B.callValidate=w;var $=this._formats,H=this.RULES;try{var W=E(e,t,r,a);B.validate=W;var q=B.callValidate;return q&&(q.schema=W.schema,q.errors=null,q.refs=W.refs,q.refVal=W.refVal,q.root=W.root,q.$async=W.$async,O.sourceCode&&(q.source=W.source)),W}finally{o.call(this,e,t,a)}}function i(e,t,r){var n=a.call(this,e,t,r);return n>=0?{index:n,compiling:!0}:(n=this._compilations.length,this._compilations[n]={schema:e,root:t,baseId:r},{index:n,compiling:!1})}function o(e,t,r){var n=a.call(this,e,t,r);n>=0&&this._compilations.splice(n,1)}function a(e,t,r){for(var n=0;n<this._compilations.length;n++){var i=this._compilations[n];if(i.schema==e&&i.root==t&&i.baseId==r)return n}return-1}function s(e,t){return"var pattern"+e+" = new RegExp("+p.toQuotedString(t[e])+");"}function u(e){return"var default"+e+" = defaults["+e+"];"}function l(e,t){return void 0===t[e]?"":"var refVal"+e+" = refVal["+e+"];"}function c(e){return"var customRule"+e+" = customRules["+e+"];"}function h(e,t){if(!e.length)return"";for(var r="",n=0;n<e.length;n++)r+=t(n,e);return r}var d=e("./resolve"),p=e("./util"),f=e("./error_classes"),m=e("json-stable-stringify"),v=e("../dotjs/validate"),y=e("co"),g=p.ucs2length,_=e("./equal"),b=f.Validation;t.exports=n},{"../dotjs/validate":36,"./equal":5,"./error_classes":6,"./resolve":9,"./util":13,co:47,"json-stable-stringify":48}],9:[function(e,t,r){"use strict";function n(e,t,r){var o=this._refs[r];if("string"==typeof o){if(!this._refs[o])return n.call(this,e,t,o);o=this._refs[o];
}if((o=o||this._schemas[r])instanceof g)return s(o.schema,this._opts.inlineRefs)?o.schema:o.validate||this._compile(o);var a,u,l,c=i.call(this,t,r);return c&&(a=c.schema,t=c.root,l=c.baseId),a instanceof g?u=a.validate||e.call(this,a.schema,t,void 0,l):void 0!==a&&(u=s(a,this._opts.inlineRefs)?a:e.call(this,a,t,void 0,l)),u}function i(e,t){var r=m.parse(t,!1,!0),n=h(r),i=c(this._getId(e.schema));if(n!==i){var s=d(n),u=this._refs[s];if("string"==typeof u)return o.call(this,e,u,r);if(u instanceof g)u.validate||this._compile(u),e=u;else{if(!((u=this._schemas[s])instanceof g))return;if(u.validate||this._compile(u),s==d(t))return{schema:u,root:e,baseId:i};e=u}if(!e.schema)return;i=c(this._getId(e.schema))}return a.call(this,r,i,e.schema,e)}function o(e,t,r){var n=i.call(this,e,t);if(n){var o=n.schema,s=n.baseId;e=n.root;var u=this._getId(o);return u&&(s=p(s,u)),a.call(this,r,s,o,e)}}function a(e,t,r,n){if("#/"==(e.hash=e.hash||"").slice(0,2)){for(var o=e.hash.split("/"),a=1;a<o.length;a++){var s=o[a];if(s){if(s=y.unescapeFragment(s),void 0===(r=r[s]))break;var u;if(!_[s]&&((u=this._getId(r))&&(t=p(t,u)),r.$ref)){var l=p(t,r.$ref),c=i.call(this,n,l);c&&(r=c.schema,n=c.root,t=c.baseId)}}}return void 0!==r&&r!==n.schema?{schema:r,root:n,baseId:t}:void 0}}function s(e,t){return!1!==t&&(void 0===t||!0===t?u(e):t?l(e)<=t:void 0)}function u(e){var t;if(Array.isArray(e)){for(var r=0;r<e.length;r++)if("object"==typeof(t=e[r])&&!u(t))return!1}else for(var n in e){if("$ref"==n)return!1;if("object"==typeof(t=e[n])&&!u(t))return!1}return!0}function l(e){var t,r=0;if(Array.isArray(e)){for(var n=0;n<e.length;n++)if("object"==typeof(t=e[n])&&(r+=l(t)),r==1/0)return 1/0}else for(var i in e){if("$ref"==i)return 1/0;if(b[i])r++;else if("object"==typeof(t=e[i])&&(r+=l(t)+1),r==1/0)return 1/0}return r}function c(e,t){return!1!==t&&(e=d(e)),h(m.parse(e,!1,!0))}function h(e){var t=e.protocol||"//"==e.href.slice(0,2)?"//":"";return(e.protocol||"")+t+(e.host||"")+(e.path||"")+"#"}function d(e){return e?e.replace(w,""):""}function p(e,t){return t=d(t),m.resolve(e,t)}function f(e){function t(e,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)t.call(this,e[o],r+"/"+o,i);else if(e&&"object"==typeof e){var a=this._getId(e);if("string"==typeof a){a=i=d(i?m.resolve(i,a):a);var s=this._refs[a];if("string"==typeof s&&(s=this._refs[s]),s&&s.schema){if(!v(e,s.schema))throw new Error('id "'+a+'" resolves to more than one schema')}else if(a!=d(r))if("#"==a[0]){if(n[a]&&!v(e,n[a]))throw new Error('id "'+a+'" resolves to more than one schema');n[a]=e}else this._refs[a]=r}for(var u in e)t.call(this,e[u],r+"/"+y.escapeFragment(u),i)}}var r=d(this._getId(e)),n={};return t.call(this,e,c(r,!1),r),n}var m=e("url"),v=e("./equal"),y=e("./util"),g=e("./schema_obj");t.exports=n,n.normalizeId=d,n.fullPath=c,n.url=p,n.ids=f,n.inlineRef=s,n.schema=i;var _=y.toHash(["properties","patternProperties","enum","dependencies","definitions"]),b=y.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]),w=/#\/?$/},{"./equal":5,"./schema_obj":11,"./util":13,url:45}],10:[function(e,t,r){"use strict";var n=e("./_rules"),i=e("./util").toHash;t.exports=function(){var e=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","uniqueItems","contains","items"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf"]}],t=["type"],r=["additionalItems","$schema","id","title","description","default","definitions"],o=["number","integer","string","array","object","boolean","null"];return e.all=i(t),e.types=i(o),e.forEach(function(r){r.rules=r.rules.map(function(r){var i;if("object"==typeof r){var o=Object.keys(r)[0];i=r[o],r=o,i.forEach(function(r){t.push(r),e.all[r]=!0})}return t.push(r),e.all[r]={keyword:r,code:n[r],"implements":i}}),r.type&&(e.types[r.type]=r)}),e.keywords=i(t.concat(r)),e.custom={},e}},{"./_rules":3,"./util":13}],11:[function(e,t,r){"use strict";function n(e){i.copy(e,this)}var i=e("./util");t.exports=n},{"./util":13}],12:[function(e,t,r){"use strict";t.exports=function(e){for(var t,r=0,n=e.length,i=0;n>i;)r++,(t=e.charCodeAt(i++))>=55296&&56319>=t&&n>i&&56320==(64512&(t=e.charCodeAt(i)))&&i++;return r}},{}],13:[function(e,t,r){"use strict";function n(e,t){t=t||{};for(var r in e)t[r]=e[r];return t}function i(e,t,r){var n=r?" !== ":" === ",i=r?" || ":" && ",o=r?"!":"",a=r?"":"!";switch(e){case"null":return t+n+"null";case"array":return o+"Array.isArray("+t+")";case"object":return"("+o+t+i+"typeof "+t+n+'"object"'+i+a+"Array.isArray("+t+"))";case"integer":return"(typeof "+t+n+'"number"'+i+a+"("+t+" % 1)"+i+t+n+t+")";default:return"typeof "+t+n+'"'+e+'"'}}function o(e,t){switch(e.length){case 1:return i(e[0],t,!0);default:var r="",n=s(e);n.array&&n.object&&(r=n["null"]?"(":"(!"+t+" || ",r+="typeof "+t+' !== "object")',delete n["null"],delete n.array,delete n.object),n.number&&delete n.integer;for(var o in n)r+=(r?" && ":"")+i(o,t,!0);return r}}function a(e,t){if(Array.isArray(t)){for(var r=[],n=0;n<t.length;n++){var i=t[n];S[i]?r[r.length]=i:"array"===e&&"array"===i&&(r[r.length]=i)}if(r.length)return r}else{if(S[t])return[t];if("array"===e&&"array"===t)return["array"]}}function s(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;return t}function u(e){return"number"==typeof e?"["+e+"]":C.test(e)?"."+e:"['"+l(e)+"']"}function l(e){return e.replace(T,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function c(e,t){t+="[^0-9]";var r=e.match(new RegExp(t,"g"));return r?r.length:0}function h(e,t,r){return t+="([^0-9])",r=r.replace(/\$/g,"$$$$"),e.replace(new RegExp(t,"g"),r+"$1")}function d(e){return e.replace(P,"").replace(k,"").replace(A,"if (!($1))")}function p(e,t){var r=e.match(O);return r&&2==r.length&&(e=t?e.replace(R,"").replace(M,L):e.replace(I,"").replace(j,D)),r=e.match(F),r&&3===r.length?e.replace(V,""):e}function f(e,t){if("boolean"==typeof e)return!e;for(var r in e)if(t[r])return!0}function m(e,t,r){if("boolean"==typeof e)return!e&&"not"!=r;for(var n in e)if(n!=r&&t[n])return!0}function v(e){return"'"+l(e)+"'"}function y(e,t,r,n){return b(e,r?"'/' + "+t+(n?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):n?"'[' + "+t+" + ']'":"'[\\'' + "+t+" + '\\']'")}function g(e,t,r){return b(e,v(r?"/"+x(t):u(t)))}function _(e,t,r){var n,i,o,a;if(""===e)return"rootData";if("/"==e[0]){if(!B.test(e))throw new Error("Invalid JSON-pointer: "+e);i=e,o="rootData"}else{if(!(a=e.match($)))throw new Error("Invalid JSON-pointer: "+e);if(n=+a[1],"#"==(i=a[2])){if(n>=t)throw new Error("Cannot access property/index "+n+" levels up, current level is "+t);return r[t-n]}if(n>t)throw new Error("Cannot access data "+n+" levels up, current level is "+t);if(o="data"+(t-n||""),!i)return o}for(var s=o,l=i.split("/"),c=0;c<l.length;c++){var h=l[c];h&&(s+=" && "+(o+=u(N(h))))}return s}function b(e,t){return'""'==e?t:(e+" + "+t).replace(/' \+ '/g,"")}function w(e){return N(decodeURIComponent(e))}function E(e){return encodeURIComponent(x(e))}function x(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function N(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}t.exports={copy:n,checkDataType:i,checkDataTypes:o,coerceToTypes:a,toHash:s,getProperty:u,escapeQuotes:l,equal:e("./equal"),ucs2length:e("./ucs2length"),varOccurences:c,varReplace:h,cleanUpCode:d,finalCleanUpCode:p,schemaHasRules:f,schemaHasRulesExcept:m,toQuotedString:v,getPathExpr:y,getPath:g,getData:_,unescapeFragment:w,escapeFragment:E,escapeJsonPointer:x};var S=s(["string","number","integer","boolean","null"]),C=/^[a-z$_][a-z$_0-9]*$/i,T=/'|\\/g,P=/else\s*{\s*}/g,k=/if\s*\([^)]+\)\s*\{\s*\}(?!\s*else)/g,A=/if\s*\(([^)]+)\)\s*\{\s*\}\s*else(?!\s*if)/g,O=/[^v\.]errors/g,I=/var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g,R=/var errors = 0;|var vErrors = null;/g,j="return errors === 0;",D="validate.errors = null; return true;",M=/if \(errors === 0\) return data;\s*else throw new ValidationError\(vErrors\);/,L="return data;",F=/[^A-Za-z_$]rootData[^A-Za-z0-9_$]/g,V=/if \(rootData === undefined\) rootData = data;/,B=/^\/(?:[^~]|~0|~1)*$/,$=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/},{"./equal":5,"./ucs2length":12}],14:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d=e.opts.$data&&s&&s.$data;d?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s;var p="maximum"==t,f=p?"exclusiveMaximum":"exclusiveMinimum",m=e.schema[f],v=e.opts.$data&&m&&m.$data,y=p?"<":">",g=p?">":"<",_=void 0;if(v){var b=e.util.getData(m.$data,a,e.dataPathArr),w="exclusive"+o,E="exclType"+o,x="exclIsNumber"+o,N="' + "+(S="op"+o)+" + '";i+=" var schemaExcl"+o+" = "+b+"; ",i+=" var "+w+"; var "+E+" = typeof "+(b="schemaExcl"+o)+"; if ("+E+" != 'boolean' && "+E+" != 'undefined' && "+E+" != 'number') { ",_=f,(C=C||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(_||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(i+=" , message: '"+f+" should be boolean' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",T=i,i=C.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+T+"]); ":" validate.errors = ["+T+"]; return false; ":" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" "+E+" == 'number' ? ( ("+w+" = "+n+" === undefined || "+b+" "+y+"= "+n+") ? "+h+" "+g+"= "+b+" : "+h+" "+g+" "+n+" ) : ( ("+w+" = "+b+" === true) ? "+h+" "+g+"= "+n+" : "+h+" "+g+" "+n+" ) || "+h+" !== "+h+") { var op"+o+" = "+w+" ? '"+y+"' : '"+y+"=';"}else if(N=y,(x="number"==typeof m)&&d)S="'"+N+"'",i+=" if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" ( "+n+" === undefined || "+m+" "+y+"= "+n+" ? "+h+" "+g+"= "+m+" : "+h+" "+g+" "+n+" ) || "+h+" !== "+h+") { ";else{x&&void 0===s?(w=!0,_=f,l=e.errSchemaPath+"/"+f,n=m,g+="="):(x&&(n=Math[p?"min":"max"](m,s)),m===(!x||n)?(w=!0,_=f,l=e.errSchemaPath+"/"+f,g+="="):(w=!1,N+="="));var S="'"+N+"'";i+=" if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" "+h+" "+g+" "+n+" || "+h+" !== "+h+") { "}_=_||t;var C=C||[];C.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(_||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { comparison: "+S+", limit: "+n+", exclusive: "+w+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be "+N+" ",i+=d?"' + "+n:n+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+u:""+s,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var T=i;return i=C.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+T+"]); ":" validate.errors = ["+T+"]; return false; ":" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",c&&(i+=" else { "),i}},{}],15:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d=e.opts.$data&&s&&s.$data;d?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s;var p="maxItems"==t?">":"<";i+="if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" "+h+".length "+p+" "+n+") { ";var f=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(f||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxItems"==t?"more":"less",i+=" than ",i+=d?"' + "+n+" + '":""+s,i+=" items' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+u:""+s,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var v=i;return i=m.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},{}],16:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d=e.opts.$data&&s&&s.$data;d?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s;var p="maxLength"==t?">":"<";i+="if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=!1===e.opts.unicode?" "+h+".length ":" ucs2length("+h+") ",i+=" "+p+" "+n+") { ";var f=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(f||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT be ",i+="maxLength"==t?"longer":"shorter",i+=" than ",i+=d?"' + "+n+" + '":""+s,i+=" characters' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+u:""+s,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var v=i;return i=m.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},{}],17:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d=e.opts.$data&&s&&s.$data;d?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s;var p="maxProperties"==t?">":"<";i+="if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" Object.keys("+h+").length "+p+" "+n+") { ";var f=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(f||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxProperties"==t?"more":"less",i+=" than ",i+=d?"' + "+n+" + '":""+s,i+=" properties' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+u:""+s,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var v=i;return i=m.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},{}],18:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),a=e.errSchemaPath+"/"+t,s=!e.opts.allErrors,u=e.util.copy(e),l="",c="valid"+ ++u.level,h=u.baseId,d=!0,p=i;if(p)for(var f,m=-1,v=p.length-1;v>m;)f=p[m+=1],e.util.schemaHasRules(f,e.RULES.all)&&(d=!1,u.schema=f,u.schemaPath=o+"["+m+"]",u.errSchemaPath=a+"/"+m,n+="  "+e.validate(u)+" ",u.baseId=h,s&&(n+=" if ("+c+") { ",l+="}"));return s&&(n+=d?" if (true) { ":" "+l.slice(0,-1)+" "),n=e.util.cleanUpCode(n)}},{}],19:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="",m="valid"+ ++p.level;if(a.every(function(t){return e.util.schemaHasRules(t,e.RULES.all)})){var v=p.baseId;n+=" var "+d+" = errors; var "+h+" = false;  ";var y=e.compositeRule;e.compositeRule=p.compositeRule=!0;var g=a;if(g)for(var _,b=-1,w=g.length-1;w>b;)_=g[b+=1],p.schema=_,p.schemaPath=s+"["+b+"]",p.errSchemaPath=u+"/"+b,n+="  "+e.validate(p)+" ",p.baseId=v,n+=" "+h+" = "+h+" || "+m+"; if (!"+h+") { ",f+="}";e.compositeRule=p.compositeRule=y,n+=" "+f+" if (!"+h+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(n+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; "),n+=" } else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } ",e.opts.allErrors&&(n+=" } "),n=e.util.cleanUpCode(n)}else l&&(n+=" if (true) { ");return n}},{}],20:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d=e.opts.$data&&a&&a.$data;d&&(n+=" var schema"+i+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; "),d||(n+=" var schema"+i+" = validate.schema"+s+";"),n+="var "+h+" = equal("+c+", schema"+i+"); if (!"+h+") {   ";var p=p||[];p.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should be equal to constant' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var f=n;return n=p.pop(),n+=!e.compositeRule&&l?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }",l&&(n+=" else { "),n}},{}],21:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="valid"+ ++p.level,m="i"+i,v=p.dataLevel=e.dataLevel+1,y="data"+v,g=e.baseId,_=e.util.schemaHasRules(a,e.RULES.all);if(n+="var "+d+" = errors;var "+h+";",_){var b=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.schema=a,p.schemaPath=s,p.errSchemaPath=u,n+=" var "+f+" = false; for (var "+m+" = 0; "+m+" < "+c+".length; "+m+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers,!0);var w=c+"["+m+"]";p.dataPathArr[v]=m;var E=e.validate(p);p.baseId=g,n+=e.util.varOccurences(E,y)<2?" "+e.util.varReplace(E,y,w)+" ":" var "+y+" = "+w+"; "+E+" ",n+=" if ("+f+") break; }  ",e.compositeRule=p.compositeRule=b,n+="  if (!"+f+") {"}else n+=" if ("+c+".length == 0) {";var x=x||[];x.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should contain a valid item' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var N=n;return n=x.pop(),n+=!e.compositeRule&&l?e.async?" throw new ValidationError(["+N+"]); ":" validate.errors = ["+N+"]; return false; ":" var err = "+N+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { ",_&&(n+="  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } "),e.opts.allErrors&&(n+=" } "),n=e.util.cleanUpCode(n)}},{}],22:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i,o=" ",a=e.level,s=e.dataLevel,u=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,h=!e.opts.allErrors,d="data"+(s||""),p="valid"+a,f="errs__"+a,m=e.opts.$data&&u&&u.$data;m?(o+=" var schema"+a+" = "+e.util.getData(u.$data,s,e.dataPathArr)+"; ",i="schema"+a):i=u;var v,y,g,_,b,w=this,E="definition"+a,x=w.definition,N="";if(m&&x.$data){b="keywordValidate"+a;var S=x.validateSchema;o+=" var "+E+" = RULES.custom['"+t+"'].definition; var "+b+" = "+E+".validate;"}else{if(!(_=e.useCustomRule(w,u,e.schema,e)))return;i="validate.schema"+l,b=_.code,v=x.compile,y=x.inline,g=x.macro}var C=b+".errors",T="i"+a,P="ruleErr"+a,k=x.async;if(k&&!e.async)throw new Error("async keyword in sync schema");if(y||g||(o+=C+" = null;"),o+="var "+f+" = errors;var "+p+";",m&&x.$data&&(N+="}",o+=" if ("+i+" === undefined) { "+p+" = true; } else { ",S&&(N+="}",o+=" "+p+" = "+E+".validateSchema("+i+"); if ("+p+") { ")),y)o+=x.statements?" "+_.validate+" ":" "+p+" = "+_.validate+"; ";else if(g){var A=e.util.copy(e),N="",O="valid"+ ++A.level;A.schema=_.validate,A.schemaPath="";var I=e.compositeRule;e.compositeRule=A.compositeRule=!0;var R=e.validate(A).replace(/validate\.schema/g,b);e.compositeRule=A.compositeRule=I,o+=" "+R}else{(L=L||[]).push(o),o="",o+="  "+b+".call( ",o+=e.opts.passContext?"this":"self",o+=v||!1===x.schema?" , "+d+" ":" , "+i+" , "+d+" , validate.schema"+e.schemaPath+" ",o+=" , (dataPath || '')",'""'!=e.errorPath&&(o+=" + "+e.errorPath);var j=s?"data"+(s-1||""):"parentData",D=s?e.dataPathArr[s]:"parentDataProperty",M=o+=" , "+j+" , "+D+" , rootData )  ";o=L.pop(),!1===x.errors?(o+=" "+p+" = ",k&&(o+=""+e.yieldAwait),o+=M+"; "):o+=k?" var "+(C="customErrors"+a)+" = null; try { "+p+" = "+e.yieldAwait+M+"; } catch (e) { "+p+" = false; if (e instanceof ValidationError) "+C+" = e.errors; else throw e; } ":" "+C+" = null; "+p+" = "+M+"; "}if(x.modifying&&(o+=" if ("+j+") "+d+" = "+j+"["+D+"];"),o+=""+N,x.valid)h&&(o+=" if (true) { ");else{o+=" if ( ",void 0===x.valid?(o+=" !",o+=g?""+O:""+p):o+=" "+!x.valid+" ",o+=") { ",n=w.keyword;var L=L||[];L.push(o),o="",(L=L||[]).push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(n||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+w.keyword+"' } ",!1!==e.opts.messages&&(o+=" , message: 'should pass \""+w.keyword+"\" keyword validation' "),e.opts.verbose&&(o+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ";var F=o;o=L.pop();var V=o+=!e.compositeRule&&h?e.async?" throw new ValidationError(["+F+"]); ":" validate.errors = ["+F+"]; return false; ":" var err = "+F+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";o=L.pop(),y?x.errors?"full"!=x.errors&&(o+="  for (var "+T+"="+f+"; "+T+"<errors; "+T+"++) { var "+P+" = vErrors["+T+"]; if ("+P+".dataPath === undefined) "+P+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+P+".schemaPath === undefined) { "+P+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(o+=" "+P+".schema = "+i+"; "+P+".data = "+d+"; "),o+=" } "):!1===x.errors?o+=" "+V+" ":(o+=" if ("+f+" == errors) { "+V+" } else {  for (var "+T+"="+f+"; "+T+"<errors; "+T+"++) { var "+P+" = vErrors["+T+"]; if ("+P+".dataPath === undefined) "+P+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+P+".schemaPath === undefined) { "+P+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(o+=" "+P+".schema = "+i+"; "+P+".data = "+d+"; "),o+=" } } "):g?(o+="   var err =   ",!1!==e.createErrors?(o+=" { keyword: '"+(n||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+w.keyword+"' } ",!1!==e.opts.messages&&(o+=" , message: 'should pass \""+w.keyword+"\" keyword validation' "),e.opts.verbose&&(o+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ",o+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&h&&(o+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; ")):!1===x.errors?o+=" "+V+" ":(o+=" if (Array.isArray("+C+")) { if (vErrors === null) vErrors = "+C+"; else vErrors = vErrors.concat("+C+"); errors = vErrors.length;  for (var "+T+"="+f+"; "+T+"<errors; "+T+"++) { var "+P+" = vErrors["+T+"]; if ("+P+".dataPath === undefined) "+P+".dataPath = (dataPath || '') + "+e.errorPath+";  "+P+'.schemaPath = "'+c+'";  ',e.opts.verbose&&(o+=" "+P+".schema = "+i+"; "+P+".data = "+d+"; "),o+=" } } else { "+V+" } "),o+=" } ",h&&(o+=" else { ")}return o}},{}],23:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(o||""),h="errs__"+i,d=e.util.copy(e),p="",f="valid"+ ++d.level,m={},v={},y=e.opts.ownProperties;for(w in a){var g=a[w],_=Array.isArray(g)?v:m;_[w]=g}n+="var "+h+" = errors;";var b=e.errorPath;n+="var missing"+i+";";for(var w in v)if((_=v[w]).length){if(n+=" if ( "+c+e.util.getProperty(w)+" !== undefined ",y&&(n+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(w)+"') "),l){n+=" && ( ";var E=_;if(E)for(var x=-1,N=E.length-1;N>x;)A=E[x+=1],x&&(n+=" || "),n+=" ( ( "+(j=c+(R=e.util.getProperty(A)))+" === undefined ",y&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(A)+"') "),n+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?A:R)+") ) ";n+=")) {  ";var S="missing"+i,C="' + "+S+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(b,S,!0):b+" + "+S);var T=T||[];T.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { property: '"+e.util.escapeQuotes(w)+"', missingProperty: '"+C+"', depsCount: "+_.length+", deps: '"+e.util.escapeQuotes(1==_.length?_[0]:_.join(", "))+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should have ",n+=1==_.length?"property "+e.util.escapeQuotes(_[0]):"properties "+e.util.escapeQuotes(_.join(", ")),n+=" when property "+e.util.escapeQuotes(w)+" is present' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var P=n;n=T.pop(),n+=!e.compositeRule&&l?e.async?" throw new ValidationError(["+P+"]); ":" validate.errors = ["+P+"]; return false; ":" var err = "+P+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{n+=" ) { ";var k=_;if(k)for(var A,O=-1,I=k.length-1;I>O;){A=k[O+=1];var R=e.util.getProperty(A),C=e.util.escapeQuotes(A),j=c+R;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(b,A,e.opts.jsonPointers)),n+=" if ( "+j+" === undefined ",y&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(A)+"') "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { property: '"+e.util.escapeQuotes(w)+"', missingProperty: '"+C+"', depsCount: "+_.length+", deps: '"+e.util.escapeQuotes(1==_.length?_[0]:_.join(", "))+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should have ",n+=1==_.length?"property "+e.util.escapeQuotes(_[0]):"properties "+e.util.escapeQuotes(_.join(", ")),n+=" when property "+e.util.escapeQuotes(w)+" is present' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}n+=" }   ",l&&(p+="}",n+=" else { ")}e.errorPath=b;var D=d.baseId;for(var w in m)g=m[w],e.util.schemaHasRules(g,e.RULES.all)&&(n+=" "+f+" = true; if ( "+c+e.util.getProperty(w)+" !== undefined ",y&&(n+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(w)+"') "),n+=") { ",d.schema=g,d.schemaPath=s+e.util.getProperty(w),d.errSchemaPath=u+"/"+e.util.escapeFragment(w),n+="  "+e.validate(d)+" ",d.baseId=D,n+=" }  ",l&&(n+=" if ("+f+") { ",p+="}"));return l&&(n+="   "+p+" if ("+h+" == errors) {"),n=e.util.cleanUpCode(n)}},{}],24:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d=e.opts.$data&&a&&a.$data;d&&(n+=" var schema"+i+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ");var p="i"+i,f="schema"+i;d||(n+=" var "+f+" = validate.schema"+s+";"),n+="var "+h+";",d&&(n+=" if (schema"+i+" === undefined) "+h+" = true; else if (!Array.isArray(schema"+i+")) "+h+" = false; else {"),n+=h+" = false;for (var "+p+"=0; "+p+"<"+f+".length; "+p+"++) if (equal("+c+", "+f+"["+p+"])) { "+h+" = true; break; }",d&&(n+="  }  "),n+=" if (!"+h+") {   ";var m=m||[];m.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { allowedValues: schema"+i+" } ",!1!==e.opts.messages&&(n+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var v=n;return n=m.pop(),n+=!e.compositeRule&&l?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }",l&&(n+=" else { "),n}},{}],25:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(o||"");if(!1===e.opts.format)return l&&(n+=" if (true) { "),n;var h,d=e.opts.$data&&a&&a.$data;d?(n+=" var schema"+i+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",h="schema"+i):h=a;var p=e.opts.unknownFormats,f=Array.isArray(p);if(d)n+=" var "+(m="format"+i)+" = formats["+h+"]; var "+(v="isObject"+i)+" = typeof "+m+" == 'object' && !("+m+" instanceof RegExp) && "+m+".validate; var "+(y="formatType"+i)+" = "+v+" && "+m+".type || 'string'; if ("+v+") { ",e.async&&(n+=" var async"+i+" = "+m+".async; "),n+=" "+m+" = "+m+".validate; } if (  ",d&&(n+=" ("+h+" !== undefined && typeof "+h+" != 'string') || "),n+=" (","ignore"!=p&&(n+=" ("+h+" && !"+m+" ",f&&(n+=" && self._opts.unknownFormats.indexOf("+h+") == -1 "),n+=") || "),n+=" ("+m+" && "+y+" == '"+r+"' && !(typeof "+m+" == 'function' ? ",n+=e.async?" (async"+i+" ? "+e.yieldAwait+" "+m+"("+c+") : "+m+"("+c+")) ":" "+m+"("+c+") ",n+=" : "+m+".test("+c+"))))) {";else{var m=e.formats[a];if(!m){if("ignore"==p)return console.warn('unknown format "'+a+'" ignored in schema at path "'+e.errSchemaPath+'"'),l&&(n+=" if (true) { "),n;if(f&&p.indexOf(a)>=0)return l&&(n+=" if (true) { "),n;throw new Error('unknown format "'+a+'" is used in schema at path "'+e.errSchemaPath+'"')}var v="object"==typeof m&&!(m instanceof RegExp)&&m.validate,y=v&&m.type||"string";if(v){var g=!0===m.async;m=m.validate}if(y!=r)return l&&(n+=" if (true) { "),n;if(g){if(!e.async)throw new Error("async format in sync schema");_="formats"+e.util.getProperty(a)+".validate",n+=" if (!("+e.yieldAwait+" "+_+"("+c+"))) { "}else{n+=" if (! ";var _="formats"+e.util.getProperty(a);v&&(_+=".validate"),n+="function"==typeof m?" "+_+"("+c+") ":" "+_+".test("+c+") ",n+=") { "}}var b=b||[];b.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { format:  ",
n+=d?""+h:""+e.util.toQuotedString(a),n+="  } ",!1!==e.opts.messages&&(n+=" , message: 'should match format \"",n+=d?"' + "+h+" + '":""+e.util.escapeQuotes(a),n+="\"' "),e.opts.verbose&&(n+=" , schema:  ",n+=d?"validate.schema"+s:""+e.util.toQuotedString(a),n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var w=n;return n=b.pop(),n+=!e.compositeRule&&l?e.async?" throw new ValidationError(["+w+"]); ":" validate.errors = ["+w+"]; return false; ":" var err = "+w+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",l&&(n+=" else { "),n}},{}],26:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="",m="valid"+ ++p.level,v="i"+i,y=p.dataLevel=e.dataLevel+1,g="data"+y,_=e.baseId;if(n+="var "+d+" = errors;var "+h+";",Array.isArray(a)){var b=e.schema.additionalItems;if(!1===b){n+=" "+h+" = "+c+".length <= "+a.length+"; ";var w=u;u=e.errSchemaPath+"/additionalItems",n+="  if (!"+h+") {   ";var E=E||[];E.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+a.length+" } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have more than "+a.length+" items' "),e.opts.verbose&&(n+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var x=n;n=E.pop(),n+=!e.compositeRule&&l?e.async?" throw new ValidationError(["+x+"]); ":" validate.errors = ["+x+"]; return false; ":" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",u=w,l&&(f+="}",n+=" else { ")}var N=a;if(N)for(var S,C=-1,T=N.length-1;T>C;)S=N[C+=1],e.util.schemaHasRules(S,e.RULES.all)&&(n+=" "+m+" = true; if ("+c+".length > "+C+") { ",P=c+"["+C+"]",p.schema=S,p.schemaPath=s+"["+C+"]",p.errSchemaPath=u+"/"+C,p.errorPath=e.util.getPathExpr(e.errorPath,C,e.opts.jsonPointers,!0),p.dataPathArr[y]=C,k=e.validate(p),p.baseId=_,n+=e.util.varOccurences(k,g)<2?" "+e.util.varReplace(k,g,P)+" ":" var "+g+" = "+P+"; "+k+" ",n+=" }  ",l&&(n+=" if ("+m+") { ",f+="}"));"object"==typeof b&&e.util.schemaHasRules(b,e.RULES.all)&&(p.schema=b,p.schemaPath=e.schemaPath+".additionalItems",p.errSchemaPath=e.errSchemaPath+"/additionalItems",n+=" "+m+" = true; if ("+c+".length > "+a.length+") {  for (var "+v+" = "+a.length+"; "+v+" < "+c+".length; "+v+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0),P=c+"["+v+"]",p.dataPathArr[y]=v,k=e.validate(p),p.baseId=_,n+=e.util.varOccurences(k,g)<2?" "+e.util.varReplace(k,g,P)+" ":" var "+g+" = "+P+"; "+k+" ",l&&(n+=" if (!"+m+") break; "),n+=" } }  ",l&&(n+=" if ("+m+") { ",f+="}"))}else if(e.util.schemaHasRules(a,e.RULES.all)){p.schema=a,p.schemaPath=s,p.errSchemaPath=u,n+="  for (var "+v+" = 0; "+v+" < "+c+".length; "+v+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0);var P=c+"["+v+"]";p.dataPathArr[y]=v;var k=e.validate(p);p.baseId=_,n+=e.util.varOccurences(k,g)<2?" "+e.util.varReplace(k,g,P)+" ":" var "+g+" = "+P+"; "+k+" ",l&&(n+=" if (!"+m+") break; "),n+=" }"}return l&&(n+=" "+f+" if ("+d+" == errors) {"),n=e.util.cleanUpCode(n)}},{}],27:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d=e.opts.$data&&s&&s.$data;d?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s,i+="var division"+o+";if (",d&&(i+=" "+n+" !== undefined && ( typeof "+n+" != 'number' || "),i+=" (division"+o+" = "+h+" / "+n+", ",i+=e.opts.multipleOfPrecision?" Math.abs(Math.round(division"+o+") - division"+o+") > 1e-"+e.opts.multipleOfPrecision+" ":" division"+o+" !== parseInt(division"+o+") ",i+=" ) ",d&&(i+="  )  "),i+=" ) {   ";var p=p||[];p.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { multipleOf: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be multiple of ",i+=d?"' + "+n:n+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+u:""+s,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var f=i;return i=p.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},{}],28:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(o||""),h="errs__"+i,d=e.util.copy(e),p="valid"+ ++d.level;if(e.util.schemaHasRules(a,e.RULES.all)){d.schema=a,d.schemaPath=s,d.errSchemaPath=u,n+=" var "+h+" = errors;  ";var f=e.compositeRule;e.compositeRule=d.compositeRule=!0,d.createErrors=!1;var m;d.opts.allErrors&&(m=d.opts.allErrors,d.opts.allErrors=!1),n+=" "+e.validate(d)+" ",d.createErrors=!0,m&&(d.opts.allErrors=m),e.compositeRule=d.compositeRule=f,n+=" if ("+p+") {   ";var v=v||[];v.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should NOT be valid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var y=n;n=v.pop(),n+=!e.compositeRule&&l?e.async?" throw new ValidationError(["+y+"]); ":" validate.errors = ["+y+"]; return false; ":" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } ",e.opts.allErrors&&(n+=" } ")}else n+="  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should NOT be valid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l&&(n+=" if (false) { ");return n}},{}],29:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="",m="valid"+ ++p.level;n+="var "+d+" = errors;var prevValid"+i+" = false;var "+h+" = false;";var v=p.baseId,y=e.compositeRule;e.compositeRule=p.compositeRule=!0;var g=a;if(g)for(var _,b=-1,w=g.length-1;w>b;)_=g[b+=1],e.util.schemaHasRules(_,e.RULES.all)?(p.schema=_,p.schemaPath=s+"["+b+"]",p.errSchemaPath=u+"/"+b,n+="  "+e.validate(p)+" ",p.baseId=v):n+=" var "+m+" = true; ",b&&(n+=" if ("+m+" && prevValid"+i+") "+h+" = false; else { ",f+="}"),n+=" if ("+m+") "+h+" = prevValid"+i+" = true;";return e.compositeRule=p.compositeRule=y,n+=f+"if (!"+h+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(n+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; "),n+="} else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; }",e.opts.allErrors&&(n+=" } "),n}},{}],30:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d=e.opts.$data&&s&&s.$data;d?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s;var p=d?"(new RegExp("+n+"))":e.usePattern(s);i+="if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'string') || "),i+=" !"+p+".test("+h+") ) {   ";var f=f||[];f.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { pattern:  ",i+=d?""+n:""+e.util.toQuotedString(s),i+="  } ",!1!==e.opts.messages&&(i+=" , message: 'should match pattern \"",i+=d?"' + "+n+" + '":""+e.util.escapeQuotes(s),i+="\"' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+u:""+e.util.toQuotedString(s),i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var m=i;return i=f.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+m+"]); ":" validate.errors = ["+m+"]; return false; ":" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},{}],31:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="",m="valid"+ ++p.level,v="key"+i,y="idx"+i,g=p.dataLevel=e.dataLevel+1,_="data"+g,b="dataProperties"+i,w=Object.keys(a||{}),E=e.schema.patternProperties||{},x=Object.keys(E),N=e.schema.additionalProperties,S=w.length||x.length,C=!1===N,T="object"==typeof N&&Object.keys(N).length,P=e.opts.removeAdditional,k=C||T||P,A=e.opts.ownProperties,O=e.baseId,I=e.schema.required;if(I&&(!e.opts.v5||!I.$data)&&I.length<e.opts.loopRequired)var R=e.util.toHash(I);if(e.opts.patternGroups)var j=e.schema.patternGroups||{},D=Object.keys(j);if(n+="var "+d+" = errors;var "+m+" = true;",A&&(n+=" var "+b+" = undefined;"),k){if(n+=A?" "+b+" = "+b+" || Object.keys("+c+"); for (var "+y+"=0; "+y+"<"+b+".length; "+y+"++) { var "+v+" = "+b+"["+y+"]; ":" for (var "+v+" in "+c+") { ",S){if(n+=" var isAdditional"+i+" = !(false ",w.length)if(w.length>5)n+=" || validate.schema"+s+"["+v+"] ";else{var M=w;if(M)for(var L=-1,F=M.length-1;F>L;)X=M[L+=1],n+=" || "+v+" == "+e.util.toQuotedString(X)+" "}if(x.length){var V=x;if(V)for(var B=-1,$=V.length-1;$>B;)oe=V[B+=1],n+=" || "+e.usePattern(oe)+".test("+v+") "}if(e.opts.patternGroups&&D.length){var H=D;if(H)for(var B=-1,W=H.length-1;W>B;)le=H[B+=1],n+=" || "+e.usePattern(le)+".test("+v+") "}n+=" ); if (isAdditional"+i+") { "}if("all"==P)n+=" delete "+c+"["+v+"]; ";else{var q=e.errorPath,U="' + "+v+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers)),C)P?n+=" delete "+c+"["+v+"]; ":(n+=" "+m+" = false; ",re=u,u=e.errSchemaPath+"/additionalProperties",(be=be||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { additionalProperty: '"+U+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have additional properties' "),e.opts.verbose&&(n+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",we=n,n=be.pop(),n+=!e.compositeRule&&l?e.async?" throw new ValidationError(["+we+"]); ":" validate.errors = ["+we+"]; return false; ":" var err = "+we+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u=re,l&&(n+=" break; "));else if(T)if("failing"==P){n+=" var "+d+" = errors;  ";var z=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.schema=N,p.schemaPath=e.schemaPath+".additionalProperties",p.errSchemaPath=e.errSchemaPath+"/additionalProperties",p.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers),Z=c+"["+v+"]",p.dataPathArr[g]=v,fe=e.validate(p),p.baseId=O,n+=e.util.varOccurences(fe,_)<2?" "+e.util.varReplace(fe,_,Z)+" ":" var "+_+" = "+Z+"; "+fe+" ",n+=" if (!"+m+") { errors = "+d+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+c+"["+v+"]; }  ",e.compositeRule=p.compositeRule=z}else p.schema=N,p.schemaPath=e.schemaPath+".additionalProperties",p.errSchemaPath=e.errSchemaPath+"/additionalProperties",p.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers),Z=c+"["+v+"]",p.dataPathArr[g]=v,fe=e.validate(p),p.baseId=O,n+=e.util.varOccurences(fe,_)<2?" "+e.util.varReplace(fe,_,Z)+" ":" var "+_+" = "+Z+"; "+fe+" ",l&&(n+=" if (!"+m+") break; ");e.errorPath=q}S&&(n+=" } "),n+=" }  ",l&&(n+=" if ("+m+") { ",f+="}")}var G=e.opts.useDefaults&&!e.compositeRule;if(w.length){var K=w;if(K)for(var X,Q=-1,Y=K.length-1;Y>Q;){if(pe=a[X=K[Q+=1]],e.util.schemaHasRules(pe,e.RULES.all)){var J=e.util.getProperty(X),Z=c+J,ee=G&&void 0!==pe["default"];if(p.schema=pe,p.schemaPath=s+J,p.errSchemaPath=u+"/"+e.util.escapeFragment(X),p.errorPath=e.util.getPath(e.errorPath,X,e.opts.jsonPointers),p.dataPathArr[g]=e.util.toQuotedString(X),fe=e.validate(p),p.baseId=O,e.util.varOccurences(fe,_)<2)fe=e.util.varReplace(fe,_,Z),te=Z;else{var te=_;n+=" var "+_+" = "+Z+"; "}if(ee)n+=" "+fe+" ";else{if(R&&R[X]){n+=" if ( "+te+" === undefined ",A&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(X)+"') "),n+=") { "+m+" = false; ";var q=e.errorPath,re=u,ne=e.util.escapeQuotes(X);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(q,X,e.opts.jsonPointers)),u=e.errSchemaPath+"/required",(be=be||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+ne+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+ne+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",we=n,n=be.pop(),n+=!e.compositeRule&&l?e.async?" throw new ValidationError(["+we+"]); ":" validate.errors = ["+we+"]; return false; ":" var err = "+we+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u=re,e.errorPath=q,n+=" } else { "}else l?(n+=" if ( "+te+" === undefined ",A&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(X)+"') "),n+=") { "+m+" = true; } else { "):(n+=" if ("+te+" !== undefined ",A&&(n+=" &&   Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(X)+"') "),n+=" ) { ");n+=" "+fe+" } "}}l&&(n+=" if ("+m+") { ",f+="}")}}if(x.length){var ie=x;if(ie)for(var oe,ae=-1,se=ie.length-1;se>ae;)pe=E[oe=ie[ae+=1]],e.util.schemaHasRules(pe,e.RULES.all)&&(p.schema=pe,p.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(oe),p.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(oe),n+=A?" "+b+" = "+b+" || Object.keys("+c+"); for (var "+y+"=0; "+y+"<"+b+".length; "+y+"++) { var "+v+" = "+b+"["+y+"]; ":" for (var "+v+" in "+c+") { ",n+=" if ("+e.usePattern(oe)+".test("+v+")) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers),Z=c+"["+v+"]",p.dataPathArr[g]=v,fe=e.validate(p),p.baseId=O,n+=e.util.varOccurences(fe,_)<2?" "+e.util.varReplace(fe,_,Z)+" ":" var "+_+" = "+Z+"; "+fe+" ",l&&(n+=" if (!"+m+") break; "),n+=" } ",l&&(n+=" else "+m+" = true; "),n+=" }  ",l&&(n+=" if ("+m+") { ",f+="}"))}if(e.opts.patternGroups&&D.length){var ue=D;if(ue)for(var le,ce=-1,he=ue.length-1;he>ce;){var de=j[le=ue[ce+=1]],pe=de.schema;if(e.util.schemaHasRules(pe,e.RULES.all)){p.schema=pe,p.schemaPath=e.schemaPath+".patternGroups"+e.util.getProperty(le)+".schema",p.errSchemaPath=e.errSchemaPath+"/patternGroups/"+e.util.escapeFragment(le)+"/schema",n+=" var pgPropCount"+i+" = 0;  ",n+=A?" "+b+" = "+b+" || Object.keys("+c+"); for (var "+y+"=0; "+y+"<"+b+".length; "+y+"++) { var "+v+" = "+b+"["+y+"]; ":" for (var "+v+" in "+c+") { ",n+=" if ("+e.usePattern(le)+".test("+v+")) { pgPropCount"+i+"++; ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers),Z=c+"["+v+"]",p.dataPathArr[g]=v;var fe=e.validate(p);p.baseId=O,n+=e.util.varOccurences(fe,_)<2?" "+e.util.varReplace(fe,_,Z)+" ":" var "+_+" = "+Z+"; "+fe+" ",l&&(n+=" if (!"+m+") break; "),n+=" } ",l&&(n+=" else "+m+" = true; "),n+=" }  ",l&&(n+=" if ("+m+") { ",f+="}");var me=de.minimum,ve=de.maximum;if(void 0!==me||void 0!==ve){if(n+=" var "+h+" = true; ",re=u,void 0!==me){var ye=me,ge="minimum",_e="less";n+=" "+h+" = pgPropCount"+i+" >= "+me+"; ",u=e.errSchemaPath+"/patternGroups/minimum",n+="  if (!"+h+") {   ",(be=be||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'patternGroups' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { reason: '"+ge+"', limit: "+ye+", pattern: '"+e.util.escapeQuotes(le)+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have "+_e+" than "+ye+' properties matching pattern "'+e.util.escapeQuotes(le)+"\"' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",we=n,n=be.pop(),n+=!e.compositeRule&&l?e.async?" throw new ValidationError(["+we+"]); ":" validate.errors = ["+we+"]; return false; ":" var err = "+we+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",void 0!==ve&&(n+=" else ")}if(void 0!==ve){var ye=ve,ge="maximum",_e="more";n+=" "+h+" = pgPropCount"+i+" <= "+ve+"; ",u=e.errSchemaPath+"/patternGroups/maximum",n+="  if (!"+h+") {   ";var be=be||[];be.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'patternGroups' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { reason: '"+ge+"', limit: "+ye+", pattern: '"+e.util.escapeQuotes(le)+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have "+_e+" than "+ye+' properties matching pattern "'+e.util.escapeQuotes(le)+"\"' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var we=n;n=be.pop(),n+=!e.compositeRule&&l?e.async?" throw new ValidationError(["+we+"]); ":" validate.errors = ["+we+"]; return false; ":" var err = "+we+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } "}u=re,l&&(n+=" if ("+h+") { ",f+="}")}}}}return l&&(n+=" "+f+" if ("+d+" == errors) {"),n=e.util.cleanUpCode(n)}},{}],32:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(o||""),h="errs__"+i,d=e.util.copy(e),p="valid"+ ++d.level;if(e.util.schemaHasRules(a,e.RULES.all)){d.schema=a,d.schemaPath=s,d.errSchemaPath=u;var f="key"+i,m="idx"+i,v="i"+i,y="' + "+f+" + '",g="data"+(d.dataLevel=e.dataLevel+1),_="dataProperties"+i,b=e.opts.ownProperties,w=e.baseId;n+=" var "+h+" = errors; ",b&&(n+=" var "+_+" = undefined; "),n+=b?" "+_+" = "+_+" || Object.keys("+c+"); for (var "+m+"=0; "+m+"<"+_+".length; "+m+"++) { var "+f+" = "+_+"["+m+"]; ":" for (var "+f+" in "+c+") { ",n+=" var startErrs"+i+" = errors; ";var E=f,x=e.compositeRule;e.compositeRule=d.compositeRule=!0;var N=e.validate(d);d.baseId=w,n+=e.util.varOccurences(N,g)<2?" "+e.util.varReplace(N,g,E)+" ":" var "+g+" = "+E+"; "+N+" ",e.compositeRule=d.compositeRule=x,n+=" if (!"+p+") { for (var "+v+"=startErrs"+i+"; "+v+"<errors; "+v+"++) { vErrors["+v+"].propertyName = "+f+"; }   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { propertyName: '"+y+"' } ",!1!==e.opts.messages&&(n+=" , message: 'property name \\'"+y+"\\' is invalid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(n+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; "),l&&(n+=" break; "),n+=" } }"}return l&&(n+="  if ("+h+" == errors) {"),n=e.util.cleanUpCode(n)}},{}],33:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i,o=" ",a=e.level,s=e.dataLevel,u=e.schema[t],l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(s||""),d="valid"+a;if("#"==u||"#/"==u)e.isRoot?(n=e.async,i="validate"):(n=!0===e.root.schema.$async,i="root.refVal[0]");else{var p=e.resolveRef(e.baseId,u,e.isRoot);if(void 0===p){var f=e.MissingRefError.message(e.baseId,u);if("fail"==e.opts.missingRefs){console.error(f),(g=g||[]).push(o),o="",!1!==e.createErrors?(o+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { ref: '"+e.util.escapeQuotes(u)+"' } ",!1!==e.opts.messages&&(o+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(u)+"' "),e.opts.verbose&&(o+=" , schema: "+e.util.toQuotedString(u)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),o+=" } "):o+=" {} ";var m=o;o=g.pop(),o+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+m+"]); ":" validate.errors = ["+m+"]; return false; ":" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c&&(o+=" if (false) { ")}else{if("ignore"!=e.opts.missingRefs)throw new e.MissingRefError(e.baseId,u,f);console.warn(f),c&&(o+=" if (true) { ")}}else if(p.inline){var v=e.util.copy(e),y="valid"+ ++v.level;v.schema=p.schema,v.schemaPath="",v.errSchemaPath=u,o+=" "+e.validate(v).replace(/validate\.schema/g,p.code)+" ",c&&(o+=" if ("+y+") { ")}else n=!0===p.$async,i=p.code}if(i){var g=g||[];g.push(o),o="",o+=e.opts.passContext?" "+i+".call(this, ":" "+i+"( ",o+=" "+h+", (dataPath || '')",'""'!=e.errorPath&&(o+=" + "+e.errorPath);var _=o+=" , "+(s?"data"+(s-1||""):"parentData")+" , "+(s?e.dataPathArr[s]:"parentDataProperty")+", rootData)  ";if(o=g.pop(),n){if(!e.async)throw new Error("async schema referenced by sync schema");c&&(o+=" var "+d+"; "),o+=" try { "+e.yieldAwait+" "+_+"; ",c&&(o+=" "+d+" = true; "),o+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",c&&(o+=" "+d+" = false; "),o+=" } ",c&&(o+=" if ("+d+") { ")}else o+=" if (!"+_+") { if (vErrors === null) vErrors = "+i+".errors; else vErrors = vErrors.concat("+i+".errors); errors = vErrors.length; } ",c&&(o+=" else { ")}return o}},{}],34:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d=e.opts.$data&&a&&a.$data;d&&(n+=" var schema"+i+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ");var p="schema"+i;if(!d)if(a.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var f=[],m=a;if(m)for(var v,y=-1,g=m.length-1;g>y;){v=m[y+=1];var _=e.schema.properties[v];_&&e.util.schemaHasRules(_,e.RULES.all)||(f[f.length]=v)}}else f=a;if(d||f.length){var b=e.errorPath,w=d||f.length>=e.opts.loopRequired,E=e.opts.ownProperties;if(l)if(n+=" var missing"+i+"; ",w)d||(n+=" var "+p+" = validate.schema"+s+"; "),k="' + "+(P="schema"+i+"["+(N="i"+i)+"]")+" + '",e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(b,P,e.opts.jsonPointers)),n+=" var "+h+" = true; ",d&&(n+=" if (schema"+i+" === undefined) "+h+" = true; else if (!Array.isArray(schema"+i+")) "+h+" = false; else {"),n+=" for (var "+N+" = 0; "+N+" < "+p+".length; "+N+"++) { "+h+" = "+c+"["+p+"["+N+"]] !== undefined ",E&&(n+=" &&   Object.prototype.hasOwnProperty.call("+c+", "+p+"["+N+"]) "),n+="; if (!"+h+") break; } ",d&&(n+="  }  "),n+="  if (!"+h+") {   ",(C=C||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+k+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",T=n,n=C.pop(),n+=!e.compositeRule&&l?e.async?" throw new ValidationError(["+T+"]); ":" validate.errors = ["+T+"]; return false; ":" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { ";else{n+=" if ( ";var x=f;if(x)for(var N=-1,S=x.length-1;S>N;)O=x[N+=1],N&&(n+=" || "),n+=" ( ( "+(D=c+(j=e.util.getProperty(O)))+" === undefined ",E&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(O)+"') "),n+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?O:j)+") ) ";n+=") {  ",k="' + "+(P="missing"+i)+" + '",e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(b,P,!0):b+" + "+P);var C=C||[];C.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+k+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var T=n;n=C.pop(),n+=!e.compositeRule&&l?e.async?" throw new ValidationError(["+T+"]); ":" validate.errors = ["+T+"]; return false; ":" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { "}else if(w){d||(n+=" var "+p+" = validate.schema"+s+"; ");var P="schema"+i+"["+(N="i"+i)+"]",k="' + "+P+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(b,P,e.opts.jsonPointers)),d&&(n+=" if ("+p+" && !Array.isArray("+p+")) {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+k+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+p+" !== undefined) { "),n+=" for (var "+N+" = 0; "+N+" < "+p+".length; "+N+"++) { if ("+c+"["+p+"["+N+"]] === undefined ",E&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", "+p+"["+N+"]) "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+k+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",d&&(n+="  }  ")}else{var A=f;if(A)for(var O,I=-1,R=A.length-1;R>I;){O=A[I+=1];var j=e.util.getProperty(O),k=e.util.escapeQuotes(O),D=c+j;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(b,O,e.opts.jsonPointers)),n+=" if ( "+D+" === undefined ",E&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(O)+"') "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+k+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=b}else l&&(n+=" if (true) {");return n}},{}],35:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d="valid"+o,p=e.opts.$data&&s&&s.$data;if(p?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s,(s||p)&&!1!==e.opts.uniqueItems){p&&(i+=" var "+d+"; if ("+n+" === false || "+n+" === undefined) "+d+" = true; else if (typeof "+n+" != 'boolean') "+d+" = false; else { "),i+=" var "+d+" = true; if ("+h+".length > 1) { var i = "+h+".length, j; outer: for (;i--;) { for (j = i; j--;) { if (equal("+h+"[i], "+h+"[j])) { "+d+" = false; break outer; } } } } ",p&&(i+="  }  "),i+=" if (!"+d+") {   ";var f=f||[];f.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { i: i, j: j } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(i+=" , schema:  ",i+=p?"validate.schema"+u:""+s,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var m=i;i=f.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+m+"]); ":" validate.errors = ["+m+"]; return false; ":" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",c&&(i+=" else { ")}else c&&(i+=" if (true) { ");return i}},{}],36:[function(e,t,r){"use strict";t.exports=function(e,t,r){function n(e){for(var t=e.rules,r=0;r<t.length;r++)if(i(t[r]))return!0}function i(t){return void 0!==e.schema[t.keyword]||t["implements"]&&o(t)}function o(t){for(var r=t["implements"],n=0;n<r.length;n++)if(void 0!==e.schema[r[n]])return!0}var a="",s=!0===e.schema.$async,u=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),l=e.self._getId(e.schema);if(e.isTop){if(s){e.async=!0;var c="es7"==e.opts.async;e.yieldAwait=c?"await":"yield"}a+=" var validate = ",s?c?a+=" (async function ":("*"!=e.opts.async&&(a+="co.wrap"),a+="(function* "):a+=" (function ",a+=" (data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",l&&(e.opts.sourceCode||e.opts.processCode)&&(a+=" /*# sourceURL="+l+" */ ")}if("boolean"==typeof e.schema||!u&&!e.schema.$ref){var h=e.level,d=e.dataLevel,p=e.schema["false schema"],f=e.schemaPath+e.util.getProperty("false schema"),m=e.errSchemaPath+"/false schema",v=!e.opts.allErrors,y="data"+(d||""),g="valid"+h;return!1===e.schema?(e.isTop?v=!0:a+=" var "+g+" = false; ",(Z=Z||[]).push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(b||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: {} ",!1!==e.opts.messages&&(a+=" , message: 'boolean schema is false' "),e.opts.verbose&&(a+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+y+" "),a+=" } "):a+=" {} ",ee=a,a=Z.pop(),a+=!e.compositeRule&&v?e.async?" throw new ValidationError(["+ee+"]); ":" validate.errors = ["+ee+"]; return false; ":" var err = "+ee+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "):a+=e.isTop?s?" return data; ":" validate.errors = null; return true; ":" var "+g+" = true; ",
e.isTop&&(a+=" }); return validate; "),a}if(e.isTop){var _=e.isTop,h=e.level=0,d=e.dataLevel=0,y="data";e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[void 0],a+=" var vErrors = null; ",a+=" var errors = 0;     ",a+=" if (rootData === undefined) rootData = data; "}else{var h=e.level,y="data"+((d=e.dataLevel)||"");if(l&&(e.baseId=e.resolve.url(e.baseId,l)),s&&!e.async)throw new Error("async schema in sync schema");a+=" var errs_"+h+" = errors;"}var b,g="valid"+h,v=!e.opts.allErrors,w="",E="",x=e.schema.type,N=Array.isArray(x);if(N&&1==x.length&&(x=x[0],N=!1),e.schema.$ref&&u){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(u=!1,console.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(x){if(e.opts.coerceTypes)var S=e.util.coerceToTypes(e.opts.coerceTypes,x);if(L=e.RULES.types[x],S||N||!0===L||L&&!n(L)){var f=e.schemaPath+".type",m=e.errSchemaPath+"/type",f=e.schemaPath+".type",m=e.errSchemaPath+"/type",C=N?"checkDataTypes":"checkDataType";if(a+=" if ("+e.util[C](x,y,!0)+") { ",S){var T="dataType"+h,P="coerced"+h;a+=" var "+T+" = typeof "+y+"; ","array"==e.opts.coerceTypes&&(a+=" if ("+T+" == 'object' && Array.isArray("+y+")) "+T+" = 'array'; "),a+=" var "+P+" = undefined; ";var k="",A=S;if(A)for(var O,I=-1,R=A.length-1;R>I;)O=A[I+=1],I&&(a+=" if ("+P+" === undefined) { ",k+="}"),"array"==e.opts.coerceTypes&&"array"!=O&&(a+=" if ("+T+" == 'array' && "+y+".length == 1) { "+P+" = "+y+" = "+y+"[0]; "+T+" = typeof "+y+";  } "),"string"==O?a+=" if ("+T+" == 'number' || "+T+" == 'boolean') "+P+" = '' + "+y+"; else if ("+y+" === null) "+P+" = ''; ":"number"==O||"integer"==O?(a+=" if ("+T+" == 'boolean' || "+y+" === null || ("+T+" == 'string' && "+y+" && "+y+" == +"+y+" ","integer"==O&&(a+=" && !("+y+" % 1)"),a+=")) "+P+" = +"+y+"; "):"boolean"==O?a+=" if ("+y+" === 'false' || "+y+" === 0 || "+y+" === null) "+P+" = false; else if ("+y+" === 'true' || "+y+" === 1) "+P+" = true; ":"null"==O?a+=" if ("+y+" === '' || "+y+" === 0 || "+y+" === false) "+P+" = null; ":"array"==e.opts.coerceTypes&&"array"==O&&(a+=" if ("+T+" == 'string' || "+T+" == 'number' || "+T+" == 'boolean' || "+y+" == null) "+P+" = ["+y+"]; ");a+=" "+k+" if ("+P+" === undefined) {   ",(Z=Z||[]).push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(b||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: { type: '",a+=N?""+x.join(","):""+x,a+="' } ",!1!==e.opts.messages&&(a+=" , message: 'should be ",a+=N?""+x.join(","):""+x,a+="' "),e.opts.verbose&&(a+=" , schema: validate.schema"+f+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+y+" "),a+=" } "):a+=" {} ",ee=a,a=Z.pop(),a+=!e.compositeRule&&v?e.async?" throw new ValidationError(["+ee+"]); ":" validate.errors = ["+ee+"]; return false; ":" var err = "+ee+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } else {  ";var j=d?"data"+(d-1||""):"parentData",D=d?e.dataPathArr[d]:"parentDataProperty";a+=" "+y+" = "+P+"; ",d||(a+="if ("+j+" !== undefined)"),a+=" "+j+"["+D+"] = "+P+"; } "}else(Z=Z||[]).push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(b||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: { type: '",a+=N?""+x.join(","):""+x,a+="' } ",!1!==e.opts.messages&&(a+=" , message: 'should be ",a+=N?""+x.join(","):""+x,a+="' "),e.opts.verbose&&(a+=" , schema: validate.schema"+f+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+y+" "),a+=" } "):a+=" {} ",ee=a,a=Z.pop(),a+=!e.compositeRule&&v?e.async?" throw new ValidationError(["+ee+"]); ":" validate.errors = ["+ee+"]; return false; ":" var err = "+ee+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";a+=" } "}}if(e.schema.$ref&&!u)a+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",v&&(a+=" } if (errors === ",a+=_?"0":"errs_"+h,a+=") { ",E+="}");else{e.opts.v5&&e.schema.patternGroups&&console.warn('keyword "patternGroups" is deprecated and disabled. Use option patternGroups: true to enable.');var M=e.RULES;if(M)for(var L,F=-1,V=M.length-1;V>F;)if(L=M[F+=1],n(L)){if(L.type&&(a+=" if ("+e.util.checkDataType(L.type,y)+") { "),e.opts.useDefaults&&!e.compositeRule)if("object"==L.type&&e.schema.properties){var p=e.schema.properties,B=Object.keys(p);if(B)for(var $,H=-1,W=B.length-1;W>H;)void 0!==(U=p[$=B[H+=1]])["default"]&&(a+="  if ("+(G=y+e.util.getProperty($))+" === undefined) "+G+" = ",a+="shared"==e.opts.useDefaults?" "+e.useDefault(U["default"])+" ":" "+JSON.stringify(U["default"])+" ",a+="; ")}else if("array"==L.type&&Array.isArray(e.schema.items)){var q=e.schema.items;if(q)for(var U,I=-1,z=q.length-1;z>I;)if(void 0!==(U=q[I+=1])["default"]){var G=y+"["+I+"]";a+="  if ("+G+" === undefined) "+G+" = ",a+="shared"==e.opts.useDefaults?" "+e.useDefault(U["default"])+" ":" "+JSON.stringify(U["default"])+" ",a+="; "}}var K=L.rules;if(K)for(var X,Q=-1,Y=K.length-1;Y>Q;)if(X=K[Q+=1],i(X)){var J=X.code(e,X.keyword,L.type);J&&(a+=" "+J+" ",v&&(w+="}"))}if(v&&(a+=" "+w+" ",w=""),L.type&&(a+=" } ",x&&x===L.type&&!S)){a+=" else { ";var f=e.schemaPath+".type",m=e.errSchemaPath+"/type",Z=Z||[];Z.push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(b||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: { type: '",a+=N?""+x.join(","):""+x,a+="' } ",!1!==e.opts.messages&&(a+=" , message: 'should be ",a+=N?""+x.join(","):""+x,a+="' "),e.opts.verbose&&(a+=" , schema: validate.schema"+f+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+y+" "),a+=" } "):a+=" {} ";var ee=a;a=Z.pop(),a+=!e.compositeRule&&v?e.async?" throw new ValidationError(["+ee+"]); ":" validate.errors = ["+ee+"]; return false; ":" var err = "+ee+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } "}v&&(a+=" if (errors === ",a+=_?"0":"errs_"+h,a+=") { ",E+="}")}}return v&&(a+=" "+E+" "),_?(s?(a+=" if (errors === 0) return data;           ",a+=" else throw new ValidationError(vErrors); "):(a+=" validate.errors = vErrors; ",a+=" return errors === 0;       "),a+=" }); return validate;"):a+=" var "+g+" = errors === errs_"+h+";",a=e.util.cleanUpCode(a),_&&(a=e.util.finalCleanUpCode(a,s)),a}},{}],37:[function(e,t,r){"use strict";function n(e,t){function r(e,t,r){for(var n,o=0;o<i.length;o++){var a=i[o];if(a.type==t){n=a;break}}n||(n={type:t,rules:[]},i.push(n));var u={keyword:e,definition:r,custom:!0,code:s,"implements":r["implements"]};n.rules.push(u),i.custom[e]=u}function n(e){if(!i.types[e])throw new Error("Unknown type "+e)}var i=this.RULES;if(i.keywords[e])throw new Error("Keyword "+e+" is already defined");if(!a.test(e))throw new Error("Keyword "+e+" is not a valid identifier");if(t){if(t.macro&&void 0!==t.valid)throw new Error('"valid" option cannot be used with macro keywords');var o=t.type;if(Array.isArray(o)){var u,l=o.length;for(u=0;l>u;u++)n(o[u]);for(u=0;l>u;u++)r(e,o[u],t)}else o&&n(o),r(e,o,t);var c=!0===t.$data&&this._opts.$data;if(c&&!t.validate)throw new Error('$data support: "validate" function is not defined');var h=t.metaSchema;h&&(c&&(h={anyOf:[h,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/$data.json#"}]}),t.validateSchema=this.compile(h,!0))}i.keywords[e]=i.all[e]=!0}function i(e){var t=this.RULES.custom[e];return t?t.definition:this.RULES.keywords[e]||!1}function o(e){var t=this.RULES;delete t.keywords[e],delete t.all[e],delete t.custom[e];for(var r=0;r<t.length;r++)for(var n=t[r].rules,i=0;i<n.length;i++)if(n[i].keyword==e){n.splice(i,1);break}}var a=/^[a-z_$][a-z0-9_$\-]*$/i,s=e("./dotjs/custom");t.exports={add:n,get:i,remove:o}},{"./dotjs/custom":22}],38:[function(e,t,r){"use strict";t.exports=function(e){var t=e._opts.defaultMeta,r="string"==typeof t?{$ref:t}:e.getSchema("http://json-schema.org/draft-06/schema")?{$ref:"http://json-schema.org/draft-06/schema"}:{};e.addKeyword("patternGroups",{metaSchema:{type:"object",additionalProperties:{type:"object",required:["schema"],properties:{maximum:{type:"integer",minimum:0},minimum:{type:"integer",minimum:0},schema:r},additionalProperties:!1}}}),e.RULES.all.properties["implements"].push("patternGroups")}},{}],39:[function(e,t,r){t.exports={$schema:"http://json-schema.org/draft-06/schema#",$id:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/$data.json#",description:"Meta-schema for $data reference (JSON-schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}},{}],40:[function(e,t,r){t.exports={$schema:"http://json-schema.org/draft-06/schema#",$id:"http://json-schema.org/draft-06/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{"default":0}]},simpleTypes:{"enum":["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,"default":[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},title:{type:"string"},description:{type:"string"},"default":{},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],"default":{}},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean","default":!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},"default":{}},properties:{type:"object",additionalProperties:{$ref:"#"},"default":{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},"default":{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},"const":{},"enum":{type:"array",minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},"default":{}}},{}],41:[function(e,t,r){(function(e){!function(n){function i(e){throw new RangeError(R[e])}function o(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function a(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+o((e=e.replace(I,".")).split("."),t).join(".")}function s(e){for(var t,r,n=[],i=0,o=e.length;o>i;)(t=e.charCodeAt(i++))>=55296&&56319>=t&&o>i?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function u(e){return o(e,function(e){var t="";return e>65535&&(t+=M((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=M(e)}).join("")}function l(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:E}function c(e,t){return e+22+75*(26>e)-((0!=t)<<5)}function h(e,t,r){var n=0;for(e=r?D(e/C):e>>1,e+=D(e/t);e>j*N>>1;n+=E)e=D(e/j);return D(n+(j+1)*e/(e+S))}function d(e){var t,r,n,o,a,s,c,d,p,f,m=[],v=e.length,y=0,g=P,_=T;for((r=e.lastIndexOf(k))<0&&(r=0),n=0;r>n;++n)e.charCodeAt(n)>=128&&i("not-basic"),m.push(e.charCodeAt(n));for(o=r>0?r+1:0;v>o;){for(a=y,s=1,c=E;o>=v&&i("invalid-input"),((d=l(e.charCodeAt(o++)))>=E||d>D((w-y)/s))&&i("overflow"),y+=d*s,p=_>=c?x:c>=_+N?N:c-_,!(p>d);c+=E)s>D(w/(f=E-p))&&i("overflow"),s*=f;_=h(y-a,t=m.length+1,0==a),D(y/t)>w-g&&i("overflow"),g+=D(y/t),y%=t,m.splice(y++,0,g)}return u(m)}function p(e){var t,r,n,o,a,u,l,d,p,f,m,v,y,g,_,b=[];for(v=(e=s(e)).length,t=P,r=0,a=T,u=0;v>u;++u)(m=e[u])<128&&b.push(M(m));for(n=o=b.length,o&&b.push(k);v>n;){for(l=w,u=0;v>u;++u)(m=e[u])>=t&&l>m&&(l=m);for(l-t>D((w-r)/(y=n+1))&&i("overflow"),r+=(l-t)*y,t=l,u=0;v>u;++u)if((m=e[u])<t&&++r>w&&i("overflow"),m==t){for(d=r,p=E;f=a>=p?x:p>=a+N?N:p-a,!(f>d);p+=E)_=d-f,g=E-f,b.push(M(c(f+_%g,0))),d=D(_/g);b.push(M(c(d,0))),a=h(r,y,n==o),r=0,++n}++r,++t}return b.join("")}function f(e){return a(e,function(e){return A.test(e)?d(e.slice(4).toLowerCase()):e})}function m(e){return a(e,function(e){return O.test(e)?"xn--"+p(e):e})}var v="object"==typeof r&&r&&!r.nodeType&&r,y="object"==typeof t&&t&&!t.nodeType&&t,g="object"==typeof e&&e;g.global!==g&&g.window!==g&&g.self!==g||(n=g);var _,b,w=2147483647,E=36,x=1,N=26,S=38,C=700,T=72,P=128,k="-",A=/^xn--/,O=/[^\x20-\x7E]/,I=/[\x2E\u3002\uFF0E\uFF61]/g,R={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},j=E-x,D=Math.floor,M=String.fromCharCode;if(_={version:"1.4.1",ucs2:{decode:s,encode:u},decode:d,encode:p,toASCII:m,toUnicode:f},v&&y)if(t.exports==v)y.exports=_;else for(b in _)_.hasOwnProperty(b)&&(v[b]=_[b]);else n.punycode=_}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],42:[function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,r,o){t=t||"&",r=r||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var u=1e3;o&&"number"==typeof o.maxKeys&&(u=o.maxKeys);var l=e.length;u>0&&l>u&&(l=u);for(var c=0;l>c;++c){var h,d,p,f,m=e[c].replace(s,"%20"),v=m.indexOf(r);v>=0?(h=m.substr(0,v),d=m.substr(v+1)):(h=m,d=""),p=decodeURIComponent(h),f=decodeURIComponent(d),n(a,p)?i(a[p])?a[p].push(f):a[p]=[a[p],f]:a[p]=f}return a};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],43:[function(e,t,r){"use strict";function n(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,r,s){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?n(a(e),function(a){var s=encodeURIComponent(i(a))+r;return o(e[a])?n(e[a],function(e){return s+encodeURIComponent(i(e))}).join(t):s+encodeURIComponent(i(e[a]))}).join(t):s?encodeURIComponent(i(s))+r+encodeURIComponent(i(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},{}],44:[function(e,t,r){"use strict";r.decode=r.parse=e("./decode"),r.encode=r.stringify=e("./encode")},{"./decode":42,"./encode":43}],45:[function(e,t,r){"use strict";function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function i(e,t,r){if(e&&l.isObject(e)&&e instanceof n)return e;var i=new n;return i.parse(e,t,r),i}function o(e){return l.isString(e)&&(e=i(e)),e instanceof n?e.format():n.prototype.format.call(e)}function a(e,t){return i(e,!1,!0).resolve(t)}function s(e,t){return e?i(e,!1,!0).resolveObject(t):t}var u=e("punycode"),l=e("./util");r.parse=i,r.resolve=a,r.resolveObject=s,r.format=o,r.Url=n;var c=/^([a-z0-9.+-]+:)/i,h=/:[0-9]*$/,d=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,p=["<",">",'"',"`"," ","\r","\n","	"],f=["{","}","|","\\","^","`"].concat(p),m=["'"].concat(f),v=["%","/","?",";","#"].concat(m),y=["/","?","#"],g=/^[+a-z0-9A-Z_-]{0,63}$/,_=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,b={javascript:!0,"javascript:":!0},w={javascript:!0,"javascript:":!0},E={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},x=e("querystring");n.prototype.parse=function(e,t,r){if(!l.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),i=-1!==n&&n<e.indexOf("#")?"?":"#",o=e.split(i),a=/\\/g;o[0]=o[0].replace(a,"/");var s=e=o.join(i);if(s=s.trim(),!r&&1===e.split("#").length){var h=d.exec(s);if(h)return this.path=s,this.href=s,this.pathname=h[1],h[2]?(this.search=h[2],this.query=t?x.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var p=c.exec(s);if(p){var f=(p=p[0]).toLowerCase();this.protocol=f,s=s.substr(p.length)}if(r||p||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var N="//"===s.substr(0,2);!N||p&&w[p]||(s=s.substr(2),this.slashes=!0)}if(!w[p]&&(N||p&&!E[p])){for(var S=-1,C=0;C<y.length;C++)-1!==(k=s.indexOf(y[C]))&&(-1===S||S>k)&&(S=k);var T,P;for(-1!==(P=-1===S?s.lastIndexOf("@"):s.lastIndexOf("@",S))&&(T=s.slice(0,P),s=s.slice(P+1),this.auth=decodeURIComponent(T)),S=-1,C=0;C<v.length;C++){var k=s.indexOf(v[C]);-1!==k&&(-1===S||S>k)&&(S=k)}-1===S&&(S=s.length),this.host=s.slice(0,S),s=s.slice(S),this.parseHost();var A="["===(this.hostname=this.hostname||"")[0]&&"]"===this.hostname[this.hostname.length-1];if(!A)for(var O=this.hostname.split(/\./),C=0,I=O.length;I>C;C++){var R=O[C];if(R&&!R.match(g)){for(var j="",D=0,M=R.length;M>D;D++)j+=R.charCodeAt(D)>127?"x":R[D];if(!j.match(g)){var L=O.slice(0,C),F=O.slice(C+1),V=R.match(_);V&&(L.push(V[1]),F.unshift(V[2])),F.length&&(s="/"+F.join(".")+s),this.hostname=L.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),A||(this.hostname=u.toASCII(this.hostname));var B=this.port?":"+this.port:"",$=this.hostname||"";this.host=$+B,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!b[f])for(var C=0,I=m.length;I>C;C++){var H=m[C];if(-1!==s.indexOf(H)){var W=encodeURIComponent(H);W===H&&(W=escape(H)),s=s.split(H).join(W)}}var q=s.indexOf("#");-1!==q&&(this.hash=s.substr(q),s=s.slice(0,q));var U=s.indexOf("?");if(-1!==U?(this.search=s.substr(U),this.query=s.substr(U+1),t&&(this.query=x.parse(this.query)),s=s.slice(0,U)):t&&(this.search="",this.query={}),s&&(this.pathname=s),E[f]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var B=this.pathname||"",z=this.search||"";this.path=B+z}return this.href=this.format(),this},n.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&l.isObject(this.query)&&Object.keys(this.query).length&&(o=x.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||E[t])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),a=a.replace("#","%23"),t+i+r+a+n},n.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},n.prototype.resolveObject=function(e){if(l.isString(e)){var t=new n;t.parse(e,!1,!0),e=t}for(var r=new n,i=Object.keys(this),o=0;o<i.length;o++){var a=i[o];r[a]=this[a]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),u=0;u<s.length;u++){var c=s[u];"protocol"!==c&&(r[c]=e[c])}return E[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!E[e.protocol]){for(var h=Object.keys(e),d=0;d<h.length;d++){var p=h[d];r[p]=e[p]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||w[e.protocol])r.pathname=e.pathname;else{for(x=(e.pathname||"").split("/");x.length&&!(e.host=x.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==x[0]&&x.unshift(""),x.length<2&&x.unshift(""),r.pathname=x.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var f=r.pathname||"",m=r.search||"";r.path=f+m}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var v=r.pathname&&"/"===r.pathname.charAt(0),y=e.host||e.pathname&&"/"===e.pathname.charAt(0),g=y||v||r.host&&e.pathname,_=g,b=r.pathname&&r.pathname.split("/")||[],x=e.pathname&&e.pathname.split("/")||[],N=r.protocol&&!E[r.protocol];if(N&&(r.hostname="",r.port=null,r.host&&(""===b[0]?b[0]=r.host:b.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===x[0]?x[0]=e.host:x.unshift(e.host)),e.host=null),g=g&&(""===x[0]||""===b[0])),y)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,b=x;else if(x.length)b||(b=[]),b.pop(),b=b.concat(x),r.search=e.search,r.query=e.query;else if(!l.isNullOrUndefined(e.search))return N&&(r.hostname=r.host=b.shift(),(A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=A.shift(),r.host=r.hostname=A.shift())),r.search=e.search,r.query=e.query,l.isNull(r.pathname)&&l.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!b.length)return r.pathname=null,r.path=r.search?"/"+r.search:null,r.href=r.format(),r;for(var S=b.slice(-1)[0],C=(r.host||e.host||b.length>1)&&("."===S||".."===S)||""===S,T=0,P=b.length;P>=0;P--)"."===(S=b[P])?b.splice(P,1):".."===S?(b.splice(P,1),T++):T&&(b.splice(P,1),T--);if(!g&&!_)for(;T--;T)b.unshift("..");!g||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),C&&"/"!==b.join("/").substr(-1)&&b.push("");var k=""===b[0]||b[0]&&"/"===b[0].charAt(0);if(N){r.hostname=r.host=k?"":b.length?b.shift():"";var A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");A&&(r.auth=A.shift(),r.host=r.hostname=A.shift())}return(g=g||r.host&&b.length)&&!k&&b.unshift(""),b.length?r.pathname=b.join("/"):(r.pathname=null,r.path=null),l.isNull(r.pathname)&&l.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},n.prototype.parseHost=function(){var e=this.host,t=h.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":46,punycode:41,querystring:44}],46:[function(e,t,r){"use strict";t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],47:[function(e,t,r){function n(e){var t=this,r=d.call(arguments,1);return new Promise(function(n,o){function a(e){var t;try{t=r.next(e)}catch(r){return o(r)}l(t)}function s(e){var t;try{t=r["throw"](e)}catch(r){return o(r)}l(t)}function l(e){if(e.done)return n(e.value);var r=i.call(t,e.value);return r&&u(r)?r.then(a,s):s(new TypeError('You may only yield a function, promise, generator, array, or object, but the following object was passed: "'+String(e.value)+'"'))}return"function"==typeof e&&(e=e.apply(t,r)),e&&"function"==typeof e.next?void a():n(e)})}function i(e){return e?u(e)?e:c(e)||l(e)?n.call(this,e):"function"==typeof e?o.call(this,e):Array.isArray(e)?a.call(this,e):h(e)?s.call(this,e):e:e}function o(e){var t=this;return new Promise(function(r,n){e.call(t,function(e,t){return e?n(e):(arguments.length>2&&(t=d.call(arguments,1)),void r(t))})})}function a(e){return Promise.all(e.map(i,this))}function s(e){for(var t=new e.constructor,r=Object.keys(e),n=[],o=0;o<r.length;o++){var a=r[o],s=i.call(this,e[a]);s&&u(s)?function(e,r){t[r]=void 0,n.push(e.then(function(e){t[r]=e}))}(s,a):t[a]=e[a]}return Promise.all(n).then(function(){return t})}function u(e){return"function"==typeof e.then}function l(e){return"function"==typeof e.next&&"function"==typeof e["throw"]}function c(e){var t=e.constructor;return!!t&&("GeneratorFunction"===t.name||"GeneratorFunction"===t.displayName||l(t.prototype))}function h(e){return Object==e.constructor}var d=Array.prototype.slice;t.exports=n["default"]=n.co=n,n.wrap=function(e){function t(){return n.call(this,e.apply(this,arguments))}return t.__generatorFunction__=e,t}},{}],48:[function(e,t,r){var n="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r=t.space||"";"number"==typeof r&&(r=Array(r+1).join(" "));var a="boolean"==typeof t.cycles&&t.cycles,s=t.replacer||function(e,t){return t},u=t.cmp&&function(e){return function(t){return function(r,n){return e({key:r,value:t[r]},{key:n,value:t[n]})}}}(t.cmp),l=[];return function c(e,t,h,d){var p=r?"\n"+new Array(d+1).join(r):"",f=r?": ":":";if(h&&h.toJSON&&"function"==typeof h.toJSON&&(h=h.toJSON()),void 0!==(h=s.call(e,t,h))){if("object"!=typeof h||null===h)return n.stringify(h);if(i(h)){for(var m=[],v=0;v<h.length;v++){var y=c(h,v,h[v],d+1)||n.stringify(null);m.push(p+r+y)}return"["+m.join(",")+p+"]"}if(-1!==l.indexOf(h)){if(a)return n.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}l.push(h);for(var g=o(h).sort(u&&u(h)),m=[],v=0;v<g.length;v++){var _=c(h,t=g[v],h[t],d+1);if(_){var b=n.stringify(t)+f+_;m.push(p+r+b)}}return l.splice(l.indexOf(h),1),"{"+m.join(",")+p+"}"}}({"":e},"",e,0)};var i=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},o=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},r=[];for(var n in e)t.call(e,n)&&r.push(n);return r}},{jsonify:49}],49:[function(e,t,r){r.parse=e("./lib/parse"),r.stringify=e("./lib/stringify")},{"./lib/parse":50,"./lib/stringify":51}],50:[function(e,t,r){var n,i,o,a,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},u=function(e){throw{name:"SyntaxError",message:e,at:n,text:o}},l=function(e){return e&&e!==i&&u("Expected '"+e+"' instead of '"+i+"'"),i=o.charAt(n),n+=1,i},c=function(){var e,t="";for("-"===i&&(t="-",l("-"));i>="0"&&"9">=i;)t+=i,l();if("."===i)for(t+=".";l()&&i>="0"&&"9">=i;)t+=i;if("e"===i||"E"===i)for(t+=i,l(),"-"!==i&&"+"!==i||(t+=i,l());i>="0"&&"9">=i;)t+=i,l();return e=+t,isFinite(e)?e:void u("Bad number")},h=function(){var e,t,r,n="";if('"'===i)for(;l();){if('"'===i)return l(),n;if("\\"===i)if(l(),"u"===i){for(r=0,t=0;4>t&&(e=parseInt(l(),16),isFinite(e));t+=1)r=16*r+e;n+=String.fromCharCode(r)}else{if("string"!=typeof s[i])break;n+=s[i]}else n+=i}u("Bad string")},d=function(){for(;i&&" ">=i;)l()},p=function(){switch(i){case"t":return l("t"),l("r"),l("u"),l("e"),!0;case"f":return l("f"),l("a"),l("l"),l("s"),l("e"),!1;case"n":return l("n"),l("u"),l("l"),l("l"),null}u("Unexpected '"+i+"'")},f=function(){var e=[];if("["===i){if(l("["),d(),"]"===i)return l("]"),e;for(;i;){if(e.push(a()),d(),"]"===i)return l("]"),e;l(","),d()}}u("Bad array")},m=function(){var e,t={};if("{"===i){if(l("{"),d(),"}"===i)return l("}"),t;for(;i;){if(e=h(),d(),l(":"),Object.hasOwnProperty.call(t,e)&&u('Duplicate key "'+e+'"'),t[e]=a(),d(),"}"===i)return l("}"),t;l(","),d()}}u("Bad object")};a=function(){switch(d(),i){case"{":return m();case"[":return f();case'"':return h();case"-":return c();default:return i>="0"&&"9">=i?c():p()}},t.exports=function(e,t){var r;return o=e,n=0,i=" ",r=a(),d(),i&&u("Syntax error"),"function"==typeof t?function s(e,r){var n,i,o=e[r];if(o&&"object"==typeof o)for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(void 0!==(i=s(o,n))?o[n]=i:delete o[n]);return t.call(e,r,o)}({"":r},""):r}},{}],51:[function(e,t,r){function n(e){return u.lastIndex=0,u.test(e)?'"'+e.replace(u,function(e){var t=l[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function i(e,t){var r,u,l,c,h,d=o,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof s&&(p=s.call(t,e,p)),typeof p){case"string":return n(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(o+=a,h=[],"[object Array]"===Object.prototype.toString.apply(p)){for(c=p.length,r=0;c>r;r+=1)h[r]=i(r,p)||"null";return l=0===h.length?"[]":o?"[\n"+o+h.join(",\n"+o)+"\n"+d+"]":"["+h.join(",")+"]",o=d,l}if(s&&"object"==typeof s)for(c=s.length,r=0;c>r;r+=1)"string"==typeof(u=s[r])&&(l=i(u,p))&&h.push(n(u)+(o?": ":":")+l);else for(u in p)Object.prototype.hasOwnProperty.call(p,u)&&(l=i(u,p))&&h.push(n(u)+(o?": ":":")+l);return l=0===h.length?"{}":o?"{\n"+o+h.join(",\n"+o)+"\n"+d+"}":"{"+h.join(",")+"}",o=d,l}}var o,a,s,u=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,r){var n;if(o="",a="","number"==typeof r)for(n=0;r>n;n+=1)a+=" ";else"string"==typeof r&&(a=r);if(s=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return i("",{"":e})}},{}],ajv:[function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);e=this._opts=L.copy(e)||{},this._schemas={},this._refs={},this._fragments={},this._formats=R(e.format);var t=this._schemaUriFormat=this._formats["uri-reference"];this._schemaUriFormatFunc=function(e){return t.test(e)},this._cache=e.cache||new A,this._loadingSchemas={},this._compilations=[],this.RULES=j(),this._getId=y(e),e.loopRequired=e.loopRequired||1/0,"property"==e.errorDataPath&&(e._errorDataPathProperty=!0),void 0===e.serialize&&(e.serialize=I),this._metaOpts=T(this),e.formats&&S(this),x(this),"object"==typeof e.meta&&this.addMetaSchema(e.meta),N(this),e.patternGroups&&M(this)}function i(e,t){var r;if("string"==typeof e){if(!(r=this.getSchema(e)))throw new Error('no schema with key or ref "'+e+'"')}else{var n=this._addSchema(e);r=n.validate||this._compile(n)}var i=r(t);return!0===r.$async?"*"==this._opts.async?F(i):i:(this.errors=r.errors,i)}function o(e,t){var r=this._addSchema(e,void 0,t);return r.validate||this._compile(r)}function a(e,t,r,n){if(Array.isArray(e))for(var i=0;i<e.length;i++)this.addSchema(e[i],void 0,r,n);else{var o=this._getId(e);if(void 0!==o&&"string"!=typeof o)throw new Error("schema id must be string");C(this,t=k.normalizeId(t||o)),this._schemas[t]=this._addSchema(e,r,n,!0)}}function s(e,t,r){this.addSchema(e,t,r,!0)}function u(e,t){var r=e.$schema;if(void 0!==r&&"string"!=typeof r)throw new Error("$schema must be a string");if(!(r=r||this._opts.defaultMeta||l(this)))return console.warn("meta-schema not available"),this.errors=null,!0;var n=this._formats.uri;this._formats.uri="function"==typeof n?this._schemaUriFormatFunc:this._schemaUriFormat;var i;try{i=this.validate(r,e)}finally{this._formats.uri=n}if(!i&&t){var o="schema is invalid: "+this.errorsText();if("log"!=this._opts.validateSchema)throw new Error(o);console.error(o)}return i}function l(e){var t=e._opts.meta;return e._opts.defaultMeta="object"==typeof t?e._getId(t)||t:e.getSchema($)?$:void 0}function c(e){var t=d(this,e);switch(typeof t){case"object":return t.validate||this._compile(t);case"string":return this.getSchema(t);case"undefined":return h(this,e)}}function h(e,t){var r=k.schema.call(e,{schema:{}},t);if(r){var n=r.schema,i=r.root,o=r.baseId,a=P.call(e,n,i,void 0,o);return e._fragments[t]=new O({ref:t,fragment:!0,schema:n,root:i,baseId:o,validate:a}),a}}function d(e,t){return t=k.normalizeId(t),e._schemas[t]||e._refs[t]||e._fragments[t]}function p(e){if(e instanceof RegExp)return f(this,this._schemas,e),
void f(this,this._refs,e);switch(typeof e){case"undefined":return f(this,this._schemas),f(this,this._refs),void this._cache.clear();case"string":var t=d(this,e);return t&&this._cache.del(t.cacheKey),delete this._schemas[e],void delete this._refs[e];case"object":var r=this._opts.serialize,n=r?r(e):e;this._cache.del(n);var i=this._getId(e);i&&(i=k.normalizeId(i),delete this._schemas[i],delete this._refs[i])}}function f(e,t,r){for(var n in t){var i=t[n];i.meta||r&&!r.test(n)||(e._cache.del(i.cacheKey),delete t[n])}}function m(e,t,r,n){if("object"!=typeof e&&"boolean"!=typeof e)throw new Error("schema should be object or boolean");var i=this._opts.serialize,o=i?i(e):e,a=this._cache.get(o);if(a)return a;n=n||!1!==this._opts.addUsedSchema;var s=k.normalizeId(this._getId(e));s&&n&&C(this,s);var u,l=!1!==this._opts.validateSchema&&!t;l&&!(u=s&&s==k.normalizeId(e.$schema))&&this.validateSchema(e,!0);var c=k.ids.call(this,e),h=new O({id:s,schema:e,localRefs:c,cacheKey:o,meta:r});return"#"!=s[0]&&n&&(this._refs[s]=h),this._cache.put(o,h),l&&u&&this.validateSchema(e,!0),h}function v(e,t){function r(){var t=e.validate,n=t.apply(null,arguments);return r.errors=t.errors,n}if(e.compiling)return e.validate=r,r.schema=e.schema,r.errors=null,r.root=t||r,!0===e.schema.$async&&(r.$async=!0),r;e.compiling=!0;var n;e.meta&&(n=this._opts,this._opts=this._metaOpts);var i;try{i=P.call(this,e.schema,t,e.localRefs)}finally{e.compiling=!1,e.meta&&(this._opts=n)}return e.validate=i,e.refs=i.refs,e.refVal=i.refVal,e.root=i.root,i}function y(e){switch(e.schemaId){case"$id":return _;case"id":return g;default:return b}}function g(e){return e.$id&&console.warn("schema $id ignored",e.$id),e.id}function _(e){return e.id&&console.warn("schema id ignored",e.id),e.$id}function b(e){if(e.$id&&e.id&&e.$id!=e.id)throw new Error("schema $id is different from id");return e.$id||e.id}function w(e,t){if(!(e=e||this.errors))return"No errors";for(var r=void 0===(t=t||{}).separator?", ":t.separator,n=void 0===t.dataVar?"data":t.dataVar,i="",o=0;o<e.length;o++){var a=e[o];a&&(i+=n+a.dataPath+" "+a.message+r)}return i.slice(0,-r.length)}function E(e,t){"string"==typeof t&&(t=new RegExp(t)),this._formats[e]=t}function x(t){var r;if(t._opts.$data&&(r=e("./refs/$data.json"),t.addMetaSchema(r,r.$id,!0)),!1!==t._opts.meta){var n=e("./refs/json-schema-draft-06.json");t._opts.$data&&(n=D(n,W)),t.addMetaSchema(n,$,!0),t._refs["http://json-schema.org/schema"]=$}}function N(e){var t=e._opts.schemas;if(t)if(Array.isArray(t))e.addSchema(t);else for(var r in t)e.addSchema(t[r],r)}function S(e){for(var t in e._opts.formats){var r=e._opts.formats[t];e.addFormat(t,r)}}function C(e,t){if(e._schemas[t]||e._refs[t])throw new Error('schema with key or id "'+t+'" already exists')}function T(e){for(var t=L.copy(e._opts),r=0;r<H.length;r++)delete t[H[r]];return t}var P=e("./compile"),k=e("./compile/resolve"),A=e("./cache"),O=e("./compile/schema_obj"),I=e("json-stable-stringify"),R=e("./compile/formats"),j=e("./compile/rules"),D=e("./$data"),M=e("./patternGroups"),L=e("./compile/util"),F=e("co");t.exports=n,n.prototype.validate=i,n.prototype.compile=o,n.prototype.addSchema=a,n.prototype.addMetaSchema=s,n.prototype.validateSchema=u,n.prototype.getSchema=c,n.prototype.removeSchema=p,n.prototype.addFormat=E,n.prototype.errorsText=w,n.prototype._addSchema=m,n.prototype._compile=v,n.prototype.compileAsync=e("./compile/async");var V=e("./keyword");n.prototype.addKeyword=V.add,n.prototype.getKeyword=V.get,n.prototype.removeKeyword=V.remove;var B=e("./compile/error_classes");n.ValidationError=B.Validation,n.MissingRefError=B.MissingRef,n.$dataMetaSchema=D;var $="http://json-schema.org/draft-06/schema",H=["removeAdditional","useDefaults","coerceTypes"],W=["/properties"]},{"./$data":1,"./cache":2,"./compile":8,"./compile/async":4,"./compile/error_classes":6,"./compile/formats":7,"./compile/resolve":9,"./compile/rules":10,"./compile/schema_obj":11,"./compile/util":13,"./keyword":37,"./patternGroups":38,"./refs/$data.json":39,"./refs/json-schema-draft-06.json":40,co:47,"json-stable-stringify":48}]},{},[])("ajv")}),define("text",["module"],function(e){"use strict";var t,r,n,i,o,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l="undefined"!=typeof location&&location.href,c=l&&location.protocol&&location.protocol.replace(/\:/,""),h=l&&location.hostname,d=l&&(location.port||void 0),p={},f=e.config&&e.config()||{};return t={version:"2.0.12",strip:function(e){if(e){e=e.replace(s,"");var t=e.match(u);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,t,r;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){r=a[t];try{e=new ActiveXObject(r)}catch(n){}if(e){a=[r];break}}return e},parseName:function(e){var t,r,n,i=!1,o=e.indexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!a||o>1)?(t=e.substring(0,o),r=e.substring(o+1,e.length)):t=e,n=r||t,o=n.indexOf("!"),-1!==o&&(i="strip"===n.substring(o+1),n=n.substring(0,o),r?r=n:t=n),{moduleName:t,ext:r,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,r,n,i){var o,a,s,u=t.xdRegExp.exec(e);return u?(o=u[2],a=u[3],a=a.split(":"),s=a[1],a=a[0],!(o&&o!==r||a&&a.toLowerCase()!==n.toLowerCase()||(s||a)&&s!==i)):!0},finishLoad:function(e,r,n,i){n=r?t.strip(n):n,f.isBuild&&(p[e]=n),i(n)},load:function(e,r,n,i){if(i&&i.isBuild&&!i.inlineText)return void n();f.isBuild=i&&i.isBuild;var o=t.parseName(e),a=o.moduleName+(o.ext?"."+o.ext:""),s=r.toUrl(a),u=f.useXhr||t.useXhr;return 0===s.indexOf("empty:")?void n():void(!l||u(s,c,h,d)?t.get(s,function(r){t.finishLoad(e,o.strip,r,n)},function(e){n.error&&n.error(e)}):r([a],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,n)}))},write:function(e,r,n,i){if(p.hasOwnProperty(r)){var o=t.jsEscape(p[r]);n.asModule(e+"!"+r,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,r,n,i,o){var a=t.parseName(r),s=a.ext?"."+a.ext:"",u=a.moduleName+s,l=n.toUrl(a.moduleName+s)+".js";t.load(u,n,function(r){var n=function(e){return i(l,e)};n.asModule=function(e,t){return i.asModule(e,l,t)},t.write(e,u,n,o)},o)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(r=require.nodeRequire("fs"),t.get=function(e,t,n){try{var i=r.readFileSync(e,"utf8");0===i.indexOf("\ufeff")&&(i=i.substring(1)),t(i)}catch(o){n&&n(o)}}):"xhr"===f.env||!f.env&&t.createXhr()?t.get=function(e,r,n,i){var o,a=t.createXhr();if(a.open("GET",e,!0),i)for(o in i)i.hasOwnProperty(o)&&a.setRequestHeader(o.toLowerCase(),i[o]);f.onXhr&&f.onXhr(a,e),a.onreadystatechange=function(t){var i,o;4===a.readyState&&(i=a.status||0,i>399&&600>i?(o=new Error(e+" HTTP status: "+i),o.xhr=a,n&&n(o)):r(a.responseText),f.onXhrComplete&&f.onXhrComplete(a,e))},a.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var r,n,i="utf-8",o=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),i)),u="";try{for(r=new java.lang.StringBuffer,n=s.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&r.append(n);null!==(n=s.readLine());)r.append(a),r.append(n);u=String(r.toString())}finally{s.close()}t(u)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var r,a,s,u={};o&&(e=e.replace(/\//g,"\\")),s=new FileUtils.File(e);try{r=n["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),r.init(s,1,0,!1),a=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),a.init(r,"utf-8",r.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(r.available(),u),a.close(),r.close(),t(u.value)}catch(l){throw new Error((s&&s.path||"")+": "+l)}}),t}),define("text!wed/wed-options-schema.json",[],function(){return'{"$schema":"http://json-schema.org/schema#","id":"http://btw.mangalam-research.org/schemas/wed/wed-options.json","title":"Wed Options","description":"A schema describing the wed options that modes may set.","type":"object","properties":{"metadata":{"description":"Information describing the mode.","type":"object","properties":{"name":{"description":"The mode\'s name.","type":"string"},"authors":{"description":"The authors of the mode.","type":"array","items":{"type":"string"}},"description":{"description":"The description of the mode.","type":"string"},"license":{"description":"The licence under which the mode is distributed.","type":"string"},"copyright":{"description":"Copyright information (holders, dates, etc.)","type":"string"}},"additionalProperties":false,"required":["name","authors","description","license","copyright"]},"label_levels":{"description":"Options regarding the levels labels may take.","type":"object","properties":{"max":{"description":"The maximum label level that the mode uses.","type":"integer","minimum":1},"initial":{"description":"The initial label level to start. It must be less or equal to \\"max\\".","type":"integer","minimum":1}},"additionalProperties":false,"required":["max","initial"]},"attributes":{"description":"Options regarding how attributes are handled. If it is a string then it must be \\"hide\\", \\"show\\" or \\"edit\\".  The value \\"hide\\" means hide all attributes and do not allow direct editing. The value \\"show\\" means show the attributes but do not allow direct editing. The value \\"edit\\" means show attributes and allow direct editing of attributes. By \\"direct editing\\" we mean editing of attributes as attributes. Note that indirect editing of attributes is always allowed. A mode could bring up a modal didalog to perform an action that modifies attributes behind the scenes no matter what the option here says.\\nAlso note that a mode may prevent editing of attributes on a case-by-case basis by not returning actions that edit attribute values. The setting here operates coarsely.\\nThe value may be an object in order to use more features.","oneOf":[{"type":"string","enum":["hide","show","edit"]},{"type":"object","properties":{"handling":{"description":"Determines how attributes are handled. The values are the same as described above with the exception that \\"hide\\" is not valid here.","type":"string","enum":["show","edit"]},"autohide":{"description":"Describes attributes that may be autohidden. If absent then no attributes are autohidden.","type":"object","properties":{"method":{"description":"The method by which attributes are described.","type":"string","enum":["selector"]},"elements":{"description":"Elements which have autohide enabled.","type":"array","items":{"type":"object","properties":{"selector":{"description":"CSS selector matching one or more elements. This selector must use the prefixes defined by the mode\\\\\'s metadata. This selector is subject to limitations explained in ``domutil.toGUISelector``. The hiding algorithm ceases searching for matches as soon as one selector matches.","type":"string"},"attributes":{"description":"Specifies the attributes to hide. The array is executed in order when matching attributes. Later elements in the array override earlier elements.","type":"array","items":{"oneOf":[{"description":"Local name (optionally prefixed) of the attributes to hide. The specisl special name \\"*\\" means \\"match all attributes\\".","type":"string"},{"description":"An exclusion from the attributes to hide.","type":"object","properties":{"except":{"description":"The list of attributes to exclude.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["except"]}]}}},"additionalProperties":false,"required":["selector","attributes"]}}},"additionalProperties":false,"required":["method","elements"]}},"additionalProperties":false,"required":["handling"]}]}},"additionalProperties":false,"required":["metadata","label_levels"]}'}),define("wed/wed_init",["require","./wed_core","./wed-util","./build-info","jquery","./log","./preferences","./domutil","./guiroot","./dloc","./savers/ajax","./savers/localforage","./savers/indexeddb","./tree-updater","./gui-updater","./undo-recorder","./domlistener","./validator","./validation-controller","./gui/modal","./gui/icon","./undo","./transformation","./onbeforeunload","./action","./oop","./runtime","./task-runner","./caret-manager","./gui/layer","./gui/error-layer","./gui/scroller","salve","bluebird","ajv","./wed-options-schema.json"],function(e){"use strict";function t(e,t){return t.name===e}function r(){T.apply(this,arguments)}function n(e){e.data.editor.destroy()}var i=e("./wed_core"),o=e("./wed-util"),a=e("./build-info"),s=e("jquery"),u=e("./log"),l=e("./preferences"),c=e("./domutil"),h=e("./guiroot"),d=e("./dloc"),p=e("./savers/ajax").Saver,f=e("./savers/localforage").Saver,m=e("./savers/indexeddb").Saver,v=e("./tree-updater").TreeUpdater,y=e("./gui-updater").GUIUpdater,g=e("./undo-recorder").UndoRecorder,_=e("./domlistener"),b=e("./validator"),w=e("./validation-controller").ValidationController,E=e("./gui/modal"),x=e("./gui/icon"),N=e("./undo"),S=e("./transformation"),C=e("./onbeforeunload"),T=e("./action").Action,P=e("./oop"),k=e("./runtime").Runtime,A=e("./task-runner").TaskRunner,O=e("./caret-manager").CaretManager,I=e("./gui/layer").Layer,R=e("./gui/error-layer").ErrorLayer,j=e("./gui/scroller").Scroller,D=e("salve"),M=e("bluebird"),L=e("ajv"),F=e("./wed-options-schema.json"),V=i.Editor,B=i.version,$=o.paste,H=o.cut,W=b.Validator,q=c.closest,U=c.indexOf;P.inherit(r,T),r.prototype.execute=function(){var e=this._editor;e._complex_pattern_modal.modal()};var z=V.prototype;z.init=u.wrap(function(t,i,o){this.max_label_level=void 0,this._current_label_level=void 0,this._stripped_spaces=/\u200B/g,this._replaced_spaces=/\s+/g,this._normalize_entered_spaces=!0,this.preferences=new l.Preferences({tooltips:!0}),this.widget=t,this.$widget=s(this.widget),this.$frame=s(q(this.widget,"html"));var c=this.$frame[0].ownerDocument;this.my_window=c.defaultView,this.doc=c;var p=new this.my_window.DOMParser;o?(this.data_root=p.parseFromString(o,"text/xml"),this._dataChild=this.data_root.firstChild):(this.data_root=p.parseFromString("<div></div>","text/xml"),this._dataChild=void 0),this.data_root.removeChild(this.data_root.firstChild),i.ignore_module_config&&console.warn("the option ignore_module_config is no longer useful"),i instanceof k?(this.runtime=i,i=this.runtime.options):(this.runtime=new k(i),i=this.runtime.options),this.name=i.name,i.ajaxlog&&u.addURL(i.ajaxlog.url,i.ajaxlog.headers),this._save=i.save,this._first_validation_complete=!1,this._destroying=!1,this._destroyed=!1,this.options=i;var f=s('<div class="row"> <div class="wed-frame col-sm-push-2 col-lg-10 col-md-10 col-sm-10">  <div class="row">   <div class="progress">    <span></span>    <div id="validation-progress" class="progress-bar" style="width: 0%"/>   </div>  </div>  <div class="row">   <div class="wed-cut-buffer" contenteditable="true"></div>   <div class="wed-document-constrainer">    <input class="wed-comp-field" type="text"></input>    <div class="wed-caret-layer">    </div>    <div class="wed-scroller">     <div class="wed-error-layer"></div>     <div class="wed-document"><span class="root-here"/></div>    </div>   </div>   <div class="wed-location-bar"><span>&nbsp;</span></div>  </div> </div> <div id="sidebar" class="col-sm-pull-10 col-lg-2 col-md-2 col-sm-2"/></div>',c),m=f[0];this.gui_root=m.getElementsByClassName("wed-document")[0],this.$gui_root=s(this.gui_root),this._scroller=new j(m.getElementsByClassName("wed-scroller")[0]),this._input_field=m.getElementsByClassName("wed-comp-field")[0],this._$input_field=s(this._input_field),this._cut_buffer=m.getElementsByClassName("wed-cut-buffer")[0],this._caretLayer=new I(m.getElementsByClassName("wed-caret-layer")[0]),this._errorLayer=new R(m.getElementsByClassName("wed-error-layer")[0]),this._wed_location_bar=m.getElementsByClassName("wed-location-bar")[0];var b=m.getElementsByClassName("root-here")[0];if(t.firstChild){if(!(t.firstChild instanceof this.my_window.Element))throw new Error("the data is populated with DOM elements constructed from another window");b.parentNode.insertBefore(t.firstChild,b)}b.parentNode.removeChild(b),this.widget.appendChild(m);var w=c.getElementById("sidebar");this._sidebar=w,this.validation_progress=c.getElementById("validation-progress"),this.validation_message=this.validation_progress.previousElementSibling,this._caret_owners=this.gui_root.getElementsByClassName("_owns_caret"),this._clicked_labels=this.gui_root.getElementsByClassName("_label_clicked"),this._withCaret=this.gui_root.getElementsByClassName("_with_caret"),this.$data_root=s(this.data_root),this.gui_dloc_root=new h.GUIRoot(this.gui_root),this.data_dloc_root=new d.DLocRoot(this.data_root),this.data_updater=new v(this.data_root),this._gui_updater=new y(this.gui_root,this.data_updater),this._undo_recorder=new g(this,this.data_updater);var C=document.getElementsByClassName("wed-has-tooltip");this._gui_updater.events.subscribe(function(e){if("BeforeDeleteNode"===e.name){var t=e.node;if(t.nodeType!==Node.TEXT_NODE)for(var r=0,n=C.length;n>r;++r){var i=C[r];if(t.contains(i)){var o=s.data(i,"bs.tooltip");o&&o.destroy()}}}}),w.innerHTML='<div class="wed-save-and-modification-status">  <span class="wed-modification-status label label-success"         title="Modification status">   <i class="fa fa-asterisk"></i>  </span>  <span class="wed-save-status label label-default">   <i class="fa fa-cloud-upload"></i> <span></span>  </span></div><div id="sidebar-panel" class="panel-group wed-sidebar-panel"> <div class="panel panel-info wed-navigation-panel">  <div class="panel-heading">   <div class="panel-title">    <a class="accordion-toggle" data-toggle="collapse"        data-parent="#sidebar-panel"        href="#sb-nav-collapse">Navigation</a>   </div>  </div> <div id="sb-nav-collapse" data-parent="#sidebar-panel"       class="panel-collapse collapse in">   <div id="sb-nav" class="panel-body">    <ul id="navlist" class="nav nav-list">     <li class="inactive">A list of navigation links will appear here</li>    </ul>   </div>  </div> </div> <div class="panel panel-danger">  <div class="panel-heading">   <div class="panel-title">    <a class="accordion-toggle" data-toggle="collapse"       data-parent="#sidebar-panel"       href="#sb-errors-collapse">Errors</a>   </div>  </div>  <div id="sb-errors-collapse" data-parent="#sidebar-panel"       class="panel-collapse collapse">   <div id="sb-errors" class="panel-body">    <ul id="sb-errorlist" class="nav nav-list wed-errorlist">     <li class="inactive"></li>    </ul>   </div>  </div> </div></div>',this._$modification_status=s(w.getElementsByClassName("wed-modification-status")[0]),this._$save_status=s(w.getElementsByClassName("wed-save-status")[0]),this._$navigation_panel=s(w.getElementsByClassName("wed-navigation-panel")[0]),this._$navigation_panel.css("display","none"),this._current_dropdown=void 0,this._limitation_modal=new E.Modal,this._limitation_modal.setTitle("Cannot proceed"),this._complex_pattern_modal=this.makeModal(),this._complex_pattern_modal.setTitle("Complex Name Pattern Encountered"),this._complex_pattern_modal.setBody("<p>The schema contains here a complex name pattern modal.          While wed has no problem validating such cases. It does not          currently have facilities to add elements or attributes that          match such patterns. You can continue editing your document but          you will not be able to take advantage of the possibilities          provided by the complex pattern here.</p>"),this._complex_pattern_modal.addButton("Ok",!0),this._paste_modal=this.makeModal(),this._paste_modal.setTitle("Invalid structure"),this._paste_modal.setBody("<p>The data you are trying to paste appears to be XML.         However, pasting it here will result in a structurally invalid         document. Do you want to paste it as text instead? (If you answer         negatively, the data won't be pasted at all.)<p>"),this._paste_modal.addYesNo(),this.straddling_modal=this.makeModal(),this.straddling_modal.setTitle("Invalid modification"),this.straddling_modal.setBody("<p>The text selected straddles disparate elements of the document.         You may be able to achieve what you want to do by selecting         smaller sections.<p>"),this.straddling_modal.addButton("Ok",!0);var T=this.doc_link=e.toUrl("../../doc/index.html");this.help_modal=this.makeModal(),this.help_modal.setTitle("Help"),this.help_modal.setBody("<p>Click <a href='"+T+"' target='_blank'>this link</a> to see wed's generic help. The link by default will open in a new tab.</p><p>The key combinations with Ctrl below are done with Command in OS X.</p><ul>  <li>Clicking the right mouse button on the document contents brings up a contextual menu.</li>  <li>F1: help</li>  <li>Ctrl-[: Decrease the label visibility level.</li>  <li>Ctrl-]: Increase the label visibility level.</li>  <li>Ctrl-S: Save</li>  <li>Ctrl-X: Cut</li>  <li>Ctrl-V: Paste</li>  <li>Ctrl-C: Copy</li>  <li>Ctrl-Z: Undo</li>  <li>Ctrl-Y: Redo</li>  <li>Ctrl-/: Bring up a contextual menu.</li></ul><p class='wed-build-info'>Build descriptor: "+a.desc+"<br/>Build date: "+a.date+"</p>"),this.help_modal.addButton("Close",!0),this._disconnect_modal=this.makeModal(),this._disconnect_modal.setTitle("Disconnected from server!"),this._disconnect_modal.setBody("It appears your browser is disconnected from the server.         Editing is frozen until the connection is reestablished.         Dismissing this dialog will retry saving. If the operation is         successful, you'll be able to continue editing. If not, this         message will reappear."),this._disconnect_modal.addButton("Retry",!0),this._edited_by_other_modal=this.makeModal(),this._edited_by_other_modal.setTitle("Edited by another!"),this._edited_by_other_modal.setBody("Your document was edited by someone else since you last loaded or         saved it. You must reload it before trying to edit further."),this._edited_by_other_modal.addButton("Reload",!0),this._too_old_modal=this.makeModal(),this._too_old_modal.setTitle("Newer version!"),this._too_old_modal.setBody("There is a newer version of the editor.         You must reload it before trying to edit further."),this._too_old_modal.addButton("Reload",!0),this._$navigation_list=s(c.getElementById("navlist")),this.domlistener=new _.Listener(this.gui_root,this._gui_updater),s(this.my_window).on("unload.wed",{editor:this},n),s(this.my_window).on("popstate.wed",function(){""===document.location.hash&&(this.gui_root.scrollTop=0)}.bind(this)),this._taskRunners=[],this._taskSuspension=0,this.$error_list=s(c.getElementById("sb-errorlist")),this._$excluded_from_blur=s(),this._errorItemHandler_bound=this._errorItemHandler.bind(this),this._undo=new N.UndoList,this.mode_path=i.mode.path,this.complex_pattern_action=new r(this,"Complex name pattern",void 0,x.makeHTML("exclamation"),!0),this.paste_tr=new S.Transformation(this,"add","Paste",$),this.cut_tr=new S.Transformation(this,"delete","Cut",H),this.split_node_tr=new S.Transformation(this,"split","Split <name>",function(e,t){return S.splitNode(e,t.node)}),this.merge_with_previous_homogeneous_sibling_tr=new S.Transformation(this,"merge-with-previous","Merge <name> with previous",function(e,t){return S.mergeWithPreviousHomogeneousSibling(e,t.node)}),this.merge_with_next_homogeneous_sibling_tr=new S.Transformation(this,"merge-with-next","Merge <name> with next",function(e,t){return S.mergeWithNextHomogeneousSibling(e,t.node)}),this._global_keydown_handlers=[];var P=new L;this._wedOptionsValidator=P.compile(JSON.parse(F)),this.setMode(this.mode_path,i.mode.options)}),z.setMode=u.wrap(function(e,t){var r=this.runtime;return r.resolveModules(e)["catch"](function(){if(-1!==e.indexOf("/"))throw new Error("can't load mode "+e);var t="./modes/"+e+"/"+e;return r.resolveModules(t)["catch"](function(){return r.resolveModules(t+"-mode")["catch"](function(){return r.resolveModules(t+"_mode")})})}).then(function(e){var r=e[0],n=new r.Mode(this,t);return n.init().then(function(){this.onModeChange(n)}.bind(this))}.bind(this))}),z.onModeChange=u.wrap(function(t){if(!this._destroyed){this.mode=t;var r=t.getWedOptions();if(this._processWedOptions(r)){for(var n=this.mode.getStylesheets(),i=0;i<n.length;++i)this.$frame.children("head").append('<link rel="stylesheet" href="'+e.toUrl(n[i])+'" type="text/css" />');this.gui_root.setAttribute("tabindex","-1"),this.$gui_root.focus(),this.caretManager=new O(this.gui_dloc_root,this.data_dloc_root,this._input_field,this._gui_updater,this._caretLayer,this._scroller,"edit"===this.attributes,this.mode),this.caretManager.events.subscribe(this._caretChange.bind(this)),this._resizeHandler(),this.resolver=t.getAbsoluteResolver();var o=t.getValidator();M.resolve(1).then(function(){var e=this.options.schema;return e instanceof D.Grammar?e:this.runtime.resolveToString(this.options.schema).then(D.constructTree.bind(D))}.bind(this)).then(function(e){this.validator=new W(e,this.data_root,o),this.validator.events.addEventListener("state-update",this._onValidatorStateChange.bind(this)),this.validator.events.addEventListener("possible-due-to-wildcard-change",this._onPossibleDueToWildcardChange.bind(this)),this.validationController=new w(this,this.validator,this.resolver,this._scroller,this.gui_root,this.validation_progress,this.validation_message,this._errorLayer,this.$error_list[0],this._errorItemHandler_bound)}.bind(this)).then(this._postInitialize.bind(this))["catch"](this._postInitialize.bind(this))}}}),z._processWedOptions=function(e){var t=[],r=function(){return this._limitation_modal.setBody("<p>The mode you are trying to use is passing incorrect options to wed. Contact the mode author with the following information: </p><ul><li>"+t.join("</li><li>")+"</li></ul>"),this._limitation_modal.modal(),this.destroy(),!1}.bind(this),n=this._wedOptionsValidator,i=n(e);if(!i){if(void 0!==n.errors)for(var o=0;o<n.errors.length;++o){var a=n.errors[o];t.push(a.dataPath+" "+a.message)}return r()}this.max_label_level=e.label_levels.max;var s=e.label_levels.initial;return s>this.max_label_level&&t.push("label_levels.initial must be <= label_levels.max"),this._current_label_level=s,e.attributes||(e.attributes="hide"),"string"==typeof e.attributes?this.attributes=e.attributes:(this.attributes=e.attributes.handling,this.attributeHiding=e.attributes.autohide),t.length?r():!0},z._postInitialize=u.wrap(function(e){if(e)throw this.destroy(),e;if(!this._destroyed){this.domlistener.addHandler("children-changed","._real, ._phantom_wrap, .wed-document",function(e,t,r,n,i,o){for(var a=t.concat(r),s=!1,u=0,l=a.length;!s&&l>u;++u){var c=a[u];s=c.nodeType===Node.TEXT_NODE||c.classList.contains("_real")||c.classList.contains("_phantom_wrap")}s&&this.validator.resetTo(o)}.bind(this)),this.decorator=this.mode.makeDecorator(this.domlistener,this,this._gui_updater),this.domlistener.addHandler("attribute-changed","._real",function(e,t,r,n){if(!r&&0===n.indexOf("data-wed",0)){var i=this;setTimeout(function(){i._destroyed||i.validator.resetTo(t)},0)}}.bind(this)),this.decorator.addHandlers(),this.domlistener.addHandler("included-element","._label",function(e,t,r,n,i,o){for(var a=o.classList,s=!1,u=0;u<a.length&&!s;++u)0===a[u].lastIndexOf("_label_level_",0)&&(s=Number(a[u].slice(13)));if(!s)throw new Error("unable to get level");s>this._current_label_level&&a.add("_invisible")}.bind(this)),this._updating_placeholder=0,this.domlistener.addHandler("children-changed","._real, ._phantom_wrap, .wed-document",function(e,t,r,n,i,o){if(!this._updating_placeholder){this._updating_placeholder++;for(var a,s=[],u=o.firstChild;u;)(u.nodeType===Node.TEXT_NODE||u.classList.contains("_real")||u.classList.contains("_phantom_wrap")||u.classList.contains("_text"))&&s.push(u),u.classList&&u.classList.contains("_placeholder")&&(a=u),u=u.nextSibling;if(0===s.length||1===s.length&&-1!==r.indexOf(s[0])){if(!a){var l=this.mode.nodesAroundEditableContents(o);if(o===this.gui_root){var c=this.caretManager.makeCaret(this.gui_root,0);a=this.insertTransientPlaceholderAt(c),this.caretManager.setCaret(c,{textEdit:!0})}else a=this.mode.makePlaceholderFor(o),this._gui_updater.insertBefore(o,a,l[1])}}else if(a&&!a.classList.contains("_transient")){var h,d,p=this.caretManager.caret&&this.caretManager.caret.node,f=a.contains(p);f&&(h=a.parentNode,d=U(h.childNodes,a)),this._gui_updater.removeNode(a),f&&this.caretManager.setCaret(h,d,{textEdit:!0})}this._updating_placeholder--}}.bind(this));var r=function(e){if(!this._updating_placeholder){this._updating_placeholder++;var t=this.toDataNode(e),r=c.childByClass(e,"_placeholder");t.value?r&&e.removeChild(r):r||this._gui_updater.insertBefore(e,c.makePlaceholder(),null),this._updating_placeholder--}}.bind(this);if(this.domlistener.addHandler("children-changed","._attribute_value",function(e,t,n,i,o,a){r(a)}),this.domlistener.addHandler("included-element","._attribute_value",function(e,t,n,i,o,a){r(a)}),this.decorator.startListening(),this._dataChild&&this.data_updater.insertAt(this.data_root,0,this._dataChild),this._save){var n={"wed/savers/ajax":p,"wed/savers/localforage":f,"wed/savers/indexeddb":m}[this._save.path];if(!n)throw new Error("unknown saver: "+this._save.path);this._saver=new n(this.runtime,B,this.data_updater,this.data_root,this._save.options),this._saver.events.filter(t.bind(void 0,"Saved")).subscribe(this._onSaverSaved.bind(this)),this._saver.events.filter(t.bind(void 0,"Autosaved")).subscribe(this._onSaverAutosaved.bind(this)),this._saver.events.filter(t.bind(void 0,"Failed")).subscribe(this._onSaverFailed.bind(this)),this._saver.events.filter(t.bind(void 0,"Changed")).subscribe(this._onSaverChanged.bind(this)),void 0!==this._save.autosave&&this._saver.setAutosaveInterval(1e3*this._save.autosave),this._refreshSaveStatus(),this._save_status_interval=setInterval(this._refreshSaveStatus.bind(this),3e4),C.install(this.my_window,function(){return this._destroyed?!1:!!this._saver.getModifiedWhen()}.bind(this),!0)}else u.error("wed cannot save data due to the absence of a save_url option");this.$gui_root.on("dragenter","*",!1),this.$gui_root.on("dragstart","*",!1),this.$gui_root.on("dragover","*",!1),this.$gui_root.on("drop","*",!1),this.$gui_root.on("wed-global-keydown",this._globalKeydownHandler.bind(this)),this.$gui_root.on("wed-global-keypress",this._globalKeypressHandler.bind(this)),this.$gui_root.on("keydown",this._keydownHandler.bind(this)),this.$gui_root.on("keypress",this._keypressHandler.bind(this)),this._$input_field.on("keydown",this._keydownHandler.bind(this)),this._$input_field.on("keypress",this._keypressHandler.bind(this)),this._$input_field.on("compositionstart compositionupdate compositionend",this._compositionHandler.bind(this)),this._$input_field.on("input",this._inputHandler.bind(this)),this.$gui_root.on("mousedown",this._mousedownHandler.bind(this)),this.$gui_root.on("mouseover",this._mouseoverHandler.bind(this)),this.$gui_root.on("mouseout",this._mouseoutHandler.bind(this)),this.$gui_root.on("contextmenu",this._mouseupHandler.bind(this)),this.$gui_root.on("paste",u.wrap(this._pasteHandler.bind(this))),this._$input_field.on("paste",u.wrap(this._pasteHandler.bind(this))),this.$gui_root.on("cut",u.wrap(this._cutHandler.bind(this))),s(this.my_window).on("resize.wed",this._resizeHandler.bind(this)),
this.$gui_root.on("click","a",function(e){return e.ctrlKey&&(window.location=e.currentTarget.href),!1});var i=s(this.doc.body);i.on("mouseup.wed",function(){this.$gui_root.off("mousemove.wed mouseup")}.bind(this)),i.on("contextmenu.wed",function(e){return this.gui_root.contains(e.target)?!1:!0}.bind(this)),i.on("click.wed",function(e){if(!(void 0===e.pageX||e.pageX<0||void 0===e.pageY||e.pageY<0||e.screenX===e.screenY&&0===e.screenX||this.widget.contains(e.target))){var t=this.doc.elementFromPoint(e.clientX,e.clientY);if(!s(t).closest(this._$excluded_from_blur).length){var r=this.$gui_root.offset(),n=e.pageX-r.left,i=e.pageY-r.top;n>=0&&i>=0&&n<this.$gui_root.outerWidth()&&i<this.$gui_root.outerHeight()||this.caretManager.onBlur()}}}.bind(this)),this.$widget.removeClass("loading"),this.$widget.css("display","block");var o=this._initializeNamespaces();if(o)return this._limitation_modal.setBody(o),this._limitation_modal.modal(),void this.destroy();this.domlistener.processImmediately(),this._undo=new N.UndoList,this.$gui_root.focus(),this.validator.start();var a=this.options.demo;if(a){"string"!=typeof a&&(a="Some functions may not be available.");var l=this.makeModal();l.setTitle("Demo"),l.setBody("<p>This is a demo of wed. "+a+"</p><p>Click <a href='"+this.doc_link+"' target='_blank'>this link</a> to see wed's generic help. The link by default will open in a new tab.</p>"),l.addButton("Ok",!0),l.modal()}if(this._saver){var h=this;this._saver.init().then(function(){h._destroyed||h._setCondition("initialized",{editor:h})})}else this._setCondition("initialized",{editor:this})}}),z._initializeNamespaces=function(){var e=!1;if(this.data_root.firstChild){var t=this.validator.getDocumentNamespaces(),r=this.resolver;Object.keys(t).forEach(function(n){var i=t[n];i.length>1&&(e="The document you are trying to edit uses namespaces in a way not supported by this version of wed."),r.definePrefix(n,i[0])})}else{var n=Object.create(null);if(this.validator.getSchemaNamespaces().forEach(function(t){if("*"!==t&&"::except"!==t){var r=this.resolver.prefixFromURI(t);"xml"!==r&&(""===r?n.xmlns=t:(void 0===r&&(e="The mode does not allow determining the namespace prefix for "+t+".The most likely issue is that the mode is buggy or wed was started with incorrect options."),n["xmlns:"+r]=t))}}.bind(this)),e)return e;var i=this.validator.possibleAt(this.data_root,0).toArray();if(1===i.length&&"enterStartTag"===i[0].params[0]){var o=i[0].params[1];o.simple()&&1===o.toArray().length&&(S.insertElement(this.data_updater,this.data_root,0,o.ns,this.resolver.unresolveName(o.ns,o.name),n),this.caretManager.setCaret(this.data_root.firstElementChild,0))}if(!this.data_root.firstChild){var a=this.insertTransientPlaceholderAt(this.caretManager.makeCaret(this.gui_root,0));this.caretManager.setCaret(a,0)}}return e},z._newTaskRunner=function(e){var t=new A(e);return this._taskRunners.push(t),t}}),define("wed/wed_caret",["require","./wed_core","./wed-util","./log","./util","./domutil","bootstrap"],function(e){"use strict";var t=e("./wed_core"),r=e("./wed-util"),n=e("./log"),i=e("./util"),o=e("./domutil");e("bootstrap");var a=t.Editor,s=o.closestByClass,u=o.closest,l=a.prototype;l.excludeFromBlur=function(e){this._$excluded_from_blur.add(e)},l._findLocationAt=function(e,t){var r=this.doc.elementFromPoint(e,t);if(r&&this.gui_root.contains(r))return this._findLocationInElementAt(r,e,t)},l._findLocationInElementAt=function(e,t,r,n){function o(e,n){var o;e.nodeType===Node.TEXT_NODE?(s.setStart(e,n),s.setEnd(e,n+1),o=s.getClientRects()):o=e.childNodes[n].getClientRects();for(var u=0;u<o.length;++u){var l=o[u];if(0!==l.height&&0!==l.width){var c=i.distsFromRect(t,r,l.left,l.top,l.right,l.bottom);if(!a||a.dist.y>c.y||a.dist.y===c.y&&a.dist.x>c.x)return a={dist:c,node:e,start:n},0===c.y&&0===c.x}}return!1}n!==!1&&(n=!0);var a,s=this.doc.createRange(),u=e.firstChild,l=0;e:for(;u;){if(n&&u.nodeType===Node.TEXT_NODE){for(var c=0;c<u.length;++c)if(o(u,c))break e}else if(o(e,l))break;u=u.nextSibling,l++}return a?this.caretManager.makeCaret(a.node,a.start):this.caretManager.makeCaret(e,0)},l._pointToCharBoundary=function(e,t){var n=this._findLocationAt(e,t);if(n){var i=n.node,o=n.offset,a=i.nodeType;if(a===Node.ELEMENT_NODE&&o<i.childNodes.length||a===Node.TEXT_NODE&&o<i.length){var s=this.doc.createRange();s.setStart(i,o),s.setEnd(i,o+1);var u=s.getBoundingClientRect();switch(a){case Node.TEXT_NODE:var l=this.caretManager.newPosition(n,"right"),c=this.caretManager.newPosition(n.make(i,o+1),"left");l&&!c?n=l:c&&!l?n=c:l&&c&&(n=Math.abs(r.boundaryXY(l).left-e)>=Math.abs(r.boundaryXY(c).left-e)?c:l);break;case Node.ELEMENT_NODE:var h,d=i.childNodes[o];if(d.nodeType===Node.ELEMENT_NODE){var p=this._findLocationInElementAt(d,e,t),f=p.node.nodeType===Node.ELEMENT_NODE?p.node.childNodes.length-1:-1;switch(p.offset){case 0:h=!0;break;case f:h=!1}}void 0===h&&(h=Math.abs(u.left-e)<Math.abs(u.right-e)),h||(n=n.make(i,o+1));break;default:throw new Error("unexpected node type: "+a)}}}return n},l._caretChange=n.wrap(function(e){var t=e&&e.options?e.options:{},r=t.textEdit,n=t.focus,a=e.caret;if(a){n||this._setupCompletionMenu(),r||this._terminateTextUndo();for(var l;void 0!==(l=this._caret_owners[0]);)l.classList.remove("_owns_caret");for(;void 0!==(l=this._clicked_labels[0]);)l.classList.remove("_label_clicked");for(;void 0!==(l=this._withCaret[0]);)l.classList.remove("_with_caret");var c=e.prevCaret;if(c){var h=u(c.node,"._placeholder._transient",c.root);h&&a.root.contains(h)&&this._gui_updater.removeNode(h)}var d=a.node.nodeType===Node.ELEMENT_NODE?a.node:a.node.parentNode,p=a.root;if(this.gui_root.contains(d)){var f=s(d,"_real",p);f&&f.classList.add("_owns_caret");var m=e.manager,v=s(d,"_gui",p);if(v){if(!m.anchor||s(m.anchor.node,"_gui",p)===v){for(var y=o.childrenByClass(v.parentNode,"_gui"),g=0;g<y.length;++g)y[g].classList.add("_label_clicked");v.classList.add("_with_caret")}}else d.classList.add("_owns_caret");n||m.mark.scrollIntoView(),this.caretManager.mark.refresh();for(var _=[];d!==this.gui_root;){if(d.nodeType!==Node.ELEMENT_NODE)throw new Error("unexpected node type: "+d.nodeType);d.classList.contains("_placeholder")||s(d,"_phantom",p)||_.unshift("<span class='_gui _label'><span>&nbsp;"+i.getOriginalName(d)+"&nbsp;</span></span>"),d=d.parentNode}this._wed_location_bar.innerHTML=_.length?_.join("/"):"<span>&nbsp;</span>"}}})}),define("wed/key",["require","exports","module","./browsers","jquery"],function(e,t,r,n){"use strict";function i(e,t,r,i,o,a,s){if(void 0===t&&(t=!0),void 0===o&&(o=!1),void 0===a&&(a=!1),void 0===s&&(s=!1),"string"==typeof e){if(1!==e.length)throw new Error("when the first parameter is a string, a one-character string is required");e=e.charCodeAt(0)}else if("number"!=typeof e)throw new Error("the first parameter must be a string or number");return t=void 0===t?!0:!!t,null==r&&(r=t&&n.GECKO?0:e),null==i&&(i=t?e:0),o=!!o,a=!!a,s=!!s,new l(e,t,r,i,o,a,s)}function o(e){return i(e,!1,void 0,void 0,!0,!1,!1)}function a(e){return i(e,!1,void 0,void 0,!1,!1,!0)}function s(e){return n.OSX?a(e):o(e)}Object.defineProperty(t,"__esModule",{value:!0});var u=0,l=function(){function e(t,r,n,i,o,a,s){void 0===r&&(r=!0),void 0===i&&(i=0),void 0===o&&(o=!1),void 0===a&&(a=!1),void 0===s&&(s=!1);var l=[t,n,i,o,a,s,r].join(","),c=e.__cache[l];return void 0!==c?c:(this.which=t,this.keyCode=n,this.charCode=i,this.ctrlKey=o,this.altKey=a,this.metaKey=s,this.keypress=r,this.hashKey=l,this.id=u++,void(e.__cache[l]=this))}return e.prototype.matchesEvent=function(e){return e.which===this.which&&e.keyCode===this.keyCode&&e.charCode===this.charCode&&e.ctrlKey===this.ctrlKey&&e.altKey===this.altKey&&e.metaKey===this.metaKey&&(this.keypress?"keypress"===e.type:"keydown"===e.type||"keyup"===e.type)},e.prototype.setEventToMatch=function(e){var t=e;t.which=this.which,t.keyCode=this.keyCode,t.charCode=this.charCode,t.ctrlKey=this.ctrlKey,t.altKey=this.altKey,t.metaKey=this.metaKey,this.keypress?t.type="keypress":t.type="keydown"},e.prototype.hash=function(){return this.id},e.prototype.anyModifier=function(){return this.ctrlKey||this.altKey||this.metaKey},e.__cache=Object.create(null),e}();t.Key=l,t.makeKey=i,t.makeCtrlKey=o,t.makeMetaKey=a,t.makeCtrlEqKey=s}),define("wed/key-constants",["require","exports","module","./key"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CTRLEQ_S=n.makeCtrlEqKey("S"),t.CTRLEQ_Z=n.makeCtrlEqKey("Z"),t.CTRLEQ_Y=n.makeCtrlEqKey("Y"),t.CTRLEQ_C=n.makeCtrlEqKey("C"),t.CTRLEQ_X=n.makeCtrlEqKey("X"),t.CTRLEQ_V=n.makeCtrlEqKey("V"),t.CTRLEQ_FORWARD_SLASH=n.makeCtrlEqKey(191),t.CTRLEQ_PERIOD=n.makeCtrlEqKey(190),t.CTRLEQ_BACKQUOTE=n.makeCtrlEqKey(192),t.CTRLEQ_OPEN_BRACKET=n.makeCtrlEqKey(219),t.CTRLEQ_CLOSE_BRACKET=n.makeCtrlEqKey(221),t.LEFT_ARROW=n.makeKey(37,!1),t.UP_ARROW=n.makeKey(38,!1),t.RIGHT_ARROW=n.makeKey(39,!1),t.DOWN_ARROW=n.makeKey(40,!1),t.BACKSPACE=n.makeKey(8,!1),t.DELETE=n.makeKey(46,!1),t.ENTER=n.makeKey(13,!1),t.SPACE=n.makeKey(32,!1),t.ESCAPE=n.makeKey(27,!1),t.EDITING_KEYS=[t.LEFT_ARROW,t.RIGHT_ARROW,t.BACKSPACE,t.DELETE,t.ENTER]}),define("wed/gui/context-menu",["require","exports","module","jquery","../domutil","bootstrap"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,r,i,o,a){void 0===a&&(a=!0),this.dismissCallback=o,this.dismissed=!1;var s=e.createElement("div");s.className="dropdown wed-context-menu",s.innerHTML="<a href='#' data-toggle='dropdown'></a><ul class='dropdown-menu' role='menu'></ul>";var u=s.lastElementChild;t-=5,r-=5,s.style.top=r+"px",s.style.left=t+"px",this.x=t,this.y=r;var l=n(u);this.menu=u,this.$menu=l,this.dropdown=s,this.backdrop=e.createElement("div"),this.backdrop.className="wed-context-menu-backdrop",n(this.backdrop).click(this.backdropClickHandler.bind(this)),l.on("click",this.contentsClickHandler.bind(this)),l.on("mousedown",function(e){e.stopPropagation()}),n(s).on("contextmenu mouseup",!1);var c=e.body;c.insertBefore(s,c.firstChild),c.insertBefore(this.backdrop,c.firstChild),a&&this.display(i)}return e.prototype.display=function(e){var t=this.dropdown,r=n(t.firstElementChild);this.render(e);var o=this.$menu,a=this.menu,s=t.ownerDocument,u=this.x,l=this.y,c=o.outerWidth(),h=n(s.defaultView).width();t.style.left=Math.max(0,Math.min(u,h-c))+"px",a.style.maxWidth=h+"px";var d=5*Number(o.css("line-height").replace("px","")),p=n(s.defaultView).height(),f=p-l;d>f&&(l-=d-f,f=d),t.style.top=l+"px",a.style.maxHeight=f+"px",r.focus(this.handleToggleFocus.bind(this)),r.dropdown("toggle");var m=i.childByClass(t,"dropdown-backdrop");null!==m&&t.removeChild(m)},e.prototype.handleToggleFocus=function(){},e.prototype.contentsClickHandler=function(e){return this.dismiss(),e.stopPropagation(),e.preventDefault(),!1},e.prototype.backdropClickHandler=function(){return this.dismiss(),!1},e.prototype.render=function(e){this.$menu.append(e)},e.prototype.dismiss=function(){this.dismissed||(this.$menu.dropdown("toggle"),null!==this.dropdown.parentNode&&this.dropdown.parentNode.removeChild(this.dropdown),null!==this.backdrop.parentNode&&this.backdrop.parentNode.removeChild(this.backdrop),void 0!==this.dismissCallback&&this.dismissCallback(),this.dismissed=!0)},e}();t.ContextMenu=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui/action-context-menu",["require","exports","module","jquery","../browsers","../key","../key-constants","../transformation","./context-menu","./icon"],function(e,t,r,n,i,o,a,s,u,l){"use strict";function c(e,t){var r=null!==e.action&&e.action instanceof s.Transformation?e.action.kind:void 0,n=null!==t.action&&t.action instanceof s.Transformation?t.action.kind:void 0;if(r!==n){var i=p.indexOf(r),o=p.indexOf(n);return i-o}var a=e.item.textContent,u=t.item.textContent;return a===u?0:u>a?-1:1}Object.defineProperty(t,"__esModule",{value:!0});var h=["transform","add","delete","wrap","unwrap"],d=h.concat(void 0),p=[void 0].concat(h),f=["element","attribute"],m=f.concat(void 0),v="li:not(.divider):visible a",y=o.makeKey("+"),g=o.makeKey("-"),_=o.makeKey("."),b=o.makeKey(","),w=o.makeKey("?"),E=o.makeKey("<"),x=o.makeKey("@"),N=o.makeKey("!"),S=[{key:y,filter:"add",which:"kind"},{key:g,filter:"delete",which:"kind"},{key:b,filter:"wrap",which:"kind"},{key:_,filter:"unwrap",which:"kind"},{key:w,filter:void 0,which:"kind"},{key:E,filter:"element",which:"type"},{key:x,filter:"attribute",which:"type"},{key:N,filter:void 0,which:"type"}],C=function(e){function t(t,r,i,o,a){var s=e.call(this,t,r,i,[],a,!1)||this;s.filters={kind:null,type:null},s.actionTextFilter="",o.sort(c),s.actionItems=o;var u=t.createElement("li");u.className="wed-menu-filter",u.style.whiteSpace="nowrap";var l=t.createElement("div"),h=s.makeKindGroup(t),d=s.makeTypeGroup(t);n(u).on("click",!1),u.appendChild(l),l.appendChild(h),l.appendChild(t.createTextNode("")),l.appendChild(d);var p=t.createElement("input");p.className="form-control input-sm",p.setAttribute("placeholder","Filter choices by text.");var f=t.createElement("div");f.appendChild(p),u.appendChild(f);var m=n(p);m.on("input",s.inputChangeHandler.bind(s)),m.on("keydown",s.inputKeydownHandler.bind(s)),s.actionFilterItem=u,s.actionFilterInput=p;var v=s.$menu;return v.parent().on("hidden.bs.dropdown",function(){n(p).tooltip("destroy"),n(h).children().tooltip("destroy")}),v.on("keydown",s.actionKeydownHandler.bind(s)),v.on("keypress",s.actionKeypressHandler.bind(s)),s.display([]),p.focus(),s}return __extends(t,e),t.prototype.makeKindGroup=function(e){var t=e.createElement("div");t.className="btn-group btn-group-xs";for(var r=0,i=d;r<i.length;r++){var o=i[r],a=e.createElement("button");a.className="btn btn-default";var s=void 0;void 0!==o?(a.innerHTML=l.makeHTML(o),s="Show only "+o+" operations."):(a.innerHTML=l.makeHTML("other"),s="Show operations not covered by other filter buttons."),n(a).tooltip({title:s,container:"body",placement:"auto top",trigger:"hover"}),n(a).on("click",this.makeKindHandler(o)),t.appendChild(a)}return t},t.prototype.makeTypeGroup=function(e){var t=e.createElement("div");t.className="btn-group btn-group-xs";for(var r=0,i=m;r<i.length;r++){var o=i[r],a=e.createElement("button");a.className="btn btn-default";var s=void 0;void 0!==o?(a.innerHTML=l.makeHTML(o),s="Show only "+o+" operations."):(a.innerHTML=l.makeHTML("other"),s="Show operations not covered by other filter buttons."),n(a).tooltip({title:s,container:"body",placement:"auto top",trigger:"hover"}),n(a).on("click",this.makeTypeHandler(o)),t.appendChild(a)}return t},t.prototype.makeKindHandler=function(e){var t=this;return function(){t.filters.kind=e,t.render()}},t.prototype.makeTypeHandler=function(e){var t=this;return function(){t.filters.type=e,t.render()}},t.prototype.handleToggleFocus=function(){this.actionFilterInput.focus()},t.prototype.actionKeydownHandler=function(e){var t=this;return!a.ESCAPE.matchesEvent(e)||null===this.filters.kind&&null===this.filters.type&&""===this.actionTextFilter?!0:(this.filters.kind=null,this.filters.type=null,this.actionTextFilter="",i.FIREFOX_24?setTimeout(function(){t.actionFilterInput.value="",t.render()},0):(this.actionFilterInput.value="",this.render()),e.stopPropagation(),e.preventDefault(),!1)},t.prototype.actionKeypressHandler=function(e){if(""!==this.actionTextFilter)return!0;for(var t=0,r=S;t<r.length;t++){var n=r[t],i=n.key;if(i.matchesEvent(e)){var o=n.which;if(null!==this.filters[o])continue;return this.filters[o]=n.filter,this.render(),e.stopPropagation(),e.preventDefault(),!1}}return!0},t.prototype.inputChangeHandler=function(e){var t=this.actionTextFilter,r=e.target.value;t!==r&&(this.actionTextFilter=r,this.render())},t.prototype.inputKeydownHandler=function(e){if(a.ENTER.matchesEvent(e))return this.$menu.find(v).first().focus().click(),e.stopPropagation(),e.preventDefault(),!1;for(var t,r=0,i=["UP_ARROW","DOWN_ARROW","ESCAPE"];r<i.length;r++){var o=i[r],s=a[o];if(s.matchesEvent(e)){t=s;break}}if(void 0!==t){var u=new n.Event("keydown");return t.setEventToMatch(u),this.$menu.trigger(u),!1}return!0},t.prototype.render=function(){for(var t=this.menu,r=this.actionFilterItem,n=this.filters.kind,i=this.filters.type;null!==t.lastChild&&t.lastChild!==r;)t.removeChild(t.lastChild);for(var o=r.firstElementChild.firstElementChild.firstElementChild,a=0,s=d;a<s.length;a++){var u=s[a],l=o.classList,c=n===u?l.add:l.remove;c.call(l,"active"),o=o.nextElementSibling}o=r.firstElementChild.lastElementChild.firstElementChild;for(var h=0,p=m;h<p.length;h++){var f=p[h],l=o.classList,c=i===f?l.add:l.remove;c.call(l,"active"),o=o.nextElementSibling}null===r.parentNode&&t.appendChild(r);var v=this.computeActionItemsToDisplay(this.actionItems);e.prototype.render.call(this,v)},t.prototype.computeActionItemsToDisplay=function(e){var t,r=this.filters.kind,n=this.filters.type,i=this.actionTextFilter;switch(r){case null:t=function(){return!0};break;case void 0:t=function(e){return!(e.action instanceof s.Transformation)||-1===h.indexOf(e.action.kind)};break;default:t=function(e){return e.action instanceof s.Transformation&&e.action.kind===r}}var o;switch(n){case null:o=function(){return!0};break;case void 0:o=function(e){return!(e.action instanceof s.Transformation)||-1===f.indexOf(e.action.nodeType)};break;default:o=function(e){return e.action instanceof s.Transformation&&e.action.nodeType===n}}var a;if(""!==i)if("^"===i[0]){var u=RegExp(i);a=function(e){var t=null!==e.data?e.data.name:e.item.textContent;return u.test(t)}}else a=function(e){var t=null!==e.data?e.data.name:e.item.textContent;return-1!==t.indexOf(i)};else a=function(){return!0};for(var l=[],c=0,d=e;c<d.length;c++){var p=d[c];t(p)&&o(p)&&a(p)&&l.push(p.item)}return l},t}(u.ContextMenu);t.ContextMenu=C});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui/completion-menu",["require","exports","module","jquery","../key-constants","./context-menu"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,r,n,i,o,a,s){var u=e.call(this,r,n,i,[],s,!1)||this;return u.focused=!1,u.completionPrefix=o,u.completionItems=a,u.editor=t,u.dropdown.classList.add("wed-completion-menu"),null!==u.dropdown.firstElementChild.getAttribute("data-toggle")&&u.dropdown.removeChild(u.dropdown.firstChild),u.backdrop.parentNode.removeChild(u.backdrop),u.boundCompletionKeydownHandler=u.globalKeydownHandler.bind(u),t.pushGlobalKeydownHandler(u.boundCompletionKeydownHandler),t.caretManager.focusInputField(),u.display([]),u}return __extends(t,e),t.prototype.globalKeydownHandler=function(e,t){return i.ENTER.matchesEvent(t)?(this.$menu.find("li:not(.divider):visible a").first().click(),!1):i.DOWN_ARROW.matchesEvent(t)?(this.focused=!0,this.$menu.find("li:not(.divider):visible a").first().focus(),this.$menu.trigger(t),!1):i.ESCAPE.matchesEvent(t)?(this.dismiss(),!1):!0},t.prototype.render=function(){function t(e){r.type(e.data)}for(var r=this.editor,i=[],o=this.completionPrefix,a=r.doc,s=0,u=this.completionItems;s<u.length;s++){var l=u[s];if(""===o){var c=a.createElement("li");c.innerHTML="<a href='#'></a>",c.lastChild.textContent=l,i.push(c),n(c).click(l,t)}else if(0===l.lastIndexOf(o,0)){var c=a.createElement("li");c.innerHTML="<a href='#'><b></b></a>";var h=c.lastChild;h.firstChild.textContent=l.slice(0,o.length);var d=l.slice(o.length);h.appendChild(a.createTextNode(d)),i.push(c),n(c).click(d,t)}}0===i.length&&this.dismiss(),1===i.length&&this.completionItems[0]===o&&this.dismiss(),e.prototype.render.call(this,i)},t.prototype.dismiss=function(){this.dismissed||(this.editor.popGlobalKeydownHandler(this.boundCompletionKeydownHandler),e.prototype.dismiss.call(this))},t}(o.ContextMenu);t.CompletionMenu=a}),define("wed/gui/typeahead_popup",["require","exports","module","jquery","../domutil","../log","../key-constants","bootstrap","typeahead"],function(e,t){"use strict";function r(e,t,r,o,a,s,u){var l=e,c=i.htmlToElements('<div class="wed-typeahead-popup"><input class="typeahead form-control" type="text"><span class="spinner"><i class="fa fa-spinner fa-spin"></i></span></div>',l)[0],h=c.firstElementChild;h.setAttribute("placeholder",a),this._ta_wrapper=c,this._dismiss_callback=u,this._dismissed=!1,this._backdrop=e.createElement("div"),this._backdrop.className="wed-typeahead-popup-backdrop",n(this._backdrop).click(this._backdrop_click_handler.bind(this)),c.style.width=o+"px",c.style.left=t+"px",c.style.top=r+"px";var d=n(h);this._ta=h,this._$ta=d;var p=[s.options];s.datasets&&s.datasets.length>0&&(p=p.concat(s.datasets)),d.typeahead.apply(d,p),d.on("keydown",this._keydownHandler.bind(this)),d.on("typeahead:selected",this._selectedHandler.bind(this));var f=l.body;f.insertBefore(c,f.firstChild),f.insertBefore(this._backdrop,f.firstChild);var m=c.offsetWidth,v=e.defaultView.innerWidth;c.style.left=Math.max(0,Math.min(t,v-m))+"px",c.style.maxWidth=v+"px";var y=e.defaultView.innerHeight,g=y-r;c.style.maxHeight=g+"px";var _=c.getElementsByClassName("tt-dropdown-menu")[0],b=n(_),w=_.style.display;_.style.display="block";var E=5*Number(b.css("line-height").replace("px","")),x=_.getBoundingClientRect(),N=y-x.top;E>N&&(r-=E-N,N=E,c.style.top=r+"px"),_.style.maxHeight=N+"px",_.style.display=w,b.off("mouseenter.tt",".tt-suggestion"),b.off("mouseleave.tt",".tt-suggestion"),b.on("click",!1),h.focus();var S=n.data(h,"ttTypeahead");S.isActivated=!0,S.input.off("blurred"),S._onBlurred=function(){this.isActivated=!1},S.input.onSync("blurred",S._onBlurred,S)}var n=e("jquery"),i=e("../domutil"),o=e("../log"),a=e("../key-constants");e("bootstrap"),e("typeahead"),r.prototype.dismiss=function(e){if(!this._dismissed){var t=this._ta_wrapper;t&&t.parentNode&&t.parentNode.removeChild(t);var r=this._backdrop;r&&r.parentNode&&r.parentNode.removeChild(r),this._dismiss_callback&&this._dismiss_callback(e),this._dismissed=!0}},r.prototype._backdrop_click_handler=o.wrap(function(){return this.dismiss(),!1}),r.prototype._keydownHandler=o.wrap(function(e){return a.ESCAPE.matchesEvent(e)?(this.dismiss(),!1):void 0}),r.prototype._selectedHandler=o.wrap(function(e,t){this.dismiss(t)}),r.prototype.hideSpinner=function(){this._ta_wrapper.getElementsByClassName("spinner")[0].style.display="none"},r.prototype.setValue=function(e){this._$ta.typeahead("val",e)},t.TypeaheadPopup=r}),define("wed/gui/tooltip",["require","exports","module","jquery","bootstrap"],function(e,t,r,n){"use strict";function i(e){var t=e.target,r=n.data(t,"bs.tooltip");n.data(r.tip()[0],"wed-tooltip-for",t)}function o(e,t){e.tooltip(t),e[0].classList.add("wed-has-tooltip"),e.on("show.bs.tooltip",i)}Object.defineProperty(t,"__esModule",{value:!0}),t.tooltip=o}),define("wed/wed_gui",["require","./wed_core","jquery","./log","./saver","./validator","./util","./domutil","./key-constants","./gui/modal","./gui/action-context-menu","./gui/completion-menu","./gui/typeahead_popup","./key","./gui/icon","./wed-util","./gui/tooltip","./transformation","bootstrap","./gui/notify"],function(e){"use strict";var t=e("./wed_core"),r=e("jquery"),n=e("./log"),i=e("./saver"),o=e("./validator"),a=e("./util"),s=e("./domutil"),u=e("./key-constants"),l=e("./gui/modal"),c=e("./gui/action-context-menu"),h=e("./gui/completion-menu"),d=e("./gui/typeahead_popup"),p=e("./key"),f=e("./gui/icon"),m=e("./wed-util"),v=e("./gui/tooltip").tooltip,y=e("./transformation");e("bootstrap");var g=e("./gui/notify").notify,_=t.Editor,b=m.getGUINodeIfExists,w=s.closestByClass,E=s.closest,x=s.indexOf,N=_.prototype;N.resize=function(){this._resizeHandler()},N._resizeHandler=n.wrap(function(){function e(){t+=this.scrollHeight}for(var t=0,n=this.$widget;n.length>0;){var i=n.nextAll().not("script");i.each(e),n=n.parent()}t+=this._wed_location_bar.scrollHeight;var o=this.my_window.innerHeight-(this._scroller.getBoundingClientRect().top+this.my_window.pageYOffset)-t-1;o=Math.floor(o),this._scroller.coerceHeight(o);var a=this._sidebar,u=this.my_window.innerHeight-(a.getBoundingClientRect().top+this.my_window.pageYOffset)-t;a.style.maxHeight=u+"px",a.style.minHeight=u+"px";var l=a.getElementsByClassName("wed-sidebar-panel")[0];u=this.my_window.innerHeight-(l.getBoundingClientRect().top+this.my_window.pageYOffset)-t,l.style.maxHeight=u+"px",l.style.minHeight=u+"px";var c,h=l.getElementsByClassName("panel"),d=l.getElementsByClassName("panel-heading"),p=0;for(c=0;c<d.length;++c){var f=d[c],m=r(f.parentNode);p+=m.outerHeight(!0)-m.innerHeight(),p+=r(f).outerHeight(!0)}var v,y=u-p;for(c=0;c<h.length;++c){v=h[c],v.style.maxHeight=y+r(s.childByClass(v,"panel-heading")).outerHeight(!0)+"px";var g=v.getElementsByClassName("panel-body")[0];g.style.height=y+"px"}this.validationController&&this.validationController.refreshErrors(),this.caretManager.mark.refresh()}),N.openDocumentationLink=function(e){window.open(e)},N.makeDocumentationLink=function(e){var t=f.makeHTML("documentation"),n=s.htmlToElements("<a tabindex='0' href='#'>"+t+" Element's documentation.</a>",this.doc)[0];return r(n).click(function(){this.openDocumentationLink(e)}.bind(this)),n},N._contextMenuHandler=function(e){var t=this.caretManager.sel;if(!t||!t.collapsed&&!t.wellFormed)return!1;var r=t.focus.node,n=t.focus.offset;if(r.nodeType!==Node.ELEMENT_NODE){var i=r.parentNode;n=x(i.childNodes,r),r=i}var o=w(r,"_placeholder",this.gui_root);o&&(n=x(o.parentNode.childNodes,o),r=o.parentNode);var a=w(r,"_real",this.gui_root),s=a&&a.classList.contains("_readonly"),u=w(r,"_attribute_value",this.gui_root)?this._getMenuItemsForAttribute:this._getMenuItemsForElement,l=u.call(this,r,n,!t.collapsed);if(0===l.length)return!0;var h=this.computeContextMenuPosition(e);return this.displayContextMenu(c.ContextMenu,h.left,h.top,l,s),!1},N._getMenuItemsForAttribute=function(){return[]},N._getMenuItemsForElement=function(e,t,n){function i(e,t){var r=f._makeMenuItemForAction(t,e);p.push({action:t,item:r,data:e})}if(e.classList&&e.classList.contains("_phantom")){for(var o;e&&e.classList.contains("_phantom");)o=e,e=e.parentNode;if(e&&this.gui_root.contains(e)){var a=this.mode.nodesAroundEditableContents(e),s=e.childNodes;t=x(s,o);var u=a[0]&&x(s,a[0]),l=a[1]&&x(s,a[1]);null!==u&&u>=t&&(t=u+1),null!==l&&t>=l&&(t=l-1)}else e=null}if(!e)return[];var c,h,d,p=[],f=this;if(!e.classList.contains("_phantom")&&!e.parentNode.classList.contains("_gui")){var m=this.caretManager.toDataLocation(e,t),v=m.node,y=v.tagName;if(y){var g=this.mode.documentationLinkFor(y);if(g){var _=this.makeDocumentationLink(g),b=e.ownerDocument.createElement("li");b.appendChild(_),p.push({action:null,item:b,data:null})}}for(d=this.getElementTransformationsAt(m,n?"wrap":"insert"),c=0;c<d.length;++c)h=d[c],i(void 0!==h.name?{name:h.name}:void 0,h.tr);if(v!==this.data_root.firstChild&&v!==this.data_root)for(d=this.mode.getContextualActions(["unwrap","delete-parent","split"],v.tagName,v,0),c=0;c<d.length;++c)i({node:v,name:v.tagName},d[c])}var w=r(e).parents().addBack().siblings("[data-wed--separator-for]").first(),E=w.siblings().filter(function(){return this.contains(e)})[0],N=w[0]&&w[0].getAttribute("data-wed--separator-for");return void 0!==N&&(d=this.mode.getContextualActions(["merge-with-next","merge-with-previous","append","prepend"],N,r.data(E,"wed_mirror_node"),0),d.forEach(function(e){i({node:E,name:N},e)})),p},N._makeMenuItemForAction=function(e,t){var n=e.getIcon(),i=s.htmlToElements("<li><a tabindex='0' href='#'>"+(n?n+" ":"")+"</a></li>",this.doc)[0];void 0!==e.kind&&i.setAttribute("data-kind",e.kind);var o=i.firstElementChild,a=this.doc.createTextNode(e.getDescriptionFor(t));return o.appendChild(a),o.normalize(),r(o).click(t,e.boundTerminalHandler),i},N.computeContextMenuPosition=function(e,t){t=!!t,e=e||{};var n,i,o=this.caretManager.mark;if("mousedown"===e.type||"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type)n={left:e.clientX,top:e.clientY};else if(o.inDOM)o.scrollIntoView(),o.refresh(),i=o.getBoundingClientRect(),n={top:t?i.bottom:i.top+i.height/2,left:i.left};else{var a=w(this.caretManager.caret.node,"_gui",this.gui_root);if(!a)throw new Error("no position for displaying the menu");i=a.getBoundingClientRect();var s=r(a);n={top:t?i.bottom:i.top+s.height()/2,left:i.left+s.width()/2}}return n},N.getElementTransformationsAt=function(e,t){var r=this.mode,n=this.resolver,i=[],o=this;return this.validator.possibleAt(e).forEach(function(a){if("enterStartTag"===a.params[0])if(a.params[1].simple())for(var s=a.params[1].toArray(),u=0;u<s.length;++u){var l=s[u],c=n.unresolveName(l.ns,l.name),h=r.getContextualActions(t,c,e.node,e.offset);if(void 0===h)return;for(var d=0;d<h.length;++d)i.push({tr:h[d],name:c})}else i.push({tr:o.complex_pattern_action,name:void 0})}),i},N._cutHandler=function(e){if(void 0===this.caretManager.getDataCaret())return!1;var t=this.caretManager.sel;if(t.wellFormed){var r=w(t.anchor.node,"_real",this.gui_root);return!r||r.classList.contains("_readonly")?!1:(this.fireTransformation(this.cut_tr,{e:e}),!0)}return this.straddling_modal.modal(),!1},N._pasteHandler=function(e){var t=this.caretManager.getDataCaret();if(void 0===t)return!1;var r=w(this.caretManager.anchor.node,"_real",this.gui_root);if(!r||r.classList.contains("_readonly"))return!1;var n=e.originalEvent.clipboardData||this.my_window.clipboardData,i=n.getData("text");if(!i)return!1;if(i=this._normalizeEnteredText(i),!i)return!1;var o,a=new this.my_window.DOMParser,s=a.parseFromString("<div>"+i+"</div>","text/xml"),u=!0;if("parsererror"===s.firstChild.tagName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"===s.firstChild.namespace&&(u=!1),u){o=s.firstChild;var l=this.validator.speculativelyValidate(t,Array.prototype.slice.call(o.childNodes));if(l)return this._paste_modal.modal(function(){"Yes"===this._paste_modal.getClickedAsText()&&(o=this.doc.createElement("div"),o.textContent=i,this.fireTransformation(this.paste_tr,{node:t.node,to_paste:o,e:e}))}.bind(this)),!1}else o=this.doc.createElement("div"),o.textContent=i;return this.fireTransformation(this.paste_tr,{node:t.node,to_paste:o,e:e}),!1},N._keydownHandler=n.wrap(function(e){var t=this.caretManager.getNormalizedCaret();t&&this.$gui_root.trigger("wed-input-trigger-keydown",[e]),e.isImmediatePropagationStopped()||e.isPropagationStopped()||this.$gui_root.trigger("wed-global-keydown",[e])}),N.pushGlobalKeydownHandler=function(e){this._global_keydown_handlers.push(e)},N.popGlobalKeydownHandler=function(e){var t=this._global_keydown_handlers.pop();if(t!==e)throw new Error("did not pop the expected handler")},N._globalKeydownHandler=n.wrap(function(e,t){function i(){return t.stopPropagation(),t.preventDefault(),!1}var o;if(17===t.which||16===t.which||18===t.which||0===t.which)return!0;for(var l=this._global_keydown_handlers,c=0;c<l.length;++c){var h=l[c](e,t);if(h===!1)return i()}if(112===t.which)return this.help_modal.modal(),i();if(this._development_mode){if(113===t.which)return this.caretManager.dumpCaretInfo(),i();if(114===t.which)return this.dumpUndo(),i();if(115===t.which)return console.log("manual focus"),console.log("document.activeElement before",document.activeElement),console.log('document.querySelector(":focus") before',document.querySelector(":focus")),this.caretManager.focusInputField(),console.log("document.activeElement after",document.activeElement),console.log('document.querySelector(":focus") after',document.querySelector(":focus")),i()}var d=this.caretManager.caret;if(t.which>=33&&t.which<=40){var p;return u.RIGHT_ARROW.matchesEvent(t)?p="right":u.LEFT_ARROW.matchesEvent(t)?p="left":u.DOWN_ARROW.matchesEvent(t)?p="down":u.UP_ARROW.matchesEvent(t)&&(p="up"),
p?(this.caretManager.move(p,t.shiftKey),i()):!0}if(u.ESCAPE.matchesEvent(t))return this._closeAllTooltips()?i():!0;if(u.CTRLEQ_S.matchesEvent(t))return this.save(),i();if(u.CTRLEQ_Z.matchesEvent(t))return this.undo(),i();if(u.CTRLEQ_Y.matchesEvent(t))return this.redo(),i();if(u.CTRLEQ_C.matchesEvent(t)||u.CTRLEQ_X.matchesEvent(t)||u.CTRLEQ_V.matchesEvent(t))return!0;if(u.CTRLEQ_BACKQUOTE.matchesEvent(t))return this._development_mode=!this._development_mode,g(this._development_mode?"Development mode on.":"Development mode off."),this._development_mode&&n.showPopup(),i();if(u.CTRLEQ_OPEN_BRACKET.matchesEvent(t))return this.decreaseLabelVisiblityLevel(),i();if(u.CTRLEQ_CLOSE_BRACKET.matchesEvent(t))return this.increaseLabelVisibilityLevel(),i();if(u.CTRLEQ_FORWARD_SLASH.matchesEvent(t)){var f=d&&d.node;if(f){var m=w(f,"_gui",d.root);if(m&&m.classList.contains("_label_clicked"))return f.nodeType===Node.TEXT_NODE&&(f=f.parentNode),r(f).trigger("wed-context-menu",[t]),i()}if(this._contextMenuHandler(t)===!1)return i()}if(void 0===d)return!0;var v=w(d.node,"_placeholder",d.root);if(v){if(o=this.caretManager.getDataCaret(),!a.anySpecialKeyHeld(t)){var y=!1;if(v.parentNode.classList.contains("_attribute_value")?y=!0:this.validator.possibleAt(o).forEach(function(e){"text"===e.params[0]&&(y=!0)}),!y)return i()}if(u.BACKSPACE.matchesEvent(t)||u.DELETE.matchesEvent(t))return i()}var _=w(d.node,"_attribute_value",d.root),b=this.$gui_root.find(".__start_label._label_clicked, .__end_label._label_clicked");if(!_&&b[0]&&u.DELETE.matchesEvent(t)){var E=w(b[0],"_real",this.gui_root),N=this.data_updater.pathToNode(this.nodeToPath(E)),S=this.mode.getContextualActions("delete-parent",N.tagName,N,0);return S[0].execute({node:N,name:N.tagName}),i()}if(d.node.classList&&(d.node.classList.contains("_phantom")||d.node.classList.contains("_phantom_wrap")))return i();var C,T,P;if(u.SPACE.matchesEvent(t))return(o=this.caretManager.getNormalizedCaret())?((_||!w(o.node,"_phantom",o.root))&&this._handleKeyInsertingText(t),i()):i();if(u.DELETE.matchesEvent(t)){if(_){if(""===_.textContent)return i();this._spliceAttribute(_,this.caretManager.getNormalizedCaret().offset,1,"")}else{var k=s.nextCaretPosition(d.toArray(),this.gui_root,!0)[0];if(!k.classList||!k.classList.contains("_phantom")&&!k.classList.contains("_phantom_wrap")){if(this._cutSelection())return this.validationController.refreshErrors(),i();o=this.caretManager.getDataCaret(),o.node.nodeType!==Node.TEXT_NODE&&(o=o.make(o.node.childNodes[o.offset],0)),o.node.nodeType===Node.TEXT_NODE&&(T=o.node.parentNode,P=x(T.childNodes,o.node),C=this._initiateTextUndo(),this.data_updater.deleteText(o,1),o.node.parentNode?this.caretManager.setCaret(o,{textEdit:!0}):this.caretManager.setCaret(T,P,{textEdit:!0}),C.recordCaretAfter())}}return this.validationController.refreshErrors(),i()}if(u.BACKSPACE.matchesEvent(t)){if(_){if(""===_.textContent)return i();this._spliceAttribute(_,this.caretManager.getNormalizedCaret().offset-1,1,"")}else{var A=s.prevCaretPosition(d.toArray(),this.gui_root,!0)[0];if(!A.classList||!A.classList.contains("_phantom")&&!A.classList.contains("_phantom_wrap")){if(this._cutSelection())return this.validationController.refreshErrors(),i();if(o=this.caretManager.getDataCaret(),o.node.nodeType!==Node.TEXT_NODE&&(o=o.make(o.node.childNodes[o.offset-1],o.node.childNodes[o.offset-1].length)),o.node.nodeType===Node.TEXT_NODE){if(T=o.node.parentNode,P=x(T.childNodes,o.node),0===o.offset)return i();C=this._initiateTextUndo(),this.data_updater.deleteText(o.node,o.offset-1,1),o.node.parentNode?this.caretManager.setCaret(o.node,o.offset-1,{textEdit:!0}):this.caretManager.setCaret(T,P,{textEdit:!0}),C.recordCaretAfter()}}}return this.validationController.refreshErrors(),i()}return!0});var S=p.makeKey(27);N._keypressHandler=n.wrap(function(e){return S.matchesEvent(e)?!0:(this.$gui_root.trigger("wed-input-trigger-keypress",[e]),e.isImmediatePropagationStopped()||e.isPropagationStopped()?!0:void this.$gui_root.trigger("wed-global-keypress",[e]))}),N.type=function(e){e instanceof p.Key&&(e=[e]);for(var t=0;t<e.length;++t){var n=e[t];"string"==typeof n&&(n=" "===n?u.SPACE:p.makeKey(n));var i=new r.Event("keydown");n.setEventToMatch(i),this._$input_field.trigger(i)}},N._globalKeypressHandler=n.wrap(function(e,t){function r(){return t.preventDefault(),t.stopPropagation(),!1}return void 0===this.caretManager.caret?!0:t.which?8===t.which?r():t.ctrlKey||t.altKey||t.metaKey?!0:(this._cutSelection(),this._handleKeyInsertingText(t),r()):!0}),N._cutSelection=function(){var e=this.caretManager.sel;if(e&&!e.collapsed){if(!e.wellFormed)return!0;var t=this._initiateTextUndo(),r=e.asDataCarets(),n=this.data_updater.cut(r[0],r[1]);return this.caretManager.setCaret(n[0],{textEdit:!0}),t.recordCaretAfter(),!0}return!1},N._handleKeyInsertingText=function(e){var t=String.fromCharCode(e.which);return""===t?!1:(this._insertText(t),e.preventDefault(),void e.stopPropagation())},N._compositionHandler=n.wrap(function(e){if("compositionstart"===e.type)this._composing=!0,this._composition_data={data:e.originalEvent.data,start_caret:this.caretManager.caret},this._input_field.style.zIndex=10,this.caretManager.mark.refresh();else if("compositionupdate"===e.type)this._composition_data.data=e.originalEvent.data;else{if("compositionend"!==e.type)throw new Error("unexpected event type: "+e.type);this._composing=!1,this._input_field.style.zIndex="",this._input_field.style.top="",this._input_field.style.left=""}}),N._inputHandler=n.wrap(function(){this._composing||""!==this._$input_field.val()&&(this._insertText(this._$input_field.val()),this._$input_field.val(""),this.caretManager.focusInputField())}),N._mousemoveHandler=n.wrap(function(e){function t(e){return e.classList.contains("_real")||i&&e.classList.contains("_attribute_value")}var r=this.doc.elementFromPoint(e.clientX,e.clientY);if(this.gui_root.contains(r)){var n,i="edit"===this.attributes;if(t(r)){if(n=this._pointToCharBoundary(e.clientX,e.clientY),!n)return}else{for(var o;!t(r);)if(o=r,r=o.parentNode,!this.gui_root.contains(r))return;var a=x(r.childNodes,o),s=this.doc.createRange();s.setStart(r,a),s.setEnd(r,a+1);var u=s.getBoundingClientRect();Math.abs(u.left-e.clientX)>=Math.abs(u.right-e.clientX)&&a++,n=this.caretManager.makeCaret(r,a)}this.caretManager.setRange(this.caretManager.anchor,n)}}),N._mousedownHandler=n.wrap(function(e){if(!this._scroller.isPointInside(e.pageX,e.pageY))return!1;var t=this._pointToCharBoundary(e.clientX,e.clientY);if(!t)return!0;this.$gui_root.one("mouseup",this._mouseupHandler.bind(this)),this._errorLayer.unselectAll(),this.$error_list.find(".selected").removeClass("selected");var r=this.gui_root,n=e.target,i=w(n,"_placeholder",r),o=w(n,"_label",r),a=this.caretManager;switch(e.which){case 1:if((!E(n,"._gui, ._phantom",r)||w(n,"_attribute_value",r))&&this.$gui_root.on("mousemove.wed",this._mousemoveHandler.bind(this)),i?a.setCaret(i,0):o?a.setCaretToLabelPosition(n,o,t):a.setCaret(t),e.target.classList.contains("wed-validation-error"))return!0;break;case 3:var s=this.caretManager.range;(!s||s.collapsed)&&(i?a.setCaret(i,0):o?a.setCaretToLabelPosition(n,o,t):a.setCaret(t))}return!1}),N._mouseupHandler=n.wrap(function(e){if(!this._scroller.isPointInside(e.pageX,e.pageY))return!1;var t=this._pointToCharBoundary(e.clientX,e.clientY);if(!t)return!0;"contextmenu"===e.type&&(e.which=3);var n=this.gui_root,i=e.target,o=w(i,"_placeholder",n),a=w(i,"_label",n),s=this.caretManager;switch(e.which){case 3:o&&s.setCaret(i,0),a?(s.setCaretToLabelPosition(i,a,t),r(i).trigger("wed-context-menu",[e])):(s.caret||s.setCaret(t),E(i,"*[data-wed-custom-context-menu]",n)?r(i).trigger("wed-context-menu",[e]):this._contextMenuHandler(e))}return this.$gui_root.off("mousemove"),e.preventDefault(),!1}),N._mouseoverHandler=n.wrap(function(e){var t=this.gui_root,n=w(e.target,"_label",t);if(n){var i=this,o=w(n,"_real",t),s=a.getOriginalName(o),u={title:function(){return!i._destroyed&&i.preferences.get("tooltips")?i.mode.shortDescriptionFor(s):void 0},container:"body",delay:{show:1e3},placement:"auto top",trigger:"hover"};v(r(n),u);var l=r.data(n,"bs.tooltip");l.enter(l)}}),N._mouseoutHandler=n.wrap(function(e){var t=this.gui_root,n=w(e.target,"_label",t);return n?(r(n).tooltip("destroy"),!1):void 0}),N._setupCompletionMenu=function(){this._dismissDropdownMenu();var e=this.caretManager.sel;if(e&&e.collapsed){var t=this.caretManager.getNormalizedCaret(),r=t.node,n=w(r,"_attribute_value",this.gui_root);if(n){if(s.isNotDisplayed(n,this.gui_root))return;var i=r.ownerDocument,o=this.caretManager.getDataCaret(),a=o.node;if(o.offset!==a.value.length)return;var u=this.mode.getAttributeCompletions(o.node);if(0===u.length&&this.validator.possibleAt(o.node,0).forEach(function(e){if("attributeValue"===e.params[0]&&"attributeValue"===e.params[0]){var t=e.params[1];if(t instanceof RegExp)return;u.push(t)}}),!u.length)return;for(var l=[],c=0;c<u.length;++c){var d=u[c];0===d.lastIndexOf(a.value,0)&&l.push(d)}if(!l.length||1===l.length&&l[0]===a.value)return;var p=this.computeContextMenuPosition(void 0,!0);this.caretManager.pushSelection(),this._current_dropdown=new h.CompletionMenu(this,i,p.left,p.top,a.value,u,function(){var e=this._current_dropdown;this._current_dropdown=void 0,e.focused?this.caretManager.popSelection():this.caretManager.popSelectionAndDiscard()}.bind(this))}}},N._dismissDropdownMenu=function(){this._current_dropdown&&this._current_dropdown.dismiss()},N.displayContextMenu=function(e,t,r,n,i){var o=Object.create(null);n=n.filter(function(e){var t=(e.action?e.action.getDescription():"")+"\x00";e.data&&(t+=e.data.name);var r=!o[t];return o[t]=!0,r&&i?!(e.action instanceof y.Transformation):r}),this._dismissDropdownMenu(),this.caretManager.pushSelection(),this._current_dropdown=new e(this.doc,t,r,n,function(){this._current_dropdown=void 0,this.caretManager.popSelection()}.bind(this))},N.displayTypeaheadPopup=function(e,t,r,n,i,o){return this._dismissDropdownMenu(),this.caretManager.pushSelection(),this._current_typeahead=new d.TypeaheadPopup(this.doc,e,t,r,n,i,function(e){this._current_typeahead=void 0,this.caretManager.popSelection(),o&&o(e)}.bind(this)),this._current_typeahead},N._refreshSaveStatus=n.wrap(function(){if(this._saver){var e=this._saver.getSavedWhen();if(this._$save_status.children("span").first().text(e),e){var t,r,n=this._saver.getLastSaveKind();switch(n){case i.SaveKind.AUTO:t="label-info",r="The last save was an autosave.";break;case i.SaveKind.MANUAL:t="label-success",r="The last save was a manual save.";break;default:throw new Error("unexpected kind of save: "+n)}this._$save_status.removeClass("label-default label-info label-success").addClass(t),this._$save_status.tooltip("destroy"),this._$save_status.tooltip({title:r,container:"body",placement:"auto top",trigger:"hover"})}else this._$save_status.removeClass("label-success label-info").addClass("label-default");var o=this._saver.getModifiedWhen();o!==!1?(this._$modification_status.removeClass("label-success"),this._$modification_status.addClass("label-warning"),this._$modification_status.children("i").css("visibility","")):(this._$modification_status.removeClass("label-warning"),this._$modification_status.addClass("label-success"),this._$modification_status.children("i").css("visibility","hidden"))}}),N._onValidatorStateChange=function(e){var t=e.state;(t===o.VALID||t===o.INVALID)&&(this._first_validation_complete||(this._first_validation_complete=!0,this._setCondition("first-validation-complete",{editor:this})))},N._onPossibleDueToWildcardChange=function(e){var t=b(this,e);t&&t.nodeType===Node.TEXT_NODE&&(t=w(t,"_attribute",this.gui_root)),t&&this.decorator.setReadOnly(t,this.validator.getNodeProperty(e,"PossibleDueToWildcard"))},N.expandErrorPanelWhenNoNavigation=function(){"none"===this._$navigation_panel[0].style.display&&this.$error_list.parents(".panel-collapse").collapse("show")},N._errorItemHandler=n.wrap(function(e){var t=document.querySelector(e.target.attributes.href.value);this._errorLayer.select(t);var n=r(e.target.parentNode);n.siblings().removeClass("selected"),n.addClass("selected")}),N.setNavigationList=function(e){this._$navigation_list.empty(),this._$navigation_list.append(e),this._$navigation_panel.css("display","")},N.makeModal=function(e){var t=new l.Modal(e),r=t.getTopLevel();return r.on("show.bs.modal.modal",function(){this.caretManager.pushSelection()}.bind(this)),r.on("hidden.bs.modal.modal",function(){this.caretManager.popSelection()}.bind(this)),this.$widget.prepend(r),t},N.increaseLabelVisibilityLevel=function(){if(!(this._current_label_level>=this.max_label_level)){this._current_label_level++;for(var e=this.gui_root.getElementsByClassName("_label_level_"+this._current_label_level),t=0,r=e.length;r>t;t++)e[t].classList.remove("_invisible");this.validationController.recreateErrors(),this.caretManager.mark.refresh()}},N.decreaseLabelVisiblityLevel=function(){if(this._current_label_level){var e=this._current_label_level;this._current_label_level--;for(var t=this.gui_root.getElementsByClassName("_label_level_"+e),r=0,n=t.length;n>r;r++)t[r].classList.add("_invisible");this.validationController.recreateErrors(),this.caretManager.mark.refresh()}},N._closeAllTooltips=function(){for(var e=this.doc.querySelectorAll("div.tooltip"),t=!1,n=0;n<e.length;++n){var i=r.data(e[n],"wed-tooltip-for"),o=r(i).data("bs.tooltip");o&&(o.leave(o),t=!0)}return t}}),define("wed/wed",["require","exports","module","./wed_core","./wed_init","./wed_caret","./wed_gui"],function(e,t){"use strict";var r=e("./wed_core");e("./wed_init"),e("./wed_caret"),e("./wed_gui"),t.version=r.version,t.Editor=r.Editor}),define("wed/mode",["require","exports","module","./domtypeguards","./domutil"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.editor=e,this.options=t,this.wedOptions={metadata:{name:"Base Mode (you should not be using this)",description:"The base mode. You should not be using it directly.",authors:["Louis-Dominique Dubeau"],license:"MPL 2.0",copyright:"Mangalam Research Center for Buddhist Languages"},label_levels:{max:1,initial:1}}}return e.prototype.getModeOptions=function(){return this.options},e.prototype.getWedOptions=function(){return this.wedOptions},e.prototype.getStylesheets=function(){return[]},e.prototype.nodesAroundEditableContents=function(e){for(var t,r,i=null,o=null,a=e.firstChild,s=0;null!==a;){if(n.isElement(a)&&(a.classList.contains("_start_wrapper")&&(t=s,i=a),a.classList.contains("_end_wrapper"))){r=s,o=a;break}a=a.nextSibling,s++}if(void 0!==t&&void 0!==r&&t>=r)throw new Error("end wrapper element unexpectedly appears before start wrapper element, or is also a start wrapper element");return[i,o]},e.prototype.makePlaceholderFor=function(e){return i.makePlaceholder()},e.prototype.shortDescriptionFor=function(e){},e.prototype.documentationLinkFor=function(e){},e.prototype.getValidator=function(){},e.prototype.getAttributeCompletions=function(e){return[]},e}();t.BaseMode=o}),define("wed/decorator",["require","exports","module","jquery","merge-options","./dloc","./domtypeguards","./domutil","./gui/action-context-menu","./util"],function(e,t,r,n,i,o,a,s,u,l){"use strict";function c(e,t){try{e.caretManager.setCaret(t,{textEdit:!0})}catch(r){}}function h(e,t){return"*"===e||e===t}Object.defineProperty(t,"__esModule",{value:!0});var d=s.indexOf,p=s.closestByClass,f=function(){function e(e,t,r){this.domlistener=e,this.editor=t,this.guiUpdater=r}return e.prototype.addHandlers=function(){var e=this;this.guiUpdater.events.subscribe(function(t){"BeforeInsertNodeAt"!==t.name||a.isText(t.node)||e.contentEditableHandler(t)})},e.prototype.startListening=function(){this.domlistener.startListening()},e.prototype.listDecorator=function(e,t){for(var r=Object.create(null),n=e.firstElementChild;null!==n;)n.classList.contains("_real")&&(r[l.getOriginalName(n)]=1),n=n.nextElementSibling;var i=Object.keys(r);if(i.length>1)throw new Error("calling listDecorator on a non-homogeneous list.");if(0!==i.length){for(n=e.firstElementChild;null!==n;){var o=n.nextElementSibling;n.hasAttribute("data-wed--separator-for")&&this.guiUpdater.removeNode(n),n=o}var a,s=i[0];"string"==typeof t?(a=e.ownerDocument.createElement("div"),a.textContent=t):a=t,a.classList.add("_text"),a.classList.add("_phantom"),a.setAttribute("data-wed--separator-for",s);var u=!0;for(n=e.firstElementChild;null!==n;)n.classList.contains("_real")&&(u?u=!1:this.guiUpdater.insertBefore(e,a.cloneNode(!0),n)),n=n.nextElementSibling}},e.prototype.contentEditableHandler=function(e){function t(e){e.setAttribute("tabindex","-1"),e.setAttribute("contenteditable",String(e.classList.contains("_real")||r&&e.classList.contains("_attribute_value")));for(var n=e.firstElementChild;null!==n;)t(n),n=n.nextElementSibling}var r="edit"===this.editor.attributes;t(e.node)},e.prototype.elementDecorator=function(e,t,r,i,o){if(r>this.editor.max_label_level)throw new Error("level higher than the maximum set by the mode: "+r);var u=this.editor.caretManager.getDataCaret();null==u||a.isAttr(u.node)&&u.node.ownerElement===n.data(t,"wed_mirror_node")||(u=void 0);var h=n.data(t,"wed_mirror_node");this.setReadOnly(t,Boolean(this.editor.validator.getNodeProperty(h,"PossibleDueToWildcard")));for(var d=l.getOriginalName(t),p="_"+d+"_label",f=s.childrenByClass(t,p),m=0,v=f;m<v.length;m++){var y=v[m];t.removeChild(y)}var g=[],_=!1;if("show"===this.editor.attributes||"edit"===this.editor.attributes)for(var b=l.getOriginalAttributes(t),w=Object.keys(b).sort(),E=0,x=w;E<x.length;E++){var N=x[E],S=this.mustHideAttribute(t,N);S&&(_=!0);var C=S?" _shown_when_caret_in_label":"";g.push(['<span class="_phantom _attribute'+C+'">','<span class="_phantom _attribute_name">',N,'</span>="<span class="_phantom _attribute_value">',s.textToHTML(b[N]),'</span>"</span>'].join(""))}var T=(0!==g.length?" ":"")+g.join(" "),P=t.ownerDocument;p+=" _label_level_"+r;var k=p;_&&(p+=" _autohidden_attributes");var A=P.createElement("span");A.className="_gui _phantom __start_label _start_wrapper "+p+" _label";var O=P.createElement("span");O.className="_phantom",O.innerHTML="&nbsp;<span class='_phantom _element_name'>"+d+"</span>"+T+"<span class='_phantom _greater_than'> >&nbsp;</span>",A.appendChild(O),this.guiUpdater.insertNodeAt(t,0,A);var I=P.createElement("span");I.className="_gui _phantom __end_label _end_wrapper "+k+" _label";var R=P.createElement("span");R.className="_phantom",R.innerHTML="<span class='_phantom _less_than'>&nbsp;&lt; </span><span class='_phantom _element_name'>"+d+"</span>&nbsp;",I.appendChild(R),this.guiUpdater.insertBefore(t,I,null),n(A).on("wed-context-menu",void 0!==i?i:!1),n(I).on("wed-context-menu",void 0!==o?o:!1),null!=u&&c(this.editor,u)},e.prototype.mustHideAttribute=function(e,t){var r=this.attributeHidingSpecs;if(null===r)return!1;for(var n=0,i=r.elements;n<i.length;n++){var o=i[n];if(e.matches(o.selector)){for(var a=!1,s=0,u=o.attributes;s<u.length;s++){var l=u[s];if("string"==typeof l)a||(a=h(l,t));else if(a)for(var c=0,d=l.except;c<d.length;c++){var p=d[c];if(a=!h(p,t),!a)break}}return a}}return!1},Object.defineProperty(e.prototype,"attributeHidingSpecs",{get:function(){if(void 0===this._attributeHidingSpecs){var e=this.editor.attributeHiding;if(void 0===e)this._attributeHidingSpecs=null;else{var t=e.method;if("selector"!==t)throw new Error("unknown attribute hiding method: "+t);for(var r={elements:[]},n=0,o=e.elements;n<o.length;n++){var a=o[n],u=i({},a);u.selector=s.toGUISelector(u.selector),r.elements.push(u)}this._attributeHidingSpecs=r}}return this._attributeHidingSpecs},enumerable:!0,configurable:!0}),e.prototype.setReadOnly=function(e,t){var r=e.classList;(t?r.add:r.remove).call(r,"_readonly")},e.prototype.contextMenuHandler=function(e,t,r){function i(e,t,r){var n=c._makeMenuItemForAction(t,e),i=n.getElementsByTagName("a")[0],o=v.createTextNode(y[String(r)]);i.appendChild(o),i.normalize(),f.push({action:t,item:n,data:e})}function a(e,t,r){if(void 0!==t)for(var n=0,o=t;n<o.length;n++){var a=o[n];i(e,a,r)}}function s(e,t){var r=e.params[1];if(r.simple())for(var n=0,o=r.toArray();n<o.length;n++){var s=o[n],u=c.resolver.unresolveName(s.ns,s.name);if(void 0===u)throw new Error("cannot unresolve attribute");if(c.isAttrProtected(u,t))return;a({name:u,node:t},m.getContextualActions("add-attribute",u,t))}else i(void 0,c.complex_pattern_action)}var c=this.editor,h=t.target,f=[],m=c.mode,v=h.ownerDocument,y={undefined:"","true":" before this element","false":" after this element"},g=p(h,"_real",c.gui_root),_=null!==g&&g.classList.contains("_readonly"),b=p(h,"_attribute_value",c.gui_root);if(null!==b){var w=c.toDataNode(b),E=o.DLoc.mustMakeDLoc(c.data_root,w.ownerElement);c.validator.possibleAt(E,!0).forEach(function(e){if("attributeName"===e.params[0]){var t=E.node.childNodes[E.offset];s(e,t)}});var x=w.name;c.isAttrProtected(w)||a({name:x,node:w},m.getContextualActions("delete-attribute",x,w))}else{var N=p(h,"_real",c.gui_root);if(null===N)throw new Error("cannot find real parent");h=N;var S=h.parentNode===c.gui_root,C=l.getOriginalName(h),T=m.documentationLinkFor(C);if(null!=T){var P=v.createElement("li");P.appendChild(this.editor.makeDocumentationLink(T)),f.push({action:null,item:P,data:null})}S||a({node:h,name:C},m.getContextualActions(["unwrap","delete-element"],C,n.data(h,"wed_mirror_node"),0));var k=h.parentNode,A=d(k.childNodes,h);e||A++;var O=c.caretManager.toDataLocation(k,A);if(void 0===O)throw new Error("cannot get caret");if(e&&"edit"===c.attributes&&c.validator.possibleAt(O,!0).forEach(function(e){if("attributeName"===e.params[0]){var t=O.node.childNodes[O.offset];s(e,t)}}),!S){for(var I=0,R=c.getElementTransformationsAt(O,"insert");I<R.length;I++){var j=R[I];void 0!==j.name?i({name:j.name,moveCaretTo:O},j.tr,e):i(void 0,j.tr)}if(e)for(var D=O.make(O.node.childNodes[O.offset],0),M=0,L=c.getElementTransformationsAt(D,"wrap-content");M<L.length;M++){var j=L[M];i(void 0!==j.name?{name:j.name,node:h}:void 0,j.tr)}}}if(0===f.length)return!0;var F=c.computeContextMenuPosition(r);return c.displayContextMenu(u.ContextMenu,F.left,F.top,f,_),!1},e}();t.Decorator=f});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/modes/generic/generic-decorator",["require","exports","module","wed/decorator","wed/domtypeguards","wed/util"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,r,n,i,o,a){var s=e.call(this,i,o,a)||this;return s.mode=t,s.metadata=r,s.options=n,s}return __extends(t,e),t.prototype.addHandlers=function(){var t=this;this.domlistener.addHandler("included-element",o.classFromOriginalName("*"),function(e,r,n,i,o,a){if(e.contains(a)){t.elementDecorator(e,a);var s=t.getAdditionalClasses(a);s.length>0&&(a.className+=" "+s)}}),this.domlistener.addHandler("children-changed",o.classFromOriginalName("*"),function(e,r,n,o,a,s){for(var u=0,l=r.concat(n);u<l.length;u++){var c=l[u];if(i.isText(c)||i.isElement(c)&&(c.classList.contains("_real")||c.classList.contains("_phantom_wrap"))){t.elementDecorator(e,s);break}}}),this.domlistener.addHandler("text-changed",o.classFromOriginalName("*"),function(e,r){t.elementDecorator(e,r.parentNode)}),this.domlistener.addHandler("attribute-changed",o.classFromOriginalName("*"),function(e,r){t.elementDecorator(e,r)}),e.prototype.addHandlers.call(this)},t.prototype.elementDecorator=function(t,r){e.prototype.elementDecorator.call(this,t,r,1,this.contextMenuHandler.bind(this,!0),this.contextMenuHandler.bind(this,!1))},t.prototype.getAdditionalClasses=function(e){var t=[];return this.metadata.isInline(e)&&t.push("_inline"),t.join(" ")},t}(n.Decorator);t.GenericDecorator=a}),define("wed/modes/generic/generic-tr",["require","exports","module","salve","wed/domtypeguards","wed/domutil","wed/transformation"],function(e,t,r,n,i,o,a){"use strict";function s(e){var t=e.error.toString();return 0===t.lastIndexOf("tag required: ",0)}function u(e,t){for(;;){var r=t.validator.getErrorsFor(e);if(r=r.filter(s),0===r.length)break;var i=r[0].error.getNames()[0],o=i.toArray();if(null===o||o.length>1)break;var a=o[0],u=t.validator.possibleWhere(e,new n.Event("enterStartTag",a.ns,a.name));if(1!==u.length)break;var l=t.resolver.unresolveName(a.ns,a.name),c=t.mode.getContextualActions("insert",l,e,u[0]);if(1!==c.length)break;if(c[0].needsInput)break;t.caretManager.setCaret(e,u[0]),c[0].execute({name:l})}}function l(e,t){var r=e.caretManager.getDataCaret(),n=e.mode.getAbsoluteResolver(),i=n.resolveName(t.name);if(void 0===i)throw new Error("cannot resolve "+t.name);var o=e.validator.unresolveNameAt(r.node,r.offset,i.ns,i.name),s=a.insertElement(e.data_updater,r.node,r.offset,i.ns,t.name);if(void 0===o){var l=n.prefixFromURI(i.ns),c=""===l?"xmlns":"xmlns:"+l,h=n.resolveName("xmlns:q").ns;e.data_updater.setAttributeNS(s,h,c,i.ns)}var d=s;if(e.mode.getModeOptions().autoinsert)for(u(s,e);null!==d;){var p=d.firstChild;if(null===p)break;d=p}e.caretManager.setCaret(d,0)}function c(e,t){var r=t.node;if(!i.isElement(r))throw new Error("node must be an element");var n=r.parentNode,s=o.indexOf(n.childNodes,r);a.unwrap(e.data_updater,r),e.caretManager.setCaret(n,s)}function h(e,t){var r=e.caretManager.sel;if(null==r)throw new Error("wrap transformation called with undefined range");if(r.collapsed)throw new Error("wrap transformation called with collapsed range");var n=r.asDataCarets(),i=n[0],s=n[1],u=e.mode.getAbsoluteResolver().resolveName(t.name);if(void 0===u)throw new Error("cannot resolve "+t.name);var l=a.wrapInElement(e.data_updater,i.node,i.offset,s.node,s.offset,u.ns,t.name),c=l.parentNode;e.caretManager.setCaret(i.make(c,o.indexOf(c.childNodes,l)+1))}function d(e,t){var r=t.node;if(!i.isElement(r))throw new Error("node must be an element");var n=e.mode.getAbsoluteResolver().resolveName(t.name);if(void 0===n)throw new Error("cannot resolve "+t.name);a.wrapInElement(e.data_updater,r,0,r,r.childNodes.length,n.ns,t.name)}function p(e,t){var r=t.node;if(!i.isElement(r))throw new Error("node must be an element");var n=r.parentNode,a=o.indexOf(n.childNodes,r),s=e.caretManager.fromDataLocation(r,0);s.node.classList.contains("_readonly")||(e.data_updater.removeNode(r),e.caretManager.setCaret(n,a))}function f(e,t){var r=t.node;if(!i.isElement(r))throw new Error("node must be an element");var n=r.parentNode,a=o.indexOf(n.childNodes,r),s=e.caretManager.fromDataLocation(r,0);s.node.classList.contains("_readonly")||(e.data_updater.removeNode(r),e.caretManager.setCaret(n,a))}function m(e,t){var r=t.node;if(!i.isElement(r))throw new Error("node must be an element");var n=e.caretManager.fromDataLocation(r,0);if(!n.node.classList.contains("_readonly")){e.data_updater.setAttribute(r,t.name,"");var o=r.getAttributeNode(t.name);e.caretManager.setCaret(o,0)}}function v(e,t){var r=t.node;if(null==r||!i.isAttr(r))throw new Error("node must be an attribute");var n=r.ownerElement,a=e.caretManager,s=a.fromDataLocation(n,0),u=s.node;if(!u.classList.contains("_readonly")){var l=r.name,c=o.childByClass(u,"__start_label"),h=c.getElementsByClassName("_attribute_value"),d=a.fromDataLocation(r,0).node.parentNode,p=o.indexOf(h,d),f=h[p+1],m=null!=f?e.toDataNode(f):null;e.data_updater.setAttribute(n,l,null),null!==m?e.caretManager.setCaret(m,0):e.caretManager.setCaret(s.node.getElementsByClassName("_element_name")[0],0)}}function y(e){var t=Object.create(null);return t.insert=new a.Transformation(e,"insert","Create new <name>","",l),t.unwrap=new a.Transformation(e,"unwrap","Unwrap the content of this element",void 0,c),t.wrap=new a.Transformation(e,"wrap","Wrap in <name>",void 0,h),t["wrap-content"]=new a.Transformation(e,"wrap-content","Wrap content in <name>",void 0,d),t["delete-element"]=new a.Transformation(e,"delete-element","Delete this element",void 0,p),t["delete-parent"]=new a.Transformation(e,"delete-parent","Delete <name>",void 0,f),t["add-attribute"]=new a.Transformation(e,"add-attribute","Add @<name>",void 0,m),t["delete-attribute"]=new a.Transformation(e,"delete-attribute","Delete this attribute",void 0,v),t["insert-text"]=new a.Transformation(e,"insert-text",'Insert "<name>"',void 0,function(e,t){e.type(t.name)}),t.split=e.split_node_tr,t}Object.defineProperty(t,"__esModule",{value:!0}),t.makeTagTr=y}),define("wed/modes/generic/metadata-json-reader",["require","exports","module","ajv"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.schema=e}return Object.defineProperty(e.prototype,"validator",{get:function(){if(void 0===this._validator){var e=new n;this._validator=e.compile(JSON.parse(this.schema))}return this._validator},enumerable:!0,configurable:!0}),e.prototype.read=function(e){return this.validate(e),this.convert(e)},e.prototype.validate=function(e){var t=this.validator,r=t(e);if(!r){if(void 0===t.errors)throw new Error("metadata JSON invalid but no errors!");var n=new Error("failed to validate");throw n.jsonErrors=t.errors,n}},e}();t.MetadataJSONReader=i}),define("text!wed/modes/generic/metadata-schema.json",[],function(){return'{\n  "$schema": "http://json-schema.org/schema#",\n  "id": "http://btw.mangalam-research.org/schemas/wed/metadata.json",\n  "title": "Metadata",\n  "description": "A schema describing metadata for wed modes.",\n  "definitions": {\n    "generator": {\n      "description": "The name of the software that generated the JSON.",\n      "type": "string"\n    },\n    "date": {\n      "description": "The date at which the file was generated.",\n      "type": "string",\n      "format": "date-time"\n    },\n    "version": {\n      "description": "Records the version number of the format of the metadata file.",\n      "type": "string"\n    },\n    "namespaces": {\n      "description": "Prefix -> uri mapping of absolute namespaces.",\n      "type": "object"\n    },\n    "elements": {\n      "description": "An array of all elements in the schema.",\n      "type": "array",\n      "items": {\n        "type": "object",\n        "properties": {\n          "name": {\n            "description": "The local name of the element.",\n            "type": "string"\n          },\n          "ns": {\n            "description": "The namespace URI of the element.",\n            "type": "string"\n          },\n          "desc": {\n            "description": "A short documentation string.",\n            "type": "string"\n          }\n        },\n        "additionalProperties": false,\n        "required": ["name", "desc"]\n      }\n    },\n    "inline": {\n      "description": "An object determining which elements are inline.",\n      "type": "object",\n      "properties": {\n        "method": {\n          "description": "The method by which elements are addressed",\n          "type": "string",\n          "enum": ["name"]\n        },\n        "rules": {\n          "type": "object",\n          "additionalProperties": { "type": "boolean" }\n        }\n      },\n      "required": ["method", "rules"],\n      "additionalProperties": false\n    },\n    "dochtml": {\n      "description": "Configuration of the online HTML documentation for the XML schema.",\n      "type": "object",\n      "properties": {\n        "method": {\n          "description": "The method by which the URL is generated.",\n          "type": "string",\n          "enum": ["simple-pattern"]\n        },\n        "pattern": {\n          "description": "The pattern to use.",\n          "type": "string"\n        }\n      },\n      "required": ["method", "pattern"],\n      "additionalProperties": false\n    }\n  },\n  "type": "object",\n  "oneOf": [\n    {\n      "properties": {\n        "generator": { "$ref": "#/definitions/generator" },\n        "date": { "$ref": "#/definitions/date" },\n        "version": {\n          "enum": ["1"]\n        },\n        "namespaces": { "$ref": "#/definitions/namespaces" },\n        "elements": { "$ref": "#/definitions/elements" },\n        "dochtml": {\n          "description": "A URL to where the schema\'s documentation is stored.",\n          "type": "string"\n        }\n      },\n      "required": ["version"],\n      "additionalProperties": false\n    }, {\n      "properties": {\n        "generator": { "$ref": "#/definitions/generator" },\n        "date": { "$ref": "#/definitions/date" },\n        "version": {\n          "enum": ["2"]\n        },\n        "namespaces": { "$ref": "#/definitions/namespaces" },\n        "elements": { "$ref": "#/definitions/elements" },\n        "inline": { "$ref": "#/definitions/inline" },\n        "dochtml": { "$ref": "#/definitions/dochtml" }\n      },\n      "additionalProperties": false,\n      "required": ["version", "namespaces"]\n    }\n  ]\n}\n';
});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/modes/generic/metadata-versioned-reader",["require","exports","module","./metadata-json-reader","./metadata-schema.json"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){if(this.metadata=t,this.reverseMapping=Object.create(null),this.descMap=Object.create(null),t.version!==e)throw new Error("incorrect version number: expected "+e+", got "+t.version);if(this.version=t.version,this.generator=t.generator,this.date=t.date,void 0!==t.namespaces?this.namespaceMappings=t.namespaces:this.namespaceMappings=Object.create(null),"xml"in this.namespaceMappings)throw new Error("xml mapping already defined");this.namespaceMappings.xml="http://www.w3.org/XML/1998/namespace";for(var r in this.namespaceMappings){var n=this.namespaceMappings[r];void 0===this.reverseMapping[n]&&(this.reverseMapping[n]=r)}this.reverseMapping[this.namespaceMappings[""]]="";var i=t.elements;if(void 0!==i)for(var o=this.descMap,a=0,s=i;a<s.length;a++){var u=s[a],l=void 0!==u.ns?u.ns:"http://www.tei-c.org/ns/1.0",c=this.reverseMapping[l];if(void 0===c)throw new Error("undefined namespace: "+l);var h=""===c?u.name:c+":"+u.name;o[h]=u.desc}}return e.prototype.getNamespaceMappings=function(){return this.namespaceMappings},e.prototype.shortDescriptionFor=function(e){var t=this.unresolveName(e);if(void 0!==t)return this.descMap[t]},e.prototype.unresolveName=function(e){var t=this.reverseMapping[e.ns];if(void 0!==t)return""===t?e.name:t+":"+e.name},e}();t.MetadataBase=o;var a=function(e){function t(t){var r=e.call(this,i)||this;return r.metadataClass=t,r}return __extends(t,e),t.prototype.convert=function(e){return new this.metadataClass(e)},t.version="1",t}(n.MetadataJSONReader);t.MetadataReaderBase=a});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/modes/generic/metadata-reader-v1",["require","exports","module","./metadata-versioned-reader"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,"1",t)||this}return __extends(t,e),t.prototype.isInline=function(e){return!1},t.prototype.documentationLinkFor=function(e){var t=this.metadata.dochtml;if(void 0!==t){var r=this.unresolveName(e);if(void 0!==r)return r=r.replace(":","_"),t+"ref-"+r+".html"}},t}(n.MetadataBase),o=function(e){function t(){return e.call(this,i)||this}return __extends(t,e),t.version="1",t}(n.MetadataReaderBase);t.MetadataReaderV1=o}),define("wed/modes/generic/doc-pattern",["require","exports","module"],function(e,t,r){"use strict";function n(e){for(var t=e.split(/(\$\{|\})/),r=[],n=!1,u=0,l=t;u<l.length;u++){var c=l[u];if("${"===c){if(n)throw new Error("nested interpolations are invalid");n=!0}else if("}"===c){if(!n)throw new Error("errant interpolation closure");n=!1}else if(n){var h=c.split(":",1),d=h[0],p=h[1];if(void 0===p)r.push(new a(d));else{if("s"!==p[0])throw new Error("unknown transform "+p);var f=p.slice(1);if("("!==f[0]||")"!==f[f.length-1])throw new Error("transform parameters must be in parentheses");var m=f.slice(1,-1).split(",").map(function(e){return e.trim()});if(2!==m.length)throw new Error("an s transform takes 2 parameters");for(var v=0,y=m;v<y.length;v++){var g=y[v];if('"'!==g[0]||'"'!==g[g.length-1])throw new Error("parameter must be a string wrapped in double quotes: "+g)}m=m.map(function(e){return e.slice(1,-1)}),r.push(new s(m[0],m[1],new a(d)))}}else r.push(new i(c))}if(n)throw new Error("an interpolation was not closed");return new o(r)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.value=e}return e.prototype.execute=function(){return this.value},e}(),o=function(){function e(e){this.values=e}return e.prototype.execute=function(e){return this.values.map(function(t){return t.execute(e)}).join("")},e}(),a=function(){function e(e){this.name=e}return e.prototype.execute=function(e){return e.resolveName(this.name)},e}(),s=function(){function e(e,t,r){this.pattern=e,this.substitution=t,this.child=r}return e.prototype.execute=function(e){var t=this.child.execute(e);return t.replace(this.pattern,this.substitution)},e}();t.compile=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/modes/generic/metadata-reader-v2",["require","exports","module","wed/util","./doc-pattern","./metadata-versioned-reader"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.name=e}return e.prototype.resolveName=function(e){if("name"===e)return this.name;throw new Error("cannot resolve: "+e)},e}(),s=function(e){function t(t){var r=e.call(this,"2",t)||this;if(void 0===t.namespaces)throw new Error("namespaces are not optional in version 2");if("2"!==t.version)throw new Error("need version 2");if(r.inline=t.inline,void 0!==r.inline&&"name"!==r.inline.method)throw new Error("only the 'name' method is supported for inlines");if(r.dochtml=t.dochtml,void 0!==r.dochtml){if("simple-pattern"!==r.dochtml.method)throw new Error("only the 'simple-pattern' method is supported for dochtml");r.docPattern=i.compile(r.dochtml.pattern)}return r}return __extends(t,e),t.prototype.isInline=function(e){if(void 0===this.inline)return!1;var t=n.getOriginalName(e),r=t.split(":");1===r.length&&(r[1]=r[0],r[0]="tei");var i=r.join(":"),o=this.inline.rules[i];return void 0===o?!1:o},t.prototype.documentationLinkFor=function(e){var t=this.docPattern;if(void 0!==t){var r=this.unresolveName(e);if(void 0!==r)return t.execute(new a(r))}},t}(o.MetadataBase),u=function(e){function t(){return e.call(this,s)||this}return __extends(t,e),t.version="2",t}(o.MetadataReaderBase);t.MetadataReaderV2=u}),define("wed/modes/generic/metadata-multiversion-reader",["require","exports","module","./metadata-reader-v1","./metadata-reader-v2"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.init=function(){for(var t=[n.MetadataReaderV1,i.MetadataReaderV2],r=0,o=t;r<o.length;r++){var a=o[r];e.versionToConstructor[a.version]=a}},e.prototype.read=function(t){var r=t.version;if(void 0===r)throw new Error("no version field, cannot decode metadata");var n=e.versionToConstructor[r];if(void 0===n)throw new Error("cannot handle version "+r);return(new n).read(t)},e.versionToConstructor=Object.create(null),e}();t.MetadataMultiversionReader=o,o.init()});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/modes/generic/generic",["require","exports","module","bluebird","salve","wed/mode","wed/object-check","./generic-decorator","./generic-tr","./metadata-multiversion-reader"],function(e,t,r,n,i,o,a,s,u,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(r,n){var i=e.call(this,r,n)||this;return i.optionTemplate={metadata:!0,autoinsert:!1},i.constructor===t&&(i.wedOptions.metadata={name:"Generic",authors:["Louis-Dominique Dubeau"],description:"This is a basic mode bundled with wed and which can, and probably should be used as the base for other modes.",license:"MPL 2.0",copyright:"Mangalam Research Center for Buddhist Languages"}),i.wedOptions.attributes="edit",i}return __extends(t,e),t.prototype.init=function(){var e=this;return this.checkOptions(this.options),void 0===this.options.autoinsert&&(this.options.autoinsert=!0),n.resolve().then(function(){return e.tagTr=u.makeTagTr(e.editor),e.makeMetadata().then(function(t){e.metadata=t})}).then(function(){e.resolver=new i.NameResolver;for(var t=e.metadata.getNamespaceMappings(),r=0,n=Object.keys(t);r<n.length;r++){var o=n[r];e.resolver.definePrefix(o,t[o])}})},t.prototype.checkOptions=function(e){var t=a.check(this.optionTemplate,e),r=[];if(void 0!==t.missing)for(var n=0,i=t.missing;n<i.length;n++){var o=i[n];r.push("missing option: "+o)}if(void 0!==t.extra)for(var s=0,u=t.extra;s<u.length;s++){var l=u[s];r.push("extra option: "+l)}if(0!==r.length)throw new Error("incorrect options: "+r.join(", "))},t.prototype.makeMetadata=function(){return this.editor.runtime.resolveToString(this.options.metadata).then(function(e){var t=JSON.parse(e);return(new l.MetadataMultiversionReader).read(t)})},t.prototype.getAbsoluteResolver=function(){return this.resolver},t.prototype.makeDecorator=function(){var e=Object.create(s.GenericDecorator.prototype),t=Array.prototype.slice.call(arguments);return t=[this,this.metadata,this.options].concat(t),s.GenericDecorator.apply(e,t),e},t.prototype.shortDescriptionFor=function(e){var t=this.resolver.resolveName(e);if(void 0!==t)return this.metadata.shortDescriptionFor(t)},t.prototype.documentationLinkFor=function(e){var t=this.resolver.resolveName(e);if(void 0!==t)return this.metadata.documentationLinkFor(t)},t.prototype.getContextualActions=function(e,t,r,n){e instanceof Array||(e=[e]);for(var i=[],o=0,a=e;o<a.length;o++){var s=a[o],u=this.tagTr[s];void 0!==u&&i.push(u)}return i},t}(o.BaseMode);t.Mode=c});