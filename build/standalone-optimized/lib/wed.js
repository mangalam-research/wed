/**
 * Typeguards to facilitate working with TypeScript and the DOM.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Various utilities for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Conversion from XML to HTML.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Utilities that manipulate or query the DOM tree.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Classes that model RNG patterns.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Validation errors.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Implements a name resolver for handling namespace changes in XML.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Class for XML Expanded Names.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Errors that can be raised during parsing of types.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Common tools for salve.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Implementations of some simple collections. This module is meant for salve's
 * internal purposes only. It may be yanked at any time. Do not use in your own
 * code.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 * @private
 */

/**
 * Classes that model datatypes used in RNG schemas.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 *
 */

/**
 * Collection of constants that model the way XML refers to various
 * characters and groups of characters. This module is essentially private to
 * salve.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Naive set implementation.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 * @private
 */

/**
 * This module contains data and utilities to work with the schema format that
 * salve uses natively.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Implementation of the builtin Relax NG datatype library.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Implementation of the XMLSchema datatypes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``attribute`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``choice`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``data`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``element`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``group`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``list`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern for RNG's ``param`` element.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * A mock implementation of Node's util package. This module implements only
 * what is actually used in salve.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * RNG-based validator.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/*!
 * XRegExp.build 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2012-2016 MIT License
 * Inspired by Lea Verou's RegExp.create <lea.verou.me>
 */

/*!
 * XRegExp.matchRecursive 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2009-2016 MIT License
 */

/*!
 * XRegExp Unicode Base 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2008-2016 MIT License
 */

/*!
 * XRegExp Unicode Blocks 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2010-2016 MIT License
 * Unicode data by Mathias Bynens <mathiasbynens.be>
 */

/*!
 * XRegExp Unicode Categories 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2010-2016 MIT License
 * Unicode data by Mathias Bynens <mathiasbynens.be>
 */

/*!
 * XRegExp Unicode Properties 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2012-2016 MIT License
 * Unicode data by Mathias Bynens <mathiasbynens.be>
 */

/*!
 * XRegExp Unicode Scripts 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2010-2016 MIT License
 * Unicode data by Mathias Bynens <mathiasbynens.be>
 */

/*!
 * XRegExp 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2007-2016 MIT License
 */

/**
 * Main module of salve-dom.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * A listener class.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Editing actions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Browser detection. Extremely ad hoc and meant for wed's internal purposes
 * only.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Model for a GUI root.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * This module implements the "caret mark". The "caret mark" is the graphical
 * indicator showing the position of the caret.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Library of caret movement computations.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Checks whether an object conforms to a template.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Listener for DOM tree changes.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
     * The icons used by the user interface.
     * @author Louis-Dominique Dubeau
     * @license MPL 2.0
     * @copyright Mangalam Research Center for Buddhist Languages
     */

/**
 * Exceptions for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Facility for updating a DOM tree and issue synchronous events on changes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Listens to changes on a tree and updates the GUI tree in response to changes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Copyright 2017, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.1-dev
 * Build date: 11 October 2017
 */

/**
 * Text range module for Rangy.
 * Text-based manipulation and searching of ranges and selections.
 *
 * Features
 *
 * - Ability to move range boundaries by character or word offsets
 * - Customizable word tokenizer
 * - Ignores text nodes inside <script> or <style> elements or those hidden by CSS display and visibility properties
 * - Range findText method to search for text or regex within the page or within a range. Flags for whole words and case
 *   sensitivity
 * - Selection and range save/restore as text offsets within a node
 * - Methods to return visible text within a range or selection
 * - innerText method for elements
 *
 * References
 *
 * https://www.w3.org/Bugs/Public/show_bug.cgi?id=13145
 * http://aryeh.name/spec/innertext/innertext.html
 * http://dvcs.w3.org/hg/editing/raw-file/tip/editing.html
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core.
 *
 * Copyright 2017, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.1-dev
 * Build date: 11 October 2017
 */

/**
 * Transformation framework.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Module implementing an class that describes keyboard keys.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Keys that wed uses, as constants.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Context menus.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Layers over the editing area.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Specialized layer for error markers.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Content scroller.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * A toolbar for editors.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Tooltips for elements that appear in the editor pane.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Load and initialize modes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
     * The onbeforeunload handler for wed.
     * @author Louis-Dominique Dubeau
     * @license MPL 2.0
     * @copyright Mangalam Research Center for Buddhist Languages
     */

/**
 * @module onerror
 * @desc The error handler for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * An execution runtime for editors.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * An XML serializer for platforms that produce erratic results.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Base class for savers.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * A collection of stock modals for an editor instance.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Task abstraction for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Controller managing the validation logic of a wed editor.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * This module is responsible for validating the document being edited in wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Wed-specific undo functionality.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Functions to create input triggers according to some common patterns.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Label manager.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Basic decoration facilities.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
     * The base types for modes.
     *
     * @author Louis-Dominique Dubeau
     * @license MPL 2.0
     * @copyright Mangalam Research Center for Buddhist Languages
     */

define("wed/domtypeguards",["require","exports"],function(e,t){"use strict";function r(e){return null!=e&&"number"==typeof e.nodeType}function n(e){return null!=e&&e.nodeType===Node.ELEMENT_NODE}function o(e){return null!=e&&e.nodeType===Node.TEXT_NODE}function i(e){return e instanceof Attr||e.nodeType===u}function a(e){return e instanceof Attr}function s(e){return null!=e&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}function l(e){return null!=e&&e.nodeType===Node.DOCUMENT_NODE}Object.defineProperty(t,"__esModule",{value:!0}),t.isNode=r,t.isElement=n,t.isText=o;var u=Node.ATTRIBUTE_NODE,c=void 0===u?a:i;t.isAttr=c,t.isDocumentFragment=s,t.isDocument=l}),function(e,t){function r(e,t,r){if(Array.prototype.map)return Array.prototype.map.call(e,t,r);for(var n=new Array(e.length),o=0,i=e.length;o<i;o++)n[o]=t.call(r,e[o],o,e);return n}function n(e){return{newPos:e.newPos,components:e.components.slice(0)}}function o(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t}function i(e){var t=e;return t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/"/g,"&quot;")}function a(e,t,r){t=t||[],r=r||[];var n;for(n=0;n<t.length;n+=1)if(t[n]===e)return r[n];var o;if("[object Array]"===u.call(e)){for(t.push(e),o=new Array(e.length),r.push(o),n=0;n<e.length;n+=1)o[n]=a(e[n],t,r);t.pop(),r.pop()}else if("object"==typeof e&&null!==e){t.push(e),o={},r.push(o);var i,s=[];for(i in e)s.push(i);for(s.sort(),n=0;n<s.length;n+=1)i=s[n],o[i]=a(e[i],t,r);t.pop(),r.pop()}else o=e;return o}function s(e,t,n,o){for(var i=0,a=e.length,s=0,l=0;i<a;i++){var u=e[i];if(u.removed){if(u.value=n.slice(l,l+u.count).join(""),l+=u.count,i&&e[i-1].added){var c=e[i-1];e[i-1]=e[i],e[i]=c}}else{if(!u.added&&o){var d=t.slice(s,s+u.count);d=r(d,function(e,t){var r=n[l+t];return r.length>e.length?r:e}),u.value=d.join("")}else u.value=t.slice(s,s+u.count).join("");s+=u.count,u.added||(l+=u.count)}}return e}function l(e){this.ignoreWhitespace=e}var u=Object.prototype.toString;l.prototype={diff:function(e,r,o){function i(e){return o?(setTimeout(function(){o(t,e)},0),!0):e}function a(){for(var o=-1*d;o<=d;o+=2){var a,h=p[o-1],f=p[o+1],m=(f?f.newPos:0)-o;h&&(p[o-1]=t);var v=h&&h.newPos+1<u,g=f&&0<=m&&m<c;if(v||g){if(!v||g&&h.newPos<f.newPos?(a=n(f),l.pushComponent(a.components,t,!0)):(a=h,a.newPos++,l.pushComponent(a.components,!0,t)),m=l.extractCommon(a,r,e,o),a.newPos+1>=u&&m+1>=c)return i(s(a.components,r,e,l.useLongestToken));p[o]=a}else p[o]=t}d++}var l=this;if(r===e)return i([{value:r}]);if(!r)return i([{value:e,removed:!0}]);if(!e)return i([{value:r,added:!0}]);r=this.tokenize(r),e=this.tokenize(e);var u=r.length,c=e.length,d=1,h=u+c,p=[{newPos:-1,components:[]}],f=this.extractCommon(p[0],r,e,0);if(p[0].newPos+1>=u&&f+1>=c)return i([{value:r.join("")}]);if(o)!function e(){setTimeout(function(){return d>h?o():void(a()||e())},0)}();else for(;d<=h;){var m=a();if(m)return m}},pushComponent:function(e,t,r){var n=e[e.length-1];n&&n.added===t&&n.removed===r?e[e.length-1]={count:n.count+1,added:t,removed:r}:e.push({count:1,added:t,removed:r})},extractCommon:function(e,t,r,n){for(var o=t.length,i=r.length,a=e.newPos,s=a-n,l=0;a+1<o&&s+1<i&&this.equals(t[a+1],r[s+1]);)a++,s++,l++;return l&&e.components.push({count:l}),e.newPos=a,s},equals:function(e,t){var r=/\S/;return e===t||this.ignoreWhitespace&&!r.test(e)&&!r.test(t)},tokenize:function(e){return e.split("")}};var c=new l,d=new l(!0),h=new l;d.tokenize=h.tokenize=function(e){return o(e.split(/(\s+|\b)/))};var p=new l(!0);p.tokenize=function(e){return o(e.split(/([{}:;,]|\s+)/))};var f=new l,m=new l;m.ignoreTrim=!0,f.tokenize=m.tokenize=function(e){for(var t=[],r=e.split(/^/m),n=0;n<r.length;n++){var o=r[n],i=r[n-1],a=i&&i[i.length-1];"\n"===o&&"\r"===a?t[t.length-1]=t[t.length-1].slice(0,-1)+"\r\n":(this.ignoreTrim&&(o=o.trim(),n<r.length-1&&(o+="\n")),t.push(o))}return t};var v=new l;v.tokenize=function(e){var t=[],r=e.split(/(\n|\r\n)/);r[r.length-1]||r.pop();for(var n=0;n<r.length;n++){var o=r[n];n%2?t[t.length-1]+=o:t.push(o)}return t};var g=new l;g.tokenize=function(e){return o(e.split(/(\S.+?[.!?])(?=\s+|$)/))};var y=new l;y.useLongestToken=!0,y.tokenize=f.tokenize,y.equals=function(e,t){return f.equals(e.replace(/,([\r\n])/g,"$1"),t.replace(/,([\r\n])/g,"$1"))};var b={Diff:l,diffChars:function(e,t,r){return c.diff(e,t,r)},diffWords:function(e,t,r){return d.diff(e,t,r)},diffWordsWithSpace:function(e,t,r){return h.diff(e,t,r)},diffLines:function(e,t,r){return f.diff(e,t,r)},diffTrimmedLines:function(e,t,r){return m.diff(e,t,r)},diffSentences:function(e,t,r){return g.diff(e,t,r)},diffCss:function(e,t,r){return p.diff(e,t,r)},diffJson:function(e,r,n){return y.diff("string"==typeof e?e:JSON.stringify(a(e),t,"  "),"string"==typeof r?r:JSON.stringify(a(r),t,"  "),n)},createTwoFilesPatch:function(e,t,n,o,i,a){function s(e){return r(e,function(e){return" "+e})}function l(e,t,r){var n=c[c.length-2],o=t===c.length-2,i=t===c.length-3&&r.added!==n.added;/\n$/.test(r.value)||!o&&!i||e.push("\\ No newline at end of file")}var u=[];e==t&&u.push("Index: "+e),u.push("==================================================================="),u.push("--- "+e+("undefined"==typeof i?"":"\t"+i)),u.push("+++ "+t+("undefined"==typeof a?"":"\t"+a));var c=v.diff(n,o);c.push({value:"",lines:[]});for(var d=0,h=0,p=[],f=1,m=1,g=0;g<c.length;g++){var y=c[g],b=y.lines||y.value.replace(/\n$/,"").split("\n");if(y.lines=b,y.added||y.removed){if(!d){var w=c[g-1];d=f,h=m,w&&(p=s(w.lines.slice(-4)),d-=p.length,h-=p.length)}p.push.apply(p,r(b,function(e){return(y.added?"+":"-")+e})),l(p,g,y),y.added?m+=b.length:f+=b.length}else{if(d)if(b.length<=8&&g<c.length-2)p.push.apply(p,s(b));else{var _=Math.min(b.length,4);u.push("@@ -"+d+","+(f-d+_)+" +"+h+","+(m-h+_)+" @@"),u.push.apply(u,p),u.push.apply(u,s(b.slice(0,_))),b.length<=4&&l(u,g,y),d=0,h=0,p=[]}f+=b.length,m+=b.length}}return u.join("\n")+"\n"},createPatch:function(e,t,r,n,o){return b.createTwoFilesPatch(e,e,t,r,n,o)},applyPatch:function(e,t){for(var r=t.split("\n"),n=[],o=0,i=!1,a=!1;o<r.length&&!/^@@/.test(r[o]);)o++;for(;o<r.length;o++)if("@"===r[o][0]){var s=r[o].split(/@@ -(\d+),(\d+) \+(\d+),(\d+) @@/);n.unshift({start:s[3],oldlength:+s[2],removed:[],newlength:s[4],added:[]})}else"+"===r[o][0]?n[0].added.push(r[o].substr(1)):"-"===r[o][0]?n[0].removed.push(r[o].substr(1)):" "===r[o][0]?(n[0].added.push(r[o].substr(1)),n[0].removed.push(r[o].substr(1))):"\\"===r[o][0]&&("+"===r[o-1][0]?i=!0:"-"===r[o-1][0]&&(a=!0));var l=e.split("\n");for(o=n.length-1;o>=0;o--){for(var u=n[o],c=0;c<u.oldlength;c++)if(l[u.start-1+c]!==u.removed[c])return!1;Array.prototype.splice.apply(l,[u.start-1,u.oldlength].concat(u.added))}if(i)for(;!l[l.length-1];)l.pop();else a&&l.push("");return l.join("\n")},convertChangesToXML:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];n.added?t.push("<ins>"):n.removed&&t.push("<del>"),t.push(i(n.value)),n.added?t.push("</ins>"):n.removed&&t.push("</del>")}return t.join("")},convertChangesToDMP:function(e){for(var t,r,n=[],o=0;o<e.length;o++)t=e[o],r=t.added?1:t.removed?-1:0,n.push([r,t.value]);return n},canonicalize:a};"undefined"!=typeof module&&module.exports?module.exports=b:"function"==typeof define&&define.amd?define("diff",[],function(){return b}):"undefined"==typeof e.JsDiff&&(e.JsDiff=b)}(this),define("wed/util",["require","exports","diff"],function(e,t,r){"use strict";function n(e,t){return Math.sqrt(e*e+t*t)}function o(e,t,r,o,i,a){var s=t-o,l=e-r,u=t-a,c=e-i,d=s<0,h=u>0,p=l<0,f=c>0,m=p?l:f?c:0,v=d?s:h?u:0;return n(m,v)}function i(e,t,r,n,o,i){var a=t-n,s=e-r,l=t-i,u=e-o,c=a<0,d=l>0,h=s<0,p=u>0,f=h?s:p?u:0,m=c?a:d?l:0;return{x:Math.abs(f),y:Math.abs(m)}}function a(e){return e.replace(/([\][\\\/!"#$%&'()*+,.:;<=>?@^`{|}~])/g,"\\$1")}function s(e){return e.classList[0]}function l(e,t){if("*"===e)return"._real";var r=e.split(":"),n=r[0],o=r[1];void 0===o&&(o=n,n="");var i=t[n];if(void 0===i)throw new Error("prefix "+n+" is not defined in namespaces");return"._local_"+a(o)+"._xmlns_"+a(i)+"._real"}function u(e){for(var t="",r=0,n=e;r<n.length;r++){var o=n[r];t+="x"+o.charCodeAt(0).toString(16)}return t}function c(e){if(!S.test(e))throw new Error("badly encoded string");for(var t="",r=0,n=e.slice(1).split("x");r<n.length;r++){var o=n[r];t+=String.fromCharCode(parseInt(o,16))}return t}function d(e,t){var n="";if(e!==t)for(var o=r.diffChars(t,e),i=o[o.length-1],a=0;a<o.length;++a){var s=o[a];if(s.added===!0)n+="p"+u(s.value);else if(s.removed===!0){var l=o[a+1];void 0!==l&&l.added===!0&&s.value.toUpperCase()===l.value?(n+="u"+s.value.length,a++):n+="m"+s.value.length}else s!==i&&(n+="g"+s.value.length)}return n}function h(e,t){if(""===t)return e;for(var r=0,n="";t.length>0;){var o=t.match(P);if(null!==o){t=t.slice(o[0].length);var i=o[0][0];switch(i){case"g":case"m":case"u":var a=parseInt(o[2]);switch(i){case"g":n+=e.slice(r,r+a);break;case"u":n+=e.slice(r,r+a).toUpperCase();break;case"m":break;default:throw new Error("internal error: unexpected op "+i)}r+=a;break;case"p":n+=c(o[1]);break;default:throw new Error("unexpected operator "+i)}}if(null===o)throw new Error("cannot parse diff: "+t)}return n+=e.slice(r)}function p(e){var t=/^data-wed-(.+)-([^-]*?)$/.exec(e);if(null===t)throw new Error("malformed name");var r,n=t[1],o=t[2];if("-"===n[0]){var i=/^-(.+?)-(.+)$/.exec(n);if(null===i)throw new Error("malformed name");r=i[1],n=i[2]}return n=n.replace(/---/,":").replace(/---(-+)/g,"--$1"),""!==o&&(n=h(n,o)),{name:n,qualifier:r}}function f(e,t){var r=document.createElement("div");r.setAttribute("data-"+e,"");var n=r.attributes[0].name.slice(5),o=n.replace(/--(-+)/g,"---$1").replace(/:/,"---");return t=void 0===t?"":"-"+t+"-","data-wed-"+t+o+"-"+d(e,n)}function m(e){return/^data-wed-(?!-)/.test(e)}function v(e){for(var t=Object.create(null),r=e.attributes,n=0;n<r.length;++n){var o=r[n],i=o.localName;m(i)&&(t[p(i).name]=o.value)}return t}function g(){return"WED-ID-"+ ++k}function y(e){var t=e;return t.altKey||t.ctrlKey||t.metaKey}function b(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=window;void 0===r.selenium_log&&(r.selenium_log=[]),r.selenium_log.push.apply(r.selenium_log,e)}function w(e){try{throw e}catch(e){return e.stack}}function _(){var e=new Error;return null!=e.stack?e.stack:w(e)}function E(e,t){if(null!=e.a&&null!=e.b)return"("+E(e.a,t)+") or ("+E(e.b,t)+")";var r;if("AnyName"===e.pattern)r="*:*";else{if(void 0===e.ns)throw new Error("unexpected undefined obj.ns");if(void 0!==e.name)r=t.unresolveName(e.ns,e.name),void 0===r&&(r="{"+e.ns+"}"+e.name);else{var n=t.prefixFromURI(e.ns);r=void 0===n?"{"+e.ns+"}":""!==n?n+":":n,r+="*"}}return null!=e.except&&(r+=" except ("+E(e.except,t)+")"),r}function x(e){var t=new FileReader;return new Promise(function(r,n){t.onload=function(){r(t.result)},t.onerror=n,t.readAsText(e)})}function N(e,t){var r=void 0!==Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__;r!==t&&(void 0!==Object.setPrototypeOf?Object.setPrototypeOf(e,t.prototype):e.__proto__=t.prototype)}function C(e){var t=e;return t.suppressUnhandledRejections&&t.suppressUnhandledRejections(),e}Object.defineProperty(t,"__esModule",{value:!0}),t.distFromDeltas=n,t.distFromRect=o,t.distsFromRect=i,t.escapeCSSClass=a,t.getOriginalName=s,t.classFromOriginalName=l,t.stringToCodeSequence=u;var S=/^(?:x[a-f0-9]+)+$/;t.codeSequenceToString=c,t.encodeDiff=d;var P=/^(?:p([xa-f0-9]+))|(?:[gmu](\d+))/;t.decodeDiff=h,t.decodeAttrName=p,t.encodeAttrName=f,t.isXMLAttrName=m,t.getOriginalAttributes=v;var k=0;t.newGenericID=g,t.anySpecialKeyHeld=y,t.seleniumLog=b,t.stackTrace=_,t.convertPatternObj=E,t.readFile=x,t.fixPrototype=N,t.suppressUnhandledRejections=C}),define("wed/convert",["require","exports","./domtypeguards","./util"],function(e,t,r,n){"use strict";function o(e){return null===e&&(e=""),e}function i(e,t){var l;if(r.isElement(t)){l=e.createElement("div"),l.className=t.tagName+" _local_"+t.localName+" _xmlns_"+o(t.namespaceURI)+" _real";for(var u=0;u<t.attributes.length;++u){var c=t.attributes[u];l.setAttribute(n.encodeAttrName(c.name),c.value);var d=c.namespaceURI;null!==d&&d!==a&&d!==s&&l.setAttribute(n.encodeAttrName(c.name,"ns"),d)}for(var h=t.firstChild;null!==h;)l.appendChild(i(e,h)),h=h.nextSibling}else{if(!r.isText(t))throw new Error("unhandled node type: "+t.nodeType);l=document.createTextNode(t.data)}return l}Object.defineProperty(t,"__esModule",{value:!0});var a="http://www.w3.org/XML/1998/namespace",s="http://www.w3.org/2000/xmlns/";t.toHTMLTree=i}),define("wed/domutil",["require","exports","jquery","./domtypeguards","./util"],function(e,t,r,n,o){"use strict";function i(e,t){for(var r=e.length,n=0;n<r;++n)if(e[n]===t)return n;return-1}function a(e,t,r){for(var n=e.firstChild,o=0;null!==n&&!n.contains(r);)o++,n=n.nextSibling;return t-o<=0?-1:1}function s(e,t,r,n){if(e===r){var o=t-n;return 0===o?0:o<0?-1:1}var i=e.compareDocumentPosition(r);if(0!==(i&Node.DOCUMENT_POSITION_DISCONNECTED))throw new Error("cannot compare disconnected nodes");if(0!==(i&Node.DOCUMENT_POSITION_CONTAINED_BY))return a(e,t,r);if(0!==(i&Node.DOCUMENT_POSITION_CONTAINS))return a(r,n,e)<0?1:-1;if(0!==(i&Node.DOCUMENT_POSITION_PRECEDING))return 1;if(0!==(i&Node.DOCUMENT_POSITION_FOLLOWING))return-1;throw new Error("neither preceding nor following: this should not happen")}function l(e){var t=window.getSelection();if(!(void 0===t||t.rangeCount<1))return t.getRangeAt(0)}function u(e,t,r,n){var o=e.ownerDocument.createRange(),i=!1;return s(e,t,r,n)<=0?(o.setStart(e,t),o.setEnd(r,n)):(o.setStart(r,n),o.setEnd(e,t),i=!0),{range:o,reversed:i}}function c(e){var t=null!=e?e.nodeType:void 0;switch(t){case Node.TEXT_NODE:if(null==e.parentNode)throw new Error("detached node");e.parentNode.focus();break;case Node.ELEMENT_NODE:e.focus();break;default:throw new Error("tried to focus something other than a text node or an element.")}}function d(e,t,r){var o=e[0],a=e[1],s=!1;if(!t.contains(o))return null;var l,u=n.isDocument(o)?o:o.ownerDocument,c=u.defaultView;e:for(;!s;)switch(l=o.parentNode,o.nodeType){case Node.TEXT_NODE:if(a>=o.length||null!=l&&l.lastChild===o&&"normal"===c.getComputedStyle(l,void 0).whiteSpace&&/^\s+$/.test(o.data.slice(a))){if(null==l||o===t)break e;a=i(l.childNodes,o)+1,o=l}else a++,s=!0;break;case Node.ELEMENT_NODE:if(a>=o.childNodes.length){if(null==l||o===t)break e;a=i(l.childNodes,o)+1,o=l,s=!0}else o=o.childNodes[a],a=0,s=!(o.childNodes.length>0&&n.isText(o.childNodes[a]))}if(!s)return null;if(r&&n.isText(o)){if(l=o.parentNode,null==l)throw new Error("detached node");a=i(l.childNodes,o),o=l}return!t.contains(o)||o===t&&a>=o.childNodes.length?null:[o,a]}function h(e,t,r){var o=e[0],a=e[1],s=!1;if(!t.contains(o))return null;var l,u=n.isDocument(o)?o:o.ownerDocument,c=u.defaultView;e:for(;!s;){if(a--,o===t&&a<0)return null;switch(l=o.parentNode,o.nodeType){case Node.TEXT_NODE:if(a<0||null!=l&&l.firstChild===o&&"normal"===c.getComputedStyle(l,void 0).whiteSpace&&/^\s+$/.test(o.data.slice(0,a))){if(null===l||o===t)break e;a=i(l.childNodes,o),o=l}else s=!0;break;case Node.ELEMENT_NODE:if(a<0||0===o.childNodes.length){if(null==l||o===t)break e;a=i(l.childNodes,o),o=l,s=!0}else o=o.childNodes[a],n.isElement(o)?(a=o.childNodes.length,s=!(o.childNodes.length>0&&n.isText(o.childNodes[a-1]))):a=o.length+1}}if(!s)return null;if(r&&n.isText(o)){if(l=o.parentNode,null==l)throw new Error("detached node");a=i(l.childNodes,o),o=l}return!t.contains(o)||o===t&&a<0?null:[o,a]}function p(e,t,r){for(var n=[],o=r;o!==e;){var a=o.parentNode;if(null==a)throw new Error("nodeInA is not treeA or a child of treeA");n.unshift(i(a.childNodes,o)),o=a}for(var s=t;0!==n.length;)s=s.childNodes[n.shift()];return s}function f(e){var t=document.createElement("span");return t.className="_placeholder",t.setAttribute("contenteditable","true"),t.textContent=void 0!==e?e:" ",t}function m(e,t,r,o){if(void 0===o&&(o=!0),!n.isText(e))throw new Error("insertIntoText called on non-text");var a,s;void 0===o&&(o=!0),t<0?t=0:t>e.length&&(t=e.length);var l,u,c=n.isDocumentFragment(r),d=e.parentNode;if(null==d)throw new Error("detached node");var h=i(d.childNodes,e);if(o&&(null==r||c&&0===r.childNodes.length))a=s=[e,t];else{var p=document.createDocumentFragment();l=document.createTextNode(e.data.slice(0,t)),p.appendChild(l),null!=r&&p.appendChild(r),u=document.createTextNode(e.data.slice(t));var f=u.length;if(p.appendChild(u),o&&p.normalize(),a=o&&0===t?[d,h]:[p.firstChild,t],s=o&&t===e.length?[d,h+p.childNodes.length]:[p.lastChild,p.lastChild.length-f],this.deleteNode(e),void 0!==this.insertFragAt)this.insertFragAt(d,h,p);else for(;null!=p.firstChild;)this.insertNodeAt(d,h++,p.firstChild)}return[a,s]}function v(e,t,r){if(null==r)throw new Error("must pass an actual node to insert");return m.call(this,e,t,r)}function g(e,t,r,o){if(void 0===o&&(o=!0),""===r)return{node:void 0,isNew:!1,caret:[e,t]};var i,a,s=!1;e:for(;;)switch(e.nodeType){case Node.ELEMENT_NODE:var l=e.childNodes[t];if(n.isText(l)){e=l,t=0;continue e}var u=e.childNodes[t-1];if(n.isText(u)){e=u,t=u.length;continue e}i=document.createTextNode(r),s=!0,this.insertNodeAt(e,t,i),a=[i,o?r.length:0];break e;case Node.TEXT_NODE:i=e;var c=i.data.slice(0,t),d=i.data.slice(t);this.setTextNodeValue(i,c+r+d),a=[i,o?t+r.length:t];break e;default:throw new Error("unexpected node type: "+e.nodeType)}return{node:i,isNew:s,caret:a}}function y(e,t,r){if(!n.isText(e))throw new Error("deleteText called on non-text");if(e.deleteData(t,r),0===e.length){if(null==e.parentNode)throw new Error("detached node");e.parentNode.removeChild(e)}}function b(e,t){r.data(e,"wed_mirror_node",t),r.data(t,"wed_mirror_node",e);for(var n=0;n<e.children.length;++n){var o=e.children[n],i=t.children[n];b(o,i)}}function w(e){r.removeData(e,"wed_mirror_node");for(var t=0;t<e.children.length;++t)w(e.children[t])}function _(e){for(void 0===e&&(e=null);null!==e&&null!==e.firstChild;)e=e.firstChild;return e}function E(e){for(void 0===e&&(e=null);null!==e&&null!==e.lastChild;)e=e.lastChild;return e}function x(e){if(null==e.parentNode)throw new Error("detached node");e.parentNode.removeChild(e)}function N(e,t,r){var n=e.childNodes[t];e.insertBefore(r,null!=n?n:null)}function C(e,t,r,n){return g.call({insertNodeAt:N,setTextNodeValue:function(e,t){e.data=t}},e,t,r,n)}function S(e,t,r,n){return void 0===n&&(n=!0),m.call(Y,e,t,r,n)}function P(e,t,r){return v.call(Y,e,t,r)}function k(e,t){var r=S(e,t,void 0,!1);return[r[0][0],r[1][0]]}function T(e){var t=e.nextSibling;if(n.isText(e)&&n.isText(t)){var r=e.length;return e.appendData(t.data),t.parentNode.removeChild(t),[e,r]}var o=e.parentNode;if(null==o)throw new Error("detached node");return[o,i(o.childNodes,e)+1]}function A(e){var t;switch(e.startContainer.nodeType){case Node.TEXT_NODE:if(t=e.startContainer.parentNode,null==t)throw new Error("detached node");break;case Node.ELEMENT_NODE:t=e.startContainer;break;default:throw new Error("unexpected node type: "+e.startContainer.nodeType)}var r;switch(e.endContainer.nodeType){case Node.TEXT_NODE:if(r=e.endContainer.parentNode,null==r)throw new Error("detached node");break;case Node.ELEMENT_NODE:r=e.endContainer;break;default:throw new Error("unexpected node type: "+e.endContainer.nodeType)}return[t,r]}function O(e){var t=A(e);return t[0]===t[1]}function R(e,t){if(!O({startContainer:e[0],startOffset:e[1],endContainer:t[0],endOffset:t[1]}))throw new Error("range is not well-formed");var r=e[0],o=e[1],a=t[0],s=t[1],l=r.parentNode;if(null==l)throw new Error("detached node");var u,c;if(n.isText(r)&&0===o&&(o=i(l.childNodes,r),r=l,l=r.parentNode,null==l))throw new Error("detached node");if(n.isText(r)){var d=r===a,h=i(l.childNodes,r),p=d?s:r.length;if(c=l.ownerDocument.createTextNode(r.data.slice(o,p)),this.deleteText(r,o,c.length),u=null!=r.parentNode?[r,o]:[l,h],d)return[u,[c]];o=null!=r.parentNode?h+1:h,r=l}else u=[r,o];var f;if(n.isText(a)){if(l=a.parentNode,null==l)throw new Error("detached node");var m=i(l.childNodes,a);f=l.ownerDocument.createTextNode(a.data.slice(0,s)),this.deleteText(a,0,s),s=m,a=l}if(r!==a)throw new Error("internal error in cut: containers unequal");if(!n.isElement(r))throw new Error("internal error in cut: not an element");var v=[];for(s--;s>=o;)v.unshift(a.childNodes[s]),this.deleteNode(a.childNodes[s]),s--;return null!=c&&v.unshift(c),null!=f&&v.push(f),null!=a.childNodes[s]&&this.mergeTextNodes(a.childNodes[s]),[u,v]}function I(e,t){null==t?console.log(e,"no range"):console.log(e,t.startContainer,t.startOffset,t.endContainer,t.endOffset)}function D(e,t){I(e,l(t))}function M(e,t){var r;return r=null==t?[e,"no range"]:[e,t.startContainer.outerHTML,t.startOffset,t.endContainer.outerHTML,t.endOffset],r.join(", ")}function L(e,t,r){var n=e.ownerDocument.body,o=e.getBoundingClientRect();return t-=o.left+n.scrollLeft,r-=o.top+n.scrollTop,t>=0&&r>=0&&t<e.clientWidth&&r<e.clientHeight}function j(e,t,r){if(null==e)return null;for(n.isText(e)&&(e=e.parentNode);null!=e;){if(!n.isElement(e))return null;if(e.matches(t))break;if(e===r){e=null;break}e=e.parentNode}return e}function F(e,t,r){if(null==e)return null;for(n.isText(e)&&(e=e.parentNode);null!=e;){if(!n.isElement(e))return null;if(e.classList.contains(t))break;if(e===r){e=null;break}e=e.parentNode}return e}function B(e,t){if(!n.isElement(e))return null;var r=e.parentNode;if(null==r)return null;for(var o=r.firstElementChild;null!=o&&!o.classList.contains(t);)o=o.nextElementSibling;return o}function H(e,t){if(!n.isElement(e))return[];for(var r=[],o=e.firstElementChild;null!=o;)o.classList.contains(t)&&r.push(o),o=o.nextElementSibling;return r}function $(e,t){if(!n.isElement(e))return null;for(var r=e.firstElementChild;null!=r&&!r.classList.contains(t);)r=r.nextElementSibling;return r}function U(e){return null==Z&&(Z=document.createElement("span")),Z.textContent=e,Z.innerHTML}function V(e,t){if(/[\]['"()]/.test(e))throw new Error("selector is too complex");if(/\\:/.test(e))throw new Error("we do not accept escaped colons for now");for(var r=e.split(ee),n=[],i=0,a=r;i<a.length;i++){var s=a[i];if(0!==s.length)if(J.indexOf(s)>-1)n.push(s);else if(/[a-zA-Z]/.test(s[0])){s=s.trim();var l=s.split(/(.#)/);n.push(o.classFromOriginalName(l[0],t)),n=n.concat(l.slice(1))}else n.push(s)}return n.join("")}function W(e,t,n){var o=V(t,n),i=r.data(e,"wed_mirror_node"),a=i.querySelector(o);if(null==a)return null;var s=r.data(a,"wed_mirror_node");return null!=s?s:null}function q(e,t,n){for(var o=V(t,n),i=r.data(e,"wed_mirror_node"),a=i.querySelectorAll(o),s=[],l=0;l<a.length;++l)s.push(r.data(a[l],"wed_mirror_node"));return s}function z(e,t){var r=null!=t?t:window.document,n=r.createDocumentFragment(),o=r.createElement("div");n.appendChild(o),o.innerHTML=e;for(var i=Array.prototype.slice.call(o.childNodes);null!==o.firstChild;)o.removeChild(o.firstChild);return i}function K(e){var t=e[0],r=e[1];switch(t.nodeType){case Node.TEXT_NODE:var o=t.data;return o[r-1];case Node.ELEMENT_NODE:var i=t.childNodes[r-1];if(n.isText(i))return i.data[i.data.length-1];break;default:throw new Error("unexpected node type: "+t.nodeType)}}function G(e){var t=e[0],r=e[1];switch(t.nodeType){case Node.TEXT_NODE:var o=t.data;return o[r];case Node.ELEMENT_NODE:var i=t.childNodes[r];if(n.isText(i))return i.data[0];break;default:throw new Error("unexpected node type: "+t.nodeType)}}function X(e,t){for(var r=e.ownerDocument.defaultView;null!=e&&e!==t;){if("none"===e.style.display)return!0;var n=r.getComputedStyle(e).getPropertyValue("display");if("none"===n)return!0;e=e.parentNode}return!1}function Q(e,t){return n.isAttr(t)&&(t=t.ownerElement),e.contains(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.isAttr=n.isAttr,t.indexOf=i,t.comparePositions=s,t.getSelectionRange=l,t.rangeFromPoints=u,t.focusNode=c,t.nextCaretPosition=d,t.prevCaretPosition=h,t.correspondingNode=p,t.makePlaceholder=f,t.genericInsertIntoText=v,t.genericInsertText=g,t.deleteText=y,t.linkTrees=b,t.unlinkTree=w,t.firstDescendantOrSelf=_,t.lastDescendantOrSelf=E,t.deleteNode=x,t.insertText=C;var Y={insertNodeAt:N,insertFragAt:N,deleteNode:x};t.insertIntoText=P,t.splitTextNode=k,t.mergeTextNodes=T,t.isWellFormedRange=O,t.genericCutFunction=R,t.dumpRange=I,t.dumpCurrentSelection=D,t.dumpRangeToString=M,t.pointInContents=L,t.closest=j,t.closestByClass=F,t.siblingByClass=B,t.childrenByClass=H,t.childByClass=$;var Z;t.textToHTML=U;var J=",>+~ ",ee=new RegExp("(["+J+"]+)");t.toGUISelector=V,t.dataFind=W,t.dataFindAll=q,t.htmlToElements=z,t.getCharacterImmediatelyBefore=K,t.getCharacterImmediatelyAt=G,t.isNotDisplayed=X,t.contains=Q}),!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("ajv",[],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Ajv=e()}(function(){return function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[a]={exports:{}};t[a][0].call(c.exports,function(e){var r=t[a][1][e];return o(r||e)},c,c.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){"use strict";var n=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];t.exports=function(e,t){for(var r=0;r<t.length;r++){e=JSON.parse(JSON.stringify(e));var o,i=t[r].split("/"),a=e;for(o=1;o<i.length;o++)a=a[i[o]];for(o=0;o<n.length;o++){var s=n[o],l=a[s];l&&(a[s]={anyOf:[l,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/$data.json#"}]})}}return e}},{}],2:[function(e,t,r){"use strict";var n=t.exports=function(){this._cache={}};n.prototype.put=function(e,t){this._cache[e]=t},n.prototype.get=function(e){return this._cache[e]},n.prototype.del=function(e){delete this._cache[e]},n.prototype.clear=function(){this._cache={}}},{}],3:[function(e,t,r){"use strict";t.exports={$ref:e("../dotjs/ref"),allOf:e("../dotjs/allOf"),anyOf:e("../dotjs/anyOf"),const:e("../dotjs/const"),contains:e("../dotjs/contains"),dependencies:e("../dotjs/dependencies"),enum:e("../dotjs/enum"),format:e("../dotjs/format"),items:e("../dotjs/items"),maximum:e("../dotjs/_limit"),minimum:e("../dotjs/_limit"),maxItems:e("../dotjs/_limitItems"),minItems:e("../dotjs/_limitItems"),maxLength:e("../dotjs/_limitLength"),minLength:e("../dotjs/_limitLength"),maxProperties:e("../dotjs/_limitProperties"),minProperties:e("../dotjs/_limitProperties"),multipleOf:e("../dotjs/multipleOf"),not:e("../dotjs/not"),oneOf:e("../dotjs/oneOf"),pattern:e("../dotjs/pattern"),properties:e("../dotjs/properties"),propertyNames:e("../dotjs/propertyNames"),required:e("../dotjs/required"),uniqueItems:e("../dotjs/uniqueItems"),validate:e("../dotjs/validate")}},{"../dotjs/_limit":14,"../dotjs/_limitItems":15,"../dotjs/_limitLength":16,"../dotjs/_limitProperties":17,"../dotjs/allOf":18,"../dotjs/anyOf":19,"../dotjs/const":20,"../dotjs/contains":21,"../dotjs/dependencies":23,"../dotjs/enum":24,"../dotjs/format":25,"../dotjs/items":26,"../dotjs/multipleOf":27,"../dotjs/not":28,"../dotjs/oneOf":29,"../dotjs/pattern":30,"../dotjs/properties":31,"../dotjs/propertyNames":32,"../dotjs/ref":33,"../dotjs/required":34,"../dotjs/uniqueItems":35,"../dotjs/validate":36}],4:[function(e,t,r){"use strict";function n(e,t,r){function i(e){var t=e.$schema;return t&&!s.getSchema(t)?n.call(s,{$ref:t},!0):Promise.resolve()}function a(e){try{return s._compile(e)}catch(r){if(r instanceof o)return function(r){function n(){delete s._loadingSchemas[l]}function o(e){return s._refs[e]||s._schemas[e]}var l=r.missingSchema;if(o(l))throw new Error("Schema "+l+" is loaded but "+r.missingRef+" cannot be resolved");var u=s._loadingSchemas[l];return u||(u=s._loadingSchemas[l]=s._opts.loadSchema(l)).then(n,n),u.then(function(e){if(!o(l))return i(e).then(function(){o(l)||s.addSchema(e,l,void 0,t)})}).then(function(){return a(e)})}(r);throw r}}var s=this;if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");"function"==typeof t&&(r=t,t=void 0);var l=i(e).then(function(){var r=s._addSchema(e,void 0,t);return r.validate||a(r)});return r&&l.then(function(e){r(null,e)},r),l}var o=e("./error_classes").MissingRef;t.exports=n},{"./error_classes":6}],5:[function(e,t,r){"use strict";t.exports=function e(t,r){if(t===r)return!0;var n,o=Array.isArray(t),i=Array.isArray(r);if(o&&i){if(t.length!=r.length)return!1;for(n=0;n<t.length;n++)if(!e(t[n],r[n]))return!1;return!0}if(o!=i)return!1;if(t&&r&&"object"==typeof t&&"object"==typeof r){var a=Object.keys(t);if(a.length!==Object.keys(r).length)return!1;var s=t instanceof Date,l=r instanceof Date;if(s&&l)return t.getTime()==r.getTime();if(s!=l)return!1;var u=t instanceof RegExp,c=r instanceof RegExp;if(u&&c)return t.toString()==r.toString();if(u!=c)return!1;for(n=0;n<a.length;n++)if(!Object.prototype.hasOwnProperty.call(r,a[n]))return!1;for(n=0;n<a.length;n++)if(!e(t[a[n]],r[a[n]]))return!1;return!0}return!1}},{}],6:[function(e,t,r){"use strict";function n(e){this.message="validation failed",this.errors=e,this.ajv=this.validation=!0}function o(e,t,r){this.message=r||o.message(e,t),this.missingRef=a.url(e,t),this.missingSchema=a.normalizeId(a.fullPath(this.missingRef))}function i(e){return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var a=e("./resolve");t.exports={Validation:i(n),MissingRef:i(o)},o.message=function(e,t){return"can't resolve reference "+t+" from id "+e}},{"./resolve":9}],7:[function(e,t,r){"use strict";function n(e){return e="full"==e?"full":"fast",c.copy(n[e])}function o(e){var t=e.match(d);if(!t)return!1;var r=+t[1],n=+t[2];return r>=1&&r<=12&&n>=1&&n<=h[r]}function i(e,t){var r=e.match(p);if(!r)return!1;var n=r[1],o=r[2],i=r[3],a=r[5];return n<=23&&o<=59&&i<=59&&(!t||a)}function a(e){var t=e.split(E);return 2==t.length&&o(t[0])&&i(t[1],!0)}function s(e){return e.length<=255&&f.test(e)}function l(e){return x.test(e)&&m.test(e)}function u(e){if(N.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}}var c=e("./util"),d=/^\d\d\d\d-(\d\d)-(\d\d)$/,h=[0,31,29,31,30,31,30,31,31,30,31,30,31],p=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d:\d\d)?$/i,f=/^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i,m=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?(?:\#(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?$/i,v=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@\/?]|%[0-9a-f]{2})*)?(?:\#(?:[a-z0-9\-._~!$&'"()*+,;=:@\/?]|%[0-9a-f]{2})*)?$/i,g=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#.\/;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\:[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\:[1-9][0-9]{0,3}|\*)?)*\})*$/i,y=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+\-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+\-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,b=/^(?:urn\:uuid\:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,w=/^(?:\/(?:[^~\/]|~0|~1)*)*$|^\#(?:\/(?:[a-z0-9_\-\.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,_=/^(?:0|[1-9][0-9]*)(?:\#|(?:\/(?:[^~\/]|~0|~1)*)*)$/;
t.exports=n,n.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^[0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s][0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i,uri:/^(?:[a-z][a-z0-9+-.]*)(?:\:|\/)\/?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+-.]*:)?\/\/)?[^\s]*$/i,"uri-template":g,url:y,email:/^[a-z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:f,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:u,uuid:b,"json-pointer":w,"relative-json-pointer":_},n.full={date:o,time:i,"date-time":a,uri:l,"uri-reference":v,"uri-template":g,url:y,email:/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&''*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:s,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:u,uuid:b,"json-pointer":w,"relative-json-pointer":_};var E=/t|\s/i,x=/\/|\:/,N=/[^\\]\\Z/},{"./util":13}],8:[function(e,t,r){"use strict";function n(e,t,r,a){function _(){var e=H.validate,t=e.apply(null,arguments);return _.errors=e.errors,t}function E(e,r,o,i){var a=!r||r&&r.schema==e;if(r.schema!=t.schema)return n.call(A,e,r,o,i);var m=!0===e.$async,_=v({isTop:!0,schema:e,isRoot:a,baseId:i,root:r,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:f.MissingRef,RULES:U,validate:v,util:p,resolve:h,resolveRef:x,usePattern:P,useDefault:k,useCustomRule:T,opts:O,formats:$,self:A});_=d(R,u)+d(D,s)+d(L,l)+d(F,c)+_,O.processCode&&(_=O.processCode(_));var E;try{E=new Function("self","RULES","formats","root","refVal","defaults","customRules","co","equal","ucs2length","ValidationError",_)(A,U,$,t,R,L,F,g,b,y,w),R[0]=E}catch(e){throw console.error("Error compiling schema, function code:",_),e}return E.schema=e,E.errors=null,E.refs=I,E.refVal=R,E.root=a?E:r,m&&(E.$async=!0),!0===O.sourceCode&&(E.source={code:_,patterns:D,defaults:L}),E}function x(e,o,i){o=h.url(e,o);var a,s,l=I[o];if(void 0!==l)return a=R[l],s="refVal["+l+"]",S(a,s);if(!i&&t.refs){var u=t.refs[o];if(void 0!==u)return a=t.refVal[u],s=N(o,a),S(a,s)}s=N(o);var c=h.call(A,E,t,o);if(void 0===c){var d=r&&r[o];d&&(c=h.inlineRef(d,O.inlineRefs)?d:n.call(A,d,t,r,e))}return void 0!==c?(C(o,c),S(c,s)):void 0}function N(e,t){var r=R.length;return R[r]=t,I[e]=r,"refVal"+r}function C(e,t){R[I[e]]=t}function S(e,t){return"object"==typeof e||"boolean"==typeof e?{code:t,schema:e,inline:!0}:{code:t,$async:e&&e.$async}}function P(e){var t=M[e];return void 0===t&&(t=M[e]=D.length,D[t]=e),"pattern"+t}function k(e){switch(typeof e){case"boolean":case"number":return""+e;case"string":return p.toQuotedString(e);case"object":if(null===e)return"null";var t=m(e),r=j[t];return void 0===r&&(r=j[t]=L.length,L[r]=e),"default"+r}}function T(e,t,r,n){var o=e.definition.validateSchema;if(o&&!1!==A._opts.validateSchema&&!o(t)){var i="keyword schema is invalid: "+A.errorsText(o.errors);if("log"!=A._opts.validateSchema)throw new Error(i);console.error(i)}var a,s=e.definition.compile,l=e.definition.inline,u=e.definition.macro;if(s)a=s.call(A,t,r,n);else if(u)a=u.call(A,t,r,n),!1!==O.validateSchema&&A.validateSchema(a,!0);else if(l)a=l.call(A,n,e.keyword,t,r);else if(!(a=e.definition.validate))return;if(void 0===a)throw new Error('custom keyword "'+e.keyword+'"failed to compile');var c=F.length;return F[c]=a,{code:"customRule"+c,validate:a}}var A=this,O=this._opts,R=[void 0],I={},D=[],M={},L=[],j={},F=[];t=t||{schema:e,refVal:R,refs:I};var B=o.call(this,e,t,a),H=this._compilations[B.index];if(B.compiling)return H.callValidate=_;var $=this._formats,U=this.RULES;try{var V=E(e,t,r,a);H.validate=V;var W=H.callValidate;return W&&(W.schema=V.schema,W.errors=null,W.refs=V.refs,W.refVal=V.refVal,W.root=V.root,W.$async=V.$async,O.sourceCode&&(W.source=V.source)),V}finally{i.call(this,e,t,a)}}function o(e,t,r){var n=a.call(this,e,t,r);return n>=0?{index:n,compiling:!0}:(n=this._compilations.length,this._compilations[n]={schema:e,root:t,baseId:r},{index:n,compiling:!1})}function i(e,t,r){var n=a.call(this,e,t,r);n>=0&&this._compilations.splice(n,1)}function a(e,t,r){for(var n=0;n<this._compilations.length;n++){var o=this._compilations[n];if(o.schema==e&&o.root==t&&o.baseId==r)return n}return-1}function s(e,t){return"var pattern"+e+" = new RegExp("+p.toQuotedString(t[e])+");"}function l(e){return"var default"+e+" = defaults["+e+"];"}function u(e,t){return void 0===t[e]?"":"var refVal"+e+" = refVal["+e+"];"}function c(e){return"var customRule"+e+" = customRules["+e+"];"}function d(e,t){if(!e.length)return"";for(var r="",n=0;n<e.length;n++)r+=t(n,e);return r}var h=e("./resolve"),p=e("./util"),f=e("./error_classes"),m=e("json-stable-stringify"),v=e("../dotjs/validate"),g=e("co"),y=p.ucs2length,b=e("./equal"),w=f.Validation;t.exports=n},{"../dotjs/validate":36,"./equal":5,"./error_classes":6,"./resolve":9,"./util":13,co:47,"json-stable-stringify":48}],9:[function(e,t,r){"use strict";function n(e,t,r){var i=this._refs[r];if("string"==typeof i){if(!this._refs[i])return n.call(this,e,t,i);i=this._refs[i]}if((i=i||this._schemas[r])instanceof y)return s(i.schema,this._opts.inlineRefs)?i.schema:i.validate||this._compile(i);var a,l,u,c=o.call(this,t,r);return c&&(a=c.schema,t=c.root,u=c.baseId),a instanceof y?l=a.validate||e.call(this,a.schema,t,void 0,u):void 0!==a&&(l=s(a,this._opts.inlineRefs)?a:e.call(this,a,t,void 0,u)),l}function o(e,t){var r=m.parse(t,!1,!0),n=d(r),o=c(this._getId(e.schema));if(n!==o){var s=h(n),l=this._refs[s];if("string"==typeof l)return i.call(this,e,l,r);if(l instanceof y)l.validate||this._compile(l),e=l;else{if(!((l=this._schemas[s])instanceof y))return;if(l.validate||this._compile(l),s==h(t))return{schema:l,root:e,baseId:o};e=l}if(!e.schema)return;o=c(this._getId(e.schema))}return a.call(this,r,o,e.schema,e)}function i(e,t,r){var n=o.call(this,e,t);if(n){var i=n.schema,s=n.baseId;e=n.root;var l=this._getId(i);return l&&(s=p(s,l)),a.call(this,r,s,i,e)}}function a(e,t,r,n){if("#/"==(e.hash=e.hash||"").slice(0,2)){for(var i=e.hash.split("/"),a=1;a<i.length;a++){var s=i[a];if(s){if(s=g.unescapeFragment(s),void 0===(r=r[s]))break;var l;if(!b[s]&&((l=this._getId(r))&&(t=p(t,l)),r.$ref)){var u=p(t,r.$ref),c=o.call(this,n,u);c&&(r=c.schema,n=c.root,t=c.baseId)}}}return void 0!==r&&r!==n.schema?{schema:r,root:n,baseId:t}:void 0}}function s(e,t){return!1!==t&&(void 0===t||!0===t?l(e):t?u(e)<=t:void 0)}function l(e){var t;if(Array.isArray(e)){for(var r=0;r<e.length;r++)if("object"==typeof(t=e[r])&&!l(t))return!1}else for(var n in e){if("$ref"==n)return!1;if("object"==typeof(t=e[n])&&!l(t))return!1}return!0}function u(e){var t,r=0;if(Array.isArray(e)){for(var n=0;n<e.length;n++)if("object"==typeof(t=e[n])&&(r+=u(t)),r==1/0)return 1/0}else for(var o in e){if("$ref"==o)return 1/0;if(w[o])r++;else if("object"==typeof(t=e[o])&&(r+=u(t)+1),r==1/0)return 1/0}return r}function c(e,t){return!1!==t&&(e=h(e)),d(m.parse(e,!1,!0))}function d(e){var t=e.protocol||"//"==e.href.slice(0,2)?"//":"";return(e.protocol||"")+t+(e.host||"")+(e.path||"")+"#"}function h(e){return e?e.replace(_,""):""}function p(e,t){return t=h(t),m.resolve(e,t)}function f(e){function t(e,r,o){if(Array.isArray(e))for(var i=0;i<e.length;i++)t.call(this,e[i],r+"/"+i,o);else if(e&&"object"==typeof e){var a=this._getId(e);if("string"==typeof a){a=o=h(o?m.resolve(o,a):a);var s=this._refs[a];if("string"==typeof s&&(s=this._refs[s]),s&&s.schema){if(!v(e,s.schema))throw new Error('id "'+a+'" resolves to more than one schema')}else if(a!=h(r))if("#"==a[0]){if(n[a]&&!v(e,n[a]))throw new Error('id "'+a+'" resolves to more than one schema');n[a]=e}else this._refs[a]=r}for(var l in e)t.call(this,e[l],r+"/"+g.escapeFragment(l),o)}}var r=h(this._getId(e)),n={};return t.call(this,e,c(r,!1),r),n}var m=e("url"),v=e("./equal"),g=e("./util"),y=e("./schema_obj");t.exports=n,n.normalizeId=h,n.fullPath=c,n.url=p,n.ids=f,n.inlineRef=s,n.schema=o;var b=g.toHash(["properties","patternProperties","enum","dependencies","definitions"]),w=g.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]),_=/#\/?$/},{"./equal":5,"./schema_obj":11,"./util":13,url:45}],10:[function(e,t,r){"use strict";var n=e("./_rules"),o=e("./util").toHash;t.exports=function(){var e=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","uniqueItems","contains","items"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf"]}],t=["type"],r=["additionalItems","$schema","id","title","description","default","definitions"],i=["number","integer","string","array","object","boolean","null"];return e.all=o(t),e.types=o(i),e.forEach(function(r){r.rules=r.rules.map(function(r){var o;if("object"==typeof r){var i=Object.keys(r)[0];o=r[i],r=i,o.forEach(function(r){t.push(r),e.all[r]=!0})}return t.push(r),e.all[r]={keyword:r,code:n[r],implements:o}}),r.type&&(e.types[r.type]=r)}),e.keywords=o(t.concat(r)),e.custom={},e}},{"./_rules":3,"./util":13}],11:[function(e,t,r){"use strict";function n(e){o.copy(e,this)}var o=e("./util");t.exports=n},{"./util":13}],12:[function(e,t,r){"use strict";t.exports=function(e){for(var t,r=0,n=e.length,o=0;o<n;)r++,(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<n&&56320==(64512&(t=e.charCodeAt(o)))&&o++;return r}},{}],13:[function(e,t,r){"use strict";function n(e,t){t=t||{};for(var r in e)t[r]=e[r];return t}function o(e,t,r){var n=r?" !== ":" === ",o=r?" || ":" && ",i=r?"!":"",a=r?"":"!";switch(e){case"null":return t+n+"null";case"array":return i+"Array.isArray("+t+")";case"object":return"("+i+t+o+"typeof "+t+n+'"object"'+o+a+"Array.isArray("+t+"))";case"integer":return"(typeof "+t+n+'"number"'+o+a+"("+t+" % 1)"+o+t+n+t+")";default:return"typeof "+t+n+'"'+e+'"'}}function i(e,t){switch(e.length){case 1:return o(e[0],t,!0);default:var r="",n=s(e);n.array&&n.object&&(r=n.null?"(":"(!"+t+" || ",r+="typeof "+t+' !== "object")',delete n.null,delete n.array,delete n.object),n.number&&delete n.integer;for(var i in n)r+=(r?" && ":"")+o(i,t,!0);return r}}function a(e,t){if(Array.isArray(t)){for(var r=[],n=0;n<t.length;n++){var o=t[n];C[o]?r[r.length]=o:"array"===e&&"array"===o&&(r[r.length]=o)}if(r.length)return r}else{if(C[t])return[t];if("array"===e&&"array"===t)return["array"]}}function s(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;return t}function l(e){return"number"==typeof e?"["+e+"]":S.test(e)?"."+e:"['"+u(e)+"']"}function u(e){return e.replace(P,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function c(e,t){t+="[^0-9]";var r=e.match(new RegExp(t,"g"));return r?r.length:0}function d(e,t,r){return t+="([^0-9])",r=r.replace(/\$/g,"$$$$"),e.replace(new RegExp(t,"g"),r+"$1")}function h(e){return e.replace(k,"").replace(T,"").replace(A,"if (!($1))")}function p(e,t){var r=e.match(O);return r&&2==r.length&&(e=t?e.replace(I,"").replace(L,j):e.replace(R,"").replace(D,M)),r=e.match(F),r&&3===r.length?e.replace(B,""):e}function f(e,t){if("boolean"==typeof e)return!e;for(var r in e)if(t[r])return!0}function m(e,t,r){if("boolean"==typeof e)return!e&&"not"!=r;for(var n in e)if(n!=r&&t[n])return!0}function v(e){return"'"+u(e)+"'"}function g(e,t,r,n){return w(e,r?"'/' + "+t+(n?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):n?"'[' + "+t+" + ']'":"'[\\'' + "+t+" + '\\']'")}function y(e,t,r){return w(e,v(r?"/"+x(t):l(t)))}function b(e,t,r){var n,o,i,a;if(""===e)return"rootData";if("/"==e[0]){if(!H.test(e))throw new Error("Invalid JSON-pointer: "+e);o=e,i="rootData"}else{if(!(a=e.match($)))throw new Error("Invalid JSON-pointer: "+e);if(n=+a[1],"#"==(o=a[2])){if(n>=t)throw new Error("Cannot access property/index "+n+" levels up, current level is "+t);return r[t-n]}if(n>t)throw new Error("Cannot access data "+n+" levels up, current level is "+t);if(i="data"+(t-n||""),!o)return i}for(var s=i,u=o.split("/"),c=0;c<u.length;c++){var d=u[c];d&&(s+=" && "+(i+=l(N(d))))}return s}function w(e,t){return'""'==e?t:(e+" + "+t).replace(/' \+ '/g,"")}function _(e){return N(decodeURIComponent(e))}function E(e){return encodeURIComponent(x(e))}function x(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function N(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}t.exports={copy:n,checkDataType:o,checkDataTypes:i,coerceToTypes:a,toHash:s,getProperty:l,escapeQuotes:u,equal:e("./equal"),ucs2length:e("./ucs2length"),varOccurences:c,varReplace:d,cleanUpCode:h,finalCleanUpCode:p,schemaHasRules:f,schemaHasRulesExcept:m,toQuotedString:v,getPathExpr:g,getPath:y,getData:b,unescapeFragment:_,escapeFragment:E,escapeJsonPointer:x};var C=s(["string","number","integer","boolean","null"]),S=/^[a-z$_][a-z$_0-9]*$/i,P=/'|\\/g,k=/else\s*{\s*}/g,T=/if\s*\([^)]+\)\s*\{\s*\}(?!\s*else)/g,A=/if\s*\(([^)]+)\)\s*\{\s*\}\s*else(?!\s*if)/g,O=/[^v\.]errors/g,R=/var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g,I=/var errors = 0;|var vErrors = null;/g,D="return errors === 0;",M="validate.errors = null; return true;",L=/if \(errors === 0\) return data;\s*else throw new ValidationError\(vErrors\);/,j="return data;",F=/[^A-Za-z_$]rootData[^A-Za-z0-9_$]/g,B=/if \(rootData === undefined\) rootData = data;/,H=/^\/(?:[^~]|~0|~1)*$/,$=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/},{"./equal":5,"./ucs2length":12}],14:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,o=" ",i=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(a||""),h=e.opts.$data&&s&&s.$data;h?(o+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+i):n=s;var p="maximum"==t,f=p?"exclusiveMaximum":"exclusiveMinimum",m=e.schema[f],v=e.opts.$data&&m&&m.$data,g=p?"<":">",y=p?">":"<",b=void 0;if(v){var w=e.util.getData(m.$data,a,e.dataPathArr),_="exclusive"+i,E="exclType"+i,x="exclIsNumber"+i,N="' + "+(C="op"+i)+" + '";o+=" var schemaExcl"+i+" = "+w+"; ",o+=" var "+_+"; var "+E+" = typeof "+(w="schemaExcl"+i)+"; if ("+E+" != 'boolean' && "+E+" != 'undefined' && "+E+" != 'number') { ",b=f,(S=S||[]).push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(b||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(o+=" , message: '"+f+" should be boolean' "),e.opts.verbose&&(o+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ",P=o,o=S.pop(),o+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+P+"]); ":" validate.errors = ["+P+"]; return false; ":" var err = "+P+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",o+=" } else if ( ",h&&(o+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),o+=" "+E+" == 'number' ? ( ("+_+" = "+n+" === undefined || "+w+" "+g+"= "+n+") ? "+d+" "+y+"= "+w+" : "+d+" "+y+" "+n+" ) : ( ("+_+" = "+w+" === true) ? "+d+" "+y+"= "+n+" : "+d+" "+y+" "+n+" ) || "+d+" !== "+d+") { var op"+i+" = "+_+" ? '"+g+"' : '"+g+"=';"}else if(N=g,(x="number"==typeof m)&&h)C="'"+N+"'",o+=" if ( ",h&&(o+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),o+=" ( "+n+" === undefined || "+m+" "+g+"= "+n+" ? "+d+" "+y+"= "+m+" : "+d+" "+y+" "+n+" ) || "+d+" !== "+d+") { ";else{x&&void 0===s?(_=!0,b=f,u=e.errSchemaPath+"/"+f,n=m,y+="="):(x&&(n=Math[p?"min":"max"](m,s)),m===(!x||n)?(_=!0,b=f,u=e.errSchemaPath+"/"+f,y+="="):(_=!1,N+="="));var C="'"+N+"'";o+=" if ( ",h&&(o+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),o+=" "+d+" "+y+" "+n+" || "+d+" !== "+d+") { "}b=b||t;var S=S||[];S.push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(b||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { comparison: "+C+", limit: "+n+", exclusive: "+_+" } ",!1!==e.opts.messages&&(o+=" , message: 'should be "+N+" ",o+=h?"' + "+n:n+"'"),e.opts.verbose&&(o+=" , schema:  ",o+=h?"validate.schema"+l:""+s,o+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ";var P=o;return o=S.pop(),o+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+P+"]); ":" validate.errors = ["+P+"]; return false; ":" var err = "+P+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",o+=" } ",c&&(o+=" else { "),o}},{}],15:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,o=" ",i=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(a||""),h=e.opts.$data&&s&&s.$data;h?(o+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+i):n=s;var p="maxItems"==t?">":"<";o+="if ( ",h&&(o+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),o+=" "+d+".length "+p+" "+n+") { ";var f=t,m=m||[];m.push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(f||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(o+=" , message: 'should NOT have ",o+="maxItems"==t?"more":"less",o+=" than ",o+=h?"' + "+n+" + '":""+s,o+=" items' "),e.opts.verbose&&(o+=" , schema:  ",o+=h?"validate.schema"+l:""+s,o+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ";var v=o;return o=m.pop(),o+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",o+="} ",c&&(o+=" else { "),o}},{}],16:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,o=" ",i=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(a||""),h=e.opts.$data&&s&&s.$data;h?(o+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+i):n=s;var p="maxLength"==t?">":"<";o+="if ( ",h&&(o+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),o+=!1===e.opts.unicode?" "+d+".length ":" ucs2length("+d+") ",o+=" "+p+" "+n+") { ";var f=t,m=m||[];m.push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(f||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(o+=" , message: 'should NOT be ",o+="maxLength"==t?"longer":"shorter",o+=" than ",o+=h?"' + "+n+" + '":""+s,o+=" characters' "),e.opts.verbose&&(o+=" , schema:  ",o+=h?"validate.schema"+l:""+s,o+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ";var v=o;return o=m.pop(),o+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",o+="} ",c&&(o+=" else { "),o}},{}],17:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,o=" ",i=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(a||""),h=e.opts.$data&&s&&s.$data;h?(o+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+i):n=s;var p="maxProperties"==t?">":"<";o+="if ( ",h&&(o+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),o+=" Object.keys("+d+").length "+p+" "+n+") { ";var f=t,m=m||[];m.push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(f||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(o+=" , message: 'should NOT have ",o+="maxProperties"==t?"more":"less",o+=" than ",o+=h?"' + "+n+" + '":""+s,o+=" properties' "),e.opts.verbose&&(o+=" , schema:  ",o+=h?"validate.schema"+l:""+s,o+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ";var v=o;return o=m.pop(),o+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",o+="} ",c&&(o+=" else { "),o}},{}],18:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",o=e.schema[t],i=e.schemaPath+e.util.getProperty(t),a=e.errSchemaPath+"/"+t,s=!e.opts.allErrors,l=e.util.copy(e),u="",c="valid"+ ++l.level,d=l.baseId,h=!0,p=o;if(p)for(var f,m=-1,v=p.length-1;m<v;)f=p[m+=1],e.util.schemaHasRules(f,e.RULES.all)&&(h=!1,l.schema=f,l.schemaPath=i+"["+m+"]",l.errSchemaPath=a+"/"+m,n+="  "+e.validate(l)+" ",l.baseId=d,s&&(n+=" if ("+c+") { ",u+="}"));return s&&(n+=h?" if (true) { ":" "+u.slice(0,-1)+" "),n=e.util.cleanUpCode(n)}},{}],19:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(i||""),d="valid"+o,h="errs__"+o,p=e.util.copy(e),f="",m="valid"+ ++p.level;if(a.every(function(t){return e.util.schemaHasRules(t,e.RULES.all)})){var v=p.baseId;n+=" var "+h+" = errors; var "+d+" = false;  ";var g=e.compositeRule;e.compositeRule=p.compositeRule=!0;var y=a;if(y)for(var b,w=-1,_=y.length-1;w<_;)b=y[w+=1],p.schema=b,p.schemaPath=s+"["+w+"]",p.errSchemaPath=l+"/"+w,n+="  "+e.validate(p)+" ",p.baseId=v,n+=" "+d+" = "+d+" || "+m+"; if (!"+d+") { ",f+="}";e.compositeRule=p.compositeRule=g,n+=" "+f+" if (!"+d+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(n+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; "),n+=" } else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } ",e.opts.allErrors&&(n+=" } "),n=e.util.cleanUpCode(n)}else u&&(n+=" if (true) { ");return n}},{}],20:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(i||""),d="valid"+o,h=e.opts.$data&&a&&a.$data;h&&(n+=" var schema"+o+" = "+e.util.getData(a.$data,i,e.dataPathArr)+"; "),h||(n+=" var schema"+o+" = validate.schema"+s+";"),n+="var "+d+" = equal("+c+", schema"+o+"); if (!"+d+") {   ";var p=p||[];p.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should be equal to constant' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var f=n;return n=p.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }",u&&(n+=" else { "),n}},{}],21:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(i||""),d="valid"+o,h="errs__"+o,p=e.util.copy(e),f="valid"+ ++p.level,m="i"+o,v=p.dataLevel=e.dataLevel+1,g="data"+v,y=e.baseId,b=e.util.schemaHasRules(a,e.RULES.all);if(n+="var "+h+" = errors;var "+d+";",b){var w=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.schema=a,p.schemaPath=s,p.errSchemaPath=l,n+=" var "+f+" = false; for (var "+m+" = 0; "+m+" < "+c+".length; "+m+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers,!0);var _=c+"["+m+"]";p.dataPathArr[v]=m;var E=e.validate(p);p.baseId=y,n+=e.util.varOccurences(E,g)<2?" "+e.util.varReplace(E,g,_)+" ":" var "+g+" = "+_+"; "+E+" ",n+=" if ("+f+") break; }  ",e.compositeRule=p.compositeRule=w,n+="  if (!"+f+") {"}else n+=" if ("+c+".length == 0) {";var x=x||[];x.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should contain a valid item' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var N=n;return n=x.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+N+"]); ":" validate.errors = ["+N+"]; return false; ":" var err = "+N+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { ",b&&(n+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } "),e.opts.allErrors&&(n+=" } "),n=e.util.cleanUpCode(n)}},{}],22:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,o,i=" ",a=e.level,s=e.dataLevel,l=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),p="valid"+a,f="errs__"+a,m=e.opts.$data&&l&&l.$data;m?(i+=" var schema"+a+" = "+e.util.getData(l.$data,s,e.dataPathArr)+"; ",o="schema"+a):o=l;var v,g,y,b,w,_=this,E="definition"+a,x=_.definition,N="";if(m&&x.$data){w="keywordValidate"+a;var C=x.validateSchema;i+=" var "+E+" = RULES.custom['"+t+"'].definition; var "+w+" = "+E+".validate;"}else{if(!(b=e.useCustomRule(_,l,e.schema,e)))return;o="validate.schema"+u,w=b.code,v=x.compile,g=x.inline,y=x.macro}var S=w+".errors",P="i"+a,k="ruleErr"+a,T=x.async;if(T&&!e.async)throw new Error("async keyword in sync schema");if(g||y||(i+=S+" = null;"),i+="var "+f+" = errors;var "+p+";",m&&x.$data&&(N+="}",i+=" if ("+o+" === undefined) { "+p+" = true; } else { ",C&&(N+="}",i+=" "+p+" = "+E+".validateSchema("+o+"); if ("+p+") { ")),g)i+=x.statements?" "+b.validate+" ":" "+p+" = "+b.validate+"; ";else if(y){var A=e.util.copy(e),N="",O="valid"+ ++A.level;A.schema=b.validate,A.schemaPath="";var R=e.compositeRule;e.compositeRule=A.compositeRule=!0;var I=e.validate(A).replace(/validate\.schema/g,w);e.compositeRule=A.compositeRule=R,i+=" "+I}else{(j=j||[]).push(i),i="",i+="  "+w+".call( ",i+=e.opts.passContext?"this":"self",i+=v||!1===x.schema?" , "+h+" ":" , "+o+" , "+h+" , validate.schema"+e.schemaPath+" ",i+=" , (dataPath || '')",'""'!=e.errorPath&&(i+=" + "+e.errorPath);var D=s?"data"+(s-1||""):"parentData",M=s?e.dataPathArr[s]:"parentDataProperty",L=i+=" , "+D+" , "+M+" , rootData )  ";i=j.pop(),!1===x.errors?(i+=" "+p+" = ",T&&(i+=""+e.yieldAwait),i+=L+"; "):i+=T?" var "+(S="customErrors"+a)+" = null; try { "+p+" = "+e.yieldAwait+L+"; } catch (e) { "+p+" = false; if (e instanceof ValidationError) "+S+" = e.errors; else throw e; } ":" "+S+" = null; "+p+" = "+L+"; "}if(x.modifying&&(i+=" if ("+D+") "+h+" = "+D+"["+M+"];"),i+=""+N,x.valid)d&&(i+=" if (true) { ");else{i+=" if ( ",void 0===x.valid?(i+=" !",i+=y?""+O:""+p):i+=" "+!x.valid+" ",i+=") { ",n=_.keyword;var j=j||[];j.push(i),i="",(j=j||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(n||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+_.keyword+"' } ",!1!==e.opts.messages&&(i+=" , message: 'should pass \""+_.keyword+"\" keyword validation' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var F=i;i=j.pop();var B=i+=!e.compositeRule&&d?e.async?" throw new ValidationError(["+F+"]); ":" validate.errors = ["+F+"]; return false; ":" var err = "+F+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";i=j.pop(),g?x.errors?"full"!=x.errors&&(i+="  for (var "+P+"="+f+"; "+P+"<errors; "+P+"++) { var "+k+" = vErrors["+P+"]; if ("+k+".dataPath === undefined) "+k+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+k+".schemaPath === undefined) { "+k+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(i+=" "+k+".schema = "+o+"; "+k+".data = "+h+"; "),i+=" } "):!1===x.errors?i+=" "+B+" ":(i+=" if ("+f+" == errors) { "+B+" } else {  for (var "+P+"="+f+"; "+P+"<errors; "+P+"++) { var "+k+" = vErrors["+P+"]; if ("+k+".dataPath === undefined) "+k+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+k+".schemaPath === undefined) { "+k+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(i+=" "+k+".schema = "+o+"; "+k+".data = "+h+"; "),i+=" } } "):y?(i+="   var err =   ",!1!==e.createErrors?(i+=" { keyword: '"+(n||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+_.keyword+"' } ",!1!==e.opts.messages&&(i+=" , message: 'should pass \""+_.keyword+"\" keyword validation' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(i+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; ")):!1===x.errors?i+=" "+B+" ":(i+=" if (Array.isArray("+S+")) { if (vErrors === null) vErrors = "+S+"; else vErrors = vErrors.concat("+S+"); errors = vErrors.length;  for (var "+P+"="+f+"; "+P+"<errors; "+P+"++) { var "+k+" = vErrors["+P+"]; if ("+k+".dataPath === undefined) "+k+".dataPath = (dataPath || '') + "+e.errorPath+";  "+k+'.schemaPath = "'+c+'";  ',
e.opts.verbose&&(i+=" "+k+".schema = "+o+"; "+k+".data = "+h+"; "),i+=" } } else { "+B+" } "),i+=" } ",d&&(i+=" else { ")}return i}},{}],23:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(i||""),d="errs__"+o,h=e.util.copy(e),p="",f="valid"+ ++h.level,m={},v={},g=e.opts.ownProperties;for(_ in a){var y=a[_],b=Array.isArray(y)?v:m;b[_]=y}n+="var "+d+" = errors;";var w=e.errorPath;n+="var missing"+o+";";for(var _ in v)if((b=v[_]).length){if(n+=" if ( "+c+e.util.getProperty(_)+" !== undefined ",g&&(n+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(_)+"') "),u){n+=" && ( ";var E=b;if(E)for(var x=-1,N=E.length-1;x<N;)A=E[x+=1],x&&(n+=" || "),n+=" ( ( "+(D=c+(I=e.util.getProperty(A)))+" === undefined ",g&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(A)+"') "),n+=") && (missing"+o+" = "+e.util.toQuotedString(e.opts.jsonPointers?A:I)+") ) ";n+=")) {  ";var C="missing"+o,S="' + "+C+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(w,C,!0):w+" + "+C);var P=P||[];P.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(_)+"', missingProperty: '"+S+"', depsCount: "+b.length+", deps: '"+e.util.escapeQuotes(1==b.length?b[0]:b.join(", "))+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should have ",n+=1==b.length?"property "+e.util.escapeQuotes(b[0]):"properties "+e.util.escapeQuotes(b.join(", ")),n+=" when property "+e.util.escapeQuotes(_)+" is present' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var k=n;n=P.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+k+"]); ":" validate.errors = ["+k+"]; return false; ":" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{n+=" ) { ";var T=b;if(T)for(var A,O=-1,R=T.length-1;O<R;){A=T[O+=1];var I=e.util.getProperty(A),S=e.util.escapeQuotes(A),D=c+I;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(w,A,e.opts.jsonPointers)),n+=" if ( "+D+" === undefined ",g&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(A)+"') "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(_)+"', missingProperty: '"+S+"', depsCount: "+b.length+", deps: '"+e.util.escapeQuotes(1==b.length?b[0]:b.join(", "))+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should have ",n+=1==b.length?"property "+e.util.escapeQuotes(b[0]):"properties "+e.util.escapeQuotes(b.join(", ")),n+=" when property "+e.util.escapeQuotes(_)+" is present' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}n+=" }   ",u&&(p+="}",n+=" else { ")}e.errorPath=w;var M=h.baseId;for(var _ in m)y=m[_],e.util.schemaHasRules(y,e.RULES.all)&&(n+=" "+f+" = true; if ( "+c+e.util.getProperty(_)+" !== undefined ",g&&(n+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(_)+"') "),n+=") { ",h.schema=y,h.schemaPath=s+e.util.getProperty(_),h.errSchemaPath=l+"/"+e.util.escapeFragment(_),n+="  "+e.validate(h)+" ",h.baseId=M,n+=" }  ",u&&(n+=" if ("+f+") { ",p+="}"));return u&&(n+="   "+p+" if ("+d+" == errors) {"),n=e.util.cleanUpCode(n)}},{}],24:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(i||""),d="valid"+o,h=e.opts.$data&&a&&a.$data;h&&(n+=" var schema"+o+" = "+e.util.getData(a.$data,i,e.dataPathArr)+"; ");var p="i"+o,f="schema"+o;h||(n+=" var "+f+" = validate.schema"+s+";"),n+="var "+d+";",h&&(n+=" if (schema"+o+" === undefined) "+d+" = true; else if (!Array.isArray(schema"+o+")) "+d+" = false; else {"),n+=d+" = false;for (var "+p+"=0; "+p+"<"+f+".length; "+p+"++) if (equal("+c+", "+f+"["+p+"])) { "+d+" = true; break; }",h&&(n+="  }  "),n+=" if (!"+d+") {   ";var m=m||[];m.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValues: schema"+o+" } ",!1!==e.opts.messages&&(n+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var v=n;return n=m.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }",u&&(n+=" else { "),n}},{}],25:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(i||"");if(!1===e.opts.format)return u&&(n+=" if (true) { "),n;var d,h=e.opts.$data&&a&&a.$data;h?(n+=" var schema"+o+" = "+e.util.getData(a.$data,i,e.dataPathArr)+"; ",d="schema"+o):d=a;var p=e.opts.unknownFormats,f=Array.isArray(p);if(h)n+=" var "+(m="format"+o)+" = formats["+d+"]; var "+(v="isObject"+o)+" = typeof "+m+" == 'object' && !("+m+" instanceof RegExp) && "+m+".validate; var "+(g="formatType"+o)+" = "+v+" && "+m+".type || 'string'; if ("+v+") { ",e.async&&(n+=" var async"+o+" = "+m+".async; "),n+=" "+m+" = "+m+".validate; } if (  ",h&&(n+=" ("+d+" !== undefined && typeof "+d+" != 'string') || "),n+=" (","ignore"!=p&&(n+=" ("+d+" && !"+m+" ",f&&(n+=" && self._opts.unknownFormats.indexOf("+d+") == -1 "),n+=") || "),n+=" ("+m+" && "+g+" == '"+r+"' && !(typeof "+m+" == 'function' ? ",n+=e.async?" (async"+o+" ? "+e.yieldAwait+" "+m+"("+c+") : "+m+"("+c+")) ":" "+m+"("+c+") ",n+=" : "+m+".test("+c+"))))) {";else{var m=e.formats[a];if(!m){if("ignore"==p)return console.warn('unknown format "'+a+'" ignored in schema at path "'+e.errSchemaPath+'"'),u&&(n+=" if (true) { "),n;if(f&&p.indexOf(a)>=0)return u&&(n+=" if (true) { "),n;throw new Error('unknown format "'+a+'" is used in schema at path "'+e.errSchemaPath+'"')}var v="object"==typeof m&&!(m instanceof RegExp)&&m.validate,g=v&&m.type||"string";if(v){var y=!0===m.async;m=m.validate}if(g!=r)return u&&(n+=" if (true) { "),n;if(y){if(!e.async)throw new Error("async format in sync schema");b="formats"+e.util.getProperty(a)+".validate",n+=" if (!("+e.yieldAwait+" "+b+"("+c+"))) { "}else{n+=" if (! ";var b="formats"+e.util.getProperty(a);v&&(b+=".validate"),n+="function"==typeof m?" "+b+"("+c+") ":" "+b+".test("+c+") ",n+=") { "}}var w=w||[];w.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { format:  ",n+=h?""+d:""+e.util.toQuotedString(a),n+="  } ",!1!==e.opts.messages&&(n+=" , message: 'should match format \"",n+=h?"' + "+d+" + '":""+e.util.escapeQuotes(a),n+="\"' "),e.opts.verbose&&(n+=" , schema:  ",n+=h?"validate.schema"+s:""+e.util.toQuotedString(a),n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var _=n;return n=w.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+_+"]); ":" validate.errors = ["+_+"]; return false; ":" var err = "+_+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",u&&(n+=" else { "),n}},{}],26:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(i||""),d="valid"+o,h="errs__"+o,p=e.util.copy(e),f="",m="valid"+ ++p.level,v="i"+o,g=p.dataLevel=e.dataLevel+1,y="data"+g,b=e.baseId;if(n+="var "+h+" = errors;var "+d+";",Array.isArray(a)){var w=e.schema.additionalItems;if(!1===w){n+=" "+d+" = "+c+".length <= "+a.length+"; ";var _=l;l=e.errSchemaPath+"/additionalItems",n+="  if (!"+d+") {   ";var E=E||[];E.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+a.length+" } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have more than "+a.length+" items' "),e.opts.verbose&&(n+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var x=n;n=E.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+x+"]); ":" validate.errors = ["+x+"]; return false; ":" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",l=_,u&&(f+="}",n+=" else { ")}var N=a;if(N)for(var C,S=-1,P=N.length-1;S<P;)C=N[S+=1],e.util.schemaHasRules(C,e.RULES.all)&&(n+=" "+m+" = true; if ("+c+".length > "+S+") { ",k=c+"["+S+"]",p.schema=C,p.schemaPath=s+"["+S+"]",p.errSchemaPath=l+"/"+S,p.errorPath=e.util.getPathExpr(e.errorPath,S,e.opts.jsonPointers,!0),p.dataPathArr[g]=S,T=e.validate(p),p.baseId=b,n+=e.util.varOccurences(T,y)<2?" "+e.util.varReplace(T,y,k)+" ":" var "+y+" = "+k+"; "+T+" ",n+=" }  ",u&&(n+=" if ("+m+") { ",f+="}"));"object"==typeof w&&e.util.schemaHasRules(w,e.RULES.all)&&(p.schema=w,p.schemaPath=e.schemaPath+".additionalItems",p.errSchemaPath=e.errSchemaPath+"/additionalItems",n+=" "+m+" = true; if ("+c+".length > "+a.length+") {  for (var "+v+" = "+a.length+"; "+v+" < "+c+".length; "+v+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0),k=c+"["+v+"]",p.dataPathArr[g]=v,T=e.validate(p),p.baseId=b,n+=e.util.varOccurences(T,y)<2?" "+e.util.varReplace(T,y,k)+" ":" var "+y+" = "+k+"; "+T+" ",u&&(n+=" if (!"+m+") break; "),n+=" } }  ",u&&(n+=" if ("+m+") { ",f+="}"))}else if(e.util.schemaHasRules(a,e.RULES.all)){p.schema=a,p.schemaPath=s,p.errSchemaPath=l,n+="  for (var "+v+" = 0; "+v+" < "+c+".length; "+v+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0);var k=c+"["+v+"]";p.dataPathArr[g]=v;var T=e.validate(p);p.baseId=b,n+=e.util.varOccurences(T,y)<2?" "+e.util.varReplace(T,y,k)+" ":" var "+y+" = "+k+"; "+T+" ",u&&(n+=" if (!"+m+") break; "),n+=" }"}return u&&(n+=" "+f+" if ("+h+" == errors) {"),n=e.util.cleanUpCode(n)}},{}],27:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,o=" ",i=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(a||""),h=e.opts.$data&&s&&s.$data;h?(o+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+i):n=s,o+="var division"+i+";if (",h&&(o+=" "+n+" !== undefined && ( typeof "+n+" != 'number' || "),o+=" (division"+i+" = "+d+" / "+n+", ",o+=e.opts.multipleOfPrecision?" Math.abs(Math.round(division"+i+") - division"+i+") > 1e-"+e.opts.multipleOfPrecision+" ":" division"+i+" !== parseInt(division"+i+") ",o+=" ) ",h&&(o+="  )  "),o+=" ) {   ";var p=p||[];p.push(o),o="",!1!==e.createErrors?(o+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { multipleOf: "+n+" } ",!1!==e.opts.messages&&(o+=" , message: 'should be multiple of ",o+=h?"' + "+n:n+"'"),e.opts.verbose&&(o+=" , schema:  ",o+=h?"validate.schema"+l:""+s,o+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ";var f=o;return o=p.pop(),o+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",o+="} ",c&&(o+=" else { "),o}},{}],28:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(i||""),d="errs__"+o,h=e.util.copy(e),p="valid"+ ++h.level;if(e.util.schemaHasRules(a,e.RULES.all)){h.schema=a,h.schemaPath=s,h.errSchemaPath=l,n+=" var "+d+" = errors;  ";var f=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.createErrors=!1;var m;h.opts.allErrors&&(m=h.opts.allErrors,h.opts.allErrors=!1),n+=" "+e.validate(h)+" ",h.createErrors=!0,m&&(h.opts.allErrors=m),e.compositeRule=h.compositeRule=f,n+=" if ("+p+") {   ";var v=v||[];v.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should NOT be valid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var g=n;n=v.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+g+"]); ":" validate.errors = ["+g+"]; return false; ":" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } ",e.opts.allErrors&&(n+=" } ")}else n+="  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should NOT be valid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u&&(n+=" if (false) { ");return n}},{}],29:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(i||""),d="valid"+o,h="errs__"+o,p=e.util.copy(e),f="",m="valid"+ ++p.level;n+="var "+h+" = errors;var prevValid"+o+" = false;var "+d+" = false;";var v=p.baseId,g=e.compositeRule;e.compositeRule=p.compositeRule=!0;var y=a;if(y)for(var b,w=-1,_=y.length-1;w<_;)b=y[w+=1],e.util.schemaHasRules(b,e.RULES.all)?(p.schema=b,p.schemaPath=s+"["+w+"]",p.errSchemaPath=l+"/"+w,n+="  "+e.validate(p)+" ",p.baseId=v):n+=" var "+m+" = true; ",w&&(n+=" if ("+m+" && prevValid"+o+") "+d+" = false; else { ",f+="}"),n+=" if ("+m+") "+d+" = prevValid"+o+" = true;";return e.compositeRule=p.compositeRule=g,n+=f+"if (!"+d+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(n+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; "),n+="} else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }",e.opts.allErrors&&(n+=" } "),n}},{}],30:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,o=" ",i=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(a||""),h=e.opts.$data&&s&&s.$data;h?(o+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+i):n=s;var p=h?"(new RegExp("+n+"))":e.usePattern(s);o+="if ( ",h&&(o+=" ("+n+" !== undefined && typeof "+n+" != 'string') || "),o+=" !"+p+".test("+d+") ) {   ";var f=f||[];f.push(o),o="",!1!==e.createErrors?(o+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { pattern:  ",o+=h?""+n:""+e.util.toQuotedString(s),o+="  } ",!1!==e.opts.messages&&(o+=" , message: 'should match pattern \"",o+=h?"' + "+n+" + '":""+e.util.escapeQuotes(s),o+="\"' "),e.opts.verbose&&(o+=" , schema:  ",o+=h?"validate.schema"+l:""+e.util.toQuotedString(s),o+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ";var m=o;return o=f.pop(),o+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+m+"]); ":" validate.errors = ["+m+"]; return false; ":" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",o+="} ",c&&(o+=" else { "),o}},{}],31:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(i||""),d="valid"+o,h="errs__"+o,p=e.util.copy(e),f="",m="valid"+ ++p.level,v="key"+o,g="idx"+o,y=p.dataLevel=e.dataLevel+1,b="data"+y,w="dataProperties"+o,_=Object.keys(a||{}),E=e.schema.patternProperties||{},x=Object.keys(E),N=e.schema.additionalProperties,C=_.length||x.length,S=!1===N,P="object"==typeof N&&Object.keys(N).length,k=e.opts.removeAdditional,T=S||P||k,A=e.opts.ownProperties,O=e.baseId,R=e.schema.required;if(R&&(!e.opts.v5||!R.$data)&&R.length<e.opts.loopRequired)var I=e.util.toHash(R);if(e.opts.patternGroups)var D=e.schema.patternGroups||{},M=Object.keys(D);if(n+="var "+h+" = errors;var "+m+" = true;",A&&(n+=" var "+w+" = undefined;"),T){if(n+=A?" "+w+" = "+w+" || Object.keys("+c+"); for (var "+g+"=0; "+g+"<"+w+".length; "+g+"++) { var "+v+" = "+w+"["+g+"]; ":" for (var "+v+" in "+c+") { ",C){if(n+=" var isAdditional"+o+" = !(false ",_.length)if(_.length>5)n+=" || validate.schema"+s+"["+v+"] ";else{var L=_;if(L)for(var j=-1,F=L.length-1;j<F;)X=L[j+=1],n+=" || "+v+" == "+e.util.toQuotedString(X)+" "}if(x.length){var B=x;if(B)for(var H=-1,$=B.length-1;H<$;)ie=B[H+=1],n+=" || "+e.usePattern(ie)+".test("+v+") "}if(e.opts.patternGroups&&M.length){var U=M;if(U)for(var H=-1,V=U.length-1;H<V;)ue=U[H+=1],n+=" || "+e.usePattern(ue)+".test("+v+") "}n+=" ); if (isAdditional"+o+") { "}if("all"==k)n+=" delete "+c+"["+v+"]; ";else{var W=e.errorPath,q="' + "+v+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers)),S)k?n+=" delete "+c+"["+v+"]; ":(n+=" "+m+" = false; ",re=l,l=e.errSchemaPath+"/additionalProperties",(we=we||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { additionalProperty: '"+q+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have additional properties' "),e.opts.verbose&&(n+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",_e=n,n=we.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+_e+"]); ":" validate.errors = ["+_e+"]; return false; ":" var err = "+_e+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=re,u&&(n+=" break; "));else if(P)if("failing"==k){n+=" var "+h+" = errors;  ";var z=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.schema=N,p.schemaPath=e.schemaPath+".additionalProperties",p.errSchemaPath=e.errSchemaPath+"/additionalProperties",p.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers),J=c+"["+v+"]",p.dataPathArr[y]=v,fe=e.validate(p),p.baseId=O,n+=e.util.varOccurences(fe,b)<2?" "+e.util.varReplace(fe,b,J)+" ":" var "+b+" = "+J+"; "+fe+" ",n+=" if (!"+m+") { errors = "+h+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+c+"["+v+"]; }  ",e.compositeRule=p.compositeRule=z}else p.schema=N,p.schemaPath=e.schemaPath+".additionalProperties",p.errSchemaPath=e.errSchemaPath+"/additionalProperties",p.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers),J=c+"["+v+"]",p.dataPathArr[y]=v,fe=e.validate(p),p.baseId=O,n+=e.util.varOccurences(fe,b)<2?" "+e.util.varReplace(fe,b,J)+" ":" var "+b+" = "+J+"; "+fe+" ",u&&(n+=" if (!"+m+") break; ");e.errorPath=W}C&&(n+=" } "),n+=" }  ",u&&(n+=" if ("+m+") { ",f+="}")}var K=e.opts.useDefaults&&!e.compositeRule;if(_.length){var G=_;if(G)for(var X,Q=-1,Y=G.length-1;Q<Y;){if(pe=a[X=G[Q+=1]],e.util.schemaHasRules(pe,e.RULES.all)){var Z=e.util.getProperty(X),J=c+Z,ee=K&&void 0!==pe.default;if(p.schema=pe,p.schemaPath=s+Z,p.errSchemaPath=l+"/"+e.util.escapeFragment(X),p.errorPath=e.util.getPath(e.errorPath,X,e.opts.jsonPointers),p.dataPathArr[y]=e.util.toQuotedString(X),fe=e.validate(p),p.baseId=O,e.util.varOccurences(fe,b)<2)fe=e.util.varReplace(fe,b,J),te=J;else{var te=b;n+=" var "+b+" = "+J+"; "}if(ee)n+=" "+fe+" ";else{if(I&&I[X]){n+=" if ( "+te+" === undefined ",A&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(X)+"') "),n+=") { "+m+" = false; ";var W=e.errorPath,re=l,ne=e.util.escapeQuotes(X);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(W,X,e.opts.jsonPointers)),l=e.errSchemaPath+"/required",(we=we||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+ne+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+ne+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",_e=n,n=we.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+_e+"]); ":" validate.errors = ["+_e+"]; return false; ":" var err = "+_e+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=re,e.errorPath=W,n+=" } else { "}else u?(n+=" if ( "+te+" === undefined ",A&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(X)+"') "),n+=") { "+m+" = true; } else { "):(n+=" if ("+te+" !== undefined ",A&&(n+=" &&   Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(X)+"') "),n+=" ) { ");n+=" "+fe+" } "}}u&&(n+=" if ("+m+") { ",f+="}")}}if(x.length){var oe=x;if(oe)for(var ie,ae=-1,se=oe.length-1;ae<se;)pe=E[ie=oe[ae+=1]],e.util.schemaHasRules(pe,e.RULES.all)&&(p.schema=pe,p.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(ie),p.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(ie),n+=A?" "+w+" = "+w+" || Object.keys("+c+"); for (var "+g+"=0; "+g+"<"+w+".length; "+g+"++) { var "+v+" = "+w+"["+g+"]; ":" for (var "+v+" in "+c+") { ",n+=" if ("+e.usePattern(ie)+".test("+v+")) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers),J=c+"["+v+"]",p.dataPathArr[y]=v,fe=e.validate(p),p.baseId=O,n+=e.util.varOccurences(fe,b)<2?" "+e.util.varReplace(fe,b,J)+" ":" var "+b+" = "+J+"; "+fe+" ",u&&(n+=" if (!"+m+") break; "),n+=" } ",u&&(n+=" else "+m+" = true; "),n+=" }  ",u&&(n+=" if ("+m+") { ",f+="}"))}if(e.opts.patternGroups&&M.length){var le=M;if(le)for(var ue,ce=-1,de=le.length-1;ce<de;){var he=D[ue=le[ce+=1]],pe=he.schema;if(e.util.schemaHasRules(pe,e.RULES.all)){p.schema=pe,p.schemaPath=e.schemaPath+".patternGroups"+e.util.getProperty(ue)+".schema",p.errSchemaPath=e.errSchemaPath+"/patternGroups/"+e.util.escapeFragment(ue)+"/schema",n+=" var pgPropCount"+o+" = 0;  ",n+=A?" "+w+" = "+w+" || Object.keys("+c+"); for (var "+g+"=0; "+g+"<"+w+".length; "+g+"++) { var "+v+" = "+w+"["+g+"]; ":" for (var "+v+" in "+c+") { ",n+=" if ("+e.usePattern(ue)+".test("+v+")) { pgPropCount"+o+"++; ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers),J=c+"["+v+"]",p.dataPathArr[y]=v;var fe=e.validate(p);p.baseId=O,n+=e.util.varOccurences(fe,b)<2?" "+e.util.varReplace(fe,b,J)+" ":" var "+b+" = "+J+"; "+fe+" ",u&&(n+=" if (!"+m+") break; "),n+=" } ",u&&(n+=" else "+m+" = true; "),n+=" }  ",u&&(n+=" if ("+m+") { ",f+="}");var me=he.minimum,ve=he.maximum;if(void 0!==me||void 0!==ve){if(n+=" var "+d+" = true; ",re=l,void 0!==me){var ge=me,ye="minimum",be="less";n+=" "+d+" = pgPropCount"+o+" >= "+me+"; ",l=e.errSchemaPath+"/patternGroups/minimum",n+="  if (!"+d+") {   ",(we=we||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'patternGroups' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { reason: '"+ye+"', limit: "+ge+", pattern: '"+e.util.escapeQuotes(ue)+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have "+be+" than "+ge+' properties matching pattern "'+e.util.escapeQuotes(ue)+"\"' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",_e=n,n=we.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+_e+"]); ":" validate.errors = ["+_e+"]; return false; ":" var err = "+_e+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",void 0!==ve&&(n+=" else ")}if(void 0!==ve){var ge=ve,ye="maximum",be="more";n+=" "+d+" = pgPropCount"+o+" <= "+ve+"; ",l=e.errSchemaPath+"/patternGroups/maximum",n+="  if (!"+d+") {   ";var we=we||[];we.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'patternGroups' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { reason: '"+ye+"', limit: "+ge+", pattern: '"+e.util.escapeQuotes(ue)+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have "+be+" than "+ge+' properties matching pattern "'+e.util.escapeQuotes(ue)+"\"' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var _e=n;n=we.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+_e+"]); ":" validate.errors = ["+_e+"]; return false; ":" var err = "+_e+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } "}l=re,u&&(n+=" if ("+d+") { ",f+="}")}}}}return u&&(n+=" "+f+" if ("+h+" == errors) {"),n=e.util.cleanUpCode(n)}},{}],32:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(i||""),d="errs__"+o,h=e.util.copy(e),p="valid"+ ++h.level;if(e.util.schemaHasRules(a,e.RULES.all)){h.schema=a,h.schemaPath=s,h.errSchemaPath=l;var f="key"+o,m="idx"+o,v="i"+o,g="' + "+f+" + '",y="data"+(h.dataLevel=e.dataLevel+1),b="dataProperties"+o,w=e.opts.ownProperties,_=e.baseId;n+=" var "+d+" = errors; ",w&&(n+=" var "+b+" = undefined; "),n+=w?" "+b+" = "+b+" || Object.keys("+c+"); for (var "+m+"=0; "+m+"<"+b+".length; "+m+"++) { var "+f+" = "+b+"["+m+"]; ":" for (var "+f+" in "+c+") { ",n+=" var startErrs"+o+" = errors; ";var E=f,x=e.compositeRule;e.compositeRule=h.compositeRule=!0;var N=e.validate(h);h.baseId=_,n+=e.util.varOccurences(N,y)<2?" "+e.util.varReplace(N,y,E)+" ":" var "+y+" = "+E+"; "+N+" ",e.compositeRule=h.compositeRule=x,n+=" if (!"+p+") { for (var "+v+"=startErrs"+o+"; "+v+"<errors; "+v+"++) { vErrors["+v+"].propertyName = "+f+"; }   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { propertyName: '"+g+"' } ",!1!==e.opts.messages&&(n+=" , message: 'property name \\'"+g+"\\' is invalid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(n+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; "),u&&(n+=" break; "),n+=" } }"}return u&&(n+="  if ("+d+" == errors) {"),n=e.util.cleanUpCode(n)}},{}],33:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,o,i=" ",a=e.level,s=e.dataLevel,l=e.schema[t],u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(s||""),h="valid"+a;if("#"==l||"#/"==l)e.isRoot?(n=e.async,o="validate"):(n=!0===e.root.schema.$async,o="root.refVal[0]");else{var p=e.resolveRef(e.baseId,l,e.isRoot);if(void 0===p){var f=e.MissingRefError.message(e.baseId,l);if("fail"==e.opts.missingRefs){console.error(f),(y=y||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { ref: '"+e.util.escapeQuotes(l)+"' } ",!1!==e.opts.messages&&(i+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(l)+"' "),e.opts.verbose&&(i+=" , schema: "+e.util.toQuotedString(l)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var m=i;i=y.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+m+"]); ":" validate.errors = ["+m+"]; return false; ":" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c&&(i+=" if (false) { ")}else{if("ignore"!=e.opts.missingRefs)throw new e.MissingRefError(e.baseId,l,f);console.warn(f),c&&(i+=" if (true) { ")}}else if(p.inline){var v=e.util.copy(e),g="valid"+ ++v.level;v.schema=p.schema,v.schemaPath="",v.errSchemaPath=l,i+=" "+e.validate(v).replace(/validate\.schema/g,p.code)+" ",c&&(i+=" if ("+g+") { ")}else n=!0===p.$async,o=p.code}if(o){var y=y||[];y.push(i),i="",i+=e.opts.passContext?" "+o+".call(this, ":" "+o+"( ",i+=" "+d+", (dataPath || '')",'""'!=e.errorPath&&(i+=" + "+e.errorPath);var b=i+=" , "+(s?"data"+(s-1||""):"parentData")+" , "+(s?e.dataPathArr[s]:"parentDataProperty")+", rootData)  ";if(i=y.pop(),n){if(!e.async)throw new Error("async schema referenced by sync schema");c&&(i+=" var "+h+"; "),i+=" try { "+e.yieldAwait+" "+b+"; ",c&&(i+=" "+h+" = true; "),i+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",c&&(i+=" "+h+" = false; "),i+=" } ",c&&(i+=" if ("+h+") { ")}else i+=" if (!"+b+") { if (vErrors === null) vErrors = "+o+".errors; else vErrors = vErrors.concat("+o+".errors); errors = vErrors.length; } ",c&&(i+=" else { ")}return i}},{}],34:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(i||""),d="valid"+o,h=e.opts.$data&&a&&a.$data;h&&(n+=" var schema"+o+" = "+e.util.getData(a.$data,i,e.dataPathArr)+"; ");var p="schema"+o;if(!h)if(a.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var f=[],m=a;if(m)for(var v,g=-1,y=m.length-1;g<y;){v=m[g+=1];var b=e.schema.properties[v];b&&e.util.schemaHasRules(b,e.RULES.all)||(f[f.length]=v)}}else f=a;if(h||f.length){var w=e.errorPath,_=h||f.length>=e.opts.loopRequired,E=e.opts.ownProperties;if(u)if(n+=" var missing"+o+"; ",_)h||(n+=" var "+p+" = validate.schema"+s+"; "),T="' + "+(k="schema"+o+"["+(N="i"+o)+"]")+" + '",e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(w,k,e.opts.jsonPointers)),n+=" var "+d+" = true; ",h&&(n+=" if (schema"+o+" === undefined) "+d+" = true; else if (!Array.isArray(schema"+o+")) "+d+" = false; else {"),n+=" for (var "+N+" = 0; "+N+" < "+p+".length; "+N+"++) { "+d+" = "+c+"["+p+"["+N+"]] !== undefined ",E&&(n+=" &&   Object.prototype.hasOwnProperty.call("+c+", "+p+"["+N+"]) "),n+="; if (!"+d+") break; } ",h&&(n+="  }  "),n+="  if (!"+d+") {   ",(S=S||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+T+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+T+"\\'",
n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",P=n,n=S.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+P+"]); ":" validate.errors = ["+P+"]; return false; ":" var err = "+P+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { ";else{n+=" if ( ";var x=f;if(x)for(var N=-1,C=x.length-1;N<C;)O=x[N+=1],N&&(n+=" || "),n+=" ( ( "+(M=c+(D=e.util.getProperty(O)))+" === undefined ",E&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(O)+"') "),n+=") && (missing"+o+" = "+e.util.toQuotedString(e.opts.jsonPointers?O:D)+") ) ";n+=") {  ",T="' + "+(k="missing"+o)+" + '",e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(w,k,!0):w+" + "+k);var S=S||[];S.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+T+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+T+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var P=n;n=S.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+P+"]); ":" validate.errors = ["+P+"]; return false; ":" var err = "+P+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { "}else if(_){h||(n+=" var "+p+" = validate.schema"+s+"; ");var k="schema"+o+"["+(N="i"+o)+"]",T="' + "+k+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(w,k,e.opts.jsonPointers)),h&&(n+=" if ("+p+" && !Array.isArray("+p+")) {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+T+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+T+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+p+" !== undefined) { "),n+=" for (var "+N+" = 0; "+N+" < "+p+".length; "+N+"++) { if ("+c+"["+p+"["+N+"]] === undefined ",E&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", "+p+"["+N+"]) "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+T+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+T+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",h&&(n+="  }  ")}else{var A=f;if(A)for(var O,R=-1,I=A.length-1;R<I;){O=A[R+=1];var D=e.util.getProperty(O),T=e.util.escapeQuotes(O),M=c+D;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(w,O,e.opts.jsonPointers)),n+=" if ( "+M+" === undefined ",E&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(O)+"') "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+T+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+T+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=w}else u&&(n+=" if (true) {");return n}},{}],35:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,o=" ",i=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(a||""),h="valid"+i,p=e.opts.$data&&s&&s.$data;if(p?(o+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+i):n=s,(s||p)&&!1!==e.opts.uniqueItems){p&&(o+=" var "+h+"; if ("+n+" === false || "+n+" === undefined) "+h+" = true; else if (typeof "+n+" != 'boolean') "+h+" = false; else { "),o+=" var "+h+" = true; if ("+d+".length > 1) { var i = "+d+".length, j; outer: for (;i--;) { for (j = i; j--;) { if (equal("+d+"[i], "+d+"[j])) { "+h+" = false; break outer; } } } } ",p&&(o+="  }  "),o+=" if (!"+h+") {   ";var f=f||[];f.push(o),o="",!1!==e.createErrors?(o+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { i: i, j: j } ",!1!==e.opts.messages&&(o+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(o+=" , schema:  ",o+=p?"validate.schema"+l:""+s,o+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ";var m=o;o=f.pop(),o+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+m+"]); ":" validate.errors = ["+m+"]; return false; ":" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",o+=" } ",c&&(o+=" else { ")}else c&&(o+=" if (true) { ");return o}},{}],36:[function(e,t,r){"use strict";t.exports=function(e,t,r){function n(e){for(var t=e.rules,r=0;r<t.length;r++)if(o(t[r]))return!0}function o(t){return void 0!==e.schema[t.keyword]||t.implements&&i(t)}function i(t){for(var r=t.implements,n=0;n<r.length;n++)if(void 0!==e.schema[r[n]])return!0}var a="",s=!0===e.schema.$async,l=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),u=e.self._getId(e.schema);if(e.isTop){if(s){e.async=!0;var c="es7"==e.opts.async;e.yieldAwait=c?"await":"yield"}a+=" var validate = ",s?c?a+=" (async function ":("*"!=e.opts.async&&(a+="co.wrap"),a+="(function* "):a+=" (function ",a+=" (data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",u&&(e.opts.sourceCode||e.opts.processCode)&&(a+=" /*# sourceURL="+u+" */ ")}if("boolean"==typeof e.schema||!l&&!e.schema.$ref){var d=e.level,h=e.dataLevel,p=e.schema["false schema"],f=e.schemaPath+e.util.getProperty("false schema"),m=e.errSchemaPath+"/false schema",v=!e.opts.allErrors,g="data"+(h||""),y="valid"+d;return!1===e.schema?(e.isTop?v=!0:a+=" var "+y+" = false; ",(J=J||[]).push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(w||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: {} ",!1!==e.opts.messages&&(a+=" , message: 'boolean schema is false' "),e.opts.verbose&&(a+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+g+" "),a+=" } "):a+=" {} ",ee=a,a=J.pop(),a+=!e.compositeRule&&v?e.async?" throw new ValidationError(["+ee+"]); ":" validate.errors = ["+ee+"]; return false; ":" var err = "+ee+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "):a+=e.isTop?s?" return data; ":" validate.errors = null; return true; ":" var "+y+" = true; ",e.isTop&&(a+=" }); return validate; "),a}if(e.isTop){var b=e.isTop,d=e.level=0,h=e.dataLevel=0,g="data";e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[void 0],a+=" var vErrors = null; ",a+=" var errors = 0;     ",a+=" if (rootData === undefined) rootData = data; "}else{var d=e.level,g="data"+((h=e.dataLevel)||"");if(u&&(e.baseId=e.resolve.url(e.baseId,u)),s&&!e.async)throw new Error("async schema in sync schema");a+=" var errs_"+d+" = errors;"}var w,y="valid"+d,v=!e.opts.allErrors,_="",E="",x=e.schema.type,N=Array.isArray(x);if(N&&1==x.length&&(x=x[0],N=!1),e.schema.$ref&&l){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(l=!1,console.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(x){if(e.opts.coerceTypes)var C=e.util.coerceToTypes(e.opts.coerceTypes,x);if(j=e.RULES.types[x],C||N||!0===j||j&&!n(j)){var f=e.schemaPath+".type",m=e.errSchemaPath+"/type",f=e.schemaPath+".type",m=e.errSchemaPath+"/type",S=N?"checkDataTypes":"checkDataType";if(a+=" if ("+e.util[S](x,g,!0)+") { ",C){var P="dataType"+d,k="coerced"+d;a+=" var "+P+" = typeof "+g+"; ","array"==e.opts.coerceTypes&&(a+=" if ("+P+" == 'object' && Array.isArray("+g+")) "+P+" = 'array'; "),a+=" var "+k+" = undefined; ";var T="",A=C;if(A)for(var O,R=-1,I=A.length-1;R<I;)O=A[R+=1],R&&(a+=" if ("+k+" === undefined) { ",T+="}"),"array"==e.opts.coerceTypes&&"array"!=O&&(a+=" if ("+P+" == 'array' && "+g+".length == 1) { "+k+" = "+g+" = "+g+"[0]; "+P+" = typeof "+g+";  } "),"string"==O?a+=" if ("+P+" == 'number' || "+P+" == 'boolean') "+k+" = '' + "+g+"; else if ("+g+" === null) "+k+" = ''; ":"number"==O||"integer"==O?(a+=" if ("+P+" == 'boolean' || "+g+" === null || ("+P+" == 'string' && "+g+" && "+g+" == +"+g+" ","integer"==O&&(a+=" && !("+g+" % 1)"),a+=")) "+k+" = +"+g+"; "):"boolean"==O?a+=" if ("+g+" === 'false' || "+g+" === 0 || "+g+" === null) "+k+" = false; else if ("+g+" === 'true' || "+g+" === 1) "+k+" = true; ":"null"==O?a+=" if ("+g+" === '' || "+g+" === 0 || "+g+" === false) "+k+" = null; ":"array"==e.opts.coerceTypes&&"array"==O&&(a+=" if ("+P+" == 'string' || "+P+" == 'number' || "+P+" == 'boolean' || "+g+" == null) "+k+" = ["+g+"]; ");a+=" "+T+" if ("+k+" === undefined) {   ",(J=J||[]).push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(w||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: { type: '",a+=N?""+x.join(","):""+x,a+="' } ",!1!==e.opts.messages&&(a+=" , message: 'should be ",a+=N?""+x.join(","):""+x,a+="' "),e.opts.verbose&&(a+=" , schema: validate.schema"+f+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+g+" "),a+=" } "):a+=" {} ",ee=a,a=J.pop(),a+=!e.compositeRule&&v?e.async?" throw new ValidationError(["+ee+"]); ":" validate.errors = ["+ee+"]; return false; ":" var err = "+ee+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } else {  ";var D=h?"data"+(h-1||""):"parentData",M=h?e.dataPathArr[h]:"parentDataProperty";a+=" "+g+" = "+k+"; ",h||(a+="if ("+D+" !== undefined)"),a+=" "+D+"["+M+"] = "+k+"; } "}else(J=J||[]).push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(w||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: { type: '",a+=N?""+x.join(","):""+x,a+="' } ",!1!==e.opts.messages&&(a+=" , message: 'should be ",a+=N?""+x.join(","):""+x,a+="' "),e.opts.verbose&&(a+=" , schema: validate.schema"+f+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+g+" "),a+=" } "):a+=" {} ",ee=a,a=J.pop(),a+=!e.compositeRule&&v?e.async?" throw new ValidationError(["+ee+"]); ":" validate.errors = ["+ee+"]; return false; ":" var err = "+ee+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";a+=" } "}}if(e.schema.$ref&&!l)a+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",v&&(a+=" } if (errors === ",a+=b?"0":"errs_"+d,a+=") { ",E+="}");else{e.opts.v5&&e.schema.patternGroups&&console.warn('keyword "patternGroups" is deprecated and disabled. Use option patternGroups: true to enable.');var L=e.RULES;if(L)for(var j,F=-1,B=L.length-1;F<B;)if(j=L[F+=1],n(j)){if(j.type&&(a+=" if ("+e.util.checkDataType(j.type,g)+") { "),e.opts.useDefaults&&!e.compositeRule)if("object"==j.type&&e.schema.properties){var p=e.schema.properties,H=Object.keys(p);if(H)for(var $,U=-1,V=H.length-1;U<V;)void 0!==(q=p[$=H[U+=1]]).default&&(a+="  if ("+(K=g+e.util.getProperty($))+" === undefined) "+K+" = ",a+="shared"==e.opts.useDefaults?" "+e.useDefault(q.default)+" ":" "+JSON.stringify(q.default)+" ",a+="; ")}else if("array"==j.type&&Array.isArray(e.schema.items)){var W=e.schema.items;if(W)for(var q,R=-1,z=W.length-1;R<z;)if(void 0!==(q=W[R+=1]).default){var K=g+"["+R+"]";a+="  if ("+K+" === undefined) "+K+" = ",a+="shared"==e.opts.useDefaults?" "+e.useDefault(q.default)+" ":" "+JSON.stringify(q.default)+" ",a+="; "}}var G=j.rules;if(G)for(var X,Q=-1,Y=G.length-1;Q<Y;)if(X=G[Q+=1],o(X)){var Z=X.code(e,X.keyword,j.type);Z&&(a+=" "+Z+" ",v&&(_+="}"))}if(v&&(a+=" "+_+" ",_=""),j.type&&(a+=" } ",x&&x===j.type&&!C)){a+=" else { ";var f=e.schemaPath+".type",m=e.errSchemaPath+"/type",J=J||[];J.push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(w||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: { type: '",a+=N?""+x.join(","):""+x,a+="' } ",!1!==e.opts.messages&&(a+=" , message: 'should be ",a+=N?""+x.join(","):""+x,a+="' "),e.opts.verbose&&(a+=" , schema: validate.schema"+f+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+g+" "),a+=" } "):a+=" {} ";var ee=a;a=J.pop(),a+=!e.compositeRule&&v?e.async?" throw new ValidationError(["+ee+"]); ":" validate.errors = ["+ee+"]; return false; ":" var err = "+ee+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } "}v&&(a+=" if (errors === ",a+=b?"0":"errs_"+d,a+=") { ",E+="}")}}return v&&(a+=" "+E+" "),b?(s?(a+=" if (errors === 0) return data;           ",a+=" else throw new ValidationError(vErrors); "):(a+=" validate.errors = vErrors; ",a+=" return errors === 0;       "),a+=" }); return validate;"):a+=" var "+y+" = errors === errs_"+d+";",a=e.util.cleanUpCode(a),b&&(a=e.util.finalCleanUpCode(a,s)),a}},{}],37:[function(e,t,r){"use strict";function n(e,t){function r(e,t,r){for(var n,i=0;i<o.length;i++){var a=o[i];if(a.type==t){n=a;break}}n||(n={type:t,rules:[]},o.push(n));var l={keyword:e,definition:r,custom:!0,code:s,implements:r.implements};n.rules.push(l),o.custom[e]=l}function n(e){if(!o.types[e])throw new Error("Unknown type "+e)}var o=this.RULES;if(o.keywords[e])throw new Error("Keyword "+e+" is already defined");if(!a.test(e))throw new Error("Keyword "+e+" is not a valid identifier");if(t){if(t.macro&&void 0!==t.valid)throw new Error('"valid" option cannot be used with macro keywords');var i=t.type;if(Array.isArray(i)){var l,u=i.length;for(l=0;l<u;l++)n(i[l]);for(l=0;l<u;l++)r(e,i[l],t)}else i&&n(i),r(e,i,t);var c=!0===t.$data&&this._opts.$data;if(c&&!t.validate)throw new Error('$data support: "validate" function is not defined');var d=t.metaSchema;d&&(c&&(d={anyOf:[d,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/$data.json#"}]}),t.validateSchema=this.compile(d,!0))}o.keywords[e]=o.all[e]=!0}function o(e){var t=this.RULES.custom[e];return t?t.definition:this.RULES.keywords[e]||!1}function i(e){var t=this.RULES;delete t.keywords[e],delete t.all[e],delete t.custom[e];for(var r=0;r<t.length;r++)for(var n=t[r].rules,o=0;o<n.length;o++)if(n[o].keyword==e){n.splice(o,1);break}}var a=/^[a-z_$][a-z0-9_$\-]*$/i,s=e("./dotjs/custom");t.exports={add:n,get:o,remove:i}},{"./dotjs/custom":22}],38:[function(e,t,r){"use strict";t.exports=function(e){var t=e._opts.defaultMeta,r="string"==typeof t?{$ref:t}:e.getSchema("http://json-schema.org/draft-06/schema")?{$ref:"http://json-schema.org/draft-06/schema"}:{};e.addKeyword("patternGroups",{metaSchema:{type:"object",additionalProperties:{type:"object",required:["schema"],properties:{maximum:{type:"integer",minimum:0},minimum:{type:"integer",minimum:0},schema:r},additionalProperties:!1}}}),e.RULES.all.properties.implements.push("patternGroups")}},{}],39:[function(e,t,r){t.exports={$schema:"http://json-schema.org/draft-06/schema#",$id:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/$data.json#",description:"Meta-schema for $data reference (JSON-schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}},{}],40:[function(e,t,r){t.exports={$schema:"http://json-schema.org/draft-06/schema#",$id:"http://json-schema.org/draft-06/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},title:{type:"string"},description:{type:"string"},default:{},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:{}},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:{},enum:{type:"array",minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:{}}},{}],41:[function(e,t,r){(function(e){!function(n){function o(e){throw new RangeError(I[e])}function i(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function a(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+i((e=e.replace(R,".")).split("."),t).join(".")}function s(e){for(var t,r,n=[],o=0,i=e.length;o<i;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<i?56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--):n.push(t);return n}function l(e){return i(e,function(e){var t="";return e>65535&&(t+=L((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=L(e)}).join("")}function u(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:E}function c(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function d(e,t,r){var n=0;for(e=r?M(e/S):e>>1,e+=M(e/t);e>D*N>>1;n+=E)e=M(e/D);return M(n+(D+1)*e/(e+C))}function h(e){var t,r,n,i,a,s,c,h,p,f,m=[],v=e.length,g=0,y=k,b=P;for((r=e.lastIndexOf(T))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&o("not-basic"),m.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<v;){for(a=g,s=1,c=E;i>=v&&o("invalid-input"),((h=u(e.charCodeAt(i++)))>=E||h>M((_-g)/s))&&o("overflow"),g+=h*s,p=c<=b?x:c>=b+N?N:c-b,!(h<p);c+=E)s>M(_/(f=E-p))&&o("overflow"),s*=f;b=d(g-a,t=m.length+1,0==a),M(g/t)>_-y&&o("overflow"),y+=M(g/t),g%=t,m.splice(g++,0,y)}return l(m)}function p(e){var t,r,n,i,a,l,u,h,p,f,m,v,g,y,b,w=[];for(v=(e=s(e)).length,t=k,r=0,a=P,l=0;l<v;++l)(m=e[l])<128&&w.push(L(m));for(n=i=w.length,i&&w.push(T);n<v;){for(u=_,l=0;l<v;++l)(m=e[l])>=t&&m<u&&(u=m);for(u-t>M((_-r)/(g=n+1))&&o("overflow"),r+=(u-t)*g,t=u,l=0;l<v;++l)if((m=e[l])<t&&++r>_&&o("overflow"),m==t){for(h=r,p=E;f=p<=a?x:p>=a+N?N:p-a,!(h<f);p+=E)b=h-f,y=E-f,w.push(L(c(f+b%y,0))),h=M(b/y);w.push(L(c(h,0))),a=d(r,g,n==i),r=0,++n}++r,++t}return w.join("")}function f(e){return a(e,function(e){return A.test(e)?h(e.slice(4).toLowerCase()):e})}function m(e){return a(e,function(e){return O.test(e)?"xn--"+p(e):e})}var v="object"==typeof r&&r&&!r.nodeType&&r,g="object"==typeof t&&t&&!t.nodeType&&t,y="object"==typeof e&&e;y.global!==y&&y.window!==y&&y.self!==y||(n=y);var b,w,_=2147483647,E=36,x=1,N=26,C=38,S=700,P=72,k=128,T="-",A=/^xn--/,O=/[^\x20-\x7E]/,R=/[\x2E\u3002\uFF0E\uFF61]/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},D=E-x,M=Math.floor,L=String.fromCharCode;if(b={version:"1.4.1",ucs2:{decode:s,encode:l},decode:h,encode:p,toASCII:m,toUnicode:f},v&&g)if(t.exports==v)g.exports=b;else for(w in b)b.hasOwnProperty(w)&&(v[w]=b[w]);else n.punycode=b}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],42:[function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,r,i){t=t||"&",r=r||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var l=1e3;i&&"number"==typeof i.maxKeys&&(l=i.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var c=0;c<u;++c){var d,h,p,f,m=e[c].replace(s,"%20"),v=m.indexOf(r);v>=0?(d=m.substr(0,v),h=m.substr(v+1)):(d=m,h=""),p=decodeURIComponent(d),f=decodeURIComponent(h),n(a,p)?o(a[p])?a[p].push(f):a[p]=[a[p],f]:a[p]=f}return a};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],43:[function(e,t,r){"use strict";function n(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var o=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,r,s){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?n(a(e),function(a){var s=encodeURIComponent(o(a))+r;return i(e[a])?n(e[a],function(e){return s+encodeURIComponent(o(e))}).join(t):s+encodeURIComponent(o(e[a]))}).join(t):s?encodeURIComponent(o(s))+r+encodeURIComponent(o(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},{}],44:[function(e,t,r){"use strict";r.decode=r.parse=e("./decode"),r.encode=r.stringify=e("./encode")},{"./decode":42,"./encode":43}],45:[function(e,t,r){"use strict";function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function o(e,t,r){if(e&&u.isObject(e)&&e instanceof n)return e;var o=new n;return o.parse(e,t,r),o}function i(e){return u.isString(e)&&(e=o(e)),e instanceof n?e.format():n.prototype.format.call(e)}function a(e,t){return o(e,!1,!0).resolve(t)}function s(e,t){return e?o(e,!1,!0).resolveObject(t):t}var l=e("punycode"),u=e("./util");r.parse=o,r.resolve=a,r.resolveObject=s,r.format=i,r.Url=n;var c=/^([a-z0-9.+-]+:)/i,d=/:[0-9]*$/,h=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,p=["<",">",'"',"`"," ","\r","\n","\t"],f=["{","}","|","\\","^","`"].concat(p),m=["'"].concat(f),v=["%","/","?",";","#"].concat(m),g=["/","?","#"],y=/^[+a-z0-9A-Z_-]{0,63}$/,b=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,w={javascript:!0,"javascript:":!0},_={javascript:!0,"javascript:":!0},E={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},x=e("querystring");n.prototype.parse=function(e,t,r){if(!u.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),o=-1!==n&&n<e.indexOf("#")?"?":"#",i=e.split(o),a=/\\/g;i[0]=i[0].replace(a,"/");var s=e=i.join(o);if(s=s.trim(),!r&&1===e.split("#").length){var d=h.exec(s);if(d)return this.path=s,this.href=s,this.pathname=d[1],d[2]?(this.search=d[2],this.query=t?x.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var p=c.exec(s);if(p){var f=(p=p[0]).toLowerCase();this.protocol=f,s=s.substr(p.length)}if(r||p||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var N="//"===s.substr(0,2);!N||p&&_[p]||(s=s.substr(2),this.slashes=!0)}if(!_[p]&&(N||p&&!E[p])){for(var C=-1,S=0;S<g.length;S++)-1!==(T=s.indexOf(g[S]))&&(-1===C||T<C)&&(C=T);var P,k;for(-1!==(k=-1===C?s.lastIndexOf("@"):s.lastIndexOf("@",C))&&(P=s.slice(0,k),s=s.slice(k+1),this.auth=decodeURIComponent(P)),C=-1,S=0;S<v.length;S++){var T=s.indexOf(v[S]);-1!==T&&(-1===C||T<C)&&(C=T)}-1===C&&(C=s.length),this.host=s.slice(0,C),s=s.slice(C),this.parseHost();var A="["===(this.hostname=this.hostname||"")[0]&&"]"===this.hostname[this.hostname.length-1];if(!A)for(var O=this.hostname.split(/\./),S=0,R=O.length;S<R;S++){var I=O[S];if(I&&!I.match(y)){for(var D="",M=0,L=I.length;M<L;M++)D+=I.charCodeAt(M)>127?"x":I[M];if(!D.match(y)){var j=O.slice(0,S),F=O.slice(S+1),B=I.match(b);B&&(j.push(B[1]),F.unshift(B[2])),F.length&&(s="/"+F.join(".")+s),this.hostname=j.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),A||(this.hostname=l.toASCII(this.hostname));var H=this.port?":"+this.port:"",$=this.hostname||"";this.host=$+H,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!w[f])for(var S=0,R=m.length;S<R;S++){var U=m[S];if(-1!==s.indexOf(U)){var V=encodeURIComponent(U);V===U&&(V=escape(U)),s=s.split(U).join(V)}}var W=s.indexOf("#");-1!==W&&(this.hash=s.substr(W),s=s.slice(0,W));var q=s.indexOf("?");if(-1!==q?(this.search=s.substr(q),this.query=s.substr(q+1),t&&(this.query=x.parse(this.query)),s=s.slice(0,q)):t&&(this.search="",this.query={}),s&&(this.pathname=s),E[f]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var H=this.pathname||"",z=this.search||"";this.path=H+z}return this.href=this.format(),this},n.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,i="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&u.isObject(this.query)&&Object.keys(this.query).length&&(i=x.stringify(this.query));var a=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||E[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),a=a.replace("#","%23"),t+o+r+a+n},n.prototype.resolve=function(e){return this.resolveObject(o(e,!1,!0)).format()},n.prototype.resolveObject=function(e){if(u.isString(e)){var t=new n;t.parse(e,!1,!0),e=t}for(var r=new n,o=Object.keys(this),i=0;i<o.length;i++){var a=o[i];r[a]=this[a]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),l=0;l<s.length;l++){var c=s[l];"protocol"!==c&&(r[c]=e[c])}return E[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!E[e.protocol]){for(var d=Object.keys(e),h=0;h<d.length;h++){var p=d[h];r[p]=e[p]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||_[e.protocol])r.pathname=e.pathname;else{for(x=(e.pathname||"").split("/");x.length&&!(e.host=x.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==x[0]&&x.unshift(""),x.length<2&&x.unshift(""),r.pathname=x.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var f=r.pathname||"",m=r.search||"";r.path=f+m}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var v=r.pathname&&"/"===r.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),y=g||v||r.host&&e.pathname,b=y,w=r.pathname&&r.pathname.split("/")||[],x=e.pathname&&e.pathname.split("/")||[],N=r.protocol&&!E[r.protocol];if(N&&(r.hostname="",r.port=null,r.host&&(""===w[0]?w[0]=r.host:w.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===x[0]?x[0]=e.host:x.unshift(e.host)),e.host=null),y=y&&(""===x[0]||""===w[0])),g)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,w=x;else if(x.length)w||(w=[]),w.pop(),w=w.concat(x),r.search=e.search,r.query=e.query;else if(!u.isNullOrUndefined(e.search))return N&&(r.hostname=r.host=w.shift(),(A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=A.shift(),r.host=r.hostname=A.shift())),r.search=e.search,r.query=e.query,u.isNull(r.pathname)&&u.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!w.length)return r.pathname=null,r.path=r.search?"/"+r.search:null,r.href=r.format(),r;for(var C=w.slice(-1)[0],S=(r.host||e.host||w.length>1)&&("."===C||".."===C)||""===C,P=0,k=w.length;k>=0;k--)"."===(C=w[k])?w.splice(k,1):".."===C?(w.splice(k,1),P++):P&&(w.splice(k,1),P--);if(!y&&!b)for(;P--;P)w.unshift("..");!y||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),S&&"/"!==w.join("/").substr(-1)&&w.push("");var T=""===w[0]||w[0]&&"/"===w[0].charAt(0);if(N){r.hostname=r.host=T?"":w.length?w.shift():"";var A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");A&&(r.auth=A.shift(),r.host=r.hostname=A.shift())}return(y=y||r.host&&w.length)&&!T&&w.unshift(""),w.length?r.pathname=w.join("/"):(r.pathname=null,r.path=null),u.isNull(r.pathname)&&u.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},n.prototype.parseHost=function(){var e=this.host,t=d.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":46,punycode:41,querystring:44}],46:[function(e,t,r){"use strict";t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],47:[function(e,t,r){function n(e){var t=this,r=h.call(arguments,1);return new Promise(function(n,i){function a(t){var r;try{r=e.next(t)}catch(e){return i(e)}u(r)}function s(t){var r;try{r=e.throw(t)}catch(e){return i(e)}u(r)}function u(e){if(e.done)return n(e.value);var r=o.call(t,e.value);return r&&l(r)?r.then(a,s):s(new TypeError('You may only yield a function, promise, generator, array, or object, but the following object was passed: "'+String(e.value)+'"'))}return"function"==typeof e&&(e=e.apply(t,r)),e&&"function"==typeof e.next?void a():n(e)})}function o(e){return e?l(e)?e:c(e)||u(e)?n.call(this,e):"function"==typeof e?i.call(this,e):Array.isArray(e)?a.call(this,e):d(e)?s.call(this,e):e:e}function i(e){var t=this;return new Promise(function(r,n){e.call(t,function(e,t){return e?n(e):(arguments.length>2&&(t=h.call(arguments,1)),void r(t))})})}function a(e){return Promise.all(e.map(o,this))}function s(e){for(var t=new e.constructor,r=Object.keys(e),n=[],i=0;i<r.length;i++){var a=r[i],s=o.call(this,e[a]);s&&l(s)?function(e,r){t[r]=void 0,n.push(e.then(function(e){t[r]=e}))}(s,a):t[a]=e[a]}return Promise.all(n).then(function(){return t})}function l(e){return"function"==typeof e.then}function u(e){return"function"==typeof e.next&&"function"==typeof e.throw}function c(e){var t=e.constructor;return!!t&&("GeneratorFunction"===t.name||"GeneratorFunction"===t.displayName||u(t.prototype))}function d(e){return Object==e.constructor}var h=Array.prototype.slice;t.exports=n.default=n.co=n,
n.wrap=function(e){function t(){return n.call(this,e.apply(this,arguments))}return t.__generatorFunction__=e,t}},{}],48:[function(e,t,r){var n="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r=t.space||"";"number"==typeof r&&(r=Array(r+1).join(" "));var a="boolean"==typeof t.cycles&&t.cycles,s=t.replacer||function(e,t){return t},l=t.cmp&&function(e){return function(t){return function(r,n){return e({key:r,value:t[r]},{key:n,value:t[n]})}}}(t.cmp),u=[];return function e(t,c,d,h){var p=r?"\n"+new Array(h+1).join(r):"",f=r?": ":":";if(d&&d.toJSON&&"function"==typeof d.toJSON&&(d=d.toJSON()),void 0!==(d=s.call(t,c,d))){if("object"!=typeof d||null===d)return n.stringify(d);if(o(d)){for(var m=[],v=0;v<d.length;v++){var g=e(d,v,d[v],h+1)||n.stringify(null);m.push(p+r+g)}return"["+m.join(",")+p+"]"}if(-1!==u.indexOf(d)){if(a)return n.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}u.push(d);for(var y=i(d).sort(l&&l(d)),m=[],v=0;v<y.length;v++){var b=e(d,c=y[v],d[c],h+1);if(b){var w=n.stringify(c)+f+b;m.push(p+r+w)}}return u.splice(u.indexOf(d),1),"{"+m.join(",")+p+"}"}}({"":e},"",e,0)};var o=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},i=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},r=[];for(var n in e)t.call(e,n)&&r.push(n);return r}},{jsonify:49}],49:[function(e,t,r){r.parse=e("./lib/parse"),r.stringify=e("./lib/stringify")},{"./lib/parse":50,"./lib/stringify":51}],50:[function(e,t,r){var n,o,i,a,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},l=function(e){throw{name:"SyntaxError",message:e,at:n,text:i}},u=function(e){return e&&e!==o&&l("Expected '"+e+"' instead of '"+o+"'"),o=i.charAt(n),n+=1,o},c=function(){var e,t="";for("-"===o&&(t="-",u("-"));o>="0"&&o<="9";)t+=o,u();if("."===o)for(t+=".";u()&&o>="0"&&o<="9";)t+=o;if("e"===o||"E"===o)for(t+=o,u(),"-"!==o&&"+"!==o||(t+=o,u());o>="0"&&o<="9";)t+=o,u();return e=+t,isFinite(e)?e:void l("Bad number")},d=function(){var e,t,r,n="";if('"'===o)for(;u();){if('"'===o)return u(),n;if("\\"===o)if(u(),"u"===o){for(r=0,t=0;t<4&&(e=parseInt(u(),16),isFinite(e));t+=1)r=16*r+e;n+=String.fromCharCode(r)}else{if("string"!=typeof s[o])break;n+=s[o]}else n+=o}l("Bad string")},h=function(){for(;o&&o<=" ";)u()},p=function(){switch(o){case"t":return u("t"),u("r"),u("u"),u("e"),!0;case"f":return u("f"),u("a"),u("l"),u("s"),u("e"),!1;case"n":return u("n"),u("u"),u("l"),u("l"),null}l("Unexpected '"+o+"'")},f=function(){var e=[];if("["===o){if(u("["),h(),"]"===o)return u("]"),e;for(;o;){if(e.push(a()),h(),"]"===o)return u("]"),e;u(","),h()}}l("Bad array")},m=function(){var e,t={};if("{"===o){if(u("{"),h(),"}"===o)return u("}"),t;for(;o;){if(e=d(),h(),u(":"),Object.hasOwnProperty.call(t,e)&&l('Duplicate key "'+e+'"'),t[e]=a(),h(),"}"===o)return u("}"),t;u(","),h()}}l("Bad object")};a=function(){switch(h(),o){case"{":return m();case"[":return f();case'"':return d();case"-":return c();default:return o>="0"&&o<="9"?c():p()}},t.exports=function(e,t){var r;return i=e,n=0,o=" ",r=a(),h(),o&&l("Syntax error"),"function"==typeof t?function e(r,n){var o,i,a=r[n];if(a&&"object"==typeof a)for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(void 0!==(i=e(a,o))?a[o]=i:delete a[o]);return t.call(r,n,a)}({"":r},""):r}},{}],51:[function(e,t,r){function n(e){return l.lastIndex=0,l.test(e)?'"'+e.replace(l,function(e){var t=u[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function o(e,t){var r,l,u,c,d,h=i,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof s&&(p=s.call(t,e,p)),typeof p){case"string":return n(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(i+=a,d=[],"[object Array]"===Object.prototype.toString.apply(p)){for(c=p.length,r=0;r<c;r+=1)d[r]=o(r,p)||"null";return u=0===d.length?"[]":i?"[\n"+i+d.join(",\n"+i)+"\n"+h+"]":"["+d.join(",")+"]",i=h,u}if(s&&"object"==typeof s)for(c=s.length,r=0;r<c;r+=1)"string"==typeof(l=s[r])&&(u=o(l,p))&&d.push(n(l)+(i?": ":":")+u);else for(l in p)Object.prototype.hasOwnProperty.call(p,l)&&(u=o(l,p))&&d.push(n(l)+(i?": ":":")+u);return u=0===d.length?"{}":i?"{\n"+i+d.join(",\n"+i)+"\n"+h+"}":"{"+d.join(",")+"}",i=h,u}}var i,a,s,l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,u={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,r){var n;if(i="",a="","number"==typeof r)for(n=0;n<r;n+=1)a+=" ";else"string"==typeof r&&(a=r);if(s=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return o("",{"":e})}},{}],ajv:[function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);e=this._opts=j.copy(e)||{},this._schemas={},this._refs={},this._fragments={},this._formats=I(e.format);var t=this._schemaUriFormat=this._formats["uri-reference"];this._schemaUriFormatFunc=function(e){return t.test(e)},this._cache=e.cache||new A,this._loadingSchemas={},this._compilations=[],this.RULES=D(),this._getId=g(e),e.loopRequired=e.loopRequired||1/0,"property"==e.errorDataPath&&(e._errorDataPathProperty=!0),void 0===e.serialize&&(e.serialize=R),this._metaOpts=P(this),e.formats&&C(this),x(this),"object"==typeof e.meta&&this.addMetaSchema(e.meta),N(this),e.patternGroups&&L(this)}function o(e,t){var r;if("string"==typeof e){if(!(r=this.getSchema(e)))throw new Error('no schema with key or ref "'+e+'"')}else{var n=this._addSchema(e);r=n.validate||this._compile(n)}var o=r(t);return!0===r.$async?"*"==this._opts.async?F(o):o:(this.errors=r.errors,o)}function i(e,t){var r=this._addSchema(e,void 0,t);return r.validate||this._compile(r)}function a(e,t,r,n){if(Array.isArray(e))for(var o=0;o<e.length;o++)this.addSchema(e[o],void 0,r,n);else{var i=this._getId(e);if(void 0!==i&&"string"!=typeof i)throw new Error("schema id must be string");S(this,t=T.normalizeId(t||i)),this._schemas[t]=this._addSchema(e,r,n,!0)}}function s(e,t,r){this.addSchema(e,t,r,!0)}function l(e,t){var r=e.$schema;if(void 0!==r&&"string"!=typeof r)throw new Error("$schema must be a string");if(!(r=r||this._opts.defaultMeta||u(this)))return console.warn("meta-schema not available"),this.errors=null,!0;var n=this._formats.uri;this._formats.uri="function"==typeof n?this._schemaUriFormatFunc:this._schemaUriFormat;var o;try{o=this.validate(r,e)}finally{this._formats.uri=n}if(!o&&t){var i="schema is invalid: "+this.errorsText();if("log"!=this._opts.validateSchema)throw new Error(i);console.error(i)}return o}function u(e){var t=e._opts.meta;return e._opts.defaultMeta="object"==typeof t?e._getId(t)||t:e.getSchema($)?$:void 0}function c(e){var t=h(this,e);switch(typeof t){case"object":return t.validate||this._compile(t);case"string":return this.getSchema(t);case"undefined":return d(this,e)}}function d(e,t){var r=T.schema.call(e,{schema:{}},t);if(r){var n=r.schema,o=r.root,i=r.baseId,a=k.call(e,n,o,void 0,i);return e._fragments[t]=new O({ref:t,fragment:!0,schema:n,root:o,baseId:i,validate:a}),a}}function h(e,t){return t=T.normalizeId(t),e._schemas[t]||e._refs[t]||e._fragments[t]}function p(e){if(e instanceof RegExp)return f(this,this._schemas,e),void f(this,this._refs,e);switch(typeof e){case"undefined":return f(this,this._schemas),f(this,this._refs),void this._cache.clear();case"string":var t=h(this,e);return t&&this._cache.del(t.cacheKey),delete this._schemas[e],void delete this._refs[e];case"object":var r=this._opts.serialize,n=r?r(e):e;this._cache.del(n);var o=this._getId(e);o&&(o=T.normalizeId(o),delete this._schemas[o],delete this._refs[o])}}function f(e,t,r){for(var n in t){var o=t[n];o.meta||r&&!r.test(n)||(e._cache.del(o.cacheKey),delete t[n])}}function m(e,t,r,n){if("object"!=typeof e&&"boolean"!=typeof e)throw new Error("schema should be object or boolean");var o=this._opts.serialize,i=o?o(e):e,a=this._cache.get(i);if(a)return a;n=n||!1!==this._opts.addUsedSchema;var s=T.normalizeId(this._getId(e));s&&n&&S(this,s);var l,u=!1!==this._opts.validateSchema&&!t;u&&!(l=s&&s==T.normalizeId(e.$schema))&&this.validateSchema(e,!0);var c=T.ids.call(this,e),d=new O({id:s,schema:e,localRefs:c,cacheKey:i,meta:r});return"#"!=s[0]&&n&&(this._refs[s]=d),this._cache.put(i,d),u&&l&&this.validateSchema(e,!0),d}function v(e,t){function r(){var t=e.validate,n=t.apply(null,arguments);return r.errors=t.errors,n}if(e.compiling)return e.validate=r,r.schema=e.schema,r.errors=null,r.root=t||r,!0===e.schema.$async&&(r.$async=!0),r;e.compiling=!0;var n;e.meta&&(n=this._opts,this._opts=this._metaOpts);var o;try{o=k.call(this,e.schema,t,e.localRefs)}finally{e.compiling=!1,e.meta&&(this._opts=n)}return e.validate=o,e.refs=o.refs,e.refVal=o.refVal,e.root=o.root,o}function g(e){switch(e.schemaId){case"$id":return b;case"id":return y;default:return w}}function y(e){return e.$id&&console.warn("schema $id ignored",e.$id),e.id}function b(e){return e.id&&console.warn("schema id ignored",e.id),e.$id}function w(e){if(e.$id&&e.id&&e.$id!=e.id)throw new Error("schema $id is different from id");return e.$id||e.id}function _(e,t){if(!(e=e||this.errors))return"No errors";for(var r=void 0===(t=t||{}).separator?", ":t.separator,n=void 0===t.dataVar?"data":t.dataVar,o="",i=0;i<e.length;i++){var a=e[i];a&&(o+=n+a.dataPath+" "+a.message+r)}return o.slice(0,-r.length)}function E(e,t){"string"==typeof t&&(t=new RegExp(t)),this._formats[e]=t}function x(t){var r;if(t._opts.$data&&(r=e("./refs/$data.json"),t.addMetaSchema(r,r.$id,!0)),!1!==t._opts.meta){var n=e("./refs/json-schema-draft-06.json");t._opts.$data&&(n=M(n,V)),t.addMetaSchema(n,$,!0),t._refs["http://json-schema.org/schema"]=$}}function N(e){var t=e._opts.schemas;if(t)if(Array.isArray(t))e.addSchema(t);else for(var r in t)e.addSchema(t[r],r)}function C(e){for(var t in e._opts.formats){var r=e._opts.formats[t];e.addFormat(t,r)}}function S(e,t){if(e._schemas[t]||e._refs[t])throw new Error('schema with key or id "'+t+'" already exists')}function P(e){for(var t=j.copy(e._opts),r=0;r<U.length;r++)delete t[U[r]];return t}var k=e("./compile"),T=e("./compile/resolve"),A=e("./cache"),O=e("./compile/schema_obj"),R=e("json-stable-stringify"),I=e("./compile/formats"),D=e("./compile/rules"),M=e("./$data"),L=e("./patternGroups"),j=e("./compile/util"),F=e("co");t.exports=n,n.prototype.validate=o,n.prototype.compile=i,n.prototype.addSchema=a,n.prototype.addMetaSchema=s,n.prototype.validateSchema=l,n.prototype.getSchema=c,n.prototype.removeSchema=p,n.prototype.addFormat=E,n.prototype.errorsText=_,n.prototype._addSchema=m,n.prototype._compile=v,n.prototype.compileAsync=e("./compile/async");var B=e("./keyword");n.prototype.addKeyword=B.add,n.prototype.getKeyword=B.get,n.prototype.removeKeyword=B.remove;var H=e("./compile/error_classes");n.ValidationError=H.Validation,n.MissingRefError=H.MissingRef,n.$dataMetaSchema=M;var $="http://json-schema.org/draft-06/schema",U=["removeAdditional","useDefaults","coerceTypes"],V=["/properties"]},{"./$data":1,"./cache":2,"./compile":8,"./compile/async":4,"./compile/error_classes":6,"./compile/formats":7,"./compile/resolve":9,"./compile/rules":10,"./compile/schema_obj":11,"./compile/util":13,"./keyword":37,"./patternGroups":38,"./refs/$data.json":39,"./refs/json-schema-draft-06.json":40,co:47,"json-stable-stringify":48}]},{},[])("ajv")}),define("rxjs/util/isFunction",["require","exports","module"],function(e,t,r){function n(e){return"function"==typeof e}return t.isFunction=n,r.exports}),define("rxjs/util/isArray",["require","exports","module"],function(e,t,r){return t.isArray=Array.isArray||function(e){return e&&"number"==typeof e.length},r.exports}),define("rxjs/util/isObject",["require","exports","module"],function(e,t,r){function n(e){return null!=e&&"object"==typeof e}return t.isObject=n,r.exports}),define("rxjs/util/errorObject",["require","exports","module"],function(e,t,r){return t.errorObject={e:{}},r.exports}),define("rxjs/util/tryCatch",["require","exports","module","./errorObject"],function(e,t,r){function n(){try{return i.apply(this,arguments)}catch(e){return a.errorObject.e=e,a.errorObject}}function o(e){return i=e,n}var i,a=e("./errorObject");return t.tryCatch=o,r.exports}),define("rxjs/util/UnsubscriptionError",["require","exports","module"],function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(t){e.call(this),this.errors=t;var r=Error.call(this,t?t.length+" errors occurred during unsubscription:\n  "+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"");this.name=r.name="UnsubscriptionError",this.stack=r.stack,this.message=r.message}return n(t,e),t}(Error);return t.UnsubscriptionError=o,r.exports}),define("rxjs/Subscription",["require","exports","module","./util/isArray","./util/isObject","./util/isFunction","./util/tryCatch","./util/errorObject","./util/UnsubscriptionError"],function(e,t,r){function n(e){return e.reduce(function(e,t){return e.concat(t instanceof u.UnsubscriptionError?t.errors:t)},[])}var o=e("./util/isArray"),i=e("./util/isObject"),a=e("./util/isFunction"),s=e("./util/tryCatch"),l=e("./util/errorObject"),u=e("./util/UnsubscriptionError"),c=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var r=this,c=r._parent,d=r._parents,h=r._unsubscribe,p=r._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var f=-1,m=d?d.length:0;c;)c.remove(this),c=++f<m&&d[f]||null;if(a.isFunction(h)){var v=s.tryCatch(h).call(this);v===l.errorObject&&(t=!0,e=e||(l.errorObject.e instanceof u.UnsubscriptionError?n(l.errorObject.e.errors):[l.errorObject.e]))}if(o.isArray(p))for(f=-1,m=p.length;++f<m;){var g=p[f];if(i.isObject(g)){var v=s.tryCatch(g.unsubscribe).call(g);if(v===l.errorObject){t=!0,e=e||[];var y=l.errorObject.e;y instanceof u.UnsubscriptionError?e=e.concat(n(y.errors)):e.push(y)}}}if(t)throw new u.UnsubscriptionError(e)}},e.prototype.add=function(t){if(!t||t===e.EMPTY)return e.EMPTY;if(t===this)return this;var r=t;switch(typeof t){case"function":r=new e(t);case"object":if(r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if("function"!=typeof r._addParent){var n=r;r=new e,r._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var o=this._subscriptions||(this._subscriptions=[]);return o.push(r),r._addParent(this),r},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var r=t.indexOf(e);r!==-1&&t.splice(r,1)}},e.prototype._addParent=function(e){var t=this,r=t._parent,n=t._parents;r&&r!==e?n?n.indexOf(e)===-1&&n.push(e):this._parents=[e]:this._parent=e},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();return t.Subscription=c,r.exports}),define("rxjs/Observer",["require","exports","module"],function(e,t,r){return t.empty={closed:!0,next:function(e){},error:function(e){throw e},complete:function(){}},r.exports}),define("rxjs/util/root",["require","exports","module"],function(e,t,r){var n="undefined"!=typeof window&&window,o="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,i="undefined"!=typeof global&&global,a=n||i||o;return t.root=a,function(){if(!a)throw new Error("RxJS could not find any global context (window, self, global)")}(),r.exports}),define("rxjs/symbol/rxSubscriber",["require","exports","module","../util/root"],function(e,t,r){var n=e("../util/root"),o=n.root.Symbol;return t.rxSubscriber="function"==typeof o&&"function"==typeof o.for?o.for("rxSubscriber"):"@@rxSubscriber",t.$$rxSubscriber=t.rxSubscriber,r.exports}),define("rxjs/Subscriber",["require","exports","module","./util/isFunction","./Subscription","./Observer","./symbol/rxSubscriber"],function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=e("./util/isFunction"),i=e("./Subscription"),a=e("./Observer"),s=e("./symbol/rxSubscriber"),l=function(e){function t(r,n,o){switch(e.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=a.empty;break;case 1:if(!r){this.destination=a.empty;break}if("object"==typeof r){r instanceof t?(this.destination=r,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new u(this,r));break}default:this.syncErrorThrowable=!0,this.destination=new u(this,r,n,o)}}return n(t,e),t.prototype[s.rxSubscriber]=function(){return this},t.create=function(e,r,n){var o=new t(e,r,n);return o.syncErrorThrowable=!1,o},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this,t=e._parent,r=e._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=r,this},t}(i.Subscription);t.Subscriber=l;var u=function(e){function t(t,r,n,i){e.call(this),this._parentSubscriber=t;var s,l=this;o.isFunction(r)?s=r:r&&(s=r.next,n=r.error,i=r.complete,r!==a.empty&&(l=Object.create(r),o.isFunction(l.unsubscribe)&&this.add(l.unsubscribe.bind(l)),l.unsubscribe=this.unsubscribe.bind(this))),this._context=l,this._next=s,this._error=n,this._complete=i}return n(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var r=function(){return e._complete.call(e._context)};t.syncErrorThrowable?(this.__tryOrSetError(t,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){throw this.unsubscribe(),e}},t.prototype.__tryOrSetError=function(e,t,r){try{t.call(this._context,r)}catch(t){return e.syncErrorValue=t,e.syncErrorThrown=!0,!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(l);return r.exports}),define("rxjs/operators/filter",["require","exports","module","../Subscriber"],function(e,t,r){function n(e,t){return function(r){return r.lift(new a(e,t))}}var o=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("../Subscriber");t.filter=n;var a=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate,this.thisArg))},e}(),s=function(e){function t(t,r,n){e.call(this,t),this.predicate=r,this.thisArg=n,this.count=0}return o(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(i.Subscriber);return r.exports}),define("rxjs/util/toSubscriber",["require","exports","module","../Subscriber","../symbol/rxSubscriber","../Observer"],function(e,t,r){function n(e,t,r){if(e){if(e instanceof o.Subscriber)return e;if(e[i.rxSubscriber])return e[i.rxSubscriber]()}return e||t||r?new o.Subscriber(e,t,r):new o.Subscriber(a.empty)}var o=e("../Subscriber"),i=e("../symbol/rxSubscriber"),a=e("../Observer");return t.toSubscriber=n,r.exports}),define("rxjs/symbol/observable",["require","exports","module","../util/root"],function(e,t,r){function n(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}var o=e("../util/root");return t.getSymbolObservable=n,t.observable=n(o.root),t.$$observable=t.observable,r.exports}),define("rxjs/util/noop",["require","exports","module"],function(e,t,r){function n(){}return t.noop=n,r.exports}),define("rxjs/util/pipe",["require","exports","module","./noop"],function(e,t,r){function n(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return o(e)}function o(e){return e?1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}:i.noop}var i=e("./noop");return t.pipe=n,t.pipeFromArray=o,r.exports}),define("rxjs/Observable",["require","exports","module","./util/root","./util/toSubscriber","./symbol/observable","./util/pipe"],function(e,t,r){var n=e("./util/root"),o=e("./util/toSubscriber"),i=e("./symbol/observable"),a=e("./util/pipe"),s=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n=this.operator,i=o.toSubscriber(e,t,r);if(n?n.call(i,this.source):i.add(this.source?this._subscribe(i):this._trySubscribe(i)),i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.syncErrorThrown=!0,e.syncErrorValue=t,e.error(t)}},e.prototype.forEach=function(e,t){var r=this;if(t||(n.root.Rx&&n.root.Rx.config&&n.root.Rx.config.Promise?t=n.root.Rx.config.Promise:n.root.Promise&&(t=n.root.Promise)),!t)throw new Error("no Promise impl found");return new t(function(t,n){var o;o=r.subscribe(function(t){if(o)try{e(t)}catch(e){n(e),o.unsubscribe()}else e(t)},n,t)})},e.prototype._subscribe=function(e){return this.source.subscribe(e)},e.prototype[i.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 0===e.length?this:a.pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;if(e||(n.root.Rx&&n.root.Rx.config&&n.root.Rx.config.Promise?e=n.root.Rx.config.Promise:n.root.Promise&&(e=n.root.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,r){var n;t.subscribe(function(e){return n=e},function(e){return r(e)},function(){return e(n)})})},e.create=function(t){return new e(t)},e}();return t.Observable=s,r.exports}),define("rxjs/util/ObjectUnsubscribedError",["require","exports","module"],function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(){var t=e.call(this,"object unsubscribed");this.name=t.name="ObjectUnsubscribedError",this.stack=t.stack,this.message=t.message}return n(t,e),t}(Error);return t.ObjectUnsubscribedError=o,r.exports}),define("rxjs/SubjectSubscription",["require","exports","module","./Subscription"],function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=e("./Subscription"),i=function(e){function t(t,r){e.call(this),this.subject=t,this.subscriber=r,this.closed=!1}return n(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var r=t.indexOf(this.subscriber);r!==-1&&t.splice(r,1)}}},t}(o.Subscription);return t.SubjectSubscription=i,r.exports}),define("rxjs/Subject",["require","exports","module","./Observable","./Subscriber","./Subscription","./util/ObjectUnsubscribedError","./SubjectSubscription","./symbol/rxSubscriber"],function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=e("./Observable"),i=e("./Subscriber"),a=e("./Subscription"),s=e("./util/ObjectUnsubscribedError"),l=e("./SubjectSubscription"),u=e("./symbol/rxSubscriber"),c=function(e){function t(t){e.call(this,t),this.destination=t}return n(t,e),t}(i.Subscriber);t.SubjectSubscriber=c;var d=function(e){function t(){e.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return n(t,e),t.prototype[u.rxSubscriber]=function(){return new c(this)},t.prototype.lift=function(e){var t=new h(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new s.ObjectUnsubscribedError;if(!this.isStopped)for(var t=this.observers,r=t.length,n=t.slice(),o=0;o<r;o++)n[o].next(e)},t.prototype.error=function(e){if(this.closed)throw new s.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,r=t.length,n=t.slice(),o=0;o<r;o++)n[o].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new s.ObjectUnsubscribedError;this.isStopped=!0;for(var e=this.observers,t=e.length,r=e.slice(),n=0;n<t;n++)r[n].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new s.ObjectUnsubscribedError;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new s.ObjectUnsubscribedError;return this.hasError?(e.error(this.thrownError),a.Subscription.EMPTY):this.isStopped?(e.complete(),a.Subscription.EMPTY):(this.observers.push(e),new l.SubjectSubscription(this,e))},t.prototype.asObservable=function(){var e=new o.Observable;return e.source=this,e},t.create=function(e,t){return new h(e,t)},t}(o.Observable);t.Subject=d;var h=function(e){function t(t,r){e.call(this),this.destination=t,this.source=r}return n(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){var t=this.source;return t?this.source.subscribe(e):a.Subscription.EMPTY},t}(d);return t.AnonymousSubject=h,r.exports}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("salve",[],t):"object"==typeof exports?exports.salve=t():e.salve=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=31)}([function(e,t,r){function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}function o(e,t){e.prototype.newWalker=function(e){return new t(this,e)}}function i(e){return e.hash()}function a(e){function t(e){return e}e instanceof _.NaiveSet&&(e=e.toArray());var r=new c.HashMap(t);e.forEach(function(e){for(var n=e.params,o=r,i=0;i<n.length;++i)if(i===n.length-1)o.add(n[i],!1);else{var a=o.has(n[i]);void 0===a&&(a=new c.HashMap(t),o.add(n[i],a)),o=a}});var n=function(){var e="",t="    ";return function(r){var o="",i=r.keys();i.sort();for(var a=0,s=i;a<s.length;a++){var l=s[a],u=r.has(l);u!==!1?(o+=""+e+l+":\n",e+=t,o+=n(r.has(l)),e=e.slice(t.length)):o+=""+e+l+"\n"}return o}}();return n(r)}function s(e,t){if(void 0===t&&(t=""),e instanceof c.HashMap)return e;throw new Error("did not get a HashMap "+t)}function l(e,t){if(void 0===t&&(t=""),e instanceof d.NameResolver)return e;throw new Error("did not get a HashMap "+t)}var u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var c=r(8),d=r(3),h=r(30),p=!1;if(p){var f=function(e){console.log(e)},m=function(){f((new Error).stack)};n(m);var v,g,y,b;!function(){var e="",t=" ",r=function(e){var t=e.el;if(null==t)return"";if(void 0===t.name)return" with path "+t.xmlPath;var r=" named "+t.name.toString();return null==e.boundName?r:r+" (bound to "+e.boundName.toString()+")"};b=function(t,n,o){f(""+e+t+n+" on class "+o.constructor.name+(" id "+o.id+r(o)))},v=function(r,n,o){e+=t,b("calling ",n,this);var i=r.apply(this,o);return b("called ",n,this),f(e+"return from the call: "+h.inspect(i)),e=e.slice(t.length),i},g=function(r,n,o){e+=t,b("calling ",n,this),f(e+h.inspect(o[0]));var i=r.apply(this,o);return b("called ",n,this),i!==!1&&f(e+"return from the call: "+h.inspect(i)),e=e.slice(t.length),i},y=function(r,n,o){e+=t,b("calling ",n,this);var i=r.apply(this,o);return b("called ",n,this),f(e+"return from the call: "+h.inspect(i)),e=e.slice(t.length),i}}();var w=function(e,t,r){var n="___"+t;e[n]=e[t],e[t]=function(){return r.call(this,e[n],t,arguments)}};n(w)}t.addWalker=o;var _=r(13),E=r(13);t.EventSet=E.NaiveSet;var x=function(){function e(e){this.id="P"+this.__newID(),this.xmlPath=e}return e.prototype.hash=function(){return this.id},e.prototype._resolve=function(e){},e.prototype._prepare=function(e){},e.prototype._hasAttrs=function(){return!1},e.prototype._gatherElementDefinitions=function(e){},e.prototype.__newID=function(){return e.__id++},e.__id=0,e}();t.BasePattern=x;var N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.newWalker=function(e){throw new Error("derived classes must override this")},t}(x);t.Pattern=N;var C=function(e){function t(t,r){var n=e.call(this,t)||this;return n.pat=r,n}return u(t,e),t.prototype._resolve=function(e){return this.pat._resolve(e)},t.prototype._prepare=function(e){this.pat._prepare(e)},t.prototype._hasAttrs=function(){return this.pat._hasAttrs()},t.prototype._gatherElementDefinitions=function(e){this.pat._gatherElementDefinitions(e)},t}(N);t.OneSubpattern=C;var S=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.patA=r,o.patB=n,o}return u(t,e),t.prototype._resolve=function(e){var t=this.patA._resolve(e),r=this.patB._resolve(e);return void 0!==t&&void 0!==r?t.concat(r):void 0!==t?t:r},t.prototype._prepare=function(e){this.patA._prepare(e),this.patB._prepare(e)},t.prototype._hasAttrs=function(){return this.patA._hasAttrs()||this.patB._hasAttrs()},t.prototype._gatherElementDefinitions=function(e){this.patA._gatherElementDefinitions(e),this.patB._gatherElementDefinitions(e)},t}(N);t.TwoSubpatterns=S;var P=function(){function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];
var n=1===t.length&&t[0]instanceof Array?t[0]:t,o=n.join(),i=e.__cache[o];return void 0!==i?i:(this.id="E"+this.__newID(),this.params=n,this.key=o,e.__cache[o]=this,this)}return e.prototype.hash=function(){return this.id},e.prototype.isAttributeEvent=function(){return"attributeName"===this.params[0]||"attributeValue"===this.params[0]},e.prototype.toString=function(){return"Event: "+this.params.join(", ")},e.prototype.__newID=function(){return e.__id++},e.__cache=Object.create(null),e.__id=0,e}();t.Event=P,t.eventsToTreeString=a,t.emptyEvent=new P("<empty>");var k=function(){function e(t){this.id="W"+this.__newID(),this.suppressedAttributes=!1,t instanceof e?(this.el=t.el,this.possibleCached=t.possibleCached,this.suppressedAttributes=t.suppressedAttributes):this.el=t,p&&(w(this,"_possible",v),w(this,"fireEvent",g),w(this,"end",y),w(this,"_suppressAttributes",y),w(this,"_clone",y))}return e.prototype.hash=function(){return this.id},e.prototype.possible=function(){return new _.NaiveSet(this._possible())},e.prototype.canEnd=function(e){return void 0===e&&(e=!1),!0},e.prototype.end=function(e){return void 0===e&&(e=!1),!1},e.prototype.clone=function(){return this._clone(new c.HashMap(i))},e.prototype._clone=function(e){return new this.constructor(this,e)},e.prototype._suppressAttributes=function(){this.suppressedAttributes=!0},e.prototype._cloneIfNeeded=function(e,t){var r=t.has(e);return void 0!==r?r:(r=e.clone(),t.add(e,r),r)},e.prototype.__newID=function(){return e.__id++},e.__id=0,e}();t.Walker=k,t.isHashMap=s,t.isNameResolver=l;var T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype._possible=function(){return this.subwalker.possible()},t.prototype.fireEvent=function(e){return this.subwalker.fireEvent(e)},t.prototype._suppressAttributes=function(){this.suppressedAttributes||(this.suppressedAttributes=!0,this.subwalker._suppressAttributes())},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this.subwalker.canEnd(e)},t.prototype.end=function(e){return void 0===e&&(e=!1),this.subwalker.end(e)},t}(k);t.SingleSubwalker=T;var A=function(e){function t(t,r){var n=e.call(this,t)||this;return n.name=r,n}return u(t,e),t.prototype._prepare=function(){},t.prototype._resolve=function(e){if(this.resolvesTo=e[this.name],void 0===this.resolvesTo)return[this]},t.prototype.newWalker=function(e){return this.resolvesTo.pat.newWalker(e)},t}(N);t.Ref=A;var O=function(e){function t(t,r,n){var o=e.call(this,t,n)||this;return o.name=r,o}return u(t,e),t}(C);t.Define=O;var R=function(e){function t(r,n){var o=this;if(r instanceof t){var i=r,a=s(n);o=e.call(this,i,a)||this,o.nameResolver=o._cloneIfNeeded(i.nameResolver,a),o.subwalker=i.subwalker._clone(a)}else{var u=r,c=l(n);o=e.call(this,u)||this,o.nameResolver=c,o.subwalker=u.pat.newWalker(o.nameResolver)}return o}return u(t,e),t}(T);o(O,R)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.msg=e}return e.prototype.toString=function(){return this.toStringWithNames(this.getNames())},e.prototype.getNames=function(){return[]},e.prototype.toStringWithNames=function(e){return this.msg},e.prototype.equals=function(e){return this===e||this.toString()===e.toString()},e}();t.ValidationError=o;var i=function(e){function t(t,r){var n=e.call(this,t)||this;return n.name=r,n}return n(t,e),t.prototype.getNames=function(){return[this.name]},t.prototype.toStringWithNames=function(e){return this.msg+": "+e[0].toString()},t}(o);t.SingleNameError=i;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i);t.AttributeNameError=a;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i);t.AttributeValueError=s;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i);t.ElementNameError=l;var u=function(e){function t(t,r){var n=e.call(this,"")||this;return n.namesA=t,n.namesB=r,n}return n(t,e),t.prototype.getNames=function(){return this.namesA.concat(this.namesB)},t.prototype.toStringWithNames=function(e){var t=e.slice(0,this.namesA.length),r=e.slice(this.namesA.length);return"must choose either "+t.join(", ")+" or "+r.join(", ")},t}(o);t.ChoiceError=u},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.path=e}return e.prototype.getNamespaces=function(){var e=Object.create(null);return this._recordNamespaces(e),Object.keys(e)},e.prototype.toJSON=function(){return this.toObject()},e.prototype.toString=function(){return JSON.stringify(this)},e}();t.Base=o;var i=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.ns=r,o.name=n,o}return n(t,e),t.prototype.match=function(e,t){return this.ns===e&&this.name===t},t.prototype.wildcardMatch=function(e,t){return!1},t.prototype.toObject=function(){return{ns:this.ns,name:this.name}},t.prototype.simple=function(){return!0},t.prototype.toArray=function(){return[this]},t.prototype._recordNamespaces=function(e){e[this.ns]=1},t}(o);t.Name=i;var a=function(e){function t(t,r){var n=e.call(this,t)||this;return n.a=r[0],n.b=r[1],n}return n(t,e),t.prototype.match=function(e,t){return this.a.match(e,t)||this.b.match(e,t)},t.prototype.wildcardMatch=function(e,t){return this.a.wildcardMatch(e,t)||this.b.wildcardMatch(e,t)},t.prototype.toObject=function(){return{a:this.a.toObject(),b:this.b.toObject()}},t.prototype.simple=function(){return this.a.simple()&&this.b.simple()},t.prototype.toArray=function(){var e=this.a.toArray();if(null===e)return null;var t=this.b.toArray();return null===t?null:e.concat(t)},t.prototype._recordNamespaces=function(e){this.a._recordNamespaces(e),this.b._recordNamespaces(e)},t}(o);t.NameChoice=a;var s=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.ns=r,o.except=n,o}return n(t,e),t.prototype.match=function(e,t){return this.ns===e&&!(void 0!==this.except&&this.except.match(e,t))},t.prototype.wildcardMatch=function(e,t){return this.match(e,t)},t.prototype.toObject=function(){var e={ns:this.ns};return void 0!==this.except&&(e.except=this.except.toObject()),e},t.prototype.simple=function(){return!1},t.prototype.toArray=function(){return null},t.prototype._recordNamespaces=function(e){e[this.ns]=1,void 0!==this.except&&(e["::except"]=1)},t}(o);t.NsName=s;var l=function(e){function t(t,r){var n=e.call(this,t)||this;return n.except=r,n}return n(t,e),t.prototype.match=function(e,t){return void 0===this.except||!this.except.match(e,t)},t.prototype.wildcardMatch=function(e,t){return this.match(e,t)},t.prototype.toObject=function(){var e={pattern:"AnyName"};return void 0!==this.except&&(e.except=this.except.toObject()),e},t.prototype.simple=function(){return!1},t.prototype.toArray=function(){return null},t.prototype._recordNamespaces=function(e){e["*"]=1,void 0!==this.except&&(e["::except"]=1)},t}(o);t.AnyName=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(4);t.XML1_NAMESPACE="http://www.w3.org/XML/1998/namespace",t.XMLNS_NAMESPACE="http://www.w3.org/2000/xmlns/";var o=function(){function e(){this.forward=Object.create(null),this.backwards=Object.create(null)}return e}(),i=function(){function e(e){this.id="N"+this.__newID(),void 0!==e?this._contextStack=e._contextStack.slice():(this._contextStack=[],this.enterContext(),this._contextStack[0].forward.xml=t.XML1_NAMESPACE,this._contextStack[0].backwards[t.XML1_NAMESPACE]=["xml"],this._contextStack[0].forward.xmlns=t.XMLNS_NAMESPACE,this._contextStack[0].backwards[t.XMLNS_NAMESPACE]=["xmlns"])}return e.prototype.hash=function(){return this.id},e.prototype.clone=function(){return new e(this)},e.prototype.definePrefix=function(e,r){if("xmlns"===e)throw new Error("trying to define 'xmlns' but the XML Namespaces standard stipulates that 'xmlns' cannot be declared (= \"defined\")");if("xml"===e&&r!==t.XML1_NAMESPACE)throw new Error("trying to define 'xml' to an incorrect URI");this._contextStack[0].forward[e]=r;var n=this._contextStack[0].backwards[r];void 0===n&&(n=this._contextStack[0].backwards[r]=[]),""===e?n.unshift(""):n.push(e)},e.prototype.enterContext=function(){this._contextStack.unshift(new o)},e.prototype.leaveContext=function(){if(!(this._contextStack.length>1))throw new Error("trying to leave the default context");this._contextStack.shift()},e.prototype.resolveName=function(e,t){void 0===t&&(t=!1);var r=e.split(":");if(1===r.length){if(t)return new n.EName("",e);r=["",e]}if(r.length>2)throw new Error("invalid name passed to resolveName");for(var o,i=0;void 0===o&&i<this._contextStack.length;++i){var a=this._contextStack[i];o=a.forward[r[0]]}return void 0===o?""===r[0]?new n.EName("",r[1]):void 0:new n.EName(o,r[1])},e.prototype.unresolveName=function(e,t){if(""===e)return t;for(var r,n=0;void 0===r&&n<this._contextStack.length;++n){var o=this._contextStack[n];r=o.backwards[e]}if(void 0!==r){var i=r[0];return""!==i?i+":"+t:t}},e.prototype.prefixFromURI=function(e){for(var t,r=0;void 0===t&&r<this._contextStack.length;++r){var n=this._contextStack[r];t=n.backwards[e]}if(void 0!==t)return t[0]},e.prototype.__newID=function(){return e.__id++},e.__id=0,e}();t.NameResolver=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.ns=e,this.name=t}return e.prototype.toString=function(){return"{"+this.ns+"}"+this.name},e.prototype.equal=function(e){return this.ns===e.ns&&this.name===e.name},e}();t.EName=n},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(7),i=function(){function e(e){this.message=e}return e.prototype.toString=function(){return this.message},e}();t.ParamError=i;var a=function(){function e(e){this.message=e}return e.prototype.toString=function(){return this.message},e}();t.ValueError=a;var s=function(e){function t(r,n){var i=e.call(this)||this;i.errors=n;var a=r+": "+n.map(function(e){return e.toString()}).join("\n"),s=new Error(a);return i.name="ParameterParsingError",i.stack=s.stack,i.message=s.message,o.fixPrototype(i,t),i}return n(t,e),t}(Error);t.ParameterParsingError=s;var l=function(e){function t(r){var n=e.call(this)||this;n.errors=r;var i=r.map(function(e){return e.toString()}).join("\n"),a=new Error(i);return n.name="ValueValidationError",n.stack=a.stack,n.message=a.message,o.fixPrototype(n,t),n}return n(t,e),t}(Error);t.ValueValidationError=l},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o.Pattern);t.NotAllowed=i;var a=function(e){function t(r,n){var i=this;if(r instanceof t){var a=r;n=o.isHashMap(n),i=e.call(this,a,n)||this}else{var s=r;i=e.call(this,s)||this,i.possibleCached=new o.EventSet}return i}return n(t,e),t.prototype.possible=function(){return new o.EventSet},t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){},t}(o.Walker);t.NotAllowedWalker=a,o.addWalker(i,a)},function(e,t,r){function n(e,t){for(var r in t)e[r]=t[r]}function o(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var o=0,i=t;o<i.length;o++){var a=i[o];n(e,a)}return e}function i(e,t){var r=void 0!==Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__;r!==t&&(void 0!==Object.setPrototypeOf?Object.setPrototypeOf(e,t.prototype):e.__proto__=t.prototype)}Object.defineProperty(t,"__esModule",{value:!0}),t.extend=o,t.fixPrototype=i},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(t,r){if(this.hashF=t,this.backing=Object.create(null),this._size=0,void 0!==r)if(r instanceof e){for(var n=this.backing,o=r.backing,i=Object.keys(o),a=0,s=i;a<s.length;a++){var l=s[a];n[l]=o[l]}this._size=i.length}else if(r instanceof Array)for(var u=0,c=r;u<c.length;u++){var d=c[u];this.add(d)}else this.add(r)}return e.prototype.union=function(e){if(null!=e){if(!(e instanceof this.constructor))throw new Error("union invalid class object; my class "+this.constructor.name+" other class "+e.constructor.name);for(var t=e.backing,r=Object.keys(t),n=0,o=r;n<o.length;n++){var i=o[n];this._store(i,t[i])}}},e.prototype.forEach=function(e){for(var t=this.backing,r=Object.keys(t),n=0,o=r;n<o.length;n++){var i=o[n];e(t[i])}},e.prototype.size=function(){return this._size},e.prototype.filter=function(e){var t=new this.constructor;void 0===t.hashF&&(t.hashF=this.hashF);for(var r=this.backing,n=Object.keys(r),o=0,i=n;o<i.length;o++){var a=i[o],s=r[a],l=s instanceof Array?s:[s];e.apply(void 0,l)&&t._store(a,s)}return t},e.prototype.has=function(e){var t=this.hashF(e);return void 0!==this.backing[t]},e.prototype.toString=function(){return this.toArray().join(", ")},e.prototype.toArray=function(){for(var e=[],t=this.backing,r=Object.keys(t),n=0,o=r;n<o.length;n++){var i=o[n];e.push(t[i])}return e},e.prototype._store=function(e,t){if(null==e)throw new Error("undefined or null hash");void 0===this.backing[e]&&(this.backing[e]=t,this._size++)},e}();t.HashBase=o;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.add=function(e){this._store(this.hashF(e),e)},t}(o);t.HashSet=i;var a=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.hashF=t,n}return n(t,e),t.prototype.add=function(e,t){this._store(this.hashF(e),[e,t])},t.prototype.forEach=function(e){for(var t=this.backing,r=Object.keys(t),n=0,o=r;n<o.length;n++){var i=o[n];e(t[i][0],t[i][1])}},t.prototype.has=function(e){var t=this.hashF(e),r=this.backing[t];if(void 0!==r)return r[1]},t.prototype.keys=function(){return Object.keys(this.backing)},t}(o);t.HashMap=a},function(e,t,r){function n(){return x}Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),i=r(18),a=r(0),s=r(19),l=r(20),u=r(21),c=r(22),d=r(12),h=r(23),p=r(24),f=r(25),m=r(6),v=r(26),g=r(27),y=r(28),b=r(29),w=r(2),_=r(0);t.eventsToTreeString=_.eventsToTreeString,t.Event=_.Event,t.EventSet=_.EventSet,t.BasePattern=_.BasePattern,t.Walker=_.Walker;var E=r(12);t.Grammar=E.Grammar,t.GrammarWalker=E.GrammarWalker,t.RefError=E.RefError;var x={GrammarWalker:d.GrammarWalker,Text:y.Text};t.__test=n,t.__protected={Empty:c.Empty,Data:l.Data,List:f.List,Param:g.Param,Value:b.Value,NotAllowed:m.NotAllowed,Text:y.Text,Ref:a.Ref,OneOrMore:v.OneOrMore,Choice:s.Choice,Group:h.Group,Attribute:i.Attribute,Element:u.Element,Define:a.Define,Grammar:d.Grammar,EName:o.EName,Interleave:p.Interleave,Name:w.Name,NameChoice:w.NameChoice,NsName:w.NsName,AnyName:w.AnyName}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(15),o=r(17),i=function(){function e(){this.libraries=Object.create(null)}return e.prototype.add=function(e){var t=e.uri;if(t in this.libraries)throw new Error("URI clash: "+t);this.libraries[t]=e},e.prototype.find=function(e){return this.libraries[e]},e.prototype.get=function(e){var t=this.find(e);if(void 0===t)throw new Error("can't get library with URI: "+e);return t},e}();t.Registry=i,t.registry=new i,t.registry.add(n.builtin),t.registry.add(o.xmlschema);var a=r(5);t.ParameterParsingError=a.ParameterParsingError,t.ValueValidationError=a.ValueValidationError,t.ValueError=a.ValueError},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n="A-Z_a-z----------------------------------------------------------------------------------------------------------------------------------------------------",o="--";t.xmlLetter=n+o;var i="0-9--------------",a="------------------------------------------------------------------",s="---";t.xmlNameChar="-"+t.xmlLetter+i+"._:"+a+s;var l="["+t.xmlLetter+"_:](?:["+t.xmlNameChar+"])*";t.xmlNameRe=new RegExp("^"+l+"$"),t.xmlNcname="["+t.xmlLetter+"_](?:[-"+t.xmlLetter+i+"._"+a+(s+"])*"),t.xmlNcnameRe=new RegExp("^"+t.xmlNcname+"$")},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),i=r(2),a=r(3),s=r(7),l=r(0),u=function(e){function t(r){var n=e.call(this)||this;return n.references=r,s.fixPrototype(n,t),n}return n(t,e),t.prototype.toString=function(){return"Cannot resolve the following references: "+this.references.join(", ")},t}(Error);t.RefError=u;var c=function(e){function t(t,r,n){var o=e.call(this,t)||this;o.xmlPath=t,o.start=r,o.definitions=Object.create(null),o._namespaces=Object.create(null),void 0!==n&&n.forEach(function(e){o.add(e)});var i=o._resolve(o.definitions);if(void 0!==i)throw new u(i);return o._prepare(o._namespaces),o}return n(t,e),t.prototype.add=function(e){this.definitions[e.name]=e,"start"===e.name&&(this.start=e)},t.prototype._gatherElementDefinitions=function(e){for(var t in this.definitions)this.definitions[t]._gatherElementDefinitions(e)},Object.defineProperty(t.prototype,"elementDefinitions",{get:function(){var e=this._elementDefinitions;if(void 0!==e)return e;var t=this._elementDefinitions=Object.create(null);return this._gatherElementDefinitions(t),t},enumerable:!0,configurable:!0}),t.prototype.whollyContextIndependent=function(){var e=this.elementDefinitions;for(var t in e)if(e[t].length>1)return!1;return!0},t.prototype.getNamespaces=function(){return Object.keys(this._namespaces)},t.prototype._prepare=function(e){this.start._prepare(e);for(var t in this.definitions)this.definitions[t]._prepare(e)},t.prototype._resolve=function(e){var t,r=[];for(var n in e)t=e[n]._resolve(e),void 0!==t&&(r=r.concat(t));if(t=this.start._resolve(e),void 0!==t&&(r=r.concat(t)),0!==r.length)return r},t.prototype.newWalker=function(){return d.makeWalker(this)},t}(l.BasePattern);t.Grammar=c;var d=function(e){function t(r,n){var o=this;if(r instanceof t){var i=r;n=l.isHashMap(n),o=e.call(this,i,n)||this,o.nameResolver=o._cloneIfNeeded(i.nameResolver,n),o.subwalker=i.subwalker._clone(n);for(var s=o._misplacedElements=[],u=0,c=i._misplacedElements;u<c.length;u++){var d=c[u];s.push(d instanceof l.Walker?d._clone(n):d.concat([]))}o._swallowAttributeValue=i._swallowAttributeValue,o.suspendedWs=i.suspendedWs,o.ignoreNextWs=i.ignoreNextWs,o._prevEvWasText=i._prevEvWasText}else{var h=r;o=e.call(this,h)||this,o.nameResolver=new a.NameResolver,o._misplacedElements=[],o._swallowAttributeValue=!1,o.ignoreNextWs=!1,o._prevEvWasText=!1,o.subwalker=h.start.newWalker(o.nameResolver)}return o}return n(t,e),t.makeWalker=function(e){return new t(e)},t.prototype.resolveName=function(e,t){return this.nameResolver.resolveName(e,t)},t.prototype.unresolveName=function(e,t){return this.nameResolver.unresolveName(e,t)},t.prototype.fireEvent=function(e){function t(e){if(void 0===r&&(r=[new o.ValidationError("text not allowed here")]),r===!1)return e;if(e===!1)return r;if(void 0===e)throw new Error("undefined x");return r.concat(e)}var r=!1;if("enterContext"===e.params[0]||"leaveContext"===e.params[0]||"definePrefix"===e.params[0]){switch(e.params[0]){case"enterContext":this.nameResolver.enterContext();break;case"leaveContext":this.nameResolver.leaveContext();break;case"definePrefix":this.nameResolver.definePrefix(e.params[1],e.params[2]);break;default:throw new Error("unexpected event: "+e.params[0])}return!1}if("text"===e.params[0]&&""===e.params[1].trim())return void 0!==this.suspendedWs?this.suspendedWs+=e.params[1]:this.suspendedWs=e.params[1],!1;var n=this._misplacedElements.length>0&&this._misplacedElements[0]instanceof l.Walker?this._misplacedElements[0]:this.subwalker,a=this.ignoreNextWs;switch(this.ignoreNextWs=!1,e.params[0]){case"enterStartTag":this.suspendedWs=void 0;break;case"text":if(this._prevEvWasText)throw new Error("fired two text events in a row: this is disallowed by salve");if(a){this.suspendedWs=void 0;var s=e.params[1].replace(/^\s+/,"");s.length!==e.params[1].length&&(e=new l.Event("text",s))}else void 0!==this.suspendedWs&&""!==this.suspendedWs&&(r=n.fireEvent(new l.Event("text",this.suspendedWs)),this.suspendedWs=void 0);break;case"endTag":this.ignoreNextWs=!0;default:void 0===this.suspendedWs||""===this.suspendedWs||a||(r=n.fireEvent(new l.Event("text",this.suspendedWs))),this.suspendedWs=void 0}if(this._prevEvWasText="text"===e.params[0],this._misplacedElements.length>0&&this._misplacedElements[0]instanceof Array){var u=this._misplacedElements[0];switch(e.params[0]){case"enterStartTag":u.unshift(e.params.slice(1));break;case"endTag":u.shift()}return 0===u.length&&this._misplacedElements.shift(),!1}if(this._swallowAttributeValue)return this._swallowAttributeValue=!1,"attributeValue"!==e.params[0]&&[new o.ValidationError("attribute value required")];var c=n.fireEvent(e);if(void 0===c)switch(e.params[0]){case"enterStartTag":var d=new i.Name("",e.params[1],e.params[2]);c=[new o.ElementNameError("tag not allowed here",d)];var h=this.el.elementDefinitions[d.toString()];if(void 0!==h&&1===h.length){var p=h[0].newWalker(this.nameResolver);if(this._misplacedElements.unshift(p),p.fireEvent(e)!==!1)throw new Error("internal error: the inferred element does not accept its initial event")}else this._misplacedElements.unshift([e.params.slice(1)]);break;case"endTag":c=[new o.ElementNameError("unexpected end tag",new i.Name("",e.params[1],e.params[2]))];break;case"attributeName":c=[new o.AttributeNameError("attribute not allowed here",new i.Name("",e.params[1],e.params[2]))],this._swallowAttributeValue=!0;break;case"attributeValue":c=[new o.ValidationError("unexpected attributeValue event; it is likely that fireEvent is incorrectly called")];break;case"text":c=[new o.ValidationError("text not allowed here")];break;case"leaveStartTag":default:throw new Error("unexpected event type in GrammarWalker's fireEvent: "+e.params[0].toString())}if(this._misplacedElements.length>0&&this._misplacedElements[0]instanceof l.Walker&&(n=this._misplacedElements[0],n.canEnd())){this._misplacedElements.shift();var f=n.end();f&&(c=c?c.concat(f):f)}return t(c)},t.prototype.possible=function(){if(0!==this._misplacedElements.length){var e=this._misplacedElements[0];return e instanceof l.Walker?e.possible():new l.EventSet}return this.subwalker.possible()},t.prototype._suppressAttributes=function(){throw new Error("_suppressAttributes cannot be called on a GrammarWalker")},t}(l.SingleSubwalker);t.GrammarWalker=d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(t){if(null!=t)if(t instanceof e)this.b=t.b.concat([]);else if(t instanceof Array){this.b=[];for(var r=0,n=t;r<n.length;r++){var o=n[r];this.add(o)}}else this.b=[t];else this.b=[]}return e.prototype.add=function(e){var t=this.b.indexOf(e);t<0&&this.b.push(e)},e.prototype.union=function(t){if(null!=t){if(!(t instanceof e))throw new Error("union with non-NaiveSet");for(var r=t.b.length,n=0;n<r;++n)this.add(t.b[n])}},e.prototype.filter=function(e){var t=this,r=new this.constructor;return r.b=this.b.filter(function(r,n){return e(r,n,t)}),r},e.prototype.map=function(e){for(var t=new this.constructor,r=0;r<this.b.length;++r){var n=this.b[r],o=e(n,r,this);void 0!==o&&t.add(o)}return t},e.prototype.forEach=function(e){var t=this;this.b.forEach(function(r,n){e(r,n,t)})},e.prototype.toString=function(){return this.b.join(", ")},e.prototype.size=function(){return this.b.length},e.prototype.has=function(e){return this.b.indexOf(e)>=0},e.prototype.toArray=function(){return this.b.slice()},e}();t.NaiveSet=n},function(e,t,r){function n(e){var t="string"==typeof e?JSON.parse(e):e;if("object"==typeof t&&void 0===t.v)throw new d;var r=t.v,n=t.o,o=t.d;if(3===r)return new p(n).walkObject(o);throw new Error("unknown version: "+r)}var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(9),a=r(7),s=i.__protected,l=[Array,s.Empty,s.Data,s.List,s.Param,s.Value,s.NotAllowed,s.Text,s.Ref,s.OneOrMore,s.Choice,s.Group,s.Attribute,s.Element,s.Define,s.Grammar,s.EName,s.Interleave,s.Name,s.NameChoice,s.NsName,s.AnyName],u={0:Array,Empty:s.Empty,1:s.Empty,Data:s.Data,2:s.Data,List:s.List,3:s.List,Param:s.Param,4:s.Param,Value:s.Value,5:s.Value,NotAllowed:s.NotAllowed,6:s.NotAllowed,Text:s.Text,7:s.Text,Ref:s.Ref,8:s.Ref,OneOrMore:s.OneOrMore,9:s.OneOrMore,Choice:s.Choice,10:s.Choice,Group:s.Group,11:s.Group,Attribute:s.Attribute,12:s.Attribute,Element:s.Element,13:s.Element,Define:s.Define,14:s.Define,Grammar:s.Grammar,15:s.Grammar,EName:s.EName,16:s.EName,Interleave:s.Interleave,17:s.Interleave,Name:s.Name,18:s.Name,NameChoice:s.NameChoice,19:s.NameChoice,NsName:s.NsName,20:s.NsName,AnyName:s.AnyName,21:s.AnyName},c=1,d=function(e){function t(){var r=e.call(this,"your schema file must be recreated with a newer version of salve-convert")||this;return a.fixPrototype(r,t),r}return o(t,e),t}(Error),h=function(){function e(e){this.options=e}return e.prototype.walkObject=function(e){var t=e[0],r=l[t];if(void 0===r){if(e.length<1)throw new Error("array too small to contain object");throw new Error("undefined type: "+t)}if(r===Array)throw new Error("trying to build array with _constructObjectV2");var n,o=0!==(this.options&c)&&r!==s.EName;return e.length>1?(n=e.slice(1),o?n.unshift(0,""):n.unshift(0),this._transformArray(n)):n=o?[""]:[],this._processObject(r,n)},e.prototype._processObject=function(e,t){},e.prototype._transformArray=function(e){if(0!==e[0])throw new Error("array type not 0, but "+e[0]+" for array "+e);e.splice(0,1);for(var t=e.length,r=0;r<t;r++){var n=e[r];n instanceof Array&&(0!==n[0]?e[r]=this.walkObject(n):this._transformArray(n))}},e}();t.V2JSONWalker=h;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype._processObject=function(e,t){if(e===s.Data&&t.length>=4){var r=t[3];if(r.length%2!==0)throw new Error("parameter array length not a multiple of 2");for(var n=new Array(r.length/2),o=r.length,i=0;i<o;i+=2)n[i/2]={name:r[i],value:r[i+1]};t[3]=n}else if(e===s.OneOrMore){if(1!==t[1].length)throw new Error("OneOrMore with an array of patterns that contains other than 1 pattern");t=[t[0],t[1][0]]}else if(e===s.Attribute||e===s.Element||e===s.Define){if(1!==t[2].length)throw new Error("PatternOnePattern with an array of patterns that contains other than 1 pattern");t=[t[0],t[1],t[2][0]]}else if(e===s.Choice||e===s.Group||e===s.Interleave){if(2!==t[1].length)throw new Error("PatternTwoPatterns with an array of patterns that contains other than 2 pattern");t=[t[0],t[1][0],t[1][1]]}var a=Object.create(e.prototype),l=e.apply(a,t);return void 0!==l?l:a},t}(h);t.constructTree=n,t.__protected={V2JSONWalker:h,nameToConstructor:u,OPTION_NO_PATHS:c}},function(e,t,r){function n(e){return e.trim().replace(/\s{2,}/g," ")}var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(5),a=function(){function e(){}return e.prototype.parseParams=function(e,t){if(void 0!==t&&t.length>0)throw new i.ParameterParsingError(e,[new i.ParamError("this type does not accept parameters")])},e.prototype.parseValue=function(e){var t=this.disallows(e);if(t instanceof Array&&0!==t.length)throw new i.ValueValidationError(t);return{value:e}},e}(),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.regexp=/.*/,t.needsContext=!1,t}return o(t,e),t.prototype.equal=function(e,t){if(void 0===t.value)throw Error("it looks like you are trying to use an unparsed value");return e===t.value},t.prototype.disallows=function(e){return!1},t}(a),l=new s,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="token",t.needsContext=!1,t.regexp=/.*/,t}return o(t,e),t.prototype.equal=function(e,t){if(void 0===t.value)throw Error("it looks like you are trying to use an unparsed value");return n(e)===n(t.value)},t.prototype.disallows=function(e){return!1},t}(a),c=new u;t.builtin={uri:"",types:{string:l,token:c}}},function(e,t,r){(function(e,n){var o=function(){function e(e){var t=new Error(e);this.name="SalveParsingError",this.stack=t.stack,this.message=t.message}function n(t,r){throw new e(t)}function o(e){A.unshift({negative:e,capturedMultiChar:[]})}function i(){this.yy={}}var a=function(e,t,r,n){for(r=r||{},n=e.length;n--;r[e[n]]=t);return r},s=[1,8],l=[1,10],u=[1,13],c=[1,19],d=[1,20],h=[1,14],p=[1,15],f=[1,16],m=[1,17],v=[5,23],g=[5,8,20,22,23,26,30,31,42,43,44,45],y=[5,8,12,13,14,15,20,22,23,26,30,31,42,43,44,45],b=[5,8,12,13,14,15,20,22,23,26,29,30,31,36,38,40,41,42,43,44,45],w=[1,37],_=[1,39],E=[1,40],x=[38,40,41,42,43,44,45],N=[29,36,38,40,41,42,43,44,45],C={trace:function(){},yy:{},symbols_:{error:2,start:3,input:4,EOF:5,regexp:6,branch:7,"|":8,piece:9,atom:10,quantifier:11,"?":12,"*":13,"+":14,"{":15,quantity:16,"}":17,NUMBER:18,",":19,CHAR:20,charClass:21,"(":22,")":23,charClassEsc:24,charClassExpr:25,WILDCARDESC:26,charClassExprStart:27,charGroup:28,"]":29,"[":30,"[^":31,posCharGroups:32,charClassSub:33,posCharGroup:34,charRange:35,CLASSSUBTRACTION:36,seRange:37,"-":38,charOrEsc:39,XMLCHAR:40,SingleCharEsc:41,SINGLECHARESC:42,MULTICHARESC:43,CATESC:44,COMPLESC:45,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",8:"|",12:"?",13:"*",14:"+",15:"{",17:"}",18:"NUMBER",19:",",20:"CHAR",22:"(",23:")",26:"WILDCARDESC",29:"]",30:"[",31:"[^",36:"CLASSSUBTRACTION",
38:"-",40:"XMLCHAR",41:"SingleCharEsc",42:"SINGLECHARESC",43:"MULTICHARESC",44:"CATESC",45:"COMPLESC"},productions_:[0,[3,1],[4,1],[4,2],[6,1],[6,3],[7,1],[7,2],[9,1],[9,2],[11,1],[11,1],[11,1],[11,3],[16,1],[16,3],[16,2],[10,1],[10,1],[10,3],[21,1],[21,1],[21,1],[25,3],[27,1],[27,1],[28,1],[28,1],[32,1],[32,2],[34,1],[34,1],[33,3],[35,1],[35,1],[37,3],[37,1],[39,1],[39,1],[24,1],[24,1],[24,1],[24,1]],performAction:function(e,t,r,i,a,s,l,u){var c=s.length-1;switch(a){case 1:switch(this.parseError=n,u=u||"re"){case"string":return s[c];case"re":var d=O.test(s[c])?P:RegExp;return new d(s[c]);default:throw new Error("unsupported output type: "+u)}break;case 2:this.$="^$";break;case 3:this.$="^"+s[c-1]+"$";break;case 5:case 13:case 35:this.$=s[c-2].concat(s[c-1],s[c]);break;case 7:case 9:case 29:this.$=s[c-1]+s[c];break;case 15:this.$=s[c-2].concat(",",s[c]);break;case 16:this.$=s[c-1].concat(s[c]);break;case 19:this.$="(?:"+s[c-1]+s[c];break;case 23:var h=A.shift(),p=h.capturedMultiChar,f=h.subtraction?"(?!"+h.subtraction+")":"";if(0!==p.length){var m=["(?:",f];if(h.negative){m.push("(?=[");for(var v=0;v<p.length;++v)m.push(R[p[v]].slice(1));m.push("])")}else for(var v=0;v<p.length;++v)m.push("[",R[p[v]],"]|");m.push(s[c-2],s[c-1],s[c],")"),this.$=m.join("")}else this.$=""!==f?"(?:"+f+s[c-2].concat(s[c-1],s[c])+")":s[c-2].concat(s[c-1],s[c]);break;case 24:o(!1),this.$=s[c];break;case 25:o(!0),this.$=s[c];break;case 32:this.$=s[c-2],A[0].subtraction=s[c];break;case 40:if(A.length){var g=R[s[c]];"^"===g.charAt(0)?(A[0].capturedMultiChar.push(s[c]),this.$=""):this.$=g}else this.$=I[s[c]]}},table:[{3:1,4:2,5:[1,3],6:4,7:5,9:6,10:7,20:s,21:9,22:l,24:11,25:12,26:u,27:18,30:c,31:d,42:h,43:p,44:f,45:m},{1:[3]},{1:[2,1]},{1:[2,2]},{5:[1,21]},a(v,[2,4],{10:7,21:9,24:11,25:12,27:18,9:23,8:[1,22],20:s,22:l,26:u,30:c,31:d,42:h,43:p,44:f,45:m}),a(g,[2,6]),a(g,[2,8],{11:24,12:[1,25],13:[1,26],14:[1,27],15:[1,28]}),a(y,[2,17]),a(y,[2,18]),{6:29,7:5,9:6,10:7,20:s,21:9,22:l,24:11,25:12,26:u,27:18,30:c,31:d,42:h,43:p,44:f,45:m},a(y,[2,20]),a(y,[2,21]),a(y,[2,22]),a(b,[2,39]),a(b,[2,40]),a(b,[2,41]),a(b,[2,42]),{24:34,28:30,32:31,33:32,34:33,35:35,37:36,38:w,39:38,40:_,41:E,42:h,43:p,44:f,45:m},a(x,[2,24]),a(x,[2,25]),{1:[2,3]},{6:41,7:5,9:6,10:7,20:s,21:9,22:l,24:11,25:12,26:u,27:18,30:c,31:d,42:h,43:p,44:f,45:m},a(g,[2,7]),a(g,[2,9]),a(g,[2,10]),a(g,[2,11]),a(g,[2,12]),{16:42,18:[1,43]},{23:[1,44]},{29:[1,45]},{24:34,29:[2,26],34:46,35:35,36:[1,47],37:36,38:w,39:38,40:_,41:E,42:h,43:p,44:f,45:m},{29:[2,27]},a(N,[2,28]),a(N,[2,30]),a(N,[2,31]),a(N,[2,33]),a(N,[2,34]),a([29,36,40,41,42,43,44,45],[2,36],{38:[1,48]}),a(N,[2,37]),a(N,[2,38]),a(v,[2,5]),{17:[1,49]},{17:[2,14],19:[1,50]},a(y,[2,19]),a([5,8,12,13,14,15,20,22,23,26,29,30,31,42,43,44,45],[2,23]),a(N,[2,29]),{25:51,27:18,30:c,31:d},{39:52,40:_,41:E},a(g,[2,13]),{17:[2,16],18:[1,53]},{29:[2,32]},a(N,[2,35]),{17:[2,15]}],defaultActions:{2:[2,1],3:[2,2],21:[2,3],32:[2,27],51:[2,32],53:[2,15]},parseError:function(e,t){function r(e,t){this.message=e,this.hash=t}if(!t.recoverable)throw r.prototype=Error,new r(e,t);this.trace(e)},parse:function(e){var t=this,r=[0],n=[null],o=[],i=this.table,a="",s=0,l=0,u=0,c=2,d=1,h=o.slice.call(arguments,1),p=Object.create(this.lexer),f={yy:{}};for(var m in this.yy)Object.prototype.hasOwnProperty.call(this.yy,m)&&(f.yy[m]=this.yy[m]);p.setInput(e,f.yy),f.yy.lexer=p,f.yy.parser=this,"undefined"==typeof p.yylloc&&(p.yylloc={});var v=p.yylloc;o.push(v);var g=p.options&&p.options.ranges;"function"==typeof f.yy.parseError?this.parseError=f.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var y,b,w,_,E,x,N,C,S,P=function(){var e;return e=p.lex()||d,"number"!=typeof e&&(e=t.symbols_[e]||e),e},k={};;){if(w=r[r.length-1],this.defaultActions[w]?_=this.defaultActions[w]:(null!==y&&"undefined"!=typeof y||(y=P()),_=i[w]&&i[w][y]),"undefined"==typeof _||!_.length||!_[0]){var T="";S=[];for(x in i[w])this.terminals_[x]&&x>c&&S.push("'"+this.terminals_[x]+"'");T=p.showPosition?"Parse error on line "+(s+1)+":\n"+p.showPosition()+"\nExpecting "+S.join(", ")+", got '"+(this.terminals_[y]||y)+"'":"Parse error on line "+(s+1)+": Unexpected "+(y==d?"end of input":"'"+(this.terminals_[y]||y)+"'"),this.parseError(T,{text:p.match,token:this.terminals_[y]||y,line:p.yylineno,loc:v,expected:S})}if(_[0]instanceof Array&&_.length>1)throw new Error("Parse Error: multiple actions possible at state: "+w+", token: "+y);switch(_[0]){case 1:r.push(y),n.push(p.yytext),o.push(p.yylloc),r.push(_[1]),y=null,b?(y=b,b=null):(l=p.yyleng,a=p.yytext,s=p.yylineno,v=p.yylloc,u>0&&u--);break;case 2:if(N=this.productions_[_[1]][1],k.$=n[n.length-N],k._$={first_line:o[o.length-(N||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(N||1)].first_column,last_column:o[o.length-1].last_column},g&&(k._$.range=[o[o.length-(N||1)].range[0],o[o.length-1].range[1]]),E=this.performAction.apply(k,[a,l,s,f.yy,_[1],n,o].concat(h)),"undefined"!=typeof E)return E;N&&(r=r.slice(0,-1*N*2),n=n.slice(0,-1*N),o=o.slice(0,-1*N)),r.push(this.productions_[_[1]][0]),n.push(k.$),o.push(k._$),C=i[r[r.length-2]][r[r.length-1]],r.push(C);break;case 3:return!0}}return!0}},S=r(11),P=r(41);e.prototype=new Error,t.SalveParsingError=e;var k=S.xmlNameChar,T=S.xmlLetter,A=[],O=/\\p/i,R={"\\s":" \\t\\n\\r","\\S":"^ \\t\\n\\r","\\i":""+T+"_:","\\I":"^"+T+"_:","\\c":""+k,"\\C":"^"+k,"\\d":"\\p{Nd}","\\D":"^\\p{Nd}","\\w":"^\\p{P}\\p{Z}\\p{C}","\\W":"\\p{P}\\p{Z}\\p{C}"},I=[];for(var D in R)R.hasOwnProperty(D)&&(I[D]="["+R[D]+"]");var M=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,r=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),r.length-1&&(this.yylineno-=r.length-1);var o=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:r?(r.length===n.length?this.yylloc.first_column:0)+n[n.length-r.length].length-r[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[o[0],o[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var r,n,o;if(this.options.backtrack_lexer&&(o={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(o.yylloc.range=this.yylloc.range.slice(0))),n=e[0].match(/(?:\r\n?|\n).*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],r=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),r)return r;if(this._backtrack){for(var i in o)this[i]=o[i];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,r,n;this._more||(this.yytext="",this.match="");for(var o=this._currentRules(),i=0;i<o.length;i++)if(r=this._input.match(this.rules[o[i]]),r&&(!t||r[0].length>t[0].length)){if(t=r,n=i,this.options.backtrack_lexer){if(e=this.test_match(r,o[i]),e!==!1)return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?(e=this.test_match(t,o[n]),e!==!1&&e):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){var e=this.conditionStack.length-1;return e>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return e=this.conditionStack.length-1-Math.abs(e||0),e>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,r,n){switch(r){case 0:return 18;case 1:return 19;case 2:return this.popState(),17;case 3:return this.begin("CHARCLASS"),31;case 4:return this.begin("CHARCLASS"),30;case 5:return 42;case 6:return 43;case 7:return 36;case 8:return 38;case 9:return 40;case 10:return this.popState(),29;case 11:return 22;case 12:return 8;case 13:return 23;case 14:return 13;case 15:return 14;case 16:return 12;case 17:return this.begin("QUANTITY"),15;case 18:return 17;case 19:return 29;case 20:return"^";case 21:return 44;case 22:return 45;case 23:return 26;case 24:return 5;case 25:return 20}},rules:[/^(?:[0-9])/,/^(?:,)/,/^(?:\})/,/^(?:\[\^)/,/^(?:\[)/,/^(?:\\[-nrt\|.?*+(){}[\]^])/,/^(?:\\[sSiIcCdDwW])/,/^(?:-(?=\[))/,/^(?:-)/,/^(?:[^-[\]])/,/^(?:\])/,/^(?:\()/,/^(?:\|)/,/^(?:\))/,/^(?:\*)/,/^(?:\+)/,/^(?:\?)/,/^(?:\{)/,/^(?:\})/,/^(?:\])/,/^(?:\^)/,/^(?:\\p\{.*?\})/,/^(?:\\P\{.*?\})/,/^(?:\.)/,/^(?:$)/,/^(?:[^\\])/],conditions:{CHARCLASS:{rules:[3,4,5,6,7,8,9,10],inclusive:!1},QUANTITY:{rules:[0,1,2],inclusive:!1},INITIAL:{rules:[3,4,5,6,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],inclusive:!0}}};return e}();return C.lexer=M,i.prototype=C,C.Parser=i,new i}();t.parser=o,t.Parser=o.Parser,t.parse=function(){return o.parse.apply(o,arguments)},t.main=function(){throw new Error("this module cannot be used as main")},"undefined"!=typeof e&&r.c[r.s]===e&&t.main(n.argv.slice(1))}).call(t,r(33)(e),r(32))},function(e,t,r){function n(e,t){return e.search(/^\d+$/)===-1&&new p.ParamError(t+" must have an integer value")}function o(e,t){return!(!n(e,t)&&Number(e)>=0)&&new p.ParamError(t+" must have a non-negative integer value")}function i(e,t){return!(!n(e,t)&&Number(e)>0)&&new p.ParamError(t+" must have a positive value")}function a(e){return"INF"===e?1/0:"-INF"===e?-(1/0):Number(e)}function s(e){return e===1/0?"INF":e===-(1/0)?"-INF":e.toString()}function l(e,t){switch(t){case h.PRESERVE:break;case h.REPLACE:e=e.replace(/\r\n\t/g," ");break;case h.COLLAPSE:e=e.replace(/\r\n\t/g," ").trim().replace(/\s{2,}/g," ");break;default:throw new Error("unexpected value: "+t)}return e}function u(e){return e%4===0&&e%100!==0||e%400===0}function c(e){var t=e.match(Ue);if(null===t)return!1;var r=t[1],n=u(Number(r)),o=Number(t[2]);if(0===o||o>12)return!1;var i=Number(t[3]),a=Ve[o];if(2!==o||n||(a=28),0===i||i>a)return!1;var s=t[4].split(":"),l=Number(s[1]);if(l>59)return!1;var c=Number(s[2]);if(c>59)return!1;var d=0===l&&0===c?24:23;if(Number(s[0])>d)return!1;if(void 0!==t[5]&&""!==t[5]&&"Z"!==t[5]){var h=t[5].split(":"),p=Number(h[0].slice(1));if(p>14)return!1;var f=Number(h[1]);if(f>59)return!1;if(14===p&&0!==f)return!1}return!0}var d=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var h,p=r(5),f=r(16),m=r(11);!function(e){e[e.PRESERVE=1]="PRESERVE",e[e.REPLACE=2]="REPLACE",e[e.COLLAPSE=3]="COLLAPSE"}(h||(h={}));for(var v=function(){function e(){this.repeatable=!1}return e.prototype.combine=function(e){if(!this.repeatable)throw new Error("this parameter is not repeatable");throw new Error("derived classes must implement this method if they are repeatable")},e}(),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.convert=function(e){return a(e)},t}(v),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.isInvalidParam=function(e,t){return o(e,t)},t}(g),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="length",t}return d(t,e),t.prototype.isInvalidValue=function(e,t,r){return r.valueLength(e)!==t&&new p.ValueError("length of value should be "+t)},t}(y),w=new b,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="minLength",t}return d(t,e),t.prototype.isInvalidValue=function(e,t,r){return!(r.valueLength(e)>=t)&&new p.ValueError("length of value should be greater than or equal to "+t)},t}(y),E=new _,x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="maxLength",t}return d(t,e),t.prototype.isInvalidValue=function(e,t,r){return!(r.valueLength(e)<=t)&&new p.ValueError("length of value should be less than or equal to "+t)},t}(y),N=new x,C=Object.create(null),S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="pattern",t.repeatable=!0,t}return d(t,e),t.prototype.convert=function(e){var t=C[e];return void 0===t&&(t=C[e]=f.parse(e)),{rng:e,internal:t}},t.prototype.combine=function(e){return e.map(this.convert)},t.prototype.isInvalidParam=function(e){try{this.convert(e)}catch(e){if(e instanceof f.SalveParsingError)return new p.ParamError(e.message);throw e}return!1},t.prototype.isInvalidValue=function(e,t){if(t instanceof Array){for(var r=void 0,n=0,o=t;n<o.length;n++){var i=o[n];if(!i.internal.test(e)){r=i;break}}return void 0!==r&&new p.ValueError("value does not match the pattern "+r.rng)}return!t.internal.test(e)&&new p.ValueError("value does not match the pattern "+t.rng)},t}(v),P=new S,k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="totalDigits",t}return d(t,e),t.prototype.isInvalidParam=function(e,t){return i(e,t)},t.prototype.isInvalidValue=function(e,t){var r=String(Number(e)).replace(/[-+.]/g,"");return r.length>t&&new p.ValueError("value must have at most "+t+" digits")},t}(g),T=new k,A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="fractionDigits",t}return d(t,e),t.prototype.isInvalidValue=function(e,t){var r=String(Number(e)).replace(/^.*\./,"");return r.length>t&&new p.ValueError("value must have at most "+t+" fraction digits")},t}(y),O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.isInvalidParam=function(e,t,r){var n=r.disallows(e);return!!n&&new p.ParamError(n[0].message)},t}(g),R=new A,I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="maxInclusive",t}return d(t,e),t.prototype.isInvalidValue=function(e,t){if(isNaN(e)!==isNaN(t)||e>t){var r=s(t);return new p.ValueError("value must be less than or equal to "+r)}return!1},t}(O),D=new I,M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="maxExclusive",t}return d(t,e),t.prototype.isInvalidValue=function(e,t){if(!(e<t)){var r=s(t);return new p.ValueError("value must be less than "+r)}return!1},t}(O),L=new M,j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="minInclusive",t}return d(t,e),t.prototype.isInvalidValue=function(e,t){if(isNaN(e)!==isNaN(t)||e<t){var r=s(t);return new p.ValueError("value must be greater than or equal to "+r)}return!1},t}(O),F=new j,B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="minExclusive",t}return d(t,e),t.prototype.isInvalidValue=function(e,t){if(!(e>t)){var r=s(t);return new p.ValueError("value must be greater than "+r)}return!1},t}(O),H=new B,$=function(){function e(){this.whiteSpaceDefault=h.COLLAPSE}return e.throwMissingLocation=function(e){throw new Error("internal error: undefined location")},Object.defineProperty(e.prototype,"paramNameToObj",{get:function(){var e=this._paramNameToObj,t=void 0!==e?e:Object.create(null);if(void 0===e){this._paramNameToObj=t;for(var r=0,n=this.validParams;r<n.length;r++){var o=n[r];t[o.name]=o}}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultParams",{get:function(){var e=this._defaultParams;if(void 0!==e)return e;var t;return this._defaultParams=t=this.parseParams(),t},enumerable:!0,configurable:!0}),e.prototype.convertValue=function(e,t){return l(e,this.whiteSpaceDefault)},e.prototype.valueLength=function(e){return e.length},e.prototype.parseValue=function(e,t){var r=this.disallows(e,{},t);if(r)throw new p.ValueValidationError(r);return{value:this.convertValue(e,t)}},e.prototype.parseParams=function(t,r){var n=[],o=Object.create(null);r=void 0!==r?r:[];for(var i=0,a=r;i<a.length;i++){var s=a[i],l=s.name,u=s.value,c=this.paramNameToObj[l];if(void 0===c)return void n.push(new p.ParamError("unexpected parameter: "+l));var d=c.isInvalidParam(u,l,this);d&&n.push(d),void 0===o[l]||c.repeatable||n.push(new p.ParamError("cannot repeat parameter "+l));var h=o[l];void 0===h&&(h=o[l]=[]),h.push(u)}if(0!==n.length){if(void 0!==t)throw new p.ParameterParsingError(t,n);e.throwMissingLocation(n)}var f=o;for(var m in f){var u=f[m],c=this.paramNameToObj[m];u.length>1?f[m]=c.combine(u):f[m]=void 0!==c.convert?c.convert(u[0]):u[0]}if(f.minLength>f.maxLength&&n.push(new p.ParamError("minLength must be less than or equal to maxLength")),void 0!==f.length&&(void 0!==f.minLength&&n.push(new p.ParamError("length and minLength cannot appear together")),void 0!==f.maxLength&&n.push(new p.ParamError("length and maxLength cannot appear together"))),void 0!==f.maxInclusive&&(void 0!==f.maxExclusive&&n.push(new p.ParamError("maxInclusive and maxExclusive cannot appear together")),f.minExclusive>=f.maxInclusive&&n.push(new p.ParamError("minExclusive must be less than maxInclusive"))),void 0!==f.minInclusive&&(void 0!==f.minExclusive&&n.push(new p.ParamError("minInclusive and minExclusive cannot appear together")),f.minInclusive>f.maxInclusive&&n.push(new p.ParamError("minInclusive must be less than or equal to maxInclusive")),f.minInclusive>=f.maxExclusive&&n.push(new p.ParamError("minInclusive must be less than maxExclusive"))),f.minExclusive>f.maxExclusive&&n.push(new p.ParamError("minExclusive must be less than or equal to maxExclusive")),0!==n.length){if(void 0!==t)throw new p.ParameterParsingError(t,n);e.throwMissingLocation(n)}return f},e.prototype.disallowedByParams=function(e,t,r,n){if(void 0!==r){for(var o=[],i=0,a=Object.keys(r);i<a.length;i++){var s=a[i],l=this.paramNameToObj[s],u=l.isInvalidValue(t,r[s],this);u&&o.push(u)}if(0!==o.length)return o}return!1},e.prototype.equal=function(e,t,r){if(void 0===t.value)throw Error("it looks like you are trying to use an unparsed value");var n;try{n=this.convertValue(e,r)}catch(e){if(e instanceof p.ValueValidationError)return!1;throw e}return"number"==typeof n&&isNaN(n)?isNaN(t.value):n===t.value},e.prototype.disallows=function(e,t,r){if(t instanceof Array)throw new Error("it looks like you are passing unparsed parameters to disallows");if(void 0!==t&&0!==Object.keys(t).length||(t=this.defaultParams),null===l(e,h.COLLAPSE).match(this.regexp))return[new p.ValueError(this.typeErrorMsg)];var n;try{n=this.convertValue(e,r)}catch(e){if(e instanceof p.ValueValidationError)return e.errors;throw e}return this.disallowedByParams(e,n,t,r)},e}(),U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="string",t.typeErrorMsg="value is not a string",t.whiteSpaceDefault=h.PRESERVE,t.validParams=[w,E,N,P],t.needsContext=!1,t.regexp=/^.*$/,t}return d(t,e),t}($),V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="normalizedString",t.typeErrorMsg="string contains a tab, carriage return or newline",t.regexp=/^[^\r\n\t]+$/,t}return d(t,e),t}(U),W=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="token",t.typeErrorMsg="not a valid token",t.regexp=/^(?:(?! )(?:(?! {3})[^\r\n\t])*[^\r\n\t ])?$/,t}return d(t,e),t}(V),q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="language",t.typeErrorMsg="not a valid language identifier",t.regexp=/^[a-zA-Z]{1,8}(-[a-zA-Z0-9]{1,8})*$/,t}return d(t,e),t}(W),z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Name",t.typeErrorMsg="not a valid Name",t.regexp=m.xmlNameRe,t}return d(t,e),t}(W),K=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="NCName",t.typeErrorMsg="not a valid NCName",t.regexp=m.xmlNcnameRe,t}return d(t,e),t}(z),G=new RegExp("^["+m.xmlNameChar+"]+$"),X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="NMTOKEN",t.typeErrorMsg="not a valid NMTOKEN",t.regexp=G,t}return d(t,e),t}(W),Q=new RegExp("^["+m.xmlNameChar+"]+(?: ["+m.xmlNameChar+"]+)*$"),Y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="NMTOKENS",t.typeErrorMsg="not a valid NMTOKENS",t.regexp=Q,t.whiteSpaceDefault=h.COLLAPSE,t}return d(t,e),t}(X),Z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="ID",t.typeErrorMsg="not a valid ID",t}return d(t,e),t}(K),J=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="IDREF",t.typeErrorMsg="not a valid IDREF",t}return d(t,e),t}(K),ee=new RegExp("^"+m.xmlNcname+"(?: "+m.xmlNcname+")*$"),te=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="IDREFS",t.typeErrorMsg="not a valid IDREFS",t.regexp=ee,t.whiteSpaceDefault=h.COLLAPSE,t}return d(t,e),t}(J),re=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="ENTITY",t.typeErrorMsg="not a valid ENTITY",t}return d(t,e),t}(U),ne=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="ENTITIES",t.typeErrorMsg="not a valid ENTITIES",t}return d(t,e),t}(U),oe="[-+]?(?!$)\\d*(\\.\\d*)?",ie=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="decimal",t.typeErrorMsg="value not a decimal number",t.regexp=new RegExp("^"+oe+"$"),t.whiteSpaceDefault=h.COLLAPSE,t.needsContext=!1,t.validParams=[T,R,P,H,F,L,D],t}return d(t,e),t.prototype.convertValue=function(t){return Number(e.prototype.convertValue.call(this,t))},t}($),ae="[-+]?\\d+",se=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="integer",t.typeErrorMsg="value is not an integer",t.regexp=new RegExp("^"+ae+"$"),t.validParams=[T,P,H,F,L,D],t}return d(t,e),t.prototype.parseParams=function(t,r){function n(e){var r=[new p.ParamError(e)];if(void 0!==t)throw new p.ParameterParsingError(t,r);return $.throwMissingLocation(r)}var o,i,a=e.prototype.parseParams.call(this,t,r),s=this.highestVal;return void 0!==s&&(void 0!==a.maxExclusive?(o=a.maxExclusive,o>s&&n("maxExclusive cannot be greater than "+s)):void 0!==a.maxInclusive?(i=a.maxInclusive,i>s&&n("maxInclusive cannot be greater than "+s)):a.maxInclusive=this.highestVal),void 0!==this.lowestVal&&(void 0!==a.minExclusive?(o=a.minExclusive,o<this.lowestVal&&n("minExclusive cannot be lower than "+this.lowestVal)):void 0!==a.minInclusive?(i=a.minInclusive,i<this.lowestVal&&n("minInclusive cannot be lower than "+this.lowestVal)):a.minInclusive=this.lowestVal),a},t}(ie),le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="nonPositiveInteger",t.typeErrorMsg="value is not a nonPositiveInteger",t.regexp=/^\+?0+|-\d+$/,t.highestVal=0,t.validParams=[T,P,H,F,L,D],t}return d(t,e),t}(se),ue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="negativeInteger",t.typeErrorMsg="value is not a negativeInteger",t.regexp=/^-\d+$/,t.highestVal=-1,t.validParams=[T,P,H,F,L,D],t}return d(t,e),t}(le),ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="nonNegativeInteger",t.typeErrorMsg="value is not a nonNegativeInteger",t.regexp=/^(\+?\d+|-0)$/,t.lowestVal=0,t.validParams=[T,P,H,F,L,D],t}return d(t,e),t}(se),de=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="positiveInteger",t.typeErrorMsg="value is not a positiveInteger",t.regexp=/^\+?\d+$/,t.lowestVal=1,t.validParams=[T,P,H,F,L,D],t}return d(t,e),t}(ce),he=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="long",t.typeErrorMsg="value is not a long",t.highestVal=0x8000000000000000,t.lowestVal=-0x8000000000000000,t.validParams=[T,P,H,F,L,D],t}return d(t,e),t}(se),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="int",t.typeErrorMsg="value is not an int",t.highestVal=2147483647,t.lowestVal=-2147483648,t}return d(t,e),t}(he),fe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="short",t.typeErrorMsg="value is not a short",t.highestVal=32767,t.lowestVal=-32768,t}return d(t,e),t}(pe),me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="byte",t.typeErrorMsg="value is not a byte",t.highestVal=127,t.lowestVal=-128,t}return d(t,e),t}(fe),ve=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="unsignedLong",t.typeErrorMsg="value is not an unsignedLong",t.highestVal=0x10000000000000000,t.validParams=[T,P,H,F,L,D],t}return d(t,e),t}(ce),ge=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="unsignedInt",t.typeErrorMsg="value is not an unsignedInt",t.highestVal=4294967295,t.validParams=[T,P,H,F,L,D],t}return d(t,e),t}(ve),ye=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="unsignedShort",t.typeErrorMsg="value is not an unsignedShort",t.highestVal=65535,t.validParams=[T,P,H,F,L,D],t}return d(t,e),t}(ge),be=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="unsignedByte",t.typeErrorMsg="value is not an unsignedByte",t.highestVal=255,t.validParams=[T,P,H,F,L,D],t}return d(t,e),t}(ye),we=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="boolean",t.typeErrorMsg="not a valid boolean",t.regexp=/^(1|0|true|false)$/,t.validParams=[P],t.needsContext=!1,t}return d(t,e),t.prototype.convertValue=function(e){return"1"===e||"true"===e},t}($),_e="[AQgw]",Ee="[AEIMQUYcgkosw048]",xe="[A-Za-z0-9+/]",Ne="(?:"+xe+" ?)",Ce="(?:"+Ee+" ?)",Se="(?:"+_e+" ?)",Pe=new RegExp("^(?:(?:"+Ne+"{4})*(?:(?:"+Ne+"{3}"+xe+")|(?:"+Ne+"{2}"+Ce+"=)|(?:"+(""+Ne+Se+"= ?=)))?$")),ke=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="base64Binary",t.typeErrorMsg="not a valid base64Binary",t.regexp=Pe,t.needsContext=!1,t.validParams=[w,E,N,P],t}return d(t,e),t.prototype.convertValue=function(e){return e.replace(/\s/g,"")},t.prototype.valueLength=function(e){return Math.floor(3*e.replace(/[\s=]/g,"").length/4)},t}($),Te=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="hexBinary",t.typeErrorMsg="not a valid hexBinary",t.regexp=/^(?:[0-9a-fA-F]{2})*$/,t.needsContext=!1,t.validParams=[w,E,N,P],t}return d(t,e),t.prototype.convertValue=function(e){return e},t.prototype.valueLength=function(e){return e.length/2},t}($),Ae=new RegExp("^(?:(?:[-+]?INF)|(?:NaN)|(?:"+oe+"(?:[Ee]"+ae+")?))$"),Oe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="float",t.typeErrorMsg="not a valid float",t.regexp=Ae,t.needsContext=!1,t.validParams=[P,F,H,D,L],t}return d(t,e),t.prototype.convertValue=function(e,t){return a(e)},t}($),Re=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="double",t.typeErrorMsg="not a valid double",t}return d(t,e),t}(Oe),Ie=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="QName",t.typeErrorMsg="not a valid QName",t.regexp=new RegExp("^(?:"+m.xmlNcname+":)?"+m.xmlNcname+"$"),t.needsContext=!0,t.validParams=[P,w,E,N],t}return d(t,e),t.prototype.convertValue=function(t,r){var n=r.resolver.resolveName(e.prototype.convertValue.call(this,t));if(void 0===n)throw new p.ValueValidationError([new p.ValueError("cannot resolve the name "+t)]);return"{"+n.ns+"}"+n.name},t}($),De=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="NOTATION",t.typeErrorMsg="not a valid NOTATION",t.regexp=new RegExp("^(?:"+m.xmlNcname+":)?"+m.xmlNcname+"$"),t.needsContext=!0,t.validParams=[P,w,E,N],t}return d(t,e),t.prototype.convertValue=function(t,r){var n=r.resolver.resolveName(e.prototype.convertValue.call(this,t));if(void 0===n)throw new p.ValueValidationError([new p.ValueError("cannot resolve the name "+t)]);return"{"+n.ns+"}"+n.name},t}($),Me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="duration",t.typeErrorMsg="not a valid duration",t.regexp=/^-?P(?!$)(?:\d+Y)?(?:\d+M)?(?:\d+D)?(?:T(?!$)(?:\d+H)?(?:\d+M)?(?:\d+(\.\d+)?S)?)?$/,t.validParams=[P],t.needsContext=!1,t}return d(t,e),t}($),Le="-?(?:[1-9]\\d*)?\\d{4}",je="[01]\\d",Fe="[0-3]\\d",Be="[012]\\d:[0-5]\\d:[0-5]\\d(?:\\.\\d+)?",He="(?:[+-][01]\\d:[0-5]\\d|Z)",$e=new RegExp(He+"$"),Ue=new RegExp("^("+Le+")-("+je+")-("+Fe+")T("+Be+")"+("("+He+"?)$")),Ve=[void 0,31,29,31,30,31,30,31,31,30,31,30,31],We=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="dateTime",t.typeErrorMsg="not a valid dateTime",t.regexp=new RegExp("^"+Le+"-"+je+"-"+Fe+("T"+Be+He+"?$")),t.needsContext=!1,t.validParams=[P],t}return d(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);return n instanceof Array?n:!c(t)&&[new p.ValueError(this.typeErrorMsg)]},t}($),qe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="time",t.typeErrorMsg="not a valid time",t.regexp=new RegExp("^"+Be+He+"?$"),t.validParams=[P],t.needsContext=!1,t}return d(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);
return n?n:!c("1901-01-01T"+t)&&[new p.ValueError(this.typeErrorMsg)]},t}($),ze=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="date",t.typeErrorMsg="not a valid date",t.regexp=new RegExp("^"+Le+"-"+je+"-"+Fe+He+"?$"),t.needsContext=!1,t.validParams=[P],t}return d(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var o=t.match($e);return t=null!==o?t.slice(0,o.index)+"T00:00:00"+o[0]:t+"T00:00:00",!c(t)&&[new p.ValueError(this.typeErrorMsg)]},t}($),Ke=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gYearMonth",t.typeErrorMsg="not a valid gYearMonth",t.regexp=new RegExp("^"+Le+"-"+je+He+"?$"),t.validParams=[P],t.needsContext=!1,t}return d(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var o=t.match($e);return t=null!==o?t.slice(0,o.index)+"-01T00:00:00"+o[0]:t+"-01T00:00:00",!c(t)&&[new p.ValueError(this.typeErrorMsg)]},t}($),Ge=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gYear",t.typeErrorMsg="not a valid gYear",t.regexp=new RegExp("^"+Le+He+"?$"),t.needsContext=!1,t.validParams=[P],t}return d(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var o=t.match($e);return t=null!==o?t.slice(0,o.index)+"-01-01T00:00:00"+o[0]:t+"-01-01T00:00:00",!c(t)&&[new p.ValueError(this.typeErrorMsg)]},t}($),Xe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gMonthDay",t.typeErrorMsg="not a valid gMonthDay",t.regexp=new RegExp("^"+je+"-"+Fe+He+"?$"),t.needsContext=!1,t.validParams=[P],t}return d(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var o=t.match($e);return t=null!==o?t.slice(0,o.index)+"T00:00:00"+o[0]:t+"T00:00:00",!c("2000-"+t)&&[new p.ValueError(this.typeErrorMsg)]},t}($),Qe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gDay",t.typeErrorMsg="not a valid gDay",t.regexp=new RegExp("^"+Fe+He+"?$"),t.needsContext=!1,t.validParams=[P],t}return d(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var o=t.match($e);return t=null!==o?t.slice(0,o.index)+"T00:00:00"+o[0]:t+"T00:00:00",!c("2000-01-"+t)&&[new p.ValueError(this.typeErrorMsg)]},t}($),Ye=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gMonth",t.typeErrorMsg="not a valid gMonth",t.regexp=new RegExp("^"+je+He+"?$"),t.needsContext=!1,t.validParams=[P],t}return d(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var o=t.match($e);return t=null!==o?t.slice(0,o.index)+"-01T00:00:00"+o[0]:t+"-01T00:00:00",!c("2000-"+t)&&[new p.ValueError(this.typeErrorMsg)]},t}($),Ze=/^(?:[A-Za-z][A-Za-z0-9+\-.]*:(?:\/\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\.[A-Za-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\?(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?(?:\#(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?|(?:\/\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\.[A-Za-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\-._~!$&'()*+,;=@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\?(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?(?:\#(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?)$/,Je=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="anyURI",t.typeErrorMsg="not a valid anyURI",t.regexp=Ze,t.needsContext=!1,t.validParams=[P,w,E,N],t}return d(t,e),t}($),et=[U,V,W,q,z,K,X,Y,Z,J,te,re,ne,ie,se,le,ue,ce,de,he,pe,fe,me,ve,ge,ye,be,we,ke,Te,Oe,Re,Ie,De,Me,We,qe,ze,Ke,Ge,Xe,Qe,Ye,Je],tt={uri:"http://www.w3.org/2001/XMLSchema-datatypes",types:{}},rt=0,nt=et;rt<nt.length;rt++){var ot=nt[rt],it=new ot;tt.types[it.name]=it}t.xmlschema=tt},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),i=r(0),a=function(e){function t(t,r,n){var o=e.call(this,t,n)||this;return o.name=r,o}return n(t,e),t.prototype._prepare=function(e){var t=Object.create(null);this.name._recordNamespaces(t),delete t[""];for(var r in t)e[r]=1},t.prototype._hasAttrs=function(){return!0},t}(i.OneSubpattern);t.Attribute=a;var s=function(e){function t(r,n){var o=this;if(r instanceof t){var a=r,s=i.isHashMap(n);o=e.call(this,a,s)||this,o.nameResolver=o._cloneIfNeeded(a.nameResolver,s),o.seenName=a.seenName,o.seenValue=a.seenValue,o.subwalker=void 0!==a.subwalker?a.subwalker._clone(s):void 0,o.attrNameEvent=a.attrNameEvent,o.neutralized=a.neutralized}else{var l=r,u=i.isNameResolver(n);o=e.call(this,l)||this,o.nameResolver=u,o.attrNameEvent=new i.Event("attributeName",l.name),o.seenName=!1,o.seenValue=!1,o.neutralized=!1}return o}return n(t,e),t.prototype._possible=function(){if(this.suppressedAttributes)return new i.EventSet;if(!this.seenName)return new i.EventSet(this.attrNameEvent);if(!this.seenValue){void 0===this.subwalker&&(this.subwalker=this.el.pat.newWalker(this.nameResolver));var e=this.subwalker._possible(),t=new i.EventSet;return e.forEach(function(e){if("text"!==e.params[0])throw new Error("unexpected event type: "+e.params[0]);t.add(new i.Event("attributeValue",e.params[1]))}),t}return new i.EventSet},t.prototype.possible=function(){return this._possible()},t.prototype.fireEvent=function(e){if(!this.suppressedAttributes&&!this.neutralized){if("neutralizeAttribute"===e.params[0]&&this.el.name.toString()===e.params[1].toString())return this.neutralized=!0,!1;if(this.seenName){if(!this.seenValue&&"attributeValue"===e.params[0]){this.seenValue=!0,void 0===this.subwalker&&(this.subwalker=this.el.pat.newWalker(this.nameResolver));var t=new i.Event("text",e.params[1]),r=this.subwalker.fireEvent(t);return void 0===r?[new o.AttributeValueError("invalid attribute value",this.el.name)]:(r===!1&&(r=this.subwalker.end()),r)}}else if("attributeName"===e.params[0]&&this.el.name.match(e.params[1],e.params[2]))return this.seenName=!0,!1}},t.prototype._suppressAttributes=function(){this.suppressedAttributes=!0},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this.seenValue||this.neutralized},t.prototype.end=function(e){return void 0===e&&(e=!1),!this.neutralized&&(this.seenName?!this.seenValue&&[new o.AttributeValueError("attribute value missing",this.el.name)]:[new o.AttributeNameError("attribute missing",this.el.name)])},t}(i.Walker);i.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),i=r(0),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i.TwoSubpatterns);t.Choice=a;var s=function(e){function t(r,n){var o=this;if(r instanceof t){var a=r,s=i.isHashMap(n);o=e.call(this,a,s)||this,o.nameResolver=o._cloneIfNeeded(a.nameResolver,s),o.chosen=a.chosen,o.walkerA=void 0!==a.walkerA?a.walkerA._clone(s):void 0,o.walkerB=void 0!==a.walkerB?a.walkerB._clone(s):void 0,o.instantiatedWalkers=a.instantiatedWalkers}else{var l=r,u=i.isNameResolver(n);o=e.call(this,l)||this,o.nameResolver=u,o.chosen=!1,o.instantiatedWalkers=!1}return o}return n(t,e),t.prototype._possible=function(){if(this._instantiateWalkers(),void 0!==this.possibleCached)return this.possibleCached;if(this.possibleCached=void 0!==this.walkerA?this.walkerA._possible():void 0,void 0!==this.walkerB){this.possibleCached=new i.EventSet(this.possibleCached);var e=this.walkerB._possible();this.possibleCached.union(e)}else void 0===this.possibleCached&&(this.possibleCached=new i.EventSet);return this.possibleCached},t.prototype.fireEvent=function(e){this._instantiateWalkers(),this.possibleCached=void 0;var t=void 0!==this.walkerA?this.walkerA.fireEvent(e):void 0,r=void 0!==this.walkerB?this.walkerB.fireEvent(e):void 0;return void 0!==t?(this.chosen=!0,void 0===r?(this.walkerB=void 0,t):t):void 0!==r?(this.chosen=!0,this.walkerA=void 0,r):void 0},t.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressedAttributes||(this.possibleCached=void 0,this.suppressedAttributes=!0,void 0!==this.walkerA&&this.walkerA._suppressAttributes(),void 0!==this.walkerB&&this.walkerB._suppressAttributes())},t.prototype.canEnd=function(e){void 0===e&&(e=!1),this._instantiateWalkers();var t=!1,r=!1;return e&&(t=!this.el.patA._hasAttrs(),r=!this.el.patB._hasAttrs()),t=t||void 0!==this.walkerA&&this.walkerA.canEnd(e),r=r||void 0!==this.walkerB&&this.walkerB.canEnd(e),t||r},t.prototype.end=function(e){if(void 0===e&&(e=!1),this._instantiateWalkers(),this.canEnd(e))return!1;var t=void 0!==this.walkerA&&this.walkerA.end(e),r=void 0!==this.walkerB&&this.walkerB.end(e);if(!t&&!r)return!1;if(t&&!r)return t;if(!t&&r)return r;var n=[],i=[],a=!1;return this.walkerA.possible().forEach(function(e){"enterStartTag"===e.params[0]?n.push(e.params[1]):a=!0}),a||(this.walkerB.possible().forEach(function(e){"enterStartTag"===e.params[0]?i.push(e.params[1]):a=!0}),a)?t||r:[new o.ChoiceError(n,i)]},t.prototype._instantiateWalkers=function(){this.instantiatedWalkers||(this.instantiatedWalkers=!0,this.walkerA=this.el.patA.newWalker(this.nameResolver),this.walkerB=this.el.patB.newWalker(this.nameResolver))},t}(i.Walker);i.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),i=r(1),a=r(0),s=function(e){function t(t,r,n,i,a){void 0===r&&(r="token"),void 0===n&&(n="");var s=e.call(this,t)||this;if(s.type=r,s.datatypeLibrary=n,s.except=a,s.datatype=o.registry.get(s.datatypeLibrary).types[s.type],void 0===s.datatype)throw new Error("unknown type: "+r);return s.rngParams=void 0!==i?i:[],s}return n(t,e),Object.defineProperty(t.prototype,"params",{get:function(){var e=this._params;return null!=e?e:e=this._params=this.datatype.parseParams(this.xmlPath,this.rngParams)},enumerable:!0,configurable:!0}),t}(a.Pattern);t.Data=s;var l=function(e){function t(r,n){var o=this;if(r instanceof t){var i=r,s=a.isHashMap(n);o=e.call(this,i,s)||this,o.nameResolver=o._cloneIfNeeded(i.nameResolver,s),o.context=void 0!==i.context?{resolver:o.nameResolver}:void 0,o.matched=i.matched}else{var l=r,u=a.isNameResolver(n,"as 2nd argument");o=e.call(this,l)||this,o.nameResolver=u,o.possibleCached=new a.EventSet(new a.Event("text",o.el.datatype.regexp)),o.context=l.datatype.needsContext?{resolver:o.nameResolver}:void 0,o.matched=!1}return o}return n(t,e),t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){if(!this.matched&&"text"===e.params[0]&&!this.el.datatype.disallows(e.params[1],this.el.params,this.context)){if(void 0!==this.el.except){var t=this.el.except.newWalker(this.nameResolver),r=t.fireEvent(e);if(r===!1)return}return this.matched=!0,this.possibleCached=new a.EventSet,!1}},t.prototype.canEnd=function(e){if(void 0===e&&(e=!1),this.matched)return!0;if(void 0!==this.el.except){var t=this.el.except.newWalker(this.nameResolver);if(t.canEnd())return!1}return!this.el.datatype.disallows("",this.el.params,this.context)},t.prototype.end=function(e){return void 0===e&&(e=!1),!this.canEnd(e)&&[new i.ValidationError("value required")]},t.prototype._suppressAttributes=function(){},t}(a.Walker);a.addWalker(s,l)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),i=r(2),a=r(0),s=r(6),l=function(e){function t(t,r,n){var o=e.call(this,t,n)||this;return o.name=r,o}return n(t,e),t.prototype._prepare=function(e){this.name._recordNamespaces(e),this.pat._prepare(e)},t.prototype.newWalker=function(e){return this.pat instanceof s.NotAllowed?this.pat.newWalker(e):u.makeWalker(this,e)},t.prototype._hasAttrs=function(){return!1},t.prototype._gatherElementDefinitions=function(e){var t=this.name.toString();void 0===e[t]?e[t]=[this]:e[t].push(this)},t}(a.OneSubpattern);t.Element=l;var u=function(e){function t(r,n){var o=this;if(r instanceof t){var i=r,s=a.isHashMap(n);o=e.call(this,i,s)||this,o.nameResolver=o._cloneIfNeeded(i.nameResolver,s),o.seenName=i.seenName,o.endedStartTag=i.endedStartTag,o.closed=i.closed,o.walker=void 0!==i.walker?i.walker._clone(s):void 0,o.startTagEvent=i.startTagEvent,o.endTagEvent=i.endTagEvent,o.boundName=i.boundName}else{var l=r,u=a.isNameResolver(n);o=e.call(this,l)||this,o.nameResolver=u,o.seenName=!1,o.endedStartTag=!1,o.closed=!1,o.startTagEvent=new a.Event("enterStartTag",l.name)}return o}return n(t,e),t.makeWalker=function(e,r){return new t(e,r)},t.prototype._possible=function(){if(!this.seenName)return new a.EventSet(this.startTagEvent);if(!this.endedStartTag){var e=this.walker,r=e._possible(),n=new a.EventSet,o=new a.EventSet;return r.forEach(function(e){"attributeValue"===e.params[0]?o.add(e):e.isAttributeEvent()&&n.add(e)}),0!==o.size()?n=o:e.canEnd(!0)&&n.add(t._leaveStartTagEvent),n}if(!this.closed){var e=this.walker,i=new a.EventSet(e._possible());return e.canEnd()&&i.add(this.endTagEvent),i}return new a.EventSet},t.prototype.possible=function(){return this._possible()},t.prototype.fireEvent=function(e){if(!this.endedStartTag){if(this.seenName){if("leaveStartTag"===e.params[0]){this.endedStartTag=!0;var t=this.walker,r=t.end(!0),n=[];if(r)for(var s=0,l=r;s<l.length;s++){var u=l[s];(u instanceof o.AttributeValueError||u instanceof o.AttributeNameError)&&n.push(u),u instanceof o.AttributeNameError&&t.fireEvent(new a.Event(["neutralizeAttribute",u.name]))}return t._suppressAttributes(),0!==n.length&&n}}else if("enterStartTag"===e.params[0]&&this.el.name.match(e.params[1],e.params[2]))return this.walker=this.el.pat.newWalker(this.nameResolver),this.seenName=!0,this.boundName=new i.Name("",e.params[1],e.params[2]),this.endTagEvent=new a.Event("endTag",this.boundName),!1;return void 0!==this.walker?this.walker.fireEvent(e):void 0}if(!this.closed){var t=this.walker,n=t.fireEvent(e);if(void 0===n)if("endTag"===e.params[0]){if(this.boundName.match(e.params[1],e.params[2])){this.closed=!0;var r=t.end();if(n=[],r)for(var c=0,d=r;c<d.length;c++){var u=d[c];u instanceof o.AttributeValueError||u instanceof o.AttributeNameError||n.push(u)}return 0!==n.length&&n}}else if("leaveStartTag"===e.params[0])return[new o.ValidationError("unexpected leaveStartTag event; it is likely that fireEvent is incorrectly called")];return n}},t.prototype._suppressAttributes=function(){},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),!!e||this.closed},t.prototype.end=function(e){if(void 0===e&&(e=!1),e)return!1;var t=[];if(this.seenName){if(!this.endedStartTag||!this.closed){if(void 0!==this.walker){var r=this.walker.end();r&&(t=r)}t.push(this.endedStartTag?new o.ElementNameError("tag not closed",this.el.name):new o.ElementNameError("start tag not terminated",this.el.name))}}else t.push(new o.ElementNameError("tag required",this.el.name));return t.length>0&&t},t._leaveStartTagEvent=new a.Event("leaveStartTag"),t}(a.Walker)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o.Pattern);t.Empty=i;var a=function(e){function t(r,n){var i=this;return r instanceof t?(n=o.isHashMap(n),i=e.call(this,r,n)||this):(i=e.call(this,r)||this,i.possibleCached=new o.EventSet),i}return n(t,e),t.prototype.possible=function(){return new o.EventSet},t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){if(e===o.emptyEvent||"text"===e.params[0]&&""===e.params[1].trim())return!1},t}(o.Walker);t.EmptyWalker=a,o.addWalker(i,a)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),i=r(0),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i.TwoSubpatterns);t.Group=a;var s=function(e){function t(r,n){var o=this;if(r instanceof t){var a=r,s=i.isHashMap(n);o=e.call(this,a,s)||this,o.nameResolver=o._cloneIfNeeded(a.nameResolver,s),o.hitA=a.hitA,o.endedA=a.endedA,o.hitB=a.hitB,o.walkerA=void 0!==a.walkerA?a.walkerA._clone(s):void 0,o.walkerB=void 0!==a.walkerB?a.walkerB._clone(s):void 0}else{var l=r,u=i.isNameResolver(n);o=e.call(this,l)||this,o.nameResolver=u,o.hitA=!1,o.endedA=!1,o.hitB=!1}return o}return n(t,e),t.prototype._possible=function(){if(this._instantiateWalkers(),void 0!==this.possibleCached)return this.possibleCached;var e=this.walkerA,t=this.walkerB;if(this.possibleCached=this.endedA?void 0:e._possible(),this.suppressedAttributes)(this.endedA||e.canEnd())&&(this.possibleCached=new i.EventSet(this.possibleCached),this.possibleCached.union(t._possible()));else{var r=t._possible();this.endedA&&!this.hitB||e.canEnd()||(r=r.filter(function(e){return e.isAttributeEvent()})),this.possibleCached=new i.EventSet(this.possibleCached),this.possibleCached.union(r)}return this.possibleCached},t.prototype.fireEvent=function(e){this._instantiateWalkers();var t=this.walkerA,r=this.walkerB;if(this.possibleCached=void 0,!this.endedA){var n=t.fireEvent(e);if(void 0!==n)return this.hitA=!0,n;if(!e.isAttributeEvent()&&!t.canEnd())return}var o=r.fireEvent(e);if(void 0!==o&&(this.hitB=!0),!e.isAttributeEvent()&&void 0!==o&&!this.endedA){var i=t.end();this.endedA=!0,o?i&&(o=o.concat(i)):o=i}return o},t.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressedAttributes||(this.possibleCached=void 0,this.suppressedAttributes=!0,this.walkerA._suppressAttributes(),this.walkerB._suppressAttributes())},t.prototype.canEnd=function(e){void 0===e&&(e=!1),this._instantiateWalkers();var t=this.walkerA,r=this.walkerB;if(e){var n=this.el.patA._hasAttrs(),o=this.el.patB._hasAttrs();return n&&o?t.canEnd(e)&&r.canEnd(e):n?t.canEnd(!0):!o||r.canEnd(!0)}return t.canEnd(e)&&r.canEnd(e)},t.prototype.end=function(e){if(void 0===e&&(e=!1),this.canEnd(e))return!1;var t,r=this.walkerA,n=this.walkerB;if(e){var i=this.el.patA._hasAttrs(),a=this.el.patB._hasAttrs();if(i){if(this.endedA)throw new Error("invalid state: endedA is true but we are processing attributes");if(t=r.end(!0),a){var s=n.end(!0);s&&(t=t?t.concat(s):s)}return t}return!!a&&n.end(!0)}var l=!1;if(!this.endedA&&(l=r.end(!1)))for(var u=0,c=l;u<c.length;u++){var d=c[u];if(!(d instanceof o.AttributeValueError||d instanceof o.AttributeNameError))return l}var h=n.end(!1);return h?l?l.concat(h):h:l},t.prototype._instantiateWalkers=function(){void 0===this.walkerA&&(this.walkerA=this.el.patA.newWalker(this.nameResolver),this.walkerB=this.el.patB.newWalker(this.nameResolver))},t}(i.Walker);i.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o.TwoSubpatterns);t.Interleave=i;var a=function(e){function t(r,n){var i=this;if(r instanceof t){var a=r,s=o.isHashMap(n);i=e.call(this,a,s)||this,i.nameResolver=i._cloneIfNeeded(a.nameResolver,s),i.inA=a.inA,i.inB=a.inB,i.walkerA=void 0!==a.walkerA?a.walkerA._clone(s):void 0,i.walkerB=void 0!==a.walkerB?a.walkerB._clone(s):void 0}else{var l=r,u=o.isNameResolver(n);i=e.call(this,l)||this,i.nameResolver=u,i.inA=!1,i.inB=!1}return i}return n(t,e),t.prototype._possible=function(){if(this._instantiateWalkers(),void 0!==this.possibleCached)return this.possibleCached;if(this.inA&&this.inB)throw new Error("impossible state");var e=this.walkerA,t=this.walkerB;return this.inA&&!e.canEnd()?this.possibleCached=e._possible():this.inB&&!t.canEnd()&&(this.possibleCached=t._possible()),void 0===this.possibleCached&&(this.possibleCached=e.possible(),this.possibleCached.union(t._possible())),this.possibleCached},t.prototype.fireEvent=function(e){if(this._instantiateWalkers(),this.possibleCached=void 0,this.inA&&this.inB)throw new Error("impossible state");var t,r,n=this.walkerA,o=this.walkerB;if(!this.inA&&!this.inB)return t=n.fireEvent(e),t===!1?(this.inA=!0,!1):(r=o.fireEvent(e),r===!1?(this.inB=!0,!1):void 0===r?t:void 0===t?r:t.concat(r));if(this.inA){if(t=n.fireEvent(e),t instanceof Array||t===!1)return t;if(r=o.fireEvent(e),r===!1)return this.inA=!1,this.inB=!0,!1}else{if(r=o.fireEvent(e),r instanceof Array||r===!1)return r;if(t=n.fireEvent(e),t===!1)return this.inA=!0,this.inB=!1,!1}},t.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressedAttributes||(this.possibleCached=void 0,this.suppressedAttributes=!0,this.walkerA._suppressAttributes(),this.walkerB._suppressAttributes())},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this._instantiateWalkers(),this.walkerA.canEnd(e)&&this.walkerB.canEnd(e)},t.prototype.end=function(e){void 0===e&&(e=!1),this._instantiateWalkers();var t=this.walkerA.end(e),r=this.walkerB.end(e);return t&&!r?t:r&&!t?r:!(!t||!r)&&t.concat(r)},t.prototype._instantiateWalkers=function(){void 0===this.walkerA&&(this.walkerA=this.el.patA.newWalker(this.nameResolver)),void 0===this.walkerB&&(this.walkerB=this.el.patB.newWalker(this.nameResolver))},t}(o.Walker);o.addWalker(i,a)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),i=r(0),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i.OneSubpattern);t.List=a;var s=function(e){function t(r,n){var o=this;if(r instanceof t){var a=r,s=i.isHashMap(n,"as 2nd argument");o=e.call(this,a,s)||this,o.nameResolver=o._cloneIfNeeded(a.nameResolver,s),o.subwalker=a.subwalker._clone(s),o.seenTokens=a.seenTokens,o.matched=a.matched}else{var l=r,u=i.isNameResolver(n,"as 2nd argument");o=e.call(this,l)||this,o.nameResolver=u,o.subwalker=l.pat.newWalker(o.nameResolver),o.seenTokens=!1,o.matched=!1}return o}return n(t,e),t.prototype.fireEvent=function(e){if("text"===e.params[0]){var t=e.params[1].trim();if(""===t)return!1;this.seenTokens=!0;for(var r=t.split(/\s+/),n=0,o=r;n<o.length;n++){var a=o[n],s=this.subwalker.fireEvent(new i.Event(e.params[0],a));if(s!==!1)return s}return this.matched=!0,!1}},t.prototype._suppressAttributes=function(){},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this.seenTokens?this.subwalker.canEnd(e):this.subwalker.fireEvent(i.emptyEvent)===!1},t.prototype.end=function(e){void 0===e&&(e=!1);var t=this.subwalker.end(e);return t!==!1?t:!this.canEnd(e)&&[new o.ValidationError("unfulfilled list")]},t}(i.SingleSubwalker);i.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o.OneSubpattern);t.OneOrMore=i;var a=function(e){function t(r,n){var i=this;if(r instanceof t){var a=r,s=o.isHashMap(n);i=e.call(this,a,s)||this,i.seenOnce=a.seenOnce,i.nameResolver=i._cloneIfNeeded(a.nameResolver,s),i.currentIteration=void 0!==a.currentIteration?a.currentIteration._clone(s):void 0,i.nextIteration=void 0!==a.nextIteration?a.nextIteration._clone(s):void 0}else{var l=r,u=o.isNameResolver(n);i=e.call(this,l)||this,i.nameResolver=u,i.seenOnce=!1}return i}return n(t,e),t.prototype._possible=function(){if(void 0!==this.possibleCached)return this.possibleCached;if(this._instantiateCurrentIteration(),this.possibleCached=this.currentIteration._possible(),this.currentIteration.canEnd()){this.possibleCached=new o.EventSet(this.possibleCached),this._instantiateNextIteration();var e=this.nextIteration._possible();this.possibleCached.union(e)}return this.possibleCached},t.prototype.fireEvent=function(e){this.possibleCached=void 0,this._instantiateCurrentIteration();var t=this.currentIteration,r=t.fireEvent(e);if(r===!1&&(this.seenOnce=!0),void 0!==r)return r;if(this.seenOnce&&t.canEnd()){if(r=t.end())throw new Error("internal error; canEnd() returns true but end() fails");this._instantiateNextIteration();var n=this.nextIteration.fireEvent(e);return n===!1&&(this.currentIteration=this.nextIteration,this.nextIteration=void 0),n}},t.prototype._suppressAttributes=function(){this._instantiateCurrentIteration(),this.suppressedAttributes||(this.suppressedAttributes=!0,this.possibleCached=void 0,this.currentIteration._suppressAttributes(),void 0!==this.nextIteration&&this.nextIteration._suppressAttributes())},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),e?!this.el.pat._hasAttrs()||(this._instantiateCurrentIteration(),this.currentIteration.canEnd(!0)):this.seenOnce&&this.currentIteration.canEnd()},t.prototype.end=function(e){return void 0===e&&(e=!1),!this.canEnd(e)&&(this._instantiateCurrentIteration(),this.currentIteration.end(e))},t.prototype._instantiateCurrentIteration=function(){void 0===this.currentIteration&&(this.currentIteration=this.el.pat.newWalker(this.nameResolver))},t.prototype._instantiateNextIteration=function(){void 0===this.nextIteration&&(this.nextIteration=this.el.pat.newWalker(this.nameResolver),this.suppressedAttributes&&this.nextIteration._suppressAttributes())},t}(o.Walker);o.addWalker(i,a)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),i=function(e){function t(t){e.call(this,t)||this;throw new Error("this pattern is a placeholder and should never actually be used")}return n(t,e),t}(o.Pattern);t.Param=i},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),i=r(6),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o.Pattern);t.Text=a;var s=function(e){function t(r,n){var a=this;if(r instanceof i.NotAllowedWalker){var s=r;n=o.isHashMap(n),a=e.call(this,s,n)||this}else a=e.call(this,r)||this,a.possibleCached=new o.EventSet(t._textEvent);return a}return n(t,e),t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){return"text"!==e.params[0]&&void 0},t._textEvent=new o.Event("text",/^.*$/),t}(o.Walker);o.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),i=r(1),a=r(3),s=r(0),l=function(e){function t(t,r,n,i,a){void 0===n&&(n="token"),void 0===i&&(i=""),void 0===a&&(a="");var s=e.call(this,t)||this;if(s.type=n,s.datatypeLibrary=i,s.ns=a,s.datatype=o.registry.get(s.datatypeLibrary).types[s.type],void 0===s.datatype)throw new Error("unknown type: "+n);return s.rawValue=r,s}return n(t,e),Object.defineProperty(t.prototype,"value",{get:function(){var e=this._value;if(null!=e)return e;
var t;if(this.datatype.needsContext){var r=new a.NameResolver;r.definePrefix("",this.ns),t={resolver:r}}return e=this._value=this.datatype.parseValue(this.rawValue,t)},enumerable:!0,configurable:!0}),t}(s.Pattern);t.Value=l;var u=function(e){function t(r,n){var o=this;if(r instanceof t){var i=r,a=s.isHashMap(n,"as 2nd argument");o=e.call(this,i,a)||this,o.nameResolver=o._cloneIfNeeded(i.nameResolver,a),o.context=void 0!==i.context?{resolver:o.nameResolver}:void 0,o.matched=i.matched}else{var l=r,u=s.isNameResolver(n,"as 2nd argument");o=e.call(this,l)||this,o.nameResolver=u,o.possibleCached=new s.EventSet(new s.Event("text",l.rawValue)),o.context=l.datatype.needsContext?{resolver:o.nameResolver}:void 0,o.matched=!1}return o}return n(t,e),t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){if(!this.matched&&"text"===e.params[0]&&this.el.datatype.equal(e.params[1],this.el.value,this.context))return this.matched=!0,this.possibleCached=new s.EventSet,!1},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this.matched||""===this.el.rawValue},t.prototype.end=function(e){return void 0===e&&(e=!1),!this.canEnd(e)&&[new i.ValidationError("value required: "+this.el.rawValue)]},t.prototype._suppressAttributes=function(){},t}(s.Walker);s.addWalker(l,u)},function(e,t,r){function n(e){return void 0===e?"undefined":null===e?"null":e.toString()}Object.defineProperty(t,"__esModule",{value:!0}),t.inspect=n},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.version="4.3.0";var n=r(9);t.eventsToTreeString=n.eventsToTreeString,t.Event=n.Event,t.EventSet=n.EventSet,t.Grammar=n.Grammar,t.GrammarWalker=n.GrammarWalker,t.BasePattern=n.BasePattern,t.RefError=n.RefError,t.Walker=n.Walker,t.__test=n.__test;var o=r(14);t.constructTree=o.constructTree;var i=r(4);t.EName=i.EName;var a=r(1);t.AttributeNameError=a.AttributeNameError,t.AttributeValueError=a.AttributeValueError,t.ChoiceError=a.ChoiceError,t.ElementNameError=a.ElementNameError,t.ValidationError=a.ValidationError;var s=r(3);t.NameResolver=s.NameResolver;var l=r(2);t.BaseName=l.Base,t.Name=l.Name,t.NameChoice=l.NameChoice,t.NsName=l.NsName,t.AnyName=l.AnyName;var u=r(8);t.HashMap=u.HashMap},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(e){if(c===setTimeout)return setTimeout(e,0);if((c===r||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function i(e){if(d===clearTimeout)return clearTimeout(e);if((d===n||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function a(){m&&p&&(m=!1,p.length?f=p.concat(f):v=-1,f.length&&s())}function s(){if(!m){var e=o(a);m=!0;for(var t=f.length;t;){for(p=f,f=[];++v<t;)p&&p[v].run();v=-1,t=f.length}p=null,m=!1,i(e)}}function l(e,t){this.fun=e,this.array=t}function u(){}var c,d,h=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:r}catch(e){c=r}try{d="function"==typeof clearTimeout?clearTimeout:n}catch(e){d=n}}();var p,f=[],m=!1,v=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new l(e,t)),1!==f.length||m||o(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=u,h.addListener=u,h.once=u,h.off=u,h.removeListener=u,h.removeAllListeners=u,h.emit=u,h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=function(e){"use strict";function t(e){var t=/^(?:\(\?:\))*\^/,r=/\$(?:\(\?:\))*$/;return t.test(e)&&r.test(e)&&r.test(e.replace(/\\[\s\S]/g,""))?e.replace(t,"").replace(r,""):e}function r(t){return e.isRegExp(t)?t[n]&&t[n].captureNames?t:e(t.source):e(t)}var n="xregexp",o=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,i=e.union([/\({{([\w$]+)}}\)|{{([\w$]+)}}/,o],"g");e.build=function(a,s,l){var u,c,d,h,p=/^\(\?([\w$]+)\)/.exec(a),f={},m=0,v=0,g=[0];p&&(l=l||"",p[1].replace(/./g,function(e){l+=l.indexOf(e)>-1?"":e}));for(h in s)s.hasOwnProperty(h)&&(d=r(s[h]),f[h]={pattern:t(d.source),names:d[n].captureNames||[]});return a=r(a),c=a[n].captureNames||[],a=a.source.replace(i,function(e,t,r,n,i){var a,s,l,d=t||r;if(d){if(!f.hasOwnProperty(d))throw new ReferenceError("Undefined property "+e);return t?(a=c[v],g[++v]=++m,s="(?<"+(a||d)+">"):s="(?:",u=m,s+f[d].pattern.replace(o,function(e,t,r){if(t){if(a=f[d].names[m-u],++m,a)return"(?<"+a+">"}else if(r)return l=+r-1,f[d].names[l]?"\\k<"+f[d].names[l]+">":"\\"+(+r+u);return e})+")"}if(n){if(a=c[v],g[++v]=++m,a)return"(?<"+a+">"}else if(i)return l=+i-1,c[l]?"\\k<"+c[l]+">":"\\"+g[+i];return e}),e(a,l)}}},function(e,t){e.exports=function(e){"use strict";function t(e,t,r,n){return{name:e,value:t,start:r,end:n}}e.matchRecursive=function(r,n,o,i,a){i=i||"",a=a||{};var s,l,u,c,d,h=i.indexOf("g")>-1,p=i.indexOf("y")>-1,f=i.replace(/y/g,""),m=a.escapeChar,v=a.valueNames,g=[],y=0,b=0,w=0,_=0;if(n=e(n,f),o=e(o,f),m){if(m.length>1)throw new Error("Cannot use more than one escape character");m=e.escape(m),d=new RegExp("(?:"+m+"[\\S\\s]|(?:(?!"+e.union([n,o]).source+")[^"+m+"])+)+",i.replace(/[^imu]+/g,""))}for(;;){if(m&&(w+=(e.exec(r,d,w,"sticky")||[""])[0].length),u=e.exec(r,n,w),c=e.exec(r,o,w),u&&c&&(u.index<=c.index?c=null:u=null),u||c)b=(u||c).index,w=b+(u||c)[0].length;else if(!y)break;if(p&&!y&&b>_)break;if(u)y||(s=b,l=w),++y;else{if(!c||!y)throw new Error("Unbalanced delimiter found in string");if(!--y&&(v?(v[0]&&s>_&&g.push(t(v[0],r.slice(_,s),_,s)),v[1]&&g.push(t(v[1],r.slice(s,l),s,l)),v[2]&&g.push(t(v[2],r.slice(l,b),l,b)),v[3]&&g.push(t(v[3],r.slice(b,w),b,w))):g.push(r.slice(l,b)),_=w,!h))break}b===w&&++w}return h&&!p&&v&&v[0]&&r.length>_&&g.push(t(v[0],r.slice(_),_,r.length)),g}}},function(e,t){e.exports=function(e){"use strict";function t(e){return e.replace(/[- _]+/g,"").toLowerCase()}function r(e){var t=/^\\[xu](.+)/.exec(e);return t?l(t[1]):e.charCodeAt("\\"===e.charAt(0)?1:0)}function n(t){var n="",o=-1;return e.forEach(t,/(\\x..|\\u....|\\?[\s\S])(?:-(\\x..|\\u....|\\?[\s\S]))?/,function(e){var t=r(e[1]);t>o+1&&(n+="\\u"+c(u(o+1)),t>o+2&&(n+="-\\u"+c(u(t-1)))),o=r(e[2]||e[1])}),o<65535&&(n+="\\u"+c(u(o+1)),o<65534&&(n+="-\\uFFFF")),n}function o(e){var t="b!";return s[e][t]||(s[e][t]=n(s[e].bmp))}function i(e,t){var r=s[e],n="";return r.bmp&&!r.isBmpLast&&(n="["+r.bmp+"]"+(r.astral?"|":"")),r.astral&&(n+=r.astral),r.isBmpLast&&r.bmp&&(n+=(r.astral?"|":"")+"["+r.bmp+"]"),t?"(?:(?!"+n+")(?:[-][-]|[\0-]))":"(?:"+n+")"}function a(e,t){var r=t?"a!":"a=";return s[e][r]||(s[e][r]=i(e,t))}var s={},l=e._dec,u=e._hex,c=e._pad4;e.addToken(/\\([pP])(?:{(\^?)([^}]*)}|([A-Za-z]))/,function(e,r,n){var i="Invalid double negation ",l="Unknown Unicode token ",u="Unicode token missing data ",c="Astral mode required for Unicode token ",d="Astral mode does not support Unicode tokens within character classes",h="P"===e[1]||!!e[2],p=n.indexOf("A")>-1,f=t(e[4]||e[3]),m=s[f];if("P"===e[1]&&e[2])throw new SyntaxError(i+e[0]);if(!s.hasOwnProperty(f))throw new SyntaxError(l+e[0]);if(m.inverseOf){if(f=t(m.inverseOf),!s.hasOwnProperty(f))throw new ReferenceError(u+e[0]+" -> "+m.inverseOf);m=s[f],h=!h}if(!m.bmp&&!p)throw new SyntaxError(c+e[0]);if(p){if("class"===r)throw new SyntaxError(d);return a(f,h)}return"class"===r?h?o(f):m.bmp:(h?"[^":"[")+m.bmp+"]"},{scope:"all",optionalFlags:"A",leadChar:"\\"}),e.addUnicodeData=function(r){var n,o,i="Unicode token requires name",a="Unicode token has no character data ";for(o=0;o<r.length;++o){if(n=r[o],!n.name)throw new Error(i);if(!(n.inverseOf||n.bmp||n.astral))throw new Error(a+n.name);s[t(n.name)]=n,n.alias&&(s[t(n.alias)]=n)}e.cache.flush("patterns")}}},function(e,t){e.exports=function(e){"use strict";if(!e.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Blocks");e.addUnicodeData([{name:"InAegean_Numbers",astral:"[-]"},{name:"InAhom",astral:"[-]"},{name:"InAlchemical_Symbols",astral:"[-]"},{name:"InAlphabetic_Presentation_Forms",bmp:"-"},{name:"InAnatolian_Hieroglyphs",astral:"[-]"},{name:"InAncient_Greek_Musical_Notation",astral:"[-]"},{name:"InAncient_Greek_Numbers",astral:"[-]"},{name:"InAncient_Symbols",astral:"[-]"},{name:"InArabic",bmp:"-"},{name:"InArabic_Extended_A",bmp:"-"},{name:"InArabic_Mathematical_Alphabetic_Symbols",astral:"[-]"},{name:"InArabic_Presentation_Forms_A",bmp:"-"},{name:"InArabic_Presentation_Forms_B",bmp:"-\ufeff"},{name:"InArabic_Supplement",bmp:"-"},{name:"InArmenian",bmp:"-"},{name:"InArrows",bmp:"-"},{name:"InAvestan",astral:"[-]"},{name:"InBalinese",bmp:"-"},{name:"InBamum",bmp:"-"},{name:"InBamum_Supplement",astral:"[-]"},{name:"InBasic_Latin",bmp:"\0-"},{name:"InBassa_Vah",astral:"[-]"},{name:"InBatak",bmp:"-"},{name:"InBengali",bmp:"-"},{name:"InBlock_Elements",bmp:"-"},{name:"InBopomofo",bmp:"-"},{name:"InBopomofo_Extended",bmp:"-"},{name:"InBox_Drawing",bmp:"-"},{name:"InBrahmi",astral:"[-]"},{name:"InBraille_Patterns",bmp:"-"},{name:"InBuginese",bmp:"-"},{name:"InBuhid",bmp:"-"},{name:"InByzantine_Musical_Symbols",astral:"[-]"},{name:"InCJK_Compatibility",bmp:"-"},{name:"InCJK_Compatibility_Forms",bmp:"-"},{name:"InCJK_Compatibility_Ideographs",bmp:"-"},{name:"InCJK_Compatibility_Ideographs_Supplement",astral:"[-]"},{name:"InCJK_Radicals_Supplement",bmp:"-"},{name:"InCJK_Strokes",bmp:"-"},{name:"InCJK_Symbols_and_Punctuation",bmp:"-"},{name:"InCJK_Unified_Ideographs",bmp:"-"},{name:"InCJK_Unified_Ideographs_Extension_A",bmp:"-"},{name:"InCJK_Unified_Ideographs_Extension_B",astral:"[-][-]|[-]"},{name:"InCJK_Unified_Ideographs_Extension_C",astral:"[-]|[-][-]|[-]"},{name:"InCJK_Unified_Ideographs_Extension_D",astral:"[-]|[-]"},{name:"InCJK_Unified_Ideographs_Extension_E",astral:"[-][-]|[-]|[-]"},{name:"InCarian",astral:"[-]"},{name:"InCaucasian_Albanian",astral:"[-]"},{name:"InChakma",astral:"[-]"},{name:"InCham",bmp:"-"},{name:"InCherokee",bmp:"-"},{name:"InCherokee_Supplement",bmp:"-"},{name:"InCombining_Diacritical_Marks",bmp:"-"},{name:"InCombining_Diacritical_Marks_Extended",bmp:"-"},{name:"InCombining_Diacritical_Marks_Supplement",bmp:"-"},{name:"InCombining_Diacritical_Marks_for_Symbols",bmp:"-"},{name:"InCombining_Half_Marks",bmp:"-"},{name:"InCommon_Indic_Number_Forms",bmp:"-"},{name:"InControl_Pictures",bmp:"-"},{name:"InCoptic",bmp:"-"},{name:"InCoptic_Epact_Numbers",astral:"[-]"},{name:"InCounting_Rod_Numerals",astral:"[-]"},{name:"InCuneiform",astral:"[-]"},{name:"InCuneiform_Numbers_and_Punctuation",astral:"[-]"},{name:"InCurrency_Symbols",bmp:"-"},{name:"InCypriot_Syllabary",astral:"[-]"},{name:"InCyrillic",bmp:"-"},{name:"InCyrillic_Extended_A",bmp:"-"},{name:"InCyrillic_Extended_B",bmp:"-"},{name:"InCyrillic_Supplement",bmp:"-"},{name:"InDeseret",astral:"[-]"},{name:"InDevanagari",bmp:"-"},{name:"InDevanagari_Extended",bmp:"-"},{name:"InDingbats",bmp:"-"},{name:"InDomino_Tiles",astral:"[-]"},{name:"InDuployan",astral:"[-]"},{name:"InEarly_Dynastic_Cuneiform",astral:"[-]"},{name:"InEgyptian_Hieroglyphs",astral:"[-]|[-]"},{name:"InElbasan",astral:"[-]"},{name:"InEmoticons",astral:"[-]"},{name:"InEnclosed_Alphanumeric_Supplement",astral:"[-]"},{name:"InEnclosed_Alphanumerics",bmp:"-"},{name:"InEnclosed_CJK_Letters_and_Months",bmp:"-"},{name:"InEnclosed_Ideographic_Supplement",astral:"[-]"},{name:"InEthiopic",bmp:"-"},{name:"InEthiopic_Extended",bmp:"-"},{name:"InEthiopic_Extended_A",bmp:"-"},{name:"InEthiopic_Supplement",bmp:"-"},{name:"InGeneral_Punctuation",bmp:"-"},{name:"InGeometric_Shapes",bmp:"-"},{name:"InGeometric_Shapes_Extended",astral:"[-]"},{name:"InGeorgian",bmp:"-"},{name:"InGeorgian_Supplement",bmp:"-"},{name:"InGlagolitic",bmp:"-"},{name:"InGothic",astral:"[-]"},{name:"InGrantha",astral:"[-]"},{name:"InGreek_Extended",bmp:"-"},{name:"InGreek_and_Coptic",bmp:"-"},{name:"InGujarati",bmp:"-"},{name:"InGurmukhi",bmp:"-"},{name:"InHalfwidth_and_Fullwidth_Forms",bmp:"-"},{name:"InHangul_Compatibility_Jamo",bmp:"-"},{name:"InHangul_Jamo",bmp:"-"},{name:"InHangul_Jamo_Extended_A",bmp:"-"},{name:"InHangul_Jamo_Extended_B",bmp:"-"},{name:"InHangul_Syllables",bmp:"-"},{name:"InHanunoo",bmp:"-"},{name:"InHatran",astral:"[-]"},{name:"InHebrew",bmp:"-"},{name:"InHigh_Private_Use_Surrogates",bmp:"-"},{name:"InHigh_Surrogates",bmp:"-"},{name:"InHiragana",bmp:"-"},{name:"InIPA_Extensions",bmp:"-"},{name:"InIdeographic_Description_Characters",bmp:"-"},{name:"InImperial_Aramaic",astral:"[-]"},{name:"InInscriptional_Pahlavi",astral:"[-]"},{name:"InInscriptional_Parthian",astral:"[-]"},{name:"InJavanese",bmp:"-"},{name:"InKaithi",astral:"[-]"},{name:"InKana_Supplement",astral:"[-]"},{name:"InKanbun",bmp:"-"},{name:"InKangxi_Radicals",bmp:"-"},{name:"InKannada",bmp:"-"},{name:"InKatakana",bmp:"-"},{name:"InKatakana_Phonetic_Extensions",bmp:"-"},{name:"InKayah_Li",bmp:"-"},{name:"InKharoshthi",astral:"[-]"},{name:"InKhmer",bmp:"-"},{name:"InKhmer_Symbols",bmp:"-"},{name:"InKhojki",astral:"[-]"},{name:"InKhudawadi",astral:"[-]"},{name:"InLao",bmp:"-"},{name:"InLatin_Extended_Additional",bmp:"-"},{name:"InLatin_Extended_A",bmp:"-"},{name:"InLatin_Extended_B",bmp:"-"},{name:"InLatin_Extended_C",bmp:"-"},{name:"InLatin_Extended_D",bmp:"-"},{name:"InLatin_Extended_E",bmp:"-"},{name:"InLatin_1_Supplement",bmp:"-"},{name:"InLepcha",bmp:"-"},{name:"InLetterlike_Symbols",bmp:"-"},{name:"InLimbu",bmp:"-"},{name:"InLinear_A",astral:"[-]"},{name:"InLinear_B_Ideograms",astral:"[-]"},{name:"InLinear_B_Syllabary",astral:"[-]"},{name:"InLisu",bmp:"-"},{name:"InLow_Surrogates",bmp:"-"},{name:"InLycian",astral:"[-]"},{name:"InLydian",astral:"[-]"},{name:"InMahajani",astral:"[-]"},{name:"InMahjong_Tiles",astral:"[-]"},{name:"InMalayalam",bmp:"-"},{name:"InMandaic",bmp:"-"},{name:"InManichaean",astral:"[-]"},{name:"InMathematical_Alphanumeric_Symbols",astral:"[-]"},{name:"InMathematical_Operators",bmp:"-"},{name:"InMeetei_Mayek",bmp:"-"},{name:"InMeetei_Mayek_Extensions",bmp:"-"},{name:"InMende_Kikakui",astral:"[-]"},{name:"InMeroitic_Cursive",astral:"[-]"},{name:"InMeroitic_Hieroglyphs",astral:"[-]"},{name:"InMiao",astral:"[-]"},{name:"InMiscellaneous_Mathematical_Symbols_A",bmp:"-"},{name:"InMiscellaneous_Mathematical_Symbols_B",bmp:"-"},{name:"InMiscellaneous_Symbols",bmp:"-"},{name:"InMiscellaneous_Symbols_and_Arrows",bmp:"-"},{name:"InMiscellaneous_Symbols_and_Pictographs",astral:"[-]|[-]"},{name:"InMiscellaneous_Technical",bmp:"-"},{name:"InModi",astral:"[-]"},{name:"InModifier_Tone_Letters",bmp:"-"},{name:"InMongolian",bmp:"-"},{name:"InMro",astral:"[-]"},{name:"InMultani",astral:"[-]"},{name:"InMusical_Symbols",astral:"[-]"},{name:"InMyanmar",bmp:"-"},{name:"InMyanmar_Extended_A",bmp:"-"},{name:"InMyanmar_Extended_B",bmp:"-"},{name:"InNKo",bmp:"-"},{name:"InNabataean",astral:"[-]"},{name:"InNew_Tai_Lue",bmp:"-"},{name:"InNumber_Forms",bmp:"-"},{name:"InOgham",bmp:"-"},{name:"InOl_Chiki",bmp:"-"},{name:"InOld_Hungarian",astral:"[-]"},{name:"InOld_Italic",astral:"[-]"},{name:"InOld_North_Arabian",astral:"[-]"},{name:"InOld_Permic",astral:"[-]"},{name:"InOld_Persian",astral:"[-]"},{name:"InOld_South_Arabian",astral:"[-]"},{name:"InOld_Turkic",astral:"[-]"},{name:"InOptical_Character_Recognition",bmp:"-"},{name:"InOriya",bmp:"-"},{name:"InOrnamental_Dingbats",astral:"[-]"},{name:"InOsmanya",astral:"[-]"},{name:"InPahawh_Hmong",astral:"[-]"},{name:"InPalmyrene",astral:"[-]"},{name:"InPau_Cin_Hau",astral:"[-]"},{name:"InPhags_pa",bmp:"-"},{name:"InPhaistos_Disc",astral:"[-]"},{name:"InPhoenician",astral:"[-]"},{name:"InPhonetic_Extensions",bmp:"-"},{name:"InPhonetic_Extensions_Supplement",bmp:"-"},{name:"InPlaying_Cards",astral:"[-]"},{name:"InPrivate_Use_Area",bmp:"-"},{name:"InPsalter_Pahlavi",astral:"[-]"},{name:"InRejang",bmp:"-"},{name:"InRumi_Numeral_Symbols",astral:"[-]"},{name:"InRunic",bmp:"-"},{name:"InSamaritan",bmp:"-"},{name:"InSaurashtra",bmp:"-"},{name:"InSharada",astral:"[-]"},{name:"InShavian",astral:"[-]"},{name:"InShorthand_Format_Controls",astral:"[-]"},{name:"InSiddham",astral:"[-]"},{name:"InSinhala",bmp:"-"},{name:"InSinhala_Archaic_Numbers",astral:"[-]"},{name:"InSmall_Form_Variants",bmp:"-"},{name:"InSora_Sompeng",astral:"[-]"},{name:"InSpacing_Modifier_Letters",bmp:"-"},{name:"InSpecials",bmp:"-"},{name:"InSundanese",bmp:"-"},{name:"InSundanese_Supplement",bmp:"-"},{name:"InSuperscripts_and_Subscripts",bmp:"-"},{name:"InSupplemental_Arrows_A",bmp:"-"},{name:"InSupplemental_Arrows_B",bmp:"-"},{name:"InSupplemental_Arrows_C",astral:"[-]"},{name:"InSupplemental_Mathematical_Operators",bmp:"-"},{name:"InSupplemental_Punctuation",bmp:"-"},{name:"InSupplemental_Symbols_and_Pictographs",astral:"[-]"},{name:"InSupplementary_Private_Use_Area_A",astral:"[-][-]"},{name:"InSupplementary_Private_Use_Area_B",astral:"[-][-]"},{name:"InSutton_SignWriting",astral:"[-]"},{name:"InSyloti_Nagri",bmp:"-"},{name:"InSyriac",bmp:"-"},{name:"InTagalog",bmp:"-"},{name:"InTagbanwa",bmp:"-"},{name:"InTags",astral:"[-]"},{name:"InTai_Le",bmp:"-"},{name:"InTai_Tham",bmp:"-"},{name:"InTai_Viet",bmp:"-"},{name:"InTai_Xuan_Jing_Symbols",astral:"[-]"},{name:"InTakri",astral:"[-]"},{name:"InTamil",bmp:"-"},{name:"InTelugu",bmp:"-"},{name:"InThaana",bmp:"-"},{name:"InThai",bmp:"-"},{name:"InTibetan",bmp:"-"},{name:"InTifinagh",bmp:"-"},{name:"InTirhuta",astral:"[-]"},{name:"InTransport_and_Map_Symbols",astral:"[-]"},{name:"InUgaritic",astral:"[-]"},{name:"InUnified_Canadian_Aboriginal_Syllabics",bmp:"-"},{name:"InUnified_Canadian_Aboriginal_Syllabics_Extended",bmp:"-"},{name:"InVai",bmp:"-"},{name:"InVariation_Selectors",bmp:"-"},{name:"InVariation_Selectors_Supplement",astral:"[-]"},{name:"InVedic_Extensions",bmp:"-"},{name:"InVertical_Forms",bmp:"-"},{name:"InWarang_Citi",astral:"[-]"},{name:"InYi_Radicals",bmp:"-"},{name:"InYi_Syllables",bmp:"-"},{name:"InYijing_Hexagram_Symbols",bmp:"-"}])}},function(e,t){e.exports=function(e){"use strict";if(!e.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Categories");e.addUnicodeData([{name:"C",alias:"Other",isBmpLast:!0,bmp:"\0---------------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[------]|[--]|[----------]|[-------]|[--]|[----]|[]|[-----]|[-------]|[----------------]|[-]|[------]|[-]|[--]|[----------------]|[-]|[-]|[-]|[--------][-]|[----]|[-----]|[-]|[-----------]|[---------------------]|[-]|[----]|[-]|[-]|[--------]|[-]"},{name:"Cc",alias:"Control",bmp:"\0--"},{name:"Cf",alias:"Format",bmp:"-----\ufeff-",astral:"[-]|[-]|[-]|"},{name:"Cn",alias:"Unassigned",bmp:"---------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[---]|[-----]|[----------]|[-------]|[--]|[----]|[]|[-----]|[-------]|[----------------]|[-]|[------]|[][]|[-]|[----]|[-]|[-]|[-]|[--------][-]|[----]|[-----]|[-]|[--]|[-----------]|[---------------------]|[-]|[----------------]|[-]|[-]|[--------]|[-]"},{name:"Co",alias:"Private_Use",bmp:"-",astral:"[--][-]|[][-]"},{name:"Cs",alias:"Surrogate",bmp:"-"},{name:"L",alias:"Letter",bmp:"A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[--]|[--]|[--]|[---]|[-]|[------]|[---------------]|[-]|[-]|[--]|[---][-]|[------]|[-------]|[-]|[--------------------]|[-------------------------]|[-------------------]|[-]|[--------------]|[--]|[-]|[----]|[]|[-]"},{name:"Ll",alias:"Lowercase_Letter",bmp:"a-z------------------------------------------------",astral:"[-]|[--------------------------]|[-]|[-]"},{name:"Lm",alias:"Modifier_Letter",bmp:"------------",astral:"[-]|[-]"},{name:"Lo",alias:"Other_Letter",bmp:"-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[--]|[--]|[--]|[-]|[-]|[---------------]|[-]|[-]|[-]|[---][-]|[------]|[-]|[-]|[--------------------]|[-------------------]|[-]|[--------------]|[------]|[------]|[-]|[----]|[]|[-]"},{name:"Lt",alias:"Titlecase_Letter",bmp:"---"},{name:"Lu",alias:"Uppercase_Letter",bmp:"A-Z---------------------------------------",astral:"[-]|[-]|[-]|[-----------------------]"},{name:"M",alias:"Mark",bmp:"------------------------------------------------------------------------------------------------------------",astral:"[------]|[------]|[----------------]|[--]|[--]|[]|[-]|[----]|[---]|[-]|[-]"},{name:"Mc",alias:"Spacing_Mark",bmp:"-----------------------------",astral:"[-]|[------]|[-----]|[-]"},{name:"Me",alias:"Enclosing_Mark",bmp:"---"},{name:"Mn",alias:"Nonspacing_Mark",bmp:"-------------------------------------------------------------------------------",astral:"[-------]|[-----]|[--]|[-]|[]|[-]|[----]|[---]|[------------]|[-]|[-]"},{name:"N",alias:"Number",bmp:"0-9------------------------------------------------------------",astral:"[-----]|[-]|[--]|[-]|[-]|[---]|[-]|[------]|[-]|[-]|[-]|[-------------]|[----]"},{name:"Nd",alias:"Decimal_Number",bmp:"0-9------------------------------------",astral:"[-]|[-]|[----]|[-]|[-----]|[--]"},{name:"Nl",alias:"Letter_Number",bmp:"------",astral:"[-]|[--]"},{name:"No",alias:"Other_Number",bmp:"----------------------",astral:"[--]|[--]|[-]|[-]|[-]|[-------------]|[]|[-]|[-]|[----]"},{name:"P",alias:"Punctuation",bmp:"!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}-------------------------------------------------",astral:"[----]|[-]|[---]|[-]|||[------]|[-]|[-]"},{name:"Pc",alias:"Connector_Punctuation",bmp:"_-"},{name:"Pd",alias:"Dash_Punctuation",bmp:"\\x2D-"},{name:"Pe",alias:"Close_Punctuation",bmp:"\\x29\\x5D}"},{name:"Pf",alias:"Final_Punctuation",bmp:""},{name:"Pi",alias:"Initial_Punctuation",bmp:""},{name:"Po",alias:"Other_Punctuation",bmp:"!-#%-'\\x2A,\\x2E/:;\\x3F@\\x5C----------------------------------------------",astral:"[----]|[-]|[---]|[-]|||[------]|[-]|[-]"},{name:"Ps",alias:"Open_Punctuation",bmp:"\\x28\\x5B\\x7B"},{name:"S",alias:"Symbol",bmp:"\\x24\\x2B<->\\x5E`\\x7C~-------------------------------------------------------------------------",astral:"[-------]|[-------------]|[-------]|[]|[----]|||[]|[-]|[----]|[--------]|[]"},{name:"Sc",alias:"Currency_Symbol",bmp:"\\x24--"
},{name:"Sk",alias:"Modifier_Symbol",bmp:"\\x5E`----------",astral:"[-]"},{name:"Sm",alias:"Math_Symbol",bmp:"\\x2B<->\\x7C~---------------------",astral:"[]|[]"},{name:"So",alias:"Other_Symbol",bmp:"-----------------------------------------------------------",astral:"[-------]|[-------]|[-------------]|[----]|||[]|[-]|[----]|[--------]"},{name:"Z",alias:"Separator",bmp:" -\u2028\u2029"},{name:"Zl",alias:"Line_Separator",bmp:"\u2028"},{name:"Zp",alias:"Paragraph_Separator",bmp:"\u2029"},{name:"Zs",alias:"Space_Separator",bmp:" -"}])}},function(e,t){e.exports=function(e){"use strict";if(!e.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Properties");var t=[{name:"ASCII",bmp:"\0-"},{name:"Alphabetic",bmp:"A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[--]|[---------------------]|[--]|[--]|[---]|[-]|[-------]|[------]|[---]|[-]|[-]|[---][-]|[-------------------------]|[----]|[-]|[--------------]|[--------]|[--]|[--]|[----------------]|[---------------------]|[-]|[]|[---]|[-]"},{name:"Any",isBmpLast:!0,bmp:"\0-",astral:"[-][-]"},{name:"Default_Ignorable_Code_Point",bmp:"-----\ufeff-",astral:"[-][-]|[-]|[-]"},{name:"Lowercase",bmp:"a-z----------------------------------------------------",astral:"[-]|[--------------------------]|[-]|[-]"},{name:"Noncharacter_Code_Point",bmp:"-",astral:"[][]"},{name:"Uppercase",bmp:"A-Z-----------------------------------------",astral:"[-]|[-]|[-----------------------]|[-]|[---]"},{name:"White_Space",bmp:"\t-\r -\u2028\u2029"}];t.push({name:"Assigned",inverseOf:"Cn"}),e.addUnicodeData(t)}},function(e,t){e.exports=function(e){"use strict";if(!e.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Scripts");e.addUnicodeData([{name:"Ahom",astral:"[---]"},{name:"Anatolian_Hieroglyphs",astral:"[-]"},{name:"Arabic",bmp:"------------------",astral:"[-]|[--------------]"},{name:"Armenian",bmp:"-----"},{name:"Avestan",astral:"[--]"},{name:"Balinese",bmp:"--"},{name:"Bamum",bmp:"-",astral:"[-]"},{name:"Bassa_Vah",astral:"[--]"},{name:"Batak",bmp:"--"},{name:"Bengali",bmp:"---------"},{name:"Bopomofo",bmp:"--"},{name:"Brahmi",astral:"[--]"},{name:"Braille",bmp:"-"},{name:"Buginese",bmp:"-"},{name:"Buhid",bmp:"-"},{name:"Canadian_Aboriginal",bmp:"--"},{name:"Carian",astral:"[-]"},{name:"Caucasian_Albanian",astral:"[-]"},{name:"Chakma",astral:"[--]"},{name:"Cham",bmp:"----"},{name:"Cherokee",bmp:"---"},{name:"Common",bmp:"\0-@\\x5B-`\\x7B---------------------------------------------------\ufeff------",astral:"[-------]|[-]|[----------------]|[-]|[-------]|[------]|[--------]|[--------------]"},{name:"Coptic",bmp:"---"},{name:"Cuneiform",astral:"[---]|[-]"},{name:"Cypriot",astral:"[--]"},{name:"Cyrillic",bmp:"----"},{name:"Deseret",astral:"[-]"},{name:"Devanagari",bmp:"----"},{name:"Duployan",astral:"[-----]"},{name:"Egyptian_Hieroglyphs",astral:"[-]|[-]"},{name:"Elbasan",astral:"[-]"},{name:"Ethiopic",bmp:"------------------------------"},{name:"Georgian",bmp:"----"},{name:"Glagolitic",bmp:"--"},{name:"Gothic",astral:"[-]"},{name:"Grantha",astral:"[----------]"},{name:"Greek",bmp:"-----------------------",astral:"[-]|[-]"},{name:"Gujarati",bmp:"-----------"},{name:"Gurmukhi",bmp:"--------"},{name:"Han",bmp:"---------",astral:"[--]|[---][-]|[--]|[-]|[--]|[-]"},{name:"Hangul",bmp:"-------------"},{name:"Hanunoo",bmp:"-"},{name:"Hatran",astral:"[--]"},{name:"Hebrew",bmp:"------"},{name:"Hiragana",bmp:"--",astral:"|"},{name:"Imperial_Aramaic",astral:"[--]"},{name:"Inherited",bmp:"------------",astral:"[----]|[]|[-]"},{name:"Inscriptional_Pahlavi",astral:"[--]"},{name:"Inscriptional_Parthian",astral:"[--]"},{name:"Javanese",bmp:"--"},{name:"Kaithi",astral:"[-]"},{name:"Kannada",bmp:"-----------"},{name:"Katakana",bmp:"-------",astral:""},{name:"Kayah_Li",bmp:"-"},{name:"Kharoshthi",astral:"[-------]"},{name:"Khmer",bmp:"----"},{name:"Khojki",astral:"[--]"},{name:"Khudawadi",astral:"[--]"},{name:"Lao",bmp:"---------"},{name:"Latin",bmp:"A-Za-z----------------------"},{name:"Lepcha",bmp:"---"},{name:"Limbu",bmp:"----"},{name:"Linear_A",astral:"[---]"},{name:"Linear_B",astral:"[------]"},{name:"Lisu",bmp:"-"},{name:"Lycian",astral:"[-]"},{name:"Lydian",astral:"[-]"},{name:"Mahajani",astral:"[-]"},{name:"Malayalam",bmp:"----------"},{name:"Mandaic",bmp:"-"},{name:"Manichaean",astral:"[--]"},{name:"Meetei_Mayek",bmp:"---"},{name:"Mende_Kikakui",astral:"[--]"},{name:"Meroitic_Cursive",astral:"[---]"},{name:"Meroitic_Hieroglyphs",astral:"[-]"},{name:"Miao",astral:"[---]"},{name:"Modi",astral:"[--]"},{name:"Mongolian",bmp:"----"},{name:"Mro",astral:"[--]"},{name:"Multani",astral:"[----]"},{name:"Myanmar",bmp:"---"},{name:"Nabataean",astral:"[--]"},{name:"New_Tai_Lue",bmp:"---"},{name:"Nko",bmp:"-"},{name:"Ogham",bmp:"-"},{name:"Ol_Chiki",bmp:"-"},{name:"Old_Hungarian",astral:"[---]"},{name:"Old_Italic",astral:"[-]"},{name:"Old_North_Arabian",astral:"[-]"},{name:"Old_Permic",astral:"[-]"},{name:"Old_Persian",astral:"[--]"},{name:"Old_South_Arabian",astral:"[-]"},{name:"Old_Turkic",astral:"[-]"},{name:"Oriya",bmp:"---------"},{name:"Osmanya",astral:"[--]"},{name:"Pahawh_Hmong",astral:"[-----]"},{name:"Palmyrene",astral:"[-]"},{name:"Pau_Cin_Hau",astral:"[-]"},{name:"Phags_Pa",bmp:"-"},{name:"Phoenician",astral:"[-]"},{name:"Psalter_Pahlavi",astral:"[---]"},{name:"Rejang",bmp:"-"},{name:"Runic",bmp:"--"},{name:"Samaritan",bmp:"--"},{name:"Saurashtra",bmp:"--"},{name:"Sharada",astral:"[--]"},{name:"Shavian",astral:"[-]"},{name:"Siddham",astral:"[--]"},{name:"SignWriting",astral:"[---]"},{name:"Sinhala",bmp:"--------",astral:"[-]"},{name:"Sora_Sompeng",astral:"[--]"},{name:"Sundanese",bmp:"--"},{name:"Syloti_Nagri",bmp:"-"},{name:"Syriac",bmp:"---"},{name:"Tagalog",bmp:"--"},{name:"Tagbanwa",bmp:"--"},{name:"Tai_Le",bmp:"--"},{name:"Tai_Tham",bmp:"-----"},{name:"Tai_Viet",bmp:"--"},{name:"Takri",astral:"[--]"},{name:"Tamil",bmp:"---------"},{name:"Telugu",bmp:"------------"},{name:"Thaana",bmp:"-"},{name:"Thai",bmp:"--"},{name:"Tibetan",bmp:"------"},{name:"Tifinagh",bmp:"-"},{name:"Tirhuta",astral:"[--]"},{name:"Ugaritic",astral:"[-]"},{name:"Vai",bmp:"-"},{name:"Warang_Citi",astral:"[-]"},{name:"Yi",bmp:"--"}])}},function(e,t,r){var n=r(42);r(34)(n),r(35)(n),r(36)(n),r(37)(n),r(38)(n),r(39)(n),r(40)(n),e.exports=n},function(e,t,r){function n(e){var t=!0;try{new RegExp("",e)}catch(e){t=!1}return t&&"y"===e?new RegExp("aa|.","y").test("b"):t}function o(e,t,r,n,o){var i;if(e[x]={captureNames:t},o)return e;if(e.__proto__)e.__proto__=E.prototype;else for(i in E.prototype)e[i]=E.prototype[i];return e[x].source=r,e[x].flags=n?n.split("").sort().join(""):n,e}function i(e){return C.replace.call(e,/([\s\S])(?=[\s\S]*\1)/g,"")}function a(e,t){if(!E.isRegExp(e))throw new TypeError("Type RegExp expected");var r=e[x]||{},n=l(e),a="",s="",c=null,d=null;return t=t||{},t.removeG&&(s+="g"),t.removeY&&(s+="y"),s&&(n=C.replace.call(n,new RegExp("["+s+"]+","g"),"")),t.addG&&(a+="g"),t.addY&&(a+="y"),a&&(n=i(n+a)),t.isInternalOnly||(void 0!==r.source&&(c=r.source),null!=r.flags&&(d=a?i(r.flags+a):r.flags)),e=o(new RegExp(e.source,n),u(e)?r.captureNames.slice(0):null,c,d,t.isInternalOnly)}function s(e){return parseInt(e,16)}function l(e){return M?e.flags:C.exec.call(/\/([a-z]*)$/i,RegExp.prototype.toString.call(e))[1]}function u(e){return!(!e[x]||!e[x].captureNames)}function c(e){return parseInt(e,10).toString(16)}function d(e,t){var r,n=e.length;for(r=0;r<n;++r)if(e[r]===t)return r;return-1}function h(e,t){return L.call(e)==="[object "+t+"]"}function p(e,t,r){return C.test.call(r.indexOf("x")>-1?/^(?:\s|#[^#\n]*|\(\?#[^)]*\))*(?:[?*+]|{\d+(?:,\d*)?})/:/^(?:\(\?#[^)]*\))*(?:[?*+]|{\d+(?:,\d*)?})/,e.slice(t))}function f(e){for(;e.length<4;)e="0"+e;return e}function m(e,t){var r;if(i(t)!==t)throw new SyntaxError("Invalid duplicate regex flag "+t);for(e=C.replace.call(e,/^\(\?([\w$]+)\)/,function(e,r){if(C.test.call(/[gy]/,r))throw new SyntaxError("Cannot use flag g or y in mode modifier "+e);return t=i(t+r),""}),r=0;r<t.length;++r)if(!B[t.charAt(r)])throw new SyntaxError("Unknown regex flag "+t.charAt(r));return{pattern:e,flags:t}}function v(e){var t={};return h(e,"String")?(E.forEach(e,/[^\s,]+/,function(e){t[e]=!0}),t):e}function g(e){if(!/^[\w$]$/.test(e))throw new Error("Flag must be a single character A-Za-z0-9_$");B[e]=!0}function y(e,t,r,n,o){for(var i,a,s=T.length,l=e.charAt(r),u=null;s--;)if(a=T[s],!(a.leadChar&&a.leadChar!==l||a.scope!==n&&"all"!==a.scope||a.flag&&t.indexOf(a.flag)===-1)&&(i=E.exec(e,a.regex,r,"sticky"))){u={matchLength:i[0].length,output:a.handler.call(o,i,n,t),reparse:a.reparse};break}return u}function b(e){N.astral=e}function w(e){RegExp.prototype.exec=(e?S:C).exec,RegExp.prototype.test=(e?S:C).test,String.prototype.match=(e?S:C).match,String.prototype.replace=(e?S:C).replace,String.prototype.split=(e?S:C).split,N.natives=e}function _(e){if(null==e)throw new TypeError("Cannot convert null or undefined to object");return e}function E(e,t){if(E.isRegExp(e)){if(void 0!==t)throw new TypeError("Cannot supply flags when copying a RegExp");return a(e)}if(e=void 0===e?"":String(e),t=void 0===t?"":String(t),E.isInstalled("astral")&&t.indexOf("A")===-1&&(t+="A"),k[e]||(k[e]={}),!k[e][t]){for(var r,n={hasNamedCapture:!1,captureNames:[]},i=A,s="",l=0,u=m(e,t),c=u.pattern,d=u.flags;l<c.length;){do r=y(c,d,l,i,n),r&&r.reparse&&(c=c.slice(0,l)+r.output+c.slice(l+r.matchLength));while(r&&r.reparse);if(r)s+=r.output,l+=r.matchLength||1;else{var h=E.exec(c,R[i],l,"sticky")[0];s+=h,l+=h.length,"["===h&&i===A?i=O:"]"===h&&i===O&&(i=A)}}k[e][t]={pattern:C.replace.call(s,/(?:\(\?:\))+/g,"(?:)"),flags:C.replace.call(d,/[^gimuy]+/g,""),captures:n.hasNamedCapture?n.captureNames:null}}var p=k[e][t];return o(new RegExp(p.pattern,p.flags),p.captures,e,t)}var x="xregexp",N={astral:!1,natives:!1},C={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},S={},P={},k={},T=[],A="default",O="class",R={default:/\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9]\d*|x[\dA-Fa-f]{2}|u(?:[\dA-Fa-f]{4}|{[\dA-Fa-f]+})|c[A-Za-z]|[\s\S])|\(\?(?:[:=!]|<[=!])|[?*+]\?|{\d+(?:,\d*)?}\??|[\s\S]/,class:/\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[\dA-Fa-f]{2}|u(?:[\dA-Fa-f]{4}|{[\dA-Fa-f]+})|c[A-Za-z]|[\s\S])|[\s\S]/},I=/\$(?:{([\w$]+)}|(\d\d?|[\s\S]))/g,D=void 0===C.exec.call(/()??/,"")[1],M=void 0!==/x/.flags,L={}.toString,j=n("u"),F=n("y"),B={g:!0,i:!0,m:!0,u:j,y:F};E.prototype=new RegExp,E.version="3.1.1",E._hasNativeFlag=n,E._dec=s,E._hex=c,E._pad4=f,E.addToken=function(e,t,r){r=r||{};var n,o=r.optionalFlags;if(r.flag&&g(r.flag),o)for(o=C.split.call(o,""),n=0;n<o.length;++n)g(o[n]);T.push({regex:a(e,{addG:!0,addY:F,isInternalOnly:!0}),handler:t,scope:r.scope||A,flag:r.flag,reparse:r.reparse,leadChar:r.leadChar}),E.cache.flush("patterns")},E.cache=function(e,t){return P[e]||(P[e]={}),P[e][t]||(P[e][t]=E(e,t))},E.cache.flush=function(e){"patterns"===e?k={}:P={}},E.escape=function(e){return C.replace.call(_(e),/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},E.exec=function(e,t,r,n){var o,i,s="g",l=!1;return l=F&&!!(n||t.sticky&&n!==!1),l&&(s+="y"),t[x]=t[x]||{},i=t[x][s]||(t[x][s]=a(t,{addG:!0,addY:l,removeY:n===!1,isInternalOnly:!0})),i.lastIndex=r=r||0,o=S.exec.call(i,e),n&&o&&o.index!==r&&(o=null),t.global&&(t.lastIndex=o?i.lastIndex:0),o},E.forEach=function(e,t,r){for(var n,o=0,i=-1;n=E.exec(e,t,o);)r(n,++i,e,t),o=n.index+(n[0].length||1)},E.globalize=function(e){return a(e,{addG:!0})},E.install=function(e){e=v(e),!N.astral&&e.astral&&b(!0),!N.natives&&e.natives&&w(!0)},E.isInstalled=function(e){return!!N[e]},E.isRegExp=function(e){return"[object RegExp]"===L.call(e)},E.match=function(e,t,r){var n,o,i=t.global&&"one"!==r||"all"===r,s=(i?"g":"")+(t.sticky?"y":"")||"noGY";return t[x]=t[x]||{},o=t[x][s]||(t[x][s]=a(t,{addG:!!i,removeG:"one"===r,isInternalOnly:!0})),n=C.match.call(_(e),o),t.global&&(t.lastIndex="one"===r&&n?n.index+n[0].length:0),i?n||[]:n&&n[0]},E.matchChain=function(e,t){return function e(r,n){function o(e){if(i.backref){if(!(e.hasOwnProperty(i.backref)||+i.backref<e.length))throw new ReferenceError("Backreference to undefined group: "+i.backref);a.push(e[i.backref]||"")}else a.push(e[0])}for(var i=t[n].regex?t[n]:{regex:t[n]},a=[],s=0;s<r.length;++s)E.forEach(r[s],i.regex,o);return n!==t.length-1&&a.length?e(a,n+1):a}([e],0)},E.replace=function(e,t,r,n){var o,i=E.isRegExp(t),s=t.global&&"one"!==n||"all"===n,l=(s?"g":"")+(t.sticky?"y":"")||"noGY",u=t;return i?(t[x]=t[x]||{},u=t[x][l]||(t[x][l]=a(t,{addG:!!s,removeG:"one"===n,isInternalOnly:!0}))):s&&(u=new RegExp(E.escape(String(t)),"g")),o=S.replace.call(_(e),u,r),i&&t.global&&(t.lastIndex=0),o},E.replaceEach=function(e,t){var r,n;for(r=0;r<t.length;++r)n=t[r],e=E.replace(e,n[0],n[1],n[2]);return e},E.split=function(e,t,r){return S.split.call(_(e),t,r)},E.test=function(e,t,r,n){return!!E.exec(e,t,r,n)},E.uninstall=function(e){e=v(e),N.astral&&e.astral&&b(!1),N.natives&&e.natives&&w(!1)},E.union=function(e,t){function r(e,t,r){var a=o[i-n];if(t){if(++i,a)return"(?<"+a+">"}else if(r)return"\\"+(+r+n);return e}var n,o,i=0;if(!h(e,"Array")||!e.length)throw new TypeError("Must provide a nonempty array of patterns to merge");for(var a,s=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,l=[],u=0;u<e.length;++u)a=e[u],E.isRegExp(a)?(n=i,o=a[x]&&a[x].captureNames||[],l.push(C.replace.call(E(a.source).source,s,r))):l.push(E.escape(a));return E(l.join("|"),t)},S.exec=function(e){var t,r,n,o=this.lastIndex,i=C.exec.apply(this,arguments);if(i){if(!D&&i.length>1&&d(i,"")>-1&&(r=a(this,{removeG:!0,isInternalOnly:!0}),C.replace.call(String(e).slice(i.index),r,function(){var e,t=arguments.length;for(e=1;e<t-2;++e)void 0===arguments[e]&&(i[e]=void 0)})),this[x]&&this[x].captureNames)for(n=1;n<i.length;++n)t=this[x].captureNames[n-1],t&&(i[t]=i[n]);this.global&&!i[0].length&&this.lastIndex>i.index&&(this.lastIndex=i.index)}return this.global||(this.lastIndex=o),i},S.test=function(e){return!!S.exec.call(this,e)},S.match=function(e){var t;if(E.isRegExp(e)){if(e.global)return t=C.match.apply(this,arguments),e.lastIndex=0,t}else e=new RegExp(e);return S.exec.call(e,_(this))},S.replace=function(e,t){var r,n,o,i=E.isRegExp(e);return i?(e[x]&&(n=e[x].captureNames),r=e.lastIndex):e+="",o=h(t,"Function")?C.replace.call(String(this),e,function(){var r,o=arguments;if(n)for(o[0]=new String(o[0]),r=0;r<n.length;++r)n[r]&&(o[0][n[r]]=o[r+1]);return i&&e.global&&(e.lastIndex=o[o.length-2]+o[0].length),t.apply(void 0,o)}):C.replace.call(null==this?this:String(this),e,function(){var e=arguments;return C.replace.call(String(t),I,function(t,r,o){var i;if(r){if(i=+r,i<=e.length-3)return e[i]||"";if(i=n?d(n,r):-1,i<0)throw new SyntaxError("Backreference to undefined group "+t);return e[i+1]||""}if("$"===o)return"$";if("&"===o||0===+o)return e[0];if("`"===o)return e[e.length-1].slice(0,e[e.length-2]);if("'"===o)return e[e.length-1].slice(e[e.length-2]+e[0].length);if(o=+o,!isNaN(o)){if(o>e.length-3)throw new SyntaxError("Backreference to undefined group "+t);return e[o]||""}throw new SyntaxError("Invalid token "+t)})}),i&&(e.global?e.lastIndex=0:e.lastIndex=r),o},S.split=function(e,t){if(!E.isRegExp(e))return C.split.apply(this,arguments);var r,n=String(this),o=[],i=e.lastIndex,a=0;return t=(void 0===t?-1:t)>>>0,E.forEach(n,e,function(e){e.index+e[0].length>a&&(o.push(n.slice(a,e.index)),e.length>1&&e.index<n.length&&Array.prototype.push.apply(o,e.slice(1)),r=e[0].length,a=e.index+r)}),a===n.length?C.test.call(e,"")&&!r||o.push(""):o.push(n.slice(a)),e.lastIndex=i,o.length>t?o.slice(0,t):o},E.addToken(/\\([ABCE-RTUVXYZaeg-mopqyz]|c(?![A-Za-z])|u(?![\dA-Fa-f]{4}|{[\dA-Fa-f]+})|x(?![\dA-Fa-f]{2}))/,function(e,t){if("B"===e[1]&&t===A)return e[0];throw new SyntaxError("Invalid escape "+e[0])},{scope:"all",leadChar:"\\"}),E.addToken(/\\u{([\dA-Fa-f]+)}/,function(e,t,r){var n=s(e[1]);if(n>1114111)throw new SyntaxError("Invalid Unicode code point "+e[0]);if(n<=65535)return"\\u"+f(c(n));if(j&&r.indexOf("u")>-1)return e[0];throw new SyntaxError("Cannot use Unicode code point above \\u{FFFF} without flag u")},{scope:"all",leadChar:"\\"}),E.addToken(/\[(\^?)]/,function(e){return e[1]?"[\\s\\S]":"\\b\\B"},{leadChar:"["}),E.addToken(/\(\?#[^)]*\)/,function(e,t,r){return p(e.input,e.index+e[0].length,r)?"":"(?:)"},{leadChar:"("}),E.addToken(/\s+|#[^\n]*\n?/,function(e,t,r){return p(e.input,e.index+e[0].length,r)?"":"(?:)"},{flag:"x"}),E.addToken(/\./,function(){return"[\\s\\S]"},{flag:"s",leadChar:"."}),E.addToken(/\\k<([\w$]+)>/,function(e){var t=isNaN(e[1])?d(this.captureNames,e[1])+1:+e[1],r=e.index+e[0].length;if(!t||t>this.captureNames.length)throw new SyntaxError("Backreference to undefined group "+e[0]);return"\\"+t+(r===e.input.length||isNaN(e.input.charAt(r))?"":"(?:)")},{leadChar:"\\"}),E.addToken(/\\(\d+)/,function(e,t){if(!(t===A&&/^[1-9]/.test(e[1])&&+e[1]<=this.captureNames.length)&&"0"!==e[1])throw new SyntaxError("Cannot use octal escape or backreference to undefined group "+e[0]);return e[0]},{scope:"all",leadChar:"\\"}),E.addToken(/\(\?P?<([\w$]+)>/,function(e){if(!isNaN(e[1]))throw new SyntaxError("Cannot use integer as capture name "+e[0]);if("length"===e[1]||"__proto__"===e[1])throw new SyntaxError("Cannot use reserved word as capture name "+e[0]);if(d(this.captureNames,e[1])>-1)throw new SyntaxError("Cannot use same name for multiple groups "+e[0]);return this.captureNames.push(e[1]),this.hasNamedCapture=!0,"("},{leadChar:"("}),E.addToken(/\((?!\?)/,function(e,t,r){return r.indexOf("n")>-1?"(?:":(this.captureNames.push(null),"(")},{optionalFlags:"n",leadChar:"("}),e.exports=E}])}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("salve")):"function"==typeof define&&define.amd?define("salve-dom",["salve"],t):"object"==typeof exports?exports["salve-dom"]=t(require("salve")):e["salve-dom"]=t(e.salve)}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){function n(e,t){return Array.prototype.indexOf.call(e,t)}function o(e){var t=Node.ATTRIBUTE_NODE;return e instanceof Attr||void 0!==t&&e.nodeType===t}function i(e,t,r,n){for(var o=e.possible().toArray(),i=!1,a=0,s=o;a<s.length;a++){var l=s[a];if(l.params[0]===t){var u=l.params[1],c=u.match(r,n);if(i=i||c,c&&!u.wildcardMatch(r,n))return!1}}return i}function a(e,t){void 0===t&&(t=window);var r,n=new t.DOMParser;try{r=n.parseFromString(e,"text/xml")}catch(e){if("SyntaxError"!==e.name||12!==e.code)throw e;throw new b("no error information available")}for(var o=r.firstChild;null!==o&&o.nodeType!==Node.ELEMENT_NODE;)o=o.nextSibling;var i=r.querySelector("html>body>parsererror");if(null!==o&&"parsererror"===o.tagName&&o.namespaceURI===_||null!==i&&i.namespaceURI===w)throw new b(r.documentElement.outerHTML);return r}var s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var l=r(1),u=r(2),c=r(3);t.isAttr=o;var d;!function(e){e[e.START_TAG=1]="START_TAG",e[e.CONTENTS=2]="CONTENTS",e[e.END_TAG=3]="END_TAG"}(d||(d={}));var h;!function(e){e[e.INCOMPLETE=1]="INCOMPLETE",e[e.WORKING=2]="WORKING",e[e.INVALID=3]="INVALID",e[e.VALID=4]="VALID"}(h=t.WorkingState||(t.WorkingState={}));var p=function(){function e(e,t){this.partDone=e,this.portion=t}return e}(),f=new l.Event("enterContext"),m=new l.Event("leaveStartTag"),v=new l.Event("leaveContext"),g=function(e){function t(){var r=e.call(this,"undefined event_index; _validateUpTo should have taken care of that")||this;return c.fixPrototype(r,t),r}return s(t,e),t}(Error),y=function(){function e(e,t,r){void 0===r&&(r={}),this.schema=e,this.root=t,this._cycleEntered=0,this._timeout=200,this._maxTimespan=100,this._resetting=!1,this._errors=[],this._errorsSeen=Object.create(null),this._boundWrapper=this._workWrapper.bind(this),this._validationEvents=[],this._workingState=h.INCOMPLETE,this._partDone=0,this._validationStage=d.CONTENTS,this._previousChild=null,this._validationStack=[new p(0,1)],this._walkerCache=Object.create(null),this._walkerCacheMax=-1,this._prefix="salveDom",this._walkerCacheGap=100,this._events=new u.EventEmitter;for(var n=["timeout","maxTimespan","walkerCacheGap"],o=0,i=n;o<i.length;o++){var a=i[o],s=r[a];if(void 0!==s){if(s<0)throw new Error("the value for "+a+" cannot be negative");this["_"+a]=r[a]}}void 0!==r.prefix&&(this._prefix=r.prefix),this._curEl=this.root,this._setNodeProperty(this._curEl,"EventIndexAfterStart",this._validationEvents.length),this._setWorkingState(h.INCOMPLETE,0),this._validationWalker=this.schema.newWalker(),this.events=this._events}return e.prototype.makeKey=function(e){return""+this._prefix+e},e.prototype.getNodeProperty=function(e,t){return e[this.makeKey(t)]},e.prototype._setNodeProperty=function(e,t,r){e[this.makeKey(t)]=r},e.prototype._clearNodeProperties=function(e){for(var t=["EventIndexAfter","EventIndexAfterStart","EventIndexBeforeAttributes","EventIndexAfterAttributes","PossibleDueToWildcard","ErrorId"],r=0,n=t;r<n.length;r++){var o=n[r];delete e[this.makeKey(o)]}},e.prototype.start=function(){void 0!==this._timeoutId&&this._stop(h.WORKING),this._timeoutId=setTimeout(this._boundWrapper,0)},e.prototype.getSchemaNamespaces=function(){return this.schema.getNamespaces()},e.prototype.getDocumentNamespaces=function(){function e(r){if(null!==r){for(var n=r.attributes.length,o=0;o<n;++o){var i=r.attributes[o];if(0===i.name.lastIndexOf("xmlns",0)){var a=i.name.slice(6),s=t[a];void 0===s&&(s=t[a]=[]),s.push(i.value)}}for(var l=r.firstChild;null!==l;)l.nodeType===Node.ELEMENT_NODE&&e(l),l=l.nextSibling}}var t={};return e(this.root.firstChild),t},e.prototype._workWrapper=function(){this._work()&&(this._timeoutId=setTimeout(this._boundWrapper,this._timeout))},e.prototype._work=function(){for(var e=Date.now();;){if(this._maxTimespan>0&&Date.now()-e>=this._maxTimespan)return!0;var t=this._cycle();if(!t)return!1}},e.prototype._cycle=function(){var e=this;if(this._resetting=!1,this._cycleEntered>0)throw new Error("internal error: _cycle is being reentered");if(this._cycleEntered<0)throw new Error("internal error: _cycleEntered negative");this._cycleEntered++;var t=this._validationWalker,r=this._validationStack,o=this._validationEvents,i=r[0].portion,a=this._validationStage,s=function(){var s=u._curEl;switch(a){case d.START_TAG:s=s,r.unshift(new p(u._partDone,i)),u._fireAndProcessEvent(t,f,s,0);for(var c=s.attributes.length,g=0;g<c;++g){var y=s.attributes[g];"xmlns"===y.name?u._fireAndProcessEvent(t,new l.Event("definePrefix","",y.value),s,0):0===y.name.lastIndexOf("xmlns:",0)&&u._fireAndProcessEvent(t,new l.Event("definePrefix",y.name.slice(6),y.value),s,0)}var b=s.tagName,w=s.parentNode,_=n(w.childNodes,s),E=t.resolveName(b,!1);return void 0===E&&(u._processEventResult([new l.ValidationError("cannot resolve the name "+b)],w,_),E=new l.EName("",b)),u._setPossibleDueToWildcard(s,t,"enterStartTag",E.ns,E.name),u._fireAndProcessEvent(t,new l.Event("enterStartTag",E.ns,E.name),w,_),u._setNodeProperty(s,"EventIndexBeforeAttributes",o.length),u._fireAttributeEvents(t,s),u._setNodeProperty(s,"EventIndexAfterAttributes",o.length),u._fireAndProcessEvent(t,m,s,0),a=u._validationStage=d.CONTENTS,u._setNodeProperty(s,"EventIndexAfterStart",o.length),u._cycleEntered--,{value:!0};case d.CONTENTS:for(var x,N=null===u._previousChild?s.firstChild:u._previousChild.nextSibling,C=[],S=function(){if(0!==C.length){var r=new l.Event("text",C.join("")),o=t.fireEvent(r);if(o instanceof Array){if(void 0===x)throw new Error("flushText running with undefined node");var i=x.parentNode;e._processEventResult(o,i,n(i.childNodes,x))}}C=[],x=void 0};null!==N;){switch(N.nodeType){case Node.TEXT_NODE:C.push(N.data),void 0===x&&(x=N);break;case Node.ELEMENT_NODE:return S(),i/=s.childElementCount,u._curEl=s=N,a=u._validationStage=d.START_TAG,u._previousChild=null,"continue-stage_change";case Node.COMMENT_NODE:break;default:throw new Error("unexpected node type: "+N.nodeType)}N=N.nextSibling}S(),a=u._validationStage=d.END_TAG;break;case d.END_TAG:if(s===u.root){var P=t.end();return P instanceof Array&&u._processEventResult(P,s,s.childNodes.length),u._runDocumentValidation(),u._setNodeProperty(s,"EventIndexAfter",o.length),u._partDone=1,u._stop(u._errors.length>0?h.INVALID:h.VALID),u._cycleEntered--,{value:!1}}var k=s,b=s.tagName,E=t.resolveName(b,!1);void 0===E&&(E=new l.EName("",b)),u._fireAndProcessEvent(t,new l.Event("endTag",E.ns,E.name),s,s.childNodes.length),u._fireAndProcessEvent(t,v,s,s.childNodes.length),u._previousChild=s,u._curEl=s=s.parentNode;var T=u._partDone;if(s!==u.root){r.shift();var A=r[0];T=A.partDone+=i,i=A.portion}return u._setWorkingState(h.WORKING,T),u._setNodeProperty(k,"EventIndexAfter",u._validationEvents.length),a=u._validationStage=d.CONTENTS,u._cycleEntered--,{value:!0};default:throw new Error("unexpected state")}},u=this;e:for(;;){var c=s();if("object"==typeof c)return c.value;switch(c){case"continue-stage_change":continue e}}},e.prototype.stop=function(){this._stop()},e.prototype._stop=function(e){void 0!==this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0,void 0===e?this._workingState===h.WORKING&&this._setWorkingState(h.INCOMPLETE,this._partDone):this._setWorkingState(e,this._partDone)},e.prototype._runDocumentValidation=function(){},e.prototype.restartAt=function(e){this.resetTo(e),this.start()},e.prototype.resetTo=function(e){this._resetting||(this._resetting=!0,this._resetTo(e))},e.prototype._erase=function(e){this._clearNodeProperties(e);for(var t=e.firstElementChild;null!==t;)this._erase(t),t=t.nextElementSibling},e.prototype._resetTo=function(e){this._erase(this.root),this._validationStage=d.CONTENTS,this._previousChild=null,this._validationWalker=this.schema.newWalker(),this._validationEvents=[],this._curEl=this.root,this._partDone=0,this._errors=[],this._errorsSeen=Object.create(null),this._walkerCache=Object.create(null),this._walkerCacheMax=-1,this._events._emit("reset-errors",{at:0})},e.prototype._setWorkingState=function(e,t){var r=!1;this._workingState!==e&&(this._workingState=e,r=!0),this._partDone!==t&&(this._partDone=t,r=!0),r&&this._events._emit("state-update",{state:e,partDone:t})},e.prototype.getWorkingState=function(){return{state:this._workingState,partDone:this._partDone
}},Object.defineProperty(e.prototype,"errors",{get:function(){return this._errors.slice()},enumerable:!0,configurable:!0}),e.prototype._processEventResult=function(e,t,r){for(var n=0,o=e;n<o.length;n++){var i=o[n];this._processError({error:i,node:t,index:r})}},e.prototype._processError=function(e){var t=this,r=function(e){var r=t.getNodeProperty(e,"ErrorId");return void 0===r&&(r=t._errors.length,t._setNodeProperty(e,"ErrorId",r)),r},n=e.node,o=null==n?"":String(r(n)),i=o+","+e.error.toString(),a=this._errorsSeen[i];a!==!0&&(this._errorsSeen[i]=!0,this._errors.push(e),this._events._emit("error",e))},e.prototype._fireAttributeEvents=function(e,t){for(var r=t.attributes,n=0;n<r.length;++n){var o=r[n];"xmlns"!==o.name&&0!==o.name.lastIndexOf("xmlns",0)&&this._fireAttributeNameEvent(e,t,o)&&this._fireAndProcessEvent(e,new l.Event("attributeValue",o.value),o,0)}},e.prototype._fireAttributeNameEvent=function(e,t,r){var n=r.name,o=e.resolveName(n,!0);return void 0===o?(this._processError({error:new l.ValidationError("cannot resolve attribute name "+n),node:r,index:0}),!1):(this._setPossibleDueToWildcard(r,e,"attributeName",o.ns,o.name),this._fireAndProcessEvent(e,new l.Event("attributeName",o.ns,o.name),r,0),!0)},e.prototype._fireAndProcessEvent=function(e,t,r,o){this._validationEvents.push(t);var i=e.fireEvent(t);i instanceof Array&&(null!=r&&void 0!==o&&"number"!=typeof o&&(o=n(r.childNodes,o)),this._processEventResult(i,r,o))},e.prototype._validateUpTo=function(e,t,r){if(void 0===r&&(r=!1),r=!!r,r&&(void 0===e.childNodes||e.childNodes[t].nodeType!==Node.ELEMENT_NODE))throw new Error("trying to validate after attributes but before the end of the start tag on a node which is not an element node");var n=e,i="EventIndexAfter";if(e===this.root&&t<=0){if(r)i="EventIndexAfterAttributes",n=e.childNodes[t];else if(0===t)return}else if(o(e))n=e.ownerElement,i="EventIndexBeforeAttributes";else switch(e.nodeType){case Node.TEXT_NODE:n=e.previousElementSibling,null===n&&(n=e.parentNode,i="EventIndexAfterStart");break;case Node.ELEMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:case Node.DOCUMENT_NODE:var a=e.childNodes[t],s=void 0===a?e.lastElementChild:a.previousElementSibling;r?(i="EventIndexAfterAttributes",n=a):null!==s?n=s:i="EventIndexAfterStart";break;default:throw new Error("unexpected node type: "+e.nodeType)}for(;void 0===this.getNodeProperty(n,i);)this._cycle()},e.prototype._getWalkerAt=function(e,t,r){function n(e){if(void 0===i)throw new Error("calling fireTextEvent without a walker");i.fireEvent(new l.Event("text",e.data))}if(void 0===r&&(r=!1),r=!!r,r&&(void 0===e.childNodes||e.childNodes[t].nodeType!==Node.ELEMENT_NODE))throw new Error("trying to get a walker for attribute events on a node which is not an element node");if(this._validateUpTo(e,t,r),e===this.root&&t<=0&&!r)return 0===t?this.schema.newWalker():this._validationWalker;var i;if(o(e)){var a=e.ownerElement;i=this.readyWalker(this.getNodeProperty(a,"EventIndexBeforeAttributes")),"xmlns"!==e.name&&"xmlns"!==e.prefix&&(i=i.clone(),this._fireAttributeNameEvent(i,a,e))}else switch(e.nodeType){case Node.TEXT_NODE:var s=e.previousElementSibling,u=void 0,c=void 0;null!==s?(u=s,c="EventIndexAfter"):(u=e.parentNode,c="EventIndexAfterStart"),i=this.readyWalker(this.getNodeProperty(u,c)),t>0&&(i=i.clone(),n(e));break;case Node.ELEMENT_NODE:case Node.DOCUMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:var d=e.childNodes[t],s=void 0,u=void 0,c=void 0;if(r?(u=d,c="EventIndexAfterAttributes"):(s=void 0===d?e.lastElementChild:d.previousElementSibling,null!==s?(u=s,c="EventIndexAfter"):(u=e,c="EventIndexAfterStart")),i=this.readyWalker(this.getNodeProperty(u,c)),!r){var h=null!=d?d.previousSibling:null;null!==h&&h!==s&&h.nodeType===Node.TEXT_NODE&&(i=i.clone(),n(h))}break;default:throw new Error("unexpected node type: "+e.nodeType)}return i},e.prototype.readyWalker=function(e){if(void 0===e)throw new g;var t=this._walkerCache,r=this._walkerCacheMax,n=t[e];if(void 0!==n)return n;var o=e;if(o>=r)o=r,n=t[o];else for(;void 0===n&&--o>=0;)n=t[o];void 0!==n?n=n.clone():(n=this.schema.newWalker(),o=0);for(var i=o;i<e;++i)n.fireEvent(this._validationEvents[i]);return e-o>=this._walkerCacheGap&&(t[e]=n,this._walkerCacheMax=Math.max(e,r)),n},e.prototype.possibleAt=function(e,t,r){void 0===r&&(r=!1);var n=this._getWalkerAt(e,t,r);return n.possible()},e.prototype.possibleWhere=function(e,t){for(var r=[],n=0;n<=e.childNodes.length;++n){var o=this.possibleAt(e,n);if(o.has(t))r.push(n);else if("enterStartTag"===t.params[0]||"attributeName"===t.params[0])for(var i=0,a=o.toArray();i<a.length;i++){var s=a[i];if(s.params[0]===t.params[0]&&s.params[1].match(t.params[1],t.params[2])){r.push(n);break}}}return r},e.prototype.speculativelyValidate=function(e,t,r){var n;if(r instanceof Array){n=e.ownerDocument.createDocumentFragment();for(var o=0,i=r;o<i.length;o++){var a=i[o];n.insertBefore(a.cloneNode(!0),null)}}else n=r.cloneNode(!0);var s=e.ownerDocument.createElement("div");return s.insertBefore(n,null),this.speculativelyValidateFragment(e,t,s)},e.prototype.speculativelyValidateFragment=function(t,r,n){if(n.nodeType!==Node.ELEMENT_NODE)throw new Error("toParse is not an element");var o=new e(this.schema,n);return o._validationWalker=this._getWalkerAt(t,r).clone(),o._validateUpTo(n,n.childNodes.length),0!==o._errors.length&&o._errors},e.prototype.getErrorsFor=function(e){var t=e.parentNode;if(null===t)throw new Error("node without a parent!");this._validateUpTo(t,n(t.childNodes,e)+1);for(var r=[],o=0,i=this._errors;o<i.length;o++){var a=i[o];a.node===e&&r.push(a)}return r},e.prototype._setPossibleDueToWildcard=function(e,t,r,n,o){var a=this.getNodeProperty(e,"PossibleDueToWildcard"),s=i(t,r,n,o);this._setNodeProperty(e,"PossibleDueToWildcard",s),void 0!==a&&a===s||this._events._emit("possible-due-to-wildcard-change",e)},e.prototype.resolveNameAt=function(e,t,r,n){return void 0===n&&(n=!1),this._getWalkerAt(e,t).resolveName(r,n)},e.prototype.unresolveNameAt=function(e,t,r,n){return this._getWalkerAt(e,t).unresolveName(r,n)},e}();t.Validator=y;var b=function(e){function t(r){var n=e.call(this)||this;n.xmlErrors=r;var o=new Error("cannot parse");return n.name="ParsingError",n.stack=o.stack,n.message=o.message,c.fixPrototype(n,t),n}return s(t,e),t}(Error);t.ParsingError=b;var w="http://www.w3.org/1999/xhtml",_="http://www.mozilla.org/newlayout/xml/parsererror.xml";t.safeParse=a},function(t,r){t.exports=e},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._eventListeners=Object.create(null),this._generalListeners=[],this._trace=!1}return e.prototype.addEventListener=function(e,t){if("*"===e)this._generalListeners.push(t);else{var r=this._eventListeners[e];void 0===r&&(r=this._eventListeners[e]=[]),r.push(t)}},e.prototype.addOneTimeEventListener=function(e,t){var r=this,n=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return r.removeEventListener(e,n),t.apply(r,o)};return this.addEventListener(e,n),n},e.prototype.removeEventListener=function(e,t){var r="*"===e?this._generalListeners:this._eventListeners[e];if(void 0!==r){var n=r.lastIndexOf(t);n!==-1&&r.splice(n,1)}},e.prototype.removeAllListeners=function(e){"*"===e?this._generalListeners=[]:this._eventListeners[e]=[]},e.prototype._emit=function(e,t){this._trace&&console.log("simple_event_emitter emitting:",e,"with:",t);var r=this._generalListeners;if(r.length>0){r=r.slice();for(var n=0,o=r;n<o.length;n++){var i=o[n],a=i.call(void 0,e,t);if(a===!1)return}}var r=this._eventListeners[e];if(void 0!==r&&r.length>0){r=r.slice();for(var s=0,l=r;s<l.length;s++){var i=l[s],a=i.call(void 0,t);if(a===!1)return}}},e}();t.EventEmitter=n},function(e,t,r){function n(e,t){var r=void 0!==Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__;r!==t&&(void 0!==Object.setPrototypeOf?Object.setPrototypeOf(e,t.prototype):e.__proto__=t.prototype)}Object.defineProperty(t,"__esModule",{value:!0}),t.fixPrototype=n}])});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui/button",["require","exports","rxjs/Subject"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n,o){void 0===n&&(n=""),void 0===o&&(o=""),this.desc=e,this.abbreviatedDesc=t,this.icon=n,this.extraClass=o,this._events=new r.Subject,this.events=this._events.asObservable()}return Object.defineProperty(e.prototype,"buttonClassName",{get:function(){var e=this.extraClass;return""!==e&&(e=" "+e),"btn btn-default"+e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buttonText",{get:function(){return void 0===this.abbreviatedDesc?this.desc:this.abbreviatedDesc},enumerable:!0,configurable:!0}),e.prototype.render=function(e){var t=null;if(void 0!==this.el){t=this.el.nextSibling,e=this.el.parentNode;var r=$(this.el);r.remove(),r.tooltip("destroy")}if(null==e)throw new Error("called first render without a parent");var n=this.makeButton(e.ownerDocument);this.el=n,e.insertBefore(n,t)},e.prototype.makeButton=function(e){var t=e.createElement("button");t.className=this.buttonClassName;var r=$(t);return this.setButtonContent(t),this.setButtonTooltip(r),this.setButtonEventHandlers(r),t},e.prototype.setButtonContent=function(e){var t=this.icon;""!==t?e.innerHTML=t:e.textContent=this.buttonText},e.prototype.setButtonTooltip=function(e){var t=this.desc;""===this.icon&&this.buttonText===t||(e[0].setAttribute("title",t),e.tooltip({title:t,container:"body",placement:"auto",trigger:"hover"}))},e.prototype.setButtonEventHandlers=function(e){var t=this;e.click(function(){return t._events.next({name:"Click",button:t}),!1}),e.mousedown(!1)},e}();t.Button=n;var o=function(e){function t(t,r,n,o,i){void 0===o&&(o=""),void 0===i&&(i="");var a=e.call(this,r,n,o,i)||this;return a.desc=r,a.abbreviatedDesc=n,a.icon=o,a.extraClass=i,a._pressed=t,a.events.subscribe(function(e){"Click"===e.name&&void 0!==a.el&&(a._pressed=!a._pressed,a.render())}),a}return __extends(t,e),Object.defineProperty(t.prototype,"pressed",{get:function(){return this._pressed},set:function(e){this._pressed!==e&&(this._pressed=e,void 0!==this.el&&this.render())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonClassName",{get:function(){var e=this.extraClass;return""!==e&&(e=" "+e),"btn btn-default"+e+(this._pressed?" active":"")},enumerable:!0,configurable:!0}),t}(n);t.ToggleButton=o}),define("wed/action",["require","exports","./gui/button"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,o){void 0===n&&(n=""),void 0===o&&(o=!1),this.editor=e,this.desc=t,this.abbreviatedDesc=r,this.icon=n,this.needsInput=o,this.needsInput=!!o,this.boundHandler=this.eventHandler.bind(this),this.boundTerminalHandler=this.terminalEventHandler.bind(this)}return e.prototype.eventHandler=function(e){var t=null!=e.data?e.data:{};this.execute(t),e.preventDefault()},e.prototype.terminalEventHandler=function(e){return this.eventHandler(e),e.preventDefault(),e.stopPropagation(),!1},e.prototype.getDescription=function(){return this.desc},e.prototype.getDescriptionFor=function(e){return this.getDescription()},e.prototype.getAbbreviatedDescription=function(){return this.abbreviatedDesc},e.prototype.getIcon=function(){return this.icon},e.prototype.getLabelFor=function(e){var t=this.getDescriptionFor(e),r=this.getIcon();return""!==r&&""!==t?r+" "+t:""!==r?r:t},e.prototype.toString=function(){return this.getDescription()},e.prototype.makeButton=function(e){var t=this,n=new r.Button(void 0!==e?this.getDescriptionFor(e):this.getDescription(),this.getAbbreviatedDescription(),this.getIcon());return n.events.subscribe(function(r){t.execute(void 0!==e?e:{})}),n},e}();t.Action=n}),define("wed/browsers",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=navigator.userAgent;t.EDGE=r.indexOf(" Edge/")!==-1,t.CHROME=!t.EDGE&&r.indexOf(" Chrome/")!==-1,t.MSIE_TO_10=r.indexOf(" MSIE ")!==-1;var n=" like Gecko";t.MSIE_11_AND_UP=r.indexOf(n,navigator.userAgent.length-n.length)!==-1,t.MSIE=t.MSIE_11_AND_UP||t.MSIE_TO_10,t.FIREFOX=r.indexOf(" Firefox/")!==-1,t.FIREFOX_24=r.indexOf(" Firefox/24")!==-1,t.GECKO=r.indexOf(" Gecko/")!==-1,t.OSX=0===navigator.platform.lastIndexOf("Mac",0),t.WINDOWS="Win32"===navigator.platform}),define("wed/dloc",["require","exports","jquery","./domtypeguards","./domutil"],function(e,t,r,n,o){"use strict";function i(e){var t;if(n.isAttr(e))t=e.value.length;else switch(e.nodeType){case Node.TEXT_NODE:t=e.data.length;break;case Node.DOCUMENT_NODE:case Node.ELEMENT_NODE:t=e.childNodes.length;break;default:throw new Error("unexpected node type")}return t}function a(e){for(;null!=e;){if(n.isElement(e)||n.isDocument(e)){var t=r.data(e,"wed-dloc-root");if(null!=t)return t}e=e.parentNode}}function s(e){var t=a(e);if(null==t)throw new Error("no root found");return t}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e){if(this.node=e,null!=r.data(e,"wed-dloc-root"))throw new Error("node already marked as root");r.data(e,"wed-dloc-root",this)}return e.prototype.nodeToPath=function(e){if(null==e)throw new Error("invalid node parameter");var t=this.node;if(t===e)return"";if(!o.contains(t,e))throw new Error("node is not a descendant of root");for(var r=[];e!==t;){var i=void 0;if(n.isAttr(e))i=e.ownerElement,r.unshift("@"+e.name);else{var a=0;i=e.parentNode;for(var s=e.previousSibling;null!==s;){var l=s.nodeType;l!==Node.TEXT_NODE&&l!==Node.ELEMENT_NODE||a++,s=s.previousSibling}r.unshift(String(a))}e=i}return r.join("/")},e.prototype.pathToNode=function(e){var t=this.node;if(""===e)return t;var r,o=e.split(/\//),i=t;"@"===o[o.length-1][0]&&(r=o.pop());for(var a=0,s=o;a<s.length;a++){var l=s[a];if(!/^(\d+)$/.test(l))throw new Error("malformed path expression");for(var u=parseInt(l),c=null,d=i.firstChild;null!==d&&null===c;){var h=d.nodeType;(h===Node.TEXT_NODE||h===Node.ELEMENT_NODE)&&--u<0&&(c=d),d=d.nextSibling}if(null===c)return null;i=c}if(void 0===r)return i;if(!n.isElement(i))throw new Error("parent must be an element since we are looking for an attribute");return i.getAttributeNode(r.slice(1))},e}();t.DLocRoot=l;var u=function(){function e(e,t,r){this.root=e,this.node=t,this.offset=r}return Object.defineProperty(e.prototype,"pointedNode",{get:function(){return n.isElement(this.node)?this.node.childNodes[this.offset]:this.node},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.root,this.node,this.offset)},e.makeDLoc=function(t,n,a,s){if(n instanceof Array&&(s=a,d=n,n=d[0],a=d[1]),void 0===s&&(s=!1),null!=n){if(void 0===a){var u=n.parentNode;if(null===u)throw new Error("trying to get parent of a detached node");a=o.indexOf(u.childNodes,n),n=u}else{if("number"!=typeof a)throw new Error("offset is not a number, somehow");if(a<0){if(!s)throw new Error("negative offsets are not allowed");a=0}}if(t instanceof l)t=t.node;else if(null==r.data(t,"wed-dloc-root"))throw new Error("root has not been marked as a root");if(!o.contains(t,n))throw new Error("node not in root");var c=i(n);if(a>c){if(!s)throw new Error("offset greater than allowable value");a=c}return new e(t,n,a);var d}},e.mustMakeDLoc=function(e,t,r,n){var o=t;if(o instanceof Array&&(o=o[0]),null==o)throw new Error("called mustMakeDLoc with an absent node");return this.makeDLoc.apply(this,arguments)},e.prototype.make=function(t,r){if(t instanceof Array)return e.mustMakeDLoc(this.root,t);if(void 0!==r&&"number"!=typeof r)throw new Error("if the 1st argument is a node, the 2nd must be a number or undefined");return e.mustMakeDLoc(this.root,t,r)},e.prototype.makeWithOffset=function(e){return e===this.offset?this:this.make(this.node,e)},e.prototype.getLocationInParent=function(){var e=this.node,t=e.parentNode;if(null===t)throw new Error("trying to get parent of a detached node");return this.make(t,o.indexOf(t.childNodes,e))},e.prototype.getLocationAfterInParent=function(){var e=this.node,t=e.parentNode;if(null===t)throw new Error("trying to get parent of a detached node");return this.make(t,o.indexOf(t.childNodes,e)+1)},e.prototype.toArray=function(){return[this.node,this.offset]},e.prototype.makeRange=function(e){if(n.isAttr(this.node))throw new Error("cannot make range from attribute node");if(this.isValid()){if(void 0===e){var t=this.node.ownerDocument.createRange();return t.setStart(this.node,this.offset),t}if(n.isAttr(e.node))throw new Error("cannot make range from attribute node");if(e.isValid())return o.rangeFromPoints(this.node,this.offset,e.node,e.offset)}},e.prototype.makeDLocRange=function(e){if(this.isValid()){if(void 0===e)return new c(this,this);if(e.isValid())return new c(this,e)}},e.prototype.mustMakeDLocRange=function(e){var t=void 0!==e?this.makeDLocRange(e):this.makeDLocRange();if(void 0===t)throw new Error("cannot make a range");return t},e.prototype.isValid=function(){var e=this.node;return this.root.contains(n.isAttr(e)?e.ownerElement:e)&&this.offset<=i(e)},e.prototype.normalizeOffset=function(){var e=this.node,t=i(e);return this.offset>t?this.make(e,t):this},e.prototype.equals=function(e){return null!=e&&(this===e||this.node===e.node&&this.offset===e.offset)},e.prototype.compare=function(e){if(this.equals(e))return 0;var t=this,r=t.node,i=t.offset,a=e.node,s=e.offset;if(n.isAttr(r)){if(n.isAttr(a)&&r.ownerElement===a.ownerElement){var l=[r.name,a.name].sort();return l[0]===r.name?-1:1}var u=r.ownerElement;if(u===e.pointedNode)return 1;r=u.parentNode,i=o.indexOf(r.childNodes,u)}if(n.isAttr(a)){var u=a.ownerElement;if(u===this.pointedNode)return-1;a=u.parentNode,s=o.indexOf(a.childNodes,u)}return o.comparePositions(r,i,a,s)},e}();t.DLoc=u,t.findRoot=a,t.getRoot=s;var c=function(){function e(e,t){if(this.start=e,this.end=t,e.root!==t.root)throw new Error("the start and end must be in the same document")}return Object.defineProperty(e.prototype,"collapsed",{get:function(){return this.start.equals(this.end)},enumerable:!0,configurable:!0}),e.prototype.makeDOMRange=function(){if(n.isAttr(this.start.node))throw new Error("cannot make range from attribute node");if(this.start.isValid()){if(n.isAttr(this.end.node))throw new Error("cannot make range from attribute node");if(this.end.isValid())return o.rangeFromPoints(this.start.node,this.start.offset,this.end.node,this.end.offset).range}},e.prototype.mustMakeDOMRange=function(){var e=this.makeDOMRange();if(void 0===e)throw new Error("cannot make a range");return e},e.prototype.equals=function(e){return null!=e&&(this===e||this.start.equals(e.start)&&this.end.equals(e.end))},e.prototype.isValid=function(){return this.start.isValid()&&this.end.isValid()},e.prototype.contains=function(e){var t=this.start.compare(e),r=this.end.compare(e);return t*r<=0},e}();t.DLocRange=c});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/guiroot",["require","exports","./dloc","./domtypeguards","./domutil","./util"],function(e,t,r,n,o,i){"use strict";function a(e){if(!n.isElement(e)||!e.classList.contains("_phantom_wrap"))throw new Error("the node should be a _phantom_wrap element");for(var t=0,r=e.firstChild;null!==r;){if(n.isElement(r)){if(r.classList.contains("_phantom_wrap"))t+=a(r);else if(r.classList.contains("_real"))t+=1;else if(!r.classList.contains("_phantom"))throw new Error("unexpected element in _phantom_wrap")}else if(r.nodeType!==Node.TEXT_NODE)throw new Error("unexpected node in _phantom_wrap");r=r.nextSibling}return t}function s(e,t){if(!n.isElement(e)||!e.classList.contains("_phantom_wrap"))throw new Error("the node should be a _phantom_wrap element");for(var r=t,o=null,i=e.firstChild;null===o&&null!==i;){if(n.isElement(i)){if(i.classList.contains("_phantom_wrap")){var a=s(i,t);null!==a.found&&(o=a.found),t-=a.count}else if(i.classList.contains("_real"))t-=1,t<0&&(o=i);else if(!i.classList.contains("_phantom"))throw new Error("unexpected element in _phantom_wrap")}else if(i.nodeType!==Node.TEXT_NODE)throw new Error("unexpected node in _phantom_wrap");i=i.nextSibling}return{found:o,count:r-t}}Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(r){var n=e.call(this,r)||this;return i.fixPrototype(n,t),n}return __extends(t,e),t}(Error);t.AttributeNotFound=l;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.nodeToPath=function(e){var t=this.node;if(null!==o.closestByClass(e,"_placeholder",t))throw new Error("cannot provide path to node because it is a placeholder node");if(t===e)return"";if(!t.contains(e))throw new Error("node is not a descendant of root");for(var r=[];e!==t;){var i=void 0;if(n.isElement(e)&&!e.matches("._real, ._phantom_wrap, ._attribute_value"))throw new Error("only nodes of class ._real, ._phantom_wrap, and ._attribute_value are supported");var s=o.closestByClass(e,"_attribute_value",t);if(null!==s){var l=o.siblingByClass(s,"_attribute_name");if(null===l)throw new Error("no attribute name found");if(r.unshift("@"+l.textContent),i=o.closestByClass(s,"_real",t),null===i)throw new Error("attribute is detached from real element")}else{if(i=e.parentNode,null===i)throw new Error("detached node");for(var u=0,c=o.indexOf(i.childNodes,e),d=0;d<c;++d){var l=i.childNodes[d];n.isText(l)||n.isElement(l)&&l.classList.contains("_real")?u++:n.isElement(l)&&l.classList.contains("_phantom_wrap")&&(u+=a(l))}n.isElement(i)&&i.classList.contains("_phantom_wrap")||r.unshift(String(u))}e=i}return r.join("/")},t.prototype.pathToNode=function(e){var t=this.node;if(""===e)return t;var r,i=e.split(/\//),a=t;"@"===i[i.length-1][0]&&(r=i.pop());for(var u=null,c=0,d=i;c<d.length;c++){var h=d[c],p=/^(\d+)$/.exec(h);if(null===p)throw new Error("malformed path expression");u=null;for(var f=parseInt(p[1]),m=0;null===u&&m<a.childNodes.length;m++){var v=a.childNodes[m];if((n.isText(v)||n.isElement(v)&&v.classList.contains("_real"))&&--f<0)u=v;else if(n.isElement(v)&&v.classList.contains("_phantom_wrap")){var g=s(v,f);null!==g.found&&(u=g.found),f-=g.count}}if(null===u)return null;a=u}if(void 0!==r){var y=r.slice(1);if(!n.isElement(a))throw new Error("looking for attribute on something which is not an element");var b=a.getElementsByClassName("_attribute_name");u=null;for(var w=0;w<b.length;++w){var _=b[w];if(_.textContent===y){u=_;break}}if(null===u)throw new l("could not find attribute with name: "+y);a=o.siblingByClass(u,"_attribute_value")}return a},t}(r.DLocRoot);t.GUIRoot=u}),define("wed/wed-util",["require","exports","./dloc","./domtypeguards","./guiroot"],function(e,t,r,n,o){"use strict";function i(e,t){var n=e.parentNode;return t.contains(n)?a(r.DLoc.mustMakeDLoc(t,e)):{left:0,top:0,bottom:0}}function a(e){var t,r=e.node,o=e.offset,a=n.isElement(r),s=n.isText(r);if(a)t=r.childNodes.length;else{if(!s)throw new Error("unexpected node type: "+r.nodeType);t=r.length}if(0===t)return i(r,e.root);for(var l,u,c=r.ownerDocument.createRange();o<t;){if(u=r.childNodes[o],n.isElement(u)?l=u.getClientRects()[0]:(c.setStart(r,o),c.setEnd(r,o+1),l=c.getClientRects()[0]),null!=l&&(0!==l.left||0!==l.right||0!==l.top||0!==l.bottom))return{left:l.left,top:l.top,bottom:l.bottom};o++}o=e.offset;for(var d=r.ownerDocument.defaultView;0!==o;){o--,u=void 0;var h=void 0;if(s)h=!0;else{if(!a)throw new Error("unexpected node type: "+r.nodeType);if(u=r.childNodes[o],n.isText(u))h=!0;else{if(!n.isElement(u))throw new Error("unexpected node type: "+u.nodeType);var p=d.getComputedStyle(u).getPropertyValue("display");h="inline"===p||"inline-block"===p}}var f=void 0;if(n.isElement(u)?f=u.getClientRects():(c.setStart(r,o),c.setEnd(r,o+1),f=c.getClientRects()),l=f[f.length-1],null!=l)return h?{left:l.right,top:l.top,bottom:l.bottom}:{left:l.left,top:l.top,bottom:l.bottom}}return i(r,e.root)}function s(e){if(!e.classList.contains("_attribute_value"))throw new Error("getAttrValueNode operates only on attribute values");var t=e,r=e.firstChild;if(null!==r){for(;null!==r&&!n.isText(r);)r=r.nextSibling;null!==r&&(t=r)}return t}function l(e,t){if(null!=t)try{var r=e.caretManager.fromDataLocation(t,0);return null!=r?r.node:void 0}catch(e){if(e instanceof o.AttributeNotFound)return;throw e}}Object.defineProperty(t,"__esModule",{value:!0}),t.boundaryXY=a,t.getAttrValueNode=s,t.getGUINodeIfExists=l}),define("wed/caret-mark",["require","exports","jquery","./domtypeguards","./wed-util"],function(e,t,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n,o,i){this.manager=e,this.layer=n,this.inputField=o,this.scroller=i,this.suspended=0,this.pendingRefresh=!1;var a=this.el=t.createElement("span");a.className="_wed_caret",a.setAttribute("contenteditable","false"),a.textContent=" ";var s=this.dummy=t.createElement("span");s.textContent="",s.style.height="100%",s.style.width="1px",s.style.maxWidth="1px",this.$dummy=r(s),this.boundRefresh=this.refresh.bind(this)}return e.prototype.suspend=function(){this.suspended++},e.prototype.resume=function(){if(this.suspended--,this.suspended<0)throw new Error("too many calls to resume");this.pendingRefresh&&(this.refresh(),this.pendingRefresh=!1)},e.prototype.refresh=function(){if(this.suspended>0)return void(this.pendingRefresh=!0);var e=this.el,t=this.manager.caret;if(null!=t){var r=o.boundaryXY(t),i=this.scroller.getBoundingClientRect(),a=r.top-i.top+this.scroller.scrollTop,s=r.left-i.left+this.scroller.scrollLeft,l=t.node,u=n.isElement(l)?l:l.parentNode,c=getComputedStyle(u).lineHeight,d=a+"px",h=s+"px";e.style.top=d,e.style.left=h,e.style.height=c,e.style.maxHeight=c,e.style.minHeight=c,null===e.parentNode&&this.layer.append(this.el);var p=this.inputField;Number(p.style.zIndex)>0?(p.style.top=d,p.style.left=h):(p.style.top="",p.style.left="")}},e.prototype.getPositionFromScroller=function(){var e=this.el,t={left:Number(e.style.left.replace("px","")),top:Number(e.style.top.replace("px",""))};if(isNaN(t.left)||isNaN(t.top))throw new Error("NAN for left or top");return t},Object.defineProperty(e.prototype,"inDOM",{get:function(){return null!==this.el.parentNode},enumerable:!0,configurable:!0}),e.prototype.scrollIntoView=function(){var e=this.getPositionFromScroller(),t=this.getBoundingClientRect();this.scroller.scrollIntoView(e.left,e.top,e.left+t.width,e.top+t.height)},e.prototype.getBoundingClientRect=function(){return this.el.getBoundingClientRect()},e}();t.CaretMark=i}),define("wed/caret-movement",["require","exports","./domtypeguards","./domutil","./wed-util"],function(e,t,r,n,o){"use strict";function i(e,t){return"edit"===t.getAttributeHandling(e)}function a(e,t,r){var o=n.closestByClass(e.node,"_placeholder",t);if(null!==o){var i=o.parentNode,a=n.indexOf(i.childNodes,o);r&&a++,e=e.make(i,a)}return e}function s(e){var t=e.firstChild;if(!r.isElement(t))throw new Error("docRoot does not contain an element");return t.classList.contains("_placeholder")&&(t=e),t}function l(e,t,r){var o=r.getMode(e),i=o.nodesAroundEditableContents(e),a=i[0],s=i[1];return!(null!==a&&n.indexOf(e.childNodes,a)>=t)&&!(null!==s&&n.indexOf(e.childNodes,s)<t)}function u(e,t){if(void 0===t||void 0===e)return!1;var n=t.firstChild,o=e.lastChild;return r.isElement(n)&&n.classList.contains("_gui")&&!n.classList.contains("_invisible")&&r.isElement(o)&&o.classList.contains("_gui")&&!o.classList.contains("_invisible")}function c(e,t){for(var r=Array.prototype.slice.call(e),n=0,o=r;n<o.length;n++){var i=o[n];if(0!==(i.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING))return i}}function d(e,t,r,n){var o=v[t];if(void 0===o)throw new Error("cannot resolve direction: "+t);return o(e,r,n)}function h(e,t,d){if(null!=e){var h=e.root;e=a(e,h,!0);for(var p=s(t);;){var f=n.closestByClass(e.node,"_gui",h),m=n.nextCaretPosition(e.toArray(),p,!1);if(null===m){e=null;break}e=e.make(m);var v=e.node,g=e.offset,y=n.closest(v,"._gui:not(._invisible)",h);if(null!==y){var b=y.classList.contains("__start_label");if(b&&i(n.closestByClass(y,"_real",h),d)){if(null!==n.closestByClass(v,"_attribute_value",h))break;if(null!==n.closest(v,"._element_name, ._attribute",h)){var w=c(y.getElementsByClassName("_attribute"),v);if(void 0!==w){var _=o.getAttrValueNode(n.childByClass(w,"_attribute_value"));e=e.make(_,0);break}}}if(f===y){e=e.make(y,y.childNodes.length);continue}e=e.make(b||null!==n.closestByClass(v,"_label",y)?v.getElementsByClassName("_element_name")[0]:y,0);break}var E=n.closestByClass(v,"_phantom",h);if(null===E){var x=n.closestByClass(v,"_placeholder",h);if(!(null!==x&&g>0)){if(r.isElement(v)){var N=v.childNodes[g];if(r.isText(N))continue;var C=v.childNodes[g-1];if(u(C,N))break;if(r.isElement(C)&&(r.isElement(N)&&!N.classList.contains("_end_wrapper")&&!C.classList.contains("_start_wrapper")||C.matches("._wed-validation-error, ._gui.__end_label")))continue;if(!l(v,g,d))continue}break}e=e.make(x,x.childNodes.length)}else e=e.make(E,E.childNodes.length)}return null!==e?e:void 0}}function p(e,t,o){if(null!=e){var c=e.root;e=a(e,c,!1);for(var d=s(t);;){var h=n.closestByClass(e.node,"_element_name",c),p=e.node===h&&0===e.offset,f=n.prevCaretPosition(e.toArray(),d,!1);if(null===f){e=null;break}e=e.make(f);var m=e.node,v=e.offset,g=n.closest(m,"._gui:not(._invisible)",c);if(null===g){var y=n.closestByClass(m,"_placeholder",c);if(null!==y){e=e.make(y.firstChild,0);break}var b=n.closestByClass(m,"_phantom",c);if(null===b){if(r.isElement(m)){var w=m.childNodes[v-1];if(r.isText(w))continue;var _=m.childNodes[v];if(u(w,_))break;if(r.isElement(_)&&(r.isElement(w)&&!w.classList.contains("_start_wrapper")&&!_.classList.contains("_end_wrapper")||_.matches("._gui.__start_label, .wed-validation-error")))continue;if(!l(m,v,o))continue}break}e=e.make(b,0)}else{var E=g.classList.contains("__start_label");if(E&&!p&&i(n.closestByClass(g,"_real",c),o)){if(null!==n.closestByClass(m,"_attribute_value",g))break;var x=n.closestByClass(m,"_attribute",g);null===x&&r.isElement(m)&&null!==m.nextElementSibling&&m.nextElementSibling.classList.contains("_attribute")&&(x=m.nextElementSibling),null===x&&(h=n.closestByClass(m,"_element_name",g),x=null!==h?h.nextElementSibling:null);var N=null!==x?x.previousElementSibling:null;if(null===N){var C=g.getElementsByClassName("_attribute");C.length>0&&(N=C[C.length-1])}if(null===N||N.classList.contains("_attribute")||(N=null),null!==N){var S=n.childByClass(N,"_attribute_value");if(v=0,null!==S.lastChild)if(S=S.lastChild,r.isElement(S)&&S.classList.contains("_placeholder"))v=0;else{if(!r.isText(S))throw new Error("unexpected content in attribute value");v=S.length}e=e.make(S,v);break}}if(!p){e=e.make(E||null!==n.closestByClass(m,"_label",g)?g.getElementsByClassName("_element_name")[0]:g,0);break}e=e.make(g,0)}}return null!==e?e:void 0}}function f(e,t,r){if(null!=e){for(var n=o.boundaryXY(e),i=n;n.bottom>i.top;){if(e=h(e,t,r),void 0===e)return;i=o.boundaryXY(e)}for(var a,s=i.bottom,l=1/0;void 0!==e;){var u=Math.abs(i.left-n.left);if(u>l)break;if(s<=i.top)break;l=u,a=e,e=h(e,t,r),void 0!==e&&(i=o.boundaryXY(e))}return a}}function m(e,t,r){if(null!=e){for(var n=o.boundaryXY(e),i=n;n.top<i.bottom;){if(e=p(e,t,r),void 0===e)return;i=o.boundaryXY(e)}for(var a,s=i.top,l=1/0;void 0!==e;){var u=Math.abs(i.left-n.left);if(u>l)break;if(i.bottom<=s)break;l=u,a=e,e=p(e,t,r),void 0!==e&&(i=o.boundaryXY(e))}return a}}Object.defineProperty(t,"__esModule",{value:!0});var v={right:h,left:p,up:m,down:f};t.newPosition=d,t.positionRight=h,t.positionLeft=p,t.positionDown=f,t.positionUp=m}),define("wed/object-check",["require","exports"],function(e,t){
"use strict";function r(e,t){var n=e[t];if("object"==typeof n){for(var o in n)if(r(n,o))return!0;return!1}return n}function n(e,t,o,i){for(var a in e)if(r(e,a)){var s=void 0!==o?[o,a].join("."):a;if(a in t){var l=t[a],u=e[a];l instanceof Array||"object"!=typeof l||"object"!=typeof u||n(u,l,s,i)}else i.missing.push(s)}for(var c in t)if(!(c in e)){var s=void 0!==o?[o,c].join("."):c;i.extra.push(s)}}function o(e,t){var r={missing:[],extra:[]};n(e,t,void 0,r);var o=r;for(var i in o)0===o[i].length&&delete o[i];return o}function i(e,t){var r=o(e,t);if(void 0!==r.missing)throw new Error("missing option: "+r.missing[0]);if(void 0!==r.extra)throw new Error("extra option: "+r.extra[0])}function a(e,t){var r=o(e,t),n=[];if(void 0!==r.missing)for(var i=0,a=r.missing;i<a.length;i++){var s=a[i];n.push("missing option: "+s)}if(void 0!==r.extra)for(var l=0,u=r.extra;l<u.length;l++){var c=u[l];n.push("extra option: "+c)}if(0!==n.length)throw new Error(n.join(", "))}Object.defineProperty(t,"__esModule",{value:!0}),t.check=o,t.assertSummarily=i,t.assertExtensively=a}),define("wed/wed-selection",["require","exports","./domutil"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r){this.converter=e,this.anchor=t,this.focus=void 0===r?t:r}return Object.defineProperty(e.prototype,"range",{get:function(){var e=this.rangeInfo;if(void 0!==e)return e.range},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeInfo",{get:function(){return this.anchor.makeRange(this.focus)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collapsed",{get:function(){return this.anchor.equals(this.focus)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wellFormed",{get:function(){var e=this.range;return void 0!==e&&r.isWellFormedRange(e)},enumerable:!0,configurable:!0}),e.prototype.asDataCarets=function(){var e=this.range;if(void 0!==e){var t=this.converter.toDataLocation(e.startContainer,e.startOffset),r=this.converter.toDataLocation(e.endContainer,e.endOffset);if(void 0!==t&&void 0!==r)return[t,r]}},e.prototype.mustAsDataCarets=function(){var e=this.asDataCarets();if(void 0===e)throw new Error("cannot get the selection as data carets");return e},e.prototype.equals=function(e){return null!=e&&(this.focus.equals(e.focus)&&this.anchor.equals(e.anchor))},e}();t.WedSelection=n}),define("wed/caret-manager",["require","exports","jquery","rxjs/Subject","./browsers","./caret-mark","./caret-movement","./dloc","./domtypeguards","./domutil","./object-check","./wed-selection","./wed-util"],function(e,t,r,n,o,i,a,s,l,u,c,d,h){"use strict";function p(e){if(!l.isElement(e))return null;for(var t=e.previousSibling;null!==t&&!(l.isText(t)||l.isElement(t)&&t.classList.contains("_real"));)t=t.previousSibling;return t}Object.defineProperty(t,"__esModule",{value:!0});var f={textEdit:!1,focus:!1},m=function(){function e(e,t,o,a,s,l,u){var c=this;this.guiRoot=e,this.dataRoot=t,this.inputField=o,this.guiUpdater=a,this.layer=s,this.scroller=l,this.modeTree=u,this.selectionStack=[],this.mark=new i.CaretMark(this,e.node.ownerDocument,s,o,l);var d=this.guiRootEl=e.node;this.dataRootEl=t.node,this.doc=d.ownerDocument,this.win=this.doc.defaultView,this.$inputField=r(this.inputField),this._events=new n.Subject,this.events=this._events.asObservable(),r(this.guiRootEl).on("focus",function(e){c.focusInputField(),e.preventDefault(),e.stopPropagation()}),r(this.win).on("blur.wed",this.onBlur.bind(this)),r(this.win).on("focus.wed",this.onFocus.bind(this))}return Object.defineProperty(e.prototype,"caret",{get:function(){return this.focus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sel",{get:function(){return this._sel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focus",{get:function(){if(void 0!==this._sel)return this._sel.focus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){if(void 0!==this._sel)return this._sel.anchor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"range",{get:function(){var e=this.rangeInfo;return void 0!==e?e.range:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeInfo",{get:function(){var e=this._sel;if(void 0!==e)return e.rangeInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minCaret",{get:function(){return s.DLoc.mustMakeDLoc(this.guiRoot,this.guiRootEl,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxCaret",{get:function(){return s.DLoc.mustMakeDLoc(this.guiRoot,this.guiRootEl,this.guiRootEl.childNodes.length)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"docDLocRange",{get:function(){return new s.DLocRange(this.minCaret,this.maxCaret)},enumerable:!0,configurable:!0}),e.prototype.getNormalizedCaret=function(){var e=this.caret;if(void 0===e)return e;if(this.guiRootEl.contains(e.node)){if(!e.isValid()){var t=new d.WedSelection(this,this.anchor,e.normalizeOffset());this._sel=t,e=t.focus}var r=this._normalizeCaret(e);return null==r?void 0:r}},e.prototype.mustGetNormalizedCaret=function(){var e=this.getNormalizedCaret();if(void 0===e)throw new Error("cannot get a normalized caret");return e},e.prototype.normalizeToEditableRange=function(e){if(e.root!==this.guiRootEl)throw new Error("DLoc object must be for the GUI tree");var t=e.offset,r=e.node;if(l.isElement(r)){var n=this.modeTree.getMode(r),o=n.nodesAroundEditableContents(r),i=o[0],a=o[1],s=null!==i?u.indexOf(r.childNodes,i):-1;if(t<=s)t=s+1;else{var c=null!==a?u.indexOf(r.childNodes,a):r.childNodes.length;t>=c&&(t=c)}return e.makeWithOffset(t)}return e},e.prototype.getDataCaret=function(e){var t=this.getNormalizedCaret();if(void 0!==t)return this.toDataLocation(t,e)},e.prototype.fromDataLocation=function(e,t){if(e instanceof s.DLoc&&(t=e.offset,e=e.node),void 0===t)throw new Error("offset is undefined");var r=this.guiUpdater.fromDataLocation(e,t);if(null!==r){var n=r.offset;if(e=r.node,l.isElement(e)){var o=this.modeTree.getMode(e),i=o.nodesAroundEditableContents(e),a=i[0],c=i[1],d=null!==a?u.indexOf(e.childNodes,a):-1;if(n<=d)n=d+1;else{var h=null!==c?u.indexOf(e.childNodes,c):e.childNodes.length;n>=h&&(n=h)}return r.makeWithOffset(n)}return r}},e.prototype.mustFromDataLocation=function(e,t){var r=this.fromDataLocation.apply(this,arguments);if(void 0===r)throw new Error("cannot convert to a data location");return r},e.prototype.toDataLocation=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var n,o;if(e instanceof s.DLoc){if("boolean"!=typeof t)throw new Error("2nd argument must be a boolean");r=t,t=e.offset,n=e.node,o=e.root}else n=e;if("number"!=typeof t)throw new Error("offset must be a number");var i=this.makeCaret(n,t);if(null===u.closestByClass(n,"_attribute_value",o)){var a=u.closestByClass(n,"_phantom_wrap",o);if(null!==a)i=this.makeCaret(a.getElementsByClassName("_real")[0]);else{for(var c=void 0,d=l.isText(n)?n.parentNode:n;null!==d&&d!==this.guiRootEl;){if(d.classList.contains("_phantom")||d.classList.contains("_gui")){if(!r)return;c=d}d=d.parentNode}void 0!==c&&(i=this.makeCaret(c))}}var h=this._normalizeCaret(i);if(null!=h){n=h.node,t=h.offset;var f=this.dataRoot.pathToNode(this.guiRoot.nodeToPath(n));if(l.isText(n))return this.makeCaret(f,t,!0);if(t>=n.childNodes.length)return null===f?void 0:this.makeCaret(f,f.childNodes.length);var m=n.childNodes[t];if(l.isElement(m)&&!m.classList.contains("_real")){var v=p(m);if(null===v)return this.makeCaret(f,0);if(f=this.dataRoot.pathToNode(this.guiRoot.nodeToPath(v)),null===f)return;var g=f.parentNode;return this.makeCaret(g,u.indexOf(g.childNodes,f)+1)}return f=this.dataRoot.pathToNode(this.guiRoot.nodeToPath(m)),this.makeCaret(f,l.isAttr(f)?t:void 0)}},e.prototype._normalizeCaret=function(e){if(null==e)return e;var t=u.closestByClass(e.node,"_placeholder",e.root);return null!==t?e.make(t):e},e.prototype.makeCaret=function(e,t,r){if(void 0===r&&(r=!1),null!=e){var n;if(this.guiRootEl.contains(e)?n=this.guiRoot:u.contains(this.dataRootEl,e)&&(n=this.dataRoot),void 0!==n)return s.DLoc.mustMakeDLoc(n,e,t,r)}},e.prototype.setRange=function(e,t,r,n){var o,i;if(e instanceof s.DLoc&&t instanceof s.DLoc?(o=e,i=t):(o=this.makeCaret(e,t),i=this.makeCaret(r,n)),void 0===o||void 0===i)throw new Error("must provide both anchor and focus");if(o.root===this.dataRootEl&&(o=this.fromDataLocation(o),i=this.fromDataLocation(i),void 0===o||void 0===i))throw new Error("cannot find GUI anchor and focus");var a=this._sel=new d.WedSelection(this,o,i);if(void 0===this.prevCaret||!this.prevCaret.equals(i)){this.mark.refresh();var l=a.range;if(void 0===l)throw new Error("unable to make a range");this._setDOMSelectionRange(l)}this._caretChange()},e.prototype.newPosition=function(e,t){return a.newPosition(e,t,this.guiRootEl,this.modeTree)},e.prototype.newCaretPosition=function(e){return this.newPosition(this.caret,e)},e.prototype.move=function(e,t){void 0===t&&(t=!1);var r=this.newCaretPosition(e);if(void 0!==r)if(t){var n=this.anchor;void 0!==n&&this.setRange(n,r)}else this.setCaret(r)},e.prototype.setCaret=function(e,t,r){var n;if(e instanceof s.DLoc){if(n=e,"number"==typeof t)throw new Error("2nd argument must be options");r=t,t=void 0}else{if(void 0!==t&&"number"!=typeof t)throw new Error("2nd argument must be number");var o=this.makeCaret(e,t);if(void 0===o)return;n=o}void 0!==r?c.assertSummarily(f,r):r={},this._setGUICaret(n.root===this.guiRootEl?n:this.fromDataLocation(n),r)},e.prototype.setCaretToLabelPosition=function(e,t,r){var n,o=0,i=u.closestByClass(e,"_attribute",t);null!==i?null!==u.closestByClass(r.node,"_attribute_value",t)?(n=r.node,o=r.offset):n=h.getAttrValueNode(i.getElementsByClassName("_attribute_value")[0]):n=t.getElementsByClassName("_element_name")[0],this.setCaret(n,o)},e.prototype.pushSelection=function(){this.selectionStack.push(this._sel)},e.prototype.popSelection=function(){this._sel=this.selectionStack.pop(),this._restoreCaretAndSelection(!1)},e.prototype.popSelectionAndDiscard=function(){this.selectionStack.pop()},e.prototype._restoreCaretAndSelection=function(e){if(void 0!==this.caret&&void 0!==this.anchor&&this.guiRootEl.contains(this.anchor.node)){var t=this.range;if(void 0===t)throw new Error("could not make a range");this._setDOMSelectionRange(t),t.collapsed&&this.focusInputField(),this.mark.refresh(),this._caretChange({gainingFocus:e})}else this.clearSelection()},e.prototype.clearSelection=function(){this._sel=void 0,this.mark.refresh();var e=this._getDOMSelection();e.rangeCount>0&&this.guiRootEl.contains(e.focusNode)&&e.removeAllRanges(),this._caretChange()},e.prototype._getDOMSelectionRange=function(){var e=u.getSelectionRange(this.win);if(void 0!==e&&this.guiRootEl.contains(e.startContainer)&&this.guiRootEl.contains(e.endContainer))return e},e.prototype._setDOMSelectionRange=function(e){if(e.collapsed)return void this._clearDOMSelection();o.FIREFOX&&u.focusNode(e.endContainer);var t=this._getDOMSelection();t.removeAllRanges(),t.addRange(e)},e.prototype._setGUICaret=function(e,t){var r=e.offset,n=e.node;if(l.isElement(n)){if(n.classList.contains("_attribute_value")){var o=h.getAttrValueNode(n);n!==o&&(n=o,e=e.make(n,r))}var i=u.childByClass(n,"_placeholder");null===i||i.classList.contains("_dying")||(n=i,r=0,e=e.make(n,r))}void 0!==this.caret&&this.anchor===this.caret&&this.caret.node===n&&this.caret.offset===r||(t.focus!==!1&&this._clearDOMSelection(!0),this._sel=new d.WedSelection(this,e),this.mark.refresh(),t.focus!==!1&&this.focusInputField(),this._caretChange(t))},e.prototype._caretChange=function(e){void 0===e&&(e={});var t=this.prevCaret,r=this.caret,n=void 0!==r?this.modeTree.getMode(r.node):void 0;void 0!==t&&t.equals(r)||(this._events.next({manager:this,caret:r,mode:n,prevCaret:t,prevMode:this.prevMode,options:e}),this.prevCaret=r,this.prevMode=n)},e.prototype._clearDOMSelection=function(e){void 0===e&&(e=!1),this._getDOMSelection().removeAllRanges(),e||this.focusInputField()},e.prototype._getDOMSelection=function(){return this.win.getSelection()},e.prototype.focusInputField=function(){this.win.focus(),this.$inputField.blur(),this.$inputField.focus()},e.prototype.onBlur=function(){void 0!==this.caret&&(this.selAtBlur=this._sel,this.$inputField.blur(),this._sel=void 0,this.mark.refresh())},e.prototype.onFocus=function(){void 0!==this.selAtBlur&&(this._sel=this.selAtBlur,this._restoreCaretAndSelection(!0),this.selAtBlur=void 0)},e.prototype.highlightRange=function(e){for(var t=e.mustMakeDOMRange(),r=this.scroller.getBoundingClientRect(),n=this.scroller.scrollTop-r.top,o=this.scroller.scrollLeft-r.left,i=this.doc.createElement("div"),a=0,s=Array.from(t.getClientRects());a<s.length;a++){var l=s[a],u=this.doc.createElement("div");u.className="_wed_highlight",u.style.top=l.top+n+"px",u.style.left=l.left+o+"px",u.style.height=l.height+"px",u.style.width=l.width+"px",i.appendChild(u)}return this.layer.append(i),i},e.prototype.dumpCaretInfo=function(){var e=this.getDataCaret();void 0!==e?console.log("data caret",e.node,e.offset):console.log("no data caret"),void 0!==this.anchor?console.log("selection anchor",this.anchor.node,this.anchor.offset):console.log("no selection anchor");var t=this.caret;if(void 0!==t){var r=t.node,n=t.offset;if(console.log("selection focus",r,n),console.log("selection focus closest real",u.closestByClass(r,"_real",this.guiRootEl)),l.isText(r)&&n<r.data.length){var o=this.doc.createRange();o.setStart(r,n),o.setEnd(r,n+1);var i=o.getBoundingClientRect();console.log("rectangle around character at caret:",i)}}else console.log("no selection focus");u.dumpRange("DOM range: ",this._getDOMSelectionRange()),console.log("input field location",this.inputField.style.top,this.inputField.style.left),console.log("document.activeElement",document.activeElement)},e}();t.CaretManager=m}),define("wed/domlistener",["require","exports","./domtypeguards"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){var r=this;this.root=e,this.updater=t,this.eventHandlers={"included-element":[],"added-element":[],"excluded-element":[],"excluding-element":[],"removed-element":[],"removing-element":[],"children-changed":[],"children-changing":[],"text-changed":[],"attribute-changed":[]},this.triggerHandlers=Object.create(null),this.triggersToFire=Object.create(null),this.stopped=!0,this.updater.events.subscribe(function(e){switch(e.name){case"InsertNodeAt":r._insertNodeAtHandler(e);break;case"SetTextNodeValue":r._setTextNodeValueHandler(e);break;case"BeforeDeleteNode":r._beforeDeleteNodeHandler(e);break;case"DeleteNode":r._deleteNodeHandler(e);break;case"SetAttributeNS":r._setAttributeNSHandler(e)}})}return e.prototype.startListening=function(){this.stopped=!1},e.prototype.stopListening=function(){this.stopped=!0},e.prototype.processImmediately=function(){void 0!==this.scheduledProcessTriggers&&(this.clearPending(),this._processTriggers())},e.prototype.clearPending=function(){void 0!==this.scheduledProcessTriggers&&(window.clearTimeout(this.scheduledProcessTriggers),this.scheduledProcessTriggers=void 0)},e.prototype.addHandler=function(e,t,r){if("trigger"===e){var n=this.triggerHandlers[t];void 0===n&&(n=this.triggerHandlers[t]=[]),n.push(r)}else{var o=this.eventHandlers[e];if(void 0===o)throw new Error("invalid eventType: "+e);o.push([t,r])}},e.prototype.trigger=function(e){this.triggersToFire[e]=1},e.prototype._processTriggers=function(){for(var e=Object.keys(this.triggersToFire);e.length>0;){this.triggersToFire=Object.create(null);for(var t=this.triggerHandlers,r=0,n=e;r<n.length;r++){var o=n[r],i=t[o];if(void 0!==i)for(var a=0,s=i;a<s.length;a++){var l=s[a];this._callHandler(l)}}e=Object.keys(this.triggersToFire)}},e.prototype._callHandler=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];t.unshift(this.root),e.apply(void 0,t)},e.prototype._insertNodeAtHandler=function(e){if(!this.stopped){var t=e.parent,n=e.node,o=this._childrenCalls("children-changed",t,[n],[],n.previousSibling,n.nextSibling),i=[],a=[];r.isElement(n)&&(i=this._addRemCalls("added-element",n,t),a=this._incExcCalls("included-element",n,t));for(var s=o.concat(i,a),l=0,u=s;l<u.length;l++){var c=u[l];(d=this._callHandler).call.apply(d,[this,c.fn].concat(c.params))}this._scheduleProcessTriggers();var d}},e.prototype._beforeDeleteNodeHandler=function(e){if(!this.stopped){var t=e.node,n=t.parentNode,o=this._childrenCalls("children-changing",n,[],[t],t.previousSibling,t.nextSibling),i=[],a=[];r.isElement(t)&&(i=this._addRemCalls("removing-element",t,n),a=this._incExcCalls("excluding-element",t,n));for(var s=o.concat(i,a),l=0,u=s;l<u.length;l++){var c=u[l];(d=this._callHandler).call.apply(d,[this,c.fn].concat(c.params))}this._scheduleProcessTriggers();var d}},e.prototype._deleteNodeHandler=function(e){if(!this.stopped){var t=e.node,n=e.formerParent,o=this._childrenCalls("children-changed",n,[],[t],null,null),i=[],a=[];r.isElement(t)&&(i=this._addRemCalls("removed-element",t,n),a=this._incExcCalls("excluded-element",t,n));for(var s=o.concat(i,a),l=0,u=s;l<u.length;l++){var c=u[l];(d=this._callHandler).call.apply(d,[this,c.fn].concat(c.params))}this._scheduleProcessTriggers();var d}},e.prototype._childrenCalls=function(e,t,r,n,o,i){if(0!==r.length&&0!==n.length)throw new Error("we do not support having nodes added and removed in the same event");for(var a=this.eventHandlers[e],s=[],l=0,u=a;l<u.length;l++){var c=u[l],d=c[0],h=c[1];t.matches(d)&&s.push({fn:h,params:[r,n,o,i,t]})}return s},e.prototype._setTextNodeValueHandler=function(e){if(!this.stopped){for(var t=this.eventHandlers["text-changed"],r=e.node,n=r.parentNode,o=0,i=t;o<i.length;o++){var a=i[o],s=a[0],l=a[1];n.matches(s)&&this._callHandler(l,r,e.oldValue)}this._scheduleProcessTriggers()}},e.prototype._setAttributeNSHandler=function(e){if(!this.stopped){for(var t=e.node,r=this.eventHandlers["attribute-changed"],n=0,o=r;n<o.length;n++){var i=o[n],a=i[0],s=i[1];t.matches(a)&&this._callHandler(s,t,e.ns,e.attribute,e.oldValue)}this._scheduleProcessTriggers()}},e.prototype._scheduleProcessTriggers=function(){var e=this;void 0===this.scheduledProcessTriggers&&(this.scheduledProcessTriggers=window.setTimeout(function(){e.scheduledProcessTriggers=void 0,e._processTriggers()},0))},e.prototype._addRemCalls=function(e,t,r){for(var n=this.eventHandlers[e],o=[],i=t.previousSibling,a=t.nextSibling,s=0,l=n;s<l.length;s++){var u=l[s],c=u[0],d=u[1];t.matches(c)&&o.push({fn:d,params:[r,i,a,t]})}return o},e.prototype._incExcCalls=function(e,t,r){for(var n=this.eventHandlers[e],o=t.previousSibling,i=t.nextSibling,a=[],s=0,l=n;s<l.length;s++){var u=l[s],c=u[0],d=u[1];t.matches(c)&&a.push({fn:d,params:[t,r,o,i,t]});for(var h=t.querySelectorAll(c),p=0,f=Array.prototype.slice.call(h);p<f.length;p++){var m=f[p];a.push({fn:d,params:[t,r,o,i,m]})}}return a},e}();t.DOMListener=n}),define("wed/gui/icon",["require","exports"],function(e,t){"use strict";function r(e){var t=n[e];if(void 0===t)throw new Error("unknown icon name: "+e);return'<i class="fa fa-fw '+t+'"></i>'}Object.defineProperty(t,"__esModule",{value:!0});var n=Object.create(null);n.add="fa-plus",n.delete="fa-times",n.wrap="fa-caret-square-o-down",n.unwrap="fa-caret-square-o-up",n.documentation="fa-question-circle",n.transform="fa-cog",n.any="fa-asterisk",n.element="fa-angle-left",n.attribute="fa-at",n.other="fa-circle-thin",n.exclamation="fa-exclamation",n["arrow-up"]="fa-arrow-up",n["arrow-down"]="fa-arrow-down",n.upload="fa-cloud-upload",n.undo="fa-undo",n.redo="fa-repeat",t.makeHTML=r});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/editor-actions",["require","exports","rxjs/Subject","./action","./gui/button","./gui/icon"],function(e,t,r,n,o,i){"use strict";function a(e,t,r,o,i){var a,s,l,u;return"boolean"==typeof r?(a=void 0,s=t,l=r,u=o):(a=t,s=r,l=o,u=i),function(t){function r(r){return t.call(this,r,e,a,s,l)||this}return __extends(r,t),r.prototype.execute=function(){u(this.editor)},r}(n.Action)}Object.defineProperty(t,"__esModule",{value:!0}),t.makeAction=a,t.Save=a("Save",i.makeHTML("upload"),!1,function(e){e.save()}),t.Undo=a("Undo",i.makeHTML("undo"),!1,function(e){e.undo()}),t.Redo=a("Redo",i.makeHTML("redo"),!1,function(e){e.redo()}),t.DecreaseLabelVisibilityLevel=a("Decrease label visibility level","Decrease label visibility",i.makeHTML("arrow-down"),!1,function(e){e.decreaseLabelVisiblityLevel()}),t.IncreaseLabelVisibilityLevel=a("Increase label visibility level","Increase label visibility",i.makeHTML("arrow-up"),!1,function(e){e.increaseLabelVisibilityLevel()});var s=function(e){function t(t){var n=e.call(this,t,"Toggle attribute hiding","AH",void 0,!1)||this;return n.pressed=!0,n._events=new r.Subject,n.events=n._events.asObservable(),n}return __extends(t,e),t.prototype.execute=function(e){this.pressed!==e&&(this.pressed=e,this.editor.toggleAttributeHiding(),this._events.next({name:"Pressed",action:this}))},t.prototype.makeButton=function(e){var t=this,r=new o.ToggleButton(this.pressed,void 0!==e?this.getDescriptionFor(e):this.getDescription(),this.getAbbreviatedDescription(),this.getIcon());return r.events.subscribe(function(){t.execute(r.pressed)}),this.events.subscribe(function(){r.pressed=t.pressed}),r},t}(n.Action);t.ToggleAttributeHiding=s});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/exceptions",["require","exports","./util"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(n){var o=e.call(this,n)||this;return r.fixPrototype(o,t),o}return __extends(t,e),t}(Error);t.AbortTransformationException=n});var __assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};define("wed/tree-updater",["require","exports","rxjs/Subject","./dloc","./domtypeguards","./domutil"],function(e,t,r,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i.indexOf,s=function(){function e(e){this.tree=e;var t=n.findRoot(e);if(void 0===t)throw new Error("the tree must have a DLocRoot");this.dlocRoot=t,this._events=new r.Subject,this.events=this._events.asObservable()}return e.prototype._emit=function(e){this._events.next(e),this._events.next({name:"Changed"})},e.prototype.insertAt=function(e,t,r){var i,a;if(e instanceof n.DLoc){if(i=e.node,a=e.offset,"number"==typeof t)throw new Error("incorrect call on insertAt: offset cannot be a number");r=t}else{if(i=e,"number"!=typeof t)throw new Error("incorrect call on insertAt: offset must be a number");a=t}if(r instanceof Array||r instanceof NodeList)for(var s=0;s<r.length;++s,++a){var l=r[s];if("string"!=typeof l&&!o.isElement(l)&&!o.isText(l))throw new Error("Array or NodeList element of the wrong type");this.insertAt(i,a,l)}else if("string"==typeof r)this.insertText(i,a,r);else if(o.isText(r))switch(i.nodeType){case Node.TEXT_NODE:this.insertText(i,a,r.data);break;case Node.ELEMENT_NODE:this.insertNodeAt(i,a,r);break;default:throw new Error("unexpected node type: "+i.nodeType)}else{if(!o.isElement(r))throw new Error("unexpected value for what: "+r);switch(i.nodeType){case Node.TEXT_NODE:this.insertIntoText(i,a,r);break;case Node.DOCUMENT_NODE:case Node.ELEMENT_NODE:this.insertNodeAt(i,a,r);break;default:throw new Error("unexpected node type: "+i.nodeType)}}},e.prototype.splitAt=function(e,t,r){var o;if(t instanceof n.DLoc?(o=t.node,r=t.offset):o=t,void 0===r)throw new Error("splitAt was called with undefined index");if(o===e&&o.nodeType===Node.TEXT_NODE)throw new Error("splitAt called in a way that would result in two adjacent text nodes");if(!e.contains(o))throw new Error("split location is not inside top");var s=e.cloneNode(!0),l=i.correspondingNode(e,s,o),u=this._splitAt(s,l,r),c=u[0],d=u[1],h=e.parentNode;if(null===h)throw new Error("called with detached top");var p=a(h.childNodes,e);return this.deleteNode(e),null!==c&&this.insertNodeAt(h,p,c),null!==d&&this.insertNodeAt(h,p+1,d),u},e.prototype._splitAt=function(e,t,r){var n,i=t===e,s=t.parentNode;if(o.isText(t))if(0===r)n=[null,t];else if(r===t.length)n=[t,null];else{var l=t.data.slice(r);t.deleteData(r,t.length-r),null!==s&&s.insertBefore(s.ownerDocument.createTextNode(l),t.nextSibling),n=[t,t.nextSibling]}else{if(!o.isElement(t))throw new Error("unexpected node type: "+t.nodeType);r<0?r=0:r>t.childNodes.length&&(r=t.childNodes.length);for(var u=t.cloneNode(!0);null!=t.childNodes[r];)t.removeChild(t.childNodes[r]);for(;0!==r--;)u.removeChild(u.firstChild);null!==s&&s.insertBefore(u,t.nextSibling),n=[t,u]}if(i)return n;if(null===s)throw new Error("unable to reach the top");return this._splitAt(e,s,a(s.childNodes,t)+1)},e.prototype.insertBefore=function(e,t,r){var n=null==r?e.childNodes.length:a(e.childNodes,r);if(n===-1)throw new Error("insertBefore called with a beforeThis value which is not a child of parent");this.insertAt(e,n,t)},e.prototype.insertText=function(e,t,r,o){void 0===r&&(r=!0),void 0===o&&(o=!0);var a;if(e instanceof n.DLoc){if("string"!=typeof t)throw new Error("text must be a string");if("boolean"!=typeof r)throw new Error("caretAtEnd must be a boolean");o=r,r=t,a=e.node,t=e.offset}else a=e;var s=i.genericInsertText.call(this,a,t,r,o);return __assign({},s,{caret:n.DLoc.makeDLoc(this.dlocRoot,s.caret[0],s.caret[1])})},e.prototype.deleteText=function(e,t,r){var i;if(e instanceof n.DLoc)r=t,i=e.node,t=e.offset;else if(i=e,void 0===r)throw new Error("length cannot be undefined");if(!o.isText(i))throw new Error("deleteText called on non-text");this.setTextNode(i,i.data.slice(0,t)+i.data.slice(t+r))},e.prototype.insertIntoText=function(e,t,r){var a;if(e instanceof n.DLoc){if(!o.isNode(t))throw new Error("must pass a node as the 2nd argument");r=t,t=e.offset,a=e.node}else a=e;var s=i.genericInsertIntoText.call(this,a,t,r);return[n.DLoc.mustMakeDLoc(this.tree,s[0]),n.DLoc.mustMakeDLoc(this.tree,s[1])]},e.prototype.insertNodeAt=function(e,t,r){var i;if(e instanceof n.DLoc){if(!o.isNode(t))throw new Error("the 2nd argument must be a Node");r=t,t=e.offset,i=e.node}else if(i=e,"number"!=typeof t)throw new Error("index must be a number");if(null==r)throw new Error("called insertNodeAt with absent node");if(o.isDocumentFragment(r))throw new Error("document fragments cannot be passed to insertNodeAt");this._emit({name:"BeforeInsertNodeAt",parent:i,index:t,node:r});var a=i.childNodes[t];i.insertBefore(r,null!=a?a:null),this._emit({name:"InsertNodeAt",parent:i,index:t,node:r})},e.prototype.setTextNode=function(e,t){if(!o.isText(e))throw new Error("setTextNode called on non-text");""!==t?this.setTextNodeValue(e,t):this.deleteNode(e)},e.prototype.setTextNodeValue=function(e,t){if(!o.isText(e))throw new Error("setTextNodeValue called on non-text");var r=e.data;e.data=t,this._emit({name:"SetTextNodeValue",node:e,value:t,oldValue:r})},e.prototype.removeNode=function(e){if(null==e)throw new Error("called without a node value");var t=e.previousSibling,r=e.parentNode;if(null===r)throw new Error("called with detached node");var o=a(r.childNodes,e);return this.deleteNode(e),null===t?n.DLoc.mustMakeDLoc(this.tree,r,o):this.mergeTextNodes(t)},e.prototype.removeNodeNF=function(e){if(null!=e)return this.removeNode(e)},e.prototype.removeNodes=function(e){if(0!==e.length){var t=e[0].previousSibling,r=e[0].parentNode;if(null===r)throw new Error("called with detached node");for(var o=a(r.childNodes,e[0]),i=0;i<e.length;++i){if(i<e.length-1&&e[i].nextSibling!==e[i+1])throw new Error("nodes are not immediately contiguous in document order");this.deleteNode(e[i])}return null===t?n.DLoc.makeDLoc(this.tree,r,o):this.mergeTextNodes(t)}},e.prototype.cut=function(e,t){var r=i.genericCutFunction.call(this,e.toArray(),t.toArray());return r[0]=e.make(r[0]),r},e.prototype.mergeTextNodes=function(e){var t=e.nextSibling;if(o.isText(e)&&null!==t&&o.isText(t)){var r=e.length;return this.setTextNodeValue(e,e.data+t.data),this.deleteNode(t),n.DLoc.mustMakeDLoc(this.tree,e,r)}var i=e.parentNode;if(null===i)throw new Error("called with detached node");return n.DLoc.mustMakeDLoc(this.tree,i,a(i.childNodes,e)+1)},e.prototype.mergeTextNodesNF=function(e){if(null!=e)return this.mergeTextNodes(e)},e.prototype.deleteNode=function(e){this._emit({name:"BeforeDeleteNode",node:e});var t=e.parentNode;if(null===t)throw new Error("called with detached node");t.removeChild(e),this._emit({name:"DeleteNode",node:e,formerParent:t})},e.prototype.setAttribute=function(e,t,r){this.setAttributeNS(e,"",t,r)},e.prototype.setAttributeNS=function(e,t,r,n){if(void 0===n&&(n=null),!o.isElement(e))throw new Error("setAttribute called on non-element");var i=e.getAttributeNS(t,r);""!==i||e.hasAttributeNS(t,r)||(i=null),null!=n?e.setAttributeNS(t,r,n):e.removeAttributeNS(t,r),this._emit({name:"SetAttributeNS",node:e,ns:t,attribute:r,oldValue:i,newValue:n})},e.prototype.nodeToPath=function(e){return this.dlocRoot.nodeToPath(e)},e.prototype.pathToNode=function(e){return this.dlocRoot.pathToNode(e)},e}();t.TreeUpdater=s});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui-updater",["require","exports","jquery","./convert","./dloc","./domtypeguards","./domutil","./tree-updater","./util"],function(e,t,r,n,o,i,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(t,r){var n=e.call(this,t)||this;return n.treeUpdater=r,n.treeUpdater.events.subscribe(function(e){switch(e.name){case"InsertNodeAt":n._insertNodeAtHandler(e);break;case"SetTextNodeValue":n._setTextNodeValueHandler(e);break;case"BeforeDeleteNode":n._beforeDeleteNodeHandler(e);break;case"SetAttributeNS":n._setAttributeNSHandler(e)}}),n}return __extends(t,e),t.prototype._insertNodeAtHandler=function(e){var t=this.fromDataLocation(e.parent,e.index);if(null===t)throw new Error("cannot find gui tree position");var r=n.toHTMLTree(this.tree.ownerDocument,e.node);i.isElement(e.node)&&a.linkTrees(e.node,r),this.insertNodeAt(t,r)},t.prototype._setTextNodeValueHandler=function(e){var t=this.fromDataLocation(e.node,0);if(null===t)throw new Error("cannot find gui tree position");this.setTextNodeValue(t.node,e.value)},t.prototype._beforeDeleteNodeHandler=function(e){var t,n=e.node,o=!1;switch(n.nodeType){case Node.TEXT_NODE:var i=this.fromDataLocation(n,0);if(null===i)throw new Error("cannot find gui tree position");t=i.node;break;case Node.ELEMENT_NODE:t=r.data(n,"wed_mirror_node"),o=!0}this.deleteNode(t),o&&(a.unlinkTree(n),a.unlinkTree(t))},t.prototype._setAttributeNSHandler=function(e){var t=this.fromDataLocation(e.node,0);if(null===t)throw new Error("cannot find gui tree position");this.setAttributeNS(t.node,"",l.encodeAttrName(e.attribute),e.newValue)},t.prototype.fromDataLocation=function(e,t){var r;if(e instanceof o.DLoc)r=e.node,t=e.offset;else if(r=e,void 0===t)throw new Error("must specify an offset");var n=this.pathToNode(this.treeUpdater.nodeToPath(r));if(null===n)return null;if(i.isText(r))return o.DLoc.mustMakeDLoc(this.tree,n,t);if(a.isAttr(r))return i.isText(n.firstChild)&&(n=n.firstChild),o.DLoc.mustMakeDLoc(this.tree,n,t);if(0===t)return o.DLoc.mustMakeDLoc(this.tree,n,0);
if(t>=r.childNodes.length)return o.DLoc.mustMakeDLoc(this.tree,n,n.childNodes.length);var s=this.pathToNode(this.treeUpdater.nodeToPath(r.childNodes[t]));return null===s?o.DLoc.mustMakeDLoc(this.tree,n,n.childNodes.length):o.DLoc.mustMakeDLoc(this.tree,s)},t}(s.TreeUpdater);t.GUIUpdater=u}),define("wed/gui/interactivity",["require","exports","interactjs","../browsers"],function(e,t,r,n){"use strict";function o(e){var t=e.find(".modal-content")[0],n=e.find(".modal-body")[0];r(t).resizable({}).on("resizestart",function(){var t=e.data("bs.modal");null!=t&&(t.ignoreBackdropClick=!0)}).on("resizeend",function(){setTimeout(function(){var t=e.data("bs.modal");null!=t&&(t.ignoreBackdropClick=!1)},0)}).on("resizemove",function(e){var t=e.target,r=new a;r.updateElementRect(t,e.dx,e.dy),r.updateElementRect(n,e.dx,e.dy)})}function i(e){var t,n,o=e[0].ownerDocument.defaultView,i=e.find(".modal-header")[0],a=e.find(".modal-content")[0];r(i).draggable({restrict:{restriction:{left:0,top:0,right:o.innerWidth-10,bottom:o.innerHeight-10}}}).on("dragstart",function(){t=a.offsetLeft,n=a.offsetTop}).on("dragmove",function(e){a.style.left=t+e.clientX-e.clientX0+"px",a.style.top=n+e.clientY-e.clientY0+"px"})}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){this.changes=[],this.rolledback=!1}return e.prototype.updateElementRect=function(e,t,r){if(!this.rolledback){var o=e.getBoundingClientRect();n.MSIE&&(e.style.width=o.width+"px",e.style.height=o.height+"px",o=e.getBoundingClientRect());var i=o.width+t,a=o.height+r;e.style.width=i+"px",e.style.height=a+"px",this.changes.push({el:e,rect:o});var s=e.getBoundingClientRect();s.width===i&&s.height===a||this.rollback()}},e.prototype.rollback=function(){for(var e=this.changes,t=0,r=e;t<r.length;t++){var n=r[t],o=n.el,i=n.rect;o.style.width=i.width+"px",o.style.height=i.height+"px"}this.rolledback=!0},e}();t.makeResizable=o,t.makeDraggable=i}),function(e,t){"function"==typeof define&&define.amd?define("rangy-core",e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){function e(e,t){var r=typeof e[t];return r==w||!(r!=b||!e[t])||"unknown"==r}function t(e,t){return!(typeof e[t]!=b||!e[t])}function r(e,t){return typeof e[t]!=_}function n(e){return function(t,r){for(var n=r.length;n--;)if(!e(t,r[n]))return!1;return!0}}function o(e){return e&&S(e,C)&&k(e,N)}function i(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function a(t){typeof console!=_&&e(console,"log")&&console.log(t)}function s(e,t){O&&t?alert(e):a(e)}function l(e){I.initialized=!0,I.supported=!1,s("Rangy is not supported in this environment. Reason: "+e,I.config.alertOnFail)}function u(e){s("Rangy warning: "+e,I.config.alertOnWarn)}function c(e){return e.message||e.description||String(e)}function d(){if(O&&!I.initialized){var t,r=!1,n=!1;e(document,"createRange")&&(t=document.createRange(),S(t,x)&&k(t,E)&&(r=!0));var s=i(document);if(!s||"body"!=s.nodeName.toLowerCase())return void l("No body element found");if(s&&e(s,"createTextRange")&&(t=s.createTextRange(),o(t)&&(n=!0)),!r&&!n)return void l("Neither Range nor TextRange are available");I.initialized=!0,I.features={implementsDomRange:r,implementsTextRange:n};var u,d;for(var h in A)(u=A[h])instanceof m&&u.init(u,I);for(var p=0,f=L.length;p<f;++p)try{L[p](I)}catch(e){d="Rangy init listener threw an exception. Continuing. Detail: "+c(e),a(d)}}}function h(e,t,r){r&&(e+=" in module "+r.name),I.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function p(e,t,r,n){e[t]=function(){return h(t,r,n),e[r].apply(e,R.toArray(arguments))}}function f(e){e=e||window,d();for(var t=0,r=j.length;t<r;++t)j[t](e)}function m(e,t,r){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=r}function v(e,t,r){var n=new m(e,t,function(t){if(!t.initialized){t.initialized=!0;try{r(I,t),t.supported=!0}catch(t){var n="Module '"+e+"' failed to load: "+c(t);a(n),t.stack&&a(t.stack)}}});return A[e]=n,n}function g(){}function y(){}var b="object",w="function",_="undefined",E=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],x=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],N=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],C=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],S=n(e),P=n(t),k=n(r),T=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var r=0,n=e.length;r<n;++r)t(e[r],r)},A={},O=typeof window!=_&&typeof document!=_,R={isHostMethod:e,isHostObject:t,isHostProperty:r,areHostMethods:S,areHostObjects:P,areHostProperties:k,isTextRange:o,getBody:i,forEach:T},I={version:"1.3.1-dev",initialized:!1,isBrowser:O,supported:!0,util:R,features:{},modules:A,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==_||rangyAutoInitialize}};I.fail=l,I.warn=u;var D;({}).hasOwnProperty?(R.extend=D=function(e,t,r){var n,o;for(var i in t)t.hasOwnProperty(i)&&(n=e[i],o=t[i],r&&null!==n&&"object"==typeof n&&null!==o&&"object"==typeof o&&D(n,o,!0),e[i]=o);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},R.createOptions=function(e,t){var r={};return D(r,t),e&&D(r,e),r}):l("hasOwnProperty not supported"),O||l("Rangy can only run in a browser"),function(){var e;if(O){var t=document.createElement("div");t.appendChild(document.createElement("span"));var r=[].slice;try{1==r.call(t.childNodes,0)[0].nodeType&&(e=function(e){return r.call(e,0)})}catch(e){}}e||(e=function(e){for(var t=[],r=0,n=e.length;r<n;++r)t[r]=e[r];return t}),R.toArray=e}();var M;O&&(e(document,"addEventListener")?M=function(e,t,r){e.addEventListener(t,r,!1)}:e(document,"attachEvent")?M=function(e,t,r){e.attachEvent("on"+t,r)}:l("Document does not have required addEventListener or attachEvent method"),R.addListener=M);var L=[];R.deprecationNotice=h,R.createAliasForDeprecatedMethod=p,I.init=d,I.addInitListener=function(e){I.initialized?e(I):L.push(e)};var j=[];I.addShimListener=function(e){j.push(e)},O&&(I.shim=I.createMissingNativeApi=f,p(I,"createMissingNativeApi","shim")),m.prototype={init:function(){for(var e,t,r=this.dependencies||[],n=0,o=r.length;n<o;++n){if(t=r[n],e=A[t],!(e&&e instanceof m))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){I.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){I.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},I.createModule=function(e){var t,r;2==arguments.length?(t=arguments[1],r=[]):(t=arguments[2],r=arguments[1]);var n=v(e,r,t);I.initialized&&I.supported&&n.init()},I.createCoreModule=function(e,t,r){v(e,t,r)},I.RangePrototype=g,I.rangePrototype=new g,I.selectionPrototype=new y,I.createCoreModule("DomUtil",[],function(e,t){function r(e){var t;return typeof e.namespaceURI==O||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function n(e){var t=e.parentNode;return 1==t.nodeType?t:null}function o(e){for(var t=0;e=e.previousSibling;)++t;return t}function i(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function a(e,t){var r,n=[];for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(L(n,r))return r;return null}function s(e,t,r){for(var n=r?t:t.parentNode;n;){if(n===e)return!0;n=n.parentNode}return!1}function l(e,t){return s(e,t,!0)}function u(e,t,r){for(var n,o=r?e:e.parentNode;o;){if(n=o.parentNode,n===t)return o;o=n}return null}function c(e){var t=e.nodeType;return 3==t||4==t||8==t}function d(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function h(e,t){var r=t.nextSibling,n=t.parentNode;return r?n.insertBefore(e,r):n.appendChild(e),e}function p(e,t,r){var n=e.cloneNode(!1);if(n.deleteData(0,t),e.deleteData(t,e.length-t),h(n,e),r)for(var i,a=0;i=r[a++];)i.node==e&&i.offset>t?(i.node=n,i.offset-=t):i.node==e.parentNode&&i.offset>o(e)&&++i.offset;return n}function f(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=O)return e.ownerDocument;if(typeof e.document!=O)return e.document;if(e.parentNode)return f(e.parentNode);throw t.createError("getDocument: no document found for node")}function m(e){var r=f(e);if(typeof r.defaultView!=O)return r.defaultView;if(typeof r.parentWindow!=O)return r.parentWindow;throw t.createError("Cannot get a window object for node")}function v(e){if(typeof e.contentDocument!=O)return e.contentDocument;if(typeof e.contentWindow!=O)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function g(e){if(typeof e.contentWindow!=O)return e.contentWindow;if(typeof e.contentDocument!=O)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function y(e){return e&&R.isHostMethod(e,"setTimeout")&&R.isHostObject(e,"document")}function b(e,t,r){var n;if(e?R.isHostProperty(e,"nodeType")?n=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?v(e):f(e):y(e)&&(n=e.document):n=document,!n)throw t.createError(r+"(): Parameter must be a Window object or DOM node");return n}function w(e){for(var t;t=e.parentNode;)e=t;return e}function _(e,r,n,i){var s,l,c,d,h;if(e==n)return r===i?0:r<i?-1:1;if(s=u(n,e,!0))return r<=o(s)?-1:1;if(s=u(e,n,!0))return o(s)<i?-1:1;if(l=a(e,n),!l)throw new Error("comparePoints error: nodes have no common ancestor");if(c=e===l?l:u(e,l,!0),d=n===l?l:u(n,l,!0),c===d)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(h=l.firstChild;h;){if(h===c)return-1;if(h===d)return 1;h=h.nextSibling}}function E(e){var t;try{return t=e.parentNode,!1}catch(e){return!0}}function x(e){if(!e)return"[No node]";if(j&&E(e))return"[Broken node]";if(c(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+o(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function N(e){for(var t,r=f(e).createDocumentFragment();t=e.firstChild;)r.appendChild(t);return r}function C(e,t,r){var n=I(e),o=e.createElement("div");o.contentEditable=""+!!r,t&&(o.innerHTML=t);var i=n.firstChild;return i?n.insertBefore(o,i):n.appendChild(o),o}function S(e){return e.parentNode.removeChild(e)}function P(e){this.root=e,this._next=e}function k(e){return new P(e)}function T(e,t){this.node=e,this.offset=t}function A(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var O="undefined",R=e.util,I=R.getBody;R.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),R.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var D=document.createElement("div");R.areHostMethods(D,["insertBefore","appendChild","cloneNode"]||!R.areHostObjects(D,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),R.isHostProperty(D,"innerHTML")||t.fail("Element is missing innerHTML property");var M=document.createTextNode("test");R.areHostMethods(M,["splitText","deleteData","insertData","appendData","cloneNode"]||!R.areHostObjects(D,["previousSibling","nextSibling","childNodes","parentNode"])||!R.areHostProperties(M,["data"]))||t.fail("Incomplete Text Node implementation");var L=function(e,t){for(var r=e.length;r--;)if(e[r]===t)return!0;return!1},j=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var r=t.firstChild;t.innerHTML="<br />",j=E(r),e.features.crashyTextNodes=j}();var F;typeof window.getComputedStyle!=O?F=function(e,t){return m(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=O?F=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),P.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,r=this._current=this._next;if(this._current)if(e=r.firstChild)this._next=e;else{for(t=null;r!==this.root&&!(t=r.nextSibling);)r=r.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},T.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},A.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},A.prototype.toString=function(){return this.message},e.dom={arrayContains:L,isHtmlNamespace:r,parentElement:n,getNodeIndex:o,getNodeLength:i,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:l,getClosestAncestorIn:u,isCharacterDataNode:c,isTextOrCommentNode:d,insertAfter:h,splitDataNode:p,getDocument:f,getWindow:m,getIframeWindow:g,getIframeDocument:v,getBody:I,isWindow:y,getContentDocument:b,getRootContainer:w,comparePoints:_,isBrokenNode:E,inspectNode:x,getComputedStyleProperty:F,createTestElement:C,removeNode:S,fragmentFromNodeChildren:N,createIterator:k,DomPosition:T},e.DOMException=A}),I.createCoreModule("DomRange",["DomUtil"],function(e,t){function r(e,t){return 3!=e.nodeType&&($(e,t.startContainer)||$(e,t.endContainer))}function n(e){return e.document||U(e.startContainer)}function o(e){return G(e.startContainer)}function i(e){return new j(e.parentNode,H(e))}function a(e){return new j(e.parentNode,H(e)+1)}function s(e,t,r){var n=11==e.nodeType?e.firstChild:e;return B(t)?r==t.length?M.insertAfter(e,t):t.parentNode.insertBefore(e,0==r?t:W(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),n}function l(e,t,r){if(C(e),C(t),n(t)!=n(e))throw new F("WRONG_DOCUMENT_ERR");var o=V(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=V(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return r?o<=0&&i>=0:o<0&&i>0}function u(e){for(var t,r,o,i=n(e.range).createDocumentFragment();r=e.next();){if(t=e.isPartiallySelectedSubtree(),r=r.cloneNode(!t),t&&(o=e.getSubtreeIterator(),r.appendChild(u(o)),o.detach()),10==r.nodeType)throw new F("HIERARCHY_REQUEST_ERR");i.appendChild(r)}return i}function c(e,t,r){var n,o;r=r||{stop:!1};for(var i,a;i=e.next();)if(e.isPartiallySelectedSubtree()){if(t(i)===!1)return void(r.stop=!0);if(a=e.getSubtreeIterator(),c(a,t,r),a.detach(),r.stop)return}else for(n=M.createIterator(i);o=n.next();)if(t(o)===!1)return void(r.stop=!0)}function d(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),d(t),t.detach()):e.remove()}function h(e){for(var t,r,o=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(h(r)),r.detach()):e.remove(),10==t.nodeType)throw new F("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function p(e,t,r){var n,o=!(!t||!t.length),i=!!r;o&&(n=new RegExp("^("+t.join("|")+")$"));var a=[];return c(new m(e,!1),function(t){if((!o||n.test(t.nodeType))&&(!i||r(t))){var s=e.startContainer;if(t!=s||!B(s)||e.startOffset!=s.length){var l=e.endContainer;t==l&&B(l)&&0==e.endOffset||a.push(t)}}}),a}function f(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+M.inspectNode(e.startContainer)+":"+e.startOffset+", "+M.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function m(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var r=e.commonAncestorContainer;this.sc===this.ec&&B(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==r||B(this.sc)?q(this.sc,r,!0):this.sc.childNodes[this.so],this._last=this.ec!==r||B(this.ec)?q(this.ec,r,!0):this.ec.childNodes[this.eo-1])}}function v(e){return function(t,r){for(var n,o=r?t:t.parentNode;o;){if(n=o.nodeType,K(e,n))return o;o=o.parentNode}return null}}function g(e,t){if(oe(e,t))throw new F("INVALID_NODE_TYPE_ERR")}function y(e,t){if(!K(t,e.nodeType))throw new F("INVALID_NODE_TYPE_ERR")}function b(e,t){if(t<0||t>(B(e)?e.length:e.childNodes.length))throw new F("INDEX_SIZE_ERR")}function w(e,t){if(re(e,!0)!==re(t,!0))throw new F("WRONG_DOCUMENT_ERR")}function _(e){if(ne(e,!0))throw new F("NO_MODIFICATION_ALLOWED_ERR")}function E(e,t){if(!e)throw new F(t)}function x(e,t){return t<=(B(e)?e.length:e.childNodes.length)}function N(e){return!!e.startContainer&&!!e.endContainer&&!(X&&(M.isBrokenNode(e.startContainer)||M.isBrokenNode(e.endContainer)))&&G(e.startContainer)==G(e.endContainer)&&x(e.startContainer,e.startOffset)&&x(e.endContainer,e.endOffset)}function C(e){if(!N(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}function S(e,t){C(e);var r=e.startContainer,n=e.startOffset,o=e.endContainer,i=e.endOffset,a=r===o;B(o)&&i>0&&i<o.length&&W(o,i,t),B(r)&&n>0&&n<r.length&&(r=W(r,n,t),a?(i-=n,o=r):o==r.parentNode&&i>=H(r)&&i++,n=0),e.setStartAndEnd(r,n,o,i)}function P(e){C(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function k(e){e.START_TO_START=ce,e.START_TO_END=de,e.END_TO_END=he,e.END_TO_START=pe,e.NODE_BEFORE=fe,e.NODE_AFTER=me,e.NODE_BEFORE_AND_AFTER=ve,e.NODE_INSIDE=ge}function T(e){k(e),k(e.prototype)}function A(e,t){return function(){C(this);var r,n,o=this.startContainer,i=this.startOffset,s=this.commonAncestorContainer,l=new m(this,!0);o!==s&&(r=q(o,s,!0),n=a(r),o=n.node,i=n.offset),c(l,_),l.reset();var u=e(l);return l.detach(),t(this,o,i,o,i),u}}function O(t,n){function o(e,t){return function(r){y(r,Y),y(G(r),Z);var n=(e?i:a)(r);(t?s:l)(this,n.node,n.offset)}}function s(e,t,r){var o=e.endContainer,i=e.endOffset;t===e.startContainer&&r===e.startOffset||(G(t)==G(o)&&1!=V(t,r,o,i)||(o=t,i=r),n(e,t,r,o,i))}function l(e,t,r){var o=e.startContainer,i=e.startOffset;t===e.endContainer&&r===e.endOffset||(G(t)==G(o)&&V(t,r,o,i)!=-1||(o=t,i=r),n(e,o,i,t,r))}var u=function(){};u.prototype=e.rangePrototype,t.prototype=new u,L.extend(t.prototype,{setStart:function(e,t){g(e,!0),b(e,t),s(this,e,t)},setEnd:function(e,t){g(e,!0),b(e,t),l(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],r=e[1],o=t,i=r;switch(e.length){case 3:i=e[2];break;case 4:o=e[2],i=e[3]}g(t,!0),b(t,r),g(o,!0),b(o,i),n(this,t,r,o,i)},setBoundary:function(e,t,r){this["set"+(r?"Start":"End")](e,t)},setStartBefore:o(!0,!0),setStartAfter:o(!1,!0),setEndBefore:o(!0,!1),setEndAfter:o(!1,!1),collapse:function(e){C(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){g(e,!0),n(this,e,0,e,z(e))},selectNode:function(e){g(e,!1),y(e,Y);var t=i(e),r=a(e);n(this,t.node,t.offset,r.node,r.offset)},extractContents:A(h,n),deleteContents:A(d,n),canSurroundContents:function(){C(this),_(this.startContainer),_(this.endContainer);var e=new m(this,!0),t=e._first&&r(e._first,this)||e._last&&r(e._last,this);return e.detach(),!t},splitBoundaries:function(){S(this)},splitBoundariesPreservingPositions:function(e){S(this,e)},normalizeBoundaries:function(){C(this);var e,t=this.startContainer,r=this.startOffset,o=this.endContainer,i=this.endOffset,a=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(o=e,i=e.length,e.appendData(t.data),Q(t))},s=function(e){var n=e.previousSibling;if(n&&n.nodeType==e.nodeType){t=e;var a=e.length;if(r=n.length,e.insertData(0,n.data),Q(n),t==o)i+=r,o=t;else if(o==e.parentNode){var s=H(e);i==s?(o=e,i=a):i>s&&i--}}},l=!0;if(B(o))i==o.length?a(o):0==i&&(e=o.previousSibling,e&&e.nodeType==o.nodeType&&(i=e.length,t==o&&(l=!1),e.appendData(o.data),Q(o),o=e));else{if(i>0){var u=o.childNodes[i-1];u&&B(u)&&a(u)}l=!this.collapsed}if(l){if(B(t))0==r?s(t):r==t.length&&(e=t.nextSibling,e&&e.nodeType==t.nodeType&&(o==e&&(o=t,i+=t.length),t.appendData(e.data),Q(e)));else if(r<t.childNodes.length){var c=t.childNodes[r];c&&B(c)&&s(c)}}else t=o,r=i;n(this,t,r,o,i)},collapseToPoint:function(e,t){g(e,!0),b(e,t),this.setStartAndEnd(e,t)},parentElement:function(){C(this);var e=this.commonAncestorContainer;return e?ie(this.commonAncestorContainer,!0):null}}),T(t)}function R(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:M.getCommonAncestor(e.startContainer,e.endContainer)}function I(e,t,r,n,o){e.startContainer=t,e.startOffset=r,e.endContainer=n,e.endOffset=o,e.document=M.getDocument(t),R(e)}function D(e){I(this,e,0,e,0)}var M=e.dom,L=e.util,j=M.DomPosition,F=e.DOMException,B=M.isCharacterDataNode,H=M.getNodeIndex,$=M.isOrIsAncestorOf,U=M.getDocument,V=M.comparePoints,W=M.splitDataNode,q=M.getClosestAncestorIn,z=M.getNodeLength,K=M.arrayContains,G=M.getRootContainer,X=e.features.crashyTextNodes,Q=M.removeNode;m.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,B(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,r=this._current;!B(r)||r!==this.sc&&r!==this.ec?r.parentNode&&Q(r):(e=r===this.sc?this.so:0,t=r===this.ec?this.eo:r.length,e!=t&&r.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return r(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new D(n(this.range));var t=this._current,r=t,o=0,i=t,a=z(t);$(t,this.sc)&&(r=this.sc,o=this.so),$(t,this.ec)&&(i=this.ec,a=this.eo),I(e,r,o,i,a)}return new m(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var Y=[1,3,4,5,7,8,10],Z=[2,9,11],J=[5,6,10,12],ee=[1,3,4,5,7,8,10,11],te=[1,3,4,5,7,8],re=v([9,11]),ne=v(J),oe=v([6,10,12]),ie=v([1]),ae=document.createElement("style"),se=!1;try{ae.innerHTML="<b>x</b>",se=3==ae.firstChild.nodeType}catch(e){}e.features.htmlParsingConforms=se;var le=se?function(e){var t=this.startContainer,r=U(t);if(!t)throw new F("INVALID_STATE_ERR");var n=null;return 1==t.nodeType?n=t:B(t)&&(n=M.parentElement(t)),n=null===n||"HTML"==n.nodeName&&M.isHtmlNamespace(U(n).documentElement)&&M.isHtmlNamespace(n)?r.createElement("body"):n.cloneNode(!1),n.innerHTML=e,M.fragmentFromNodeChildren(n)}:function(e){var t=n(this),r=t.createElement("body");return r.innerHTML=e,M.fragmentFromNodeChildren(r)},ue=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ce=0,de=1,he=2,pe=3,fe=0,me=1,ve=2,ge=3;L.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){C(this),w(this.startContainer,t.startContainer);var r,n,o,i,a=e==pe||e==ce?"start":"end",s=e==de||e==ce?"start":"end";return r=this[a+"Container"],n=this[a+"Offset"],o=t[s+"Container"],i=t[s+"Offset"],V(r,n,o,i)},insertNode:function(e){if(C(this),y(e,ee),_(this.startContainer),$(e,this.startContainer))throw new F("HIERARCHY_REQUEST_ERR");var t=s(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){C(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&B(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var r=new m(this,!0);return e=u(r),r.detach(),e},canSurroundContents:function(){C(this),_(this.startContainer),_(this.endContainer);var e=new m(this,!0),t=e._first&&r(e._first,this)||e._last&&r(e._last,this);return e.detach(),!t},surroundContents:function(e){if(y(e,te),!this.canSurroundContents())throw new F("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);s(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){C(this);for(var e,t=new D(n(this)),r=ue.length;r--;)e=ue[r],t[e]=this[e];return t},toString:function(){C(this);var e=this.startContainer;if(e===this.endContainer&&B(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],r=new m(this,!0);return c(r,function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),r.detach(),t.join("")},compareNode:function(e){C(this);var t=e.parentNode,r=H(e);if(!t)throw new F("NOT_FOUND_ERR");var n=this.comparePoint(t,r),o=this.comparePoint(t,r+1);return n<0?o>0?ve:fe:o>0?me:ge},comparePoint:function(e,t){return C(this),E(e,"HIERARCHY_REQUEST_ERR"),w(e,this.startContainer),V(e,t,this.startContainer,this.startOffset)<0?-1:V(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:le,toHtml:function(){return P(this)},intersectsNode:function(e,t){if(C(this),G(e)!=o(this))return!1;var r=e.parentNode,n=H(e);if(!r)return!0;var i=V(r,n,this.endContainer,this.endOffset),a=V(r,n+1,this.startContainer,this.startOffset);return t?i<=0&&a>=0:i<0&&a>0},isPointInRange:function(e,t){return C(this),E(e,"HIERARCHY_REQUEST_ERR"),w(e,this.startContainer),V(e,t,this.startContainer,this.startOffset)>=0&&V(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return l(this,e,!1)},intersectsOrTouchesRange:function(e){return l(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=V(this.startContainer,this.startOffset,e.startContainer,e.startOffset),r=V(this.endContainer,this.endOffset,e.endContainer,e.endOffset),n=this.cloneRange();return t==-1&&n.setStart(e.startContainer,e.startOffset),1==r&&n.setEnd(e.endContainer,e.endOffset),n}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return V(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(e.startContainer,e.startOffset),1==V(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new F("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ge},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,z(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var r=t.getNodes([3]);if(r.length>0){t.setStart(r[0],0);var n=r.pop();return t.setEnd(n,n.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return C(this),p(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var r=n(this),o=e.createRange(r);t=t||M.getBody(r),o.selectNodeContents(t);var i=this.intersection(o),a=0,s=0;return i&&(o.setEnd(i.startContainer,i.startOffset),a=o.toString().length,s=a+i.toString().length),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,r=0;this.setStart(t,0),this.collapse(!0);for(var n,o,i,a,s=[t],l=!1,u=!1;!u&&(n=s.pop());)if(3==n.nodeType)o=r+n.length,!l&&e.start>=r&&e.start<=o&&(this.setStart(n,e.start-r),l=!0),l&&e.end>=r&&e.end<=o&&(this.setEnd(n,e.end-r),u=!0),r=o;else for(a=n.childNodes,i=a.length;i--;)s.push(a[i])},getName:function(){return"DomRange"},equals:function(e){return D.rangesEqual(this,e)},isValid:function(){return N(this)},inspect:function(){return f(this)},detach:function(){}}),O(D,I),L.extend(D,{rangeProperties:ue,RangeIterator:m,copyComparisonConstants:T,createPrototypeRange:O,inspect:f,toHtml:P,getRangeDocument:n,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=D}),I.createCoreModule("WrappedRange",["DomRange"],function(e,t){var r,n,o=e.dom,i=e.util,a=o.DomPosition,s=e.DomRange,l=o.getBody,u=o.getContentDocument,c=o.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function n(e){for(var t,r=h.length;r--;)t=h[r],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,r,n,o){var i=e.startContainer!==t||e.startOffset!=r,a=e.endContainer!==n||e.endOffset!=o,s=!e.equals(e.nativeRange);(i||a||s)&&(e.setEnd(n,o),e.setStart(t,r))}var c,d,h=s.rangeProperties;r=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,n(this)},s.createPrototypeRange(r,a),c=r.prototype,c.selectNode=function(e){this.nativeRange.selectNode(e),n(this)},c.cloneContents=function(){return this.nativeRange.cloneContents()},c.surroundContents=function(e){this.nativeRange.surroundContents(e),n(this)},c.collapse=function(e){this.nativeRange.collapse(e),n(this)},c.cloneRange=function(){return new r(this.nativeRange.cloneRange())},c.refresh=function(){n(this)},c.toString=function(){return this.nativeRange.toString()};var p=document.createTextNode("test");l(document).appendChild(p);var f=document.createRange();f.setStart(p,0),f.setEnd(p,0);try{f.setStart(p,1),c.setStart=function(e,t){this.nativeRange.setStart(e,t),n(this)},c.setEnd=function(e,t){this.nativeRange.setEnd(e,t),n(this)},d=function(e){return function(t){this.nativeRange[e](t),n(this)}}}catch(e){c.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(r){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}n(this)},c.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(r){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}n(this)},d=function(e,t){return function(r){try{this.nativeRange[e](r)}catch(n){this.nativeRange[t](r),this.nativeRange[e](r)}n(this)}}}c.setStartBefore=d("setStartBefore","setEndBefore"),c.setStartAfter=d("setStartAfter","setEndAfter"),c.setEndBefore=d("setEndBefore","setStartBefore"),c.setEndAfter=d("setEndAfter","setStartAfter"),c.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))},f.selectNodeContents(p),f.setEnd(p,3);var m=document.createRange();m.selectNodeContents(p),m.setEnd(p,4),m.setStart(p,2),f.compareBoundaryPoints(f.START_TO_END,m)==-1&&1==f.compareBoundaryPoints(f.END_TO_START,m)?c.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:c.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var v=document.createElement("div");v.innerHTML="123";var g=v.firstChild,y=l(document);y.appendChild(v),f.setStart(g,1),f.setEnd(g,2),f.deleteContents(),"13"==g.data&&(c.deleteContents=function(){this.nativeRange.deleteContents(),n(this)},c.extractContents=function(){var e=this.nativeRange.extractContents();return n(this),e}),y.removeChild(v),y=null,i.isHostMethod(f,"createContextualFragment")&&(c.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(p),c.getName=function(){return"WrappedRange"},e.WrappedRange=r,e.createNativeRange=function(e){return e=u(e,t,"createNativeRange"),
e.createRange()}}(),e.features.implementsTextRange){var d=function(e){var t=e.parentElement(),r=e.duplicate();r.collapse(!0);var n=r.parentElement();r=e.duplicate(),r.collapse(!1);var i=r.parentElement(),a=n==i?n:o.getCommonAncestor(n,i);return a==t?a:o.getCommonAncestor(t,a)},h=function(e){return 0==e.compareEndPoints("StartToEnd",e)},p=function(e,t,r,n,i){var s=e.duplicate();s.collapse(r);var l=s.parentElement();if(o.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var u=new a(l.parentNode,o.getNodeIndex(l));return{boundaryPosition:u,nodeInfo:{nodeIndex:u.offset,containerElement:u.node}}}var d=o.getDocument(l).createElement("span");d.parentNode&&o.removeNode(d);for(var h,p,f,m,v,g=r?"StartToStart":"StartToEnd",y=i&&i.containerElement==l?i.nodeIndex:0,b=l.childNodes.length,w=b,_=w;;){if(_==b?l.appendChild(d):l.insertBefore(d,l.childNodes[_]),s.moveToElementText(d),h=s.compareEndPoints(g,e),0==h||y==w)break;if(h==-1){if(w==y+1)break;y=_}else w=w==y+1?y:_;_=Math.floor((y+w)/2),l.removeChild(d)}if(v=d.nextSibling,h==-1&&v&&c(v)){s.setEndPoint(r?"EndToStart":"EndToEnd",e);var E;if(/[\r\n]/.test(v.data)){var x=s.duplicate(),N=x.text.replace(/\r\n/g,"\r").length;for(E=x.moveStart("character",N);(h=x.compareEndPoints("StartToEnd",x))==-1;)E++,x.moveStart("character",1)}else E=s.text.length;m=new a(v,E)}else p=(n||!r)&&d.previousSibling,f=(n||r)&&d.nextSibling,m=f&&c(f)?new a(f,0):p&&c(p)?new a(p,p.data.length):new a(l,o.getNodeIndex(d));return o.removeNode(d),{boundaryPosition:m,nodeInfo:{nodeIndex:_,containerElement:l}}},f=function(e,t){var r,n,i,a,s=e.offset,u=o.getDocument(e.node),d=l(u).createTextRange(),h=c(e.node);return h?(r=e.node,n=r.parentNode):(a=e.node.childNodes,r=s<a.length?a[s]:null,n=e.node),i=u.createElement("span"),i.innerHTML="&#feff;",r?n.insertBefore(i,r):n.appendChild(i),d.moveToElementText(i),d.collapse(!t),n.removeChild(i),h&&d[t?"moveStart":"moveEnd"]("character",s),d};n=function(e){this.textRange=e,this.refresh()},n.prototype=new s(document),n.prototype.refresh=function(){var e,t,r,n=d(this.textRange);h(this.textRange)?t=e=p(this.textRange,n,!0,!0).boundaryPosition:(r=p(this.textRange,n,!0,!1),e=r.boundaryPosition,t=p(this.textRange,n,!1,!1,r.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},n.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(n);var m=function(e){if(e.collapsed)return f(new a(e.startContainer,e.startOffset),!0);var t=f(new a(e.startContainer,e.startOffset),!0),r=f(new a(e.endContainer,e.endOffset),!1),n=l(s.getRangeDocument(e)).createTextRange();return n.setEndPoint("StartToStart",t),n.setEndPoint("EndToEnd",r),n};if(n.rangeToTextRange=m,n.prototype.toTextRange=function(){return m(this)},e.WrappedTextRange=n,!e.features.implementsDomRange||e.config.preferTextRange){var v=function(e){return e("return this;")()}(Function);"undefined"==typeof v.Range&&(v.Range=n),e.createNativeRange=function(e){return e=u(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=n}}e.createRange=function(r){return r=u(r,t,"createRange"),new e.WrappedRange(e.createNativeRange(r))},e.createRangyRange=function(e){return e=u(e,t,"createRangyRange"),new s(e)},i.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),i.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var r=t.document;"undefined"==typeof r.createRange&&(r.createRange=function(){return e.createRange(r)}),r=t=null})}),I.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function r(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function n(e,r){if(e){if(k.isWindow(e))return e;if(e instanceof g)return e.win;var n=k.getContentDocument(e,t,r);return k.getWindow(n)}return window}function o(e){return n(e,"getWinSelection").getSelection()}function i(e){return n(e,"getDocSelection").document.selection}function a(e){var t=!1;return e.anchorNode&&(t=1==k.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,r){var n=r?"end":"start",o=r?"start":"end";e.anchorNode=t[n+"Container"],e.anchorOffset=t[n+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function l(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function u(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function c(t){var r;return t instanceof O?(r=e.createNativeRange(t.getDocument()),r.setEnd(t.endContainer,t.endOffset),r.setStart(t.startContainer,t.startOffset)):t instanceof R?r=t.nativeRange:M.implementsDomRange&&t instanceof k.getWindow(t.startContainer).Range&&(r=t),r}function d(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,r=e.length;t<r;++t)if(!k.isAncestorOf(e[0],e[t]))return!1;return!0}function h(e){var r=e.getNodes();if(!d(r))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return r[0]}function p(e){return!!e&&"undefined"!=typeof e.text}function f(e,t){var r=new R(t);e._ranges=[r],s(e,r,!1),e.rangeCount=1,e.isCollapsed=r.collapsed}function m(t){if(t._ranges.length=0,"None"==t.docSelection.type)u(t);else{var r=t.docSelection.createRange();if(p(r))f(t,r);else{t.rangeCount=r.length;for(var n,o=j(r.item(0)),i=0;i<t.rangeCount;++i)n=e.createRange(o),n.selectNode(r.item(i)),t._ranges.push(n);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function v(e,r){for(var n=e.docSelection.createRange(),o=h(r),i=j(n.item(0)),a=F(i).createControlRange(),s=0,l=n.length;s<l;++s)a.add(n.item(s));try{a.add(o)}catch(e){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),m(e)}function g(e,t,r){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=r,this.refresh()}function y(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function b(e,t){for(var r,n,o=te.length;o--;)if(r=te[o],n=r.selection,"deleteAll"==t)y(n);else if(r.win==e)return"delete"==t?(te.splice(o,1),!0):n;return"deleteAll"==t&&(te.length=0),null}function w(e,r){for(var n,o=j(r[0].startContainer),i=F(o).createControlRange(),a=0,s=r.length;a<s;++a){n=h(r[a]);try{i.add(n)}catch(e){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),m(e)}function _(e,t){if(e.win.document!=j(t))throw new I("WRONG_DOCUMENT_ERR")}function E(t){return function(r,n){var o;this.rangeCount?(o=this.getRangeAt(0),o["set"+(t?"Start":"End")](r,n)):(o=e.createRange(this.win.document),o.setStartAndEnd(r,n)),this.setSingleRange(o,this.isBackward())}}function x(e){var t=[],r=new D(e.anchorNode,e.anchorOffset),n=new D(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var i=0,a=e.rangeCount;i<a;++i)t[i]=O.inspect(e.getRangeAt(i));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+r.inspect()+", focus: "+n.inspect()+"]"}e.config.checkSelectionRanges=!0;var N,C,S="boolean",P="number",k=e.dom,T=e.util,A=T.isHostMethod,O=e.DomRange,R=e.WrappedRange,I=e.DOMException,D=k.DomPosition,M=e.features,L="Control",j=k.getDocument,F=k.getBody,B=O.rangesEqual,H=A(window,"getSelection"),$=T.isHostObject(document,"selection");M.implementsWinGetSelection=H,M.implementsDocSelection=$;var U=$&&(!H||e.config.preferTextRange);if(U)N=i,e.isSelectionValid=function(e){var t=n(e,"isSelectionValid").document,r=t.selection;return"None"!=r.type||j(r.createRange().parentElement())==t};else{if(!H)return t.fail("Neither document.selection or window.getSelection() detected."),!1;N=o,e.isSelectionValid=function(){return!0}}e.getNativeSelection=N;var V=N();if(!V)return t.fail("Native selection was null (possibly issue 138?)"),!1;var W=e.createNativeRange(document),q=F(document),z=T.areHostProperties(V,["anchorNode","focusNode","anchorOffset","focusOffset"]);M.selectionHasAnchorAndFocus=z;var K=A(V,"extend");M.selectionHasExtend=K;var G=typeof V.rangeCount==P;M.selectionHasRangeCount=G;var X=!1,Q=!0,Y=K?function(t,r){var n=O.getRangeDocument(r),o=e.createRange(n);o.collapseToPoint(r.endContainer,r.endOffset),t.addRange(c(o)),t.extend(r.startContainer,r.startOffset)}:null;T.areHostMethods(V,["addRange","getRangeAt","removeAllRanges"])&&typeof V.rangeCount==P&&M.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var r=t.rangeCount,n=r>1,o=[],i=a(t),s=0;s<r;++s)o[s]=t.getRangeAt(s);var l=k.createTestElement(document,"",!1),u=l.appendChild(document.createTextNode("")),c=document.createRange();if(c.setStart(u,1),c.collapse(!0),t.removeAllRanges(),t.addRange(c),Q=1==t.rangeCount,t.removeAllRanges(),!n){var d=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(d&&parseInt(d[1])>=36)X=!1;else{var h=c.cloneRange();c.setStart(u,0),h.setEnd(u,3),h.setStart(u,2),t.addRange(c),t.addRange(h),X=2==t.rangeCount}}for(k.removeNode(l),t.removeAllRanges(),s=0;s<r;++s)0==s&&i?Y?Y(t,o[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(o[s])):t.addRange(o[s])}}(),M.selectionSupportsMultipleRanges=X,M.collapsedNonEditableSelectionsSupported=Q;var Z,J=!1;q&&A(q,"createControlRange")&&(Z=q.createControlRange(),T.areHostProperties(Z,["item","add"])&&(J=!0)),M.implementsControlRange=J,C=z?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed};var ee;A(V,"getRangeAt")?ee=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:z&&(ee=function(t){var r=j(t.anchorNode),n=e.createRange(r);return n.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),n.collapsed!==this.isCollapsed&&n.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),n}),g.prototype=e.selectionPrototype;var te=[],re=function(e){if(e&&e instanceof g)return e.refresh(),e;e=n(e,"getNativeSelection");var t=b(e),r=N(e),o=$?i(e):null;return t?(t.nativeSelection=r,t.docSelection=o,t.refresh()):(t=new g(r,o,e),te.push({win:e,selection:t})),t};e.getSelection=re,T.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var ne=g.prototype;if(!U&&z&&T.areHostMethods(V,["removeAllRanges","addRange"])){ne.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),u(this)};var oe=function(e,t){Y(e.nativeSelection,t),e.refresh()};G?ne.addRange=function(t,n){if(J&&$&&this.docSelection.type==L)v(this,t);else if(r(n)&&K)oe(this,t);else{var o;X?o=this.rangeCount:(this.removeAllRanges(),o=0);var i=c(t).cloneRange();try{this.nativeSelection.addRange(i)}catch(e){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var a=ee(this.nativeSelection,this.rangeCount-1);a&&!B(a,t)&&(t=new R(a))}this._ranges[this.rangeCount-1]=t,s(this,t,se(this.nativeSelection)),this.isCollapsed=C(this)}else this.refresh()}}:ne.addRange=function(e,t){r(t)&&K?oe(this,e):(this.nativeSelection.addRange(c(e)),this.refresh())},ne.setRanges=function(e){if(J&&$&&e.length>1)w(this,e);else{this.removeAllRanges();for(var t=0,r=e.length;t<r;++t)this.addRange(e[t])}}}else{if(!(A(V,"empty")&&A(W,"select")&&J&&U))return t.fail("No means of selecting a Range or TextRange was found"),!1;ne.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=j(this.anchorNode);else if(this.docSelection.type==L){var t=this.docSelection.createRange();t.length&&(e=j(t.item(0)))}if(e){var r=F(e).createTextRange();r.select(),this.docSelection.empty()}}}catch(e){}u(this)},ne.addRange=function(t){this.docSelection.type==L?v(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},ne.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?w(this,e):t&&this.addRange(e[0])}}ne.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new I("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var ie;if(U)ie=function(t){var r;e.isSelectionValid(t.win)?r=t.docSelection.createRange():(r=F(t.win.document).createTextRange(),r.collapse(!0)),t.docSelection.type==L?m(t):p(r)?f(t,r):u(t)};else if(A(V,"getRangeAt")&&typeof V.rangeCount==P)ie=function(t){if(J&&$&&t.docSelection.type==L)m(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var r=0,n=t.rangeCount;r<n;++r)t._ranges[r]=new e.WrappedRange(t.nativeSelection.getRangeAt(r));s(t,t._ranges[t.rangeCount-1],se(t.nativeSelection)),t.isCollapsed=C(t)}else u(t)};else{if(!z||typeof V.isCollapsed!=S||typeof W.collapsed!=S||!M.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;ie=function(e){var t,r=e.nativeSelection;r.anchorNode?(t=ee(r,0),e._ranges=[t],e.rangeCount=1,l(e),e.isCollapsed=C(e)):u(e)}}ne.refresh=function(e){var t=e?this._ranges.slice(0):null,r=this.anchorNode,n=this.anchorOffset;if(ie(this),e){var o=t.length;if(o!=this._ranges.length)return!0;if(this.anchorNode!=r||this.anchorOffset!=n)return!0;for(;o--;)if(!B(t[o],this._ranges[o]))return!0;return!1}};var ae=function(e,t){var r=e.getAllRanges();e.removeAllRanges();for(var n=0,o=r.length;n<o;++n)B(t,r[n])||e.addRange(r[n]);e.rangeCount||u(e)};J&&$?ne.removeRange=function(e){if(this.docSelection.type==L){for(var t,r=this.docSelection.createRange(),n=h(e),o=j(r.item(0)),i=F(o).createControlRange(),a=!1,s=0,l=r.length;s<l;++s)t=r.item(s),t!==n||a?i.add(r.item(s)):a=!0;i.select(),m(this)}else ae(this,e)}:ne.removeRange=function(e){ae(this,e)};var se;!U&&z&&M.implementsDomRange?(se=a,ne.isBackward=function(){return se(this)}):se=ne.isBackward=function(){return!1},ne.isBackwards=ne.isBackward,ne.toString=function(){for(var e=[],t=0,r=this.rangeCount;t<r;++t)e[t]=""+this._ranges[t];return e.join("")},ne.collapse=function(t,r){_(this,t);var n=e.createRange(t);n.collapseToPoint(t,r),this.setSingleRange(n),this.isCollapsed=!0},ne.collapseToStart=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},ne.collapseToEnd=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},ne.selectAllChildren=function(t){_(this,t);var r=e.createRange(t);r.selectNodeContents(t),this.setSingleRange(r)},ne.deleteFromDocument=function(){if(J&&$&&this.docSelection.type==L){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),k.removeNode(e);this.refresh()}else if(this.rangeCount){var r=this.getAllRanges();if(r.length){this.removeAllRanges();for(var n=0,o=r.length;n<o;++n)r[n].deleteContents();this.addRange(r[o-1])}}},ne.eachRange=function(e,t){for(var r=0,n=this._ranges.length;r<n;++r)if(e(this.getRangeAt(r)))return t},ne.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},ne.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},ne.callMethodOnEachRange=function(e,t){var r=[];return this.eachRange(function(n){r.push(n[e].apply(n,t||[]))}),r},ne.setStart=E(!0),ne.setEnd=E(!1),e.rangePrototype.select=function(e){re(this.getDocument()).setSingleRange(this,e)},ne.changeEachRange=function(e){var t=[],r=this.isBackward();this.eachRange(function(r){e(r),t.push(r)}),this.removeAllRanges(),r&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},ne.containsNode=function(e,t){return this.eachRange(function(r){return r.containsNode(e,t)},!0)||!1},ne.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},ne.moveToBookmark=function(t){for(var r,n,o=[],i=0;r=t.rangeBookmarks[i++];)n=e.createRange(this.win),n.moveToBookmark(r),o.push(n);t.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},ne.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},ne.restoreRanges=function(e){this.removeAllRanges();for(var t,r=0;t=e.ranges[r];++r)this.addRange(t,e.backward&&0==r)},ne.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(O.toHtml(t))}),e.join("")},M.implementsTextRange&&(ne.getNativeTextRange=function(){var r;if(r=this.docSelection){var n=r.createRange();if(p(n))return n;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),ne.getName=function(){return"WrappedSelection"},ne.inspect=function(){return x(this)},ne.detach=function(){b(this.win,"delete"),y(this)},g.detachAll=function(){b(null,"deleteAll")},g.inspect=x,g.isDirectionBackward=r,e.Selection=g,e.selectionPrototype=ne,e.addShimListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return re(e)}),e=null})});var F=!1,B=function(e){F||(F=!0,!I.initialized&&I.config.autoInitialize&&d())};return O&&("complete"==document.readyState?B():(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",B,!1),M(window,"load",B))),I},this),function(e,t){"function"==typeof define&&define.amd?define("rangy-textrange",["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){return e.createModule("TextRange",["WrappedSelection"],function(e,t){function r(e,t){function r(e,t,r){s.push({start:e,end:t,isWord:r})}for(var n,o,i,a=e.join(""),s=[],l=0;n=t.wordRegex.exec(a);){if(o=n.index,i=o+n[0].length,o>l&&r(l,o,!1),t.includeTrailingSpace)for(;Z.test(e[i]);)++i;r(o,i,!0),l=i}return l<e.length&&r(l,e.length,!1),s}function n(e,t){for(var r=e.slice(t.start,t.end),n={isWord:t.isWord,chars:r,toString:function(){return r.join("")}},o=0,i=r.length;o<i;++o)r[o].token=n;return n}function o(e,t,r){for(var o,i=r(e,t),a=[],s=0;o=i[s++];)a.push(n(e,o));return a}function i(e){var t=e||"",r="string"==typeof t?t.split(""):t;return r.sort(function(e,t){return e.charCodeAt(0)-t.charCodeAt(0)}),r.join("").replace(/(.)\1+/g,"$1")}function a(e){var t,r;return e?(t=e.language||J,r={},z(r,le[t]||le[J]),z(r,e),r):le[J]}function s(e,t){var r=K(e,t);return t.hasOwnProperty("wordOptions")&&(r.wordOptions=a(r.wordOptions)),t.hasOwnProperty("characterOptions")&&(r.characterOptions=K(r.characterOptions,ae)),r}function l(e,t){var r=pe(e,"display",t),n=e.tagName.toLowerCase();return"block"==r&&ie&&fe.hasOwnProperty(n)?fe[n]:r}function u(e){for(var t=f(e),r=0,n=t.length;r<n;++r)if(1==t[r].nodeType&&"none"==l(t[r]))return!0;return!1}function c(e){var t;return 3==e.nodeType&&(t=e.parentNode)&&"hidden"==pe(t,"visibility")}function d(e){return e&&(1==e.nodeType&&!/^(inline(-block|-table)?|none)$/.test(l(e))||9==e.nodeType||11==e.nodeType)}function h(e){return W.isCharacterDataNode(e)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(e.nodeName)}function p(e){for(var t=[];e.parentNode;)t.unshift(e.parentNode),e=e.parentNode;return t}function f(e){return p(e).concat([e])}function m(e){for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null}function v(e,t){return!t&&e.hasChildNodes()?e.firstChild:m(e)}function g(e){var t=e.previousSibling;if(t){for(e=t;e.hasChildNodes();)e=e.lastChild;return e}var r=e.parentNode;return r&&1==r.nodeType?r:null}function y(e){if(!e||3!=e.nodeType)return!1;var t=e.data;if(""===t)return!0;var r=e.parentNode;if(!r||1!=r.nodeType)return!1;var n=pe(e.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(t)&&/^(normal|nowrap)$/.test(n)||/^[\t\r ]+$/.test(t)&&"pre-line"==n}function b(e){if(""===e.data)return!0;if(!y(e))return!1;var t=e.parentNode;return!t||!!u(e)}function w(t){var r=t.nodeType,n=e.config.customIsCollapsedNode;return 7==r||8==r||u(t)||/^(script|style)$/i.test(t.nodeName)||c(t)||b(t)||n&&n(t)}function _(e,t){var r=e.nodeType;return 7==r||8==r||1==r&&"none"==l(e,t)}function E(){this.store={}}function x(e,t,r){return function(n){var o=this.cache;if(o.hasOwnProperty(e))return me++,o[e];ve++;var i=t.call(this,r?this[r]:this,n);return o[e]=i,i}}function N(e,t){this.node=e,this.session=t,this.cache=new E,this.positions=new E}function C(e,t){this.offset=t,this.nodeWrapper=e,this.node=e.node,this.session=e.session,this.cache=new E}function S(){return"[Position("+W.inspectNode(this.node)+":"+this.offset+")]"}function P(){return T(),Te=new Ae}function k(){return Te||P()}function T(){Te&&Te.detach(),Te=null}function A(e,r,n,o){function i(){var e=null;return r?(e=s,l||(s=s.previousVisible(),l=!s||n&&s.equals(n))):l||(e=s=s.nextVisible(),l=!s||n&&s.equals(n)),l&&(s=null),e}n&&(r?w(n.node)&&(n=e.previousVisible()):w(n.node)&&(n=n.nextVisible()));var a,s=e,l=!1,u=!1;return{next:function(){if(u)return u=!1,a;for(var e,t;e=i();)if(t=e.getCharacter(o))return a=e,e;return null},rewind:function(){if(!a)throw t.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");u=!0},dispose:function(){e=n=null}}}function O(e,t,r){function n(e){for(var t,r,n=[],o=e?i:a,s=!1,l=!1;t=o.next();){if(r=t.character,Y.test(r))l&&(l=!1,s=!0);else{if(s){o.rewind();break}l=!0}n.push(t)}return n}var i=A(e,!1,null,t),a=A(e,!0,null,t),s=r.tokenizer,l=n(!0),u=n(!1).reverse(),c=o(u.concat(l),r,s),d=l.length?c.slice(Oe(c,l[0].token)):[],h=u.length?c.slice(0,Oe(c,u.pop().token)+1):[];return{nextEndToken:function(){for(var e,t;1==d.length&&!(e=d[0]).isWord&&(t=n(!0)).length>0;)d=o(e.chars.concat(t),r,s);return d.shift()},previousStartToken:function(){for(var e,t;1==h.length&&!(e=h[0]).isWord&&(t=n(!1)).length>0;)h=o(t.reverse().concat(e.chars),r,s);return h.pop()},dispose:function(){i.dispose(),a.dispose(),d=h=null}}}function R(e,t,r,n,o){var i,a,s,l,u=0,c=e,d=Math.abs(r);if(0!==r){var h=r<0;switch(t){case U:for(a=A(e,h,null,n);(i=a.next())&&u<d;)++u,c=i;s=i,a.dispose();break;case V:for(var p=O(e,n,o),f=h?p.previousStartToken:p.nextEndToken;(l=f())&&u<d;)l.isWord&&(++u,c=h?l.chars[0]:l.chars[l.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+t+"' not implemented")}h?(c=c.previousVisible(),u=-u):c&&c.isLeadingSpace&&!c.isTrailingSpace&&(t==V&&(a=A(e,!1,null,n),s=a.next(),a.dispose()),s&&(c=s.previousVisible()))}return{position:c,unitsMoved:u}}function I(e,t,r,n){var o=e.getRangeBoundaryPosition(t,!0),i=e.getRangeBoundaryPosition(t,!1),a=n?i:o,s=n?o:i;return A(a,!!n,s,r)}function D(e,t,r){for(var n,o=[],i=I(e,t,r);n=i.next();)o.push(n);return i.dispose(),o}function M(t,r,n){var o=e.createRange(t.node);return o.setStartAndEnd(t.node,t.offset,r.node,r.offset),!o.expand("word",{wordOptions:n})}function L(e,t,r,n,o){function i(e,t){var r=m[e].previousVisible(),n=m[t-1],i=!o.wholeWordsOnly||M(r,n,o.wordOptions);return{startPos:r,endPos:n,valid:i}}for(var a,s,l,u,c,d,h=ee(o.direction),p=A(e,h,e.session.getRangeBoundaryPosition(n,h),o.characterOptions),f="",m=[],v=null;a=p.next();)if(s=a.character,r||o.caseSensitive||(s=s.toLowerCase()),h?(m.unshift(a),f=s+f):(m.push(a),f+=s),r){if(c=t.exec(f))if(l=c.index,u=l+c[0].length,d){if(!h&&u<f.length||h&&l>0){v=i(l,u);break}}else d=!0}else if((l=f.indexOf(t))!=-1){v=i(l,l+t.length);break}return d&&(v=i(l,u)),p.dispose(),v}function j(e){return function(){var t=!!Te,r=k(),n=[r].concat(q.toArray(arguments)),o=e.apply(this,n);return t||T(),o}}function F(e,t){return j(function(r,n,o,i){typeof o==$&&(o=n,n=U),i=s(i,ce);var a=e;t&&(a=o>=0,this.collapse(!a));var l=R(r.getRangeBoundaryPosition(this,a),n,o,i.characterOptions,i.wordOptions),u=l.position;return this[a?"setStart":"setEnd"](u.node,u.offset),l.unitsMoved})}function B(e){return j(function(t,r){r=K(r,ae);for(var n,o=I(t,this,r,!e),i=0;(n=o.next())&&Y.test(n.character);)++i;o.dispose();var a=i>0;return a&&this[e?"moveStart":"moveEnd"]("character",e?i:-i,{characterOptions:r}),a})}function H(e){return j(function(t,r){var n=!1;return this.changeEachRange(function(t){n=t[e](r)||n}),n})}var $="undefined",U="character",V="word",W=e.dom,q=e.util,z=q.extend,K=q.createOptions,G=W.getBody,X=/^[ \t\f\r\n]+$/,Q=/^[ \t\f\r]+$/,Y=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,Z=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,J="en",ee=e.Selection.isDirectionBackward,te=!1,re=!1,ne=!1,oe=!0;!function(){var t=W.createTestElement(document,"<p>1 </p><p></p>",!0),r=t.firstChild,n=e.getSelection();n.collapse(r.lastChild,2),n.setStart(r.firstChild,0),te=1==(""+n).length,t.innerHTML="1 <br />",n.collapse(t,2),n.setStart(t.firstChild,0),re=1==(""+n).length,t.innerHTML="1 <p>1</p>",n.collapse(t,2),n.setStart(t.firstChild,0),ne=1==(""+n).length,W.removeNode(t),n.removeAllRanges()}();var ie,ae={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""},se={includeBlockContentTrailingSpace:!oe,includeSpaceBeforeBr:!re,includeSpaceBeforeBlock:!ne,includePreLineTrailingSpace:!0},le={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:r}},ue={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},ce={wordOptions:null,characterOptions:null},de={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},he={wordOptions:null,characterOptions:null,direction:"forward"},pe=W.getComputedStyleProperty;!function(){var e=document.createElement("table"),t=G(document);t.appendChild(e),ie="block"==pe(e,"display"),t.removeChild(e)}();var fe={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};E.prototype={get:function(e){return this.store.hasOwnProperty(e)?this.store[e]:null},set:function(e,t){return this.store[e]=t}};var me=0,ve=0,ge={getPosition:function(e){var t=this.positions;return t.get(e)||t.set(e,new C(this,e))},toString:function(){return"[NodeWrapper("+W.inspectNode(this.node)+")]"}};N.prototype=ge;var ye="EMPTY",be="NON_SPACE",we="UNCOLLAPSIBLE_SPACE",_e="COLLAPSIBLE_SPACE",Ee="TRAILING_SPACE_BEFORE_BLOCK",xe="TRAILING_SPACE_IN_BLOCK",Ne="TRAILING_SPACE_BEFORE_BR",Ce="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",Se="TRAILING_LINE_BREAK_AFTER_BR",Pe="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR";z(ge,{isCharacterDataNode:x("isCharacterDataNode",W.isCharacterDataNode,"node"),getNodeIndex:x("nodeIndex",W.getNodeIndex,"node"),getLength:x("nodeLength",W.getNodeLength,"node"),containsPositions:x("containsPositions",h,"node"),isWhitespace:x("isWhitespace",y,"node"),isCollapsedWhitespace:x("isCollapsedWhitespace",b,"node"),getComputedDisplay:x("computedDisplay",l,"node"),isCollapsed:x("collapsed",w,"node"),isIgnored:x("ignored",_,"node"),next:x("nextPos",v,"node"),previous:x("previous",g,"node"),getTextNodeInfo:x("textNodeInfo",function(e){var t=null,r=!1,n=pe(e.parentNode,"whiteSpace"),o="pre-line"==n;return o?(t=Q,r=!0):"normal"!=n&&"nowrap"!=n||(t=X,r=!0),{node:e,text:e.data,spaceRegex:t,collapseSpaces:r,preLine:o}},"node"),hasInnerText:x("hasInnerText",function(e,t){for(var r=this.session,n=r.getPosition(e.parentNode,this.getNodeIndex()+1),o=r.getPosition(e,0),i=t?n:o,a=t?o:n;i!==a;){if(i.prepopulateChar(),i.isDefinitelyNonEmpty())return!0;i=t?i.previousVisible():i.nextVisible()}return!1},"node"),isRenderedBlock:x("isRenderedBlock",function(e){for(var t=e.getElementsByTagName("br"),r=0,n=t.length;r<n;++r)if(!w(t[r]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:x("trailingSpace",function(e){if("br"==e.tagName.toLowerCase())return"";switch(this.getComputedDisplay()){case"inline":for(var t=e.lastChild;t;){if(!_(t))return 1==t.nodeType?this.session.getNodeWrapper(t).getTrailingSpace():"";t=t.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"\t";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:x("leadingSpace",function(e){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var ke={character:"",characterType:ye,isBr:!1,prepopulateChar:function(){var e=this;if(!e.prepopulatedChar){var t=e.node,r=e.offset,n="",o=ye,i=!1;if(r>0)if(3==t.nodeType){var a=t.data,s=a.charAt(r-1),l=e.nodeWrapper.getTextNodeInfo(),u=l.spaceRegex;l.collapseSpaces?u.test(s)?r>1&&u.test(a.charAt(r-2))||(l.preLine&&"\n"===a.charAt(r)?(n=" ",o=Ce):(n=" ",o=_e)):(n=s,o=be,i=!0):(n=s,o=we,i=!0)}else{var c=t.childNodes[r-1];if(c&&1==c.nodeType&&!w(c)&&("br"==c.tagName.toLowerCase()?(n="\n",e.isBr=!0,o=_e,i=!1):e.checkForTrailingSpace=!0),!n){var d=t.childNodes[r];d&&1==d.nodeType&&!w(d)&&(e.checkForLeadingSpace=!0)}}e.prepopulatedChar=!0,e.character=n,e.characterType=o,e.isCharInvariant=i}},isDefinitelyNonEmpty:function(){var e=this.characterType;return e==be||e==we},resolveLeadingAndTrailingSpaces:function(){if(this.prepopulatedChar||this.prepopulateChar(),this.checkForTrailingSpace){var e=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();e&&(this.isTrailingSpace=!0,this.character=e,this.characterType=_e),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var t=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();t&&(this.isLeadingSpace=!0,this.character=t,this.characterType=_e),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(e){for(var t,r=this;r=r.previousVisible();)if(t=r.getCharacter(e),""!==t)return r;return null},getCharacter:function(e){function t(){return p||(c=f.getPrecedingUncollapsedPosition(e),p=!0),c}this.resolveLeadingAndTrailingSpaces();var r,n=this.character,o=i(e.ignoreCharacters),a=""!==n&&o.indexOf(n)>-1;if(this.isCharInvariant)return r=a?"":n;var s=["character",e.includeSpaceBeforeBr,e.includeBlockContentTrailingSpace,e.includePreLineTrailingSpace,o].join("_"),l=this.cache.get(s);if(null!==l)return l;var u,c,d="",h=this.characterType==_e,p=!1,f=this;return h&&(this.type==Pe?d="\n":" "==n&&(!t()||c.isTrailingSpace||"\n"==c.character||" "==c.character&&c.characterType==_e)||("\n"==n&&this.isLeadingSpace?t()&&"\n"!=c.character&&(d="\n"):(u=this.nextUncollapsed(),u&&(u.isBr?this.type=Ne:u.isTrailingSpace&&"\n"==u.character?this.type=xe:u.isLeadingSpace&&"\n"==u.character&&(this.type=Ee),"\n"==u.character?(this.type!=Ne||e.includeSpaceBeforeBr)&&(this.type!=Ee||e.includeSpaceBeforeBlock)&&(this.type==xe&&u.isTrailingSpace&&!e.includeBlockContentTrailingSpace||(this.type!=Ce||u.type!=be||e.includePreLineTrailingSpace)&&("\n"==n?u.isTrailingSpace?this.isTrailingSpace||this.isBr&&(u.type=Se,t()&&c.isLeadingSpace&&!c.isTrailingSpace&&"\n"==c.character?u.character="":u.type=Pe):d="\n":" "==n&&(d=" "))):d=n)))),o.indexOf(d)>-1&&(d=""),this.cache.set(s,d),d},equals:function(e){return!!e&&this.node===e.node&&this.offset===e.offset},inspect:S,toString:function(){return this.character}};C.prototype=ke,z(ke,{next:x("nextPos",function(e){var t=e.nodeWrapper,r=e.node,n=e.offset,o=t.session;if(!r)return null;var i,a,s;return n==t.getLength()?(i=r.parentNode,a=i?t.getNodeIndex()+1:0):t.isCharacterDataNode()?(i=r,a=n+1):(s=r.childNodes[n],o.getNodeWrapper(s).containsPositions()?(i=s,a=0):(i=r,a=n+1)),i?o.getPosition(i,a):null}),previous:x("previous",function(e){var t,r,n,o=e.nodeWrapper,i=e.node,a=e.offset,s=o.session;return 0==a?(t=i.parentNode,r=t?o.getNodeIndex():0):o.isCharacterDataNode()?(t=i,r=a-1):(n=i.childNodes[a-1],s.getNodeWrapper(n).containsPositions()?(t=n,r=W.getNodeLength(n)):(t=i,r=a-1)),
t?s.getPosition(t,r):null}),nextVisible:x("nextVisible",function(e){var t=e.next();if(!t)return null;var r=t.nodeWrapper,n=t.node,o=t;return r.isCollapsed()&&(o=r.session.getPosition(n.parentNode,r.getNodeIndex()+1)),o}),nextUncollapsed:x("nextUncollapsed",function(e){for(var t=e;t=t.nextVisible();)if(t.resolveLeadingAndTrailingSpaces(),""!==t.character)return t;return null}),previousVisible:x("previousVisible",function(e){var t=e.previous();if(!t)return null;var r=t.nodeWrapper,n=t.node,o=t;return r.isCollapsed()&&(o=r.session.getPosition(n.parentNode,r.getNodeIndex())),o})});var Te=null,Ae=function(){function e(e){var t=new E;return{get:function(r){var n=t.get(r[e]);if(n)for(var o,i=0;o=n[i++];)if(o.node===r)return o;return null},set:function(r){var n=r.node[e],o=t.get(n)||t.set(n,[]);o.push(r)}}}function t(){this.initCaches()}var r=q.isHostProperty(document.documentElement,"uniqueID");return t.prototype={initCaches:function(){this.elementCache=r?function(){var e=new E;return{get:function(t){return e.get(t.uniqueID)},set:function(t){e.set(t.node.uniqueID,t)}}}():e("tagName"),this.textNodeCache=e("data"),this.otherNodeCache=e("nodeName")},getNodeWrapper:function(e){var t;switch(e.nodeType){case 1:t=this.elementCache;break;case 3:t=this.textNodeCache;break;default:t=this.otherNodeCache}var r=t.get(e);return r||(r=new N(e,this),t.set(r)),r},getPosition:function(e,t){return this.getNodeWrapper(e).getPosition(t)},getRangeBoundaryPosition:function(e,t){var r=t?"start":"end";return this.getPosition(e[r+"Container"],e[r+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},t}();z(W,{nextNode:v,previousNode:g});var Oe=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=0,n=e.length;r<n;++r)if(e[r]===t)return r;return-1};z(e.rangePrototype,{moveStart:F(!0,!1),moveEnd:F(!1,!1),move:F(!0,!0),trimStart:B(!0),trimEnd:B(!1),trim:j(function(e,t){var r=this.trimStart(t),n=this.trimEnd(t);return r||n}),expand:j(function(e,t,r){var n=!1;r=s(r,de);var o=r.characterOptions;if(t||(t=U),t==V){var i,a,l=r.wordOptions,u=e.getRangeBoundaryPosition(this,!0),c=e.getRangeBoundaryPosition(this,!1),d=O(u,o,l),h=d.nextEndToken(),p=h.chars[0].previousVisible();if(this.collapsed)i=h;else{var f=O(c,o,l);i=f.previousStartToken()}return a=i.chars[i.chars.length-1],p.equals(u)||(this.setStart(p.node,p.offset),n=!0),a&&!a.equals(c)&&(this.setEnd(a.node,a.offset),n=!0),r.trim&&(r.trimStart&&(n=this.trimStart(o)||n),r.trimEnd&&(n=this.trimEnd(o)||n)),n}return this.moveEnd(U,1,r)}),text:j(function(e,t){return this.collapsed?"":D(e,this,K(t,ae)).join("")}),selectCharacters:j(function(e,t,r,n,o){var i={characterOptions:o};t||(t=G(this.getDocument())),this.selectNodeContents(t),this.collapse(!0),this.moveStart("character",r,i),this.collapse(!0),this.moveEnd("character",n-r,i)}),toCharacterRange:j(function(e,t,r){t||(t=G(this.getDocument()));var n,o,i=t.parentNode,a=W.getNodeIndex(t),s=W.comparePoints(this.startContainer,this.endContainer,i,a)==-1,l=this.cloneRange();return s?(l.setStartAndEnd(this.startContainer,this.startOffset,i,a),n=-l.text(r).length):(l.setStartAndEnd(i,a,this.startContainer,this.startOffset),n=l.text(r).length),o=n+this.text(r).length,{start:n,end:o}}),findText:j(function(t,r,n){n=s(n,ue),n.wholeWordsOnly&&(n.wordOptions.includeTrailingSpace=!1);var o=ee(n.direction),i=n.withinRange;i||(i=e.createRange(),i.selectNodeContents(this.getDocument()));var a=r,l=!1;"string"==typeof a?n.caseSensitive||(a=a.toLowerCase()):l=!0;var u=t.getRangeBoundaryPosition(this,!o),c=i.comparePoint(u.node,u.offset);c===-1?u=t.getRangeBoundaryPosition(i,!0):1===c&&(u=t.getRangeBoundaryPosition(i,!1));for(var d,h=u,p=!1;;)if(d=L(h,a,l,i,n)){if(d.valid)return this.setStartAndEnd(d.startPos.node,d.startPos.offset,d.endPos.node,d.endPos.offset),!0;h=o?d.startPos:d.endPos}else{if(!n.wrap||p)return!1;i=i.cloneRange(),h=t.getRangeBoundaryPosition(i,!o),i.setBoundary(u.node,u.offset,o),p=!0}}),pasteHtml:function(e){if(this.deleteContents(),e){var t=this.createContextualFragment(e),r=t.lastChild;this.insertNode(t),this.collapseAfter(r)}}}),z(e.selectionPrototype,{expand:j(function(e,t,r){this.changeEachRange(function(e){e.expand(t,r)})}),move:j(function(e,t,r,n){var o=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var i=this.getRangeAt(0);n||(n={}),n.characterOptions=K(n.characterOptions,se),o=i.move(t,r,n),this.setSingleRange(i)}return o}),trimStart:H("trimStart"),trimEnd:H("trimEnd"),trim:H("trim"),selectCharacters:j(function(t,r,n,o,i,a){var s=e.createRange(r);s.selectCharacters(r,n,o,a),this.setSingleRange(s,i)}),saveCharacterRanges:j(function(e,t,r){for(var n=this.getAllRanges(),o=n.length,i=[],a=1==o&&this.isBackward(),s=0,l=n.length;s<l;++s)i[s]={characterRange:n[s].toCharacterRange(t,r),backward:a,characterOptions:r};return i}),restoreCharacterRanges:j(function(t,r,n){this.removeAllRanges();for(var o,i,a,s=0,l=n.length;s<l;++s)i=n[s],a=i.characterRange,o=e.createRange(r),o.selectCharacters(r,a.start,a.end,i.characterOptions),this.addRange(o,i.backward)}),text:j(function(e,t){for(var r=[],n=0,o=this.rangeCount;n<o;++n)r[n]=this.getRangeAt(n).text(t);return r.join("")})}),e.innerText=function(t,r){var n=e.createRange(t);n.selectNodeContents(t);var o=n.text(r);return o},e.createWordIterator=function(e,t,r){var n=k();r=s(r,he);var o=n.getPosition(e,t),i=O(o,r.characterOptions,r.wordOptions),a=ee(r.direction);return{next:function(){return a?i.previousStartToken():i.nextEndToken()},dispose:function(){i.dispose(),this.next=function(){}}}},e.noMutation=function(e){var t=k();e(t),T()},e.noMutation.createEntryPointFunction=j,e.textRange={isBlockNode:d,isCollapsedWhitespaceNode:b,createPosition:j(function(e,t,r){return e.getPosition(t,r)})}}),e},this),define("wed/glue/rangy-glue",["require","exports","rangy","rangy-textrange"],function(e,t,r){"use strict";return r}),define("wed/search",["require","exports","rangy","./dloc","./domtypeguards","./domutil"],function(e,t,r,n,o,i){"use strict";function a(e){throw new Error("unknown direction: "+e)}function s(e){var t=(r={},r[u.FORWARD]="forward",r[u.BACKWARDS]="backward",r)[e];return void 0===t?a(e):t;var r}function l(e,t,r){var n=e.createRange();return n.selectNode(t),n.compareBoundaryPoints(Range.START_TO_START,r)>=0&&n.compareBoundaryPoints(Range.END_TO_END,r)<=0}Object.defineProperty(t,"__esModule",{value:!0});var u;!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARDS=1]="BACKWARDS"}(u=t.Direction||(t.Direction={}));var c;!function(e){e[e.EVERYWHERE=0]="EVERYWHERE",e[e.TEXT=1]="TEXT",e[e.ATTRIBUTE_VALUES=2]="ATTRIBUTE_VALUES"}(c=t.Context||(t.Context={}));var d=function(){function e(e,t){this.values=e,this.direction=t,this.resetToStart()}return e.prototype.reset=function(e){this.current=e},e.prototype.resetToStart=function(){switch(this.direction){case u.FORWARD:this.current=0;break;case u.BACKWARDS:this.current=this.values.length-1;break;default:return a(this.direction)}},Object.defineProperty(e.prototype,"hasNext",{get:function(){switch(this.direction){case u.FORWARD:return this.current<this.values.length;case u.BACKWARDS:return this.current>=0;default:return a(this.direction)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){var e=this.values[this.current];return this.inc(),e},enumerable:!0,configurable:!0}),e.prototype.inc=function(){switch(this.direction){case u.FORWARD:this.current++;break;case u.BACKWARDS:this.current--;break;default:return a(this.direction)}},e}(),h=function(){function e(e,t,r,o){this.caretManager=e,this.guiRoot=t,this.start=r,this._pattern="",this.direction=u.FORWARD,this.context=c.EVERYWHERE,this.root=n.getRoot(t),this.setScope(o);var i=this.scope;if(i.start.compare(r)>0||i.end.compare(r)<0)throw new Error("the scope does not contain the start position");this.start=r}return Object.defineProperty(e.prototype,"pattern",{get:function(){return this._pattern},set:function(e){this._pattern=e},enumerable:!0,configurable:!0}),e.prototype.setScope=function(e){if(void 0===e)return void(this._scope=void 0);if(!e.isValid())throw new Error("passed an invalid range");var t=e.start,r=e.end;if(t.root!==this.root.node)throw new Error("the range does not use the search's root");this._scope=t.compare(r)>0?new n.DLocRange(r,t):new n.DLocRange(t,r)},Object.defineProperty(e.prototype,"scope",{get:function(){return void 0===this._scope&&(this._scope=new n.DLocRange(n.DLoc.mustMakeDLoc(this.root,this.guiRoot,0),n.DLoc.mustMakeDLoc(this.root,this.guiRoot,this.guiRoot.childNodes.length))),this._scope},enumerable:!0,configurable:!0}),e.prototype.updateCurrent=function(){this._next(!0)},e.prototype.next=function(){this._next(!1)},e.prototype._next=function(e){var t=null;if(""!==this.pattern){var r=void 0,o=void 0;switch(this.direction){case u.FORWARD:o=this.getForwardSearchStart(e),r=this.scope.start;break;case u.BACKWARDS:o=this.getBackwardSearchStart(e),r=this.scope.end;break;default:return a(this.direction)}var i=this.find(o,this.direction);null!==i?t=new n.DLocRange(n.DLoc.mustMakeDLoc(this.root,i.startContainer,i.startOffset),n.DLoc.mustMakeDLoc(this.root,i.endContainer,i.endOffset)):this.start=r}this.current=t},e.prototype.find=function(e,t){return this.context===c.ATTRIBUTE_VALUES?this.findAttributeValue(e,t):this.findText(e,s(t))},e.prototype.findText=function(e,t){var i=r.config,a=new r.WrappedRange(e.makeRange());this.context===c.TEXT&&(i.customIsCollapsedNode=function(e){return o.isElement(e)&&null!==e.closest("._phantom")});var s=a.findText(this.pattern,{withinRange:this.scope.mustMakeDOMRange(),direction:t});if(s){var l=n.DLoc.mustMakeDLoc(this.guiRoot,a.startContainer,a.startOffset);this.scope.contains(l)||(s=!1)}return i.customIsCollapsedNode=void 0,s?a.nativeRange:null},e.prototype.findAttributeValue=function(e,t){var r=this.guiRoot,o=Array.from(r.getElementsByClassName("_attribute_value")),s=this.caretManager,c=new d(o,t),h=i.closestByClass(e.node,"_attribute_value",r),p=r.ownerDocument,f=this.scope.mustMakeDOMRange();if(null===h){for(var m=void 0;c.hasNext;){var v=c.next;if(l(p,v,f)&&0!==(v.compareDocumentPosition(e.node)&Node.DOCUMENT_POSITION_PRECEDING)){m=v;break}}if(void 0===m)return null;e=e.make(m,0)}else{var g=o.indexOf(h);if(g===-1)throw new Error("internal error: cannot find value in array!");c.reset(g),c.inc()}for(var y=s.toDataLocation(e);;){var b=y.node,g=void 0;switch(t){case u.FORWARD:g=b.value.indexOf(this.pattern,y.offset);break;case u.BACKWARDS:var w=y.offset-this.pattern.length;g=w<0?-1:b.value.lastIndexOf(this.pattern,w);break;default:return a(t)}if(g!==-1){var _=s.mustFromDataLocation(y.makeWithOffset(g)),E=s.mustFromDataLocation(y.makeWithOffset(g+this.pattern.length));if(this.scope.contains(_)&&this.scope.contains(E))return new n.DLocRange(_,E).mustMakeDOMRange()}for(var x=null;null===x&&c.hasNext;)x=c.next,l(p,x,f)||(x=null);if(null===x)return null;var N=s.toDataLocation(x,0);switch(t){case u.FORWARD:break;case u.BACKWARDS:N=N.makeWithOffset(N.node.value.length);break;default:return a(t)}y=N}},e.prototype.getForwardSearchStart=function(e){return null!=this.current?e?this.current.start:this.current.end:this.start},e.prototype.getBackwardSearchStart=function(e){var t;return null!=this.current&&(t=e?this.prevEnd:this.current.start),void 0===t&&(t=this.start),this.prevEnd=t,t},e}();t.Search=h}),define("wed/gui/search-replace",["require","exports","../dloc","../domutil","../search"],function(e,t,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=o.Context,t.Direction=o.Direction;var i;!function(e){e[e.START=0]="START",e[e.END=1]="END"}(i||(i={}));var a=function(){function e(e,t){this.editor=e,this.scroller=t,this.lastMatch=null,this.caretManager=this.editor.caretManager;var n=this.caretManager.sel,i=void 0===n||n.collapsed?void 0:new r.DLocRange(n.anchor,n.focus),a=void 0!==i?i.start:this.caretManager.caret;if(void 0===a)throw new Error("search without a caret!");this.search=new o.Search(this.caretManager,e.guiRoot,a,i)}return Object.defineProperty(e.prototype,"current",{get:function(){return this.search.current},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canReplace",{get:function(){var e=this.search.current;return null!=e&&(!e.collapsed&&n.isWellFormedRange(e.mustMakeDOMRange()))},enumerable:!0,configurable:!0}),e.prototype.updatePattern=function(e,t){this.search.pattern=e,this.search.direction=t.direction,this.search.context=t.context,this.search.updateCurrent(),this.updateHighlight()},e.prototype.next=function(e){this.search.direction=e.direction,this.search.context=e.context,this.search.next(),this.updateHighlight()},e.prototype.updateHighlight=function(){this.clearHighlight();var e=this.current;if(null!=e){this.lastMatch=e,this.setCaretToMatch();var t=e.start.mustMakeDLocRange(e.end),r=t.mustMakeDOMRange();this.highlight=this.caretManager.highlightRange(t);var n=this.scroller.getBoundingClientRect(),o=r.getBoundingClientRect(),i=this.scroller.scrollLeft-n.left,a=this.scroller.scrollTop-n.top;this.scroller.scrollIntoView(o.left+i,o.top+a,o.right+i,o.bottom+a)}},e.prototype.clearHighlight=function(){void 0!==this.highlight&&(this.highlight.parentNode.removeChild(this.highlight),this.highlight=void 0)},e.prototype.setCaretToMatch=function(){if(null!==this.lastMatch){var e=this.getDirectionalEnd(this.lastMatch);this.caretManager.setCaret(e,{focus:!1})}},e.prototype.getDirectionalEnd=function(e){return this.getDirectionalEdge(e,i.END)},e.prototype.getDirectionalStart=function(e){return this.getDirectionalEdge(e,i.START)},e.prototype.getDirectionalEdge=function(e,t){var r,n=this.search.direction,a=t===i.START;switch(n){case o.Direction.FORWARD:r=a?"start":"end";break;case o.Direction.BACKWARDS:r=a?"end":"start";break;default:var s=n;throw new Error("unknown direction: "+s)}return e[r]},e.prototype.replace=function(e){if(!this.canReplace)throw new Error("tried to replace when it is not possible");var t=this.current;if(null==t)throw new Error("no current match");var r=this.getDirectionalStart(t);this.caretManager.setCaret(r,{focus:!1}),this.editor.fireTransformation(this.editor.replaceRangeTr,{range:t,newText:e}),this.clearHighlight();var n=this.caretManager.caret;if(void 0===n)throw new Error("no caret after replacement!");this.search.current=n.mustMakeDLocRange()},e}();t.SearchReplace=a}),define("wed/gui/dialog-search-replace",["require","exports","bootbox","jquery","./interactivity","./search-replace"],function(e,t,r,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Direction=i.Direction;var a="\n<form>\n <div class='form-group'>\n  <label>Search for:</label>\n  <input type='text' name='search' class='form-control'>\n </div>\n <div class='form-group'>\n  <label>Replace with:</label>\n  <input type='text' name='replace' class='form-control'>\n </div>\n <div class='radio'>\n  <span>Direction:</span>\n  <div>\n   <label class='radio-inline'>\n    <input type='radio' name='direction' value='forward'> Forward\n   </label>\n  </div>\n  <div>\n   <label class='radio-inline'>\n    <input type='radio' name='direction' value='backwards'> Backwards\n   </label>\n  <div>\n </div>\n <div class='radio'>\n  <span>Context:</span>\n  <div>\n   <label class='radio-inline'>\n    <input type='radio' name='context' value='text' checked>\n    Only element text\n   </label>\n  </div>\n  <div>\n   <label class='radio-inline'>\n    <input type='radio' name='context' value='attributes'>\n    Only attributes values\n   </label>\n  </div>\n </div>\n</form>",s=function(){function e(e,t,s){var l=this;this.search=new i.SearchReplace(e,t);var u=n(a)[0],c=this.dialog=r.dialog({title:"Search/Replace",message:u,onEscape:!0,backdrop:!1,size:"small",buttons:{find:{label:"Find",className:"btn-primary",callback:this.onFind.bind(this)},replaceFind:{label:"Replace and Find",className:"btn-default replace-and-find",callback:this.onReplaceAndFind.bind(this)},replaceAll:{label:"Replace All",className:"btn-default replace-all",callback:this.onReplaceAll.bind(this)},close:{label:"Close"}}});o.makeResizable(c),o.makeDraggable(c);var d=u.elements.namedItem("direction");this.forwardRadioButton=d[0],this.backwardRadioButton=d[1];var h=u.elements.namedItem("context");this.textRadioButton=h[0],this.attributeRadioButton=h[1];var p;switch(s){case i.Direction.FORWARD:p=this.forwardRadioButton;break;case i.Direction.BACKWARDS:p=this.backwardRadioButton;break;default:var f=s;throw new Error("unknown direction: "+f)}p.checked=!0,c.on("hidden.bs.modal",function(){l.search.clearHighlight(),e.caretManager.focusInputField()});var m=this.searchField=u.elements.namedItem("search"),v=n(m);v.on("input",this.onSearchInput.bind(this));var g=this.replaceField=u.elements.namedItem("replace"),y=n(g);y.on("input",this.onReplaceInput.bind(this)),this.replaceButton=c[0].querySelector(".replace-and-find"),this.replaceAll=c[0].querySelector(".replace-all"),this.updateButtons()}return e.prototype.getSearchOptions=function(){var e;if(this.forwardRadioButton.checked)e=i.Direction.FORWARD;else{if(!this.backwardRadioButton.checked)throw new Error("cannot determine direction");e=i.Direction.BACKWARDS}var t;if(this.textRadioButton.checked)t=i.Context.TEXT;else{if(!this.attributeRadioButton.checked)throw new Error("cannot determine context");t=i.Context.ATTRIBUTE_VALUES}return{direction:e,context:t}},e.prototype.onFind=function(){return this.next(),this.updateButtons(),!1},e.prototype.updateButtons=function(){var e=""!==this.replaceField.value;this.replaceButton.disabled=!(e&&this.search.canReplace),this.replaceAll.disabled=!e},e.prototype.onReplaceAndFind=function(){return this.replace(),this.onFind(),!1},e.prototype.onReplaceAll=function(){for(void 0===this.search.current&&this.onFind();null!==this.search.current;)this.search.canReplace&&this.replace(),this.next();return this.updateButtons(),!1},e.prototype.replace=function(){this.search.replace(this.replaceField.value)},e.prototype.next=function(){this.search.next(this.getSearchOptions())},e.prototype.onSearchInput=function(){var e=this.searchField.value;e!==this.previousSearchValue&&(this.previousSearchValue=e,this.search.updatePattern(e,this.getSearchOptions()),this.updateButtons())},e.prototype.onReplaceInput=function(){this.updateButtons()},e}();t.DialogSearchReplace=s});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/transformation",["require","exports","lodash","./action","./domtypeguards","./domutil","./exceptions","./gui/icon"],function(e,t,r,n,o,i,a,s){"use strict";function l(e,t){if(void 0!==e)return e;var r=_[t];return void 0!==r?s.makeHTML(r):void 0}function u(e,t,r,n){var o=e.createElementNS(t,r);if(void 0!==n)for(var i=Object.keys(n).sort(),a=0,s=i;a<s.length;a++){var l=s[a];o.setAttribute(l,n[l])}return o}function c(e,t,r,n,i,a){var s=o.isDocument(t)?t:t.ownerDocument,l=u(s,n,i,a);return e.insertAt(t,r,l),l}function d(e,t,r,n,o,a,s){var l=t.data.slice(r,n),c=t.parentNode;if(null===c)throw new Error("detached node");var d=i.indexOf(c.childNodes,t);e.deleteText(t,r,l.length);var h=u(t.ownerDocument,o,a,s);return""!==l&&h.appendChild(t.ownerDocument.createTextNode(l)),null===t.parentNode?e.insertAt(c,d,h):e.insertAt(t,r,h),h}function h(e,t,r){var n=t.parentNode;if(null===n)throw new Error("detached node");var o=i.indexOf(n.childNodes,t);if(0===r)r=o;else if(r>=t.length)r=o+1;else{var a=t.data.slice(r);e.setTextNode(t,t.data.slice(0,r)),e.insertNodeAt(n,o+1,t.ownerDocument.createTextNode(a)),r=o+1}return[n,r]}function p(e,t,r,n,a,s,l,c){if(!i.isWellFormedRange({startContainer:t,startOffset:r,endContainer:n,endOffset:a}))throw new Error("malformed range");if(o.isText(t)){if(t===n)return d(e,t,r,a,s,l,c);m=h(e,t,r),t=m[0],r=m[1]}if(o.isText(n)&&(v=h(e,n,a),n=v[0],a=v[1]),t!==n)throw new Error("startContainer and endContainer are not the same;probably due to an algorithmic mistake");for(var p=u(t.ownerDocument,s,l,c);--a>=r;){var f=n.childNodes[a];e.deleteNode(f),p.insertBefore(f,p.firstChild)}return e.insertAt(t,r,p),p;var m,v}function f(e,t){var r=t.parentNode;if(null===r)throw new Error("detached node");var n=Array.prototype.slice.call(t.childNodes),o=t.previousSibling,a=t.nextSibling;e.deleteNode(t);for(var s=null!==a?i.indexOf(r.childNodes,a):r.childNodes.length,l=t.lastChild;null!=t.firstChild;)e.insertNodeAt(r,s++,t.firstChild);return null!==l&&e.mergeTextNodes(l),e.mergeTextNodesNF(o),n}function m(e,t){var r=e.caretManager.getDataCaret();if(void 0===r)throw new Error("no caret");if(!t.contains(r.node))throw new Error("caret outside node");var n=e.dataUpdater.splitAt(t,r);e.caretManager.setCaret(i.firstDescendantOrSelf(n[1]),0)}function v(e,t){var r=t.previousElementSibling;if(null!==r&&r.localName===t.localName&&r.namespaceURI===t.namespaceURI){for(var n=r.childNodes.length,i=r.lastChild,a=o.isText(i),s=a?i.length:0,l=r.childNodes.length,u=t.childNodes.length-1;u>=0;--u)e.dataUpdater.insertAt(r,l,t.childNodes[u].cloneNode(!0));a?(e.dataUpdater.mergeTextNodes(i),e.caretManager.setCaret(r.childNodes[n-1],s)):e.caretManager.setCaret(r,n),e.dataUpdater.removeNode(t)}}function g(e,t){var r=t.nextElementSibling;null!==r&&v(e,r)}function y(e,t){var r=t.previousElementSibling;if(null!==r&&r.localName===t.localName&&r.namespaceURI===t.namespaceURI){var n=r.parentNode;if(null===n)throw new Error("detached node");e.dataUpdater.removeNode(t),e.dataUpdater.insertBefore(n,t,r),e.caretManager.setCaret(t)}}function b(e,t){var r=t.nextElementSibling;null!==r&&y(e,r)}function w(e){var t=e.caretManager.sel;if(void 0!==t&&!t.collapsed){if(!t.wellFormed)throw e.modals.getModal("straddling").modal(),new a.AbortTransformationException("selection is not well-formed");for(var r=t.asDataCarets(),n=r[0],o=r[1],i=e.dataUpdater.cut(n,o),s="",l=i[1],u=0,c=l;u<c.length;u++){var d=c[u];s+=d.textContent}var h=e.dataUpdater.insertText(i[0],s);e.caretManager.setRange(n.make(h.node,h.isNew?i[0].offset:0),h.caret)}}Object.defineProperty(t,"__esModule",{value:!0});var _=r.extend(Object.create(null),{add:"add",delete:"delete",transform:"transform",insert:"add","delete-element":"delete","delete-parent":"delete",wrap:"wrap","wrap-content":"wrap","merge-with-next":"transform","merge-with-previous":"transform","swap-with-next":"transform","swap-with-previous":"transform",split:"transform",append:"add",prepend:"add",unwrap:"unwrap","add-attribute":"add","delete-attribute":"delete"}),E=r.extend(Object.create(null),{add:"other",delete:"other",transform:"other",insert:"element","delete-element":"element","delete-parent":"element",wrap:"element","wrap-content":"element","merge-with-next":"element","merge-with-previous":"element","swap-with-next":"element","swap-with-previous":"element",split:"element",append:"element",prepend:"element",unwrap:"element","add-attribute":"attribute","delete-attribute":"attribute"}),x=function(e){function t(t,r,n,o,i,a,s){var u=this;if("function"==typeof o)s=o,u=e.call(this,t,n,void 0,l(void 0,r),!1)||this;else{if(void 0!==o&&"string"!=typeof o)throw new TypeError("abbreviatedDesc must be a string or undefined");if("function"==typeof i)s=i,u=e.call(this,t,n,o,l(void 0,r),!1)||this;else{if(void 0!==i&&"string"!=typeof i)throw new TypeError("iconHtml must be a string or undefined");if("function"==typeof a)s=a,u=e.call(this,t,n,o,l(i,r),!1)||this;else{if(void 0!==a&&"boolean"!=typeof a)throw new TypeError("needsInput must be a boolean or undefined");u=e.call(this,t,n,o,l(i,r),a)||this}}}if(void 0===s)throw new Error("did not specify a handler");return u.handler=s,u.transformationType=r,u.kind=_[r],u.nodeType=E[r],u}return __extends(t,e),t.prototype.getDescriptionFor=function(e){return void 0===e.name?this.desc:this.desc.replace(/<name>/,e.name)},t.prototype.execute=function(e){this.editor.fireTransformation(this,e)},t}(n.Action);t.Transformation=x,t.makeElement=u,t.insertElement=c,t.wrapTextInElement=d,t.wrapInElement=p,t.unwrap=f,t.splitNode=m,t.mergeWithPreviousHomogeneousSibling=v,t.mergeWithNextHomogeneousSibling=g,t.swapWithPreviousHomogeneousSibling=y,t.swapWithNextHomogeneousSibling=b,t.removeMarkup=w}),define("wed/key",["require","exports","./browsers","jquery"],function(e,t,r){"use strict";function n(e,n,o,i,a,s,l,c){if(void 0===n&&(n=!0),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===l&&(l=!1),void 0===c&&(c=t.EITHER),"string"==typeof e){if(1!==e.length)throw new Error("when the first parameter is a string, a one-character string is required");e=e.charCodeAt(0)}else if("number"!=typeof e)throw new Error("the first parameter must be a string or number");return n=void 0===n||!!n,null==o&&(o=n&&r.GECKO?0:e),null==i&&(i=n?e:0),a=!!a,s=!!s,l=!!l,c!==t.EITHER&&(c=!!c),new u(e,n,o,i,a,s,l,c)}function o(e,r){return void 0===r&&(r=t.EITHER),n(e,!1,void 0,void 0,!0,!1,!1,r)}function i(e,r){return void 0===r&&(r=t.EITHER),n(e,!1,void 0,void 0,!1,!1,!0,r)}function a(e,n){return void 0===n&&(n=t.EITHER),r.OSX?i(e,n):o(e,n)}Object.defineProperty(t,"__esModule",{value:!0});var s=0,l=function(){function e(){}return e.prototype.toString=function(){return"EITHER"},e}();t.EITHER_=l,t.EITHER=new l;var u=function(){function e(r,n,o,i,a,l,u,c){void 0===n&&(n=!0),void 0===i&&(i=0),void 0===a&&(a=!1),void 0===l&&(l=!1),void 0===u&&(u=!1),void 0===c&&(c=t.EITHER);var d=[r,o,i,a,l,u,c,n].join(","),h=e.__cache[d];if(void 0!==h)return h;if(n&&c!==t.EITHER)throw new Error("shiftKey with key presses must be EITHER");this.which=r,this.keyCode=o,this.charCode=i,this.ctrlKey=a,this.altKey=l,this.metaKey=u,this.shiftKey=c,this.keypress=n,this.hashKey=d,this.id=s++,e.__cache[d]=this}return e.prototype.matchesEvent=function(e){return e.which===this.which&&e.keyCode===this.keyCode&&e.charCode===this.charCode&&e.ctrlKey===this.ctrlKey&&e.altKey===this.altKey&&e.metaKey===this.metaKey&&(this.shiftKey===t.EITHER||e.shiftKey===this.shiftKey)&&(this.keypress?"keypress"===e.type:"keydown"===e.type||"keyup"===e.type)},e.prototype.setEventToMatch=function(e){var r=e;r.which=this.which,r.keyCode=this.keyCode,r.charCode=this.charCode,r.ctrlKey=this.ctrlKey,r.altKey=this.altKey,r.metaKey=this.metaKey,this.shiftKey!==t.EITHER&&(r.shiftKey=this.shiftKey),this.keypress?r.type="keypress":r.type="keydown"},e.prototype.hash=function(){return this.id},e.prototype.anyModifier=function(){return this.ctrlKey||this.altKey||this.metaKey},e.__cache=Object.create(null),e}();t.Key=u,t.NULL_KEY=new u(-1,!1,-1),t.makeKey=n,t.makeCtrlKey=o,t.makeMetaKey=i,t.makeCtrlEqKey=a}),define("wed/key-constants",["require","exports","./browsers","./key"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LEFT_ARROW=n.makeKey(37,!1),t.UP_ARROW=n.makeKey(38,!1),t.RIGHT_ARROW=n.makeKey(39,!1),t.DOWN_ARROW=n.makeKey(40,!1),t.BACKSPACE=n.makeKey(8,!1),t.DELETE=n.makeKey(46,!1),t.ENTER=n.makeKey(13,!1),t.SPACE=n.makeKey(32,!1),t.ESCAPE=n.makeKey(27,!1),t.SAVE=n.makeCtrlEqKey("S",!1),t.UNDO=n.makeCtrlEqKey("Z",!1),t.REDO=n.makeCtrlEqKey("Y",!1),t.COPY=n.makeCtrlEqKey("C",!1),t.CUT=n.makeCtrlEqKey("X",!1),t.PASTE=n.makeCtrlEqKey("V",!1),t.DEVELOPMENT=n.makeCtrlEqKey(192,!1),t.QUICKSEARCH_FORWARD=n.makeCtrlEqKey("F",!1),t.QUICKSEARCH_BACKWARDS=n.makeCtrlEqKey("B",!1),t.SEARCH_FORWARD=n.makeCtrlEqKey("F",!0),t.SEARCH_BACKWARDS=n.makeCtrlEqKey("B",!0),t.CONTEXTUAL_MENU=n.makeCtrlEqKey(191,!1),t.REPLACEMENT_MENU=n.makeCtrlEqKey(191,!0),t.LOWER_LABEL_VISIBILITY=r.OSX?n.NULL_KEY:n.makeCtrlKey(219,!1),t.INCREASE_LABEL_VISIBILITY=r.OSX?n.NULL_KEY:n.makeCtrlKey(221,!1)}),define("wed/gui/context-menu",["require","exports","jquery","../domutil","bootstrap"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,n,o,i,a){void 0===a&&(a=!0),this.dismissCallback=i,this.dismissed=!1;var s=this.dropdown=e.createElement("div");s.className="dropdown wed-context-menu",s.innerHTML="<a href='#' data-toggle='dropdown'></a><ul class='dropdown-menu' role='menu'></ul>",t-=5,n-=5,s.style.top=n+"px",s.style.left=t+"px",this.x=t,this.y=n;var l=this.menu=s.lastElementChild,u=this.$menu=r(l),c=this.toggle=s.firstElementChild,d=this.$toggle=r(c),h=this.backdrop=e.createElement("div");h.className="wed-context-menu-backdrop",r(h).click(this.backdropClickHandler.bind(this)),u.on("click",this.contentsClickHandler.bind(this)),d.on("click",this.contentsClickHandler.bind(this)),u.on("mousedown",function(e){e.stopPropagation()}),r(s).on("contextmenu mouseup",!1);var p=e.body;p.insertBefore(s,p.firstChild),p.insertBefore(h,p.firstChild),a&&this.display(o)}return e.prototype.display=function(e){var t=this.dropdown,o=r(t.firstElementChild);this.render(e);var i=this.$menu,a=this.menu,s=t.ownerDocument,l=this.x,u=this.y,c=i.outerWidth(),d=r(s.defaultView).width();t.style.left=Math.max(0,Math.min(l,d-c))+"px",a.style.maxWidth=d+"px";var h=5*Number(i.css("line-height").replace("px","")),p=r(s.defaultView).height(),f=p-u;f<h&&(u-=h-f,f=h),t.style.top=u+"px",a.style.maxHeight=f+"px",o.focus(this.handleToggleFocus.bind(this)),o.dropdown("toggle");var m=n.childByClass(t,"dropdown-backdrop");null!==m&&t.removeChild(m)},e.prototype.handleToggleFocus=function(){},e.prototype.contentsClickHandler=function(e){return this.dismiss(),e.stopPropagation(),e.preventDefault(),!1},e.prototype.backdropClickHandler=function(){return this.dismiss(),!1},e.prototype.render=function(e){this.$menu.append(e)},e.prototype.dismiss=function(){this.dismissed||(this.$menu.dropdown("toggle"),null!==this.dropdown.parentNode&&this.dropdown.parentNode.removeChild(this.dropdown),null!==this.backdrop.parentNode&&this.backdrop.parentNode.removeChild(this.backdrop),void 0!==this.dismissCallback&&this.dismissCallback(),this.dismissed=!0)},e}();t.ContextMenu=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui/action-context-menu",["require","exports","jquery","../browsers","../key","../key-constants","../transformation","./context-menu","./icon"],function(e,t,r,n,o,i,a,s,l){"use strict";function u(e,t){var r=null!==e.action&&e.action instanceof a.Transformation?e.action.kind:void 0,n=null!==t.action&&t.action instanceof a.Transformation?t.action.kind:void 0;if(r!==n){var o=h.indexOf(r),i=h.indexOf(n);return o-i}var s=e.item.textContent,l=t.item.textContent;return s===l?0:s<l?-1:1}Object.defineProperty(t,"__esModule",{value:!0});var c=["transform","add","delete","wrap","unwrap"],d=c.concat(void 0),h=[void 0].concat(c),p=["element","attribute"],f=p.concat(void 0),m="li:not(.divider):visible a",v=o.makeKey("+"),g=o.makeKey("-"),y=o.makeKey("."),b=o.makeKey(","),w=o.makeKey("?"),_=o.makeKey("<"),E=o.makeKey("@"),x=o.makeKey("!"),N=[{key:v,filter:"add",which:"kind"},{key:g,filter:"delete",which:"kind"},{key:b,filter:"wrap",which:"kind"},{key:y,filter:"unwrap",which:"kind"},{key:w,filter:void 0,which:"kind"},{key:_,filter:"element",which:"type"},{key:E,filter:"attribute",which:"type"},{key:x,filter:void 0,which:"type"}],C=function(e){function t(t,n,o,i,a){var s=e.call(this,t,n,o,[],a,!1)||this;s.filters={kind:null,type:null},s.actionTextFilter="",i.sort(u),s.actionItems=i;var l=t.createElement("li");l.className="wed-menu-filter",l.style.whiteSpace="nowrap";var c=t.createElement("div"),d=s.makeKindGroup(t),h=s.makeTypeGroup(t);r(l).on("click",!1),l.appendChild(c),c.appendChild(d),c.appendChild(t.createTextNode("")),c.appendChild(h);var p=t.createElement("input");p.className="form-control input-sm",p.setAttribute("placeholder","Filter choices by text.");var f=t.createElement("div");
f.appendChild(p),l.appendChild(f);var m=r(p);m.on("input",s.inputChangeHandler.bind(s)),m.on("keydown",s.inputKeydownHandler.bind(s)),s.actionFilterItem=l,s.actionFilterInput=p;var v=s.$menu;return v.parent().on("hidden.bs.dropdown",function(){r(p).tooltip("destroy"),r(d).children().tooltip("destroy")}),v.on("keydown",s.actionKeydownHandler.bind(s)),v.on("keypress",s.actionKeypressHandler.bind(s)),s.display([]),p.focus(),s}return __extends(t,e),t.prototype.makeKindGroup=function(e){var t=e.createElement("div");t.className="btn-group btn-group-xs";for(var n=0,o=d;n<o.length;n++){var i=o[n],a=e.createElement("button");a.className="btn btn-default";var s=void 0;void 0!==i?(a.innerHTML=l.makeHTML(i),s="Show only "+i+" operations."):(a.innerHTML=l.makeHTML("other"),s="Show operations not covered by other filter buttons."),r(a).tooltip({title:s,container:"body",placement:"auto top",trigger:"hover"}),r(a).on("click",this.makeKindHandler(i)),t.appendChild(a)}return t},t.prototype.makeTypeGroup=function(e){var t=e.createElement("div");t.className="btn-group btn-group-xs";for(var n=0,o=f;n<o.length;n++){var i=o[n],a=e.createElement("button");a.className="btn btn-default";var s=void 0;void 0!==i?(a.innerHTML=l.makeHTML(i),s="Show only "+i+" operations."):(a.innerHTML=l.makeHTML("other"),s="Show operations not covered by other filter buttons."),r(a).tooltip({title:s,container:"body",placement:"auto top",trigger:"hover"}),r(a).on("click",this.makeTypeHandler(i)),t.appendChild(a)}return t},t.prototype.makeKindHandler=function(e){var t=this;return function(){t.filters.kind=e,t.render()}},t.prototype.makeTypeHandler=function(e){var t=this;return function(){t.filters.type=e,t.render()}},t.prototype.handleToggleFocus=function(){this.actionFilterInput.focus()},t.prototype.actionKeydownHandler=function(e){var t=this;return!i.ESCAPE.matchesEvent(e)||null===this.filters.kind&&null===this.filters.type&&""===this.actionTextFilter||(this.filters.kind=null,this.filters.type=null,this.actionTextFilter="",n.FIREFOX_24?setTimeout(function(){t.actionFilterInput.value="",t.render()},0):(this.actionFilterInput.value="",this.render()),e.stopPropagation(),e.preventDefault(),!1)},t.prototype.actionKeypressHandler=function(e){if(""!==this.actionTextFilter)return!0;for(var t=0,r=N;t<r.length;t++){var n=r[t],o=n.key;if(o.matchesEvent(e)){var i=n.which;if(null!==this.filters[i])continue;return this.filters[i]=n.filter,this.render(),e.stopPropagation(),e.preventDefault(),!1}}return!0},t.prototype.inputChangeHandler=function(e){var t=this.actionTextFilter,r=e.target.value;t!==r&&(this.actionTextFilter=r,this.render())},t.prototype.inputKeydownHandler=function(e){if(i.ENTER.matchesEvent(e))return this.$menu.find(m).first().focus().click(),e.stopPropagation(),e.preventDefault(),!1;for(var t,n=0,o=["UP_ARROW","DOWN_ARROW","ESCAPE"];n<o.length;n++){var a=o[n],s=i[a];if(s.matchesEvent(e)){t=s;break}}if(void 0!==t){var l=new r.Event("keydown");return t.setEventToMatch(l),this.actionKeydownHandler(l)!==!1&&this.$toggle.trigger(l),!1}return!0},t.prototype.render=function(){for(var t=this.menu,r=this.actionFilterItem,n=this.filters.kind,o=this.filters.type;null!==t.lastChild&&t.lastChild!==r;)t.removeChild(t.lastChild);for(var i=r.firstElementChild.firstElementChild.firstElementChild,a=0,s=d;a<s.length;a++){var l=s[a],u=i.classList,c=n===l?u.add:u.remove;c.call(u,"active"),i=i.nextElementSibling}i=r.firstElementChild.lastElementChild.firstElementChild;for(var h=0,p=f;h<p.length;h++){var m=p[h],u=i.classList,c=o===m?u.add:u.remove;c.call(u,"active"),i=i.nextElementSibling}null===r.parentNode&&t.appendChild(r);var v=this.computeActionItemsToDisplay(this.actionItems);e.prototype.render.call(this,v)},t.prototype.computeActionItemsToDisplay=function(e){var t,r=this.filters.kind,n=this.filters.type,o=this.actionTextFilter;switch(r){case null:t=function(){return!0};break;case void 0:t=function(e){return!(e.action instanceof a.Transformation)||c.indexOf(e.action.kind)===-1};break;default:t=function(e){return e.action instanceof a.Transformation&&e.action.kind===r}}var i;switch(n){case null:i=function(){return!0};break;case void 0:i=function(e){return!(e.action instanceof a.Transformation)||p.indexOf(e.action.nodeType)===-1};break;default:i=function(e){return e.action instanceof a.Transformation&&e.action.nodeType===n}}var s;if(""!==o)if("^"===o[0]){var l=RegExp(o);s=function(e){var t=null!==e.data&&void 0!==e.data.name?e.data.name:e.item.textContent;return l.test(t)}}else s=function(e){var t=null!==e.data&&void 0!==e.data.name?e.data.name:e.item.textContent;return t.indexOf(o)!==-1};else s=function(){return!0};for(var u=[],d=0,h=e;d<h.length;d++){var f=h[d];t(f)&&i(f)&&s(f)&&u.push(f.item)}return u},t}(s.ContextMenu);t.ActionContextMenu=C});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui/completion-menu",["require","exports","jquery","../key-constants","./context-menu"],function(e,t,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r,n,o,i,a,s){var l=e.call(this,r,n,o,[],s,!1)||this;return l._focused=!1,l.completionPrefix=i,l.completionItems=a,l.editor=t,l.dropdown.classList.add("wed-completion-menu"),null!==l.dropdown.firstElementChild.getAttribute("data-toggle")&&l.dropdown.removeChild(l.dropdown.firstChild),l.backdrop.parentNode.removeChild(l.backdrop),l.boundCompletionKeydownHandler=l.globalKeydownHandler.bind(l),t.pushGlobalKeydownHandler(l.boundCompletionKeydownHandler),t.caretManager.focusInputField(),l.display([]),l}return __extends(t,e),Object.defineProperty(t.prototype,"focused",{get:function(){return this._focused},enumerable:!0,configurable:!0}),t.prototype.globalKeydownHandler=function(e,t){return n.ENTER.matchesEvent(t)?(this.$menu.find("li:not(.divider):visible a").first().click(),!1):n.DOWN_ARROW.matchesEvent(t)?(this._focused=!0,this.$menu.find("li:not(.divider):visible a").first().focus(),this.$menu.trigger(t),!1):!n.ESCAPE.matchesEvent(t)||(this.dismiss(),!1)},t.prototype.render=function(){function t(e){n.type(e.data)}for(var n=this.editor,o=[],i=this.completionPrefix,a=n.doc,s=0,l=this.completionItems;s<l.length;s++){var u=l[s];if(""===i){var c=a.createElement("li");c.innerHTML="<a href='#'></a>",c.lastChild.textContent=u,o.push(c),r(c).click(u,t)}else if(0===u.lastIndexOf(i,0)){var c=a.createElement("li");c.innerHTML="<a href='#'><b></b></a>";var d=c.lastChild;d.firstChild.textContent=u.slice(0,i.length);var h=u.slice(i.length);d.appendChild(a.createTextNode(h)),o.push(c),r(c).click(h,t)}}0===o.length&&this.dismiss(),1===o.length&&this.completionItems[0]===i&&this.dismiss(),e.prototype.render.call(this,o)},t.prototype.dismiss=function(){this.dismissed||(this.editor.popGlobalKeydownHandler(this.boundCompletionKeydownHandler),e.prototype.dismiss.call(this))},t}(o.ContextMenu);t.CompletionMenu=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui/replacement-menu",["require","exports","jquery","./context-menu"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n,o,i,a){var s=e.call(this,r,n,o,[],function(){a(s.selected)},!1)||this;return s.replacementItems=i,s.editor=t,s.dropdown.classList.add("wed-replacement-menu"),s.display([]),s}return __extends(t,e),t.prototype.render=function(){for(var t=this,n=[],o=this.editor.doc,i=function(e){var i=o.createElement("li");i.innerHTML="<a href='#'></a>",i.lastChild.textContent=e,n.push(i),r(i).click(e,function(){t.selected=e,t.dismiss()})},a=0,s=this.replacementItems;a<s.length;a++){var l=s[a];i(l)}e.prototype.render.call(this,n)},t.prototype.dismiss=function(){this.dismissed||e.prototype.dismiss.call(this)},t}(n.ContextMenu);t.ReplacementMenu=o}),define("wed/gui/typeahead-popup",["require","exports","jquery","../domutil","../key-constants","bootstrap","typeahead"],function(e,t,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,o,i,a,s,l){var u=this;this.dismissed=!1;var c=n.htmlToElements('<div class="wed-typeahead-popup"><input class="typeahead form-control" type="text"><span class="spinner"><i class="fa fa-spinner fa-spin"></i></span></div>',e)[0],d=c.firstElementChild;d.setAttribute("placeholder",a),this.taWrapper=c,this.dismissCallback=l,this.backdrop=document.createElement("div"),this.backdrop.className="wed-typeahead-popup-backdrop",r(this.backdrop).click(function(){return u.dismiss(),!1}),c.style.width=i+"px",c.style.left=t+"px",c.style.top=o+"px";var h=this.$ta=r(d);this.ta=d;var p=[s.options];null!=s.datasets&&s.datasets.length>0&&(p=p.concat(s.datasets)),h.typeahead.apply(h,p),h.on("keydown",this._keydownHandler.bind(this)),h.on("typeahead:selected",this._selectedHandler.bind(this));var f=e.body;f.insertBefore(c,f.firstChild),f.insertBefore(this.backdrop,f.firstChild);var m=c.offsetWidth,v=e.defaultView.innerWidth;c.style.left=Math.max(0,Math.min(t,v-m))+"px",c.style.maxWidth=v+"px";var g=e.defaultView.innerHeight,y=g-o;c.style.maxHeight=y+"px";var b=c.getElementsByClassName("tt-menu")[0],w=r(b),_=b.style.display;b.style.display="block";var E=5*Number(w.css("line-height").replace("px","")),x=b.getBoundingClientRect(),N=g-x.top;N<E&&(o-=E-N,N=E,c.style.top=o+"px"),b.style.maxHeight=N+"px",b.style.display=_,w.off("mouseenter.tt",".tt-suggestion"),w.off("mouseleave.tt",".tt-suggestion"),w.on("click",!1),d.focus();var C=r.data(d,"ttTypeahead");C.isActivated=!0,C.input.off("blurred"),C._onBlurred=function(){this.isActivated=!1},C.input.onSync("blurred",C._onBlurred,C)}return e.prototype.dismiss=function(e){if(!this.dismissed){var t=this.taWrapper;void 0!==t&&null!==t.parentNode&&t.parentNode.removeChild(t);var r=this.backdrop;void 0!==r&&null!==r.parentNode&&r.parentNode.removeChild(r),void 0!==this.dismissCallback&&this.dismissCallback(e),this.dismissed=!0}},e.prototype._keydownHandler=function(e){if(o.ESCAPE.matchesEvent(e))return this.dismiss(),!1},e.prototype._selectedHandler=function(e,t){this.dismiss(t)},e.prototype.hideSpinner=function(){this.taWrapper.getElementsByClassName("spinner")[0].style.display="none"},e.prototype.setValue=function(e){this.$ta.typeahead("val",e)},e}();t.TypeaheadPopup=i}),define("wed/gui/editing-menu-manager",["require","exports","../dloc","../domtypeguards","../domutil","../transformation","./action-context-menu","./completion-menu","./icon","./replacement-menu","./typeahead-popup"],function(e,t,r,n,o,i,a,s,l,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d={undefined:"",true:" before this element",false:" after this element"},h=function(){function e(e){this.editor=e,this.caretManager=e.caretManager,this.modeTree=e.modeTree,this.guiRoot=e.guiRoot,this.dataRoot=e.dataRoot,this.doc=this.guiRoot.ownerDocument}return e.prototype.contextMenuHandler=function(e){var t=this.caretManager.sel;if(void 0===t||!t.collapsed&&!t.wellFormed)return!1;var r=t.focus.node,i=t.focus.offset;if(!n.isElement(r)){var s=r.parentNode;if(null===s)throw new Error("contextMenuHandler invoked on detached node");i=o.indexOf(s.childNodes,r),r=s}var l=o.closestByClass(r,"_placeholder",this.guiRoot);if(null!==l){var u=l.parentNode;if(null===u)throw new Error("contextMenuHandler invoked on detached node");i=o.indexOf(u.childNodes,l),r=u}var c=o.closestByClass(r,"_real",this.guiRoot),d=null!==c&&c.classList.contains("_readonly"),h=null!==o.closestByClass(r,"_attribute_value",this.guiRoot)?this.getMenuItemsForAttribute:this.getMenuItemsForElement,p=h.call(this,r,i,!t.collapsed);return 0===p.length||(this.setupContextMenu(a.ActionContextMenu,p,d,e),!1)},e.prototype.dismiss=function(){void 0!==this.currentDropdown&&this.currentDropdown.dismiss(),void 0!==this.currentTypeahead&&this.currentTypeahead.dismiss()},e.prototype.setupContextMenu=function(e,t,r,n,o){var i=this.computeMenuPosition(n,o);this.displayContextMenu(a.ActionContextMenu,i.left,i.top,t,r)},e.prototype.displayContextMenu=function(e,t,r,n,o){var a=this,s=Object.create(null);n=n.filter(function(e){var t=(null!==e.action?e.action.getDescription():"")+"\0";null!==e.data&&(t+=e.data.name);var r=!s[t];return s[t]=!0,r&&o?!(e.action instanceof i.Transformation):r}),this.dismiss(),this.caretManager.pushSelection(),this.currentDropdown=new e(this.doc,t,r,n,function(){a.currentDropdown=void 0,a.caretManager.popSelection()})},e.prototype.getMenuItemsForAttribute=function(){return[]},e.prototype.getMenuItemsForElement=function(e,t,n){for(var o,i=this,a=e;null!==a&&a.classList.contains("_phantom");)o=a,a=a.parentNode;if(null===a||!this.guiRoot.contains(a))return[];void 0!==o&&(t=this.caretManager.normalizeToEditableRange(r.DLoc.mustMakeDLoc(this.guiRoot,o)).offset);var s=[],l=function(e,t){var r=i.makeMenuItemForAction(t,e);s.push({action:t,item:r,data:e})};if(!a.parentNode.classList.contains("_gui")){var u=this.caretManager.toDataLocation(a,t);if(void 0===u)throw new Error("cannot find tree caret");var c=u.node,d=c.tagName,h=this.modeTree.getMode(c);s.push.apply(s,this.makeCommonItems(c));for(var p=this.editor.getElementTransformationsAt(u,n?"wrap":"insert"),f=0,m=p;f<m.length;f++){var v=m[f];l(void 0!==v.name?{name:v.name}:null,v.tr)}if(c!==this.dataRoot.firstChild&&c!==this.dataRoot)for(var g=h.getContextualActions(["unwrap","delete-parent","split"],d,c,0),y=0,b=g;y<b.length;y++){var w=b[y];l({node:c,name:d},w)}}var _=$(a).parents().addBack().siblings("[data-wed--separator-for]").first(),E=void 0!==_[0]?_[0].getAttribute("data-wed--separator-for"):null;if(null!==E)for(var x=_.siblings().filter(function(){return this.contains(a)})[0],h=this.modeTree.getMode(x),g=h.getContextualActions(["merge-with-next","merge-with-previous","append","prepend"],E,$.data(x,"wed_mirror_node"),0),N=0,C=g;N<C.length;N++){var w=C[N];l({node:x,name:E},w)}return s},e.prototype.makeCommonItems=function(e){var t=[];if(n.isElement(e)){var r=e.tagName,o=this.modeTree.getMode(e),i=o.documentationLinkFor(r);if(null!=i){var a=this.makeDocumentationMenuItem(i);t.push({action:null,item:a,data:null})}}return t},e.prototype.makeMenuItemForAction=function(e,t,r){var n=e.getIcon(),a=o.htmlToElements("<li><a tabindex='0' href='#'>"+(void 0!==n?n+" ":"")+"</a></li>",this.doc)[0];e instanceof i.Transformation&&void 0!==e.kind&&a.setAttribute("data-kind",e.kind);var s=a.firstElementChild,l=this.doc.createTextNode(e.getDescriptionFor(t)+d[String(r)]);return s.appendChild(l),s.normalize(),$(s).click(t,e.boundTerminalHandler),a},e.prototype.makeDocumentationMenuItem=function(e){var t=this,r=l.makeHTML("documentation"),n=o.htmlToElements("<li><a tabindex='0' href='#'>"+r+" Element's documentation.</a></li>",this.doc)[0],i=n.firstElementChild;return $(i).click(function(){t.editor.openDocumentationLink(e)}),n},e.prototype.getPossibleAttributeValues=function(){var e=this.caretManager.sel;if(void 0===e||!e.collapsed)return[];var t=this.caretManager.getNormalizedCaret(),r=t.node,n=o.closestByClass(r,"_attribute_value",this.guiRoot);if(null===n||o.isNotDisplayed(n,this.guiRoot))return[];var i=this.caretManager.getDataCaret(),a=i.node,s=this.modeTree.getMode(a),l=s.getAttributeCompletions(a);return 0===l.length&&this.editor.validator.possibleAt(i.node,0).forEach(function(e){if("attributeValue"===e.params[0]){var t=e.params[1];t instanceof RegExp||l.push(t)}}),l},e.prototype.setupCompletionMenu=function(){var e=this;this.dismiss();var t=this.getPossibleAttributeValues();if(0!==t.length){var r=this.caretManager.getDataCaret();if(void 0!==r){var n=r.node;if(r.offset===n.value.length){for(var o=[],i=0,a=t;i<a.length;i++){var l=a[i];0===l.lastIndexOf(n.value,0)&&o.push(l)}if(0!==o.length&&(1!==o.length||o[0]!==n.value)){var u=this.computeMenuPosition(void 0,!0);this.caretManager.pushSelection();var c=this.currentDropdown=new s.CompletionMenu(this.editor,this.guiRoot.ownerDocument,u.left,u.top,n.value,t,function(){e.currentDropdown=void 0,c.focused?e.caretManager.popSelection():e.caretManager.popSelectionAndDiscard()})}}}}},e.prototype.setupReplacementMenu=function(){var e=this;this.dismiss();var t=this.getPossibleAttributeValues();if(0!==t.length){var r=this.caretManager.getDataCaret();if(void 0!==r){var n=this.computeMenuPosition(void 0,!0);this.caretManager.pushSelection(),this.currentDropdown=new u.ReplacementMenu(this.editor,this.guiRoot.ownerDocument,n.left,n.top,t,function(t){if(e.currentDropdown=void 0,e.caretManager.popSelection(),void 0!==t){var n=r.node,o=null!==n.namespaceURI?n.namespaceURI:"";e.editor.dataUpdater.setAttributeNS(n.ownerElement,o,n.name,t)}})}}},e.prototype.setupTypeaheadPopup=function(e,t,r,n,o,i){var a=this.computeMenuPosition(o,i);return this.displayTypeaheadPopup(a.left,a.top,e,t,r,n)},e.prototype.displayTypeaheadPopup=function(e,t,r,n,o,i){var a=this;return this.dismiss(),this.caretManager.pushSelection(),this.currentTypeahead=new c.TypeaheadPopup(this.doc,e,t,r,n,o,function(e){a.currentTypeahead=void 0,a.caretManager.popSelection(),void 0!==i&&i(e)}),this.currentTypeahead},e.prototype.computeMenuPosition=function(e,t){if(void 0===t&&(t=!1),void 0===e&&(e={}),"mousedown"===e.type||"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type)return{left:e.clientX,top:e.clientY};var r=this.caretManager.mark;if(r.inDOM){r.scrollIntoView(),r.refresh();var n=r.getBoundingClientRect();return{top:t?n.bottom:n.top+n.height/2,left:n.left}}var i=o.closestByClass(this.caretManager.caret.node,"_gui",this.guiRoot);if(null!==i){var n=i.getBoundingClientRect();return{top:t?n.bottom:n.top+n.height/2,left:n.left+n.width/2}}throw new Error("no position for displaying the menu")},e}();t.EditingMenuManager=h}),define("wed/gui/layer",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.el=e}return e.prototype.clear=function(){for(var e=this.el;null!==e.lastChild;)e.removeChild(e.lastChild)},e.prototype.append=function(e){this.el.appendChild(e)},e}();t.Layer=r});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui/error-layer",["require","exports","./layer"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(t){var r=e.call(this,t)||this;return r.el=t,r}return __extends(t,e),t.prototype.select=function(e){if(e.parentNode!==this.el)throw new Error("marker is not a child of the layer element");this.unselectAll(),e.classList.add("selected")},t.prototype.unselectAll=function(){for(var e=this.el.firstElementChild;null!==e;)e.classList.remove("selected"),e=e.nextElementSibling},t}(r.Layer);t.ErrorLayer=n}),define("wed/gui/minibuffer",["require","exports","jquery","rxjs/Subject","../key-constants"],function(e,t,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._enabled=!1,this._events=new n.Subject,this.events=this._events.asObservable(),this.$top=r(e),this.$top.append("<label></label>&nbsp;<input type='text'>"),this.promptEl=e.getElementsByTagName("label")[0],this.input=e.getElementsByTagName("input")[0];var t=this.$input=r(this.input);t.on("input",this.onInput.bind(this)),t.on("keypress",this.onKeypress.bind(this)),t.on("keydown",this.onKeydown.bind(this)),this.disable()}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),e.prototype.enable=function(){this._enabled=!0,this.input.disabled=!1,this.input.style.display="",this.input.focus()},e.prototype.disable=function(){this._enabled=!1,this.input.disabled=!0,this.input.value="",this.input.style.display="none"},e.prototype.installClient=function(e){this.client=e,this.keydownHandler=e.onMinibufferKeydown.bind(e),this.clientSubscription=this.events.subscribe(e.onMinibufferChange.bind(e)),this.enable()},e.prototype.uninstallClient=function(){var e=this.client;void 0!==e&&(this.client=void 0,this.keydownHandler=void 0,this.clientSubscription.unsubscribe(),this.disable(),this.prompt="",this.previous=void 0,e.onUninstall())},Object.defineProperty(e.prototype,"prompt",{get:function(){return this.promptEl.textContent},set:function(e){this.promptEl.textContent=e},enumerable:!0,configurable:!0}),e.prototype.forwardEvent=function(e){"keypress"===e.type&&(this.input.value+=String.fromCharCode(e.which)),this.$input.trigger(e)},e.prototype.onKeydown=function(e){return o.ESCAPE.matchesEvent(e)?(this.uninstallClient(),!1):(null==this.keydownHandler||this.keydownHandler(e)!==!1)&&void 0},e.prototype.onKeypress=function(e){var t=this.input.value;t!==this.previous&&(this.previous=t,this._events.next({name:"ChangeEvent",value:t}))},e.prototype.onInput=function(e){var t=this.input.value;t!==this.previous&&(this.previous=t,this._events.next({name:"ChangeEvent",value:t}))},e}();t.Minibuffer=i}),define("wed/gui/modal",["require","exports","jquery","./interactivity","bootstrap"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){var t=this;e=null!=e?e:{};var o=this._$dom=r('<div class="modal" style="position: absolute" tabindex="1">  <div class="modal-dialog">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal"          aria-hidden="true">&times;</button>        <h3 class="modal-title">Untitled</h3>      </div>      <div class="modal-body">        <p>No body.</p>      </div>      <div class="modal-footer">      </div>    </div>  </div></div>');this._$header=o.find(".modal-header"),this._$body=o.find(".modal-body"),this._$footer=o.find(".modal-footer"),o.on("click",".btn",function(e){return t._$clicked=r(e.currentTarget),!0}),o.on("shown.bs.modal.modal",this._handleShown.bind(this)),e.resizable&&(this._$body[0].style.overflow="auto",n.makeResizable(o)),e.draggable&&n.makeDraggable(o)}return e.prototype.getTopLevel=function(){return this._$dom},e.prototype.setTitle=function(e){var t=this._$header.find("h3");t.empty(),t.append(e)},e.prototype.setBody=function(e){this._$body.empty(),this._$body.append(e)},e.prototype.setFooter=function(e){this._$footer.empty(),this._$footer.append(e)},e.prototype.addButton=function(e,t){void 0===t&&(t=!1);var n=this._$dom[0].ownerDocument.createElement("a");return n.href="#",n.className="btn",n.setAttribute("data-dismiss","modal"),n.textContent=e,n.classList.add(t?"btn-primary":"btn-default"),this._$footer.append(n),r(n)},e.prototype.addOkCancel=function(){return[this.addButton("Ok",!0),this.addButton("Cancel")]},e.prototype.addYesNo=function(){return[this.addButton("Yes",!0),this.addButton("No")]},e.prototype.getPrimary=function(){return this._$footer.find(".btn-primary")},e.prototype.modal=function(e){this._$clicked=void 0,void 0!==e&&this._$dom.one("hidden.bs.modal.modal",e),this._$dom.modal()},e.prototype.getClicked=function(){return this._$clicked},e.prototype.getClickedAsText=function(){if(void 0!==this._$clicked)return this._$clicked.text()},e.prototype._handleShown=function(){var e=this._$dom[0].ownerDocument.defaultView,t=e.innerHeight,r=this._$dom.find(".modal-dialog")[0],n=r.getBoundingClientRect(),o=window.getComputedStyle(r),i=-n.top+(t-n.height)-parseInt(o.marginBottom),a=n.height+i;r.style.maxHeight=a+"px";var s=this._$dom.find(".modal-content")[0];s.style.maxHeight=a+"px"},e}();t.Modal=o}),define("is-plain-obj",["require","exports","module"],function(e,t,r){var n=Object.prototype.toString;return r.exports=function(e){var t;return"[object Object]"===n.call(e)&&(t=Object.getPrototypeOf(e),null===t||t===Object.getPrototypeOf({}))},r.exports}),define("merge-options",["require","exports","module","is-plain-obj"],function(e,t,r){function n(e){var t=[];for(var r in e)d.call(e,r)&&t.push(r);if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(e),o=0;o<n.length;o++)h.call(e,n[o])&&t.push(n[o]);return t}function o(e){return Array.isArray(e)?i(e):c(e)?a(e):e}function i(e){var t=e.slice(0,0);return n(e).forEach(function(r){t[r]=o(e[r])}),t}function a(e){var t=null===Object.getPrototypeOf(e)?Object.create(null):{};return n(e).forEach(function(r){t[r]=o(e[r])}),t}function s(e,t,r,n){return r.forEach(function(r){r in e?e[r]=u(e[r],t[r],n):e[r]=o(t[r])}),e}function l(e,t,r){var i=e.slice(0,0),a=0;return[e,t].forEach(function(t){for(var l=[],u=0;u<t.length;u++)d.call(t,u)&&(l.push(String(u)),t===e?i[a++]=t[u]:i[a++]=o(t[u]));i=s(i,t,n(t).filter(function(e){return l.indexOf(e)===-1}),r)}),i}function u(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?l(e,t,r):c(t)&&c(e)?s(e,t,n(t),r):o(t)}var c=e("is-plain-obj"),d=Object.prototype.hasOwnProperty,h=Object.propertyIsEnumerable,p=this,f={concatArrays:!1};return r.exports=function(){for(var e=u(o(f),this!==p&&this||{},f),t={},r=0;r<arguments.length;r++){var n=arguments[r];if(void 0!==n){if(!c(n))throw new TypeError("`"+n+"` is not an Option Object");t=u(t,n,e)}}return t},r.exports}),define("wed/gui/notify",["require","exports","jquery","merge-options","bootstrap-notify"],function(e,t,r,n){"use strict";function o(e,t){var o=void 0===t?i:n(i,t);r.notify({message:e},o)}Object.defineProperty(t,"__esModule",{value:!0});var i={element:"body",type:"info",placement:{from:"top",align:"center"},delay:1e3};t.notify=o}),define("wed/gui/quick-search",["require","exports","../key-constants","./search-replace"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Direction=n.Direction;var o=function(){function e(e,t,r){this.editor=e,this.direction=r,this.search=new n.SearchReplace(e,t),e.minibuffer.installClient(this),this.updatePrompt()}return e.prototype.updatePrompt=function(){this.editor.minibuffer.prompt=(e={},e[n.Direction.FORWARD]="Search forward:",e[n.Direction.BACKWARDS]="Search backwards:",e)[this.direction];var e},e.prototype.onMinibufferKeydown=function(e){return r.QUICKSEARCH_FORWARD.matchesEvent(e)?(this.direction=n.Direction.FORWARD,this.next(),!1):r.QUICKSEARCH_BACKWARDS.matchesEvent(e)?(this.direction=n.Direction.BACKWARDS,this.next(),!1):void 0},e.prototype.getSearchOptions=function(){return{direction:this.direction,context:n.Context.TEXT}},e.prototype.next=function(){this.updatePrompt(),this.search.next(this.getSearchOptions())},e.prototype.onMinibufferChange=function(e){this.search.updatePattern(e.value,this.getSearchOptions())},e.prototype.onUninstall=function(){this.search.clearHighlight(),this.search.setCaretToMatch()},e}();t.QuickSearch=o}),define("wed/gui/scroller",["require","exports","jquery","rxjs/Subject","../domutil"],function(e,t,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){var t=this;this.el=e,this._events=new n.Subject,this.events=this._events.asObservable(),r(e).on("scroll",function(){t._events.next({scroller:t})})}return Object.defineProperty(e.prototype,"scrollTop",{get:function(){return this.el.scrollTop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollLeft",{get:function(){return this.el.scrollLeft},enumerable:!0,configurable:!0}),e.prototype.getBoundingClientRect=function(){return this.el.getBoundingClientRect()},e.prototype.coerceHeight=function(e){this.el.style.height=e+"px"},e.prototype.isPointInside=function(e,t){return o.pointInContents(this.el,e,t)},e.prototype.scrollIntoView=function(e,t,r,n){var o=this.el,i=o.scrollTop,a=o.clientHeight,s=i+a;(t<i||n>s)&&(i=t<i?t:n-a,o.scrollTop=i);var l=o.scrollLeft,u=o.clientWidth,c=l+u;(e<l||r>c)&&(l=e<l?e:r-u,o.scrollLeft=l);var d=o.getBoundingClientRect();e=e-l+d.left,r=r-l+d.left,t=t-i+d.top,n=n-i+d.top;var h=o.ownerDocument,p=h.body.scrollHeight,f=h.body.scrollWidth,m=0;(t<0||n>p)&&(m=t<0?t:n);var v=0;(e<0||r>f)&&(v=e<0?e:r),h.defaultView.scrollBy(v,m)},e}();t.Scroller=i}),define("wed/gui/toolbar",["require","exports","./button"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){var e=this.top=document.createElement("div");this.top.className="wed-toolbar",this.divider=document.createElement("span"),this.divider.className="wed-toolbar-divider",this.modeSpan=document.createElement("span"),e.appendChild(this.divider),e.appendChild(this.modeSpan)}return e.prototype.addButton=function(e,t){void 0===t&&(t={}),e instanceof r.Button&&(e=[e]);var n=t.prepend===!0,o=t.right===!0;if(n&&o)throw new Error("cannot use prepend and right at the same time.");for(var i=this.top,a=i.ownerDocument.createDocumentFragment(),s=0,l=e;s<l.length;s++){var u=l[s];if(o){var c=i.ownerDocument.createElement("span");c.className=o?"pull-right":"",u.render(c),a.appendChild(c)}else u.render(a)}o?i.appendChild(a):i.insertBefore(a,n?i.firstChild:this.divider)},e.prototype.setModeButtons=function(e){this.modeSpan.innerHTML="";for(var t=0,r=e;t<r.length;t++){var n=r[t];n.render(this.modeSpan)}},e}();t.Toolbar=n}),define("wed/gui/tooltip",["require","exports","jquery","bootstrap"],function(e,t,r){"use strict";function n(e){var t=e.target,n=r.data(t,"bs.tooltip");r.data(n.tip()[0],"wed-tooltip-for",t)}function o(e,t){e.tooltip(t),e[0].classList.add("wed-has-tooltip"),e.on("show.bs.tooltip",n)}Object.defineProperty(t,"__esModule",{value:!0}),t.tooltip=o}),define("wed/log",["require","exports","log4javascript"],function(e,t,r){"use strict";function n(){d.show()}function o(e){return e instanceof h?e:(c.fatal("Unhandled exception",e),"undefined"!=typeof console&&(console.log(e),console.log(e.stack)),new h(e))}function i(e){throw o(e)}function a(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return e.apply(this,arguments)}catch(e){i(e)}}}function s(e,t){var n=new r.AjaxAppender(e);n.setThreshold(r.Level.ALL);var o=new r.XmlLayout;return n.setLayout(o),void 0!==t&&Object.keys(t).forEach(function(e){n.addHeader(e,t[e])}),u.addAppender(n),c.info("Ajax appender initialized"),n}function l(e){e.sendAll(),u.removeAppender(e)}Object.defineProperty(t,"__esModule",{value:!0}),r.setShowStackTraces(!0);var u=r.getLogger("wed");u.setLevel(r.Level.ALL);var c=r.getLogger("wed.common");c.setLevel(r.Level.ALL);var d=new r.PopUpAppender(!0);d.setThreshold(r.Level.ERROR),d.setInitiallyMinimized(!0),d.setNewestMessageAtTop(!0),c.addAppender(d),t.trace=c.trace.bind(c),t.debug=c.debug.bind(c),t.info=c.info.bind(c),t.warn=c.warn.bind(c),t.error=c.error.bind(c),t.fatal=c.fatal.bind(c),t.showPopup=n;var h=function(){function e(e){this.original=e}return e}();t.Handled=h,t.unhandled=o,t.handle=i,t.wrap=a,t.addURL=s,t.removeAppender=l});var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,s)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,i&&(a=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,i=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,
!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],i=0}finally{o=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,i,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};define("wed/mode-loader",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.editor=e,this.runtime=t}return e.prototype.initMode=function(e,t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(o){switch(o.label){case 0:return[4,this.loadMode(e)];case 1:return r=o.sent(),n=new r.Mode(this.editor,t),[4,n.init()];case 2:return o.sent(),[2,n]}})})},e.prototype.loadMode=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,o;return __generator(this,function(i){switch(i.label){case 0:t=this.runtime,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t.resolveModules(e)];case 2:return[2,i.sent()[0]];case 3:return r=i.sent(),[3,4];case 4:if(e.indexOf("/")!==-1)throw new Error("can't load mode "+e);e="wed/modes/"+e+"/"+e,i.label=5;case 5:return i.trys.push([5,7,,8]),[4,t.resolveModules(e)];case 6:return[2,i.sent()[0]];case 7:return n=i.sent(),[3,8];case 8:return i.trys.push([8,10,,11]),[4,t.resolveModules(e+"-mode")];case 9:return[2,i.sent()[0]];case 10:return o=i.sent(),[3,11];case 11:return[4,t.resolveModules(e+"_mode")];case 12:return[2,i.sent()[0]]}})})},e}();t.ModeLoader=r}),define("text",["module"],function(e){"use strict";var t,r,n,o,i,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,u="undefined"!=typeof location&&location.href,c=u&&location.protocol&&location.protocol.replace(/\:/,""),d=u&&location.hostname,h=u&&(location.port||void 0),p={},f=e.config&&e.config()||{};return t={version:"2.0.12",strip:function(e){if(e){e=e.replace(s,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,t,r;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){r=a[t];try{e=new ActiveXObject(r)}catch(e){}if(e){a=[r];break}}return e},parseName:function(e){var t,r,n,o=!1,i=e.indexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return i!==-1&&(!a||i>1)?(t=e.substring(0,i),r=e.substring(i+1,e.length)):t=e,n=r||t,i=n.indexOf("!"),i!==-1&&(o="strip"===n.substring(i+1),n=n.substring(0,i),r?r=n:t=n),{moduleName:t,ext:r,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,r,n,o){var i,a,s,l=t.xdRegExp.exec(e);return!l||(i=l[2],a=l[3],a=a.split(":"),s=a[1],a=a[0],!(i&&i!==r||a&&a.toLowerCase()!==n.toLowerCase()||(s||a)&&s!==o))},finishLoad:function(e,r,n,o){n=r?t.strip(n):n,f.isBuild&&(p[e]=n),o(n)},load:function(e,r,n,o){if(o&&o.isBuild&&!o.inlineText)return void n();f.isBuild=o&&o.isBuild;var i=t.parseName(e),a=i.moduleName+(i.ext?"."+i.ext:""),s=r.toUrl(a),l=f.useXhr||t.useXhr;return 0===s.indexOf("empty:")?void n():void(!u||l(s,c,d,h)?t.get(s,function(r){t.finishLoad(e,i.strip,r,n)},function(e){n.error&&n.error(e)}):r([a],function(e){t.finishLoad(i.moduleName+"."+i.ext,i.strip,e,n)}))},write:function(e,r,n,o){if(p.hasOwnProperty(r)){var i=t.jsEscape(p[r]);n.asModule(e+"!"+r,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,r,n,o,i){var a=t.parseName(r),s=a.ext?"."+a.ext:"",l=a.moduleName+s,u=n.toUrl(a.moduleName+s)+".js";t.load(l,n,function(r){var n=function(e){return o(u,e)};n.asModule=function(e,t){return o.asModule(e,u,t)},t.write(e,l,n,i)},i)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(r=require.nodeRequire("fs"),t.get=function(e,t,n){try{var o=r.readFileSync(e,"utf8");0===o.indexOf("\ufeff")&&(o=o.substring(1)),t(o)}catch(e){n&&n(e)}}):"xhr"===f.env||!f.env&&t.createXhr()?t.get=function(e,r,n,o){var i,a=t.createXhr();if(a.open("GET",e,!0),o)for(i in o)o.hasOwnProperty(i)&&a.setRequestHeader(i.toLowerCase(),o[i]);f.onXhr&&f.onXhr(a,e),a.onreadystatechange=function(t){var o,i;4===a.readyState&&(o=a.status||0,o>399&&o<600?(i=new Error(e+" HTTP status: "+o),i.xhr=a,n&&n(i)):r(a.responseText),f.onXhrComplete&&f.onXhrComplete(a,e))},a.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var r,n,o="utf-8",i=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(i),o)),l="";try{for(r=new java.lang.StringBuffer,n=s.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&r.append(n);null!==(n=s.readLine());)r.append(a),r.append(n);l=String(r.toString())}finally{s.close()}t(l)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,o=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),i="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var r,a,s,l={};i&&(e=e.replace(/\//g,"\\")),s=new FileUtils.File(e);try{r=n["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),r.init(s,1,0,!1),a=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),a.init(r,"utf-8",r.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(r.available(),l),a.close(),r.close(),t(l.value)}catch(e){throw new Error((s&&s.path||"")+": "+e)}}),t}),define("json",["text"],function(e){"use strict";return{load:function(t,r,n,o){return o&&o.isBuild?void n():void e.get(r.toUrl(t),function(e){n(JSON.parse(e))},n.error)}}}),define("wed/wed-options-validation",["require","exports","ajv","./wed-options-schema.json"],function(e,t,r,n){"use strict";function o(){return void 0===a&&(a=(new r).compile(n)),a}function i(e){var t=[],r=o(),n=r(e);if(!n){if(void 0!==r.errors)for(var i=0,a=r.errors;i<a.length;i++){var s=a[i];t.push(s.dataPath+" "+s.message)}return t}var l=e.label_levels.max,u=e.label_levels.initial;if(u>l&&t.push("label_levels.initial must be <= label_levels.max"),void 0===e.attributes&&(e.attributes="hide"),"string"==typeof e.attributes){var c=e.attributes;e.attributes={handling:c}}return 0!==t.length?t:e}Object.defineProperty(t,"__esModule",{value:!0});var a;t.processWedOptions=i});var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,s)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,i&&(a=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,i=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],i=0}finally{o=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,i,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};define("wed/mode-tree",["require","exports","merge-options","./domutil","./mode-loader","./wed-options-validation"],function(e,t,r,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,r,n,o){this.mode=e,this.editor=t,this.selector=r,this.submodes=n,this.wedOptions=o}return e.prototype.containingElement=function(e,t){if(!e.contains(t))return null;if(""===this.selector)return e;for(var r=e.querySelectorAll(this.selector),n=0,o=Array.from(r);n<o.length;n++){var i=o[n];if(i.contains(t))return i}return null},e.prototype.reduceTopFirst=function(e,t){for(var r=e(t,this),n=0,o=this.submodes;n<o.length;n++){var i=o[n];r=i.reduceTopFirst(e,r)}return r},e.prototype.eachTopFirst=function(e){e(this);for(var t=0,r=this.submodes;t<r.length;t++){var n=r[t];n.eachTopFirst(e)}},Object.defineProperty(e.prototype,"attributeHidingSpecs",{get:function(){if(void 0===this._attributeHidingSpecs){var e=this.wedOptions.attributes.autohide;if(void 0===e)this._attributeHidingSpecs=null;else{var t=e.method;if("selector"!==t)throw new Error("unknown attribute hiding method: "+t);for(var o={elements:[]},i=0,a=e.elements;i<a.length;i++){var s=a[i],l=r({},s);l.selector=n.toGUISelector(l.selector,this.mode.getAbsoluteNamespaceMappings()),o.elements.push(l)}this._attributeHidingSpecs=o}}return this._attributeHidingSpecs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"decorator",{get:function(){return void 0===this._decorator&&(this._decorator=this.mode.makeDecorator()),this._decorator},enumerable:!0,configurable:!0}),e}(),s=function(){function e(e,t){this.editor=e,this.option=t,this.loader=new o.ModeLoader(e,e.runtime)}return e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return e=[],t=this,[4,this.makeNodes("",this.option,function(t,r){for(var n=0,o=r;n<o.length;n++){var i=o[n];e.push("mode at path "+t+" has an error in its wed options: "+i)}})];case 1:if(t.root=r.sent(),e.length>0)throw new Error("wed options are incorrect: "+e.join(""));return[2,this]}})})},e.prototype.makeNodes=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var o,s,l,u,c,d,h;return __generator(this,function(p){switch(p.label){case 0:return o=t.submode,[4,this.loader.initMode(t.path,t.options)];case 1:return s=p.sent(),void 0===o?[3,3]:[4,this.makeNodes(n.toGUISelector(o.selector,s.getAbsoluteNamespaceMappings()),o.mode,r)];case 2:return u=[p.sent()],[3,4];case 3:u=[],p.label=4;case 4:return l=u,c=s.getWedOptions(),d=i.processWedOptions(c),Array.isArray(d)?(r(t.path,d),h=c):h=d,[2,new a(s,this.editor,e,l,h)]}})})},e.prototype.getMode=function(e){return this.getModeNode(e).mode},e.prototype.getDecorator=function(e){return this.getModeNode(e).decorator},e.prototype.getWedOptions=function(e){var t=this.getModeNode(e);return t.wedOptions},e.prototype.getAttributeHandling=function(e){return this.getWedOptions(e).attributes.handling},e.prototype.getAttributeHidingSpecs=function(e){return this.getModeNode(e).attributeHidingSpecs},e.prototype.getModeNode=function(e){if(0===this.root.submodes.length)return this.root;if(n.contains(this.editor.dataRoot,e)){var t=this.editor.fromDataNode(e);null!==t&&(e=t)}if(!this.editor.guiRoot.contains(e))throw new Error("did not pass a node in the GUI or data tree");var r=this._getModeNode(this.root,this.editor.guiRoot,e);if(void 0===r)throw new Error("cannot find a mode for the node; something is wrong");return r},e.prototype._getModeNode=function(e,t,r){var n=e.containingElement(t,r);if(null!==n){for(var o=void 0,i=0,a=e.submodes;i<a.length;i++){var s=a[i];if(o=this._getModeNode(s,n,r),void 0!==o)return o}return e}},e.prototype.getStylesheets=function(){return Object.keys(this.root.reduceTopFirst(function(e,t){for(var r=0,n=t.mode.getStylesheets();r<n.length;r++){var o=n[r];e[o]=!0}return e},Object.create(null)))},e.prototype.getMaxLabelLevel=function(){return this.maxLabelLevelNode.wedOptions.label_levels.max},e.prototype.getInitialLabelLevel=function(){return this.maxLabelLevelNode.wedOptions.label_levels.initial},Object.defineProperty(e.prototype,"maxLabelLevelNode",{get:function(){return void 0===this.cachedMaxLabelNode&&(this.cachedMaxLabelNode=this.root.reduceTopFirst(function(e,t){var r=e.wedOptions.label_levels.max,n=t.wedOptions.label_levels.max;return n>r?t:e},this.root)),this.cachedMaxLabelNode},enumerable:!0,configurable:!0}),e.prototype.getValidators=function(){return this.root.reduceTopFirst(function(e,t){var r=t.mode.getValidator();return void 0!==r?e.concat(r):e},[])},e.prototype.addDecoratorHandlers=function(){this.root.eachTopFirst(function(e){e.decorator.addHandlers()})},e.prototype.startListening=function(){this.root.eachTopFirst(function(e){e.decorator.startListening()})},e}();t.ModeTree=s}),define("wed/onbeforeunload",["require","exports"],function(e,t){"use strict";function r(){return!0}function n(e,t,n){function o(){var e=t();return e?e:void 0}if(void 0===t&&(t=r),void 0===n&&(n=!1),null!=e.onbeforeunload&&e.onbeforeunload.installedByOnbeforeunload&&!n)throw new Error("reregistering window with `force` false");o.installedByOnbeforeunload=!0,e.onbeforeunload=o}Object.defineProperty(t,"__esModule",{value:!0}),t.install=n}),define("wed/onerror",["require","exports","module","./log","jquery"],function(e,t){"use strict";function r(){m=!1,u&&(c.clearTimeout(u),u=void 0),f.off(),f.modal("hide"),f.remove()}function n(){return m}function o(e,t){p(document.body).append(f),f.find(".save-messages")[0].innerHTML=e,f.find(".error-message")[0].textContent=t,f.on("hide.bs.modal.modal",function(){f.remove(),window.location.reload()}),f.modal()}function i(e){var t="";if("error"===e.type){var r=e.message,n=e.filename,o=e.lineno,i=e.colno,a=e.error;a?t=a.stack:(t=n+":"+o,i&&(t+="."+i),t+=": "+r)}else{t+="Unhandled promise rejection!\n";var s,l,u=e.promise?e:e.detail;u&&(s=u.reason,l=u.promise),s?(t+="Reason: ",t+=s.stack?"\n"+s.stack:s):l&&(t+="Promise: "+l)}return t}function a(e,t){var r=["<p>",e||"Your editor"];switch(r.push(" experienced a severe error."),t){case!0:r.push(" However, it successfully saved the latest state of your data to the server. Please reload.");break;default:r.push(" It was not able to save your data to the server before terminating.")}return r.push("</p>"),r.join("")}function s(e){function t(){if(u&&p.clearTimeout(u),1===s)d.push(a(void 0,l[0]?l[0][1]:void 0));else for(var e=0;e<l.length;++e){var t=l[e];d.push(a(v[t[0]].name,t[1]))}o(d.join(""),n)}function r(e){l.push([this,e])}if(e.preventDefault(),m)return!1;m=!0;var n=i(e),s=v.length,l=[],d=[],p=window;u=p.setTimeout(t,g),c=p;var f=[];console.error(n),h.error(n);for(var y=0;y<v.length;++y){var b=v[y],w=b.saver;if(w){var _=r.bind(b);f.push(w.recover().then(_,_))}}return Promise.all(f).then(t),!1}function l(e){try{try{s(e)}catch(e){o("","Error while trying to handle fatal error: "+e.toString())}}catch(e){console.error("Error while trying to handle fatal error:"),console.error(e)}}var u,c,d="undefined"!=typeof __WED_TESTING&&__WED_TESTING.testing,h=e("./log"),p=e("jquery"),f=p('<div class="modal wed-fatal-modal" style="position: absolute" tabindex="1">  <div class="modal-dialog">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal"aria-hidden="true">&times;</button>        <h3>Fatal Error</h3>      </div>      <div class="modal-body">        <div class="save-messages"></div>        <div class="error-message"></div>      </div>      <div class="modal-footer">        <a href="#" class="btn btn-primary" data-dismiss="modal">Reload</a>      </div>    </div>  </div></div>'),m=!1;t.is_terminating=n,d&&(t.__test={$modal:f,reset:r});var v=[],g=5e3;t.handler=l,t.editors=v}),define("wed/preferences",["require","exports","lodash","./object-check"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={tooltips:!1},i=function(){function e(e){return void 0===e?(this.prefs=Object.create(null),void this._validatePrefs(this.prefs)):(this._validatePrefs(e),void(this.prefs=r.extend(Object.create(null),e)))}return e.prototype._validatePrefs=function(e){n.assertSummarily(o,e)},e.prototype.get=function(e){for(var t=e.split("."),r=0,n=this.prefs;r<t.length;){var o=t[r];if(""===o)throw new Error("empty part in "+e);if(n=n[o],void 0===n)return;++r}return n},e.prototype.set=function(e,t){for(var r=e.split("."),n=0,o=this.prefs;n<r.length-1;){var i=r[n];if(""===i)throw new Error("empty part in "+e);o=o[i],void 0===o&&(o=o[i]=Object.create(null)),++n}o[r[n]]=t,this._validatePrefs(this.prefs)},e}();t.Preferences=i}),define("wed/ajax",["require","exports","bluejax","jquery","./util","bootstrap"],function(e,t,r,n,o){"use strict";function i(e){function t(t){if(arguments.length>1)throw new Error("we do not support passing the URL as a separate argument; please use a single settings argument");var n=i.call(void 0,t);return n.promise=n.promise.catch(r.ConnectivityError,function(t){document.body.appendChild(s);var r=s.querySelector("span.reason");r.textContent=t.message,a.on("hide.bs.modal.modal",function(t){t.stopPropagation(),t.preventDefault(),o.suppressUnhandledRejections(l(e.diagnose.serverURL).then(function(){window.location.reload()}))}),a.modal(),n.promise.cancel()}),n}function n(e){return t(e).promise}var i=r.make(e),l=r.make({diagnose:{on:!0,knownServers:e.diagnose.knownServers}},"promise");return{ajax:n,ajax$:t}}Object.defineProperty(t,"__esModule",{value:!0});var a=n("<div class='modal btw-fatal-modal' style='position: absolute' tabindex='1'>  <div class='modal-dialog'>    <div class='modal-content'>      <div class='modal-header'>        <button type='button' class='close' data-dismiss='modal'aria-hidden='true'>&times;</button>        <h3>Connectivity Problem</h3>      </div>      <div class='modal-body'>        <p>We have detected a connectivity problem:            <span class='reason'></span>.</p>        <p>When you click the Ok button, we will recheck the connectivity.            If there is still a problem, this dialog will remain. Otherwise,            the window will be reloaded. If you were modifying information            on the            site when the outage occurred, please verify that what you were            trying to do actually happened.</p>      </div>      <div class='modal-footer'>        <a href='#' class='btn btn-primary' data-dismiss='modal'>Ok</a>      </div>    </div>  </div></div>"),s=a[0];t.make=i}),define("wed/runtime",["require","exports","dexie","merge-options","./ajax","./util"],function(e,t,r,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=window.require,s=function(){function e(e){e=n({},e),this.options=e;var t=null!=e.bluejaxOptions?e.bluejaxOptions:{tries:3,delay:100,diagnose:{on:!0,knownServers:["http://www.google.com/","http://www.cloudfront.com/"]}},r=o.make(t);this.ajax=r.ajax,this.ajax$=r.ajax$}return e.prototype.resolve=function(e){var t=this;return Promise.resolve().then(function(){var n=e.indexOf("://");if(n===-1)return t.ajax({url:e,dataType:"text"});var o=e.substr(0,n);if("indexeddb"===o){var i=e.substr(n+3),a=i.split("/"),s=a[0],l=a[1],u=a[2],c=a[3],d=a[4],h=a[5];if("v1"!==s)throw new Error("unsupported version number: "+s);switch(c){case"string":break;case"number":d=Number(d);break;default:throw new Error("unknown type: "+c)}var p=new r.Dexie(l);return p.open().then(function(){return p.table(u).get(d)}).then(function(t){if(null==t)throw Error("cannot resolve key from: "+e);if(void 0===h)return t;if(!(h in t))throw Error("cannot resolve property in the record of: "+e);return t[h]})}throw new Error("unknown scheme: "+o)})},e.prototype.resolveToString=function(e){return this.resolve(e).then(function(e){return"string"==typeof e?e:e instanceof File?i.readFile(e):String(e)})},e.prototype.resolveModules=function(e){return Promise.resolve().then(function(){return e instanceof Array||(e=[e]),new Promise(function(t,r){a(e,function(){t(Array.prototype.slice.call(arguments))},r)})})},e}();t.Runtime=s}),define("wed/serializer",["require","exports"],function(e,t){"use strict";function r(e,t){var r=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return t&&(r=r.replace(/"/g,"&quot;")),r}function n(e,t){if(t.childNodes.length>1)throw new Error("cannot serialize a document with more than one child node");if(null===t.firstChild)throw new Error("cannot serialize an empty document");a(e,t.firstChild)}function o(e,t){e.push("<",t.tagName);for(var n=t.attributes,o=0;o<n.length;++o){var i=n[o];e.push(" ",i.name,'="',r(i.value,!0),'"')}if(0===t.childNodes.length)e.push("/>");else{e.push(">");for(var s=t.firstChild;null!==s;)a(e,s),s=s.nextSibling;e.push("</",t.tagName,">")}}function i(e,t){e.push(r(t.textContent,!1))}function a(e,t){var r=l[t.nodeType];if(void 0===r)throw new Error("can't handle node of type: "+t.nodeType);r(e,t)}function s(e){var t=[];return a(t,e),t.join("")}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.create(null);l[Node.DOCUMENT_NODE]=n,l[Node.DOCUMENT_FRAGMENT_NODE]=n,l[Node.ELEMENT_NODE]=o,l[Node.TEXT_NODE]=i,t.serialize=s}),define("wed/saver",["require","exports","rxjs/Subject","./browsers","./serializer"],function(e,t,r,n,o){"use strict";function i(e){e=Math.round(e/1e3);var t="moments ago";return e>0&&(t="  ",t+=e>86400?Math.round(e/8640)/10+"d":e>3600?Math.round(e/360)/10+"h":e>60?Math.round(e/6)/10+"m":e+"s",t+=" ago"),t}Object.defineProperty(t,"__esModule",{value:!0});var a;!function(e){e[e.AUTO=1]="AUTO",e[e.MANUAL=2]="MANUAL"}(a=t.SaveKind||(t.SaveKind={}));var s=function(){function e(e,t,n,o,i){var a=this;this.runtime=e,this.version=t,this.dataUpdater=n,this.dataTree=o,this.options=i,this.initialized=!1,this.currentGeneration=0,this.savedGeneration=0,n.events.subscribe(function(e){"Changed"===e.name&&(a.lastModification=Date.now(),a.savedGeneration===a.currentGeneration&&(a.currentGeneration++,a._events.next({name:"Changed"})))}),this._boundAutosave=this._autosave.bind(this),this._events=new r.Subject,this.events=this._events.asObservable(),void 0!==i.autosave&&this.setAutosaveInterval(1e3*i.autosave)}return e.prototype.save=function(){return this._save(!1)},e.prototype.getData=function(){var e=this.dataTree.firstChild;if(n.MSIE)return o.serialize(e);var t=e.outerHTML;return n.EDGE?t.replace(/<([^\/<>]+) \/>/g,"<$1/>"):t},e.prototype._saveSuccess=function(e,t){this.savedGeneration=t,this.lastSave=Date.now(),this.lastSaveKind=e?a.AUTO:a.MANUAL,this._events.next(e?{name:"Autosaved"}:{name:"Saved"}),this.setAutosaveInterval(this.autosaveInterval)},e.prototype._fail=function(e){this.failed=!0,void 0!==e&&this._events.next({name:"Failed",error:e})},e.prototype._autosave=function(){var e=this;this.autosaveTimeout=void 0;var t=function(){e.setAutosaveInterval(e.autosaveInterval)};this.currentGeneration!==this.savedGeneration?this._save(!0).then(t):t()},e.prototype.setAutosaveInterval=function(e){this.autosaveInterval=e;var t=this.autosaveTimeout;void 0!==t&&clearTimeout(t),this.autosaveTimeout=0!==e?setTimeout(this._boundAutosave,e):void 0},e.prototype.recover=function(){var e=this;return Promise.resolve().then(function(){return!e.initialized||e.failed?Promise.resolve(void 0):e._recover()})},e.prototype.getModifiedWhen=function(){return this.savedGeneration!==this.currentGeneration&&i(Date.now()-this.lastModification)},e.prototype.getSavedWhen=function(){if(void 0!==this.lastSaveKind)return i(Date.now()-this.lastSave)},e.prototype.getLastSaveKind=function(){return this.lastSaveKind},e}();t.Saver=s}),define("wed/build-info",[],function(){return{desc:"v1.0.0",date:"Thu Feb 01 2018 10:02:04 GMT-0500 (EST)"}}),define("wed/stock-modals",["require","exports","./browsers","./build-info"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.maker=e,this.modals=new Map}return e.prototype.getModal=function(e){var t=this.modals.get(e);return void 0===t&&(t=this.make(e),this.modals.set(e,t)),t},e.prototype.make=function(e){var t=this.maker.makeModal();switch(e){case"limitation":t.setTitle("Cannot proceed");break;case"paste":t.setTitle("Invalid structure"),t.setBody("<p>The data you are trying to paste appears to be XML. However, pasting it here will result in a structurally invalid document. Do you want to paste it as text instead? (If you answer negatively, the data won't be pasted at all.)<p>"),t.addYesNo();break;case"straddling":t.setTitle("Invalid modification"),t.setBody("<p>The text selected straddles disparate elements of the document. You may be able to achieve what you want to do by selecting smaller sections.<p>"),t.addButton("Ok",!0);break;case"help":var o=this.maker.docURL,i="  <li>Ctrl-s: Save</li>\n  <li>Ctrl-x: Cut</li>\n  <li>Ctrl-v: Paste</li>\n  <li>Ctrl-c: Copy</li>\n  <li>Ctrl-z: Undo</li>\n  <li>Ctrl-y: Redo</li>\n  <li>Ctrl-/: Bring up a contextual menu.</li>\n  <li>Ctrl-?: Bring up a replacement menu.</li>\n  <li>Ctrl-f: Quick search forward.</li>\n  <li>Ctrl-b: Quick search backwards.</li>\n  <li>Ctrl-Shift-f: Search forward.</li>\n  <li>Ctrl-Shift-b: Search backwards.</li>\n",a="  <li>Ctrl-[: Decrease the label visibility level.</li>\n  <li>Ctrl-]: Increase the label visibility level.</li>\n";t.setTitle("Help"),t.setBody("\n<p>Click <a href='"+o+"' target='_blank'>this link</a> to see\nwed's generic help. The link by default will open in a new tab.</p>\n<ul>\n  <li>Clicking the right mouse button on the document contents brings up a\ncontextual menu.</li>\n  <li>F1: help</li>\n  "+(r.OSX?i.replace(/Ctrl-/g,"Cmd-"):a+i)+"\n</ul>\n<p class='wed-build-info'>Build descriptor: "+n.desc+"<br/>\nBuild date: "+n.date+"</p>"),t.addButton("Close",!0);break;case"disconnect":t.setTitle("Disconnected from server!"),t.setBody("It appears your browser is disconnected from the server. Editing is frozen until the connection is reestablished. Dismissing this dialog will retry saving. If the operation is successful, you'll be able to continue editing. If not, this message will reappear."),t.addButton("Retry",!0);break;case"editedByOther":t.setTitle("Edited by another!"),t.setBody("Your document was edited by someone else since you last loaded or saved it. You must reload it before trying to edit further."),t.addButton("Reload",!0);break;case"tooOld":t.setTitle("Newer version!"),t.setBody("There is a newer version of the editor. You must reload it before trying to edit further."),t.addButton("Reload",!0);break;default:var s=e;throw new Error("cannot handle name "+s)}return t},e}();t.StockModals=o}),define("rxjs/BehaviorSubject",["require","exports","module","./Subject","./util/ObjectUnsubscribedError"],function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=e("./Subject"),i=e("./util/ObjectUnsubscribedError"),a=function(e){function t(t){e.call(this),this._value=t}return n(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return r&&!r.closed&&t.next(this._value),r},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new i.ObjectUnsubscribedError;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(o.Subject);return t.BehaviorSubject=a,r.exports}),define("rxjs/util/EmptyError",["require","exports","module"],function(e,t,r){var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(){var t=e.call(this,"no elements in sequence");this.name=t.name="EmptyError",this.stack=t.stack,this.message=t.message}return n(t,e),t}(Error);return t.EmptyError=o,r.exports}),define("rxjs/operators/first",["require","exports","module","../Subscriber","../util/EmptyError"],function(e,t,r){function n(e,t,r){return function(n){return n.lift(new s(e,t,r,n))}}var o=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("../Subscriber"),a=e("../util/EmptyError");t.first=n;var s=function(){function e(e,t,r,n){this.predicate=e,this.resultSelector=t,this.defaultValue=r,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.predicate,this.resultSelector,this.defaultValue,this.source))},e}(),l=function(e){function t(t,r,n,o,i){e.call(this,t),this.predicate=r,this.resultSelector=n,this.defaultValue=o,this.source=i,this.index=0,this.hasCompleted=!1,this._emitted=!1}return o(t,e),t.prototype._next=function(e){var t=this.index++;this.predicate?this._tryPredicate(e,t):this._emit(e,t)},t.prototype._tryPredicate=function(e,t){var r;try{r=this.predicate(e,t,this.source)}catch(e){return void this.destination.error(e)}r&&this._emit(e,t)},t.prototype._emit=function(e,t){return this.resultSelector?void this._tryResultSelector(e,t):void this._emitFinal(e)},t.prototype._tryResultSelector=function(e,t){var r;try{r=this.resultSelector(e,t)}catch(e){return void this.destination.error(e)}this._emitFinal(r)},t.prototype._emitFinal=function(e){var t=this.destination;this._emitted||(this._emitted=!0,t.next(e),t.complete(),this.hasCompleted=!0)},t.prototype._complete=function(){var e=this.destination;this.hasCompleted||"undefined"==typeof this.defaultValue?this.hasCompleted||e.error(new a.EmptyError):(e.next(this.defaultValue),e.complete())},t}(i.Subscriber);return r.exports});var __assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};define("wed/task-runner",["require","exports","rxjs/BehaviorSubject","rxjs/operators/first"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){void 0===t&&(t={}),this.task=e,this._timeout=0,this._maxTimespan=100,this._boundWrapper=this._workWrapper.bind(this);for(var n=["timeout","maxTimespan"],o=0,i=n;o<i.length;o++){var a=i[o],s=t[a];if(void 0!==s){if(s<0)throw new Error("the value for "+a+" cannot be negative");this["_"+a]=t[a]}}this._state=new r.BehaviorSubject({running:!1,completed:!1,terminated:!1}),this.state=this._state.asObservable()}return Object.defineProperty(e.prototype,"running",{get:function(){return this._state.value.running},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"completed",{get:function(){return this._state.value.completed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"terminated",{get:function(){return this._state.value.terminated},enumerable:!0,configurable:!0}),e.prototype.onCompleted=function(){return this.state.pipe(n.first(function(e){return e.completed})).toPromise()},e.prototype._stateFieldChange=function(e,t){var r=this._state.value,n=__assign({},this._state.value);n[e]=t,n[e]!==r[e]&&this._state.next(n)},e.prototype._setTimeoutId=function(e){this._timeoutId=e,this._stateFieldChange("running",void 0!==this._timeoutId)},e.prototype.start=function(){this.reset(),this.resume()},e.prototype.reset=function(){this._stateFieldChange("completed",!1),this.task.reset(this)},e.prototype.resume=function(){this.completed||(void 0!==this._timeoutId&&this.stop(),this._setTimeoutId(setTimeout(this._boundWrapper,0)));
},e.prototype._workWrapper=function(){this._work()?this._setTimeoutId(setTimeout(this._boundWrapper,this._timeout)):this._stateFieldChange("completed",!0)},e.prototype._work=function(){for(var e=Date.now();;){if(this._maxTimespan>0&&Date.now()-e>=this._maxTimespan)return!0;var t=this.task.cycle(this);if(!t)return!1}},e.prototype.stop=function(){void 0!==this._timeoutId&&clearTimeout(this._timeoutId),this._setTimeoutId(void 0)},e.prototype.terminate=function(){this.stop(),this._stateFieldChange("terminated",!0),this._state.complete()},e}();t.TaskRunner=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/undo",["require","exports","rxjs/Subject"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.stack=[],this.list=[],this.index=-1,this._undoingOrRedoing=!1,this._events=new r.Subject,this.events=this._events.asObservable()}return e.prototype.reset=function(){if(this._undoingOrRedoing)throw new Error("may not reset while undoing or redoing");this.stack.length=0,this.index=-1;for(var e=0,t=this.list;e<t.length;e++){var r=t[e].subscription;r.unsubscribe()}this.list=[]},e.prototype.record=function(e){if(this.stack.length>0)this.stack[0].record(e);else{var t=this.list;this.list=this.list.splice(0,this.index+1);for(var r=0,n=t;r<n.length;r++){var o=n[r].subscription;o.unsubscribe()}this.list.push({undo:e,subscription:e.events.subscribe(this._events)}),this.index++}},e.prototype.undo=function(){if(this._undoingOrRedoing)throw new Error("calling undo while undoing or redoing");for(this._undoingOrRedoing=!0;this.stack.length>0;)this.endGroup();this.index>=0&&this.list[this.index--].undo.undo(),this._undoingOrRedoing=!1},e.prototype.redo=function(){if(this._undoingOrRedoing)throw new Error("calling redo while undoing or redoing");this._undoingOrRedoing=!0,this.index<this.list.length-1&&this.list[++this.index].undo.redo(),this._undoingOrRedoing=!1},e.prototype.undoingOrRedoing=function(){return this._undoingOrRedoing},e.prototype.canUndo=function(){return this.index>-1||this.stack.length>0},e.prototype.canRedo=function(){return this.index<this.list.length-1},e.prototype.startGroup=function(e){this.stack.unshift(e)},e.prototype.endGroup=function(){var e=this.stack.shift();if(void 0===e)throw new Error("ending a non-existent group.");e.end(),this.record(e)},e.prototype.endAllGroups=function(){for(;this.stack.length>0;)this.endGroup()},e.prototype.getGroup=function(){return this.stack[0]},e.prototype.toString=function(){var e=[];e.push("Start of list\n");for(var t=0,r=this.list;t<r.length;t++){var n=r[t];e.push(n.toString())}e.push("End of list\n"),e.push("Unfinished groups:\n");for(var o=this.stack.length-1;o>=0;--o){var i=this.stack[o];e.push(i.toString())}return e.push("End of unfinished groups\n"),e.join("")},e}();t.UndoList=n;var o=function(){function e(e){this.desc=e,this._events=new r.Subject,this.events=this._events.asObservable()}return e.prototype.undo=function(){this.performUndo(),this._events.next({name:"Undo",undo:this})},e.prototype.redo=function(){this.performRedo(),this._events.next({name:"Redo",undo:this})},e.prototype.toString=function(){return this.desc+"\n"},e}();t.Undo=o;var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.list=[],t}return __extends(t,e),t.prototype.performUndo=function(){for(var e=this.list.length-1;e>=0;--e)this.list[e].undo()},t.prototype.performRedo=function(){for(var e=0,t=this.list;e<t.length;e++){var r=t[e];r.redo()}},t.prototype.record=function(e){this.list.push(e),e.events.subscribe(this._events)},t.prototype.end=function(){},t.prototype.toString=function(){var e=[];e.push("Start of "+this.desc+"\n");for(var t=0,r=this.list;t<r.length;t++){var n=r[t];e.push(n.toString().replace(/(^|\n)/g,"$1 ").slice(0,-1))}return e.push("End of "+this.desc+"\n"),e.join("")},t}(o);t.UndoGroup=i;var a=function(e){function t(t){return e.call(this,"*** MARKER *** "+t)||this}return __extends(t,e),t.prototype.performUndo=function(){},t.prototype.performRedo=function(){},t}(o);t.UndoMarker=a});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/undo-recorder",["require","exports","./domutil","./undo"],function(e,t,r,n){"use strict";function o(e){return null==e?"undefined":e.outerHTML}Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r,n){var o=e.call(this,"InsertNodeAtUndo")||this;return o.treeUpdater=t,o.index=n,o.parentPath=t.nodeToPath(r),o}return __extends(t,e),t.prototype.performUndo=function(){if(void 0!==this.node)throw new Error("undo called twice in a row");var e=this.treeUpdater.pathToNode(this.parentPath);this.node=e.childNodes[this.index].cloneNode(!0),this.treeUpdater.deleteNode(e.childNodes[this.index])},t.prototype.performRedo=function(){if(void 0===this.node)throw new Error("redo called twice in a row");var e=this.treeUpdater.pathToNode(this.parentPath);this.treeUpdater.insertNodeAt(e,this.index,this.node),this.node=void 0},t.prototype.toString=function(){return[this.desc,"\n"," Parent path: ",this.parentPath,"\n"," Index: ",this.index,"\n"," Node: ",o(this.node),"\n"].join("")},t}(n.Undo),a=function(e){function t(t,r,n,o){var i=e.call(this,"SetTextNodeValueUndo")||this;return i.treeUpdater=t,i.value=n,i.oldValue=o,i.nodePath=t.nodeToPath(r),i}return __extends(t,e),t.prototype.performUndo=function(){var e=this.treeUpdater.pathToNode(this.nodePath);this.treeUpdater.setTextNodeValue(e,this.oldValue)},t.prototype.performRedo=function(){var e=this.treeUpdater.pathToNode(this.nodePath);this.treeUpdater.setTextNodeValue(e,this.value)},t.prototype.toString=function(){return[this.desc,"\n"," Node path: ",this.nodePath,"\n"," Value: ",this.value,"\n"," Old value: ",this.oldValue,"\n"].join("")},t}(n.Undo),s=function(e){function t(t,n){var o=e.call(this,"DeleteNodeUndo")||this;o.treeUpdater=t;var i=n.parentNode;return o.parentPath=t.nodeToPath(i),o.index=r.indexOf(i.childNodes,n),o.node=n.cloneNode(!0),o}return __extends(t,e),t.prototype.performUndo=function(){if(void 0===this.node)throw new Error("undo called twice in a row");var e=this.treeUpdater.pathToNode(this.parentPath);this.treeUpdater.insertNodeAt(e,this.index,this.node),this.node=void 0},t.prototype.performRedo=function(){if(void 0!==this.node)throw new Error("redo called twice in a row");var e=this.treeUpdater.pathToNode(this.parentPath);this.node=e.childNodes[this.index].cloneNode(!0),this.treeUpdater.deleteNode(e.childNodes[this.index])},t.prototype.toString=function(){return[this.desc,"\n"," Parent path: ",this.parentPath,"\n"," Index: ",this.index,"\n"," Node: ",o(this.node),"\n"].join("")},t}(n.Undo),l=function(e){function t(t,r,n,o,i,a){var s=e.call(this,"SetAttributeNSUndo")||this;return s.treeUpdater=t,s.ns=n,s.attribute=o,s.oldValue=i,s.newValue=a,s.nodePath=t.nodeToPath(r),s}return __extends(t,e),t.prototype.performUndo=function(){var e=this.treeUpdater.pathToNode(this.nodePath);this.treeUpdater.setAttributeNS(e,this.ns,this.attribute,this.oldValue)},t.prototype.performRedo=function(){var e=this.treeUpdater.pathToNode(this.nodePath);this.treeUpdater.setAttributeNS(e,this.ns,this.attribute,this.newValue)},t.prototype.toString=function(){return[this.desc,"\n"," Node path: ",this.nodePath,"\n"," Namespace: ",this.ns,"\n"," Attribute Name: ",this.attribute,"\n"," New value: ",this.newValue,"\n"," Old value: ",this.oldValue,"\n"].join("")},t}(n.Undo),u=function(){function e(e,t){var r=this;this.editor=e,this.treeUpdater=t,this.suppress=!1,t.events.subscribe(function(e){switch(e.name){case"InsertNodeAt":r.insertNodeAtHandler(e);break;case"SetTextNodeValue":r.setTextNodeValueHandler(e);break;case"BeforeDeleteNode":r.beforeDeleteNodeHandler(e);break;case"SetAttributeNS":r.setAttributeNSHandler(e)}})}return e.prototype.suppressRecording=function(e){if(e===this.suppress)throw new Error("spurious call to suppressRecording");this.suppress=e},e.prototype.insertNodeAtHandler=function(e){this.suppress||this.editor.recordUndo(new i(this.treeUpdater,e.parent,e.index))},e.prototype.setTextNodeValueHandler=function(e){this.suppress||this.editor.recordUndo(new a(this.treeUpdater,e.node,e.value,e.oldValue))},e.prototype.beforeDeleteNodeHandler=function(e){this.suppress||this.editor.recordUndo(new s(this.treeUpdater,e.node))},e.prototype.setAttributeNSHandler=function(e){this.suppress||this.editor.recordUndo(new l(this.treeUpdater,e.node,e.ns,e.attribute,e.oldValue,e.newValue))},e}();t.UndoRecorder=u}),define("wed/tasks/process-validation-errors",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.controller=e}return e.prototype.reset=function(){this.errors=this.controller.copyErrorList()},e.prototype.cycle=function(){var e=this.controller,t=this.errors;if(0===t.length)return!1;for(var r=Math.min(t.length,30),n=[],o=[],i=0;0!==r;){r--;var a=t[i];if(e.processError(a)){t.splice(i,1);var s=a.item;if(void 0===s)throw new Error("there should be an item");n.push(s);var l=a.marker;null!=l&&o.push(l)}else++i}return e.appendItems(n),e.appendMarkers(o),0!==t.length},e}();t.ProcessValidationErrors=r}),define("wed/tasks/refresh-validation-errors",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.controller=e}return e.prototype.reset=function(){this.errors=this.controller.copyErrorList(),this.resumeAt=0},e.prototype.cycle=function(){for(var e=this.resumeAt,t=Math.min(this.errors.length,this.resumeAt+20),r=this.errors;e<t;){var n=r[e];null!=n.marker&&this.controller.processError(n),e++}return this.resumeAt=e,e<r.length},e}();t.RefreshValidationErrors=r}),define("wed/validation-controller",["require","exports","salve","salve-dom","./dloc","./domtypeguards","./domutil","./guiroot","./task-runner","./tasks/process-validation-errors","./tasks/refresh-validation-errors","./util","./wed-util"],function(e,t,r,n,o,i,a,s,l,u,c,d,h){"use strict";function p(e,t,r){var n=e.caretManager;try{return n.fromDataLocation(t,r)}catch(e){if(e instanceof s.AttributeNotFound)return n.fromDataLocation(t.ownerElement,0);throw e}}function f(e,t){for(var r=e.createDocumentFragment(),n=0,o=t;n<o.length;n++){var i=o[n];r.appendChild(i)}return r}function m(e,t){for(var r=[],n=e.getNames(),o=0,i=n;o<i.length;o++){var a=i[o],s=a.toArray(),l="";if(null!==s){for(var u=[],c=0,h=s;c<h.length;c++){var p=h[c];u.push(t.unresolveName(p.ns,p.name))}l=u.join(" or ")}else l=d.convertPatternObj(a.toObject(),t);r.push(l)}return r}Object.defineProperty(t,"__esModule",{value:!0});var v={};v[n.WorkingState.INCOMPLETE]="stopped",v[n.WorkingState.WORKING]="working",v[n.WorkingState.INVALID]="invalid",v[n.WorkingState.VALID]="valid";var g={};g[n.WorkingState.INCOMPLETE]="info",g[n.WorkingState.WORKING]="info",g[n.WorkingState.INVALID]="danger",g[n.WorkingState.VALID]="success";var y=function(){function e(e,t,r,n,o,i,a,s,d,h){this.editor=e,this.validator=t,this.resolver=r,this.scroller=n,this.guiRoot=o,this.progressBar=i,this.validationMessage=a,this.errorLayer=s,this.errorList=d,this.errorItemHandler=h,this.lastDoneShown=0,this.processErrorsDelay=500,this._errors=[],this.processedErrorsUpTo=-1,this.document=o.ownerDocument,this.$errorList=$(d),this.refreshErrorsRunner=new l.TaskRunner(new c.RefreshValidationErrors(this)),this.processErrorsRunner=new l.TaskRunner(new u.ProcessValidationErrors(this)),this.validator.events.addEventListener("state-update",this.onValidatorStateChange.bind(this)),this.validator.events.addEventListener("error",this.onValidatorError.bind(this)),this.validator.events.addEventListener("reset-errors",this.onResetErrors.bind(this))}return e.prototype.copyErrorList=function(){return this._errors.slice()},e.prototype.stop=function(){this.refreshErrorsRunner.stop(),this.processErrorsRunner.stop(),this.validator.stop()},e.prototype.resume=function(){this.refreshErrorsRunner.resume(),this.processErrorsRunner.resume(),this.validator.start()},e.prototype.onValidatorStateChange=function(e){var t=e.state,r=e.partDone;if(t===n.WorkingState.WORKING){if(r-this.lastDoneShown<.05)return}else t!==n.WorkingState.VALID&&t!==n.WorkingState.INVALID||this.processErrors();this.lastDoneShown=r;var o=100*r,i=this.progressBar;i.style.width=o+"%",i.classList.remove("progress-bar-info","progress-bar-success","progress-bar-danger"),i.classList.add("progress-bar-"+g[t]),this.validationMessage.textContent=v[t]},e.prototype.onValidatorError=function(e){this._errors.push({ev:e,marker:void 0,item:void 0}),void 0===this.processErrorsTimeout&&(this.processErrorsTimeout=setTimeout(this.processErrors.bind(this),this.processErrorsDelay))},e.prototype.onResetErrors=function(e){if(0!==e.at)throw new Error("internal error: wed does not yet support resetting errors at an arbitrary location");this.lastDoneShown=0,this.clearErrors()},e.prototype.processErrors=function(){void 0!==this.processErrorsTimeout&&(clearTimeout(this.processErrorsTimeout),this.processErrorsTimeout=void 0),this.processErrorsRunner.reset(),this.editor.resumeTaskWhenPossible(this.processErrorsRunner)},e.prototype.findInsertionPoint=function(e){var t=e.error,n=e.node,a=e.index;if(null==n)throw new Error("error without a node");if(void 0===a)throw new Error("error without an index");var s,l=t instanceof r.AttributeNameError;if(l){var u=h.getGUINodeIfExists(this.editor,n);if(void 0===u)return;var c=void 0;if(i.isAttr(n))c=u;else{if(!i.isElement(u))throw new Error("attribute name errors should be associated with elements");c=u.querySelector("._gui.__start_label ._greater_than")}s=o.DLoc.mustMakeDLoc(this.guiRoot,c,0)}else{if(s=p(this.editor,n,a),void 0===s)return;s=this.editor.caretManager.normalizeToEditableRange(s)}return s},e.prototype.processError=function(e){var t=this;this.editor.expandErrorPanelWhenNoNavigation();var r=e.ev,n=r.error,o=r.node,s=this.findInsertionPoint(r);if(void 0===s)return!1;var l,u=e.marker;if(null==o)throw new Error("error without a node");if(void 0===u){var c=s.node.ownerDocument,p=!1;if(i.isAttr(o)){var f=s.node;if(f.nodeType===Node.TEXT_NODE&&(f=f.parentNode),!i.isElement(f))throw new Error("we should be landing on an element");p=a.isNotDisplayed(f,s.root)}var v=m(n,this.resolver);l=c.createElement("li");var g=l.id=d.newGenericID();if(p)l.textContent=n.toStringWithNames(v),l.title="This error belongs to an attribute which is not currently displayed.";else{u=c.createElement("span"),u.className="_phantom wed-validation-error",u.innerText="";var y=$(u);y.mousedown(function(){t.$errorList.parents(".panel-collapse").collapse("show");var e=$(t.errorList.querySelector("#"+g)),r=t.$errorList.parent(".panel-body");return r.animate({scrollTop:e.offset().top-r.offset().top+r[0].scrollTop}),t.errorLayer.select(u),e.siblings().removeClass("selected"),e.addClass("selected"),t.editor.caretManager.setCaret(s),!1});var b=u.id=d.newGenericID(),w=c.createElement("a");w.href="#"+b,w.textContent=n.toStringWithNames(v),l.appendChild(w),$(l.firstElementChild).click(this.errorItemHandler)}}if(void 0!==u){var _=h.boundaryXY(s),E=this.scroller,x=E.getBoundingClientRect();u.style.top=_.top-x.top+E.scrollTop+"px",u.style.left=_.left-x.left+E.scrollLeft+"px"}return void 0===e.item&&(e.item=l),e.marker=u,!0},e.prototype.clearErrors=function(){this._errors=[],this.processedErrorsUpTo=-1,this.refreshErrorsRunner.stop(),this.processErrorsRunner.stop(),this.errorLayer.clear();for(var e=this.errorList;null!=e.lastChild;)e.removeChild(e.lastChild);this.refreshErrorsRunner.reset(),this.processErrorsRunner.reset()},e.prototype.terminate=function(){void 0!==this.processErrorsTimeout&&clearTimeout(this.processErrorsTimeout),this.stop()},e.prototype.refreshErrors=function(){this.refreshErrorsRunner.reset(),this.editor.resumeTaskWhenPossible(this.refreshErrorsRunner)},e.prototype.recreateErrors=function(){this.errorLayer.clear();for(var e=this.errorList;null!==e.lastChild;)e.removeChild(e.lastChild);for(var t=0,r=this._errors;t<r.length;t++){var n=r[t];n.marker=void 0,n.item=void 0}this.processedErrorsUpTo=-1,this.processErrors()},e.prototype.appendItems=function(e){this.errorList.appendChild(f(this.document,e))},e.prototype.appendMarkers=function(e){this.errorLayer.append(f(this.document,e))},e}();t.ValidationController=y});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/validator",["require","exports","salve-dom","./dloc","./domtypeguards"],function(e,t,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INCOMPLETE=r.WorkingState.INCOMPLETE,t.WORKING=r.WorkingState.WORKING,t.INVALID=r.WorkingState.INVALID,t.VALID=r.WorkingState.VALID;var i=function(e){function t(t,r,n){var o=e.call(this,t,r,{timeout:0,maxTimespan:100})||this;return o.modeValidators=n,o}return __extends(t,e),t.prototype._runDocumentValidation=function(){for(var e=0,t=this.modeValidators;e<t.length;e++)for(var r=t[e],n=r.validateDocument(),o=0,i=n;o<i.length;o++){var a=i[o];this._processError(a)}},t.prototype.possibleAt=function(t,r,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),t instanceof n.DLoc){if("boolean"!=typeof r)throw new Error("2nd parameter must be boolean");o=r,r=t.offset,t=t.node}if("number"!=typeof r)throw new Error("index must be a number");return e.prototype.possibleAt.call(this,t,r,o)},t.prototype.speculativelyValidate=function(t,r,i){if(t instanceof n.DLoc){if(!(o.isNode(r)||r instanceof Array))throw new Error("2nd argument must be a Node or an array of Nodes");i=r,r=t.offset,t=t.node}if("number"!=typeof r)throw new Error("index must be a number");if(void 0===i)throw new Error("toParse must be defined");return e.prototype.speculativelyValidate.call(this,t,r,i)},t.prototype.speculativelyValidateFragment=function(t,r,i){if(t instanceof n.DLoc){if("number"==typeof r||!o.isElement(r))throw new Error("toParse is not an element");i=r,r=t.offset,t=t.node}if("number"!=typeof r)throw new Error("index must be a number");if(void 0===i)throw new Error("toParse must be defined");return e.prototype.speculativelyValidateFragment.call(this,t,r,i)},t}(r.Validator);t.Validator=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/wundo",["require","exports","./undo"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(t,r){var n=e.call(this,t)||this;return n.editor=r,n.caretAsPathBefore=n.getDataCaretAsPath(),n}return __extends(t,e),t.prototype.performUndo=function(){e.prototype.performUndo.call(this),this.setDataCaretAsPath(this.caretAsPathBefore)},t.prototype.performRedo=function(){if(e.prototype.performRedo.call(this),void 0===this.caretAsPathAfter)throw new Error("caretAsPathAfter is undefined, this indicates a corrupted state and thus an internal error");this.setDataCaretAsPath(this.caretAsPathAfter)},t.prototype.getDataCaretAsPath=function(){var e=this.editor.caretManager.getDataCaret(!0);return void 0===e?[void 0,void 0]:[this.editor.dataUpdater.nodeToPath(e.node),e.offset]},t.prototype.setDataCaretAsPath=function(e){void 0===e[0]&&void 0===e[1]||this.editor.caretManager.setCaret(this.editor.dataUpdater.pathToNode(e[0]),e[1])},t.prototype.recordCaretAfter=function(){this.caretAsPathAfter=this.getDataCaretAsPath()},t.prototype.end=function(){void 0===this.caretAsPathAfter&&this.recordCaretAfter()},t}(r.UndoGroup);t.UndoGroup=n;var o=function(e){function t(t,r,n,o){var i=e.call(this,t,r)||this;return i.undoList=n,i.limit=o,i}return __extends(t,e),t.prototype.record=function(t){if(this.list.length>=this.limit)throw new Error("TextUndoGroup.record called beyond the limit");e.prototype.record.call(this,t),this.list.length===this.limit&&this.undoList.endGroup()},t}(n);t.TextUndoGroup=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,s)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,i&&(a=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,i=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],i=0}finally{o=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,i,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};define("wed/editor",["require","exports","ajv","jquery","rxjs/operators/filter","rxjs/Subject","salve","salve-dom","./action","./caret-manager","./dloc","./domlistener","./domtypeguards","./domutil","./domutil","./editor-actions","./exceptions","./gui-updater","./gui/dialog-search-replace","./gui/editing-menu-manager","./gui/error-layer","./gui/icon","./gui/layer","./gui/minibuffer","./gui/modal","./gui/notify","./gui/quick-search","./gui/scroller","./gui/toolbar","./gui/tooltip","./guiroot","./key","./key-constants","./log","./mode-tree","./onbeforeunload","./onerror","./options-schema.json","./preferences","./runtime","./saver","./stock-modals","./task-runner","./transformation","./tree-updater","./undo","./undo-recorder","./util","./validation-controller","./validator","./wed-util","./wundo","bootstrap"],function(e,t,r,n,o,i,a,s,l,u,c,d,h,p,f,m,v,g,y,b,w,_,E,x,N,C,S,P,k,T,A,O,R,I,D,M,L,j,F,B,H,$,U,V,W,q,z,K,G,X,Q,Y){"use strict";function Z(e,t){return t.name===e}Object.defineProperty(t,"__esModule",{value:!0}),t.version="1.0.0";var J,ee=O.makeKey(27),te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"modal",{get:function(){if(void 0===this._modal){var e=this._modal=this.editor.makeModal();e.setTitle("Complex Name Pattern Encountered"),e.setBody("<p>The schema contains here a complex name pattern modal. While wed has no problem validating such cases. It does not currently have facilities to add elements or attributes that match such patterns. You can continue editing your document but you will not be able to take advantage of the possibilities provided by the complex pattern here.</p>"),e.addButton("Ok",!0)}return this._modal},enumerable:!0,configurable:!0}),t.prototype.execute=function(){this.modal.modal()},t}(l.Action);!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.MINIBUFFER=1]="MINIBUFFER"}(J=t.WedEventTarget||(t.WedEventTarget={}));var re="<div class='row'> <div class='toolbar'></div> <div class='wed-frame col-sm-push-2 col-lg-10 col-md-10 col-sm-10'>  <div class='row'>   <div class='progress'>    <span></span>    <div class='wed-validation-progress progress-bar' style='width: 0%'></div>   </div>  </div>  <div class='row'>   <div class='wed-cut-buffer' contenteditable='true'></div>   <div class='wed-document-constrainer'>    <input class='wed-comp-field' type='text'></input>    <div class='wed-scroller'>     <div class='wed-caret-layer'></div>     <div class='wed-error-layer'></div>     <div class='wed-document'><span class='root-here'></span></div>    </div>   </div>   <div class='wed-minibuffer'></div>   <div class='wed-location-bar'>@&nbsp;<span>&nbsp;</span></div>  </div> </div> <div class='wed-sidebar col-sm-pull-10 col-lg-2 col-md-2 col-sm-2'>  <div class='wed-save-and-modification-status'>   <span class='wed-modification-status label label-success'          title='Modification status'>    <i class='fa fa-asterisk'></i>   </span>   <span class='wed-save-status label label-default'>    <i class='fa fa-cloud-upload'></i> <span></span>   </span>  </div>  <div id='sidebar-panel' class='panel-group wed-sidebar-panel'>   <div class='panel panel-info wed-navigation-panel'>    <div class='panel-heading'>     <div class='panel-title'>      <a class='accordion-toggle' data-toggle='collapse'          data-parent='#sidebar-panel' href='#sb-nav-collapse'>Navigation</a>     </div>    </div>   <div id='sb-nav-collapse' data-parent='#sidebar-panel'         class='panel-collapse collapse in'>     <div id='sb-nav' class='panel-body'>      <ul id='navlist' class='nav nav-list'>       <li class='inactive'>A list of navigation links will appear here</li>      </ul>     </div>    </div>   </div>   <div class='panel panel-danger'>    <div class='panel-heading'>     <div class='panel-title'>      <a class='accordion-toggle' data-toggle='collapse'         data-parent='#sidebar-panel' href='#sb-errors-collapse'>Errors</a>     </div>    </div>    <div id='sb-errors-collapse' data-parent='#sidebar-panel'         class='panel-collapse collapse'>     <div id='sb-errors' class='panel-body'>      <ul id='sb-errorlist' class='nav nav-list wed-errorlist'>       <li class='inactive'></li>      </ul>     </div>    </div>   </div>  </div> </div></div>",ne=function(){function e(e,t){var o=this;this._firstValidationComplete=!1,this.modeData={},this.developmentMode=!1,this.textUndoMaxLength=10,this.taskRunners=[],this.taskSuspension=0,this.normalizeEnteredSpaces=!0,this.strippedSpaces=/\u200B/g,this.replacedSpaces=/\s+/g,this.destroying=!1,this.destroyed=!1,this.globalKeydownHandlers=[],this.updatingPlaceholder=0,this.composing=!1,this._transformations=new i.Subject,this.name="",this.saveAction=new m.Save(this),this.decreaseLabelVisibilityLevelAction=new m.DecreaseLabelVisibilityLevel(this),this.increaseLabelVisibilityLevelAction=new m.IncreaseLabelVisibilityLevel(this),this.undoAction=new m.Undo(this),this.redoAction=new m.Redo(this),this.toggleAttributeHidingAction=new m.ToggleAttributeHiding(this),this.transformations=this._transformations.asObservable(),this.firstValidationComplete=new Promise(function(e){o.firstValidationCompleteResolve=e}),this.initialized=new Promise(function(e){o.initializedResolve=e}),L.editors.push(this),this.widget=e,this.$widget=n(this.widget),this.$frame=n(f.closest(this.widget,"html"));var a=this.doc=this.$frame[0].ownerDocument;this.window=a.defaultView,this.runtime=t instanceof B.Runtime?t:new B.Runtime(t),t=this.runtime.options,this.modals=new $.StockModals(this),t.ignore_module_config&&console.warn("the option ignore_module_config is no longer useful");var s=new r,l=s.compile(j);if(!l(t))throw new Error("the options passed to wed are not valid: "+s.errorsText(l.errors,{dataVar:"options"}));void 0!==t.ajaxlog&&(this.appender=I.addURL(t.ajaxlog.url,t.ajaxlog.headers)),this.name=void 0!==t.name?t.name:"",this.options=t;var u=this.options.docURL;this.docURL=null==u?"./doc/index.html":u,this.preferences=new F.Preferences({tooltips:!0});var c=f.htmlToElements(re,a)[0],d=this.guiRoot=c.getElementsByClassName("wed-document")[0];this.$guiRoot=n(d),this.scroller=new P.Scroller(c.getElementsByClassName("wed-scroller")[0]),this.constrainer=c.getElementsByClassName("wed-document-constrainer")[0];var h=this.toolbar=new k.Toolbar,p=c.getElementsByClassName("toolbar")[0];p.parentNode.insertBefore(h.top,p),p.parentNode.removeChild(p),this.inputField=c.getElementsByClassName("wed-comp-field")[0],this.$inputField=n(this.inputField),this.cutBuffer=c.getElementsByClassName("wed-cut-buffer")[0],this.caretLayer=new E.Layer(c.getElementsByClassName("wed-caret-layer")[0]),this.errorLayer=new w.ErrorLayer(c.getElementsByClassName("wed-error-layer")[0]),this.wedLocationBar=c.getElementsByClassName("wed-location-bar")[0],this.minibuffer=new x.Minibuffer(c.getElementsByClassName("wed-minibuffer")[0]);var v=this.sidebar=c.getElementsByClassName("wed-sidebar")[0];this.validationProgress=c.getElementsByClassName("wed-validation-progress")[0],this.validationMessage=this.validationProgress.previousElementSibling;var g=c.getElementsByClassName("root-here")[0];if(null!==this.widget.firstChild){if(!(this.widget.firstChild instanceof this.window.Element))throw new Error("the data is populated with DOM elements constructed from another window");g.parentNode.insertBefore(this.widget.firstChild,g)}g.parentNode.removeChild(g),this.widget.appendChild(c),this.caretOwners=d.getElementsByClassName("_owns_caret"),this.clickedLabels=d.getElementsByClassName("_label_clicked"),this.withCaret=d.getElementsByClassName("_with_caret"),this.$modificationStatus=n(v.getElementsByClassName("wed-modification-status")[0]),this.$saveStatus=n(v.getElementsByClassName("wed-save-status")[0]),this.$navigationPanel=n(v.getElementsByClassName("wed-navigation-panel")[0]),this.$navigationPanel.css("display","none"),this.$navigationList=n(a.getElementById("navlist")),this.$errorList=n(a.getElementById("sb-errorlist")),this.$excludedFromBlur=n(),this.errorItemHandlerBound=this.errorItemHandler.bind(this),this._undo=new q.UndoList,this.complexPatternAction=new te(this,"Complex name pattern",void 0,_.makeHTML("exclamation"),!0),this.pasteTr=new V.Transformation(this,"add","Paste",this.paste.bind(this)),this.cutTr=new V.Transformation(this,"delete","Cut",this.cut.bind(this)),this.replaceRangeTr=new V.Transformation(this,"transform","Replace Range",this.replaceRange.bind(this)),this.splitNodeTr=new V.Transformation(this,"split","Split <name>",function(e,t){V.splitNode(e,t.node)}),this.mergeWithPreviousHomogeneousSiblingTr=new V.Transformation(this,"merge-with-previous","Merge <name> with previous",function(e,t){V.mergeWithPreviousHomogeneousSibling(e,t.node)}),this.mergeWithNextHomogeneousSiblingTr=new V.Transformation(this,"merge-with-next","Merge <name> with next",function(e,t){V.mergeWithNextHomogeneousSibling(e,t.node)}),this.removeMarkupTr=new V.Transformation(this,"delete","Remove mixed-content markup","Remove mixed-content markup","<i class='fa fa-eraser'></i>",!0,V.removeMarkup),h.addButton([this.saveAction.makeButton(),this.undoAction.makeButton(),this.redoAction.makeButton(),this.decreaseLabelVisibilityLevelAction.makeButton(),this.increaseLabelVisibilityLevelAction.makeButton(),this.removeMarkupTr.makeButton(),this.toggleAttributeHidingAction.makeButton()]),n(this.window).on("unload.wed",{editor:this},function(e){e.data.editor.destroy()}),n(this.window).on("popstate.wed",function(){""===document.location.hash&&(o.guiRoot.scrollTop=0);
})}return Object.defineProperty(e.prototype,"undoEvents",{get:function(){return this._undo.events},enumerable:!0,configurable:!0}),e.prototype.fireTransformation=function(e,t){this.editingMenuManager.dismiss();var r=this._undo.getGroup();r instanceof Y.TextUndoGroup&&this._undo.endGroup();var n=new Y.UndoGroup("Undo "+e.getDescriptionFor(t),this);this._undo.startGroup(n),this.caretManager.mark.suspend(),this.enterTaskSuspension();try{try{this._fireTransformation(e,t)}catch(e){throw e instanceof v.AbortTransformationException||I.handle(e),e}finally{do r=this._undo.getGroup(),this._undo.endGroup();while(r!==n)}}catch(e){if(this.undo(),!(e instanceof v.AbortTransformationException))throw e}finally{this.caretManager.mark.resume(),this.exitTaskSuspension(),this.validationController.refreshErrors()}},e.prototype._fireTransformation=function(e,t){var r=t.node;if(void 0!==r)if(this.guiRoot.contains(r)){var n=this.toDataNode(r);t.node=null===n?void 0:n}else if(!p.contains(this.dataRoot,r))throw new Error("node is neither in the gui tree nor the data tree");var o=t.moveCaretTo;if(void 0!==o&&this.caretManager.setCaret(o),void 0===this.caretManager.caret)throw new Error("transformation applied with undefined caret.");this._transformations.next({name:"StartTransformation",transformation:e}),e.handler(this,t),this._transformations.next({name:"EndTransformation",transformation:e})},e.prototype.enterTaskSuspension=function(){0===this.taskSuspension&&this.stopAllTasks(),this.taskSuspension++},e.prototype.exitTaskSuspension=function(){if(this.taskSuspension--,this.taskSuspension<0)throw new Error("exitTaskSuspension underflow");0===this.taskSuspension&&this.resumeAllTasks()},e.prototype.stopAllTasks=function(){for(var e=0,t=this.taskRunners;e<t.length;e++){var r=t[e];r.stop()}this.validationController.stop()},e.prototype.resumeAllTasks=function(){for(var e=0,t=this.taskRunners;e<t.length;e++){var r=t[e];r.resume()}this.validationController.resume()},e.prototype.resumeTaskWhenPossible=function(e){0===this.taskSuspension&&e.resume()},e.prototype.recordUndo=function(e){this._undo.record(e)},e.prototype.undoAll=function(){for(;this._undo.canUndo();)this.undo()},e.prototype.undo=function(){this.caretManager.mark.suspend(),this.enterTaskSuspension(),this.undoRecorder.suppressRecording(!0),this._undo.undo(),this.undoRecorder.suppressRecording(!1),this.caretManager.mark.resume(),this.exitTaskSuspension()},e.prototype.redo=function(){this.caretManager.mark.suspend(),this.enterTaskSuspension(),this.undoRecorder.suppressRecording(!0),this._undo.redo(),this.undoRecorder.suppressRecording(!1),this.caretManager.mark.resume(),this.exitTaskSuspension()},e.prototype.dumpUndo=function(){console.log(this._undo.toString())},e.prototype.undoingOrRedoing=function(){return this._undo.undoingOrRedoing()},e.prototype.isAttrProtected=function(e,t){var r;if("string"==typeof e){if(r=e,void 0===t)throw new Error("must specify a parent")}else if(h.isAttr(e))r=e.name;else{if(!h.isElement(e))throw new Error("unexpected value for attr");r=p.siblingByClass(e,"_attribute_name").textContent}return"xmlns"===r||0===r.lastIndexOf("xmlns:",0)},e.prototype.save=function(){return this.saver.save()},e.prototype.initiateTextUndo=function(){var e=this._undo.getGroup();return void 0!==e&&e instanceof Y.TextUndoGroup||(e=new Y.TextUndoGroup("text",this,this._undo,this.textUndoMaxLength),this._undo.startGroup(e)),e},e.prototype.terminateTextUndo=function(){var e=this._undo.getGroup();e instanceof Y.TextUndoGroup&&this._undo.endGroup()},e.prototype.normalizeEnteredText=function(e){return this.normalizeEnteredSpaces?e.replace(this.strippedSpaces,"").replace(this.replacedSpaces," "):e},e.prototype.compensateForAdjacentSpaces=function(e,t){if(!this.normalizeEnteredSpaces)return e;var r=t.toArray();return" "===e[0]&&" "===p.getCharacterImmediatelyBefore(r)&&(e=e.slice(1)),e.length>0&&" "===e[e.length-1]&&" "===p.getCharacterImmediatelyAt(r)&&(e=e.slice(-1)),e},e.prototype.insertText=function(e){if(this.closeAllTooltips(),e=this.normalizeEnteredText(e),""!==e){var t=this.caretManager,r=t.caret;if(void 0!==r){var n=f.closestByClass(r.node,"_real",this.guiRoot);if(null!==n&&!n.classList.contains("_readonly")){this.enterTaskSuspension();try{var o=f.closestByClass(r.node,"_attribute_value",this.guiRoot);if(null===o){if(r=t.getDataCaret(),e=this.compensateForAdjacentSpaces(e,r),""===e)return;var i=this.initiateTextUndo(),a=this.dataUpdater.insertText(r,e).caret;t.setCaret(a,{textEdit:!0}),i.recordCaretAfter()}else this.spliceAttribute(o,r.offset,0,e)}finally{this.exitTaskSuspension(),this.validationController.refreshErrors()}}}}},e.prototype.spliceAttribute=function(e,t,r,o){if(!(t<0||this.isAttrProtected(e))){var i=this.toDataNode(e).value;if(!(t>i.length||t===i.length&&r>0)){this.normalizeEnteredSpaces&&(" "===o[0]&&" "===i[t-1]&&(o=o.slice(1))," "===o[o.length-1]&&" "===i[t+r]&&(o=o.slice(-1)));var a=this.initiateTextUndo();i=i.slice(0,t)+o+i.slice(t+r),t+=o.length;var s=n.data(f.closestByClass(e,"_real"),"wed_mirror_node"),l=this.nodeToPath(e),u=p.siblingByClass(e,"_attribute_name").textContent,c=this.modeTree.getMode(e),d=c.getAbsoluteResolver().resolveName(u,!0);if(void 0===d)throw new Error("cannot resolve "+u);this.dataUpdater.setAttributeNS(s,d.ns,d.name,i);var h;try{h=this.pathToNode(l),null!==h.firstChild&&(h=h.firstChild)}catch(e){if(!(e instanceof A.AttributeNotFound))throw e}null==h&&(h=s,t=0),this.caretManager.setCaret(h,t,{textEdit:!0}),a.recordCaretAfter()}}},e.prototype.insertTransientPlaceholderAt=function(e){var t=n("<span class='_placeholder _transient' contenteditable='false'> </span>",e.node.ownerDocument)[0];return this.guiUpdater.insertNodeAt(e,t),t},e.prototype.toDataNode=function(e){if(h.isElement(e)){var t=n.data(e,"wed_mirror_node");if(null!=t)return t}return this.dataUpdater.pathToNode(this.nodeToPath(e))},e.prototype.fromDataNode=function(e){if(h.isElement(e)){var t=n.data(e,"wed_mirror_node");if(null!=t)return t}return this.pathToNode(this.dataUpdater.nodeToPath(e))},e.prototype.onSaverSaved=function(){C.notify("Saved",{type:"success"}),this.refreshSaveStatus()},e.prototype.onSaverAutosaved=function(){C.notify("Autosaved",{type:"success"}),this.refreshSaveStatus()},e.prototype.onSaverChanged=function(){this.refreshSaveStatus()},e.prototype.onSaverFailed=function(e){var t=this;this.refreshSaveStatus();var r=e.error;"too_old"===r.type?this.modals.getModal("tooOld").modal(this.window.location.reload.bind(this.window.location)):"save_disconnected"===r.type?this.modals.getModal("disconnect").modal(function(){t.save()}):"save_edited"===r.type?this.modals.getModal("editedByOther").modal(function(){t.window.location.reload()}):C.notify("Failed to save!\n"+r.msg,{type:"danger"})},e.prototype.nodeToPath=function(e){return this.guiDLocRoot.nodeToPath(e)},e.prototype.pathToNode=function(e){return this.guiDLocRoot.pathToNode(e)},e.prototype.getModeData=function(e){return this.modeData[e]},e.prototype.setModeData=function(e,t){this.modeData[e]=t},e.prototype.destroy=function(){if(this.destroying=!0,!this.destroyed){var e=L.editors.indexOf(this);e>=0&&L.editors.splice(e,1),void 0!==this.saver&&this.saver.setAutosaveInterval(0),void 0!==this.saveStatusInterval&&clearInterval(this.saveStatusInterval);try{void 0!==this.validationController&&this.validationController.terminate()}catch(e){I.unhandled(e)}if(void 0!==this.taskRunners)for(var t=0,r=this.taskRunners;t<r.length;t++){var o=r[t];try{o.stop()}catch(e){I.unhandled(e)}}try{void 0!==this.domlistener&&(this.domlistener.stopListening(),this.domlistener.clearPending())}catch(e){I.unhandled(e)}void 0!==this.editingMenuManager&&this.editingMenuManager.dismiss();try{this.$widget.empty(),this.$frame.find("*").off(".wed"),n(this.window).off(".wed")}catch(e){I.unhandled(e)}for(var i=0,a=Object.keys(this);i<a.length;i++){var s=a[i];delete this[s]}void 0!==this.appender&&I.removeAppender(this.appender),this.destroyed=!0,this.destroy=function(){}}},e.prototype.init=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,o=this;return __generator(this,function(i){switch(i.label){case 0:return t=new this.window.DOMParser,void 0!==e&&""!==e?(this.dataRoot=t.parseFromString(e,"text/xml"),this._dataChild=this.dataRoot.firstChild):(this.dataRoot=t.parseFromString("<div></div>","text/xml"),this._dataChild=void 0),this.dataRoot.removeChild(this.dataRoot.firstChild),this.$dataRoot=n(this.dataRoot),this.guiDLocRoot=new A.GUIRoot(this.guiRoot),this.dataDLocRoot=new c.DLocRoot(this.dataRoot),this.dataUpdater=new W.TreeUpdater(this.dataRoot),this.guiUpdater=new g.GUIUpdater(this.guiRoot,this.dataUpdater),this.undoRecorder=new z.UndoRecorder(this,this.dataUpdater),this.guiUpdater.events.subscribe(function(e){switch(e.name){case"BeforeInsertNodeAt":h.isElement(e.node)&&o.initialContentEditableHandler(e);break;case"InsertNodeAt":h.isElement(e.node)&&o.finalContentEditableHandler(e)}}),r=document.getElementsByClassName("wed-has-tooltip"),this.guiUpdater.events.subscribe(function(e){if("BeforeDeleteNode"===e.name){var t=e.node;if(t.nodeType!==Node.TEXT_NODE)for(var o=0,i=Array.from(r);o<i.length;o++){var a=i[o];if(t.contains(a)){var s=n.data(a,"bs.tooltip");null!=s&&s.destroy()}}}}),this.domlistener=new d.DOMListener(this.guiRoot,this.guiUpdater),this.modeTree=new D.ModeTree(this,this.options.mode),[4,this.modeTree.init()];case 1:return i.sent(),[2,this.onModeChange(this.modeTree.getMode(this.guiRoot))]}})})},e.prototype.onModeChange=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,o,i,s,l,c;return __generator(this,function(d){switch(d.label){case 0:if(this.destroyed)return[2,this];for(this.maxLabelLevel=this.modeTree.getMaxLabelLevel(),this.initialLabelLevel=this.modeTree.getInitialLabelLevel(),this.currentLabelLevel=this.initialLabelLevel,t=this.modeTree.getStylesheets(),r=this.$frame.children("head"),n=0,o=t;n<o.length;n++)i=o[n],r.append('<link rel="stylesheet" href="'+i+'" type="text/css" />');return this.guiRoot.setAttribute("tabindex","-1"),this.$guiRoot.focus(),this.caretManager=new u.CaretManager(this.guiDLocRoot,this.dataDLocRoot,this.inputField,this.guiUpdater,this.caretLayer,this.scroller,this.modeTree),this.editingMenuManager=new b.EditingMenuManager(this),this.caretManager.events.subscribe(this.caretChange.bind(this)),this.resizeHandler(),l=this.options.schema,l instanceof a.Grammar?(s=l,[3,4]):[3,1];case 1:return"string"!=typeof l?[3,3]:[4,this.runtime.resolveToString(l)];case 2:return c=d.sent(),s=a.constructTree(c),[3,4];case 3:throw new Error("unexpected value for schema");case 4:return this.validator=new X.Validator(s,this.dataRoot,this.modeTree.getValidators()),this.validator.events.addEventListener("state-update",this.onValidatorStateChange.bind(this)),this.validator.events.addEventListener("possible-due-to-wildcard-change",this.onPossibleDueToWildcardChange.bind(this)),this.validationController=new G.ValidationController(this,this.validator,e.getAbsoluteResolver(),this.scroller,this.guiRoot,this.validationProgress,this.validationMessage,this.errorLayer,this.$errorList[0],this.errorItemHandlerBound),[2,this.postInitialize()]}})})},e.prototype.postInitialize=function(){return __awaiter(this,void 0,void 0,function(){var e,r,i,a,s,l,u,c,d,m=this;return __generator(this,function(v){switch(v.label){case 0:return this.destroyed?[2,this]:(this.domlistener.addHandler("children-changed","._real, ._phantom_wrap, .wed-document",function(e,t,r,n,o,i){for(var a=0,s=t.concat(r);a<s.length;a++){var l=s[a];if(h.isText(l)||h.isElement(l)&&(l.classList.contains("_real")||l.classList.contains("_phantom_wrap"))){m.validator.resetTo(i);break}}}),this.domlistener.addHandler("attribute-changed","._real",function(e,t,r,n){""===r&&0===n.indexOf("data-wed",0)&&setTimeout(function(){m.destroyed||m.validator.resetTo(t)},0)}),this.modeTree.addDecoratorHandlers(),this.domlistener.addHandler("included-element","._label",function(e,t,r,n,o,i){for(var a,s=i.classList,l=0;l<s.length&&void 0===a;++l)0===s[l].lastIndexOf("_label_level_",0)&&(a=Number(s[l].slice(13)));if(void 0===a)throw new Error("unable to get level");a>m.currentLabelLevel&&s.add("_invisible")}),this.domlistener.addHandler("children-changed","._real, ._phantom_wrap, .wed-document",function(e,t,r,n,o,i){if(0===m.updatingPlaceholder){m.updatingPlaceholder++;for(var a,s=[],l=i.firstChild;null!==l;)(h.isText(l)||h.isElement(l)&&(l.classList.contains("_real")||l.classList.contains("_phantom_wrap")||l.classList.contains("_text")))&&s.push(l),h.isElement(l)&&l.classList.contains("_placeholder")&&(a=l),l=l.nextSibling;var u=m.caretManager;if(0===s.length||1===s.length&&r.indexOf(s[0])!==-1){if(void 0===a){var c=m.modeTree.getMode(i),d=c.nodesAroundEditableContents(i);if(i===m.guiRoot){var p=u.makeCaret(m.guiRoot,0);a=m.insertTransientPlaceholderAt(p),u.setCaret(p,{textEdit:!0})}else a=c.makePlaceholderFor(i),m.guiUpdater.insertBefore(i,a,d[1])}}else if(void 0!==a&&!a.classList.contains("_transient")){var v,g=void 0!==u.caret?u.caret.node:void 0,y=void 0!==g&&a.contains(g),b=void 0;y&&(v=a.parentNode,b=f.indexOf(v.childNodes,a)),m.guiUpdater.removeNode(a),y&&u.setCaret(v,b,{textEdit:!0})}m.updatingPlaceholder--}}),e=function(e){if(0===m.updatingPlaceholder){m.updatingPlaceholder++;var t=m.toDataNode(e),r=p.childByClass(e,"_placeholder");""!==t.value?null!==r&&e.removeChild(r):null===r&&m.guiUpdater.insertBefore(e,p.makePlaceholder(),null),m.updatingPlaceholder--}},this.domlistener.addHandler("children-changed","._attribute_value",function(t,r,n,o,i,a){e(a)}),this.domlistener.addHandler("included-element","._attribute_value",function(t,r,n,o,i,a){e(a)}),this.modeTree.startListening(),void 0!==this._dataChild&&this.dataUpdater.insertAt(this.dataRoot,0,this._dataChild),r=this.$guiRoot,r.on("dragenter","*",!1),r.on("dragstart","*",!1),r.on("dragover","*",!1),r.on("drop","*",!1),r.on("wed-global-keydown",this.globalKeydownHandler.bind(this)),r.on("wed-global-keypress",this.globalKeypressHandler.bind(this)),r.on("keydown",this.keydownHandler.bind(this)),r.on("keypress",this.keypressHandler.bind(this)),this.$inputField.on("keydown",this.keydownHandler.bind(this)),this.$inputField.on("keypress",this.keypressHandler.bind(this)),this.$inputField.on("compositionstart compositionupdate compositionend",this.compositionHandler.bind(this)),this.$inputField.on("input",this.inputHandler.bind(this)),r.on("mousedown",this.mousedownHandler.bind(this)),r.on("mouseover",this.mouseoverHandler.bind(this)),r.on("mouseout",this.mouseoutHandler.bind(this)),r.on("contextmenu",this.mouseupHandler.bind(this)),r.on("paste",I.wrap(this.pasteHandler.bind(this))),this.$inputField.on("paste",I.wrap(this.pasteHandler.bind(this))),r.on("cut",I.wrap(this.cutHandler.bind(this))),n(this.window).on("resize.wed",this.resizeHandler.bind(this)),r.on("click","a",function(e){return e.ctrlKey&&(window.location.href=e.currentTarget.href),!1}),i=n(this.doc.body),i.on("mouseup.wed",function(){m.$guiRoot.off("mousemove.wed mouseup")}),i.on("contextmenu.wed",function(e){return!m.guiRoot.contains(e.target)}),i.on("click.wed",function(e){if(!(void 0===e.pageX||e.pageX<0||void 0===e.pageY||e.pageY<0||e.screenX===e.screenY&&0===e.screenX||m.widget.contains(e.target))){var t=m.doc.elementFromPoint(e.clientX,e.clientY);if(0===n(t).closest(m.$excludedFromBlur).length){var r=m.$guiRoot.offset(),o=e.pageX-r.left,i=e.pageY-r.top;o>=0&&i>=0&&o<m.$guiRoot.outerWidth()&&i<m.$guiRoot.outerHeight()||m.caretManager.onBlur()}}}),this.$widget.removeClass("loading"),this.$widget.css("display","block"),a=this.initializeNamespaces(),void 0!==a?(s=this.modals.getModal("limitation"),s.setBody(a),s.modal(),this.destroy(),[2,this]):(this.domlistener.processImmediately(),this._undo.reset(),r.focus(),this.validator.start(),l=this.options.demo,void 0!==l&&("string"!=typeof l&&(l="Some functions may not be available."),u=this.makeModal(),u.setTitle("Demo"),u.setBody("<p>This is a demo of wed. "+l+"</p> <p>Click <a href='"+this.docURL+"' target='_blank'>this link</a> to see wed's generic help. The link by default will open in a new tab.</p>"),u.addButton("Ok",!0),u.modal()),c=this.options.save,d=void 0!==c?this.runtime.resolveModules(c.path).then(function(e){var r=e[0].Saver,n=void 0!==c.options?c.options:{},i=new r(m.runtime,t.version,m.dataUpdater,m.dataRoot,n);return m.saver=i,i.events.pipe(o.filter(Z.bind(void 0,"Saved"))).subscribe(m.onSaverSaved.bind(m)),i.events.pipe(o.filter(Z.bind(void 0,"Autosaved"))).subscribe(m.onSaverAutosaved.bind(m)),i.events.pipe(o.filter(Z.bind(void 0,"Failed"))).subscribe(m.onSaverFailed.bind(m)),i.events.pipe(o.filter(Z.bind(void 0,"Changed"))).subscribe(m.onSaverChanged.bind(m)),m.refreshSaveStatus(),m.saveStatusInterval=setInterval(m.refreshSaveStatus.bind(m),3e4),M.install(m.window,function(){return!m.destroyed&&m.saver.getModifiedWhen()!==!1},!0),i.init()}):Promise.resolve().then(function(){I.error("wed cannot save data due to the absence of a save option")}),[4,d]));case 1:return v.sent(),this.initializedResolve(this),[2,this]}})})},e.prototype.initialContentEditableHandler=function(e){var t=function(e){e.setAttribute("tabindex","-1"),e.setAttribute("contenteditable",String(e.classList.contains("_real")||e.classList.contains("_attribute_value")));for(var r=e.firstElementChild;null!==r;)t(r),r=r.nextElementSibling};t(e.node)},e.prototype.finalContentEditableHandler=function(e){for(var t=e.node,r=t.getElementsByClassName("_attribute_value"),n=0,o=Array.from(r);n<o.length;n++){var i=o[n];"edit"!==this.modeTree.getAttributeHandling(i)&&i.setAttribute("contenteditable","false")}},e.prototype.initializeNamespaces=function(){var e,t=this.modeTree.getMode(this.guiRoot),r=t.getAbsoluteResolver();if(null===this.dataRoot.firstChild){var n=Object.create(null);if(this.validator.getSchemaNamespaces().forEach(function(t){if("*"!==t&&"::except"!==t){var o=r.prefixFromURI(t);"xml"!==o&&(""===o?n.xmlns=t:(void 0===o&&(e="The mode does not allow determining the namespace prefix for "+t+". The most likely issue is that the mode is buggy or wed was started with incorrect options."),n["xmlns:"+o]=t))}}),void 0!==e)return e;var o=this.validator.possibleAt(this.dataRoot,0).toArray();if(1===o.length&&"enterStartTag"===o[0].params[0]){var i=o[0].params[1],a=i.toArray();if(null!==a&&1===a.length){var s=a[0];V.insertElement(this.dataUpdater,this.dataRoot,0,s.ns,r.unresolveName(s.ns,s.name),n),this.caretManager.setCaret(this.dataRoot.firstElementChild,0)}}if(null===this.dataRoot.firstChild){var l=this.insertTransientPlaceholderAt(this.caretManager.makeCaret(this.guiRoot,0));this.caretManager.setCaret(l,0)}}else{var u=this.validator.getDocumentNamespaces();Object.keys(u).forEach(function(t){var n=u[t];n.length>1&&(e="The document you are trying to edit uses namespaces in a way not supported by this version of wed."),r.definePrefix(t,n[0])})}return e},e.prototype.addToolbarAction=function(e,t){this.toolbar.addButton(new e(this).makeButton(),t)},e.prototype.newTaskRunner=function(e){var t=new U.TaskRunner(e);return this.taskRunners.push(t),t},e.prototype.resize=function(){this.resizeHandler()},e.prototype.resizeHandler=function(){function e(e){t+=e.getBoundingClientRect().height}for(var t=0,r=this.constrainer.nextElementSibling;null!==r;)e(r),r=r.nextElementSibling;for(var o=this.widget;h.isElement(o);){for(var i=o.nextElementSibling;null!==i;)"script"!==i.tagName&&e(i),i=i.nextElementSibling;o=o.parentNode}var a=this.window.innerHeight-(this.scroller.getBoundingClientRect().top+this.window.pageYOffset)-t;a=Math.floor(a),this.scroller.coerceHeight(a);var s=this.sidebar,l=this.window.innerHeight-(s.getBoundingClientRect().top+this.window.pageYOffset)-t;s.style.maxHeight=l+"px",s.style.minHeight=l+"px";var u=s.getElementsByClassName("wed-sidebar-panel")[0];l=this.window.innerHeight-(u.getBoundingClientRect().top+this.window.pageYOffset)-t,u.style.maxHeight=l+"px",u.style.minHeight=l+"px";for(var c=u.getElementsByClassName("panel"),d=u.getElementsByClassName("panel-heading"),f=0,m=0;m<d.length;++m){var v=d[m],g=n(v.parentNode);f+=g.outerHeight(!0)-g.innerHeight(),f+=n(v).outerHeight(!0)}for(var y,b=l-f,m=0;m<c.length;++m){y=c[m],y.style.maxHeight=b+n(p.childByClass(y,"panel-heading")).outerHeight(!0)+"px";var w=y.getElementsByClassName("panel-body")[0];w.style.height=b+"px"}void 0!==this.validationController&&this.validationController.refreshErrors(),this.caretManager.mark.refresh()},e.prototype.openDocumentationLink=function(e){window.open(e)},e.prototype.getElementTransformationsAt=function(e,t){var r=this,n=this.modeTree.getMode(e.node),o=n.getAbsoluteResolver(),i=[];return this.validator.possibleAt(e).forEach(function(a){if("enterStartTag"===a.params[0]){var s=a.params[1],l=s.toArray();if(null!==l)for(var u=0,c=l;u<c.length;u++){var d=c[u],h=o.unresolveName(d.ns,d.name),p=n.getContextualActions(t,h,e.node,e.offset);if(void 0===p)return;for(var f=0,m=p;f<m.length;f++){var v=m[f];i.push({tr:v,name:h})}}else i.push({tr:r.complexPatternAction,name:void 0})}}),i},e.prototype.cutHandler=function(e){if(void 0===this.caretManager.getDataCaret())return!1;var t=this.caretManager.sel;if(t.wellFormed){var r=f.closestByClass(t.anchor.node,"_real",this.guiRoot);return null!==r&&!r.classList.contains("_readonly")&&(this.fireTransformation(this.cutTr,{e:e}),!0)}return this.modals.getModal("straddling").modal(),!1},e.prototype.pasteHandler=function(e){var t=this,r=this.caretManager.getDataCaret();if(void 0===r)return!1;var n=f.closestByClass(this.caretManager.anchor.node,"_real",this.guiRoot);if(null===n||n.classList.contains("_readonly"))return!1;var o=e.originalEvent.clipboardData||this.window.clipboardData,i=o.getData("text");if(null==i||""===i)return!1;if(i=this.normalizeEnteredText(i),""===i)return!1;var a=new this.window.DOMParser,s=a.parseFromString("<div>"+i+"</div>","text/xml"),l=!0;h.isElement(s.firstChild)&&"parsererror"===s.firstChild.tagName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"===s.firstChild.namespaceURI&&(l=!1);var u;if(l){u=s.firstChild;var c=this.validator.speculativelyValidate(r,Array.prototype.slice.call(u.childNodes));if(c){var d=this.modals.getModal("paste");return d.modal(function(){"Yes"===d.getClickedAsText()&&(u=t.doc.createElement("div"),u.textContent=i,t.fireTransformation(t.pasteTr,{node:r.node,to_paste:u,e:e}))}),!1}}else u=this.doc.createElement("div"),u.textContent=i;return this.fireTransformation(this.pasteTr,{node:r.node,to_paste:u,e:e}),!1},e.prototype.keydownHandler=function(e){var t=this.caretManager.getNormalizedCaret();void 0!==t&&this.$guiRoot.trigger("wed-input-trigger-keydown",[e]),e.isImmediatePropagationStopped()||e.isPropagationStopped()||this.$guiRoot.trigger("wed-global-keydown",[e])},e.prototype.pushGlobalKeydownHandler=function(e){this.globalKeydownHandlers.push(e)},e.prototype.popGlobalKeydownHandler=function(e){var t=this.globalKeydownHandlers.pop();if(t!==e)throw new Error("did not pop the expected handler")},e.prototype.globalKeydownHandler=function(e,t){function r(){return t.stopPropagation(),t.preventDefault(),!1}var o;if(17===t.which||16===t.which||18===t.which||0===t.which)return!0;if(this.minibuffer.enabled)return!0;for(var i=0,a=this.globalKeydownHandlers;i<a.length;i++){var s=a[i],l=s(e,t);if(l===!1)return r()}if(112===t.which)return this.modals.getModal("help").modal(),r();if(this.developmentMode){if(113===t.which)return this.caretManager.dumpCaretInfo(),r();if(114===t.which)return this.dumpUndo(),r();if(115===t.which)return console.log("manual focus"),console.log("document.activeElement before",document.activeElement),console.log('document.querySelector(":focus") before',document.querySelector(":focus")),this.caretManager.focusInputField(),console.log("document.activeElement after",document.activeElement),console.log('document.querySelector(":focus") after',document.querySelector(":focus")),r()}var u=this.caretManager.caret;if(t.which>=33&&t.which<=40){var c=void 0;return R.RIGHT_ARROW.matchesEvent(t)?c="right":R.LEFT_ARROW.matchesEvent(t)?c="left":R.DOWN_ARROW.matchesEvent(t)?c="down":R.UP_ARROW.matchesEvent(t)&&(c="up"),void 0===c||(this.caretManager.move(c,t.shiftKey),r())}if(R.ESCAPE.matchesEvent(t))return!this.closeAllTooltips()||r();if(R.SAVE.matchesEvent(t))return this.save(),r();if(R.UNDO.matchesEvent(t))return this.undo(),r();if(R.REDO.matchesEvent(t))return this.redo(),r();if(R.COPY.matchesEvent(t)||R.CUT.matchesEvent(t)||R.PASTE.matchesEvent(t))return!0;if(R.DEVELOPMENT.matchesEvent(t))return this.developmentMode=!this.developmentMode,C.notify(this.developmentMode?"Development mode on.":"Development mode off."),this.developmentMode&&I.showPopup(),r();if(R.LOWER_LABEL_VISIBILITY.matchesEvent(t))return this.decreaseLabelVisibilityLevelAction.terminalEventHandler(t);if(R.INCREASE_LABEL_VISIBILITY.matchesEvent(t))return this.increaseLabelVisibilityLevelAction.terminalEventHandler(t);if(R.CONTEXTUAL_MENU.matchesEvent(t)){if(void 0!==u){var d=u.node,m=f.closestByClass(d,"_gui",u.root);if(null!==m&&m.classList.contains("_label_clicked"))return h.isText(d)&&(d=d.parentNode),n(d).trigger("wed-context-menu",[t]),r()}if(this.editingMenuManager.contextMenuHandler(t)===!1)return r()}else{if(R.REPLACEMENT_MENU.matchesEvent(t))return this.editingMenuManager.setupReplacementMenu(),r();if(R.QUICKSEARCH_FORWARD.matchesEvent(t))return void 0!==this.caretManager.caret&&new S.QuickSearch(this,this.scroller,S.Direction.FORWARD),r();if(R.QUICKSEARCH_BACKWARDS.matchesEvent(t))return void 0!==this.caretManager.caret&&new S.QuickSearch(this,this.scroller,S.Direction.BACKWARDS),r();if(R.SEARCH_FORWARD.matchesEvent(t))return void 0!==this.caretManager.caret&&new y.DialogSearchReplace(this,this.scroller,S.Direction.FORWARD),r();if(R.SEARCH_BACKWARDS.matchesEvent(t))return void 0!==this.caretManager.caret&&new y.DialogSearchReplace(this,this.scroller,S.Direction.BACKWARDS),r()}if(void 0===u)return!0;var v=f.closestByClass(u.node,"_placeholder",u.root);if(null!==v){if(o=this.caretManager.getDataCaret(),!K.anySpecialKeyHeld(t)){var g=!1;if(v.parentNode.classList.contains("_attribute_value")?g=!0:this.validator.possibleAt(o).forEach(function(e){"text"===e.params[0]&&(g=!0)}),!g)return r()}if(R.BACKSPACE.matchesEvent(t)||R.DELETE.matchesEvent(t))return r()}var b=f.closestByClass(u.node,"_attribute_value",u.root),w=this.guiRoot.querySelector(".__start_label._label_clicked, .__end_label._label_clicked");if(null===b&&null!==w&&R.DELETE.matchesEvent(t)){var _=f.closestByClass(w,"_real",this.guiRoot),E=this.dataUpdater.pathToNode(this.nodeToPath(_)),x=this.modeTree.getMode(_),N=x.getContextualActions("delete-parent",E.tagName,E,0);return N[0].execute({node:E,name:E.tagName}),r()}if(h.isElement(u.node)&&(u.node.classList.contains("_phantom")||u.node.classList.contains("_phantom_wrap")))return r();var P,k,T;if(R.SPACE.matchesEvent(t))return o=this.caretManager.getNormalizedCaret(),void 0===o?r():(null===b&&null!==f.closestByClass(o.node,"_phantom",o.root)||this.handleKeyInsertingText(t),r());if(R.DELETE.matchesEvent(t)){if(null!==b){if(""===b.textContent)return r();this.spliceAttribute(b,this.caretManager.getNormalizedCaret().offset,1,"")}else{var A=p.nextCaretPosition(u.toArray(),this.guiRoot,!0)[0];if(!h.isElement(A)||!A.classList.contains("_phantom")&&!A.classList.contains("_phantom_wrap")){if(this.cutSelection())return this.validationController.refreshErrors(),r();o=this.caretManager.getDataCaret(),h.isText(o.node)||(o=o.make(o.node.childNodes[o.offset],0)),h.isText(o.node)&&(k=o.node.parentNode,T=f.indexOf(k.childNodes,o.node),P=this.initiateTextUndo(),this.dataUpdater.deleteText(o,1),null!==o.node.parentNode?this.caretManager.setCaret(o,{textEdit:!0}):this.caretManager.setCaret(k,T,{textEdit:!0}),P.recordCaretAfter())}}return this.validationController.refreshErrors(),r()}if(R.BACKSPACE.matchesEvent(t)){if(null!==b){if(""===b.textContent)return r();this.spliceAttribute(b,this.caretManager.getNormalizedCaret().offset-1,1,"")}else{var O=p.prevCaretPosition(u.toArray(),this.guiRoot,!0)[0];if(!h.isElement(O)||!O.classList.contains("_phantom")&&!O.classList.contains("_phantom_wrap")){if(this.cutSelection())return this.validationController.refreshErrors(),r();if(o=this.caretManager.getDataCaret(),!h.isText(o.node)){var D=o.node.childNodes[o.offset-1],M=D.length;o=o.make(D,M)}if(h.isText(o.node)){if(k=o.node.parentNode,T=f.indexOf(k.childNodes,o.node),0===o.offset)return r();P=this.initiateTextUndo(),this.dataUpdater.deleteText(o.node,o.offset-1,1),null!==o.node.parentNode?this.caretManager.setCaret(o.node,o.offset-1,{textEdit:!0}):this.caretManager.setCaret(k,T,{textEdit:!0}),P.recordCaretAfter()}}}return this.validationController.refreshErrors(),r()}return!0},e.prototype.keypressHandler=function(e){return!!ee.matchesEvent(e)||(this.$guiRoot.trigger("wed-input-trigger-keypress",[e]),!(!e.isImmediatePropagationStopped()&&!e.isPropagationStopped())||void this.$guiRoot.trigger("wed-global-keypress",[e]))},e.prototype.type=function(e,t){void 0===t&&(t=J.DEFAULT),e instanceof O.Key&&(e=[e]);for(var r=0,o=e;r<o.length;r++){var i=o[r];"string"==typeof i&&(i=" "===i?R.SPACE:O.makeKey(i));var a=new n.Event("keydown");switch(i.setEventToMatch(a),t){case J.MINIBUFFER:this.minibuffer.forwardEvent(a);break;case J.DEFAULT:this.$inputField.trigger(a);break;default:var s=t;throw new Error("unhandled target: "+s)}}},e.prototype.globalKeypressHandler=function(e,t){function r(){return t.preventDefault(),t.stopPropagation(),!1}return void 0===this.caretManager.caret||(0===t.which||(8===t.which?r():!!(t.ctrlKey||t.altKey||t.metaKey)||(this.cutSelection(),this.handleKeyInsertingText(t),r())))},e.prototype.cutSelection=function(){var e=this.caretManager.sel;if(void 0!==e&&!e.collapsed){if(!e.wellFormed)return!0;var t=this.initiateTextUndo(),r=e.mustAsDataCarets(),n=r[0],o=r[1],i=this.dataUpdater.cut(n,o)[0];return this.caretManager.setCaret(i,{textEdit:!0}),t.recordCaretAfter(),!0}return!1},e.prototype.handleKeyInsertingText=function(e){var t=String.fromCharCode(e.which);return""!==t&&(this.insertText(t),e.preventDefault(),void e.stopPropagation())},e.prototype.compositionHandler=function(e){if("compositionstart"===e.type)this.composing=!0,this.compositionData={data:e.originalEvent.data,startCaret:this.caretManager.caret},this.inputField.style.zIndex="10",this.caretManager.mark.refresh();else if("compositionupdate"===e.type)this.compositionData.data=e.originalEvent.data;else{if("compositionend"!==e.type)throw new Error("unexpected event type: "+e.type);this.composing=!1,this.inputField.style.zIndex="",this.inputField.style.top="",this.inputField.style.left=""}},e.prototype.inputHandler=function(){this.composing||""!==this.$inputField.val()&&(this.insertText(this.$inputField.val()),this.$inputField.val(""),this.caretManager.focusInputField())},e.prototype.mousemoveHandler=function(e){var t=this,r=this.doc.elementFromPoint(e.clientX,e.clientY);if(this.guiRoot.contains(r)){var n,o=function(e){var r=e.classList;return r.contains("_real")||r.contains("_attribute_value")&&"edit"===t.modeTree.getAttributeHandling(e)};if(o(r)){if(n=this.pointToCharBoundary(e.clientX,e.clientY),void 0===n)return}else{for(var i=r;!o(r);)if(i=r,r=i.parentNode,!this.guiRoot.contains(r))return;var a=f.indexOf(r.childNodes,i),s=this.doc.createRange();s.setStart(r,a),s.setEnd(r,a+1);var l=s.getBoundingClientRect();Math.abs(l.left-e.clientX)>=Math.abs(l.right-e.clientX)&&a++,n=this.caretManager.makeCaret(r,a)}this.caretManager.setRange(this.caretManager.anchor,n)}},e.prototype.mousedownHandler=function(e){if(!this.scroller.isPointInside(e.pageX,e.pageY))return!1;var t=this.pointToCharBoundary(e.clientX,e.clientY);if(void 0===t)return!0;this.$guiRoot.one("mouseup",this.mouseupHandler.bind(this)),this.errorLayer.unselectAll(),this.$errorList.find(".selected").removeClass("selected");var r=this.guiRoot,n=e.target,o=f.closestByClass(n,"_placeholder",r),i=f.closestByClass(n,"_label",r),a=this.caretManager;switch(e.which){case 1:if(null!==f.closest(n,"._gui, ._phantom",r)&&null===f.closestByClass(n,"_attribute_value",r)||this.$guiRoot.on("mousemove.wed",this.mousemoveHandler.bind(this)),
null!==o?a.setCaret(o,0):null!==i?a.setCaretToLabelPosition(n,i,t):a.setCaret(t),e.target.classList.contains("wed-validation-error"))return!0;break;case 3:var s=this.caretManager.range;(void 0===s||s.collapsed)&&(null!==o?a.setCaret(o,0):null!==i?a.setCaretToLabelPosition(n,i,t):a.setCaret(t))}return!1},e.prototype.mouseupHandler=function(e){if(!this.scroller.isPointInside(e.pageX,e.pageY))return!1;var t=this.pointToCharBoundary(e.clientX,e.clientY);if(void 0===t)return!0;"contextmenu"===e.type&&(e.which=3);var r=this.guiRoot,o=e.target,i=f.closestByClass(o,"_placeholder",r),a=f.closestByClass(o,"_label",r),s=this.caretManager;switch(e.which){case 3:null!==i&&s.setCaret(o,0),null!==a?(s.setCaretToLabelPosition(o,a,t),n(o).trigger("wed-context-menu",[e])):(void 0===s.caret&&s.setCaret(t),null!==f.closest(o,"*[data-wed--custom-context-menu]",r)?n(o).trigger("wed-context-menu",[e]):this.editingMenuManager.contextMenuHandler(e))}return this.$guiRoot.off("mousemove"),e.preventDefault(),!1},e.prototype.mouseoverHandler=function(e){var t=this,r=this.guiRoot,o=f.closestByClass(e.target,"_label",r);if(null!==o){var i=f.closestByClass(o,"_real",r),a=K.getOriginalName(i),s={title:function(){var e=t.modeTree.getMode(o);return e.shortDescriptionFor(a)},container:"body",delay:{show:1e3},placement:"auto top",trigger:"hover"};this.makeGUITreeTooltip(n(o),s);var l=n.data(o,"bs.tooltip");l.enter(l)}},e.prototype.mouseoutHandler=function(e){var t=this.guiRoot,r=f.closestByClass(e.target,"_label",t);if(null!==r)return n(r).tooltip("destroy"),!1},e.prototype.refreshSaveStatus=function(){if(void 0!==this.saver){var e=this.saver.getSavedWhen();if(this.$saveStatus.children("span").first().text(void 0!==e?e:""),void 0===e)this.$saveStatus.removeClass("label-success label-info").addClass("label-default");else{var t=this.saver.getLastSaveKind(),r=void 0,n=void 0;switch(t){case H.SaveKind.AUTO:r="label-info",n="The last save was an autosave.";break;case H.SaveKind.MANUAL:r="label-success",n="The last save was a manual save.";break;default:throw new Error("unexpected kind of save: "+t)}this.$saveStatus.removeClass("label-default label-info label-success").addClass(r),this.$saveStatus.tooltip("destroy"),this.$saveStatus.tooltip({title:n,container:"body",placement:"auto top",trigger:"hover"})}var o=this.saver.getModifiedWhen();o!==!1?(this.$modificationStatus.removeClass("label-success"),this.$modificationStatus.addClass("label-warning"),this.$modificationStatus.children("i").css("visibility","")):(this.$modificationStatus.removeClass("label-warning"),this.$modificationStatus.addClass("label-success"),this.$modificationStatus.children("i").css("visibility","hidden"))}},e.prototype.onValidatorStateChange=function(e){var t=e.state;t!==s.WorkingState.VALID&&t!==s.WorkingState.INVALID||this._firstValidationComplete||(this._firstValidationComplete=!0,this.firstValidationCompleteResolve(this))},e.prototype.onPossibleDueToWildcardChange=function(e){var t=Q.getGUINodeIfExists(this,e);if(h.isText(t)&&(t=f.closestByClass(t,"_attribute",this.guiRoot)),null!=t){var r=this.modeTree.getDecorator(e);r.setReadOnly(t,this.validator.getNodeProperty(e,"PossibleDueToWildcard"))}},e.prototype.expandErrorPanelWhenNoNavigation=function(){"none"===this.$navigationPanel[0].style.display&&this.$errorList.parents(".panel-collapse").collapse("show")},e.prototype.errorItemHandler=function(e){var t=document.querySelector(e.target.getAttribute("href"));this.errorLayer.select(t);var r=n(e.target.parentNode);r.siblings().removeClass("selected"),r.addClass("selected")},e.prototype.setNavigationList=function(e){this.$navigationList.empty(),this.$navigationList.append(e),this.$navigationPanel.css("display","")},e.prototype.makeModal=function(e){var t=this,r=new N.Modal(e),n=r.getTopLevel();return n.on("show.bs.modal.modal",function(){t.caretManager.pushSelection()}),n.on("hidden.bs.modal.modal",function(){t.caretManager.popSelection()}),this.$widget.prepend(n),r},e.prototype.makeGUITreeTooltip=function(e,t){var r=this,n=t.title;void 0!==n&&(t=Object.assign({},t),t.title=function(){if(!r.destroyed&&r.preferences.get("tooltips"))return"function"==typeof n?n():n}),T.tooltip(e,t)},e.prototype.resetLabelVisibilityLevel=function(){this.setLabelVisibilityLevel(this.initialLabelLevel)},e.prototype.setLabelVisibilityLevel=function(e){if(!(e<0||e>this.maxLabelLevel)){for(;this.currentLabelLevel>e;)this.decreaseLabelVisiblityLevel();for(;this.currentLabelLevel<e;)this.increaseLabelVisibilityLevel()}},e.prototype.increaseLabelVisibilityLevel=function(){if(!(this.currentLabelLevel>=this.maxLabelLevel)){this.currentLabelLevel++;for(var e=this.guiRoot.getElementsByClassName("_label_level_"+this.currentLabelLevel),t=0,r=e.length;t<r;t++)e[t].classList.remove("_invisible");this.validationController.recreateErrors(),this.caretManager.mark.refresh()}},e.prototype.decreaseLabelVisiblityLevel=function(){if(0!==this.currentLabelLevel){var e=this.currentLabelLevel;this.currentLabelLevel--;for(var t=this.guiRoot.getElementsByClassName("_label_level_"+e),r=0,n=t.length;r<n;r++)t[r].classList.add("_invisible");this.validationController.recreateErrors(),this.caretManager.mark.refresh()}},e.prototype.toggleAttributeHiding=function(){this.guiRoot.classList.toggle("inhibit_attribute_hiding")},e.prototype.closeAllTooltips=function(){for(var e=this.doc.querySelectorAll("div.tooltip"),t=!1,r=0;r<e.length;++r){var o=n.data(e[r],"wed-tooltip-for"),i=n(o).data("bs.tooltip");null!=i&&(i.leave(i),t=!0)}return t},e.prototype.excludeFromBlur=function(e){this.$excludedFromBlur.add(e)},e.prototype.findLocationAt=function(e,t){var r=this.doc.elementFromPoint(e,t);if(null!==r&&this.guiRoot.contains(r))return this.findLocationInElementAt(r,e,t)},e.prototype.findLocationInElementAt=function(e,t,r,n){function o(e,n){var o;h.isText(e)?(a.setStart(e,n),a.setEnd(e,n+1),o=a.getClientRects()):o=e.childNodes[n].getClientRects();for(var s=0;s<o.length;++s){var l=o[s];if(0!==l.height&&0!==l.width){var u=K.distsFromRect(t,r,l.left,l.top,l.right,l.bottom);if(void 0===i||i.dist.y>u.y||i.dist.y===u.y&&i.dist.x>u.x)return i={dist:u,node:e,start:n},0===u.y&&0===u.x}}return!1}void 0===n&&(n=!0);var i,a=this.doc.createRange(),s=e.firstChild,l=0;e:for(;null!==s;){if(n&&h.isText(s)){for(var u=0;u<s.length;++u)if(o(s,u))break e}else if(o(e,l))break;s=s.nextSibling,l++}return void 0===i?this.caretManager.makeCaret(e,0):this.caretManager.makeCaret(i.node,i.start)},e.prototype.pointToCharBoundary=function(e,t){var r=this.findLocationAt(e,t);if(void 0!==r){var n=r.node,o=r.offset,i=n.nodeType;if(h.isElement(n)&&o<n.childNodes.length||h.isText(n)&&o<n.length){var a=this.doc.createRange();a.setStart(n,o),a.setEnd(n,o+1);var s=a.getBoundingClientRect();switch(i){case Node.TEXT_NODE:var l=this.caretManager.newPosition(r,"right"),u=this.caretManager.newPosition(r.make(n,o+1),"left");void 0!==l&&void 0===u?r=l:void 0!==u&&void 0===l?r=u:void 0!==l&&void 0!==u&&(r=Math.abs(Q.boundaryXY(l).left-e)>=Math.abs(Q.boundaryXY(u).left-e)?u:l);break;case Node.ELEMENT_NODE:var c,d=n.childNodes[o];if(h.isElement(d)){var p=this.findLocationInElementAt(d,e,t),f=h.isElement(p.node)?p.node.childNodes.length-1:-1;switch(p.offset){case 0:c=!0;break;case f:c=!1}}void 0===c&&(c=Math.abs(s.left-e)<Math.abs(s.right-e)),c||(r=r.make(n,o+1));break;default:throw new Error("unexpected node type: "+i)}}}return r},e.prototype.caretChange=function(e){var t=e.options,r=e.caret,n=e.prevCaret,o=e.mode,i=e.prevMode,a=e.manager;if(void 0!==r){var s=t.textEdit===!0,l=t.gainingFocus===!0;for(l||this.editingMenuManager.setupCompletionMenu(),s||this.terminateTextUndo();void 0!==this.caretOwners[0];)this.caretOwners[0].classList.remove("_owns_caret");for(;void 0!==this.clickedLabels[0];)this.clickedLabels[0].classList.remove("_label_clicked");for(var u;void 0!==this.withCaret[0];)u=this.withCaret[0],u.classList.remove("_with_caret");if(void 0!==n){var c=f.closest(n.node,"._placeholder._transient",n.root);null!==c&&r.root.contains(c)&&this.guiUpdater.removeNode(c)}var d=h.isElement(r.node)?r.node:r.node.parentNode,m=r.root;if(this.guiRoot.contains(d)){o!==i&&this.toolbar.setModeButtons(void 0!==o?o.getToolbarButtons():[]);var v=f.closestByClass(d,"_real",m);null!==v&&v.classList.add("_owns_caret");var g,y=f.closestByClass(d,"_gui",m);if(null!==y){if(void 0===a.anchor||f.closestByClass(a.anchor.node,"_gui",m)===y){for(var b=0,w=p.childrenByClass(y.parentNode,"_gui");b<w.length;b++){var _=w[b];_.classList.add("_label_clicked")}y.classList.add("_with_caret"),g=y}}else d.classList.add("_owns_caret");u!==g&&(void 0!==g&&0!==g.getElementsByClassName("_shown_when_caret_in_label").length||void 0!==u&&0!==u.getElementsByClassName("_shown_when_caret_in_label").length)&&this.validationController.recreateErrors(),l||a.mark.scrollIntoView(),this.caretManager.mark.refresh(),this.setLocationTo(d)}}},e.prototype.setLocationTo=function(e){for(var t=[];e!==this.guiRoot;){if(e.nodeType!==Node.ELEMENT_NODE)throw new Error("unexpected node type: "+e.nodeType);e.classList.contains("_placeholder")||null!==f.closestByClass(e,"_phantom",this.guiRoot)||t.unshift("<span class='_gui _label'><span>&nbsp;"+K.getOriginalName(e)+"&nbsp;</span></span>"),e=e.parentNode}var r=this.wedLocationBar.getElementsByTagName("span")[0];r.innerHTML=0!==t.length?t.join("/"):"<span>&nbsp;</span>"},e.prototype.cut=function(){var e=this.caretManager,t=e.sel;if(void 0===t)throw new Error("no selection");if(!t.wellFormed)throw new Error("malformed range");for(var r=t.mustAsDataCarets(),n=r[0],o=r[1],i=this.cutBuffer;null!==i.firstChild;)i.removeChild(i.firstChild);if(h.isAttr(n.node)){var a=n.node;if(a!==o.node)throw new Error("attribute selection that does not start and end in the same attribute");var s=a.value.slice(n.offset,o.offset);this.spliceAttribute(f.closestByClass(e.mustFromDataLocation(n).node,"_attribute_value"),n.offset,o.offset-n.offset,""),i.textContent=s}else{for(var l=this.dataUpdater.cut(n,o),u=l[1],c=new this.window.DOMParser,d=c.parseFromString("<div></div>","text/xml"),p=0,m=u;p<m.length;p++){var v=m[p];d.firstChild.appendChild(d.adoptNode(v))}i.textContent=d.firstChild.innerHTML,e.setCaret(l[0])}var g=this.doc.createRange(),y=i;g.setStart(y,0),g.setEnd(y,y.childNodes.length);var b=this.window.getSelection();b.removeAllRanges(),b.addRange(g),setTimeout(function(){e.focusInputField()},0)},e.prototype.paste=function(e,t){var r=t.to_paste,n=r.cloneNode(!0),o=this.caretManager.getDataCaret();if(void 0===o)throw new Error("trying to paste without a caret");var i;if(1===r.childNodes.length&&h.isText(r.firstChild))if(h.isAttr(o.node)){var a=this.caretManager.mustGetNormalizedCaret();this.spliceAttribute(f.closestByClass(a.node,"_attribute_value",a.node),a.offset,0,r.firstChild.data)}else i=this.dataUpdater.insertText(o,r.firstChild.data).caret;else{for(var s=document.createDocumentFragment();null!==r.firstChild;)s.appendChild(r.firstChild);switch(o.node.nodeType){case Node.TEXT_NODE:i=this.dataUpdater.insertIntoText(o,s)[1];break;case Node.ELEMENT_NODE:var l=o.node.childNodes[o.offset],u=null!=l?l.nextSibling:null;this.dataUpdater.insertBefore(o.node,s,l),i=o.makeWithOffset(null!==u?f.indexOf(o.node.childNodes,u):o.node.childNodes.length);break;default:throw new Error("unexpected node type: "+o.node.nodeType)}}null!=i&&(this.caretManager.setCaret(i),o=i),this.$guiRoot.trigger("wed-post-paste",[t.e,o,n])},e.prototype.replaceRange=function(e,t){var r,n=e.caretManager,o=t.range,i=t.newText,a=t.caretAtEnd,s=o.start,l=o.end,u=n.toDataLocation(s),c=n.toDataLocation(l);if(h.isAttr(u.node)){var d=u.node,p=d.value;p=p.slice(0,u.offset)+i+p.slice(c.offset),e.dataUpdater.setAttributeNS(d.ownerElement,null===d.namespaceURI?"":d.namespaceURI,d.name,p),r=a?u.makeWithOffset(u.offset+i.length):u}else{var f=e.dataUpdater.cut(u,c)[0];r=e.dataUpdater.insertText(f,i,a).caret}n.setCaret(r,{textEdit:!0})},e}();t.Editor=ne}),define("wed/input-trigger",["require","exports","jquery","salve","./domtypeguards","./domutil"],function(e,t,r,n,o,i){"use strict";function a(e){return e.hash()}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t,r){this.editor=e,this.mode=t,this.selector=r,this.keyToHandler=new n.HashMap(a),this.textInputKeyToHandler=new n.HashMap(a),e.$guiRoot.on("wed-post-paste",this.pasteHandler.bind(this)),e.$guiRoot.on("wed-input-trigger-keydown",this.keydownHandler.bind(this)),e.$guiRoot.on("wed-input-trigger-keypress",this.keypressHandler.bind(this))}return e.prototype.addKeyHandler=function(e,t){var r=this.keyToHandler.has(e);null==r&&(r=[],this.keyToHandler.add(e,r)),r.push(t),!e.anyModifier()&&e.keypress&&null==this.textInputKeyToHandler.has(e)&&this.textInputKeyToHandler.add(e,r)},e.prototype.getNodeOfInterest=function(){var e=this.editor.caretManager.getDataCaret(!0);if(null==e)return null;if(this.editor.modeTree.getMode(e.node)!==this.mode)return null;var t=o.isText(e.node)?e.node.parentNode:e.node,n=r.data(t,"wed_mirror_node");return i.closest(n,this.selector.value,this.editor.guiRoot)},e.prototype.keydownHandler=function(e,t){var n=this.getNodeOfInterest();if(null!==n){var o=r.data(n,"wed_mirror_node");this.keyToHandler.forEach(function(e,r){if(e.matchesEvent(t))for(var n=0,i=r;n<i.length;n++){var a=i[n];a("keydown",o,t)}})}},e.prototype.keypressHandler=function(e,t){var n=this.getNodeOfInterest();if(null!==n){var o=r.data(n,"wed_mirror_node");this.keyToHandler.forEach(function(e,r){if(e.matchesEvent(t))for(var n=0,i=r;n<i.length;n++){var a=i[n];a("keypress",o,t)}})}},e.prototype.pasteHandler=function(e,t,n,a){if(!this.editor.undoingOrRedoing()){for(var s=[],l=a.firstChild;null!==l;)o.isText(l)&&s.push(l),l=l.nextSibling;if(0!==s.length&&this.editor.modeTree.getMode(n.node)===this.mode){var u=o.isText(n.node)?n.node.parentNode:n.node,c=r.data(u,"wed_mirror_node");null!==i.closest(c,this.selector.value,this.editor.guiRoot)&&this.textInputKeyToHandler.forEach(function(e,r){if(!e.anyModifier())for(var n=String.fromCharCode(e.which),o=0,i=s;o<i.length;o++){var a=i[o];if(null!==a.parentNode&&a.data.indexOf(n)>-1)for(var l=0,c=r;l<c.length;l++){var d=c[l];d("paste",u,t)}}})}}},e}();t.InputTrigger=s}),define("wed/input-trigger-factory",["require","exports","./domtypeguards","./domutil","./input-trigger","./transformation"],function(e,t,r,n,o,i){"use strict";function a(e,t){var o=t.node,i=t.sep;if("string"!=typeof i||1!==i.length)throw new Error("transformation invoked with incorrect data");for(var a=!0;a;){a=!1;for(var s=[],l=o.firstChild;null!==l;)r.isText(l)&&s.push(l),l=l.nextSibling;for(var u=0;!a&&u<s.length;++u){var c=s[u],d=c.data.indexOf(i);if(o.firstChild===c&&0===d)e.dataUpdater.deleteText(c,d,1),a=!0;else if(o.lastChild===c&&d!==-1&&d===c.length-1)e.dataUpdater.deleteText(c,c.length-1,1),a=!0;else if(d!==-1){var h=e.dataUpdater.splitAt(o,c,d),p=h[1];if(null===p)throw new Error("null end; we should not be getting that");o=p,a=!0}}}e.caretManager.setCaret(n.firstDescendantOrSelf(o),0)}function s(e,t,n,s,l,u){var c=new i.Transformation(e,"split","Split node on character",a),d=new o.InputTrigger(e,t,n);return d.addKeyHandler(s,function(t,r,n){void 0!==n&&(n.stopImmediatePropagation(),n.preventDefault()),"keypress"===t||"keydown"===t?e.fireTransformation(e.splitNodeTr,{node:r}):e.fireTransformation(c,{name:r.tagName,node:r,sep:String.fromCharCode(s.which)})}),d.addKeyHandler(l,function(t,n,o){var i=e.caretManager.getDataCaret();null!=i&&0===i.offset&&(i.node===n||r.isText(i.node)&&i.node===n.firstChild)&&(void 0!==o&&(o.stopImmediatePropagation(),o.preventDefault()),e.fireTransformation(e.mergeWithPreviousHomogeneousSiblingTr,{node:n,name:n.tagName}))}),d.addKeyHandler(u,function(t,n,o){var i=e.caretManager.getDataCaret();null!=i&&(i.node===n&&i.offset===n.childNodes.length||r.isText(i.node)&&i.node===n.lastChild&&i.offset===n.lastChild.length)&&(void 0!==o&&(o.stopImmediatePropagation(),o.preventDefault()),e.fireTransformation(e.mergeWithNextHomogeneousSiblingTr,{node:n,name:n.tagName}))}),d}Object.defineProperty(t,"__esModule",{value:!0}),t.makeSplitMergeInputTrigger=s});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/labelman",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.name=e,this._idToLabel=Object.create(null),this.labelIndex=0}return e.prototype.idToLabel=function(e){return this._idToLabel[e]},e.prototype.deallocateAll=function(){this._idToLabel=Object.create(null),this.labelIndex=0,this._deallocateAllLabels()},e.prototype.nextNumber=function(){return++this.labelIndex},e}();t.LabelManager=r;var n="abcdefghijklmnopqrstuvwxyz",o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.allocateLabel=function(e){var t=this._idToLabel[e];if(void 0===t){var r=this.nextNumber()-1,o=Math.floor(r/26)+1,i=r%26;t=n[i].repeat(o),this._idToLabel[e]=t}return t},t.prototype._deallocateAllLabels=function(){},t}(r);t.AlphabeticLabelManager=o}),define("wed/decorator",["require","exports","jquery","./dloc","./domtypeguards","./domutil","./gui/action-context-menu","./util"],function(e,t,r,n,o,i,a,s){"use strict";function l(e,t){try{e.caretManager.setCaret(t,{textEdit:!0})}catch(e){}}function u(e,t){return"*"===e||e===t}Object.defineProperty(t,"__esModule",{value:!0});var c=i.indexOf,d=i.closestByClass,h=function(){function e(e,t){this.mode=e,this.editor=t,this.domlistener=t.domlistener,this.guiUpdater=t.guiUpdater,this.namespaces=e.getAbsoluteNamespaceMappings()}return e.prototype.startListening=function(){this.domlistener.startListening()},e.prototype.listDecorator=function(e,t){if(this.editor.modeTree.getMode(e)===this.mode){for(var r=Object.create(null),n=e.firstElementChild;null!==n;)n.classList.contains("_real")&&(r[s.getOriginalName(n)]=1),n=n.nextElementSibling;var o=Object.keys(r);if(o.length>1)throw new Error("calling listDecorator on a non-homogeneous list.");if(0!==o.length){for(n=e.firstElementChild;null!==n;){var i=n.nextElementSibling;n.hasAttribute("data-wed--separator-for")&&this.guiUpdater.removeNode(n),n=i}var a,l=o[0];"string"==typeof t?(a=e.ownerDocument.createElement("div"),a.textContent=t):a=t,a.classList.add("_text"),a.classList.add("_phantom"),a.setAttribute("data-wed--separator-for",l);var u=!0;for(n=e.firstElementChild;null!==n;)n.classList.contains("_real")&&(u?u=!1:this.guiUpdater.insertBefore(e,a.cloneNode(!0),n)),n=n.nextElementSibling}}},e.prototype.elementDecorator=function(e,t,n,a,u){if(this.editor.modeTree.getMode(t)===this.mode){if(n>this.editor.maxLabelLevel)throw new Error("level higher than the maximum set by the mode: "+n);var c=this.editor.caretManager.getDataCaret();null==c||o.isAttr(c.node)&&c.node.ownerElement===r.data(t,"wed_mirror_node")||(c=void 0);var d=r.data(t,"wed_mirror_node");this.setReadOnly(t,Boolean(this.editor.validator.getNodeProperty(d,"PossibleDueToWildcard")));for(var h=s.getOriginalName(t),p="_"+h+"_label",f=i.childrenByClass(t,p),m=0,v=f;m<v.length;m++){var g=v[m];t.removeChild(g)}var y="",b=!1,w=this.editor.modeTree.getAttributeHandling(t);if("show"===w||"edit"===w)for(var _=s.getOriginalAttributes(t),E=Object.keys(_).sort(),x=0,N=E;x<N.length;x++){var C=N[x],S=this.mustHideAttribute(t,C);S&&(b=!0);var P=S?" _shown_when_caret_in_label":"";y+=' <span class="_phantom _attribute'+P+'"><span class="_phantom _attribute_name">'+C+'</span>="<span class="_phantom _attribute_value">'+i.textToHTML(_[C])+'</span>"</span>'}var k=t.ownerDocument;p+=" _label_level_"+n;var T=p;b&&(p+=" _autohidden_attributes");var A=k.createElement("span");A.className="_gui _phantom __start_label _start_wrapper "+p+" _label";var O=k.createElement("span");O.className="_phantom",O.innerHTML="&nbsp;<span class='_phantom _element_name'>"+h+"</span>"+y+"<span class='_phantom _greater_than'> >&nbsp;</span>",A.appendChild(O),this.guiUpdater.insertNodeAt(t,0,A);var R=k.createElement("span");R.className="_gui _phantom __end_label _end_wrapper "+T+" _label";var I=k.createElement("span");I.className="_phantom",I.innerHTML="<span class='_phantom _less_than'>&nbsp;&lt; </span><span class='_phantom _element_name'>"+h+"</span>&nbsp;",R.appendChild(I),this.guiUpdater.insertBefore(t,R,null),r(A).on("wed-context-menu",void 0!==a&&a),r(R).on("wed-context-menu",void 0!==u&&u),null!=c&&l(this.editor,c)}},e.prototype.mustHideAttribute=function(e,t){var r=this.editor.modeTree.getAttributeHidingSpecs(e);if(null===r)return!1;for(var n=0,o=r.elements;n<o.length;n++){var i=o[n];if(e.matches(i.selector)){for(var a=!1,s=0,l=i.attributes;s<l.length;s++){var c=l[s];if("string"==typeof c)a||(a=u(c,t));else if(a)for(var d=0,h=c.except;d<h.length;d++){var p=h[d];if(a=!u(p,t),!a)break}}return a}}return!1},e.prototype.setReadOnly=function(e,t){var r=e.classList;(t?r.add:r.remove).call(r,"_readonly")},e.prototype.contextMenuHandler=function(e,t,o){function i(e,t,r){var n=p.makeMenuItemForAction(t,e,r);m.push({action:t,item:n,data:e})}function l(e,t,r){if(void 0!==t)for(var n=0,o=t;n<o.length;n++){var a=o[n];i(e,a,r)}}function u(e,t){var r=e.params[1];if(r.simple())for(var n=0,o=r.toArray();n<o.length;n++){var a=o[n],s=v.getAbsoluteResolver().unresolveName(a.ns,a.name);if(void 0===s)throw new Error("cannot unresolve attribute");if(h.isAttrProtected(s,t))return;l({name:s,node:t},v.getContextualActions("add-attribute",s,t))}else i(null,h.complexPatternAction)}var h=this.editor,p=h.editingMenuManager,f=t.target,m=[],v=h.modeTree.getMode(f),g=d(f,"_real",h.guiRoot),y=null!==g&&g.classList.contains("_readonly"),b=d(f,"_attribute_value",h.guiRoot);if(null!==b){var w=h.toDataNode(b),_=n.DLoc.mustMakeDLoc(h.dataRoot,w.ownerElement),E=_.node.childNodes[_.offset];h.validator.possibleAt(_,!0).forEach(function(e){"attributeName"===e.params[0]&&u(e,E)});var x=w.name;h.isAttrProtected(w)||l({name:x,node:w},v.getContextualActions("delete-attribute",x,w))}else{var N=d(f,"_real",h.guiRoot);if(null===N)throw new Error("cannot find real parent");f=N;var C=f.parentNode===h.guiRoot;m.push.apply(m,p.makeCommonItems(h.toDataNode(f)));var S=s.getOriginalName(f);C||l({node:f,name:S},v.getContextualActions(["unwrap","delete-element"],S,r.data(f,"wed_mirror_node"),0));var P=f.parentNode,k=c(P.childNodes,f);e||k++;var _=h.caretManager.toDataLocation(P,k);if(void 0===_)throw new Error("cannot get caret");if(e){var T=_.node.childNodes[_.offset],A=h.modeTree.getAttributeHandling(T);"edit"===A&&h.validator.possibleAt(_,!0).forEach(function(e){"attributeName"===e.params[0]&&u(e,T)})}if(!C){for(var O=0,R=h.getElementTransformationsAt(_,"insert");O<R.length;O++){var I=R[O];void 0!==I.name?i({name:I.name,moveCaretTo:_},I.tr,e):i(null,I.tr)}if(e)for(var D=_.make(_.node.childNodes[_.offset],0),M=0,L=h.getElementTransformationsAt(D,"wrap-content");M<L.length;M++){var I=L[M];i(void 0!==I.name?{name:I.name,node:f}:null,I.tr)}}}return 0===m.length||(p.setupContextMenu(a.ActionContextMenu,m,y,o),!1)},e}();t.Decorator=h}),define("wed/gui-selector",["require","exports","./domutil"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=new WeakMap,o=function(){function e(e){var t=n.get(e);return void 0!==t?t:void(this.value=e)}return e.makeVerbatim=function(t){return new e(t)},e.fromDataSelector=function(t,n){return new e(r.toGUISelector(t,n))},e}();t.GUISelector=o}),define("wed/mode",["require","exports","wed"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.editor=e,this.options=t,this.wedOptions={metadata:{name:"Base Mode (you should not be using this)",description:"The base mode. You should not be using it directly.",authors:["Louis-Dominique Dubeau"],license:"MPL 2.0",copyright:"Mangalam Research Center for Buddhist Languages"},label_levels:{max:1,initial:1}}}return e.prototype.getModeOptions=function(){return this.options},e.prototype.getWedOptions=function(){return this.wedOptions},e.prototype.getStylesheets=function(){return[]},e.prototype.nodesAroundEditableContents=function(e){for(var t,n,o=null,i=null,a=e.firstChild,s=0;null!==a;){if(r.domtypeguards.isElement(a)&&(a.classList.contains("_start_wrapper")&&(t=s,o=a),a.classList.contains("_end_wrapper"))){n=s,i=a;break}a=a.nextSibling,s++}if(void 0!==t&&void 0!==n&&n<=t)throw new Error("end wrapper element unexpectedly appears before start wrapper element, or is also a start wrapper element");return[o,i]},e.prototype.makePlaceholderFor=function(e){return r.domutil.makePlaceholder()},e.prototype.shortDescriptionFor=function(e){},e.prototype.documentationLinkFor=function(e){},e.prototype.getValidator=function(){},e.prototype.getAttributeCompletions=function(e){return[]},e.prototype.getToolbarButtons=function(){return[]},e}();t.BaseMode=n}),define("wed",["require","exports","./wed/convert","./wed/domtypeguards","./wed/domutil","./wed/editor","./wed/exceptions","./wed/input-trigger-factory","./wed/key","./wed/key-constants","./wed/labelman","./wed/object-check","./wed/runtime","./wed/saver","./wed/transformation","./wed/tree-updater","./wed/util","./wed/action","./wed/decorator","./wed/dloc","./wed/domlistener","./wed/editor","./wed/gui-selector","./wed/mode","./wed/undo","./wed/validator","./wed/gui/button","./wed/gui/context-menu","./wed/gui/modal","./wed/gui/tooltip","./wed/gui/typeahead-popup"],function(e,t,r,n,o,i,a,s,l,u,c,d,h,p,f,m,v,g,y,b,w,_,E,x,N,C,S,P,k,T,A){"use strict";function O(e,t){return new i.Editor(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.convert=r,t.domtypeguards=n,t.domutil=o,t.exceptions=a,t.inputTriggerFactory=s,t.key=l,t.keyConstants=u,t.labelman=c,t.objectCheck=d,t.Runtime=h.Runtime,t.saver=p,t.transformation=f,t.treeUpdater=m,t.util=v,t.makeEditor=O,t.Action=g.Action,t.Decorator=y.Decorator,t.DLoc=b.DLoc,t.DLocRoot=b.DLocRoot,t.DOMListener=w.DOMListener,t.version=_.version,t.GUISelector=E.GUISelector,t.BaseMode=x.BaseMode,t.UndoMarker=N.UndoMarker,t.Validator=C.Validator;var R;!function(e){e.button=S,e.contextMenu=P,e.modal=k,e.tooltip=T,e.typeaheadPopup=A}(R=t.gui||(t.gui={}))});